C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  clrL    equ     14h                 ;register voor het legen van het het scherm
       2       2   00000                  clrH    equ     15h                 ;register voor het legen van het het scherm
       3       3   00000                  
       4       4   00000                  org 0000h
       5       5   00000 020003           ljmp   main
       6       6   00003                  
       7       7   00003                  ;------------------------------------------------------------------
       8       8   00003                  ;Hoofd programma
       9       9   00003                  ;------------------------------------------------------------------
      10      10   00003                  main:
      11      11   00003 75817F               mov     sp,#7fh                 ;stackpointer instellen
      12      12   00006 120018               lcall   inits
      13      13   00009                  
      14      14   00009                  laatzien:
      15      15   00009                      ;letter
      16      16   00009 7511FF               mov     DATAREG,#ffh
      17      17   0000C 12010C               lcall   dataWrite
      18      18   0000F 7512C0               mov     COMANDREG,#c0h
      19      19   00012 12013B               lcall   comandWrite
      20      20   00015 020009               ljmp    laatzien
      21      21   00018                  
      22      22   00018                  
      23      23   00018                  ;------------------------------------------------------------------
      24      24   00018                  ;Initializatie van alle componenten nodig in het hoofd programma
      25      25   00018                  ;------------------------------------------------------------------
      26      26   00018                  inits:
      27      27   00018 75B200               mov     port_page,#000h         ;selecteer poort page 0
      28      28   0001B 12008A               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      29      29   0001E 120022               lcall   clearScreen
      30      30   00021 22               ret
      31      31   00022                  
      32      32   00022                  ;------------------------------------------------------------------
      33      33   00022                  ;Het scherm leeg maken
      34      34   00022                  ;------------------------------------------------------------------
      35      35   00022                  clearScreen:
      36      36   00022 C0E0                 push    acc
      37      37   00024 C0D0                 push    psw
      38      38   00026 7514FF               mov     clrL,#255               ;255 keer doolopen
      39      39   00029 751508               mov     clrH,#8                 ;32 keer de 255 keer doorlopen, heel het geheugen van controller leeg maken (8192 keer)
      40      40   0002C                      ;Mode set
      41      41   0002C 751282               mov     COMANDREG,#10000010b
      42      42   0002F 12013B               lcall   comandWrite
      43      43   00032                  L1:
      44      44   00032 751100               mov     DATAREG,#00h
      45      45   00035 12010C               lcall   dataWrite
      46      46   00038 7512C0               mov     COMANDREG,#c0h
      47      47   0003B 12013B               lcall   comandWrite
      48      48   0003E D514F1               djnz    clrL,L1
      49      49   00041 7514FF               mov     clrL,#255
      50      50   00044 D515EB               djnz    clrH,L1
      51      51   00047                      ;adres data pointer
      52      52   00047 751100               mov     DATAREG,#00h            ;lower address
      53      53   0004A 12010C               lcall   dataWrite
      54      54   0004D 751100               mov     DATAREG,#00h
      55      55   00050 12010C               lcall   dataWrite
      56      56   00053 751224               mov     COMANDREG,#24h
      57      57   00056 12013B               lcall   comandWrite
      58      58   00059 D0E0                 pop     acc
      59      59   0005B D0D0                 pop     psw
      60      60   0005D 22               ret
      61      61   0005E                  
      62      62   0005E                  
      63      63   0005E                  
project.inc 
      65       1   0005E                  ;------------------------------------------------------------------
      66       2   0005E                  ;Lijst van functies:
      67       3   0005E                  ;   -statusCheck            Status check van scherm opslaan in STA register
      68       4   0005E                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      69       5   0005E                  ;   -debug                  debug info op seriele poot zetten
      70       6   0005E                  ;------------------------------------------------------------------
      71       7   0005E                  ;------------------------------------------------------------------
      72       8   0005E                  ;declaratie van pinnen
      73       9   0005E                  ;------------------------------------------------------------------
      74      10   0005E                      WR          bit     p3_data.0   ;write line van scherm actief laag
      75      11   0005E                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      76      12   0005E                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      77      13   0005E                      CD          bit     p3_data.3   ;Command write
      78      14   0005E                      RESET       bit     p0_data.1   ;reset van scherm actief laag
      79      15   0005E                      FS          bit     p0_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      80      16   0005E                  
      81      17   0005E                  
      82      18   0005E                  
      83      19   0005E                  ;------------------------------------------------------------------
      84      20   0005E                  ;declaratie van registers
      85      21   0005E                  ;------------------------------------------------------------------
      86      22   0005E                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      87      23   0005E                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      88      24   0005E                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      89      25   0005E                  
      90      26   0005E                  
      91      27   0005E                  ;------------------------------------------------------------------
      92      28   0005E                  ;Status check van scherm opslaan in STA register
      93      29   0005E                  ;-STA
      94      30   0005E                  ;------------------------------------------------------------------
      95      31   0005E                  statusCheck:
      96      32   0005E C0E0                 push    acc
      97      33   00060 C0D0                 push    psw
      98      34   00062 C210                 clr     STA                     ;STA register leeg maken
      99      35   00064 75C900               mov     p4_dir,#000h            ;p4 als input zetten
     100      36   00067 D2B3                 setb    CD
     101      37   00069 D2B0                 setb    WR
     102      38   0006B                  stan:
     103      39   0006B C2B1                 clr     RD
     104      40   0006D E5C8                 mov     a,p4_data
     105      41   0006F D2B1                 setb    RD
     106      42   00071 D2B3                 setb    CD
     107      43   00073 F8                   mov     r0,a
     108      44   00074 120151               lcall   debug
     109      45   00077 F510                 mov     STA,a                   ;bijhouden voor eventueel gebruik
     110      46   00079 5403                 anl     a,#03h                  ;masker voor STA0 en STA1
     111      47   0007B B403ED               cjne    a,#03h,stan
     112      48   0007E F8                   mov     r0,a
     113      49   0007F 120151               lcall   debug
     114      50   00082 75C9FF               mov     p4_dir,#0ffh
     115      51   00085 D0D0                 pop     psw
     116      52   00087 D0E0                 pop     acc
     117      53   00089 22               ret
     118      54   0008A                  
     119      55   0008A                  ;------------------------------------------------------------------
     120      56   0008A                  ;Initializatie van grafisch LCD scherm
     121      57   0008A                  ;-Poort 1
     122      58   0008A                  ;------------------------------------------------------------------
     123      59   0008A                  initGLCD:
     124      60   0008A 12051C               lcall   initsio                 ;voor debug
     125      61   0008D 7586FF               mov     p0_dir,#0ffh            ;poort 1 als output
     126      62   00090 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output
     127      63   00093 C2B2                 clr     CE
     128      64   00095 D2B0                 setb    WR
     129      65   00097 D2B1                 setb    RD
     130      66   00099 D280                 setb    FS                      ;font op 6*8 zetten
     131      67   0009B C281                 clr     RESET                   ;reseten van scherm
     132      68   0009D 1202FC               lcall   delay1ms
     133      69   000A0 D281                 setb    RESET                   ;reset terug af zetten
     134      70   000A2 12005E               lcall   statusCheck             ;initiele status check uitvoeren
     135      71   000A5                  
     136      72   000A5                      ;Mode set
     137      73   000A5 751282               mov     COMANDREG,#10000010b
     138      74   000A8 12013B               lcall   comandWrite
     139      75   000AB                  
     140      76   000AB                      ;Graphics home address
     141      77   000AB 751100               mov     DATAREG,#00h
     142      78   000AE 12010C               lcall   dataWrite
     143      79   000B1 751100               mov     DATAREG,#00h
     144      80   000B4 12010C               lcall   dataWrite
     145      81   000B7 751242               mov     COMANDREG,#42h
     146      82   000BA 12013B               lcall   comandWrite
     147      83   000BD                  
     148      84   000BD                      ;Graphics area set
     149      85   000BD 75111E               mov     DATAREG,#1eh
     150      86   000C0 12010C               lcall   dataWrite
     151      87   000C3 751100               mov     DATAREG,#00h
     152      88   000C6 12010C               lcall   dataWrite
     153      89   000C9 751243               mov     COMANDREG,#43h
     154      90   000CC 12013B               lcall   comandWrite
     155      91   000CF                  
     156      92   000CF                      ;text home address
     157      93   000CF 751107               mov     DATAREG,#07h
     158      94   000D2 12010C               lcall   dataWrite
     159      95   000D5 751180               mov     DATAREG,#80h
     160      96   000D8 12010C               lcall   dataWrite
     161      97   000DB 751240               mov     COMANDREG,#40h
     162      98   000DE 12013B               lcall   comandWrite
     163      99   000E1                  
     164     100   000E1                      ;text area set
     165     101   000E1 751128               mov     DATAREG,#28h
     166     102   000E4 12010C               lcall   dataWrite
     167     103   000E7 751100               mov     DATAREG,#00h
     168     104   000EA 12010C               lcall   dataWrite
     169     105   000ED 751241               mov     COMANDREG,#41h
     170     106   000F0 12013B               lcall   comandWrite
     171     107   000F3                  
     172     108   000F3                      ;adres data pointer
     173     109   000F3 751100               mov     DATAREG,#00h            ;lower address
     174     110   000F6 12010C               lcall   dataWrite
     175     111   000F9 751100               mov     DATAREG,#00h
     176     112   000FC 12010C               lcall   dataWrite
     177     113   000FF 751224               mov     COMANDREG,#24h
     178     114   00102 12013B               lcall   comandWrite
     179     115   00105                  
     180     116   00105                      ;Display mode
     181     117   00105 751298               mov     COMANDREG,#98h
     182     118   00108 12013B               lcall   comandWrite
     183     119   0010B                  
     184     120   0010B 22               ret
     185     121   0010C                  
     186     122   0010C                  ;------------------------------------------------------------------
     187     123   0010C                  ;Data naar het schem sturen
     188     124   0010C                  ;-DATAREG
     189     125   0010C                  ;------------------------------------------------------------------
     190     126   0010C                  DataWrite:
     191     127   0010C C0E0                 push    acc
     192     128   0010E C0D0                 push    psw
     193     129   00110 12005E               lcall   statusCheck             ;status checken
     194     130   00113 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     195     131   00116 C2B3                 clr     CD
     196     132   00118 00                   nop
     197     133   00119 C2B0                 clr     WR
     198     134   0011B 00                   nop
     199     135   0011C D2B0                 setb    WR
     200     136   0011E D0D0                 pop     psw
     201     137   00120 D0E0                 pop     acc
     202     138   00122 22               ret
     203     139   00123                  
     204     140   00123                  ;------------------------------------------------------------------
     205     141   00123                  ;data van het scherm inlezen
     206     142   00123                  ;-DATAREG
     207     143   00123                  ;------------------------------------------------------------------
     208     144   00123                  DataRead:
     209     145   00123 C0E0                 push    acc
     210     146   00125 C0D0                 push    psw
     211     147   00127 12005E               lcall   statusCheck             ;status checken
     212     148   0012A 75C900               mov     p4_dir,#000h            ;p4 als ingang
     213     149   0012D C2B3                 clr     CD
     214     150   0012F C2B1                 clr     RD
     215     151   00131 00                   nop                             ;wachten
     216     152   00132 00                   nop
     217     153   00133 85C811               mov     DATAREG,p4_data         ;data inlezeen van scherm
     218     154   00136 D0D0                 pop     psw
     219     155   00138 D0E0                 pop     acc
     220     156   0013A 22               ret
     221     157   0013B                  
     222     158   0013B                  ;------------------------------------------------------------------
     223     159   0013B                  ;comando naar het scherrm sturen
     224     160   0013B                  ;-COMANDREG
     225     161   0013B                  ;------------------------------------------------------------------
     226     162   0013B                  ComandWrite:
     227     163   0013B C0E0                 push    acc
     228     164   0013D C0D0                 push    psw
     229     165   0013F 12005E               lcall   statusCheck             ;status checken
     230     166   00142 8512C8               mov     p4_data,COMANDREG       ;comando op de bus zetten
     231     167   00145 D2B3                 setb    CD
     232     168   00147 C2B0                 clr     WR
     233     169   00149 00                   nop
     234     170   0014A D2B0                 setb    WR
     235     171   0014C D0D0                 pop     psw
     236     172   0014E D0E0                 pop     acc
     237     173   00150 22               ret
     238     174   00151                  
     239     175   00151                  ;------------------------------------------------------------------
     240     176   00151                  ;debug info op seriele poort zetten
     241     177   00151                  ;-r0
     242     178   00151                  ;------------------------------------------------------------------
     243     179   00151                  debug:
     244     180   00151 C0E0                 push    acc
     245     181   00153 C0D0                 push    psw
     246     182   00155 740D                 mov     a,#0dh
     247     183   00157 120554               lcall   siooutchar
     248     184   0015A E8                   mov     a,r0
     249     185   0015B 120570               lcall   siooutbyte
     250     186   0015E 740A                 mov     a,#0ah
     251     187   00160 120554               lcall   siooutchar
     252     188   00163 D0D0                 pop     psw
     253     189   00165 D0E0                 pop     acc
     254     190   00167 22               ret
     255     191   00168                  
     256     192   00168                  
     257     193   00168                  
     258     194   00168                  
xcez1.inc 
     260       1   00168                  ;*******************************************************************************
     261       2   00168                  ;
     262       3   00168                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     263       4   00168                  ;
     264       5   00168                  ; The file contains drivers for various hardware and math applications.
     265       6   00168                  ; In addition all register declarations are added.
     266       7   00168                  ;
     267       8   00168                  ; WARNING:!!!!!!!
     268       9   00168                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     269      10   00168                  ;
     270      11   00168                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     271      12   00168                  ;
     272      13   00168                  ;*******************************************************************************
     273      14   00168                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     274      15   00168                  ;
     275      16   00168                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     276      17   00168                  ;
     277      18   00168                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     278      19   00168                  ; eenvoudige manier te gebruiken:
     279      20   00168                  ;
     280      21   00168                  ; standaard I/O:
     281      22   00168                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     282      23   00168                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     283      24   00168                  ;      initleds             klaar zetten LED's als outputs
     284      25   00168                  ;
     285      26   00168                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     286      27   00168                  ;      initiic              klaar zetten iic interface
     287      28   00168                  ;      iicstart             genereren van een startconditie op iic poort
     288      29   00168                  ;      iicstop              genereren stop conditie op iic poort
     289      30   00168                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     290      31   00168                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     291      32   00168                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     292      33   00168                  ;
     293      34   00168                  ; LCD interace
     294      35   00168                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     295      36   00168                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     296      37   00168                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     297      38   00168                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     298      39   00168                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     299      40   00168                  ;      lcdlighton           backlight aan
     300      41   00168                  ;      lcdlightoff          backlight uit
     301      42   00168                  ;      lcdbuzon             buzzer aan
     302      43   00168                  ;      lcdbuzof             buzzer uit
     303      44   00168                  ;
     304      45   00168                  ; Seriële interface (via USB stekker!!)
     305      46   00168                  ;      initsio              klaar zetten seriële poort 9600 baud
     306      47   00168                  ;      siooutchar           afdrukken ascii code (accu=input)
     307      48   00168                  ;      siooutbyte           afdrkken getal in accu
     308      49   00168                  ;      siooutnib            afdrukken 4 laagste bits accu
     309      50   00168                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     310      51   00168                  ;      sioinchar            inlezen van 1 ascii code in de accu
     311      52   00168                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     312      53   00168                  ;
     313      54   00168                  ; ADC
     314      55   00168                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     315      56   00168                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     316      57   00168                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     317      58   00168                  ;
     318      59   00168                  ; Arithmetic:
     319      60   00168                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     320      61   00168                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     321      62   00168                  ;      div16                delen 2 16 bit getallen
     322      63   00168                  ;      div32                delen 2 32 bit getallen
     323      64   00168                  ;      add16                optellen 2 16 bit getallen
     324      65   00168                  ;      add32                optellen 2 32 bit getallen
     325      66   00168                  ;      sub16                verschil 2 16 bit getallen
     326      67   00168                  ;      sub32                verschil 2 32 bit getallen
     327      68   00168                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     328      69   00168                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     329      70   00168                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     330      71   00168                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     331      72   00168                  ;
     332      73   00168                  ; Diverse
     333      74   00168                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     334      75   00168                  ;      delay1ms             tijdsverraging 1 milliseconde
     335      76   00168                  ;      delay10us            tijdsvertraging 10 microseconde
     336      77   00168                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     337      78   00168                  ;	mapregs 		selecteer de SFR's in de mapped area
     338      79   00168                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     339      80   00168                  ;
     340      81   00168                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     341      82   00168                  ; LET OP!!!!
     342      83   00168                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     343      84   00168                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     344      85   00168                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     345      86   00168                  ;
     346      87   00168                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     347      88   00168                  ;
     348      89   00168                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     349      90   00168                  
     350      91   00168                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     351      92   00168                  ;
     352      93   00168                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     353      94   00168                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     354      95   00168                  ; massa zonder extra weerstanden.
     355      96   00168                  ;
     356      97   00168                  ; Gebruikt geen registers
     357      98   00168                  ;
     358      99   00168                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     359     100   00168                  
     360     101   00168 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     361     102   0016A 758F04                         mov    syscon0,#004h
     362     103   0016D C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     363     104   0016F 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     364     105   00172 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     365     106   00175 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     366     107   00178 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     367     108   0017B 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     368     109   0017E D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     369     110   00180 D08F                           pop    syscon0              ;pagina terug herstellen
     370     111   00182 22                             ret
     371     112   00183                  
     372     113   00183                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     373     114   00183                  ;
     374     115   00183                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     375     116   00183                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     376     117   00183                  ; 2 behouden hun originele instelling.
     377     118   00183                  ;
     378     119   00183                  ; Gebruikt geen registers
     379     120   00183                  ;
     380     121   00183                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     381     122   00183                  
     382     123   00183 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     383     124   00185 758F04                         mov    syscon0,#004h
     384     125   00188 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     385     126   0018A 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     386     127   0018D 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     387     128   00190 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     388     129   00193 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     389     130   00196 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     390     131   00199 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     391     132   0019B D08F                           pop    syscon0              ;pagina terug herstellen
     392     133   0019D 22                             ret
     393     134   0019E                  
     394     135   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     395     136   0019E                  ;
     396     137   0019E                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     397     138   0019E                  ; worden gedoofd (actief laag om ze te laden branden).
     398     139   0019E                  ;
     399     140   0019E                  ; Gebruikt geen registers
     400     141   0019E                  ;
     401     142   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     402     143   0019E                  
     403     144   0019E                  
     404     145   0019E C08F             initleds:     push   syscon0              ;juiste map selecteren
     405     146   001A0 758F04                         mov    syscon0,#004h
     406     147   001A3 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     407     148   001A5 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     408     149   001A8 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     409     150   001AB D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     410     151   001AD D08F                           pop    syscon0              ;pagina terug herstellen
     411     152   001AF 22                             ret
     412     153   001B0                  
     413     154   001B0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     414     155   001B0                  ;
     415     156   001B0                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     416     157   001B0                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     417     158   001B0                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     418     159   001B0                  ; sda wordt als input geschakeld
     419     160   001B0                  ;
     420     161   001B0                  ; LET OP!!
     421     162   001B0                  ; Dit is een IIC bus met beperkte mogelijkheden:
     422     163   001B0                  ; -vaste communicatiesnleheid van 100kbit/s
     423     164   001B0                  ; -enkel master mode
     424     165   001B0                  ; -enkel 7 bit adressering
     425     166   001B0                  ; -geen klok stretching
     426     167   001B0                  ;
     427     168   001B0                  ; Gebruikt geen registers
     428     169   001B0                  ;
     429     170   001B0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     430     171   001B0                  
     431     172   001B0                  sda           bit    p0_data.7            ;pin gebruikt als sda
     432     173   001B0                  scl           bit    p0_data.3            ;pin gebruikt als scl
     433     174   001B0                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     434     175   001B0                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     435     176   001B0                  
     436     177   001B0 C08F             initiic:      push   syscon0              ;juiste map selecteren
     437     178   001B2 758F04                         mov    syscon0,#004h
     438     179   001B5 C0B2                           push   port_page
     439     180   001B7 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     440     181   001BA D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     441     182   001BC D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     442     183   001BE 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     443     184   001C1 D283                           setb   scl                  ;klok werkt als od
     444     185   001C3 D287                           setb   sda                  ;sda werkt als od
     445     186   001C5 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     446     187   001C8 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     447     188   001CB 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     448     189   001CE D0B2                           pop    port_page            ;pagina herstellen
     449     190   001D0 D08F                           pop    syscon0              ;map herstellen
     450     191   001D2 22                             ret
     451     192   001D3                  
     452     193   001D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     453     194   001D3                  ;
     454     195   001D3                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     455     196   001D3                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     456     197   001D3                  ; te garanderen volgt er een delay van 10us
     457     198   001D3                  ;
     458     199   001D3                  ; Gebruikt geen registers
     459     200   001D3                  ;
     460     201   001D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     461     202   001D3                  
     462     203   001D3 C08F             iicstart:     push   syscon0              ;map bewaren
     463     204   001D5 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     464     205   001D8 C0B2                           push   port_page            ;pagina bewaren
     465     206   001DA 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     466     207   001DD D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     467     208   001DF D287                           setb   sda                  ;idem
     468     209   001E1 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     469     210   001E4 1202D4                         lcall  delay10us            ;
     470     211   001E7 C287                           clr    sda                  ;data laag
     471     212   001E9 1202D4                         lcall  delay10us
     472     213   001EC C283                           clr    scl                  ;dan klok laag
     473     214   001EE 1202D4                         lcall  delay10us            ;bit lang genoeg maken
     474     215   001F1 D0B2                           pop    port_page            ;registers herstellen
     475     216   001F3 D08F                           pop    syscon0
     476     217   001F5 22                             ret
     477     218   001F6                  
     478     219   001F6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     479     220   001F6                  ;
     480     221   001F6                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     481     222   001F6                  ;
     482     223   001F6                  ; Gebruikt geen registers
     483     224   001F6                  ;
     484     225   001F6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     485     226   001F6                  
     486     227   001F6 C08F             iicstop:      push   syscon0              ;map bewaren
     487     228   001F8 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     488     229   001FB C0B2                           push   port_page            ;pagina bewaren
     489     230   001FD 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     490     231   00200 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     491     232   00203 C287                           clr    sda                  ;data naar omlaag
     492     233   00205 1202D4                         lcall  delay10us
     493     234   00208 D283                           setb   scl                  ;klok naar 1
     494     235   0020A 1202D4                         lcall  delay10us            ;wachten
     495     236   0020D D287                           setb   sda                  ;idem data
     496     237   0020F 1202D4                         lcall  delay10us            ;
     497     238   00212 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     498     239   00215 D0B2                           pop    port_page            ;registers herstellen
     499     240   00217 D08F                           pop    syscon0
     500     241   00219 22                             ret
     501     242   0021A                  
     502     243   0021A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     503     244   0021A                  ;
     504     245   0021A                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     505     246   0021A                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     506     247   0021A                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     507     248   0021A                  ;
     508     249   0021A                  ; Gebruikt:
     509     250   0021A                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     510     251   0021A                  ;      cy=ack bit vanuit de slave
     511     252   0021A                  ;
     512     253   0021A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     513     254   0021A                  
     514     255   0021A C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     515     256   0021C C0F0                           push   b                    ;gebruikt als loopcounter
     516     257   0021E C08F                           push   syscon0              ;map juist zetten
     517     258   00220 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     518     259   00223 C0B2                           push   port_page            ;poort pagina bewaren
     519     260   00225 75B200                         mov    port_page,#000h      ;basispagina selecteren
     520     261   00228 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     521     262   0022B 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     522     263   0022E 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     523     264   0022F 9287                           mov    sda,c                ;op pin
     524     265   00231 1202D4                         lcall  delay10us            ;wachten
     525     266   00234 D283                           setb   scl                  ;puls genereren
     526     267   00236 1202D4                         lcall  delay10us            ;ook hier wat tijd laten
     527     268   00239 C283                           clr    scl                  ;klok terug laag maken
     528     269   0023B D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     529     270   0023E                  
     530     271   0023E                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     531     272   0023E                  
     532     273   0023E 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     533     274   00241 1202D4                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     534     275   00244 D283                           setb   scl                  ;puls terug hoog
     535     276   00246 A287                           mov    c,sda                ;inlezen en naar carry
     536     277   00248 1202D4                         lcall  delay10us
     537     278   0024B C283                           clr    scl                  ;klok blijft laag achter
     538     279   0024D D0B2                           pop    port_page
     539     280   0024F D08F                           pop    syscon0
     540     281   00251 D0F0                           pop    b
     541     282   00253 D0E0                           pop    acc
     542     283   00255 22                             ret
     543     284   00256                  
     544     285   00256                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     545     286   00256                  ;
     546     287   00256                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     547     288   00256                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     548     289   00256                  ;
     549     290   00256                  ; Gebruikt:
     550     291   00256                  ;      -de accu als output
     551     292   00256                  ;
     552     293   00256                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     553     294   00256                  
     554     295   00256 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     555     296   00258 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     556     297   0025B C0B2                           push   port_page            ;pagina bewaren
     557     298   0025D 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     558     299   00260 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     559     300   00262 C0D0                           push   psw                  ;vlaggen bewaren
     560     301   00264 75F008                         mov    b,#008h              ;loopcounter laden
     561     302   00267 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     562     303   0026A 1202D4           iicinbyteack1:lcall  delay10us
     563     304   0026D D283                           setb   scl                  ;klok hoog
     564     305   0026F A287                           mov    c,sda                ;pin inlezen
     565     306   00271 33                             rlc    a                    ;in accu shiften
     566     307   00272 1202D4                         lcall  delay10us
     567     308   00275 C283                           clr    scl                  ;klok terug laag
     568     309   00277 D5F0F0                         djnz   b,iicinbyteack1
     569     310   0027A 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     570     311   0027D C287                           clr    sda                  ;ack genereren
     571     312   0027F 1202D4                         lcall  delay10us
     572     313   00282 D283                           setb   scl
     573     314   00284 1202D4                         lcall  delay10us
     574     315   00287 C283                           clr    scl
     575     316   00289 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     576     317   0028C D0D0                           pop    psw                  ;registers herstellen
     577     318   0028E D0F0                           pop    b
     578     319   00290 D0B2                           pop    port_page
     579     320   00292 D08F                           pop    syscon0
     580     321   00294 22                             ret
     581     322   00295                  
     582     323   00295                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     583     324   00295                  ;
     584     325   00295                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     585     326   00295                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     586     327   00295                  ;
     587     328   00295                  ; Gebruikt:
     588     329   00295                  ;      -de accu als output
     589     330   00295                  ;
     590     331   00295                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     591     332   00295                  
     592     333   00295 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     593     334   00297 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     594     335   0029A C0B2                           push   port_page            ;pagina bewaren
     595     336   0029C 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     596     337   0029F C0F0                           push   b                    ;wordt gebruikt als loopcounter
     597     338   002A1 C0D0                           push   psw                  ;vlaggen bewaren
     598     339   002A3 75F008                         mov    b,#008h              ;loopcounter laden
     599     340   002A6 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     600     341   002A9 1202D4           iicinbytenack1:lcall  delay10us
     601     342   002AC D283                           setb   scl                  ;klok hoog
     602     343   002AE A287                           mov    c,sda                ;pin inlezen
     603     344   002B0 33                             rlc    a                    ;in accu shiften
     604     345   002B1 1202D4                         lcall  delay10us
     605     346   002B4 C283                           clr    scl                  ;klok terug laag
     606     347   002B6 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     607     348   002B9 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     608     349   002BC D287                           setb   sda                  ;nack genereren
     609     350   002BE 1202D4                         lcall  delay10us
     610     351   002C1 D283                           setb   scl
     611     352   002C3 1202D4                         lcall  delay10us
     612     353   002C6 C283                           clr    scl
     613     354   002C8 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     614     355   002CB D0D0                           pop    psw                  ;registers herstellen
     615     356   002CD D0F0                           pop    b
     616     357   002CF D0B2                           pop    port_page
     617     358   002D1 D08F                           pop    syscon0
     618     359   002D3 22                             ret
     619     360   002D4                  
     620     361   002D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     621     362   002D4                  ;
     622     363   002D4                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     623     364   002D4                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     624     365   002D4                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     625     366   002D4                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     626     367   002D4                  ;
     627     368   002D4                  ; Gebruikt geen registers
     628     369   002D4                  ;
     629     370   002D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     630     371   002D4                  
     631     372   002D4 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     632     373   002D6 C0D0                           push   psw                  ;8*42ns=330ns
     633     374   002D8 75E01A                         mov    acc,#01ah            ;420ns
     634     375   002DB D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     635     376   002DE D0D0                           pop    psw                  ;8*42ns=330ns
     636     377   002E0 D0E0                           pop    acc                  ;8*42ns=330ns
     637     378   002E2 22                             ret                         ;165ns
     638     379   002E3                  
     639     380   002E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     640     381   002E3                  ;
     641     382   002E3                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     642     383   002E3                  ;
     643     384   002E3                  ; Gebruikt geen registers
     644     385   002E3                  ;
     645     386   002E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     646     387   002E3                  
     647     388   002E3 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     648     389   002E5 C0D0                           push   psw
     649     390   002E7 C0F0                           push   b
     650     391   002E9 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     651     392   002EC 1202FC           delaya0k05s1: lcall  delay1ms
     652     393   002EF D5F0FA                         djnz   b,delaya0k05s1
     653     394   002F2 D5E0F4                         djnz   acc,delaya0k05s2
     654     395   002F5 D0F0                           pop    b                    ;registers herstellen
     655     396   002F7 D0D0                           pop    psw
     656     397   002F9 D0E0                           pop    acc
     657     398   002FB 22                             ret
     658     399   002FC                  
     659     400   002FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     660     401   002FC                  ;
     661     402   002FC                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     662     403   002FC                  ;
     663     404   002FC                  ; Gebruikt geen registers
     664     405   002FC                  ;
     665     406   002FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     666     407   002FC                  
     667     408   002FC C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     668     409   002FE C0D0                           push   psw                  ;8*42ns=330ns
     669     410   00300 75E064                         mov    acc,#100             ;420ns
     670     411   00303 1202D4           delay1ms1:    lcall  delay10us            ;10us
     671     412   00306 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     672     413   00309 D0D0                           pop    psw                  ;8*42ns=330ns
     673     414   0030B D0E0                           pop    acc                  ;8*42ns=330ns
     674     415   0030D 22                             ret                         ;165ns
     675     416   0030E                  
     676     417   0030E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     677     418   0030E                  ;
     678     419   0030E                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     679     420   0030E                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     680     421   0030E                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     681     422   0030E                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     682     423   0030E                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     683     424   0030E                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     684     425   0030E                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     685     426   0030E                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     686     427   0030E                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     687     428   0030E                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     688     429   0030E                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     689     430   0030E                  ; systemen!!!!
     690     431   0030E                  ;
     691     432   0030E                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     692     433   0030E                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     693     434   0030E                  ;       aduclcd0.inc
     694     435   0030E                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     695     436   0030E                  ;       aduclcd1.inc
     696     437   0030E                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     697     438   0030E                  ;
     698     439   0030E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     699     440   0030E                  
     700     441   0030E                  e             bit    b.1                  ;enable
     701     442   0030E                  rs            bit    b.0                  ;register select
     702     443   0030E                  backlight     bit    b.6                  ;bit waar backlight op zit
     703     444   0030E                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     704     445   0030E                  
     705     446   0030E                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     706     447   0030E                  
     707     448   0030E                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     708     449   0030E                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     709     450   0030E                  
     710     451   0030E                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     711     452   0030E                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     712     453   0030E                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     713     454   0030E                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     714     455   0030E                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     715     456   0030E                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     716     457   0030E                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     717     458   0030E                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     718     459   0030E                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     719     460   0030E                  
     720     461   0030E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     721     462   0030E                  ;
     722     463   0030E                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     723     464   0030E                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     724     465   0030E                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     725     466   0030E                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     726     467   0030E                  ;
     727     468   0030E                  ; registergebruik: geen
     728     469   0030E                  ;
     729     470   0030E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     730     471   0030E                  
     731     472   0030E C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     732     473   00310 C0D0                           push   psw
     733     474   00312 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     734     475   00314 1201B0                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     735     476   00317 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     736     477   0031A                                                            ;buzzer en baklight worden nu op 1 gezet
     737     478   0031A 1204B2                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     738     479   0031D 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     739     480   0031F 1204AB           initlcd1:     lcall  delay2ms
     740     481   00322 D5E0FA                         djnz   acc,initlcd1
     741     482   00325 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     742     483   00327 12046A                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     743     484   0032A 1204AB                         lcall  delay2ms      ;te krijgen.
     744     485   0032D 7430                           mov    a,#00110000b
     745     486   0032F 12046A                         lcall  outhnibc
     746     487   00332 1204AB                         lcall  delay2ms
     747     488   00335 7430                           mov    a,#00110000b
     748     489   00337 12046A                         lcall  outhnibc
     749     490   0033A 1204AB                         lcall  delay2ms
     750     491   0033D 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     751     492   0033F 12046A                         lcall  outhnibc      ;hoge nibble naar het controleregister
     752     493   00342 1204AB                         lcall  delay2ms      ;niet nodig volgens datasheet
     753     494   00345 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     754     495   00347 120454                         lcall  outc          ;naar display
     755     496   0034A 1204AB                         lcall  delay2ms      ;is iets te lang volgens datasheet
     756     497   0034D 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     757     498   0034F 120454                         lcall  outc
     758     499   00352 1204AB                         lcall  delay2ms      ;ook deze delay is iets te lang
     759     500   00355 7401                           mov    a,#displayon  ;clear display and home cursor
     760     501   00357 120454                         lcall  outc
     761     502   0035A 1204AB                         lcall  delay2ms      ;deze wachttijd is bijna juist
     762     503   0035D 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     763     504   0035F 120454                         lcall  outc
     764     505   00362 1204AB                         lcall  delay2ms      ;wachten weer veel te lang
     765     506   00365 D0F0                           pop    b             ;registers terug in orde zetten
     766     507   00367 D0D0                           pop    psw
     767     508   00369 D0E0                           pop    acc
     768     509   0036B 22                             ret                  ;einde van de initialisatie
     769     510   0036C                  
     770     511   0036C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     771     512   0036C                  ;
     772     513   0036C                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     773     514   0036C                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     774     515   0036C                  ;      00dh   =cursor in de home positie
     775     516   0036C                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     776     517   0036C                  ;      00ah   =cursor op tweede lijn plaatsen
     777     518   0036C                  ;      001h   =cursor on blink
     778     519   0036C                  ;      002h   =cursor on, no blink
     779     520   0036C                  ;      003h   =cursor off
     780     521   0036C                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     781     522   0036C                  ;
     782     523   0036C                  ; de routine gebruikt geen registers
     783     524   0036C                  ;
     784     525   0036C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     785     526   0036C                  
     786     527   0036C                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     787     528   0036C                  ; dan mag de data direct naar het dataregister van het scherm.
     788     529   0036C                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     789     530   0036C                  
     790     531   0036C                  lcdoutchar:
     791     532   0036C C0E0             outcharlcd:   push   acc           ;registers op stack
     792     533   0036E C0D0                           push   psw
     793     534   00370 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     794     535   00373 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     795     536   00375 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     796     537   00378 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     797     538   0037A                  
     798     539   0037A                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     799     540   0037A                  ; Het is dus een opdracht die we moeten uitvoeren.
     800     541   0037A                  
     801     542   0037A B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     802     543   0037D 7401                           mov    a,#cleardisp         ;scherm leegmaken
     803     544   0037F 120454                         lcall  outc                 ;naar controleregister
     804     545   00382 803A                           sjmp   outcharlcde          ;afsluiten
     805     546   00384                  
     806     547   00384 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     807     548   00387 740F                           mov    a,#cursoronb         ;cursoron met blink
     808     549   00389 120454                         lcall  outc
     809     550   0038C 8030                           sjmp   outcharlcde
     810     551   0038E                  
     811     552   0038E B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     812     553   00391 740E                           mov    a,#cursoronn         ;cursoron no blink
     813     554   00393 120454                         lcall  outc
     814     555   00396 8026                           sjmp   outcharlcde
     815     556   00398                  
     816     557   00398 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     817     558   0039B 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     818     559   0039D 120454                         lcall  outc
     819     560   003A0 801C                           sjmp   outcharlcde
     820     561   003A2                  
     821     562   003A2 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     822     563   003A5 7402                           mov    a,#cursathom         ;cursor in home positie
     823     564   003A7 120454                         lcall  outc
     824     565   003AA 8012                           sjmp   outcharlcde
     825     566   003AC                  
     826     567   003AC B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     827     568   003AF                                                            ;tweede lijn
     828     569   003AF 74C0                           mov    a,#0c0h
     829     570   003B1 120454                         lcall  outc
     830     571   003B4 8008                           sjmp   outcharlcde
     831     572   003B6                  
     832     573   003B6                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     833     574   003B6                  ; is. dit mag naar het data register.
     834     575   003B6                  
     835     576   003B6 12041A           outcharlcd8:  lcall  outd          ;klaar
     836     577   003B9 8003                           sjmp   outcharlcde   ;einde routine
     837     578   003BB                  
     838     579   003BB                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     839     580   003BB                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     840     581   003BB                  ; te schrijven.
     841     582   003BB                  
     842     583   003BB 120454           outcharlcd9:  lcall  outc          ;klaar
     843     584   003BE D0D0             outcharlcde:  pop    psw           ;registers herstellen
     844     585   003C0 D0E0                           pop    acc
     845     586   003C2 22                             ret
     846     587   003C3                  
     847     588   003C3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     848     589   003C3                  ;
     849     590   003C3                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     850     591   003C3                  ; op het lcd scherm.
     851     592   003C3                  ;
     852     593   003C3                  ; de routine gebruikt geen registers
     853     594   003C3                  ;
     854     595   003C3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     855     596   003C3                  
     856     597   003C3                  lcdoutnib:
     857     598   003C3 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     858     599   003C5 C0D0                           push   psw
     859     600   003C7 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     860     601   003C9 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     861     602   003CB B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     862     603   003CE 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     863     604   003D0 2407                           add    a,#007h       ;omvormen naar hoofdletter
     864     605   003D2 12041A           outniblcde:   lcall  outd          ;naar het scherm
     865     606   003D5 D0D0                           pop    psw
     866     607   003D7 D0E0                           pop    acc
     867     608   003D9 22                             ret
     868     609   003DA                  
     869     610   003DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     870     611   003DA                  ;
     871     612   003DA                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     872     613   003DA                  ;
     873     614   003DA                  ; de routine gebruikt geen registers
     874     615   003DA                  ;
     875     616   003DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     876     617   003DA                  
     877     618   003DA                  lcdoutbyte:
     878     619   003DA C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     879     620   003DC C0D0                           push   psw
     880     621   003DE C4                             swap   a             ;bitjes omruilen
     881     622   003DF 1203C3                         lcall  outniblcd
     882     623   003E2 C4                             swap   a             ;nog eens
     883     624   003E3 1203C3                         lcall  outniblcd
     884     625   003E6 D0D0                           pop    psw
     885     626   003E8 D0E0                           pop    acc
     886     627   003EA 22                             ret
     887     628   003EB                  
     888     629   003EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     889     630   003EB                  ;
     890     631   003EB                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     891     632   003EB                  ;
     892     633   003EB                  ; de routine gebruikt geen registers
     893     634   003EB                  ;
     894     635   003EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     895     636   003EB                  
     896     637   003EB                  lcddispdptr:
     897     638   003EB C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     898     639   003ED C0D0                           push   psw
     899     640   003EF E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     900     641   003F1 1203DA                         lcall  outbytelcd
     901     642   003F4 E582                           mov    a,dpl         ;dan het lage deel
     902     643   003F6 1203DA                         lcall  outbytelcd
     903     644   003F9 D0D0                           pop    psw
     904     645   003FB D0E0                           pop    acc
     905     646   003FD 22                             ret
     906     647   003FE                  
     907     648   003FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     908     649   003FE                  ;
     909     650   003FE                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     910     651   003FE                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     911     652   003FE                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     912     653   003FE                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     913     654   003FE                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     914     655   003FE                  ;
     915     656   003FE                  ; de routine gebruikt geen registers
     916     657   003FE                  ;
     917     658   003FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     918     659   003FE                  
     919     660   003FE                  lcdoutmsga:
     920     661   003FE C0E0             outmsgalcd:   push   acc           ;registers op de stack
     921     662   00400 C0D0                           push   psw
     922     663   00402 C083                           push   dph           ;ook de data pointer
     923     664   00404 C082                           push   dpl
     924     665   00406                  
     925     666   00406                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     926     667   00406                  
     927     668   00406 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     928     669   00407 93                             movc   a,@a+dptr     ;waarde lezen
     929     670   00408 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     930     671   0040A                  
     931     672   0040A                  ; de code is niet 0 dus versturen met outchar
     932     673   0040A                  
     933     674   0040A 12036C                         lcall  outcharlcd    ;weg er mee
     934     675   0040D A3                             inc    dptr          ;naar volgende ascii code wijzen
     935     676   0040E 020406                         ljmp   outmsgalcd1   ;lus sluiten
     936     677   00411                  
     937     678   00411 D082             outmsgalcde:  pop    dpl           ;registers herstellen
     938     679   00413 D083                           pop    dph
     939     680   00415 D0D0                           pop    psw
     940     681   00417 D0E0                           pop    acc
     941     682   00419 22                             ret
     942     683   0041A                  
     943     684   0041A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     944     685   0041A                  ;
     945     686   0041A                  ; outd is een routine die naar het data register van het display een
     946     687   0041A                  ; volledige byte stuurt.
     947     688   0041A                  ;
     948     689   0041A                  ; De routine gebruikt geen registers.
     949     690   0041A                  ;
     950     691   0041A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     951     692   0041A                  
     952     693   0041A C0E0             outd:         push   acc           ;registers op stack zetten
     953     694   0041C C0D0                           push   psw
     954     695   0041E 12042A                         lcall  outhnibd      ;hoogste vier bits verzenden
     955     696   00421 C4                             swap   a             ;bitjes omruilen
     956     697   00422 12042A                         lcall  outhnibd      ;naar het scherm sturen
     957     698   00425 D0D0                           pop    psw           ;registers terug herstellen
     958     699   00427 D0E0                           pop    acc
     959     700   00429 22                             ret
     960     701   0042A                  
     961     702   0042A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     962     703   0042A                  ;
     963     704   0042A                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
     964     705   0042A                  ; lcd scherm.
     965     706   0042A                  ;
     966     707   0042A                  ; de routine gebruikt geen registers.
     967     708   0042A                  ;
     968     709   0042A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     969     710   0042A                  
     970     711   0042A C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
     971     712   0042C C0D0                           push   psw
     972     713   0042E C0F0                           push   b             ;werkregister
     973     714   00430 1204CB                         lcall  lcdtoport     ;lees de expander naar b register
     974     715   00433 D2F0                           setb   rs            ;controle lijn in orde
     975     716   00435 C2F1                           clr    e             ;deselectie display
     976     717   00437 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
     977     718   00439 03                             rr     a             ;bits op juiste plaats zetten
     978     719   0043A 03                             rr     a             ;voor b reg
     979     720   0043B 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
     980     721   0043E 42F0                           orl    b,a           ;bij elkaar voegen
     981     722   00440 1204B2                         lcall  porttolcd     ;naar expnder
     982     723   00443 D2F1                           setb   e             ;display enabelen
     983     724   00445 1204B2                         lcall  porttolcd
     984     725   00448 C2F1                           clr    e             ;display deselecteren
     985     726   0044A 1204B2                         lcall  porttolcd
     986     727   0044D D0F0                           pop    b
     987     728   0044F D0D0                           pop    psw           ;registers herstellen
     988     729   00451 D0E0                           pop    acc
     989     730   00453 22                             ret
     990     731   00454                  
     991     732   00454                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     992     733   00454                  ;
     993     734   00454                  ; outc is een routine die naar het controleregister van het display een
     994     735   00454                  ; volledige byte stuurt.
     995     736   00454                  ;
     996     737   00454                  ; De routine gebruikt geen registers.
     997     738   00454                  ;
     998     739   00454                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     999     740   00454                  
    1000     741   00454 C0E0             outc:         push   acc           ;registers op stack zetten
    1001     742   00456 C0D0                           push   psw
    1002     743   00458 12046A                         lcall  outhnibc      ;hoogste vier bits verzenden
    1003     744   0045B 1204AB                         lcall  delay2ms      ;niet echt nodig
    1004     745   0045E C4                             swap   a             ;bitjes omruilen
    1005     746   0045F 12046A                         lcall  outhnibc      ;naar het scherm sturen
    1006     747   00462 1204AB                         lcall  delay2ms      ;altijd goed voor traagste commando
    1007     748   00465 D0D0                           pop    psw           ;registers terug herstellen
    1008     749   00467 D0E0                           pop    acc
    1009     750   00469 22                             ret
    1010     751   0046A                  
    1011     752   0046A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1012     753   0046A                  ;
    1013     754   0046A                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1014     755   0046A                  ; lcd scherm.
    1015     756   0046A                  ;
    1016     757   0046A                  ; de routine gebruikt geen registers.
    1017     758   0046A                  ;
    1018     759   0046A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1019     760   0046A                  
    1020     761   0046A C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1021     762   0046C C0D0                           push   psw
    1022     763   0046E C0F0                           push   b             ;werkregister
    1023     764   00470 1204CB                         lcall  lcdtoport     ;lees de expander naar b register
    1024     765   00473 C2F0                           clr    rs            ;controle lijn in orde
    1025     766   00475 C2F1                           clr    e             ;deselectie display
    1026     767   00477 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1027     768   00479 03                             rr     a             ;bits op juiste plaats zetten
    1028     769   0047A 03                             rr     a             ;voor b reg
    1029     770   0047B 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1030     771   0047E 42F0                           orl    b,a           ;bij elkaar voegen
    1031     772   00480 1204B2                         lcall  porttolcd     ;naar expnder
    1032     773   00483 D2F1                           setb   e             ;display enabelen
    1033     774   00485 1204B2                         lcall  porttolcd
    1034     775   00488 C2F1                           clr    e             ;display deselecteren
    1035     776   0048A 1204B2                         lcall  porttolcd
    1036     777   0048D D0F0                           pop    b
    1037     778   0048F D0D0                           pop    psw           ;registers herstellen
    1038     779   00491 D0E0                           pop    acc
    1039     780   00493 22                             ret
    1040     781   00494                  
    1041     782   00494                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1042     783   00494                  ;
    1043     784   00494                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1044     785   00494                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1045     786   00494                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1046     787   00494                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1047     788   00494                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1048     789   00494                  ; DATA GESCHREVEN.
    1049     790   00494                  ;
    1050     791   00494                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1051     792   00494                  
    1052     793   00494 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1053     794   00496 120454           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1054     795   00499 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1055     796   0049B 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1056     797   0049C 12041A                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1057     798   0049F 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1058     799   004A2 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1059     800   004A3 80F4                           SJMP   BUILD3
    1060     801   004A5 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1061     802   004A7 120454                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1062     803   004AA 22                             RET                  ;EINDE VAN DE ROUTINE
    1063     804   004AB                  
    1064     805   004AB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1065     806   004AB                  ;
    1066     807   004AB                  ; Delay2ms is een vertragingsroutine van 2ms.
    1067     808   004AB                  ;
    1068     809   004AB                  ; De routine gebruikt geen registers.
    1069     810   004AB                  ;
    1070     811   004AB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1071     812   004AB                  
    1072     813   004AB 1202FC           delay2ms:     lcall  delay1ms
    1073     814   004AE 1202FC                         lcall  delay1ms
    1074     815   004B1 22                             ret
    1075     816   004B2                  
    1076     817   004B2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1077     818   004B2                  ;
    1078     819   004B2                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1079     820   004B2                  ; scherm stuurt via de port expander.
    1080     821   004B2                  ;
    1081     822   004B2                  ; Gebruikt geen registers
    1082     823   004B2                  ;
    1083     824   004B2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1084     825   004B2                  
    1085     826   004B2 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1086     827   004B4 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1087     828   004B6 1201D3                         lcall  iicstart      ;vertrokken
    1088     829   004B9 7440                           mov    a,#01000000b  ;schrijven naar expander
    1089     830   004BB 12021A                         lcall  iicoutbyte    ;weg er mee
    1090     831   004BE E5F0                           mov    a,b           ;data verzenden
    1091     832   004C0 12021A                         lcall  iicoutbyte
    1092     833   004C3 1201F6                         lcall  iicstop       ;transactie sluiten
    1093     834   004C6 D0D0                           pop    psw
    1094     835   004C8 D0E0                           pop    acc
    1095     836   004CA 22                             ret
    1096     837   004CB                  
    1097     838   004CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1098     839   004CB                  ;
    1099     840   004CB                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1100     841   004CB                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1101     842   004CB                  ; van buzzet en backlight is.
    1102     843   004CB                  ;
    1103     844   004CB                  ; Gebruikt b register
    1104     845   004CB                  ;
    1105     846   004CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1106     847   004CB                  
    1107     848   004CB C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1108     849   004CD C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1109     850   004CF 1201D3                         lcall  iicstart      ;vertrokken
    1110     851   004D2 7441                           mov    a,#01000001b  ;lezen van expander
    1111     852   004D4 12021A                         lcall  iicoutbyte    ;weg er mee
    1112     853   004D7 120295                         lcall  iicinbytenack ;data inlezen
    1113     854   004DA 1201F6                         lcall  iicstop
    1114     855   004DD F5F0                           mov    b,a
    1115     856   004DF D0D0                           pop    psw
    1116     857   004E1 D0E0                           pop    acc
    1117     858   004E3 22                             ret
    1118     859   004E4                  
    1119     860   004E4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1120     861   004E4                  ;
    1121     862   004E4                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1122     863   004E4                  ;
    1123     864   004E4                  ; Gebruikt geen registers
    1124     865   004E4                  ;
    1125     866   004E4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1126     867   004E4                  
    1127     868   004E4 C0F0             lcdlighton:   push   b
    1128     869   004E6 1204CB                         lcall  lcdtoport     ;expander lezen
    1129     870   004E9 C2F6                           clr    b.6           ;licht aan doen
    1130     871   004EB 1204B2                         lcall  porttolcd     ;expander scrijven
    1131     872   004EE D0F0                           pop    b
    1132     873   004F0 22                             ret
    1133     874   004F1                  
    1134     875   004F1                  
    1135     876   004F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1136     877   004F1                  ;
    1137     878   004F1                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1138     879   004F1                  ;
    1139     880   004F1                  ; Gebruikt geen registers
    1140     881   004F1                  ;
    1141     882   004F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1142     883   004F1                  
    1143     884   004F1 C0F0             lcdlightoff:  push   b
    1144     885   004F3 1204CB                         lcall  lcdtoport     ;expander lezen
    1145     886   004F6 D2F6                           setb   b.6           ;licht uit doen
    1146     887   004F8 1204B2                         lcall  porttolcd     ;expander scrijven
    1147     888   004FB D0F0                           pop    b
    1148     889   004FD 22                             ret
    1149     890   004FE                  
    1150     891   004FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1151     892   004FE                  ;
    1152     893   004FE                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1153     894   004FE                  ;
    1154     895   004FE                  ; Gebruikt geen registers
    1155     896   004FE                  ;
    1156     897   004FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1157     898   004FE                  
    1158     899   004FE C0F0             lcdbuzon:     push   b
    1159     900   00500 1204CB                         lcall  lcdtoport     ;expander lezen
    1160     901   00503 C2F7                           clr    b.7           ;buzzer aan doen
    1161     902   00505 1204B2                         lcall  porttolcd     ;expander scrijven
    1162     903   00508 D0F0                           pop    b
    1163     904   0050A 22                             ret
    1164     905   0050B                  
    1165     906   0050B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1166     907   0050B                  ;
    1167     908   0050B                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1168     909   0050B                  ;
    1169     910   0050B                  ; Gebruikt geen registers
    1170     911   0050B                  ;
    1171     912   0050B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1172     913   0050B                  
    1173     914   0050B C0F0             lcdbuzoff:    push   b
    1174     915   0050D 1204CB                         lcall  lcdtoport     ;expander lezen
    1175     916   00510 D2F7                           setb   b.7           ;buzzer aan doen
    1176     917   00512 1204B2                         lcall  porttolcd     ;expander scrijven
    1177     918   00515 D0F0                           pop    b
    1178     919   00517 22                             ret
    1179     920   00518                  
    1180     921   00518                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1181     922   00518                  ;
    1182     923   00518                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1183     924   00518                  ; een standaard com poort op 9600 baud.
    1184     925   00518                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1185     926   00518                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1186     927   00518                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1187     928   00518                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1188     929   00518                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1189     930   00518                  ; NIET door deze routine.
    1190     931   00518                  ;
    1191     932   00518                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1192     933   00518                  ;
    1193     934   00518                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1194     935   00518                  
    1195     936   00518                  blank         equ    020h          ;ascii code voor een blank
    1196     937   00518                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1197     938   00518                  ff            equ    00ch          ;ascii code voor nieuw blad
    1198     939   00518                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1199     940   00518                  lf            equ    00ah          ;ascii code voor volgende lijn
    1200     941   00518                  backsp        equ    008h          ;ascii code voor het bs karakter
    1201     942   00518                  beep          equ    007h          ;ascii code voor een beep
    1202     943   00518                  
    1203     944   00518 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1204     945   0051C                                                                          ;van het scherm
    1205     946   0051C                  
    1206     947   0051C                  strtbuf       equ     054h         ;start adres van de buffer
    1207     948   0051C                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1208     949   0051C                  
    1209     950   0051C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1210     951   0051C                  ;
    1211     952   0051C                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1212     953   0051C                  ;
    1213     954   0051C                  ; Gebruikt geen registers
    1214     955   0051C                  ;
    1215     956   0051C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1216     957   0051C                  
    1217     958   0051C C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1218     959   0051E C08F                           push   syscon0              ;map bewaren
    1219     960   00520 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1220     961   00523 C0B2                           push   port_page            ;pagina op stack zetten
    1221     962   00525 C0BF                           push   scu_page
    1222     963   00527 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1223     964   0052A                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1224     965   0052A                  ;      -p1.0 als input en alt1 selectie
    1225     966   0052A                  ;      -p1.1 als output en alt2 selectie
    1226     967   0052A                  
    1227     968   0052A 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1228     969   0052D 5390FD                         anl    p1_altsel0,#11111101b
    1229     970   00530 439001                         orl    p1_altsel0,#00000001b
    1230     971   00533 5391FE                         anl    p1_altsel1,#11111110b
    1231     972   00536 439102                         orl    p1_altsel1,#00000010b
    1232     973   00539 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1233     974   0053C 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1234     975   0053F 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1235     976   00542                  
    1236     977   00542                  ; Nu moet de baud rate generator ingesteld worden
    1237     978   00542                  ; We gaan er van uit dat de systeemklok 24MHz is
    1238     979   00542                  
    1239     980   00542 759850                         mov    scon,#01010000b      ;UART initialiseren
    1240     981   00545                  
    1241     982   00545                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1242     983   00545                  ; gebruikt!!
    1243     984   00545                  
    1244     985   00545 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1245     986   00548 75BD11                         mov    bcon,#00010001b
    1246     987   0054B D0BF                           pop    scu_page
    1247     988   0054D D0B2                           pop    port_page            ;alles terug herstellen
    1248     989   0054F D08F                           pop    syscon0
    1249     990   00551 D0E0                           pop    acc
    1250     991   00553 22                             ret
    1251     992   00554                  
    1252     993   00554                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1253     994   00554                  ;
    1254     995   00554                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1255     996   00554                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1256     997   00554                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1257     998   00554                  ;
    1258     999   00554                  ; de routine gebruikt geen registers.
    1259    1000   00554                  ;
    1260    1001   00554                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1261    1002   00554                  
    1262    1003   00554                  siooutchar:
    1263    1004   00554 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1264    1005   00556 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1265    1006   00559 C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1266    1007   0055B 22                             RET
    1267    1008   0055C                  
    1268    1009   0055C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1269    1010   0055C                  ;
    1270    1011   0055C                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1271    1012   0055C                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1272    1013   0055C                  ;
    1273    1014   0055C                  ; de routine gebruikt geen registers.
    1274    1015   0055C                  ;
    1275    1016   0055C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1276    1017   0055C                  
    1277    1018   0055C                  siooutnib:
    1278    1019   0055C C0E0             OUTNIB:       push   acc           ;registers op de stack
    1279    1020   0055E C0D0                           push   psw
    1280    1021   00560 540F                           ANL    A,#00FH       ;AFZONDEREN
    1281    1022   00562 12064C                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1282    1023   00565 120554                         LCALL  OUTCHAR       ;VERSTUREN
    1283    1024   00568 1205B5                         LCALL  XONXOFF       ;FLOW CONTROL
    1284    1025   0056B D0D0                           pop    psw           ;registers herstellen
    1285    1026   0056D D0E0                           pop    acc
    1286    1027   0056F 22                             RET
    1287    1028   00570                  
    1288    1029   00570                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1289    1030   00570                  ;
    1290    1031   00570                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1291    1032   00570                  ; WORDT XONXOFF GEBRUIKT.
    1292    1033   00570                  ;
    1293    1034   00570                  ; de routine gebruikt geen registers.
    1294    1035   00570                  ;
    1295    1036   00570                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1296    1037   00570                  
    1297    1038   00570                  siooutbyte:
    1298    1039   00570 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1299    1040   00572 C0D0                           push   psw
    1300    1041   00574 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1301    1042   00576 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1302    1043   00577 12055C                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1303    1044   0057A D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1304    1045   0057C 12055C                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1305    1046   0057F D0D0                           pop    psw           ;registers herstellen
    1306    1047   00581 D0E0                           pop    acc
    1307    1048   00583 22                             RET
    1308    1049   00584                  
    1309    1050   00584                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1310    1051   00584                  ;
    1311    1052   00584                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1312    1053   00584                  ; VAN DE CURSOR.
    1313    1054   00584                  ;
    1314    1055   00584                  ; de routine gebruikt geen registers.
    1315    1056   00584                  ;
    1316    1057   00584                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1317    1058   00584                  
    1318    1059   00584                  siodispdptr:
    1319    1060   00584 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1320    1061   00586 C0D0                           push   psw
    1321    1062   00588 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1322    1063   0058A 120570                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1323    1064   0058D E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1324    1065   0058F 120570                         LCALL  OUTBYTE       ;WEG ER MEE
    1325    1066   00592 D0D0                           pop    psw           ;registers herstellen
    1326    1067   00594 D0E0                           pop    acc
    1327    1068   00596 22                             RET                  ;EINDE
    1328    1069   00597                  
    1329    1070   00597                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1330    1071   00597                  ;
    1331    1072   00597                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1332    1073   00597                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1333    1074   00597                  ;
    1334    1075   00597                  ; de routine gebruikt geen registers.
    1335    1076   00597                  ;
    1336    1077   00597                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1337    1078   00597                  
    1338    1079   00597                  siooutmsga:
    1339    1080   00597 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1340    1081   00599 C0D0                           push   psw
    1341    1082   0059B C082                           push   dpl
    1342    1083   0059D C083                           push   dph
    1343    1084   0059F E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1344    1085   005A0 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1345    1086   005A1 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1346    1087   005A3 120554                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1347    1088   005A6 1205B5                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1348    1089   005A9 A3                             INC    DPTR          ;DPTR AANPASSEN
    1349    1090   005AA 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1350    1091   005AC D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1351    1092   005AE D082                           pop    dpl
    1352    1093   005B0 D0D0                           pop    psw
    1353    1094   005B2 D0E0                           pop    acc
    1354    1095   005B4 22                             RET                  ;EINDE ROUTINE
    1355    1096   005B5                  
    1356    1097   005B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1357    1098   005B5                  ;
    1358    1099   005B5                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1359    1100   005B5                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1360    1101   005B5                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1361    1102   005B5                  ; VERDER DOORGEGEVEN.
    1362    1103   005B5                  ;
    1363    1104   005B5                  ; de routine gebruikt geen registers.
    1364    1105   005B5                  ;
    1365    1106   005B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1366    1107   005B5                  
    1367    1108   005B5 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1368    1109   005B7 C0D0                           push   psw
    1369    1110   005B9 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1370    1111   005BC D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1371    1112   005BE D0E0                           pop    acc
    1372    1113   005C0 22                             RET                  ;ANDERS EINDE
    1373    1114   005C1 E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1374    1115   005C3 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1375    1116   005C6 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1376    1117   005C9 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1377    1118   005CB                  
    1378    1119   005CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1379    1120   005CB                  ;
    1380    1121   005CB                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1381    1122   005CB                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1382    1123   005CB                  ;
    1383    1124   005CB                  ; de routine gebruikt de accu.
    1384    1125   005CB                  ;
    1385    1126   005CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1386    1127   005CB                  
    1387    1128   005CB                  sioinchar:
    1388    1129   005CB 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1389    1130   005CE C298                           CLR    RI                   ;BIT LAAG MAKEN
    1390    1131   005D0 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1391    1132   005D2 22                             RET
    1392    1133   005D3                  
    1393    1134   005D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1394    1135   005D3                  ;
    1395    1136   005D3                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1396    1137   005D3                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1397    1138   005D3                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1398    1139   005D3                  ; DE CARRY OP 1 GEZET WORDEN.
    1399    1140   005D3                  ;
    1400    1141   005D3                  ; De routine gebruikt de accu, r0 en de psw.
    1401    1142   005D3                  ;
    1402    1143   005D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1403    1144   005D3                  
    1404    1145   005D3                  sioinbyte:
    1405    1146   005D3 1205CB           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1406    1147   005D6 12063F                         LCALL  LOWUPTR
    1407    1148   005D9 120656                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1408    1149   005DC 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1409    1150   005DE C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1410    1151   005DF F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1411    1152   005E0 1205CB                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1412    1153   005E3 12063F                         LCALL  LOWUPTR
    1413    1154   005E6 120656                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1414    1155   005E9 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1415    1156   005EB 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1416    1157   005EC 22               INBYTE1:      RET
    1417    1158   005ED                  
    1418    1159   005ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1419    1160   005ED                  ;
    1420    1161   005ED                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1421    1162   005ED                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1422    1163   005ED                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1423    1164   005ED                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1424    1165   005ED                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1425    1166   005ED                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1426    1167   005ED                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1427    1168   005ED                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1428    1169   005ED                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1429    1170   005ED                  ; bepalen.
    1430    1171   005ED                  ;
    1431    1172   005ED                  ; De routine gebruikt de accu, r0 en de psw.
    1432    1173   005ED                  ;
    1433    1174   005ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1434    1175   005ED                  
    1435    1176   005ED                  sioinbufa:
    1436    1177   005ED 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1437    1178   005EF 1205CB           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1438    1179   005F2 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1439    1180   005F4                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1440    1181   005F4                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1441    1182   005F4                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1442    1183   005F4                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1443    1184   005F4                  ; GEVOERD.
    1444    1185   005F4 12063F                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1445    1186   005F7 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1446    1187   005FA F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1447    1188   005FB 22                             RET                         ;EINDE VAN DE ROUTINE
    1448    1189   005FC B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1449    1190   005FF B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1450    1191   00602 7407             INBUFA4:      MOV    A,#BEEP
    1451    1192   00604 120554           INBUFA7:      LCALL  OUTCHAR
    1452    1193   00607 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1453    1194   00609 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1454    1195   0060A 900518                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1455    1196   0060D 120597                         LCALL  OUTMSGA
    1456    1197   00610 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1457    1198   00612 120631           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1458    1199   00615 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1459    1200   00617 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1460    1201   0061A 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1461    1202   0061C F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1462    1203   0061D 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1463    1204   0061E 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1464    1205   00620                  
    1465    1206   00620                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1466    1207   00620                  ;
    1467    1208   00620                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1468    1209   00620                  ;
    1469    1210   00620                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1470    1211   00620                  ;
    1471    1212   00620                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1472    1213   00620                  
    1473    1214   00620 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1474    1215   00622 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1475    1216   00624 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1476    1217   00625 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1477    1218   00628 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1478    1219   00629 B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1479    1220   0062C 22                             RET                         ;EINDE VAN DE ROUTINE
    1480    1221   0062D F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1481    1222   0062E 09                             INC    R1
    1482    1223   0062F 80F7                           SJMP   BDELETE3
    1483    1224   00631                  
    1484    1225   00631                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1485    1226   00631                  ;
    1486    1227   00631                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1487    1228   00631                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1488    1229   00631                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1489    1230   00631                  ; AANZIEN.
    1490    1231   00631                  ;
    1491    1232   00631                  ; De routine gebruikt de accu en de psw.
    1492    1233   00631                  ;
    1493    1234   00631                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1494    1235   00631                  
    1495    1236   00631 B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1496    1237   00634 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1497    1238   00636 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1498    1239   00639 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1499    1240   0063B C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1500    1241   0063C 22                             RET
    1501    1242   0063D D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1502    1243   0063E 22                             RET
    1503    1244   0063F                  
    1504    1245   0063F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1505    1246   0063F                  ;
    1506    1247   0063F                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1507    1248   0063F                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1508    1249   0063F                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1509    1250   0063F                  ; AANGEPAST WORDEN.
    1510    1251   0063F                  ;
    1511    1252   0063F                  ; De routine gebruikt de accu en de psw.
    1512    1253   0063F                  ;
    1513    1254   0063F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1514    1255   0063F                  
    1515    1256   0063F B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1516    1257   00642 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1517    1258   00644 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1518    1259   00647 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1519    1260   00649 9420                           SUBB   A,#020H              ;OMZETTING
    1520    1261   0064B 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1521    1262   0064C                  
    1522    1263   0064C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1523    1264   0064C                  ;
    1524    1265   0064C                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1525    1266   0064C                  ; ASCII CODE.
    1526    1267   0064C                  ;
    1527    1268   0064C                  ; De routine gebruikt de accu en de psw.
    1528    1269   0064C                  ;
    1529    1270   0064C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1530    1271   0064C                  
    1531    1272   0064C B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1532    1273   0064F 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1533    1274   00651 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1534    1275   00653 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1535    1276   00655 22                             RET
    1536    1277   00656                  
    1537    1278   00656                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1538    1279   00656                  ;
    1539    1280   00656                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1540    1281   00656                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1541    1282   00656                  ; GEVAL WORDT DE CARRY GEZET.
    1542    1283   00656                  ;
    1543    1284   00656                  ; De routine gebruikt de accu en de psw.
    1544    1285   00656                  ;
    1545    1286   00656                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1546    1287   00656                  
    1547    1288   00656 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1548    1289   00657 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1549    1290   00659 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1550    1291   0065B B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1551    1292   0065E 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1552    1293   00660 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1553    1294   00662 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1554    1295   00664 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1555    1296   00667 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1556    1297   00668 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1557    1298   0066A C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1558    1299   0066B 22               ASCBINTRANS1: RET
    1559    1300   0066C                  
    1560    1301   0066C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1561    1302   0066C                  ;
    1562    1303   0066C                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1563    1304   0066C                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1564    1305   0066C                  ;
    1565    1306   0066C                  ; De routine gebruikt de accu en de psw.
    1566    1307   0066C                  ;
    1567    1308   0066C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1568    1309   0066C                  
    1569    1310   0066C E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1570    1311   0066D 120656                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1571    1312   00670 22                             RET                         ;EINDE OMZETTING
    1572    1313   00671                  
    1573    1314   00671                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1574    1315   00671                  ;
    1575    1316   00671                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1576    1317   00671                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1577    1318   00671                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1578    1319   00671                  ;
    1579    1320   00671                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1580    1321   00671                  ;
    1581    1322   00671                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1582    1323   00671                  
    1583    1324   00671 12066C           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1584    1325   00674 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1585    1326   00676 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1586    1327   00677 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1587    1328   00678 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1588    1329   00679 12066C                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1589    1330   0067C 4001                           JC     ASCII21               ;WEG ALS C=1
    1590    1331   0067E 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1591    1332   0067F 22               ASCII21:      RET
    1592    1333   00680                  
    1593    1334   00680                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1594    1335   00680                  ;
    1595    1336   00680                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1596    1337   00680                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1597    1338   00680                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1598    1339   00680                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1599    1340   00680                  ;
    1600    1341   00680                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1601    1342   00680                  ;
    1602    1343   00680                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1603    1344   00680                  
    1604    1345   00680 120671           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1605    1346   00683 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1606    1347   00685 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1607    1348   00687 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1608    1349   00688 120671                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1609    1350   0068B 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1610    1351   0068D F582                           MOV    DPL,A                ;IN DPTR LADEN
    1611    1352   0068F 22               ASCII41:      RET
    1612    1353   00690                  
    1613    1354   00690                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1614    1355   00690                  ;
    1615    1356   00690                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1616    1357   00690                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1617    1358   00690                  ; geschakeld worden.
    1618    1359   00690                  ;
    1619    1360   00690                  ; Gebruikt geen registers
    1620    1361   00690                  ;
    1621    1362   00690                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1622    1363   00690                  
    1623    1364   00690 C08F             initadc:      push   syscon0                     ;map saven
    1624    1365   00692 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1625    1366   00695 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1626    1367   00698 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1627    1368   0069B                                                                   ;klok delen door 32 (750kHz)
    1628    1369   0069B                                                                   ;10 bit uitkomst
    1629    1370   0069B 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1630    1371   0069E                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1631    1372   0069E 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1632    1373   006A1 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1633    1374   006A4 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1634    1375   006A7 D08F                           pop    syscon0                     ;herstellen syscon
    1635    1376   006A9 22                             ret
    1636    1377   006AA                  
    1637    1378   006AA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1638    1379   006AA                  ;
    1639    1380   006AA                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1640    1381   006AA                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1641    1382   006AA                  ;
    1642    1383   006AA                  ; Gebruikt:
    1643    1384   006AA                  ;      -accu als 8 msb meting
    1644    1385   006AA                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1645    1386   006AA                  ;
    1646    1387   006AA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1647    1388   006AA                  
    1648    1389   006AA C08F             adclm335:     push   syscon0
    1649    1390   006AC 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1650    1391   006AF 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1651    1392   006B2 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1652    1393   006B5 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1653    1394   006B8 00               		nop
    1654    1395   006B9 00               		nop					;anders loopt het mis met het testen van de ready bit
    1655    1396   006BA E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1656    1397   006BC 20E0FB                         jb     acc.0,adclm3351
    1657    1398   006BF 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1658    1399   006C2 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1659    1400   006C4 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1660    1401   006C7 D08F                           pop    syscon0
    1661    1402   006C9 22                             ret
    1662    1403   006CA                  
    1663    1404   006CA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1664    1405   006CA                  ;
    1665    1406   006CA                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1666    1407   006CA                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1667    1408   006CA                  ;
    1668    1409   006CA                  ; Gebruikt:
    1669    1410   006CA                  ;      -accu als 8 msb meting
    1670    1411   006CA                  ;      -b als 2 lsb meting (links afgelijnd)
    1671    1412   006CA                  ;
    1672    1413   006CA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1673    1414   006CA                  
    1674    1415   006CA C08F             adcpotmeter:  push   syscon0
    1675    1416   006CC 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1676    1417   006CF 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1677    1418   006D2 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1678    1419   006D5 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1679    1420   006D8 00               		nop
    1680    1421   006D9 00               		nop					;anders loopt het mis met het testen van de ready bit
    1681    1422   006DA E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1682    1423   006DC 20E0FB                         jb     acc.0,adcpotmeter1
    1683    1424   006DF 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1684    1425   006E2 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1685    1426   006E4 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1686    1427   006E7 D08F                           pop    syscon0
    1687    1428   006E9                  
    1688    1429   006E9                  
    1689    1430   006E9 22                             ret
    1690    1431   006EA                  
    1691    1432   006EA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1692    1433   006EA                  ;
    1693    1434   006EA                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1694    1435   006EA                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1695    1436   006EA                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1696    1437   006EA                  ; doelstellingen in het achterhoofd.
    1697    1438   006EA                  ;
    1698    1439   006EA                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1699    1440   006EA                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1700    1441   006EA                  ; bcd)
    1701    1442   006EA                  ;      8bit hex naar bcd
    1702    1443   006EA                  ;      8bit bcd naar hex
    1703    1444   006EA                  ;
    1704    1445   006EA                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1705    1446   006EA                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1706    1447   006EA                  ;      16*16 bit met 32 bit uitkomst
    1707    1448   006EA                  ;      16+16 bit met 24 bit uitkomst
    1708    1449   006EA                  ;      16-16 bit met 24 bit uitkomst
    1709    1450   006EA                  ;      16bit hex naar bcd
    1710    1451   006EA                  ;      16bit bcd naar hex
    1711    1452   006EA                  ;
    1712    1453   006EA                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1713    1454   006EA                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1714    1455   006EA                  ;      32*32 bit met 64 bit uitkomst
    1715    1456   006EA                  ;      32+32 bit met 40 bit uitkomst
    1716    1457   006EA                  ;      32-32 bit met 40 bit uitkomst
    1717    1458   006EA                  ;
    1718    1459   006EA                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1719    1460   006EA                  ;
    1720    1461   006EA                  ; De routines gebruiken als input en output de huidige registerbank.
    1721    1462   006EA                  ;
    1722    1463   006EA                  ;
    1723    1464   006EA                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1724    1465   006EA                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1725    1466   006EA                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1726    1467   006EA                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1727    1468   006EA                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1728    1469   006EA                  ;
    1729    1470   006EA                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1730    1471   006EA                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1731    1472   006EA                  ;      -routines gebruiken geen MDU!
    1732    1473   006EA                  ;
    1733    1474   006EA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1734    1475   006EA                  
    1735    1476   006EA                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1736    1477   006EA                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1737    1478   006EA                  
    1738    1479   006EA                  h0            equ    070h
    1739    1480   006EA                  h1            equ    071h
    1740    1481   006EA                  h2            equ    072h
    1741    1482   006EA                  h3            equ    073h
    1742    1483   006EA                  h4            equ    074h
    1743    1484   006EA                  h5            equ    075h
    1744    1485   006EA                  h6            equ    076h
    1745    1486   006EA                  h7            equ    077h
    1746    1487   006EA                  h8            equ    078h
    1747    1488   006EA                  h9            equ    079h
    1748    1489   006EA                  h10           equ    07ah
    1749    1490   006EA                  h11           equ    07bh
    1750    1491   006EA                  h12           equ    07ch
    1751    1492   006EA                  
    1752    1493   006EA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1753    1494   006EA                  ;
    1754    1495   006EA                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1755    1496   006EA                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1756    1497   006EA                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1757    1498   006EA                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1758    1499   006EA                  ;
    1759    1500   006EA                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1760    1501   006EA                  ;
    1761    1502   006EA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1762    1503   006EA                  
    1763    1504   006EA C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1764    1505   006EC C0D0                           push   psw
    1765    1506   006EE C070                           push   h0
    1766    1507   006F0 C071                           push   h1
    1767    1508   006F2 C072                           push   h2
    1768    1509   006F4 C073                           push   h3
    1769    1510   006F6 C074                           push   h4
    1770    1511   006F8 C075                           push   h5
    1771    1512   006FA C076                           push   h6
    1772    1513   006FC C077                           push   h7
    1773    1514   006FE C078                           push   h8
    1774    1515   00700 C079                           push   h9
    1775    1516   00702 C07A                           push   h10
    1776    1517   00704 C07B                           push   h11
    1777    1518   00706 C07C                           push   h12
    1778    1519   00708                  
    1779    1520   00708                  ; eerst moeten de hulpregisters klaar gezet worden
    1780    1521   00708                  
    1781    1522   00708 757000                         mov    h0,#000h
    1782    1523   0070B 757100                         mov    h1,#000h
    1783    1524   0070E 757200                         mov    h2,#000h
    1784    1525   00711 757300                         mov    h3,#000h
    1785    1526   00714 757400                         mov    h4,#000h
    1786    1527   00717 757500                         mov    h5,#000h
    1787    1528   0071A 757600                         mov    h6,#000h
    1788    1529   0071D 757700                         mov    h7,#000h
    1789    1530   00720 757800                         mov    h8,#000h
    1790    1531   00723 757900                         mov    h9,#000h
    1791    1532   00726 757A00                         mov    h10,#000h
    1792    1533   00729 757B00                         mov    h11,#000h
    1793    1534   0072C 757C20                         mov    h12,#32              ;loopcounter
    1794    1535   0072F                  
    1795    1536   0072F                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1796    1537   0072F                  
    1797    1538   0072F                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1798    1539   0072F                  
    1799    1540   0072F EB               mul321:       mov    a,r3
    1800    1541   00730 13                             rrc    a
    1801    1542   00731 FB                             mov    r3,a
    1802    1543   00732 EA                             mov    a,r2
    1803    1544   00733 13                             rrc    a
    1804    1545   00734 FA                             mov    r2,a
    1805    1546   00735 E9                             mov    a,r1
    1806    1547   00736 13                             rrc    a
    1807    1548   00737 F9                             mov    r1,a
    1808    1549   00738 E8                             mov    a,r0
    1809    1550   00739 13                             rrc    a
    1810    1551   0073A F8                             mov    r0,a                 ;32 bit shift klaar
    1811    1552   0073B                  
    1812    1553   0073B                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1813    1554   0073B                  
    1814    1555   0073B 502C                           jnc    mul322               ;optelling niet nodig
    1815    1556   0073D                  
    1816    1557   0073D                  ; hier staat en 64 bit optelling
    1817    1558   0073D                  
    1818    1559   0073D EC                             mov    a,r4
    1819    1560   0073E 2574                           add    a,h4
    1820    1561   00740 F574                           mov    h4,a
    1821    1562   00742 ED                             mov    a,r5
    1822    1563   00743 3575                           addc   a,h5
    1823    1564   00745 F575                           mov    h5,a
    1824    1565   00747 EE                             mov    a,r6
    1825    1566   00748 3576                           addc   a,h6
    1826    1567   0074A F576                           mov    h6,a
    1827    1568   0074C EF                             mov    a,r7
    1828    1569   0074D 3577                           addc   a,h7
    1829    1570   0074F F577                           mov    h7,a
    1830    1571   00751 E570                           mov    a,h0
    1831    1572   00753 3578                           addc   a,h8
    1832    1573   00755 F578                           mov    h8,a
    1833    1574   00757 E571                           mov    a,h1
    1834    1575   00759 3579                           addc   a,h9
    1835    1576   0075B F579                           mov    h9,a
    1836    1577   0075D E572                           mov    a,h2
    1837    1578   0075F 357A                           addc   a,h10
    1838    1579   00761 F57A                           mov    h10,a
    1839    1580   00763 E573                           mov    a,h3
    1840    1581   00765 357B                           addc   a,h11
    1841    1582   00767 F57B                           mov    h11,a                ;optelling klaar
    1842    1583   00769                  
    1843    1584   00769                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1844    1585   00769                  
    1845    1586   00769 C3               mul322:       clr    c                    ;moet op 0 staan
    1846    1587   0076A EC                             mov    a,r4
    1847    1588   0076B 33                             rlc    a
    1848    1589   0076C FC                             mov    r4,a
    1849    1590   0076D ED                             mov    a,r5
    1850    1591   0076E 33                             rlc    a
    1851    1592   0076F FD                             mov    r5,a
    1852    1593   00770 EE                             mov    a,r6
    1853    1594   00771 33                             rlc    a
    1854    1595   00772 FE                             mov    r6,a
    1855    1596   00773 EF                             mov    a,r7
    1856    1597   00774 33                             rlc    a
    1857    1598   00775 FF                             mov    r7,a
    1858    1599   00776 E570                           mov    a,h0
    1859    1600   00778 33                             rlc    a
    1860    1601   00779 F570                           mov    h0,a
    1861    1602   0077B E571                           mov    a,h1
    1862    1603   0077D 33                             rlc    a
    1863    1604   0077E F571                           mov    h1,a
    1864    1605   00780 E572                           mov    a,h2
    1865    1606   00782 33                             rlc    a
    1866    1607   00783 F572                           mov    h2,a
    1867    1608   00785 E573                           mov    a,h3
    1868    1609   00787 33                             rlc    a
    1869    1610   00788 F573                           mov    h3,a
    1870    1611   0078A                  
    1871    1612   0078A D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1872    1613   0078D                  
    1873    1614   0078D                  ; de uitkomst moet in de juiste registers komen
    1874    1615   0078D                  
    1875    1616   0078D A874                           mov    r0,h4
    1876    1617   0078F A975                           mov    r1,h5
    1877    1618   00791 AA76                           mov    r2,h6
    1878    1619   00793 AB77                           mov    r3,h7
    1879    1620   00795 AC78                           mov    r4,h8
    1880    1621   00797 AD79                           mov    r5,h9
    1881    1622   00799 AE7A                           mov    r6,h10
    1882    1623   0079B AF7B                           mov    r7,h11               ;klaar
    1883    1624   0079D                  
    1884    1625   0079D D07C                           pop    h12                  ;registers herstellen
    1885    1626   0079F D07B                           pop    h11
    1886    1627   007A1 D07A                           pop    h10
    1887    1628   007A3 D079                           pop    h9
    1888    1629   007A5 D078                           pop    h8
    1889    1630   007A7 D077                           pop    h7
    1890    1631   007A9 D076                           pop    h6
    1891    1632   007AB D075                           pop    h5
    1892    1633   007AD D074                           pop    h4
    1893    1634   007AF D073                           pop    h3
    1894    1635   007B1 D072                           pop    h2
    1895    1636   007B3 D071                           pop    h1
    1896    1637   007B5 D070                           pop    h0
    1897    1638   007B7 D0D0                           pop    psw
    1898    1639   007B9 D0E0                           pop    acc
    1899    1640   007BB 22                             ret
    1900    1641   007BC                  
    1901    1642   007BC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1902    1643   007BC                  ;
    1903    1644   007BC                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1904    1645   007BC                  ; input:      r1,r0 = eerste getal (r1=msb)
    1905    1646   007BC                  ;             r3,r2 = tweede getal (r3=msb)
    1906    1647   007BC                  ; output:     r3,r2,r1,r0 met r3=msb
    1907    1648   007BC                  ;
    1908    1649   007BC                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1909    1650   007BC                  ;
    1910    1651   007BC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1911    1652   007BC                  
    1912    1653   007BC C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1913    1654   007BE C0D0                           push   psw
    1914    1655   007C0 C070                           push   h0
    1915    1656   007C2 C071                           push   h1
    1916    1657   007C4 C072                           push   h2
    1917    1658   007C6 C073                           push   h3
    1918    1659   007C8 C074                           push   h4
    1919    1660   007CA C075                           push   h5
    1920    1661   007CC C076                           push   h6
    1921    1662   007CE                  
    1922    1663   007CE                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1923    1664   007CE                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1924    1665   007CE                  ; h6 is de loopcounter.
    1925    1666   007CE                  
    1926    1667   007CE 757000                         mov    h0,#000h
    1927    1668   007D1 757100                         mov    h1,#000h
    1928    1669   007D4 757200                         mov    h2,#000h
    1929    1670   007D7 757300                         mov    h3,#000h
    1930    1671   007DA 757400                         mov    h4,#000h
    1931    1672   007DD 757500                         mov    h5,#000h
    1932    1673   007E0 757610                         mov    h6,#16               ;loopcounter
    1933    1674   007E3                  
    1934    1675   007E3                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1935    1676   007E3                  ; berekening
    1936    1677   007E3                  
    1937    1678   007E3 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1938    1679   007E4 13                             rrc    a
    1939    1680   007E5 F9                             mov    r1,a
    1940    1681   007E6 E8                             mov    a,r0
    1941    1682   007E7 13                             rrc    a
    1942    1683   007E8 F8                             mov    r0,a                 ;ok
    1943    1684   007E9                  
    1944    1685   007E9                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1945    1686   007E9                  
    1946    1687   007E9 5016                           jnc    mul162
    1947    1688   007EB                  
    1948    1689   007EB EA                             mov    a,r2
    1949    1690   007EC 2572                           add    a,h2
    1950    1691   007EE F572                           mov    h2,a                 ;32 bit som uitvoeren
    1951    1692   007F0 EB                             mov    a,r3
    1952    1693   007F1 3573                           addc   a,h3
    1953    1694   007F3 F573                           mov    h3,a
    1954    1695   007F5 E570                           mov    a,h0
    1955    1696   007F7 3574                           addc   a,h4
    1956    1697   007F9 F574                           mov    h4,a
    1957    1698   007FB E571                           mov    a,h1
    1958    1699   007FD 3575                           addc   a,h5
    1959    1700   007FF F575                           mov    h5,a                 ;klaar
    1960    1701   00801                  
    1961    1702   00801                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    1962    1703   00801                  
    1963    1704   00801 C3               mul162:       clr    c
    1964    1705   00802 EA                             mov    a,r2
    1965    1706   00803 33                             rlc    a
    1966    1707   00804 FA                             mov    r2,a                 ;ook 32 bit getal
    1967    1708   00805 EB                             mov    a,r3
    1968    1709   00806 33                             rlc    a
    1969    1710   00807 FB                             mov    r3,a
    1970    1711   00808 E570                           mov    a,h0
    1971    1712   0080A 33                             rlc    a
    1972    1713   0080B F570                           mov    h0,a
    1973    1714   0080D E571                           mov    a,h1
    1974    1715   0080F 33                             rlc    a
    1975    1716   00810 F571                           mov    h1,a                 ;klaar
    1976    1717   00812                  
    1977    1718   00812 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    1978    1719   00815                  
    1979    1720   00815                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    1980    1721   00815                  
    1981    1722   00815 A872                           mov    r0,h2
    1982    1723   00817 A973                           mov    r1,h3
    1983    1724   00819 AA74                           mov    r2,h4
    1984    1725   0081B AB75                           mov    r3,h5                ;klaar
    1985    1726   0081D                  
    1986    1727   0081D                  
    1987    1728   0081D D076                           pop    h6                   ;registers herstellen
    1988    1729   0081F D075                           pop    h5
    1989    1730   00821 D074                           pop    h4
    1990    1731   00823 D073                           pop    h3
    1991    1732   00825 D072                           pop    h2
    1992    1733   00827 D071                           pop    h1
    1993    1734   00829 D070                           pop    h0
    1994    1735   0082B D0D0                           pop    psw
    1995    1736   0082D D0E0                           pop    acc
    1996    1737   0082F 22                             ret
    1997    1738   00830                  
    1998    1739   00830                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1999    1740   00830                  ;
    2000    1741   00830                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2001    1742   00830                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2002    1743   00830                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2003    1744   00830                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2004    1745   00830                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2005    1746   00830                  ;             carry=1 bij delen door 0
    2006    1747   00830                  ;
    2007    1748   00830                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2008    1749   00830                  ;
    2009    1750   00830                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2010    1751   00830                  
    2011    1752   00830 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2012    1753   00832 C0D0                           push   psw
    2013    1754   00834 C070                           push   h0
    2014    1755   00836 C071                           push   h1
    2015    1756   00838 C072                           push   h2
    2016    1757   0083A C073                           push   h3
    2017    1758   0083C C074                           push   h4
    2018    1759   0083E C075                           push   h5
    2019    1760   00840 C076                           push   h6
    2020    1761   00842 C077                           push   h7
    2021    1762   00844 C078                           push   h8
    2022    1763   00846 C079                           push   h9
    2023    1764   00848 C07A                           push   h10
    2024    1765   0084A C07B                           push   h11
    2025    1766   0084C C07C                           push   h12
    2026    1767   0084E                  
    2027    1768   0084E                  ; eerst alles voorladen
    2028    1769   0084E                  
    2029    1770   0084E 757000                         mov    h0,#000h
    2030    1771   00851 757100                         mov    h1,#000h
    2031    1772   00854 757200                         mov    h2,#000h
    2032    1773   00857 757300                         mov    h3,#000h
    2033    1774   0085A 757400                         mov    h4,#000h
    2034    1775   0085D 757500                         mov    h5,#000h
    2035    1776   00860 757600                         mov    h6,#000h
    2036    1777   00863 757700                         mov    h7,#000h
    2037    1778   00866 757800                         mov    h8,#000h
    2038    1779   00869 757900                         mov    h9,#000h
    2039    1780   0086C 757A00                         mov    h10,#000h
    2040    1781   0086F 757B00                         mov    h11,#000h
    2041    1782   00872 757C20                         mov    h12,#32              ;loopcounter
    2042    1783   00875                  
    2043    1784   00875                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2044    1785   00875                  
    2045    1786   00875                  ; deze lus moet 32 keer heraald worden
    2046    1787   00875                  
    2047    1788   00875 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2048    1789   00876 33                             rlc    a
    2049    1790   00877 F8                             mov    r0,a
    2050    1791   00878 E9                             mov    a,r1
    2051    1792   00879 33                             rlc    a
    2052    1793   0087A F9                             mov    r1,a
    2053    1794   0087B EA                             mov    a,r2
    2054    1795   0087C 33                             rlc    a
    2055    1796   0087D FA                             mov    r2,a
    2056    1797   0087E EB                             mov    a,r3
    2057    1798   0087F 33                             rlc    a
    2058    1799   00880 FB                             mov    r3,a
    2059    1800   00881 E570                           mov    a,h0
    2060    1801   00883 33                             rlc    a
    2061    1802   00884 F570                           mov    h0,a
    2062    1803   00886 E571                           mov    a,h1
    2063    1804   00888 33                             rlc    a
    2064    1805   00889 F571                           mov    h1,a
    2065    1806   0088B E572                           mov    a,h2
    2066    1807   0088D 33                             rlc    a
    2067    1808   0088E F572                           mov    h2,a
    2068    1809   00890 E573                           mov    a,h3
    2069    1810   00892 33                             rlc    a
    2070    1811   00893 F573                           mov    h3,a
    2071    1812   00895                  
    2072    1813   00895                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2073    1814   00895                  
    2074    1815   00895 C3                             clr    c                    ;zit in de weg
    2075    1816   00896 E570                           mov    a,h0
    2076    1817   00898 9C                             subb   a,r4
    2077    1818   00899 F574                           mov    h4,a
    2078    1819   0089B E571                           mov    a,h1
    2079    1820   0089D 9D                             subb   a,r5
    2080    1821   0089E F575                           mov    h5,a
    2081    1822   008A0 E572                           mov    a,h2
    2082    1823   008A2 9E                             subb   a,r6
    2083    1824   008A3 F576                           mov    h6,a
    2084    1825   008A5 E573                           mov    a,h3
    2085    1826   008A7 9F                             subb   a,r7
    2086    1827   008A8 F577                           mov    h7,a
    2087    1828   008AA                  
    2088    1829   008AA                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2089    1830   008AA                  ; vervangen worden door h7-h4
    2090    1831   008AA                  
    2091    1832   008AA 400C                           jc     div322               ;niet vervangen
    2092    1833   008AC                  
    2093    1834   008AC 857470                         mov    h0,h4
    2094    1835   008AF 857571                         mov    h1,h5
    2095    1836   008B2 857672                         mov    h2,h6
    2096    1837   008B5 857773                         mov    h3,h7                ;vervanging klaar
    2097    1838   008B8                  
    2098    1839   008B8 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2099    1840   008B9 E578                           mov    a,h8
    2100    1841   008BB 33                             rlc    a
    2101    1842   008BC F578                           mov    h8,a
    2102    1843   008BE E579                           mov    a,h9
    2103    1844   008C0 33                             rlc    a
    2104    1845   008C1 F579                           mov    h9,a
    2105    1846   008C3 E57A                           mov    a,h10
    2106    1847   008C5 33                             rlc    a
    2107    1848   008C6 F57A                           mov    h10,a
    2108    1849   008C8 E57B                           mov    a,h11
    2109    1850   008CA 33                             rlc    a
    2110    1851   008CB F57B                           mov    h11,a                ;qoutient aangepast
    2111    1852   008CD                  
    2112    1853   008CD D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2113    1854   008D0                  
    2114    1855   008D0                  ; de berekening is klaar. uitkomstregisters nog laden
    2115    1856   008D0                  
    2116    1857   008D0 AC78                           mov    r4,h8
    2117    1858   008D2 AD79                           mov    r5,h9
    2118    1859   008D4 AE7A                           mov    r6,h10
    2119    1860   008D6 AF7B                           mov    r7,h11               ;uitkomst geladen
    2120    1861   008D8                  
    2121    1862   008D8 A870                           mov    r0,h0                ;rest laden
    2122    1863   008DA A971                           mov    r1,h1
    2123    1864   008DC AA72                           mov    r2,h2
    2124    1865   008DE AB73                           mov    r3,h3
    2125    1866   008E0                  
    2126    1867   008E0 D07C                           pop    h12                  ;registers herstellen
    2127    1868   008E2 D07B                           pop    h11
    2128    1869   008E4 D07A                           pop    h10
    2129    1870   008E6 D079                           pop    h9
    2130    1871   008E8 D078                           pop    h8
    2131    1872   008EA D077                           pop    h7
    2132    1873   008EC D076                           pop    h6
    2133    1874   008EE D075                           pop    h5
    2134    1875   008F0 D074                           pop    h4
    2135    1876   008F2 D073                           pop    h3
    2136    1877   008F4 D072                           pop    h2
    2137    1878   008F6 D071                           pop    h1
    2138    1879   008F8 D070                           pop    h0
    2139    1880   008FA D0D0                           pop    psw
    2140    1881   008FC D0E0                           pop    acc
    2141    1882   008FE 22                             ret
    2142    1883   008FF                  
    2143    1884   008FF                  
    2144    1885   008FF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2145    1886   008FF                  ;
    2146    1887   008FF                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2147    1888   008FF                  ; input:      r1,r0 = eerste getal (r1=msb)
    2148    1889   008FF                  ;             r3,r2 = tweede getal (r3=msb)
    2149    1890   008FF                  ; output:     r3,r2 = quotient (r3=msb)
    2150    1891   008FF                  ;             r1,r0 = rest (r1=msb)
    2151    1892   008FF                  ;             carry=1 bij deling door 0
    2152    1893   008FF                  ;
    2153    1894   008FF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2154    1895   008FF                  
    2155    1896   008FF C0E0             div16:        push   acc                  ;registers op de stack zetten
    2156    1897   00901 C0D0                           push   psw
    2157    1898   00903 C070                           push   h0
    2158    1899   00905 C071                           push   h1
    2159    1900   00907 C072                           push   h2
    2160    1901   00909 C073                           push   h3
    2161    1902   0090B C074                           push   h4
    2162    1903   0090D C075                           push   h5
    2163    1904   0090F C076                           push   h6
    2164    1905   00911                  
    2165    1906   00911                  ; registers voorladen
    2166    1907   00911                  
    2167    1908   00911 757000                         mov    h0,#000h
    2168    1909   00914 757100                         mov    h1,#000h
    2169    1910   00917 757200                         mov    h2,#000h
    2170    1911   0091A 757300                         mov    h3,#000h
    2171    1912   0091D 757400                         mov    h4,#000h
    2172    1913   00920 757500                         mov    h5,#000h
    2173    1914   00923 757610                         mov    h6,#16               ;loopcounter
    2174    1915   00926                  
    2175    1916   00926                  ; eerst te delen getal 1*links shiften in hulpregisters
    2176    1917   00926                  
    2177    1918   00926                  ; deze lus moet 16 keer herhaald worden
    2178    1919   00926                  
    2179    1920   00926 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2180    1921   00927 33                             rlc    a
    2181    1922   00928 F8                             mov    r0,a
    2182    1923   00929 E9                             mov    a,r1
    2183    1924   0092A 33                             rlc    a
    2184    1925   0092B F9                             mov    r1,a
    2185    1926   0092C E570                           mov    a,h0
    2186    1927   0092E 33                             rlc    a
    2187    1928   0092F F570                           mov    h0,a
    2188    1929   00931 E571                           mov    a,h1
    2189    1930   00933 33                             rlc    a
    2190    1931   00934 F571                           mov    h1,a
    2191    1932   00936                  
    2192    1933   00936                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2193    1934   00936                  ; het tussenresultaat.
    2194    1935   00936                  
    2195    1936   00936 C3                             clr    c
    2196    1937   00937 E570                           mov    a,h0
    2197    1938   00939 9A                             subb   a,r2
    2198    1939   0093A F572                           mov    h2,a
    2199    1940   0093C E571                           mov    a,h1
    2200    1941   0093E 9B                             subb   a,r3
    2201    1942   0093F F573                           mov    h3,a
    2202    1943   00941                  
    2203    1944   00941 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2204    1945   00943                                                            ;door h3,h2
    2205    1946   00943 857270                         mov    h0,h2
    2206    1947   00946 857371                         mov    h1,h3                ;vervanging klaar
    2207    1948   00949                  
    2208    1949   00949                  ; uitkomst moet aangepast worden
    2209    1950   00949                  
    2210    1951   00949 B3               div162:       cpl    c                    ;truuk
    2211    1952   0094A E574                           mov    a,h4
    2212    1953   0094C 33                             rlc    a
    2213    1954   0094D F574                           mov    h4,a
    2214    1955   0094F E575                           mov    a,h5
    2215    1956   00951 33                             rlc    a
    2216    1957   00952 F575                           mov    h5,a
    2217    1958   00954 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2218    1959   00957                  
    2219    1960   00957                  ; de berekening is klaar. uitkomsten in passende registers
    2220    1961   00957                  
    2221    1962   00957 AA74                           mov    r2,h4                ;quotient
    2222    1963   00959 AB75                           mov    r3,h5
    2223    1964   0095B                  
    2224    1965   0095B A870                           mov    r0,h0                ;rest
    2225    1966   0095D A971                           mov    r1,h1
    2226    1967   0095F                  
    2227    1968   0095F D076                           pop    h6                   ;registers herstellen
    2228    1969   00961 D075                           pop    h5
    2229    1970   00963 D074                           pop    h4
    2230    1971   00965 D073                           pop    h3
    2231    1972   00967 D072                           pop    h2
    2232    1973   00969 D071                           pop    h1
    2233    1974   0096B D070                           pop    h0
    2234    1975   0096D D0D0                           pop    psw
    2235    1976   0096F D0E0                           pop    acc
    2236    1977   00971 22                             ret
    2237    1978   00972                  
    2238    1979   00972                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2239    1980   00972                  ;
    2240    1981   00972                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2241    1982   00972                  ;
    2242    1983   00972                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2243    1984   00972                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2244    1985   00972                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2245    1986   00972                  ;
    2246    1987   00972                  ; r4,r3,r2,r1,r0 worden aangepast
    2247    1988   00972                  ;
    2248    1989   00972                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2249    1990   00972                  
    2250    1991   00972 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2251    1992   00974 C0D0                           push   psw
    2252    1993   00976 E8                             mov    a,r0                 ;eerste 8 bit
    2253    1994   00977 2C                             add    a,r4
    2254    1995   00978 F8                             mov    r0,a                 ;klaar
    2255    1996   00979 E9                             mov    a,r1                 ;volgende 8 bit
    2256    1997   0097A 3D                             addc   a,r5
    2257    1998   0097B F9                             mov    r1,a                 ;klaar
    2258    1999   0097C EA                             mov    a,r2                 ;volgende 8 bit
    2259    2000   0097D 3E                             addc   a,r6
    2260    2001   0097E FA                             mov    r2,a                 ;klaar
    2261    2002   0097F EB                             mov    a,r3                 ;laatste 8 bit
    2262    2003   00980 3F                             addc   a,r7
    2263    2004   00981 FB                             mov    r3,a                 ;32 bit klaar
    2264    2005   00982 7400                           mov    a,#000h
    2265    2006   00984 3400                           addc   a,#000h              ;carry verrekenen
    2266    2007   00986 FC                             mov    r4,a
    2267    2008   00987 D0D0                           pop    psw                  ;registers herstellen
    2268    2009   00989 D0E0                           pop    acc
    2269    2010   0098B 22                             ret
    2270    2011   0098C                  
    2271    2012   0098C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2272    2013   0098C                  ;
    2273    2014   0098C                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2274    2015   0098C                  ;
    2275    2016   0098C                  ; input:      r1,r0 = eerste getal (r1=msb)
    2276    2017   0098C                  ;             r3,r2 = tweede getal (r3=msb)
    2277    2018   0098C                  ; output:     r2,r1,r0 (r2=msb)
    2278    2019   0098C                  ;
    2279    2020   0098C                  ; r3,r2,r1,r0 worden aangepast
    2280    2021   0098C                  ;
    2281    2022   0098C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2282    2023   0098C                  
    2283    2024   0098C C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2284    2025   0098E C0D0                           push   psw
    2285    2026   00990 E8                             mov    a,r0                 ;starten met de optelling
    2286    2027   00991 2A                             add    a,r2                 ;8 bit klaar
    2287    2028   00992 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2288    2029   00993 E9                             mov    a,r1                 ;volgende 8 bit
    2289    2030   00994 3B                             addc   a,r3                 ;16 bit klaar
    2290    2031   00995 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2291    2032   00996 7400                           mov    a,#000h              ;carry verrekenen
    2292    2033   00998 3400                           addc   a,#000h
    2293    2034   0099A FA                             mov    r2,a                 ;24 bit klaar
    2294    2035   0099B D0D0                           pop    psw                  ;registers herstellen
    2295    2036   0099D D0E0                           pop    acc
    2296    2037   0099F 22                             ret
    2297    2038   009A0                  
    2298    2039   009A0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2299    2040   009A0                  ;
    2300    2041   009A0                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2301    2042   009A0                  ;             40 bit groot. (eerste -tweede)
    2302    2043   009A0                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2303    2044   009A0                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2304    2045   009A0                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2305    2046   009A0                  ;
    2306    2047   009A0                  ; r4,r3,r2,r1,r0 worden aangepast
    2307    2048   009A0                  ;
    2308    2049   009A0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2309    2050   009A0                  
    2310    2051   009A0 C0E0             sub32:        push   acc                  ;registers bewaren
    2311    2052   009A2 C0D0                           push   psw                  ;ook de vlaggen
    2312    2053   009A4 C3                             clr    c                    ;zit nog effe in de weg
    2313    2054   009A5 E8                             mov    a,r0                 ;eerste 8 bit
    2314    2055   009A6 9C                             subb   a,r4
    2315    2056   009A7 F8                             mov    r0,a
    2316    2057   009A8 E9                             mov    a,r1                 ;tweede 8 bit
    2317    2058   009A9 9D                             subb   a,r5
    2318    2059   009AA F9                             mov    r1,a
    2319    2060   009AB EA                             mov    a,r2                 ;volgende 8 bit
    2320    2061   009AC 9E                             subb   a,r6
    2321    2062   009AD FA                             mov    r2,a
    2322    2063   009AE EB                             mov    a,r3                 ;laatste 8 bit
    2323    2064   009AF 9F                             subb   a,r7
    2324    2065   009B0 FB                             mov    r3,a
    2325    2066   009B1 7400                           mov    a,#000h              ;nu nog de carry
    2326    2067   009B3 9400                           subb   a,#000h
    2327    2068   009B5 FC                             mov    r4,a                 ;40 bit klaar
    2328    2069   009B6 D0D0                           pop    psw                  ;registers herstellen
    2329    2070   009B8 D0E0                           pop    acc
    2330    2071   009BA 22                             ret
    2331    2072   009BB                  
    2332    2073   009BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2333    2074   009BB                  ;
    2334    2075   009BB                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2335    2076   009BB                  ;             24 bit groot. (eerste - tweede)
    2336    2077   009BB                  ; input:      r1,r0 = eerste getal (r1=msb)
    2337    2078   009BB                  ;             r3,r2 = tweede getal (r3=msb)
    2338    2079   009BB                  ; output:     r2,r1,r0 (r2=msb)
    2339    2080   009BB                  ;
    2340    2081   009BB                  ; r3,r2,r1,r0 worden aangepast
    2341    2082   009BB                  ;
    2342    2083   009BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2343    2084   009BB                  
    2344    2085   009BB C0E0             sub16:        push   acc                  ;registers bewaren
    2345    2086   009BD C0D0                           push   psw
    2346    2087   009BF C3                             clr    c                    ;mag nog niet meespelen
    2347    2088   009C0 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2348    2089   009C1 9A                             subb   a,r2
    2349    2090   009C2 F8                             mov    r0,a                 ;klaar
    2350    2091   009C3 E9                             mov    a,r1
    2351    2092   009C4 9B                             subb   a,r3                 ;16 bit klaar
    2352    2093   009C5 F9                             mov    r1,a
    2353    2094   009C6 7400                           mov    a,#000h
    2354    2095   009C8 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2355    2096   009CA FA                             mov    r2,a                 ;24 bit klaar
    2356    2097   009CB D0D0                           pop    psw                  ;registers herstellen
    2357    2098   009CD D0E0                           pop    acc
    2358    2099   009CF 22                             ret
    2359    2100   009D0                  
    2360    2101   009D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2361    2102   009D0                  ;
    2362    2103   009D0                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2363    2104   009D0                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2364    2105   009D0                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2365    2106   009D0                  ;
    2366    2107   009D0                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2367    2108   009D0                  ;
    2368    2109   009D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2369    2110   009D0                  
    2370    2111   009D0 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2371    2112   009D2 C0D0                           push   psw
    2372    2113   009D4                  
    2373    2114   009D4 C077                           push   h7                   ;nodig
    2374    2115   009D6 C078                           push   h8
    2375    2116   009D8                  
    2376    2117   009D8 C079                           push   h9                   ;ook
    2377    2118   009DA                  
    2378    2119   009DA 757905                         mov    h9,#005h             ;loopcounter
    2379    2120   009DD                  
    2380    2121   009DD 7B00             hexbcd161:    mov    r3,#000h
    2381    2122   009DF 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2382    2123   009E1 1208FF                         lcall  div16                ;deling uitvoeren
    2383    2124   009E4 E8                             mov    a,r0                 ;rest
    2384    2125   009E5 C0E0                           push   acc                  ;op stack zetten
    2385    2126   009E7 EA                             mov    a,r2
    2386    2127   009E8 F8                             mov    r0,a
    2387    2128   009E9 EB                             mov    a,r3
    2388    2129   009EA F9                             mov    r1,a                 ;uitkomst terug delen
    2389    2130   009EB D579EF                         djnz   h9,hexbcd161
    2390    2131   009EE                  
    2391    2132   009EE D0E0                           pop    acc                  ;hoogste bits van de stack
    2392    2133   009F0 FA                             mov    r2,a                 ;klaar
    2393    2134   009F1 D0E0                           pop    acc
    2394    2135   009F3 C4                             swap   a
    2395    2136   009F4 F579                           mov    h9,a
    2396    2137   009F6 D0E0                           pop    acc
    2397    2138   009F8 2579                           add    a,h9
    2398    2139   009FA F9                             mov    r1,a                 ;volgende 8 klaar
    2399    2140   009FB D0E0                           pop    acc
    2400    2141   009FD C4                             swap   a
    2401    2142   009FE F579                           mov    h9,a
    2402    2143   00A00 D0E0                           pop    acc
    2403    2144   00A02 2579                           add    a,h9
    2404    2145   00A04 F8                             mov    r0,a                 ;klaar
    2405    2146   00A05                  
    2406    2147   00A05 D079                           pop    h9                   ;was naar de knoppen
    2407    2148   00A07                  
    2408    2149   00A07 D078                           pop    h8                   ;gebruikt
    2409    2150   00A09 D077                           pop    h7
    2410    2151   00A0B                  
    2411    2152   00A0B D0D0                           pop    psw                  ;registers herstellen
    2412    2153   00A0D D0E0                           pop    acc
    2413    2154   00A0F 22                             ret
    2414    2155   00A10                  
    2415    2156   00A10                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2416    2157   00A10                  ;
    2417    2158   00A10                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2418    2159   00A10                  ; input       a (maximale waarde = 63h)
    2419    2160   00A10                  ; output      a
    2420    2161   00A10                  ;
    2421    2162   00A10                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2422    2163   00A10                  
    2423    2164   00A10 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2424    2165   00A12 C0F0                           push   b
    2425    2166   00A14 75F00A                         mov    b,#00ah              ;hierdoor delen
    2426    2167   00A17 84                             div    ab                   ;in accu qoutient in b rest
    2427    2168   00A18 C4                             swap   a
    2428    2169   00A19 25F0                           add    a,b                  ;bcd getal klaar
    2429    2170   00A1B D0F0                           pop    b
    2430    2171   00A1D D0D0                           pop    psw
    2431    2172   00A1F 22                             ret
    2432    2173   00A20                  
    2433    2174   00A20                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2434    2175   00A20                  ;
    2435    2176   00A20                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2436    2177   00A20                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2437    2178   00A20                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2438    2179   00A20                  ;
    2439    2180   00A20                  ; de routine gebruikt r1,r0 van de huidige bank
    2440    2181   00A20                  ;
    2441    2182   00A20                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2442    2183   00A20                  
    2443    2184   00A20 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2444    2185   00A22 C0E0                           push   acc
    2445    2186   00A24 C0D0                           push   psw
    2446    2187   00A26                  
    2447    2188   00A26 E8                             mov    a,r0
    2448    2189   00A27 540F                           anl    a,#00fh              ;eenheden
    2449    2190   00A29 C0E0                           push   acc                  ;effe bewaren
    2450    2191   00A2B                  
    2451    2192   00A2B E8                             mov    a,r0
    2452    2193   00A2C C4                             swap   a
    2453    2194   00A2D 540F                           anl    a,#00fh              ;tientallen
    2454    2195   00A2F 75F00A                         mov    b,#00ah              ;waarde berekenen
    2455    2196   00A32 A4                             mul    ab                   ;klaar
    2456    2197   00A33 D0F0                           pop    b                    ;truukje
    2457    2198   00A35 25F0                           add    a,b                  ;a is lage deel hex getal
    2458    2199   00A37 C0E0                           push   acc                  ;straks nodig
    2459    2200   00A39                  
    2460    2201   00A39 E9                             mov    a,r1                 ;hoge deel
    2461    2202   00A3A 54F0                           anl    a,#0f0h
    2462    2203   00A3C C4                             swap   a
    2463    2204   00A3D C0E0                           push   acc                  ;straks nodig
    2464    2205   00A3F                  
    2465    2206   00A3F E9                             mov    a,r1
    2466    2207   00A40 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2467    2208   00A42 75F064                         mov    b,#100               ;waarde uitrekenen
    2468    2209   00A45 A4                             mul    ab
    2469    2210   00A46 A9F0                           mov    r1,b
    2470    2211   00A48 F8                             mov    r0,a
    2471    2212   00A49                  
    2472    2213   00A49 D0E0                           pop    acc
    2473    2214   00A4B 75F00A                         mov    b,#10
    2474    2215   00A4E A4                             mul    ab                   ;kan nog in a
    2475    2216   00A4F 75F064                         mov    b,#100               ;*10*100=*1000
    2476    2217   00A52 A4                             mul    ab
    2477    2218   00A53 28                             add    a,r0
    2478    2219   00A54 F8                             mov    r0,a
    2479    2220   00A55 E9                             mov    a,r1
    2480    2221   00A56 35F0                           addc   a,b
    2481    2222   00A58 F9                             mov    r1,a
    2482    2223   00A59                  
    2483    2224   00A59 D0E0                           pop    acc
    2484    2225   00A5B 28                             add    a,r0
    2485    2226   00A5C F8                             mov    r0,a
    2486    2227   00A5D 7400                           mov    a,#000h
    2487    2228   00A5F 39                             addc   a,r1
    2488    2229   00A60 F9                             mov    r1,a                 ;klaar
    2489    2230   00A61                  
    2490    2231   00A61 D0D0                           pop    psw
    2491    2232   00A63 D0E0                           pop    acc
    2492    2233   00A65 D0F0                           pop    b
    2493    2234   00A67 22                             ret
    2494    2235   00A68                  
    2495    2236   00A68                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2496    2237   00A68                  ;
    2497    2238   00A68                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2498    2239   00A68                  ; input:      a (maximale waarde 99h)
    2499    2240   00A68                  ; output:     a
    2500    2241   00A68                  ;
    2501    2242   00A68                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2502    2243   00A68                  
    2503    2244   00A68 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2504    2245   00A6A C0F0                           push   b
    2505    2246   00A6C C070                           push   h0
    2506    2247   00A6E F570                           mov    h0,a                 ;effe bewaren
    2507    2248   00A70 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2508    2249   00A73 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2509    2250   00A75 C4                             swap   a
    2510    2251   00A76 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2511    2252   00A79 A4                             mul    ab
    2512    2253   00A7A 2570                           add    a,h0                 ;eenheden bijtellen
    2513    2254   00A7C D070                           pop    h0
    2514    2255   00A7E D0F0                           pop    b
    2515    2256   00A80 D0D0                           pop    psw
    2516    2257   00A82 22                             ret
    2517    2258   00A83                  
    2518    2259   00A83                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2519    2260   00A83                  ;
    2520    2261   00A83                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2521    2262   00A83                  ;
    2522    2263   00A83                  ; Gebruikt geen registers
    2523    2264   00A83                  ;
    2524    2265   00A83                  ; Originele auteur: Danny Pawels (dp)
    2525    2266   00A83                  ;
    2526    2267   00A83                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2527    2268   00A83                  
    2528    2269   00A83                  
    2529    2270   00A83 C083             XCsw2xtal:  push  dph
    2530    2271   00A85 C082                         push  dpl
    2531    2272   00A87 C0D0                         push  psw
    2532    2273   00A89 C08F                         push  syscon0
    2533    2274   00A8B C0B2                         push  port_page
    2534    2275   00A8D C0BF                         push  scu_page
    2535    2276   00A8F                  
    2536    2277   00A8F 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2537    2278   00A92 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2538    2279   00A95                  
    2539    2280   00A95 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2540    2281   00A98                                                            ;freq= VCO-free running =5MHz...20MHz?
    2541    2282   00A98 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2542    2283   00A9B 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2543    2284   00A9E 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2544    2285   00AA1                  
    2545    2286   00AA1 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2546    2287   00AA4 A3               XCsw2xtal0: inc   dptr
    2547    2288   00AA5 E582                         mov   a,dpl
    2548    2289   00AA7 4583                         orl   a,dph
    2549    2290   00AA9 70F9                         jnz   XCsw2xtal0
    2550    2291   00AAB                  
    2551    2292   00AAB 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2552    2293   00AAE                  
    2553    2294   00AAE                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2554    2295   00AAE E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2555    2296   00AB0 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2556    2297   00AB3                  ;Oscillator run detectie is klaar...
    2557    2298   00AB3 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2558    2299   00AB6                  
    2559    2300   00AB6                  
    2560    2301   00AB6 E5B7                         mov   a,pll_con               ;lees pll_con
    2561    2302   00AB8 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2562    2303   00ABA 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2563    2304   00ABC                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2564    2305   00ABC                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2565    2306   00ABC                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2566    2307   00ABC 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2567    2308   00ABF                                                            ;bij aanpassing van de NDIV van de PLL
    2568    2309   00ABF F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2569    2310   00AC1 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2570    2311   00AC4 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2571    2312   00AC7                  
    2572    2313   00AC7 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2573    2314   00AC9 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2574    2315   00ACC                  
    2575    2316   00ACC 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2576    2317   00ACF 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2577    2318   00AD2                  
    2578    2319   00AD2 D0BF                         pop   scu_page                ;herstel controller status
    2579    2320   00AD4 D0B2                         pop   port_page
    2580    2321   00AD6 D08F                         pop   syscon0
    2581    2322   00AD8 D0D0                         pop   psw
    2582    2323   00ADA D082                         pop   dpl
    2583    2324   00ADC D083                         pop   dph
    2584    2325   00ADE 22                           ret
    2585    2326   00ADF                  
    2586    2327   00ADF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2587    2328   00ADF                  ;
    2588    2329   00ADF                  ; mapregs	selecteer de SFR's in de mapped area
    2589    2330   00ADF                  ;
    2590    2331   00ADF                  ;
    2591    2332   00ADF                  ; Past syscon SFR aan
    2592    2333   00ADF                  ;
    2593    2334   00ADF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2594    2335   00ADF                  
    2595    2336   00ADF 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2596    2337   00AE2 22               		ret
    2597    2338   00AE3                  
    2598    2339   00AE3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2599    2340   00AE3                  ;
    2600    2341   00AE3                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2601    2342   00AE3                  ;
    2602    2343   00AE3                  ; Past syscon SFR aan
    2603    2344   00AE3                  ;
    2604    2345   00AE3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2605    2346   00AE3                  
    2606    2347   00AE3 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2607    2348   00AE6 22               		ret
    2608    2349   00AE7                  
    2609    2350   00AE7                  ;*******************************************************************************
    2610    2351   00AE7                  ;
    2611    2352   00AE7                  ; These are the register declarations for the XC888 microcontroller from
    2612    2353   00AE7                  ; Infineon.
    2613    2354   00AE7                  ;
    2614    2355   00AE7                  ;*******************************************************************************
    2615    2356   00AE7                  
    2616    2357   00AE7                  ;*******************************************************************************
    2617    2358   00AE7                  ;
    2618    2359   00AE7                  ; CPU registers are accessible independend of paging and mapping
    2619    2360   00AE7                  ; (always accessible)
    2620    2361   00AE7                  ;
    2621    2362   00AE7                  ;*******************************************************************************
    2622    2363   00AE7                  
    2623    2364   00AE7                  sp            data   081h          ;stack pointer                     reset=007h
    2624    2365   00AE7                  dpl           data   082h          ;datapointer low register          reset=000h
    2625    2366   00AE7                  dph           data   083h          ;datapointer high register         reset=000h
    2626    2367   00AE7                  pcon          data   087h          ;power control                     reset=000h
    2627    2368   00AE7                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2628    2369   00AE7                  ;tcon is bit addressable
    2629    2370   00AE7                         tf1    bit    08fh
    2630    2371   00AE7                         tr1    bit    08eh
    2631    2372   00AE7                         tf0    bit    08dh
    2632    2373   00AE7                         tr0    bit    08ch
    2633    2374   00AE7                         ie1    bit    08bh
    2634    2375   00AE7                         it1    bit    08ah
    2635    2376   00AE7                         ie0    bit    089h
    2636    2377   00AE7                         it0    bit    088h
    2637    2378   00AE7                  
    2638    2379   00AE7                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2639    2380   00AE7                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2640    2381   00AE7                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2641    2382   00AE7                  th0           data   08ch          ;timer 0 high                      reset=000h
    2642    2383   00AE7                  th1           data   08dh          ;timer 1 high                      reset=000h
    2643    2384   00AE7                  
    2644    2385   00AE7                  syscon0       data   08fh          ;system control register 0         reset=004h
    2645    2386   00AE7                  scon          data   098h          ;serial channel 0 control          reset=000h
    2646    2387   00AE7                  ;scon is bit addressable
    2647    2388   00AE7                         sm0    bit    09fh
    2648    2389   00AE7                         sm1    bit    09eh
    2649    2390   00AE7                         sm2    bit    09dh
    2650    2391   00AE7                         ren    bit    09ch
    2651    2392   00AE7                         tb8    bit    09bh
    2652    2393   00AE7                         rb8    bit    09ah
    2653    2394   00AE7                         ti     bit    099h
    2654    2395   00AE7                         ri     bit    098h
    2655    2396   00AE7                  
    2656    2397   00AE7                  sbuf          data   099h          ;serial data buffer channel 0
    2657    2398   00AE7                  eo            data   0a2h          ;extended operation                reset=000h
    2658    2399   00AE7                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2659    2400   00AE7                  ;ien0 is bit addressable
    2660    2401   00AE7                         ea     bit    0afh
    2661    2402   00AE7                                                     ;bit not implemented
    2662    2403   00AE7                         et2    bit    0adh
    2663    2404   00AE7                         es     bit    0ach
    2664    2405   00AE7                         et1    bit    0abh
    2665    2406   00AE7                         ex1    bit    0aah
    2666    2407   00AE7                         et0    bit    0a9h
    2667    2408   00AE7                         ex0    bit    0a8h
    2668    2409   00AE7                  
    2669    2410   00AE7                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2670    2411   00AE7                  ;ip is bit addressable
    2671    2412   00AE7                                                     ;bit not implemented
    2672    2413   00AE7                                                     ;bit not implemented
    2673    2414   00AE7                         pt2    bit    0bdh
    2674    2415   00AE7                         ps     bit    0bch
    2675    2416   00AE7                         pt1    bit    0bbh
    2676    2417   00AE7                         px1    bit    0bah
    2677    2418   00AE7                         pt0    bit    0b9h
    2678    2419   00AE7                         px0    bit    0b8h
    2679    2420   00AE7                  
    2680    2421   00AE7                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2681    2422   00AE7                  psw           data   0d0h          ;program status word               reset=000h
    2682    2423   00AE7                  ;psw is bit addressable
    2683    2424   00AE7                         cy     bit    0d7h
    2684    2425   00AE7                         ac     bit    0d6h
    2685    2426   00AE7                         f0     bit    0d5h
    2686    2427   00AE7                         rs1    bit    0d4h
    2687    2428   00AE7                         rs0    bit    0d3h
    2688    2429   00AE7                         ov     bit    0d2h
    2689    2430   00AE7                         f1     bit    0d1h
    2690    2431   00AE7                         p      bit    0d0h
    2691    2432   00AE7                  
    2692    2433   00AE7                  acc           data   0e0h          ;accumulator                       reset=000h
    2693    2434   00AE7                  ;acc is bit addressable
    2694    2435   00AE7                  
    2695    2436   00AE7                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2696    2437   00AE7                  ;ien1 is bit addressable
    2697    2438   00AE7                         eccip3 bit    0efh
    2698    2439   00AE7                         eccip2 bit    0eeh
    2699    2440   00AE7                         eccip1 bit    0edh
    2700    2441   00AE7                         eccip0 bit    0ech
    2701    2442   00AE7                         exm    bit    0ebh
    2702    2443   00AE7                         ex2    bit    0eah
    2703    2444   00AE7                         essc   bit    0e9h
    2704    2445   00AE7                         eadc   bit    0e8h
    2705    2446   00AE7                  
    2706    2447   00AE7                  b             data   0f0h          ;b register                        reset=000h
    2707    2448   00AE7                  ;b is bit addressable
    2708    2449   00AE7                  
    2709    2450   00AE7                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2710    2451   00AE7                  ;ip1 is bit addressable
    2711    2452   00AE7                         pccip3 bit    0ffh
    2712    2453   00AE7                         pccip2 bit    0feh
    2713    2454   00AE7                         pccip1 bit    0fdh
    2714    2455   00AE7                         pccip0 bit    0fch
    2715    2456   00AE7                         pxm    bit    0fbh
    2716    2457   00AE7                         px2    bit    0fah
    2717    2458   00AE7                         pssc   bit    0f9h
    2718    2459   00AE7                         padc   bit    0f8h
    2719    2460   00AE7                  
    2720    2461   00AE7                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2721    2462   00AE7                  
    2722    2463   00AE7                  
    2723    2464   00AE7                  ;*******************************************************************************
    2724    2465   00AE7                  ;
    2725    2466   00AE7                  ; system control registers registers that can only be accessed in the non
    2726    2467   00AE7                  ; mapped memory area (rmap=0) page independent
    2727    2468   00AE7                  ;
    2728    2469   00AE7                  ;*******************************************************************************
    2729    2470   00AE7                  
    2730    2471   00AE7                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2731    2472   00AE7                  
    2732    2473   00AE7                  ;*******************************************************************************
    2733    2474   00AE7                  ;
    2734    2475   00AE7                  ; system control registers registers that can only be accessed in the non
    2735    2476   00AE7                  ; mapped memory area (rmap=0) and page 0
    2736    2477   00AE7                  ;
    2737    2478   00AE7                  ;*******************************************************************************
    2738    2479   00AE7                  
    2739    2480   00AE7                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2740    2481   00AE7                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2741    2482   00AE7                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2742    2483   00AE7                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2743    2484   00AE7                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2744    2485   00AE7                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2745    2486   00AE7                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2746    2487   00AE7                  nmisr         data   0bch          ;nmi status                        reset=000h
    2747    2488   00AE7                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2748    2489   00AE7                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2749    2490   00AE7                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2750    2491   00AE7                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2751    2492   00AE7                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2752    2493   00AE7                  
    2753    2494   00AE7                  ;*******************************************************************************
    2754    2495   00AE7                  ;
    2755    2496   00AE7                  ; system control registers registers that can only be accessed in the non
    2756    2497   00AE7                  ; mapped memory area (rmap=0) and page 1
    2757    2498   00AE7                  ;
    2758    2499   00AE7                  ;*******************************************************************************
    2759    2500   00AE7                  
    2760    2501   00AE7                  id            data   0b3h          ;identity register     reset=device dependent
    2761    2502   00AE7                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2762    2503   00AE7                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2763    2504   00AE7                  osc_con       data   0b6h          ;osc control                       reset=008h
    2764    2505   00AE7                  pll_con       data   0b7h          ;pll control                       reset=090h
    2765    2506   00AE7                  cmcon         data   0bah          ;clock control                     reset=010h
    2766    2507   00AE7                  passwd        data   0bbh          ;password register                 reset=007h
    2767    2508   00AE7                  feal          data   0bch          ;flash error register              reset=000h
    2768    2509   00AE7                  feah          data   0bdh          ;flash error address high          reset=000h
    2769    2510   00AE7                  cocon         data   0beh          ;clock output control              reset=000h
    2770    2511   00AE7                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2771    2512   00AE7                  
    2772    2513   00AE7                  ;*******************************************************************************
    2773    2514   00AE7                  ;
    2774    2515   00AE7                  ; system control registers registers that can only be accessed in the non
    2775    2516   00AE7                  ; mapped memory area (rmap=0) and page 3
    2776    2517   00AE7                  ;
    2777    2518   00AE7                  ;*******************************************************************************
    2778    2519   00AE7                  
    2779    2520   00AE7                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2780    2521   00AE7                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2781    2522   00AE7                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2782    2523   00AE7                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2783    2524   00AE7                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2784    2525   00AE7                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2785    2526   00AE7                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2786    2527   00AE7                  
    2787    2528   00AE7                  ;*******************************************************************************
    2788    2529   00AE7                  ;
    2789    2530   00AE7                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2790    2531   00AE7                  ;
    2791    2532   00AE7                  ;*******************************************************************************
    2792    2533   00AE7                  
    2793    2534   00AE7                  port_page     data   0b2h          ;port page register                reset=000h
    2794    2535   00AE7                  
    2795    2536   00AE7                  ;*******************************************************************************
    2796    2537   00AE7                  ;
    2797    2538   00AE7                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2798    2539   00AE7                  ;
    2799    2540   00AE7                  ;*******************************************************************************
    2800    2541   00AE7                  
    2801    2542   00AE7                  p0_data       data   080h          ;port 0 data register              reset=000h
    2802    2543   00AE7                  ;p0_data is bit addressable
    2803    2544   00AE7                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2804    2545   00AE7                  p1_data       data   090h          ;port 1 data register              reset=000h
    2805    2546   00AE7                  ;p1_data is bit addressable
    2806    2547   00AE7                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2807    2548   00AE7                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2808    2549   00AE7                  ;p2_data is bit addressable
    2809    2550   00AE7                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2810    2551   00AE7                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2811    2552   00AE7                  ;p3_data is bit addressable
    2812    2553   00AE7                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2813    2554   00AE7                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2814    2555   00AE7                  ;p4_data is bit addressable
    2815    2556   00AE7                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2816    2557   00AE7                  p5_data       data   092h          ;port 5 data register              reset=000h
    2817    2558   00AE7                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2818    2559   00AE7                  
    2819    2560   00AE7                  ;*******************************************************************************
    2820    2561   00AE7                  ;
    2821    2562   00AE7                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2822    2563   00AE7                  ;
    2823    2564   00AE7                  ;*******************************************************************************
    2824    2565   00AE7                  
    2825    2566   00AE7                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2826    2567   00AE7                  ;p0_data is bit addressable
    2827    2568   00AE7                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2828    2569   00AE7                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2829    2570   00AE7                  ;p1_data is bit addressable
    2830    2571   00AE7                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2831    2572   00AE7                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2832    2573   00AE7                  ;p2_data is bit addressable
    2833    2574   00AE7                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2834    2575   00AE7                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2835    2576   00AE7                  ;p3_data is bit addressable
    2836    2577   00AE7                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2837    2578   00AE7                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2838    2579   00AE7                  ;p4_data is bit addressable
    2839    2580   00AE7                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2840    2581   00AE7                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2841    2582   00AE7                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2842    2583   00AE7                  
    2843    2584   00AE7                  ;*******************************************************************************
    2844    2585   00AE7                  ;
    2845    2586   00AE7                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2846    2587   00AE7                  ;
    2847    2588   00AE7                  ;*******************************************************************************
    2848    2589   00AE7                  
    2849    2590   00AE7                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2850    2591   00AE7                  ;p0_data is bit addressable
    2851    2592   00AE7                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2852    2593   00AE7                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2853    2594   00AE7                  ;p1_data is bit addressable
    2854    2595   00AE7                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2855    2596   00AE7                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2856    2597   00AE7                  ;p3_data is bit addressable
    2857    2598   00AE7                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2858    2599   00AE7                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2859    2600   00AE7                  ;p4_data is bit addressable
    2860    2601   00AE7                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2861    2602   00AE7                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2862    2603   00AE7                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2863    2604   00AE7                  
    2864    2605   00AE7                  ;*******************************************************************************
    2865    2606   00AE7                  ;
    2866    2607   00AE7                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2867    2608   00AE7                  ;
    2868    2609   00AE7                  ;*******************************************************************************
    2869    2610   00AE7                  
    2870    2611   00AE7                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2871    2612   00AE7                  ;p0_data is bit addressable
    2872    2613   00AE7                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2873    2614   00AE7                  ;p1_data is bit addressable
    2874    2615   00AE7                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2875    2616   00AE7                  ;p3_data is bit addressable
    2876    2617   00AE7                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2877    2618   00AE7                  ;p4_data is bit addressable
    2878    2619   00AE7                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2879    2620   00AE7                  
    2880    2621   00AE7                  ;*******************************************************************************
    2881    2622   00AE7                  ;
    2882    2623   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2883    2624   00AE7                  ;
    2884    2625   00AE7                  ;*******************************************************************************
    2885    2626   00AE7                  
    2886    2627   00AE7                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2887    2628   00AE7                  
    2888    2629   00AE7                  ;*******************************************************************************
    2889    2630   00AE7                  ;
    2890    2631   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2891    2632   00AE7                  ;
    2892    2633   00AE7                  ;*******************************************************************************
    2893    2634   00AE7                  
    2894    2635   00AE7                  adc_globctr   data   0cah          ;global control register           reset=030h
    2895    2636   00AE7                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2896    2637   00AE7                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2897    2638   00AE7                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2898    2639   00AE7                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2899    2640   00AE7                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2900    2641   00AE7                  
    2901    2642   00AE7                  ;*******************************************************************************
    2902    2643   00AE7                  ;
    2903    2644   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2904    2645   00AE7                  ;
    2905    2646   00AE7                  ;*******************************************************************************
    2906    2647   00AE7                  
    2907    2648   00AE7                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2908    2649   00AE7                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2909    2650   00AE7                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2910    2651   00AE7                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2911    2652   00AE7                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2912    2653   00AE7                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2913    2654   00AE7                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2914    2655   00AE7                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2915    2656   00AE7                  
    2916    2657   00AE7                  ;*******************************************************************************
    2917    2658   00AE7                  ;
    2918    2659   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2919    2660   00AE7                  ;
    2920    2661   00AE7                  ;*******************************************************************************
    2921    2662   00AE7                  
    2922    2663   00AE7                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2923    2664   00AE7                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2924    2665   00AE7                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2925    2666   00AE7                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2926    2667   00AE7                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2927    2668   00AE7                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2928    2669   00AE7                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2929    2670   00AE7                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2930    2671   00AE7                  
    2931    2672   00AE7                  ;*******************************************************************************
    2932    2673   00AE7                  ;
    2933    2674   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2934    2675   00AE7                  ;
    2935    2676   00AE7                  ;*******************************************************************************
    2936    2677   00AE7                  
    2937    2678   00AE7                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2938    2679   00AE7                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2939    2680   00AE7                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2940    2681   00AE7                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2941    2682   00AE7                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2942    2683   00AE7                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2943    2684   00AE7                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2944    2685   00AE7                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2945    2686   00AE7                  
    2946    2687   00AE7                  ;*******************************************************************************
    2947    2688   00AE7                  ;
    2948    2689   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2949    2690   00AE7                  ;
    2950    2691   00AE7                  ;*******************************************************************************
    2951    2692   00AE7                  
    2952    2693   00AE7                  adc_rcr0      data   0cah          ;result control register           reset=000h
    2953    2694   00AE7                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    2954    2695   00AE7                  adc_rcr2      data   0cch          ;result control register           reset=000h
    2955    2696   00AE7                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    2956    2697   00AE7                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    2957    2698   00AE7                  
    2958    2699   00AE7                  ;*******************************************************************************
    2959    2700   00AE7                  ;
    2960    2701   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    2961    2702   00AE7                  ;
    2962    2703   00AE7                  ;*******************************************************************************
    2963    2704   00AE7                  
    2964    2705   00AE7                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    2965    2706   00AE7                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    2966    2707   00AE7                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    2967    2708   00AE7                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    2968    2709   00AE7                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    2969    2710   00AE7                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    2970    2711   00AE7                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    2971    2712   00AE7                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    2972    2713   00AE7                  
    2973    2714   00AE7                  ;*******************************************************************************
    2974    2715   00AE7                  ;
    2975    2716   00AE7                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    2976    2717   00AE7                  ;
    2977    2718   00AE7                  ;*******************************************************************************
    2978    2719   00AE7                  
    2979    2720   00AE7                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    2980    2721   00AE7                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    2981    2722   00AE7                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    2982    2723   00AE7                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    2983    2724   00AE7                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    2984    2725   00AE7                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    2985    2726   00AE7                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    2986    2727   00AE7                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    2987    2728   00AE7                  
    2988    2729   00AE7                  ;*******************************************************************************
    2989    2730   00AE7                  
    2990    2731   00AE7                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    2991    2732   00AE7                  ;
    2992    2733   00AE7                  ;*******************************************************************************
    2993    2734   00AE7                  
    2994    2735   00AE7                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    2995    2736   00AE7                  ;t2_t2con is bit addressable
    2996    2737   00AE7                         tf2    bit    0c7h
    2997    2738   00AE7                         exf2   bit    0c6h
    2998    2739   00AE7                                                     ;2 bits are not implemented
    2999    2740   00AE7                         exen2  bit    0c3h
    3000    2741   00AE7                         tr2    bit    0c2h
    3001    2742   00AE7                         ct2    bit    0c1h
    3002    2743   00AE7                         cprl2  bit    0c0h
    3003    2744   00AE7                  
    3004    2745   00AE7                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3005    2746   00AE7                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3006    2747   00AE7                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3007    2748   00AE7                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3008    2749   00AE7                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3009    2750   00AE7                  
    3010    2751   00AE7                  ;*******************************************************************************
    3011    2752   00AE7                  ;
    3012    2753   00AE7                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3013    2754   00AE7                  ;
    3014    2755   00AE7                  ;*******************************************************************************
    3015    2756   00AE7                  
    3016    2757   00AE7                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3017    2758   00AE7                  
    3018    2759   00AE7                  ;*******************************************************************************
    3019    2760   00AE7                  ;
    3020    2761   00AE7                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3021    2762   00AE7                  ;
    3022    2763   00AE7                  ;*******************************************************************************
    3023    2764   00AE7                  
    3024    2765   00AE7                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3025    2766   00AE7                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3026    2767   00AE7                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3027    2768   00AE7                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3028    2769   00AE7                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3029    2770   00AE7                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3030    2771   00AE7                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3031    2772   00AE7                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3032    2773   00AE7                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3033    2774   00AE7                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3034    2775   00AE7                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3035    2776   00AE7                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3036    2777   00AE7                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3037    2778   00AE7                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3038    2779   00AE7                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3039    2780   00AE7                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3040    2781   00AE7                  
    3041    2782   00AE7                  ;*******************************************************************************
    3042    2783   00AE7                  ;
    3043    2784   00AE7                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3044    2785   00AE7                  ;
    3045    2786   00AE7                  ;*******************************************************************************
    3046    2787   00AE7                  
    3047    2788   00AE7                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3048    2789   00AE7                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3049    2790   00AE7                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3050    2791   00AE7                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3051    2792   00AE7                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3052    2793   00AE7                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3053    2794   00AE7                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3054    2795   00AE7                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3055    2796   00AE7                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3056    2797   00AE7                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3057    2798   00AE7                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3058    2799   00AE7                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3059    2800   00AE7                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3060    2801   00AE7                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3061    2802   00AE7                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3062    2803   00AE7                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3063    2804   00AE7                  
    3064    2805   00AE7                  ;*******************************************************************************
    3065    2806   00AE7                  ;
    3066    2807   00AE7                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3067    2808   00AE7                  ;
    3068    2809   00AE7                  ;*******************************************************************************
    3069    2810   00AE7                  
    3070    2811   00AE7                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3071    2812   00AE7                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3072    2813   00AE7                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3073    2814   00AE7                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3074    2815   00AE7                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3075    2816   00AE7                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3076    2817   00AE7                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3077    2818   00AE7                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3078    2819   00AE7                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3079    2820   00AE7                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3080    2821   00AE7                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3081    2822   00AE7                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3082    2823   00AE7                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3083    2824   00AE7                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3084    2825   00AE7                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3085    2826   00AE7                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3086    2827   00AE7                  
    3087    2828   00AE7                  ;*******************************************************************************
    3088    2829   00AE7                  ;
    3089    2830   00AE7                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3090    2831   00AE7                  ;
    3091    2832   00AE7                  ;*******************************************************************************
    3092    2833   00AE7                  
    3093    2834   00AE7                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3094    2835   00AE7                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3095    2836   00AE7                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3096    2837   00AE7                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3097    2838   00AE7                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3098    2839   00AE7                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3099    2840   00AE7                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3100    2841   00AE7                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3101    2842   00AE7                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3102    2843   00AE7                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3103    2844   00AE7                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3104    2845   00AE7                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3105    2846   00AE7                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3106    2847   00AE7                  
    3107    2848   00AE7                  ;*******************************************************************************
    3108    2849   00AE7                  ;
    3109    2850   00AE7                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3110    2851   00AE7                  ;
    3111    2852   00AE7                  ;*******************************************************************************
    3112    2853   00AE7                  
    3113    2854   00AE7                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3114    2855   00AE7                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3115    2856   00AE7                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3116    2857   00AE7                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3117    2858   00AE7                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3118    2859   00AE7                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3119    2860   00AE7                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3120    2861   00AE7                  
    3121    2862   00AE7                  ;*******************************************************************************
    3122    2863   00AE7                  ;
    3123    2864   00AE7                  ; can registers can be accessed in the standard memory map (rmap=0)
    3124    2865   00AE7                  ;
    3125    2866   00AE7                  ;*******************************************************************************
    3126    2867   00AE7                  
    3127    2868   00AE7                  adcon         data   0d8h          ;adres/data control                reset=000h
    3128    2869   00AE7                  ; adcon is bit addressable
    3129    2870   00AE7                         v3     bit    0dfh
    3130    2871   00AE7                         v2     bit    0deh
    3131    2872   00AE7                         v1     bit    0ddh
    3132    2873   00AE7                         v0     bit    0dch
    3133    2874   00AE7                         auad1  bit    0dbh
    3134    2875   00AE7                         auad0  bit    0dah
    3135    2876   00AE7                         can_bsy bit   0d9h
    3136    2877   00AE7                         rwen   bit    0d8h
    3137    2878   00AE7                  
    3138    2879   00AE7                  adl           data   0d9h          ;adres register low                reset=000h
    3139    2880   00AE7                  adh           data   0dah          ;adres register low                reset=000h
    3140    2881   00AE7                  data0         data   0dbh          ;can data                          reset=000h
    3141    2882   00AE7                  data1         data   0dch          ;can data                          reset=000h
    3142    2883   00AE7                  data2         data   0ddh          ;can data                          reset=000h
    3143    2884   00AE7                  data3         data   0deh          ;can data                          reset=000h
    3144    2885   00AE7                  
    3145    2886   00AE7                  ;*******************************************************************************
    3146    2887   00AE7                  ;
    3147    2888   00AE7                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3148    2889   00AE7                  ;
    3149    2890   00AE7                  ;*******************************************************************************
    3150    2891   00AE7                  
    3151    2892   00AE7                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3152    2893   00AE7                  ;mdustat is bit addressable
    3153    2894   00AE7                                                     ;5 bits are not implemented
    3154    2895   00AE7                         bsy    bit    0b2h
    3155    2896   00AE7                         ierr   bit    0b1h
    3156    2897   00AE7                         irdy   bit    0b0h
    3157    2898   00AE7                  
    3158    2899   00AE7                  mducon        data   0b1h          ;mdu control                       reset=000h
    3159    2900   00AE7                  md0           data   0b2h          ;mdu operand register              reset=000h
    3160    2901   00AE7                  mr0           data   0b2h          ;mdu result register               reset=000h
    3161    2902   00AE7                  md1           data   0b3h          ;mdu operand register              reset=000h
    3162    2903   00AE7                  mr1           data   0b3h          ;mdu result register               reset=000h
    3163    2904   00AE7                  md2           data   0b4h          ;mdu operand register              reset=000h
    3164    2905   00AE7                  mr2           data   0b4h          ;mdu result register               reset=000h
    3165    2906   00AE7                  md3           data   0b5h          ;mdu operand register              reset=000h
    3166    2907   00AE7                  mr3           data   0b5h          ;mdu result register               reset=000h
    3167    2908   00AE7                  md4           data   0b6h          ;mdu operand register              reset=000h
    3168    2909   00AE7                  mr4           data   0b6h          ;mdu result register               reset=000h
    3169    2910   00AE7                  md5           data   0b7h          ;mdu operand register              reset=000h
    3170    2911   00AE7                  mr5           data   0b7h          ;mdu result register               reset=000h
    3171    2912   00AE7                  
    3172    2913   00AE7                  ;*******************************************************************************
    3173    2914   00AE7                  ;
    3174    2915   00AE7                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3175    2916   00AE7                  ;
    3176    2917   00AE7                  ;*******************************************************************************
    3177    2918   00AE7                  
    3178    2919   00AE7                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3179    2920   00AE7                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3180    2921   00AE7                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3181    2922   00AE7                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3182    2923   00AE7                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3183    2924   00AE7                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3184    2925   00AE7                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3185    2926   00AE7                  ;cd_statc is bit addressable
    3186    2927   00AE7                         keepz  bit    0a7h
    3187    2928   00AE7                         keepy  bit    0a6h
    3188    2929   00AE7                         keepx  bit    0a5h
    3189    2930   00AE7                         dmap   bit    0a4h
    3190    2931   00AE7                         int_en bit    0a3h
    3191    2932   00AE7                         eoc    bit    0a2h
    3192    2933   00AE7                         error  bit    0a1h
    3193    2934   00AE7                         cd_bsy bit    0a0h
    3194    2935   00AE7                  
    3195    2936   00AE7                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3196    2937   00AE7                  
    3197    2938   00AE7                  ;*******************************************************************************
    3198    2939   00AE7                  ;
    3199    2940   00AE7                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3200    2941   00AE7                  ;
    3201    2942   00AE7                  ;*******************************************************************************
    3202    2943   00AE7                  
    3203    2944   00AE7                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3204    2945   00AE7                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3205    2946   00AE7                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3206    2947   00AE7                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3207    2948   00AE7                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3208    2949   00AE7                  
    3209    2950   00AE7                  ;*******************************************************************************
    3210    2951   00AE7                  ;
    3211    2952   00AE7                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3212    2953   00AE7                  ;
    3213    2954   00AE7                  ;*******************************************************************************
    3214    2955   00AE7                  
    3215    2956   00AE7                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3216    2957   00AE7                  ;t2_t2con is bit addressable bits are aalready defined
    3217    2958   00AE7                         ;tf2    bit    0c7h
    3218    2959   00AE7                         ;exf2   bit    0c6h
    3219    2960   00AE7                                                     ;2 bits are not implemented
    3220    2961   00AE7                         ;exen2  bit    0c3h
    3221    2962   00AE7                         ;tr2    bit    0c2h
    3222    2963   00AE7                         ;ct2    bit    0c1h
    3223    2964   00AE7                         ;cprl2  bit    0c0h
    3224    2965   00AE7                  
    3225    2966   00AE7                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3226    2967   00AE7                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3227    2968   00AE7                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3228    2969   00AE7                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3229    2970   00AE7                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3230    2971   00AE7                  
    3231    2972   00AE7                  ;*******************************************************************************
    3232    2973   00AE7                  ;
    3233    2974   00AE7                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3234    2975   00AE7                  ;
    3235    2976   00AE7                  ;*******************************************************************************
    3236    2977   00AE7                  
    3237    2978   00AE7                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3238    2979   00AE7                  ;s1con is bit addressable
    3239    2980   00AE7                         sm01   bit    0cfh
    3240    2981   00AE7                         sm11   bit    0ceh
    3241    2982   00AE7                         sm21   bit    0cdh
    3242    2983   00AE7                         ren1   bit    0cch
    3243    2984   00AE7                         tb81   bit    0cbh
    3244    2985   00AE7                         rb81   bit    0cah
    3245    2986   00AE7                         ti1    bit    0c9h
    3246    2987   00AE7                         ri1    bit    0c8h
    3247    2988   00AE7                  
    3248    2989   00AE7                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3249    2990   00AE7                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3250    2991   00AE7                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3251    2992   00AE7                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3252    2993   00AE7                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3253    2994   00AE7                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3254    2995   00AE7                  
    3255    2996   00AE7                  ;*******************************************************************************
    3256    2997   00AE7                  ;
    3257    2998   00AE7                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3258    2999   00AE7                  ;
    3259    3000   00AE7                  ;*******************************************************************************
    3260    3001   00AE7                  
    3261    3002   00AE7                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3262    3003   00AE7                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3263    3004   00AE7                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3264    3005   00AE7                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3265    3006   00AE7                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3266    3007   00AE7                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3267    3008   00AE7                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3268    3009   00AE7                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3269    3010   00AE7                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3270    3011   00AE7                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3271    3012   00AE7                  
    3272    3013   00AE7                  ;end directive must be used, but has no signification
    3273    3014   00AE7                  
    3274    3015   00AE7                  end
    3275    3016   00AE7                  
    3276    3017   00AE7                  
    3277    3018   00AE7                  
    3278    3019   00AE7                  
    3279    3020   00AE7                  
    3280    3021   00AE7                  
    3281    3022   00AE7                  
    3282    3023   00AE7                  
    3283    3024   00AE7                  
    3284    3025   00AE7                  
    3285    3026   00AE7                  
    3286    3027   00AE7                  
    3287    3028   00AE7                  
    3288    3029   00AE7                  
    3289    3030   00AE7                  
    3290    3031   00AE7                  
