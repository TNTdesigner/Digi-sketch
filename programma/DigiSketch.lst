C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  org 0000h
       2       2   00000 12000F           lcall   main
       3       3   00003                  
       4       4   0000B                  org 000bh
       5       5   0000B 12000E           lcall   timer
       6       6   0000E                  
       7       7   0000E                  timer:
       8       8   0000E                  
       9       9   0000E 32               reti
      10      10   0000F                  
      11      11   0000F                  ;------------------------------------------------------------------
      12      12   0000F                  ;Hoofd programma
      13      13   0000F                  ;------------------------------------------------------------------
      14      14   0000F                  main:
      15      15   0000F 75817F               mov     sp,#7fh                 ;stackpointer instellen
      16      16   00012 120A70               lcall   XCsw2xtal               ;overschakelen naar xristal 8MHz
      17      17   00015 12001B               lcall   inits
      18      18   00018                  
      19      19   00018                  
      20      20   00018                  lus2:
      21      21   00018                  
      22      22   00018 020018               ljmp    lus2
      23      23   0001B                  
      24      24   0001B                  
      25      25   0001B                  
      26      26   0001B                  ;------------------------------------------------------------------
      27      27   0001B                  ;Initializatie van alle componenten nodig in het hoofd programma
      28      28   0001B                  ;------------------------------------------------------------------
      29      29   0001B                  inits:
      30      30   0001B 120043               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      31      31   0001E                  
      32      32   0001E 22               ret
      33      33   0001F                  
      34      34   0001F                  
project.inc 
      36       1   0001F                  ;------------------------------------------------------------------
      37       2   0001F                  ;Lijst van functies:
      38       3   0001F                  ;   -statusCheck            Status check van scherm opslaan in STA register
      39       4   0001F                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      40       5   0001F                  ;   -P1out                  Initializatie poort 1 als output
      41       6   0001F                  ;   -P3in                   Initializatie poort 3 als output
      42       7   0001F                  ;   -P3out                  Initializatie poort 3 als input
      43       8   0001F                  ;   -zendData               Data verzeden naar scherm
      44       9   0001F                  ;   -zenComando             Comando verzeden naar scherm
      45      10   0001F                  ;   -debug                  debug info op seriele poot zetten
      46      11   0001F                  ;------------------------------------------------------------------
      47      12   0001F                  ;------------------------------------------------------------------
      48      13   0001F                  ;declaratie van pinnen
      49      14   0001F                  ;------------------------------------------------------------------
      50      15   0001F                      WR          bit     p3_data.0   ;write line van scherm actief laag
      51      16   0001F                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      52      17   0001F                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      53      18   0001F                      CD          bit     p3_data.3   ;Command write
      54      19   0001F                      RESET       bit     p2_data.1   ;reset van scherm actief laag
      55      20   0001F                      FS          bit     p2_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      56      21   0001F                  
      57      22   0001F                  
      58      23   0001F                  
      59      24   0001F                  ;------------------------------------------------------------------
      60      25   0001F                  ;declaratie van registers
      61      26   0001F                  ;------------------------------------------------------------------
      62      27   0001F                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      63      28   0001F                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      64      29   0001F                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      65      30   0001F                  
      66      31   0001F                  
      67      32   0001F                  ;------------------------------------------------------------------
      68      33   0001F                  ;Status check van scherm opslaan in STA register
      69      34   0001F                  ;-STA
      70      35   0001F                  ;------------------------------------------------------------------
      71      36   0001F                  statusCheck:
      72      37   0001F C0E0                 push    acc
      73      38   00021 C0D0                 push    psw
      74      39   00023 1200E5               lcall   P4in                        ;poort 4 als input schakelen
      75      40   00026 1200C1               lcall   P3out
      76      41   00029                  STAOPNIEUW:
      77      42   00029 751000               mov     STA,#00h                    ;STA register leeg maken
      78      43   0002C 75B00E               mov     p3_data,#00001110b
      79      44   0002F E5C8                 mov     a,p4_data                   ;status word inlezen
      80      45   00031 5403                 anl     a,#00000011b                ;masker voor STA0 en STA1
      81      46   00033 F8                   mov     r0,a                        ;debug status op aurt zetten
      82      47   00034 12013E               lcall   debug
      83      48   00037 B403EF               cjne    a,#00000011b,STAOPNIEUW      ;vergelijken
      84      49   0003A F510                 mov     STA,a                       ;data opslaan in STA voor eventuel gebruik later
      85      50   0003C C2B2                 clr     CE
      86      51   0003E D0D0                 pop     psw
      87      52   00040 D0E0                 pop     acc
      88      53   00042 22               ret
      89      54   00043                  
      90      55   00043                  ;------------------------------------------------------------------
      91      56   00043                  ;Initializatie van grafisch LCD scherm
      92      57   00043                  ;-Poort 1
      93      58   00043                  ;------------------------------------------------------------------
      94      59   00043                  initGLCD:
      95      60   00043 1200AF               lcall   P2out                   ;poort 1 initializeren
      96      61   00046 75A000               mov     p2_data,#000h
      97      62   00049 C2A1                 clr     RESET                   ;reseten van scherm
      98      63   0004B 7450                 mov     a,#50h                   ;reset lang genenoeg laten duren
      99      64   0004D 1202D0               lcall   delaya0k05s
     100      65   00050 D2A0                 setb    FS                      ;font op 6*8 zetten
     101      66   00052 D2A1                 setb    RESET                   ;reset terug af zetten
     102      67   00054                  
     103      68   00054                  
     104      69   00054 120509               lcall   initsio                 ;voor debug
     105      70   00057                  
     106      71   00057 12001F               lcall   statusCheck             ;initiele status check uitvoeren
     107      72   0005A                  
     108      73   0005A 751100               mov     DATAREG,#00h            ;grafisch home adres
     109      74   0005D 120100               lcall   zendData
     110      75   00060 751100               mov     DATAREG,#00h
     111      76   00063 120100               lcall   zendData
     112      77   00066 751242               mov     COMANDREG,#42h
     113      78   00069 12011F               lcall   zendComando
     114      79   0006C                  
     115      80   0006C 75111E               mov     DATAREG,#1eh            ;Grafic aeria set
     116      81   0006F 120100               lcall   zendData
     117      82   00072 751100               mov     DATAREG,#00h
     118      83   00075 120100               lcall   zendData
     119      84   00078 751243               mov     COMANDREG,#43h
     120      85   0007B 12011F               lcall   zendComando
     121      86   0007E                  
     122      87   0007E                  
     123      88   0007E 751100               mov     DATAREG,#00h            ;text home aderes
     124      89   00081 120100               lcall   zendData
     125      90   00084 751100               mov     DATAREG,#00h
     126      91   00087 120100               lcall   zendData
     127      92   0008A 751240               mov     COMANDREG,#40h
     128      93   0008D 12011F               lcall   zendComando
     129      94   00090                  
     130      95   00090 75111E               mov     DATAREG,#1eh            ;aantal colommen text
     131      96   00093 120100               lcall   zendData
     132      97   00096 751100               mov     DATAREG,#00h
     133      98   00099 120100               lcall   zendData
     134      99   0009C 751241               mov     COMANDREG,#41h
     135     100   0009F 12011F               lcall   zendComando
     136     101   000A2                  
     137     102   000A2 751280               mov     COMANDREG,#80h
     138     103   000A5 12011F               lcall   zendComando
     139     104   000A8                  
     140     105   000A8 75129E               mov     COMANDREG,#9Eh
     141     106   000AB 12011F               lcall   zendComando
     142     107   000AE 22               ret
     143     108   000AF                  
     144     109   000AF                  
     145     110   000AF                  ;------------------------------------------------------------------
     146     111   000AF                  ;Initializatie poort 1 als output
     147     112   000AF                  ;-poort 1
     148     113   000AF                  ;------------------------------------------------------------------
     149     114   000AF                  P2out:
     150     115   000AF C08F                 push    syscon0                 ;juiste map selecteren
     151     116   000B1 758F04               mov     syscon0,#004h
     152     117   000B4 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     153     118   000B6 75B200               mov     port_page,#000h         ;selecteer poort page 0
     154     119   000B9 75A1FF               mov     p2_dir,#0ffh            ;poort 1 als output schakelen
     155     120   000BC D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     156     121   000BE D08F                 pop     syscon0                 ;pagina terug herstellen
     157     122   000C0 22               ret
     158     123   000C1                  
     159     124   000C1                  ;------------------------------------------------------------------
     160     125   000C1                  ;Initializatie poort 3 als output
     161     126   000C1                  ;-poort 3
     162     127   000C1                  ;------------------------------------------------------------------
     163     128   000C1                  P3out:
     164     129   000C1 C08F                 push    syscon0                 ;juiste map selecteren
     165     130   000C3 758F04               mov     syscon0,#004h
     166     131   000C6 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     167     132   000C8 75B200               mov     port_page,#000h         ;selecteer poort page 0
     168     133   000CB 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output schakelen
     169     134   000CE D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     170     135   000D0 D08F                 pop     syscon0                 ;pagina terug herstellen
     171     136   000D2 22               ret
     172     137   000D3                  
     173     138   000D3                  ;------------------------------------------------------------------
     174     139   000D3                  ;Initializatie poort 5 als output
     175     140   000D3                  ;-poort 5
     176     141   000D3                  ;------------------------------------------------------------------
     177     142   000D3                  P4out:
     178     143   000D3 C08F                 push    syscon0                 ;juiste map selecteren
     179     144   000D5 758F04               mov     syscon0,#004h
     180     145   000D8 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     181     146   000DA 75B200               mov     port_page,#000h         ;selecteer poort page 0
     182     147   000DD 75C9FF               mov     p4_dir,#0ffh            ;poort 5 als output schakelen
     183     148   000E0 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     184     149   000E2 D08F                 pop     syscon0                 ;pagina terug herstellen
     185     150   000E4 22               ret
     186     151   000E5                  
     187     152   000E5                  ;------------------------------------------------------------------
     188     153   000E5                  ;Initializatie poort 4 als input
     189     154   000E5                  ;-poort 4
     190     155   000E5                  ;------------------------------------------------------------------
     191     156   000E5                  P4in:
     192     157   000E5 C08F             push   syscon0              ;juiste map selecteren
     193     158   000E7 758F04                         mov    syscon0,#004h
     194     159   000EA C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     195     160   000EC 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     196     161   000EF 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     197     162   000F2 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     198     163   000F5 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     199     164   000F8 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     200     165   000FB D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     201     166   000FD D08F                           pop    syscon0              ;pagina terug herstellen
     202     167   000FF 22                             ret
     203     168   00100                  ;------------------------------------------------------------------
     204     169   00100                  ;Data verzeden naar scherm
     205     170   00100                  ;-DATAREG
     206     171   00100                  ;------------------------------------------------------------------
     207     172   00100                  zendData:
     208     173   00100 C0E0                 push    acc
     209     174   00102 C0D0                 push    psw
     210     175   00104 12001F               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     211     176   00107 1200D3               lcall   P4out                   ;poort 5 als output schakelen
     212     177   0010A 8511C8               mov     p4_data,DATAREG               ;data op de poort zetten
     213     178   0010D 75B009               mov     p3_data,#00001001b
     214     179   00110 1202E9               lcall   delay1ms
     215     180   00113 C2B2                 clr     CE
     216     181   00115 A811                 mov     r0,DATAREG
     217     182   00117 12013E               lcall   debug
     218     183   0011A D0D0                 pop     psw
     219     184   0011C D0E0                 pop     acc
     220     185   0011E 22               ret
     221     186   0011F                  
     222     187   0011F                  ;------------------------------------------------------------------
     223     188   0011F                  ;Comando verzeden naar scherm
     224     189   0011F                  ;-COMANDREG
     225     190   0011F                  ;------------------------------------------------------------------
     226     191   0011F                  zendComando:
     227     192   0011F C0E0                 push    acc
     228     193   00121 C0D0                 push    psw
     229     194   00123 12001F               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     230     195   00126 1200D3               lcall   P4out                   ;poort 5 als output schakelen
     231     196   00129 8512C8               mov     p4_data,COMANDREG       ;data op de poort zetten
     232     197   0012C 75B00E               mov     p3_data,#00001110b
     233     198   0012F 1202E9               lcall   delay1ms
     234     199   00132 C2B2                 clr     CE
     235     200   00134 A812                 mov     r0,COMANDREG
     236     201   00136 12013E               lcall   debug
     237     202   00139 D0D0                 pop     psw
     238     203   0013B D0E0                 pop     acc
     239     204   0013D 22               ret
     240     205   0013E                  
     241     206   0013E                  ;------------------------------------------------------------------
     242     207   0013E                  ;debug info op seriele poort zetten
     243     208   0013E                  ;-r0
     244     209   0013E                  ;------------------------------------------------------------------
     245     210   0013E                  debug:
     246     211   0013E C0E0                 push    acc
     247     212   00140 C0D0                 push    psw
     248     213   00142 740D                 mov     a,#0dh
     249     214   00144 120541               lcall   siooutchar
     250     215   00147 E8                   mov     a,r0
     251     216   00148 12055D               lcall   siooutbyte
     252     217   0014B 740A                 mov     a,#0ah
     253     218   0014D 120541               lcall   siooutchar
     254     219   00150 D0D0                 pop     psw
     255     220   00152 D0E0                 pop     acc
     256     221   00154 22               ret
     257     222   00155                  
     258     223   00155                  
     259     224   00155                  
     260     225   00155                  
     261     226   00155                  
     262     227   00155                  
     263     228   00155                  
     264     229   00155                  
     265     230   00155                  
     266     231   00155                  
     267     232   00155                  
     268     233   00155                  
     269     234   00155                  
     270     235   00155                  
     271     236   00155                  
     272     237   00155                  
     273     238   00155                  
     274     239   00155                  
     275     240   00155                  
     276     241   00155                  
xcez1.inc 
     278       1   00155                  ;*******************************************************************************
     279       2   00155                  ;
     280       3   00155                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     281       4   00155                  ;
     282       5   00155                  ; The file contains drivers for various hardware and math applications.
     283       6   00155                  ; In addition all register declarations are added.
     284       7   00155                  ;
     285       8   00155                  ; WARNING:!!!!!!!
     286       9   00155                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     287      10   00155                  ;
     288      11   00155                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     289      12   00155                  ;
     290      13   00155                  ;*******************************************************************************
     291      14   00155                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     292      15   00155                  ;
     293      16   00155                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     294      17   00155                  ;
     295      18   00155                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     296      19   00155                  ; eenvoudige manier te gebruiken:
     297      20   00155                  ;
     298      21   00155                  ; standaard I/O:
     299      22   00155                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     300      23   00155                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     301      24   00155                  ;      initleds             klaar zetten LED's als outputs
     302      25   00155                  ;
     303      26   00155                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     304      27   00155                  ;      initiic              klaar zetten iic interface
     305      28   00155                  ;      iicstart             genereren van een startconditie op iic poort
     306      29   00155                  ;      iicstop              genereren stop conditie op iic poort
     307      30   00155                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     308      31   00155                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     309      32   00155                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     310      33   00155                  ;
     311      34   00155                  ; LCD interace
     312      35   00155                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     313      36   00155                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     314      37   00155                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     315      38   00155                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     316      39   00155                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     317      40   00155                  ;      lcdlighton           backlight aan
     318      41   00155                  ;      lcdlightoff          backlight uit
     319      42   00155                  ;      lcdbuzon             buzzer aan
     320      43   00155                  ;      lcdbuzof             buzzer uit
     321      44   00155                  ;
     322      45   00155                  ; Seriële interface (via USB stekker!!)
     323      46   00155                  ;      initsio              klaar zetten seriële poort 9600 baud
     324      47   00155                  ;      siooutchar           afdrukken ascii code (accu=input)
     325      48   00155                  ;      siooutbyte           afdrkken getal in accu
     326      49   00155                  ;      siooutnib            afdrukken 4 laagste bits accu
     327      50   00155                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     328      51   00155                  ;      sioinchar            inlezen van 1 ascii code in de accu
     329      52   00155                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     330      53   00155                  ;
     331      54   00155                  ; ADC
     332      55   00155                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     333      56   00155                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     334      57   00155                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     335      58   00155                  ;
     336      59   00155                  ; Arithmetic:
     337      60   00155                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     338      61   00155                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     339      62   00155                  ;      div16                delen 2 16 bit getallen
     340      63   00155                  ;      div32                delen 2 32 bit getallen
     341      64   00155                  ;      add16                optellen 2 16 bit getallen
     342      65   00155                  ;      add32                optellen 2 32 bit getallen
     343      66   00155                  ;      sub16                verschil 2 16 bit getallen
     344      67   00155                  ;      sub32                verschil 2 32 bit getallen
     345      68   00155                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     346      69   00155                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     347      70   00155                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     348      71   00155                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     349      72   00155                  ;
     350      73   00155                  ; Diverse
     351      74   00155                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     352      75   00155                  ;      delay1ms             tijdsverraging 1 milliseconde
     353      76   00155                  ;      delay10us            tijdsvertraging 10 microseconde
     354      77   00155                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     355      78   00155                  ;	mapregs 		selecteer de SFR's in de mapped area
     356      79   00155                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     357      80   00155                  ;
     358      81   00155                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     359      82   00155                  ; LET OP!!!!
     360      83   00155                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     361      84   00155                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     362      85   00155                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     363      86   00155                  ;
     364      87   00155                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     365      88   00155                  ;
     366      89   00155                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     367      90   00155                  
     368      91   00155                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     369      92   00155                  ;
     370      93   00155                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     371      94   00155                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     372      95   00155                  ; massa zonder extra weerstanden.
     373      96   00155                  ;
     374      97   00155                  ; Gebruikt geen registers
     375      98   00155                  ;
     376      99   00155                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     377     100   00155                  
     378     101   00155 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     379     102   00157 758F04                         mov    syscon0,#004h
     380     103   0015A C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     381     104   0015C 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     382     105   0015F 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     383     106   00162 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     384     107   00165 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     385     108   00168 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     386     109   0016B D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     387     110   0016D D08F                           pop    syscon0              ;pagina terug herstellen
     388     111   0016F 22                             ret
     389     112   00170                  
     390     113   00170                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     391     114   00170                  ;
     392     115   00170                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     393     116   00170                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     394     117   00170                  ; 2 behouden hun originele instelling.
     395     118   00170                  ;
     396     119   00170                  ; Gebruikt geen registers
     397     120   00170                  ;
     398     121   00170                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     399     122   00170                  
     400     123   00170 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     401     124   00172 758F04                         mov    syscon0,#004h
     402     125   00175 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     403     126   00177 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     404     127   0017A 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     405     128   0017D 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     406     129   00180 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     407     130   00183 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     408     131   00186 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     409     132   00188 D08F                           pop    syscon0              ;pagina terug herstellen
     410     133   0018A 22                             ret
     411     134   0018B                  
     412     135   0018B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     413     136   0018B                  ;
     414     137   0018B                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     415     138   0018B                  ; worden gedoofd (actief laag om ze te laden branden).
     416     139   0018B                  ;
     417     140   0018B                  ; Gebruikt geen registers
     418     141   0018B                  ;
     419     142   0018B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     420     143   0018B                  
     421     144   0018B                  
     422     145   0018B C08F             initleds:     push   syscon0              ;juiste map selecteren
     423     146   0018D 758F04                         mov    syscon0,#004h
     424     147   00190 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     425     148   00192 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     426     149   00195 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     427     150   00198 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     428     151   0019A D08F                           pop    syscon0              ;pagina terug herstellen
     429     152   0019C 22                             ret
     430     153   0019D                  
     431     154   0019D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     432     155   0019D                  ;
     433     156   0019D                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     434     157   0019D                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     435     158   0019D                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     436     159   0019D                  ; sda wordt als input geschakeld
     437     160   0019D                  ;
     438     161   0019D                  ; LET OP!!
     439     162   0019D                  ; Dit is een IIC bus met beperkte mogelijkheden:
     440     163   0019D                  ; -vaste communicatiesnleheid van 100kbit/s
     441     164   0019D                  ; -enkel master mode
     442     165   0019D                  ; -enkel 7 bit adressering
     443     166   0019D                  ; -geen klok stretching
     444     167   0019D                  ;
     445     168   0019D                  ; Gebruikt geen registers
     446     169   0019D                  ;
     447     170   0019D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     448     171   0019D                  
     449     172   0019D                  sda           bit    p0_data.7            ;pin gebruikt als sda
     450     173   0019D                  scl           bit    p0_data.3            ;pin gebruikt als scl
     451     174   0019D                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     452     175   0019D                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     453     176   0019D                  
     454     177   0019D C08F             initiic:      push   syscon0              ;juiste map selecteren
     455     178   0019F 758F04                         mov    syscon0,#004h
     456     179   001A2 C0B2                           push   port_page
     457     180   001A4 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     458     181   001A7 D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     459     182   001A9 D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     460     183   001AB 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     461     184   001AE D283                           setb   scl                  ;klok werkt als od
     462     185   001B0 D287                           setb   sda                  ;sda werkt als od
     463     186   001B2 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     464     187   001B5 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     465     188   001B8 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     466     189   001BB D0B2                           pop    port_page            ;pagina herstellen
     467     190   001BD D08F                           pop    syscon0              ;map herstellen
     468     191   001BF 22                             ret
     469     192   001C0                  
     470     193   001C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     471     194   001C0                  ;
     472     195   001C0                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     473     196   001C0                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     474     197   001C0                  ; te garanderen volgt er een delay van 10us
     475     198   001C0                  ;
     476     199   001C0                  ; Gebruikt geen registers
     477     200   001C0                  ;
     478     201   001C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     479     202   001C0                  
     480     203   001C0 C08F             iicstart:     push   syscon0              ;map bewaren
     481     204   001C2 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     482     205   001C5 C0B2                           push   port_page            ;pagina bewaren
     483     206   001C7 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     484     207   001CA D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     485     208   001CC D287                           setb   sda                  ;idem
     486     209   001CE 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     487     210   001D1 1202C1                         lcall  delay10us            ;
     488     211   001D4 C287                           clr    sda                  ;data laag
     489     212   001D6 1202C1                         lcall  delay10us
     490     213   001D9 C283                           clr    scl                  ;dan klok laag
     491     214   001DB 1202C1                         lcall  delay10us            ;bit lang genoeg maken
     492     215   001DE D0B2                           pop    port_page            ;registers herstellen
     493     216   001E0 D08F                           pop    syscon0
     494     217   001E2 22                             ret
     495     218   001E3                  
     496     219   001E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     497     220   001E3                  ;
     498     221   001E3                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     499     222   001E3                  ;
     500     223   001E3                  ; Gebruikt geen registers
     501     224   001E3                  ;
     502     225   001E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     503     226   001E3                  
     504     227   001E3 C08F             iicstop:      push   syscon0              ;map bewaren
     505     228   001E5 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     506     229   001E8 C0B2                           push   port_page            ;pagina bewaren
     507     230   001EA 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     508     231   001ED 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     509     232   001F0 C287                           clr    sda                  ;data naar omlaag
     510     233   001F2 1202C1                         lcall  delay10us
     511     234   001F5 D283                           setb   scl                  ;klok naar 1
     512     235   001F7 1202C1                         lcall  delay10us            ;wachten
     513     236   001FA D287                           setb   sda                  ;idem data
     514     237   001FC 1202C1                         lcall  delay10us            ;
     515     238   001FF 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     516     239   00202 D0B2                           pop    port_page            ;registers herstellen
     517     240   00204 D08F                           pop    syscon0
     518     241   00206 22                             ret
     519     242   00207                  
     520     243   00207                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     521     244   00207                  ;
     522     245   00207                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     523     246   00207                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     524     247   00207                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     525     248   00207                  ;
     526     249   00207                  ; Gebruikt:
     527     250   00207                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     528     251   00207                  ;      cy=ack bit vanuit de slave
     529     252   00207                  ;
     530     253   00207                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     531     254   00207                  
     532     255   00207 C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     533     256   00209 C0F0                           push   b                    ;gebruikt als loopcounter
     534     257   0020B C08F                           push   syscon0              ;map juist zetten
     535     258   0020D 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     536     259   00210 C0B2                           push   port_page            ;poort pagina bewaren
     537     260   00212 75B200                         mov    port_page,#000h      ;basispagina selecteren
     538     261   00215 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     539     262   00218 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     540     263   0021B 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     541     264   0021C 9287                           mov    sda,c                ;op pin
     542     265   0021E 1202C1                         lcall  delay10us            ;wachten
     543     266   00221 D283                           setb   scl                  ;puls genereren
     544     267   00223 1202C1                         lcall  delay10us            ;ook hier wat tijd laten
     545     268   00226 C283                           clr    scl                  ;klok terug laag maken
     546     269   00228 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     547     270   0022B                  
     548     271   0022B                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     549     272   0022B                  
     550     273   0022B 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     551     274   0022E 1202C1                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     552     275   00231 D283                           setb   scl                  ;puls terug hoog
     553     276   00233 A287                           mov    c,sda                ;inlezen en naar carry
     554     277   00235 1202C1                         lcall  delay10us
     555     278   00238 C283                           clr    scl                  ;klok blijft laag achter
     556     279   0023A D0B2                           pop    port_page
     557     280   0023C D08F                           pop    syscon0
     558     281   0023E D0F0                           pop    b
     559     282   00240 D0E0                           pop    acc
     560     283   00242 22                             ret
     561     284   00243                  
     562     285   00243                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     563     286   00243                  ;
     564     287   00243                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     565     288   00243                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     566     289   00243                  ;
     567     290   00243                  ; Gebruikt:
     568     291   00243                  ;      -de accu als output
     569     292   00243                  ;
     570     293   00243                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     571     294   00243                  
     572     295   00243 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     573     296   00245 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     574     297   00248 C0B2                           push   port_page            ;pagina bewaren
     575     298   0024A 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     576     299   0024D C0F0                           push   b                    ;wordt gebruikt als loopcounter
     577     300   0024F C0D0                           push   psw                  ;vlaggen bewaren
     578     301   00251 75F008                         mov    b,#008h              ;loopcounter laden
     579     302   00254 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     580     303   00257 1202C1           iicinbyteack1:lcall  delay10us
     581     304   0025A D283                           setb   scl                  ;klok hoog
     582     305   0025C A287                           mov    c,sda                ;pin inlezen
     583     306   0025E 33                             rlc    a                    ;in accu shiften
     584     307   0025F 1202C1                         lcall  delay10us
     585     308   00262 C283                           clr    scl                  ;klok terug laag
     586     309   00264 D5F0F0                         djnz   b,iicinbyteack1
     587     310   00267 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     588     311   0026A C287                           clr    sda                  ;ack genereren
     589     312   0026C 1202C1                         lcall  delay10us
     590     313   0026F D283                           setb   scl
     591     314   00271 1202C1                         lcall  delay10us
     592     315   00274 C283                           clr    scl
     593     316   00276 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     594     317   00279 D0D0                           pop    psw                  ;registers herstellen
     595     318   0027B D0F0                           pop    b
     596     319   0027D D0B2                           pop    port_page
     597     320   0027F D08F                           pop    syscon0
     598     321   00281 22                             ret
     599     322   00282                  
     600     323   00282                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     601     324   00282                  ;
     602     325   00282                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     603     326   00282                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     604     327   00282                  ;
     605     328   00282                  ; Gebruikt:
     606     329   00282                  ;      -de accu als output
     607     330   00282                  ;
     608     331   00282                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     609     332   00282                  
     610     333   00282 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     611     334   00284 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     612     335   00287 C0B2                           push   port_page            ;pagina bewaren
     613     336   00289 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     614     337   0028C C0F0                           push   b                    ;wordt gebruikt als loopcounter
     615     338   0028E C0D0                           push   psw                  ;vlaggen bewaren
     616     339   00290 75F008                         mov    b,#008h              ;loopcounter laden
     617     340   00293 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     618     341   00296 1202C1           iicinbytenack1:lcall  delay10us
     619     342   00299 D283                           setb   scl                  ;klok hoog
     620     343   0029B A287                           mov    c,sda                ;pin inlezen
     621     344   0029D 33                             rlc    a                    ;in accu shiften
     622     345   0029E 1202C1                         lcall  delay10us
     623     346   002A1 C283                           clr    scl                  ;klok terug laag
     624     347   002A3 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     625     348   002A6 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     626     349   002A9 D287                           setb   sda                  ;nack genereren
     627     350   002AB 1202C1                         lcall  delay10us
     628     351   002AE D283                           setb   scl
     629     352   002B0 1202C1                         lcall  delay10us
     630     353   002B3 C283                           clr    scl
     631     354   002B5 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     632     355   002B8 D0D0                           pop    psw                  ;registers herstellen
     633     356   002BA D0F0                           pop    b
     634     357   002BC D0B2                           pop    port_page
     635     358   002BE D08F                           pop    syscon0
     636     359   002C0 22                             ret
     637     360   002C1                  
     638     361   002C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     639     362   002C1                  ;
     640     363   002C1                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     641     364   002C1                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     642     365   002C1                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     643     366   002C1                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     644     367   002C1                  ;
     645     368   002C1                  ; Gebruikt geen registers
     646     369   002C1                  ;
     647     370   002C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     648     371   002C1                  
     649     372   002C1 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     650     373   002C3 C0D0                           push   psw                  ;8*42ns=330ns
     651     374   002C5 75E01A                         mov    acc,#01ah            ;420ns
     652     375   002C8 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     653     376   002CB D0D0                           pop    psw                  ;8*42ns=330ns
     654     377   002CD D0E0                           pop    acc                  ;8*42ns=330ns
     655     378   002CF 22                             ret                         ;165ns
     656     379   002D0                  
     657     380   002D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     658     381   002D0                  ;
     659     382   002D0                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     660     383   002D0                  ;
     661     384   002D0                  ; Gebruikt geen registers
     662     385   002D0                  ;
     663     386   002D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     664     387   002D0                  
     665     388   002D0 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     666     389   002D2 C0D0                           push   psw
     667     390   002D4 C0F0                           push   b
     668     391   002D6 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     669     392   002D9 1202E9           delaya0k05s1: lcall  delay1ms
     670     393   002DC D5F0FA                         djnz   b,delaya0k05s1
     671     394   002DF D5E0F4                         djnz   acc,delaya0k05s2
     672     395   002E2 D0F0                           pop    b                    ;registers herstellen
     673     396   002E4 D0D0                           pop    psw
     674     397   002E6 D0E0                           pop    acc
     675     398   002E8 22                             ret
     676     399   002E9                  
     677     400   002E9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     678     401   002E9                  ;
     679     402   002E9                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     680     403   002E9                  ;
     681     404   002E9                  ; Gebruikt geen registers
     682     405   002E9                  ;
     683     406   002E9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     684     407   002E9                  
     685     408   002E9 C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     686     409   002EB C0D0                           push   psw                  ;8*42ns=330ns
     687     410   002ED 75E064                         mov    acc,#100             ;420ns
     688     411   002F0 1202C1           delay1ms1:    lcall  delay10us            ;10us
     689     412   002F3 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     690     413   002F6 D0D0                           pop    psw                  ;8*42ns=330ns
     691     414   002F8 D0E0                           pop    acc                  ;8*42ns=330ns
     692     415   002FA 22                             ret                         ;165ns
     693     416   002FB                  
     694     417   002FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     695     418   002FB                  ;
     696     419   002FB                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     697     420   002FB                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     698     421   002FB                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     699     422   002FB                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     700     423   002FB                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     701     424   002FB                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     702     425   002FB                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     703     426   002FB                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     704     427   002FB                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     705     428   002FB                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     706     429   002FB                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     707     430   002FB                  ; systemen!!!!
     708     431   002FB                  ;
     709     432   002FB                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     710     433   002FB                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     711     434   002FB                  ;       aduclcd0.inc
     712     435   002FB                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     713     436   002FB                  ;       aduclcd1.inc
     714     437   002FB                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     715     438   002FB                  ;
     716     439   002FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     717     440   002FB                  
     718     441   002FB                  e             bit    b.1                  ;enable
     719     442   002FB                  rs            bit    b.0                  ;register select
     720     443   002FB                  backlight     bit    b.6                  ;bit waar backlight op zit
     721     444   002FB                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     722     445   002FB                  
     723     446   002FB                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     724     447   002FB                  
     725     448   002FB                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     726     449   002FB                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     727     450   002FB                  
     728     451   002FB                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     729     452   002FB                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     730     453   002FB                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     731     454   002FB                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     732     455   002FB                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     733     456   002FB                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     734     457   002FB                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     735     458   002FB                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     736     459   002FB                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     737     460   002FB                  
     738     461   002FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     739     462   002FB                  ;
     740     463   002FB                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     741     464   002FB                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     742     465   002FB                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     743     466   002FB                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     744     467   002FB                  ;
     745     468   002FB                  ; registergebruik: geen
     746     469   002FB                  ;
     747     470   002FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     748     471   002FB                  
     749     472   002FB C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     750     473   002FD C0D0                           push   psw
     751     474   002FF C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     752     475   00301 12019D                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     753     476   00304 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     754     477   00307                                                            ;buzzer en baklight worden nu op 1 gezet
     755     478   00307 12049F                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     756     479   0030A 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     757     480   0030C 120498           initlcd1:     lcall  delay2ms
     758     481   0030F D5E0FA                         djnz   acc,initlcd1
     759     482   00312 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     760     483   00314 120457                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     761     484   00317 120498                         lcall  delay2ms      ;te krijgen.
     762     485   0031A 7430                           mov    a,#00110000b
     763     486   0031C 120457                         lcall  outhnibc
     764     487   0031F 120498                         lcall  delay2ms
     765     488   00322 7430                           mov    a,#00110000b
     766     489   00324 120457                         lcall  outhnibc
     767     490   00327 120498                         lcall  delay2ms
     768     491   0032A 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     769     492   0032C 120457                         lcall  outhnibc      ;hoge nibble naar het controleregister
     770     493   0032F 120498                         lcall  delay2ms      ;niet nodig volgens datasheet
     771     494   00332 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     772     495   00334 120441                         lcall  outc          ;naar display
     773     496   00337 120498                         lcall  delay2ms      ;is iets te lang volgens datasheet
     774     497   0033A 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     775     498   0033C 120441                         lcall  outc
     776     499   0033F 120498                         lcall  delay2ms      ;ook deze delay is iets te lang
     777     500   00342 7401                           mov    a,#displayon  ;clear display and home cursor
     778     501   00344 120441                         lcall  outc
     779     502   00347 120498                         lcall  delay2ms      ;deze wachttijd is bijna juist
     780     503   0034A 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     781     504   0034C 120441                         lcall  outc
     782     505   0034F 120498                         lcall  delay2ms      ;wachten weer veel te lang
     783     506   00352 D0F0                           pop    b             ;registers terug in orde zetten
     784     507   00354 D0D0                           pop    psw
     785     508   00356 D0E0                           pop    acc
     786     509   00358 22                             ret                  ;einde van de initialisatie
     787     510   00359                  
     788     511   00359                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     789     512   00359                  ;
     790     513   00359                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     791     514   00359                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     792     515   00359                  ;      00dh   =cursor in de home positie
     793     516   00359                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     794     517   00359                  ;      00ah   =cursor op tweede lijn plaatsen
     795     518   00359                  ;      001h   =cursor on blink
     796     519   00359                  ;      002h   =cursor on, no blink
     797     520   00359                  ;      003h   =cursor off
     798     521   00359                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     799     522   00359                  ;
     800     523   00359                  ; de routine gebruikt geen registers
     801     524   00359                  ;
     802     525   00359                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     803     526   00359                  
     804     527   00359                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     805     528   00359                  ; dan mag de data direct naar het dataregister van het scherm.
     806     529   00359                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     807     530   00359                  
     808     531   00359                  lcdoutchar:
     809     532   00359 C0E0             outcharlcd:   push   acc           ;registers op stack
     810     533   0035B C0D0                           push   psw
     811     534   0035D B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     812     535   00360 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     813     536   00362 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     814     537   00365 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     815     538   00367                  
     816     539   00367                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     817     540   00367                  ; Het is dus een opdracht die we moeten uitvoeren.
     818     541   00367                  
     819     542   00367 B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     820     543   0036A 7401                           mov    a,#cleardisp         ;scherm leegmaken
     821     544   0036C 120441                         lcall  outc                 ;naar controleregister
     822     545   0036F 803A                           sjmp   outcharlcde          ;afsluiten
     823     546   00371                  
     824     547   00371 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     825     548   00374 740F                           mov    a,#cursoronb         ;cursoron met blink
     826     549   00376 120441                         lcall  outc
     827     550   00379 8030                           sjmp   outcharlcde
     828     551   0037B                  
     829     552   0037B B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     830     553   0037E 740E                           mov    a,#cursoronn         ;cursoron no blink
     831     554   00380 120441                         lcall  outc
     832     555   00383 8026                           sjmp   outcharlcde
     833     556   00385                  
     834     557   00385 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     835     558   00388 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     836     559   0038A 120441                         lcall  outc
     837     560   0038D 801C                           sjmp   outcharlcde
     838     561   0038F                  
     839     562   0038F B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     840     563   00392 7402                           mov    a,#cursathom         ;cursor in home positie
     841     564   00394 120441                         lcall  outc
     842     565   00397 8012                           sjmp   outcharlcde
     843     566   00399                  
     844     567   00399 B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     845     568   0039C                                                            ;tweede lijn
     846     569   0039C 74C0                           mov    a,#0c0h
     847     570   0039E 120441                         lcall  outc
     848     571   003A1 8008                           sjmp   outcharlcde
     849     572   003A3                  
     850     573   003A3                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     851     574   003A3                  ; is. dit mag naar het data register.
     852     575   003A3                  
     853     576   003A3 120407           outcharlcd8:  lcall  outd          ;klaar
     854     577   003A6 8003                           sjmp   outcharlcde   ;einde routine
     855     578   003A8                  
     856     579   003A8                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     857     580   003A8                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     858     581   003A8                  ; te schrijven.
     859     582   003A8                  
     860     583   003A8 120441           outcharlcd9:  lcall  outc          ;klaar
     861     584   003AB D0D0             outcharlcde:  pop    psw           ;registers herstellen
     862     585   003AD D0E0                           pop    acc
     863     586   003AF 22                             ret
     864     587   003B0                  
     865     588   003B0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     866     589   003B0                  ;
     867     590   003B0                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     868     591   003B0                  ; op het lcd scherm.
     869     592   003B0                  ;
     870     593   003B0                  ; de routine gebruikt geen registers
     871     594   003B0                  ;
     872     595   003B0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     873     596   003B0                  
     874     597   003B0                  lcdoutnib:
     875     598   003B0 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     876     599   003B2 C0D0                           push   psw
     877     600   003B4 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     878     601   003B6 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     879     602   003B8 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     880     603   003BB 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     881     604   003BD 2407                           add    a,#007h       ;omvormen naar hoofdletter
     882     605   003BF 120407           outniblcde:   lcall  outd          ;naar het scherm
     883     606   003C2 D0D0                           pop    psw
     884     607   003C4 D0E0                           pop    acc
     885     608   003C6 22                             ret
     886     609   003C7                  
     887     610   003C7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     888     611   003C7                  ;
     889     612   003C7                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     890     613   003C7                  ;
     891     614   003C7                  ; de routine gebruikt geen registers
     892     615   003C7                  ;
     893     616   003C7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     894     617   003C7                  
     895     618   003C7                  lcdoutbyte:
     896     619   003C7 C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     897     620   003C9 C0D0                           push   psw
     898     621   003CB C4                             swap   a             ;bitjes omruilen
     899     622   003CC 1203B0                         lcall  outniblcd
     900     623   003CF C4                             swap   a             ;nog eens
     901     624   003D0 1203B0                         lcall  outniblcd
     902     625   003D3 D0D0                           pop    psw
     903     626   003D5 D0E0                           pop    acc
     904     627   003D7 22                             ret
     905     628   003D8                  
     906     629   003D8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     907     630   003D8                  ;
     908     631   003D8                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     909     632   003D8                  ;
     910     633   003D8                  ; de routine gebruikt geen registers
     911     634   003D8                  ;
     912     635   003D8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     913     636   003D8                  
     914     637   003D8                  lcddispdptr:
     915     638   003D8 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     916     639   003DA C0D0                           push   psw
     917     640   003DC E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     918     641   003DE 1203C7                         lcall  outbytelcd
     919     642   003E1 E582                           mov    a,dpl         ;dan het lage deel
     920     643   003E3 1203C7                         lcall  outbytelcd
     921     644   003E6 D0D0                           pop    psw
     922     645   003E8 D0E0                           pop    acc
     923     646   003EA 22                             ret
     924     647   003EB                  
     925     648   003EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     926     649   003EB                  ;
     927     650   003EB                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     928     651   003EB                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     929     652   003EB                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     930     653   003EB                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     931     654   003EB                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     932     655   003EB                  ;
     933     656   003EB                  ; de routine gebruikt geen registers
     934     657   003EB                  ;
     935     658   003EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     936     659   003EB                  
     937     660   003EB                  lcdoutmsga:
     938     661   003EB C0E0             outmsgalcd:   push   acc           ;registers op de stack
     939     662   003ED C0D0                           push   psw
     940     663   003EF C083                           push   dph           ;ook de data pointer
     941     664   003F1 C082                           push   dpl
     942     665   003F3                  
     943     666   003F3                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     944     667   003F3                  
     945     668   003F3 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     946     669   003F4 93                             movc   a,@a+dptr     ;waarde lezen
     947     670   003F5 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     948     671   003F7                  
     949     672   003F7                  ; de code is niet 0 dus versturen met outchar
     950     673   003F7                  
     951     674   003F7 120359                         lcall  outcharlcd    ;weg er mee
     952     675   003FA A3                             inc    dptr          ;naar volgende ascii code wijzen
     953     676   003FB 0203F3                         ljmp   outmsgalcd1   ;lus sluiten
     954     677   003FE                  
     955     678   003FE D082             outmsgalcde:  pop    dpl           ;registers herstellen
     956     679   00400 D083                           pop    dph
     957     680   00402 D0D0                           pop    psw
     958     681   00404 D0E0                           pop    acc
     959     682   00406 22                             ret
     960     683   00407                  
     961     684   00407                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     962     685   00407                  ;
     963     686   00407                  ; outd is een routine die naar het data register van het display een
     964     687   00407                  ; volledige byte stuurt.
     965     688   00407                  ;
     966     689   00407                  ; De routine gebruikt geen registers.
     967     690   00407                  ;
     968     691   00407                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     969     692   00407                  
     970     693   00407 C0E0             outd:         push   acc           ;registers op stack zetten
     971     694   00409 C0D0                           push   psw
     972     695   0040B 120417                         lcall  outhnibd      ;hoogste vier bits verzenden
     973     696   0040E C4                             swap   a             ;bitjes omruilen
     974     697   0040F 120417                         lcall  outhnibd      ;naar het scherm sturen
     975     698   00412 D0D0                           pop    psw           ;registers terug herstellen
     976     699   00414 D0E0                           pop    acc
     977     700   00416 22                             ret
     978     701   00417                  
     979     702   00417                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     980     703   00417                  ;
     981     704   00417                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
     982     705   00417                  ; lcd scherm.
     983     706   00417                  ;
     984     707   00417                  ; de routine gebruikt geen registers.
     985     708   00417                  ;
     986     709   00417                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     987     710   00417                  
     988     711   00417 C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
     989     712   00419 C0D0                           push   psw
     990     713   0041B C0F0                           push   b             ;werkregister
     991     714   0041D 1204B8                         lcall  lcdtoport     ;lees de expander naar b register
     992     715   00420 D2F0                           setb   rs            ;controle lijn in orde
     993     716   00422 C2F1                           clr    e             ;deselectie display
     994     717   00424 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
     995     718   00426 03                             rr     a             ;bits op juiste plaats zetten
     996     719   00427 03                             rr     a             ;voor b reg
     997     720   00428 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
     998     721   0042B 42F0                           orl    b,a           ;bij elkaar voegen
     999     722   0042D 12049F                         lcall  porttolcd     ;naar expnder
    1000     723   00430 D2F1                           setb   e             ;display enabelen
    1001     724   00432 12049F                         lcall  porttolcd
    1002     725   00435 C2F1                           clr    e             ;display deselecteren
    1003     726   00437 12049F                         lcall  porttolcd
    1004     727   0043A D0F0                           pop    b
    1005     728   0043C D0D0                           pop    psw           ;registers herstellen
    1006     729   0043E D0E0                           pop    acc
    1007     730   00440 22                             ret
    1008     731   00441                  
    1009     732   00441                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1010     733   00441                  ;
    1011     734   00441                  ; outc is een routine die naar het controleregister van het display een
    1012     735   00441                  ; volledige byte stuurt.
    1013     736   00441                  ;
    1014     737   00441                  ; De routine gebruikt geen registers.
    1015     738   00441                  ;
    1016     739   00441                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1017     740   00441                  
    1018     741   00441 C0E0             outc:         push   acc           ;registers op stack zetten
    1019     742   00443 C0D0                           push   psw
    1020     743   00445 120457                         lcall  outhnibc      ;hoogste vier bits verzenden
    1021     744   00448 120498                         lcall  delay2ms      ;niet echt nodig
    1022     745   0044B C4                             swap   a             ;bitjes omruilen
    1023     746   0044C 120457                         lcall  outhnibc      ;naar het scherm sturen
    1024     747   0044F 120498                         lcall  delay2ms      ;altijd goed voor traagste commando
    1025     748   00452 D0D0                           pop    psw           ;registers terug herstellen
    1026     749   00454 D0E0                           pop    acc
    1027     750   00456 22                             ret
    1028     751   00457                  
    1029     752   00457                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1030     753   00457                  ;
    1031     754   00457                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1032     755   00457                  ; lcd scherm.
    1033     756   00457                  ;
    1034     757   00457                  ; de routine gebruikt geen registers.
    1035     758   00457                  ;
    1036     759   00457                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1037     760   00457                  
    1038     761   00457 C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1039     762   00459 C0D0                           push   psw
    1040     763   0045B C0F0                           push   b             ;werkregister
    1041     764   0045D 1204B8                         lcall  lcdtoport     ;lees de expander naar b register
    1042     765   00460 C2F0                           clr    rs            ;controle lijn in orde
    1043     766   00462 C2F1                           clr    e             ;deselectie display
    1044     767   00464 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1045     768   00466 03                             rr     a             ;bits op juiste plaats zetten
    1046     769   00467 03                             rr     a             ;voor b reg
    1047     770   00468 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1048     771   0046B 42F0                           orl    b,a           ;bij elkaar voegen
    1049     772   0046D 12049F                         lcall  porttolcd     ;naar expnder
    1050     773   00470 D2F1                           setb   e             ;display enabelen
    1051     774   00472 12049F                         lcall  porttolcd
    1052     775   00475 C2F1                           clr    e             ;display deselecteren
    1053     776   00477 12049F                         lcall  porttolcd
    1054     777   0047A D0F0                           pop    b
    1055     778   0047C D0D0                           pop    psw           ;registers herstellen
    1056     779   0047E D0E0                           pop    acc
    1057     780   00480 22                             ret
    1058     781   00481                  
    1059     782   00481                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1060     783   00481                  ;
    1061     784   00481                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1062     785   00481                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1063     786   00481                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1064     787   00481                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1065     788   00481                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1066     789   00481                  ; DATA GESCHREVEN.
    1067     790   00481                  ;
    1068     791   00481                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1069     792   00481                  
    1070     793   00481 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1071     794   00483 120441           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1072     795   00486 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1073     796   00488 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1074     797   00489 120407                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1075     798   0048C 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1076     799   0048F A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1077     800   00490 80F4                           SJMP   BUILD3
    1078     801   00492 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1079     802   00494 120441                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1080     803   00497 22                             RET                  ;EINDE VAN DE ROUTINE
    1081     804   00498                  
    1082     805   00498                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1083     806   00498                  ;
    1084     807   00498                  ; Delay2ms is een vertragingsroutine van 2ms.
    1085     808   00498                  ;
    1086     809   00498                  ; De routine gebruikt geen registers.
    1087     810   00498                  ;
    1088     811   00498                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1089     812   00498                  
    1090     813   00498 1202E9           delay2ms:     lcall  delay1ms
    1091     814   0049B 1202E9                         lcall  delay1ms
    1092     815   0049E 22                             ret
    1093     816   0049F                  
    1094     817   0049F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1095     818   0049F                  ;
    1096     819   0049F                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1097     820   0049F                  ; scherm stuurt via de port expander.
    1098     821   0049F                  ;
    1099     822   0049F                  ; Gebruikt geen registers
    1100     823   0049F                  ;
    1101     824   0049F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1102     825   0049F                  
    1103     826   0049F C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1104     827   004A1 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1105     828   004A3 1201C0                         lcall  iicstart      ;vertrokken
    1106     829   004A6 7440                           mov    a,#01000000b  ;schrijven naar expander
    1107     830   004A8 120207                         lcall  iicoutbyte    ;weg er mee
    1108     831   004AB E5F0                           mov    a,b           ;data verzenden
    1109     832   004AD 120207                         lcall  iicoutbyte
    1110     833   004B0 1201E3                         lcall  iicstop       ;transactie sluiten
    1111     834   004B3 D0D0                           pop    psw
    1112     835   004B5 D0E0                           pop    acc
    1113     836   004B7 22                             ret
    1114     837   004B8                  
    1115     838   004B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1116     839   004B8                  ;
    1117     840   004B8                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1118     841   004B8                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1119     842   004B8                  ; van buzzet en backlight is.
    1120     843   004B8                  ;
    1121     844   004B8                  ; Gebruikt b register
    1122     845   004B8                  ;
    1123     846   004B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1124     847   004B8                  
    1125     848   004B8 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1126     849   004BA C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1127     850   004BC 1201C0                         lcall  iicstart      ;vertrokken
    1128     851   004BF 7441                           mov    a,#01000001b  ;lezen van expander
    1129     852   004C1 120207                         lcall  iicoutbyte    ;weg er mee
    1130     853   004C4 120282                         lcall  iicinbytenack ;data inlezen
    1131     854   004C7 1201E3                         lcall  iicstop
    1132     855   004CA F5F0                           mov    b,a
    1133     856   004CC D0D0                           pop    psw
    1134     857   004CE D0E0                           pop    acc
    1135     858   004D0 22                             ret
    1136     859   004D1                  
    1137     860   004D1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1138     861   004D1                  ;
    1139     862   004D1                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1140     863   004D1                  ;
    1141     864   004D1                  ; Gebruikt geen registers
    1142     865   004D1                  ;
    1143     866   004D1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1144     867   004D1                  
    1145     868   004D1 C0F0             lcdlighton:   push   b
    1146     869   004D3 1204B8                         lcall  lcdtoport     ;expander lezen
    1147     870   004D6 C2F6                           clr    b.6           ;licht aan doen
    1148     871   004D8 12049F                         lcall  porttolcd     ;expander scrijven
    1149     872   004DB D0F0                           pop    b
    1150     873   004DD 22                             ret
    1151     874   004DE                  
    1152     875   004DE                  
    1153     876   004DE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1154     877   004DE                  ;
    1155     878   004DE                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1156     879   004DE                  ;
    1157     880   004DE                  ; Gebruikt geen registers
    1158     881   004DE                  ;
    1159     882   004DE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1160     883   004DE                  
    1161     884   004DE C0F0             lcdlightoff:  push   b
    1162     885   004E0 1204B8                         lcall  lcdtoport     ;expander lezen
    1163     886   004E3 D2F6                           setb   b.6           ;licht uit doen
    1164     887   004E5 12049F                         lcall  porttolcd     ;expander scrijven
    1165     888   004E8 D0F0                           pop    b
    1166     889   004EA 22                             ret
    1167     890   004EB                  
    1168     891   004EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1169     892   004EB                  ;
    1170     893   004EB                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1171     894   004EB                  ;
    1172     895   004EB                  ; Gebruikt geen registers
    1173     896   004EB                  ;
    1174     897   004EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1175     898   004EB                  
    1176     899   004EB C0F0             lcdbuzon:     push   b
    1177     900   004ED 1204B8                         lcall  lcdtoport     ;expander lezen
    1178     901   004F0 C2F7                           clr    b.7           ;buzzer aan doen
    1179     902   004F2 12049F                         lcall  porttolcd     ;expander scrijven
    1180     903   004F5 D0F0                           pop    b
    1181     904   004F7 22                             ret
    1182     905   004F8                  
    1183     906   004F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1184     907   004F8                  ;
    1185     908   004F8                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1186     909   004F8                  ;
    1187     910   004F8                  ; Gebruikt geen registers
    1188     911   004F8                  ;
    1189     912   004F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1190     913   004F8                  
    1191     914   004F8 C0F0             lcdbuzoff:    push   b
    1192     915   004FA 1204B8                         lcall  lcdtoport     ;expander lezen
    1193     916   004FD D2F7                           setb   b.7           ;buzzer aan doen
    1194     917   004FF 12049F                         lcall  porttolcd     ;expander scrijven
    1195     918   00502 D0F0                           pop    b
    1196     919   00504 22                             ret
    1197     920   00505                  
    1198     921   00505                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1199     922   00505                  ;
    1200     923   00505                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1201     924   00505                  ; een standaard com poort op 9600 baud.
    1202     925   00505                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1203     926   00505                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1204     927   00505                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1205     928   00505                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1206     929   00505                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1207     930   00505                  ; NIET door deze routine.
    1208     931   00505                  ;
    1209     932   00505                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1210     933   00505                  ;
    1211     934   00505                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1212     935   00505                  
    1213     936   00505                  blank         equ    020h          ;ascii code voor een blank
    1214     937   00505                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1215     938   00505                  ff            equ    00ch          ;ascii code voor nieuw blad
    1216     939   00505                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1217     940   00505                  lf            equ    00ah          ;ascii code voor volgende lijn
    1218     941   00505                  backsp        equ    008h          ;ascii code voor het bs karakter
    1219     942   00505                  beep          equ    007h          ;ascii code voor een beep
    1220     943   00505                  
    1221     944   00505 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1222     945   00509                                                                          ;van het scherm
    1223     946   00509                  
    1224     947   00509                  strtbuf       equ     054h         ;start adres van de buffer
    1225     948   00509                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1226     949   00509                  
    1227     950   00509                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1228     951   00509                  ;
    1229     952   00509                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1230     953   00509                  ;
    1231     954   00509                  ; Gebruikt geen registers
    1232     955   00509                  ;
    1233     956   00509                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1234     957   00509                  
    1235     958   00509 C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1236     959   0050B C08F                           push   syscon0              ;map bewaren
    1237     960   0050D 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1238     961   00510 C0B2                           push   port_page            ;pagina op stack zetten
    1239     962   00512 C0BF                           push   scu_page
    1240     963   00514 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1241     964   00517                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1242     965   00517                  ;      -p1.0 als input en alt1 selectie
    1243     966   00517                  ;      -p1.1 als output en alt2 selectie
    1244     967   00517                  
    1245     968   00517 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1246     969   0051A 5390FD                         anl    p1_altsel0,#11111101b
    1247     970   0051D 439001                         orl    p1_altsel0,#00000001b
    1248     971   00520 5391FE                         anl    p1_altsel1,#11111110b
    1249     972   00523 439102                         orl    p1_altsel1,#00000010b
    1250     973   00526 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1251     974   00529 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1252     975   0052C 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1253     976   0052F                  
    1254     977   0052F                  ; Nu moet de baud rate generator ingesteld worden
    1255     978   0052F                  ; We gaan er van uit dat de systeemklok 24MHz is
    1256     979   0052F                  
    1257     980   0052F 759850                         mov    scon,#01010000b      ;UART initialiseren
    1258     981   00532                  
    1259     982   00532                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1260     983   00532                  ; gebruikt!!
    1261     984   00532                  
    1262     985   00532 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1263     986   00535 75BD11                         mov    bcon,#00010001b
    1264     987   00538 D0BF                           pop    scu_page
    1265     988   0053A D0B2                           pop    port_page            ;alles terug herstellen
    1266     989   0053C D08F                           pop    syscon0
    1267     990   0053E D0E0                           pop    acc
    1268     991   00540 22                             ret
    1269     992   00541                  
    1270     993   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1271     994   00541                  ;
    1272     995   00541                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1273     996   00541                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1274     997   00541                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1275     998   00541                  ;
    1276     999   00541                  ; de routine gebruikt geen registers.
    1277    1000   00541                  ;
    1278    1001   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1279    1002   00541                  
    1280    1003   00541                  siooutchar:
    1281    1004   00541 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1282    1005   00543 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1283    1006   00546 C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1284    1007   00548 22                             RET
    1285    1008   00549                  
    1286    1009   00549                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1287    1010   00549                  ;
    1288    1011   00549                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1289    1012   00549                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1290    1013   00549                  ;
    1291    1014   00549                  ; de routine gebruikt geen registers.
    1292    1015   00549                  ;
    1293    1016   00549                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1294    1017   00549                  
    1295    1018   00549                  siooutnib:
    1296    1019   00549 C0E0             OUTNIB:       push   acc           ;registers op de stack
    1297    1020   0054B C0D0                           push   psw
    1298    1021   0054D 540F                           ANL    A,#00FH       ;AFZONDEREN
    1299    1022   0054F 120639                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1300    1023   00552 120541                         LCALL  OUTCHAR       ;VERSTUREN
    1301    1024   00555 1205A2                         LCALL  XONXOFF       ;FLOW CONTROL
    1302    1025   00558 D0D0                           pop    psw           ;registers herstellen
    1303    1026   0055A D0E0                           pop    acc
    1304    1027   0055C 22                             RET
    1305    1028   0055D                  
    1306    1029   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1307    1030   0055D                  ;
    1308    1031   0055D                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1309    1032   0055D                  ; WORDT XONXOFF GEBRUIKT.
    1310    1033   0055D                  ;
    1311    1034   0055D                  ; de routine gebruikt geen registers.
    1312    1035   0055D                  ;
    1313    1036   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1314    1037   0055D                  
    1315    1038   0055D                  siooutbyte:
    1316    1039   0055D C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1317    1040   0055F C0D0                           push   psw
    1318    1041   00561 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1319    1042   00563 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1320    1043   00564 120549                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1321    1044   00567 D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1322    1045   00569 120549                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1323    1046   0056C D0D0                           pop    psw           ;registers herstellen
    1324    1047   0056E D0E0                           pop    acc
    1325    1048   00570 22                             RET
    1326    1049   00571                  
    1327    1050   00571                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1328    1051   00571                  ;
    1329    1052   00571                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1330    1053   00571                  ; VAN DE CURSOR.
    1331    1054   00571                  ;
    1332    1055   00571                  ; de routine gebruikt geen registers.
    1333    1056   00571                  ;
    1334    1057   00571                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1335    1058   00571                  
    1336    1059   00571                  siodispdptr:
    1337    1060   00571 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1338    1061   00573 C0D0                           push   psw
    1339    1062   00575 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1340    1063   00577 12055D                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1341    1064   0057A E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1342    1065   0057C 12055D                         LCALL  OUTBYTE       ;WEG ER MEE
    1343    1066   0057F D0D0                           pop    psw           ;registers herstellen
    1344    1067   00581 D0E0                           pop    acc
    1345    1068   00583 22                             RET                  ;EINDE
    1346    1069   00584                  
    1347    1070   00584                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1348    1071   00584                  ;
    1349    1072   00584                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1350    1073   00584                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1351    1074   00584                  ;
    1352    1075   00584                  ; de routine gebruikt geen registers.
    1353    1076   00584                  ;
    1354    1077   00584                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1355    1078   00584                  
    1356    1079   00584                  siooutmsga:
    1357    1080   00584 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1358    1081   00586 C0D0                           push   psw
    1359    1082   00588 C082                           push   dpl
    1360    1083   0058A C083                           push   dph
    1361    1084   0058C E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1362    1085   0058D 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1363    1086   0058E 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1364    1087   00590 120541                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1365    1088   00593 1205A2                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1366    1089   00596 A3                             INC    DPTR          ;DPTR AANPASSEN
    1367    1090   00597 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1368    1091   00599 D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1369    1092   0059B D082                           pop    dpl
    1370    1093   0059D D0D0                           pop    psw
    1371    1094   0059F D0E0                           pop    acc
    1372    1095   005A1 22                             RET                  ;EINDE ROUTINE
    1373    1096   005A2                  
    1374    1097   005A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1375    1098   005A2                  ;
    1376    1099   005A2                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1377    1100   005A2                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1378    1101   005A2                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1379    1102   005A2                  ; VERDER DOORGEGEVEN.
    1380    1103   005A2                  ;
    1381    1104   005A2                  ; de routine gebruikt geen registers.
    1382    1105   005A2                  ;
    1383    1106   005A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1384    1107   005A2                  
    1385    1108   005A2 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1386    1109   005A4 C0D0                           push   psw
    1387    1110   005A6 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1388    1111   005A9 D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1389    1112   005AB D0E0                           pop    acc
    1390    1113   005AD 22                             RET                  ;ANDERS EINDE
    1391    1114   005AE E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1392    1115   005B0 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1393    1116   005B3 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1394    1117   005B6 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1395    1118   005B8                  
    1396    1119   005B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1397    1120   005B8                  ;
    1398    1121   005B8                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1399    1122   005B8                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1400    1123   005B8                  ;
    1401    1124   005B8                  ; de routine gebruikt de accu.
    1402    1125   005B8                  ;
    1403    1126   005B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1404    1127   005B8                  
    1405    1128   005B8                  sioinchar:
    1406    1129   005B8 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1407    1130   005BB C298                           CLR    RI                   ;BIT LAAG MAKEN
    1408    1131   005BD E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1409    1132   005BF 22                             RET
    1410    1133   005C0                  
    1411    1134   005C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1412    1135   005C0                  ;
    1413    1136   005C0                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1414    1137   005C0                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1415    1138   005C0                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1416    1139   005C0                  ; DE CARRY OP 1 GEZET WORDEN.
    1417    1140   005C0                  ;
    1418    1141   005C0                  ; De routine gebruikt de accu, r0 en de psw.
    1419    1142   005C0                  ;
    1420    1143   005C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1421    1144   005C0                  
    1422    1145   005C0                  sioinbyte:
    1423    1146   005C0 1205B8           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1424    1147   005C3 12062C                         LCALL  LOWUPTR
    1425    1148   005C6 120643                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1426    1149   005C9 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1427    1150   005CB C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1428    1151   005CC F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1429    1152   005CD 1205B8                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1430    1153   005D0 12062C                         LCALL  LOWUPTR
    1431    1154   005D3 120643                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1432    1155   005D6 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1433    1156   005D8 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1434    1157   005D9 22               INBYTE1:      RET
    1435    1158   005DA                  
    1436    1159   005DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1437    1160   005DA                  ;
    1438    1161   005DA                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1439    1162   005DA                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1440    1163   005DA                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1441    1164   005DA                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1442    1165   005DA                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1443    1166   005DA                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1444    1167   005DA                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1445    1168   005DA                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1446    1169   005DA                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1447    1170   005DA                  ; bepalen.
    1448    1171   005DA                  ;
    1449    1172   005DA                  ; De routine gebruikt de accu, r0 en de psw.
    1450    1173   005DA                  ;
    1451    1174   005DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1452    1175   005DA                  
    1453    1176   005DA                  sioinbufa:
    1454    1177   005DA 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1455    1178   005DC 1205B8           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1456    1179   005DF 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1457    1180   005E1                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1458    1181   005E1                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1459    1182   005E1                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1460    1183   005E1                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1461    1184   005E1                  ; GEVOERD.
    1462    1185   005E1 12062C                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1463    1186   005E4 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1464    1187   005E7 F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1465    1188   005E8 22                             RET                         ;EINDE VAN DE ROUTINE
    1466    1189   005E9 B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1467    1190   005EC B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1468    1191   005EF 7407             INBUFA4:      MOV    A,#BEEP
    1469    1192   005F1 120541           INBUFA7:      LCALL  OUTCHAR
    1470    1193   005F4 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1471    1194   005F6 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1472    1195   005F7 900505                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1473    1196   005FA 120584                         LCALL  OUTMSGA
    1474    1197   005FD 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1475    1198   005FF 12061E           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1476    1199   00602 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1477    1200   00604 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1478    1201   00607 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1479    1202   00609 F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1480    1203   0060A 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1481    1204   0060B 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1482    1205   0060D                  
    1483    1206   0060D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1484    1207   0060D                  ;
    1485    1208   0060D                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1486    1209   0060D                  ;
    1487    1210   0060D                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1488    1211   0060D                  ;
    1489    1212   0060D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1490    1213   0060D                  
    1491    1214   0060D 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1492    1215   0060F 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1493    1216   00611 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1494    1217   00612 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1495    1218   00615 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1496    1219   00616 B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1497    1220   00619 22                             RET                         ;EINDE VAN DE ROUTINE
    1498    1221   0061A F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1499    1222   0061B 09                             INC    R1
    1500    1223   0061C 80F7                           SJMP   BDELETE3
    1501    1224   0061E                  
    1502    1225   0061E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1503    1226   0061E                  ;
    1504    1227   0061E                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1505    1228   0061E                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1506    1229   0061E                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1507    1230   0061E                  ; AANZIEN.
    1508    1231   0061E                  ;
    1509    1232   0061E                  ; De routine gebruikt de accu en de psw.
    1510    1233   0061E                  ;
    1511    1234   0061E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1512    1235   0061E                  
    1513    1236   0061E B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1514    1237   00621 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1515    1238   00623 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1516    1239   00626 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1517    1240   00628 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1518    1241   00629 22                             RET
    1519    1242   0062A D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1520    1243   0062B 22                             RET
    1521    1244   0062C                  
    1522    1245   0062C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1523    1246   0062C                  ;
    1524    1247   0062C                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1525    1248   0062C                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1526    1249   0062C                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1527    1250   0062C                  ; AANGEPAST WORDEN.
    1528    1251   0062C                  ;
    1529    1252   0062C                  ; De routine gebruikt de accu en de psw.
    1530    1253   0062C                  ;
    1531    1254   0062C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1532    1255   0062C                  
    1533    1256   0062C B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1534    1257   0062F 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1535    1258   00631 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1536    1259   00634 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1537    1260   00636 9420                           SUBB   A,#020H              ;OMZETTING
    1538    1261   00638 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1539    1262   00639                  
    1540    1263   00639                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1541    1264   00639                  ;
    1542    1265   00639                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1543    1266   00639                  ; ASCII CODE.
    1544    1267   00639                  ;
    1545    1268   00639                  ; De routine gebruikt de accu en de psw.
    1546    1269   00639                  ;
    1547    1270   00639                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1548    1271   00639                  
    1549    1272   00639 B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1550    1273   0063C 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1551    1274   0063E 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1552    1275   00640 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1553    1276   00642 22                             RET
    1554    1277   00643                  
    1555    1278   00643                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1556    1279   00643                  ;
    1557    1280   00643                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1558    1281   00643                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1559    1282   00643                  ; GEVAL WORDT DE CARRY GEZET.
    1560    1283   00643                  ;
    1561    1284   00643                  ; De routine gebruikt de accu en de psw.
    1562    1285   00643                  ;
    1563    1286   00643                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1564    1287   00643                  
    1565    1288   00643 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1566    1289   00644 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1567    1290   00646 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1568    1291   00648 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1569    1292   0064B 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1570    1293   0064D 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1571    1294   0064F 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1572    1295   00651 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1573    1296   00654 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1574    1297   00655 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1575    1298   00657 C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1576    1299   00658 22               ASCBINTRANS1: RET
    1577    1300   00659                  
    1578    1301   00659                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1579    1302   00659                  ;
    1580    1303   00659                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1581    1304   00659                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1582    1305   00659                  ;
    1583    1306   00659                  ; De routine gebruikt de accu en de psw.
    1584    1307   00659                  ;
    1585    1308   00659                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1586    1309   00659                  
    1587    1310   00659 E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1588    1311   0065A 120643                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1589    1312   0065D 22                             RET                         ;EINDE OMZETTING
    1590    1313   0065E                  
    1591    1314   0065E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1592    1315   0065E                  ;
    1593    1316   0065E                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1594    1317   0065E                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1595    1318   0065E                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1596    1319   0065E                  ;
    1597    1320   0065E                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1598    1321   0065E                  ;
    1599    1322   0065E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1600    1323   0065E                  
    1601    1324   0065E 120659           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1602    1325   00661 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1603    1326   00663 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1604    1327   00664 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1605    1328   00665 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1606    1329   00666 120659                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1607    1330   00669 4001                           JC     ASCII21               ;WEG ALS C=1
    1608    1331   0066B 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1609    1332   0066C 22               ASCII21:      RET
    1610    1333   0066D                  
    1611    1334   0066D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1612    1335   0066D                  ;
    1613    1336   0066D                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1614    1337   0066D                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1615    1338   0066D                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1616    1339   0066D                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1617    1340   0066D                  ;
    1618    1341   0066D                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1619    1342   0066D                  ;
    1620    1343   0066D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1621    1344   0066D                  
    1622    1345   0066D 12065E           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1623    1346   00670 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1624    1347   00672 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1625    1348   00674 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1626    1349   00675 12065E                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1627    1350   00678 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1628    1351   0067A F582                           MOV    DPL,A                ;IN DPTR LADEN
    1629    1352   0067C 22               ASCII41:      RET
    1630    1353   0067D                  
    1631    1354   0067D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1632    1355   0067D                  ;
    1633    1356   0067D                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1634    1357   0067D                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1635    1358   0067D                  ; geschakeld worden.
    1636    1359   0067D                  ;
    1637    1360   0067D                  ; Gebruikt geen registers
    1638    1361   0067D                  ;
    1639    1362   0067D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1640    1363   0067D                  
    1641    1364   0067D C08F             initadc:      push   syscon0                     ;map saven
    1642    1365   0067F 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1643    1366   00682 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1644    1367   00685 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1645    1368   00688                                                                   ;klok delen door 32 (750kHz)
    1646    1369   00688                                                                   ;10 bit uitkomst
    1647    1370   00688 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1648    1371   0068B                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1649    1372   0068B 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1650    1373   0068E 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1651    1374   00691 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1652    1375   00694 D08F                           pop    syscon0                     ;herstellen syscon
    1653    1376   00696 22                             ret
    1654    1377   00697                  
    1655    1378   00697                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1656    1379   00697                  ;
    1657    1380   00697                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1658    1381   00697                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1659    1382   00697                  ;
    1660    1383   00697                  ; Gebruikt:
    1661    1384   00697                  ;      -accu als 8 msb meting
    1662    1385   00697                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1663    1386   00697                  ;
    1664    1387   00697                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1665    1388   00697                  
    1666    1389   00697 C08F             adclm335:     push   syscon0
    1667    1390   00699 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1668    1391   0069C 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1669    1392   0069F 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1670    1393   006A2 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1671    1394   006A5 00               		nop
    1672    1395   006A6 00               		nop					;anders loopt het mis met het testen van de ready bit
    1673    1396   006A7 E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1674    1397   006A9 20E0FB                         jb     acc.0,adclm3351
    1675    1398   006AC 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1676    1399   006AF E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1677    1400   006B1 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1678    1401   006B4 D08F                           pop    syscon0
    1679    1402   006B6 22                             ret
    1680    1403   006B7                  
    1681    1404   006B7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1682    1405   006B7                  ;
    1683    1406   006B7                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1684    1407   006B7                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1685    1408   006B7                  ;
    1686    1409   006B7                  ; Gebruikt:
    1687    1410   006B7                  ;      -accu als 8 msb meting
    1688    1411   006B7                  ;      -b als 2 lsb meting (links afgelijnd)
    1689    1412   006B7                  ;
    1690    1413   006B7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1691    1414   006B7                  
    1692    1415   006B7 C08F             adcpotmeter:  push   syscon0
    1693    1416   006B9 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1694    1417   006BC 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1695    1418   006BF 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1696    1419   006C2 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1697    1420   006C5 00               		nop
    1698    1421   006C6 00               		nop					;anders loopt het mis met het testen van de ready bit
    1699    1422   006C7 E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1700    1423   006C9 20E0FB                         jb     acc.0,adcpotmeter1
    1701    1424   006CC 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1702    1425   006CF E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1703    1426   006D1 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1704    1427   006D4 D08F                           pop    syscon0
    1705    1428   006D6                  
    1706    1429   006D6                  
    1707    1430   006D6 22                             ret
    1708    1431   006D7                  
    1709    1432   006D7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1710    1433   006D7                  ;
    1711    1434   006D7                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1712    1435   006D7                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1713    1436   006D7                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1714    1437   006D7                  ; doelstellingen in het achterhoofd.
    1715    1438   006D7                  ;
    1716    1439   006D7                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1717    1440   006D7                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1718    1441   006D7                  ; bcd)
    1719    1442   006D7                  ;      8bit hex naar bcd
    1720    1443   006D7                  ;      8bit bcd naar hex
    1721    1444   006D7                  ;
    1722    1445   006D7                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1723    1446   006D7                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1724    1447   006D7                  ;      16*16 bit met 32 bit uitkomst
    1725    1448   006D7                  ;      16+16 bit met 24 bit uitkomst
    1726    1449   006D7                  ;      16-16 bit met 24 bit uitkomst
    1727    1450   006D7                  ;      16bit hex naar bcd
    1728    1451   006D7                  ;      16bit bcd naar hex
    1729    1452   006D7                  ;
    1730    1453   006D7                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1731    1454   006D7                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1732    1455   006D7                  ;      32*32 bit met 64 bit uitkomst
    1733    1456   006D7                  ;      32+32 bit met 40 bit uitkomst
    1734    1457   006D7                  ;      32-32 bit met 40 bit uitkomst
    1735    1458   006D7                  ;
    1736    1459   006D7                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1737    1460   006D7                  ;
    1738    1461   006D7                  ; De routines gebruiken als input en output de huidige registerbank.
    1739    1462   006D7                  ;
    1740    1463   006D7                  ;
    1741    1464   006D7                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1742    1465   006D7                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1743    1466   006D7                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1744    1467   006D7                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1745    1468   006D7                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1746    1469   006D7                  ;
    1747    1470   006D7                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1748    1471   006D7                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1749    1472   006D7                  ;      -routines gebruiken geen MDU!
    1750    1473   006D7                  ;
    1751    1474   006D7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1752    1475   006D7                  
    1753    1476   006D7                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1754    1477   006D7                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1755    1478   006D7                  
    1756    1479   006D7                  h0            equ    070h
    1757    1480   006D7                  h1            equ    071h
    1758    1481   006D7                  h2            equ    072h
    1759    1482   006D7                  h3            equ    073h
    1760    1483   006D7                  h4            equ    074h
    1761    1484   006D7                  h5            equ    075h
    1762    1485   006D7                  h6            equ    076h
    1763    1486   006D7                  h7            equ    077h
    1764    1487   006D7                  h8            equ    078h
    1765    1488   006D7                  h9            equ    079h
    1766    1489   006D7                  h10           equ    07ah
    1767    1490   006D7                  h11           equ    07bh
    1768    1491   006D7                  h12           equ    07ch
    1769    1492   006D7                  
    1770    1493   006D7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1771    1494   006D7                  ;
    1772    1495   006D7                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1773    1496   006D7                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1774    1497   006D7                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1775    1498   006D7                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1776    1499   006D7                  ;
    1777    1500   006D7                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1778    1501   006D7                  ;
    1779    1502   006D7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1780    1503   006D7                  
    1781    1504   006D7 C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1782    1505   006D9 C0D0                           push   psw
    1783    1506   006DB C070                           push   h0
    1784    1507   006DD C071                           push   h1
    1785    1508   006DF C072                           push   h2
    1786    1509   006E1 C073                           push   h3
    1787    1510   006E3 C074                           push   h4
    1788    1511   006E5 C075                           push   h5
    1789    1512   006E7 C076                           push   h6
    1790    1513   006E9 C077                           push   h7
    1791    1514   006EB C078                           push   h8
    1792    1515   006ED C079                           push   h9
    1793    1516   006EF C07A                           push   h10
    1794    1517   006F1 C07B                           push   h11
    1795    1518   006F3 C07C                           push   h12
    1796    1519   006F5                  
    1797    1520   006F5                  ; eerst moeten de hulpregisters klaar gezet worden
    1798    1521   006F5                  
    1799    1522   006F5 757000                         mov    h0,#000h
    1800    1523   006F8 757100                         mov    h1,#000h
    1801    1524   006FB 757200                         mov    h2,#000h
    1802    1525   006FE 757300                         mov    h3,#000h
    1803    1526   00701 757400                         mov    h4,#000h
    1804    1527   00704 757500                         mov    h5,#000h
    1805    1528   00707 757600                         mov    h6,#000h
    1806    1529   0070A 757700                         mov    h7,#000h
    1807    1530   0070D 757800                         mov    h8,#000h
    1808    1531   00710 757900                         mov    h9,#000h
    1809    1532   00713 757A00                         mov    h10,#000h
    1810    1533   00716 757B00                         mov    h11,#000h
    1811    1534   00719 757C20                         mov    h12,#32              ;loopcounter
    1812    1535   0071C                  
    1813    1536   0071C                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1814    1537   0071C                  
    1815    1538   0071C                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1816    1539   0071C                  
    1817    1540   0071C EB               mul321:       mov    a,r3
    1818    1541   0071D 13                             rrc    a
    1819    1542   0071E FB                             mov    r3,a
    1820    1543   0071F EA                             mov    a,r2
    1821    1544   00720 13                             rrc    a
    1822    1545   00721 FA                             mov    r2,a
    1823    1546   00722 E9                             mov    a,r1
    1824    1547   00723 13                             rrc    a
    1825    1548   00724 F9                             mov    r1,a
    1826    1549   00725 E8                             mov    a,r0
    1827    1550   00726 13                             rrc    a
    1828    1551   00727 F8                             mov    r0,a                 ;32 bit shift klaar
    1829    1552   00728                  
    1830    1553   00728                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1831    1554   00728                  
    1832    1555   00728 502C                           jnc    mul322               ;optelling niet nodig
    1833    1556   0072A                  
    1834    1557   0072A                  ; hier staat en 64 bit optelling
    1835    1558   0072A                  
    1836    1559   0072A EC                             mov    a,r4
    1837    1560   0072B 2574                           add    a,h4
    1838    1561   0072D F574                           mov    h4,a
    1839    1562   0072F ED                             mov    a,r5
    1840    1563   00730 3575                           addc   a,h5
    1841    1564   00732 F575                           mov    h5,a
    1842    1565   00734 EE                             mov    a,r6
    1843    1566   00735 3576                           addc   a,h6
    1844    1567   00737 F576                           mov    h6,a
    1845    1568   00739 EF                             mov    a,r7
    1846    1569   0073A 3577                           addc   a,h7
    1847    1570   0073C F577                           mov    h7,a
    1848    1571   0073E E570                           mov    a,h0
    1849    1572   00740 3578                           addc   a,h8
    1850    1573   00742 F578                           mov    h8,a
    1851    1574   00744 E571                           mov    a,h1
    1852    1575   00746 3579                           addc   a,h9
    1853    1576   00748 F579                           mov    h9,a
    1854    1577   0074A E572                           mov    a,h2
    1855    1578   0074C 357A                           addc   a,h10
    1856    1579   0074E F57A                           mov    h10,a
    1857    1580   00750 E573                           mov    a,h3
    1858    1581   00752 357B                           addc   a,h11
    1859    1582   00754 F57B                           mov    h11,a                ;optelling klaar
    1860    1583   00756                  
    1861    1584   00756                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1862    1585   00756                  
    1863    1586   00756 C3               mul322:       clr    c                    ;moet op 0 staan
    1864    1587   00757 EC                             mov    a,r4
    1865    1588   00758 33                             rlc    a
    1866    1589   00759 FC                             mov    r4,a
    1867    1590   0075A ED                             mov    a,r5
    1868    1591   0075B 33                             rlc    a
    1869    1592   0075C FD                             mov    r5,a
    1870    1593   0075D EE                             mov    a,r6
    1871    1594   0075E 33                             rlc    a
    1872    1595   0075F FE                             mov    r6,a
    1873    1596   00760 EF                             mov    a,r7
    1874    1597   00761 33                             rlc    a
    1875    1598   00762 FF                             mov    r7,a
    1876    1599   00763 E570                           mov    a,h0
    1877    1600   00765 33                             rlc    a
    1878    1601   00766 F570                           mov    h0,a
    1879    1602   00768 E571                           mov    a,h1
    1880    1603   0076A 33                             rlc    a
    1881    1604   0076B F571                           mov    h1,a
    1882    1605   0076D E572                           mov    a,h2
    1883    1606   0076F 33                             rlc    a
    1884    1607   00770 F572                           mov    h2,a
    1885    1608   00772 E573                           mov    a,h3
    1886    1609   00774 33                             rlc    a
    1887    1610   00775 F573                           mov    h3,a
    1888    1611   00777                  
    1889    1612   00777 D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1890    1613   0077A                  
    1891    1614   0077A                  ; de uitkomst moet in de juiste registers komen
    1892    1615   0077A                  
    1893    1616   0077A A874                           mov    r0,h4
    1894    1617   0077C A975                           mov    r1,h5
    1895    1618   0077E AA76                           mov    r2,h6
    1896    1619   00780 AB77                           mov    r3,h7
    1897    1620   00782 AC78                           mov    r4,h8
    1898    1621   00784 AD79                           mov    r5,h9
    1899    1622   00786 AE7A                           mov    r6,h10
    1900    1623   00788 AF7B                           mov    r7,h11               ;klaar
    1901    1624   0078A                  
    1902    1625   0078A D07C                           pop    h12                  ;registers herstellen
    1903    1626   0078C D07B                           pop    h11
    1904    1627   0078E D07A                           pop    h10
    1905    1628   00790 D079                           pop    h9
    1906    1629   00792 D078                           pop    h8
    1907    1630   00794 D077                           pop    h7
    1908    1631   00796 D076                           pop    h6
    1909    1632   00798 D075                           pop    h5
    1910    1633   0079A D074                           pop    h4
    1911    1634   0079C D073                           pop    h3
    1912    1635   0079E D072                           pop    h2
    1913    1636   007A0 D071                           pop    h1
    1914    1637   007A2 D070                           pop    h0
    1915    1638   007A4 D0D0                           pop    psw
    1916    1639   007A6 D0E0                           pop    acc
    1917    1640   007A8 22                             ret
    1918    1641   007A9                  
    1919    1642   007A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1920    1643   007A9                  ;
    1921    1644   007A9                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1922    1645   007A9                  ; input:      r1,r0 = eerste getal (r1=msb)
    1923    1646   007A9                  ;             r3,r2 = tweede getal (r3=msb)
    1924    1647   007A9                  ; output:     r3,r2,r1,r0 met r3=msb
    1925    1648   007A9                  ;
    1926    1649   007A9                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1927    1650   007A9                  ;
    1928    1651   007A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1929    1652   007A9                  
    1930    1653   007A9 C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1931    1654   007AB C0D0                           push   psw
    1932    1655   007AD C070                           push   h0
    1933    1656   007AF C071                           push   h1
    1934    1657   007B1 C072                           push   h2
    1935    1658   007B3 C073                           push   h3
    1936    1659   007B5 C074                           push   h4
    1937    1660   007B7 C075                           push   h5
    1938    1661   007B9 C076                           push   h6
    1939    1662   007BB                  
    1940    1663   007BB                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1941    1664   007BB                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1942    1665   007BB                  ; h6 is de loopcounter.
    1943    1666   007BB                  
    1944    1667   007BB 757000                         mov    h0,#000h
    1945    1668   007BE 757100                         mov    h1,#000h
    1946    1669   007C1 757200                         mov    h2,#000h
    1947    1670   007C4 757300                         mov    h3,#000h
    1948    1671   007C7 757400                         mov    h4,#000h
    1949    1672   007CA 757500                         mov    h5,#000h
    1950    1673   007CD 757610                         mov    h6,#16               ;loopcounter
    1951    1674   007D0                  
    1952    1675   007D0                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1953    1676   007D0                  ; berekening
    1954    1677   007D0                  
    1955    1678   007D0 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1956    1679   007D1 13                             rrc    a
    1957    1680   007D2 F9                             mov    r1,a
    1958    1681   007D3 E8                             mov    a,r0
    1959    1682   007D4 13                             rrc    a
    1960    1683   007D5 F8                             mov    r0,a                 ;ok
    1961    1684   007D6                  
    1962    1685   007D6                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1963    1686   007D6                  
    1964    1687   007D6 5016                           jnc    mul162
    1965    1688   007D8                  
    1966    1689   007D8 EA                             mov    a,r2
    1967    1690   007D9 2572                           add    a,h2
    1968    1691   007DB F572                           mov    h2,a                 ;32 bit som uitvoeren
    1969    1692   007DD EB                             mov    a,r3
    1970    1693   007DE 3573                           addc   a,h3
    1971    1694   007E0 F573                           mov    h3,a
    1972    1695   007E2 E570                           mov    a,h0
    1973    1696   007E4 3574                           addc   a,h4
    1974    1697   007E6 F574                           mov    h4,a
    1975    1698   007E8 E571                           mov    a,h1
    1976    1699   007EA 3575                           addc   a,h5
    1977    1700   007EC F575                           mov    h5,a                 ;klaar
    1978    1701   007EE                  
    1979    1702   007EE                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    1980    1703   007EE                  
    1981    1704   007EE C3               mul162:       clr    c
    1982    1705   007EF EA                             mov    a,r2
    1983    1706   007F0 33                             rlc    a
    1984    1707   007F1 FA                             mov    r2,a                 ;ook 32 bit getal
    1985    1708   007F2 EB                             mov    a,r3
    1986    1709   007F3 33                             rlc    a
    1987    1710   007F4 FB                             mov    r3,a
    1988    1711   007F5 E570                           mov    a,h0
    1989    1712   007F7 33                             rlc    a
    1990    1713   007F8 F570                           mov    h0,a
    1991    1714   007FA E571                           mov    a,h1
    1992    1715   007FC 33                             rlc    a
    1993    1716   007FD F571                           mov    h1,a                 ;klaar
    1994    1717   007FF                  
    1995    1718   007FF D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    1996    1719   00802                  
    1997    1720   00802                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    1998    1721   00802                  
    1999    1722   00802 A872                           mov    r0,h2
    2000    1723   00804 A973                           mov    r1,h3
    2001    1724   00806 AA74                           mov    r2,h4
    2002    1725   00808 AB75                           mov    r3,h5                ;klaar
    2003    1726   0080A                  
    2004    1727   0080A                  
    2005    1728   0080A D076                           pop    h6                   ;registers herstellen
    2006    1729   0080C D075                           pop    h5
    2007    1730   0080E D074                           pop    h4
    2008    1731   00810 D073                           pop    h3
    2009    1732   00812 D072                           pop    h2
    2010    1733   00814 D071                           pop    h1
    2011    1734   00816 D070                           pop    h0
    2012    1735   00818 D0D0                           pop    psw
    2013    1736   0081A D0E0                           pop    acc
    2014    1737   0081C 22                             ret
    2015    1738   0081D                  
    2016    1739   0081D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2017    1740   0081D                  ;
    2018    1741   0081D                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2019    1742   0081D                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2020    1743   0081D                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2021    1744   0081D                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2022    1745   0081D                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2023    1746   0081D                  ;             carry=1 bij delen door 0
    2024    1747   0081D                  ;
    2025    1748   0081D                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2026    1749   0081D                  ;
    2027    1750   0081D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2028    1751   0081D                  
    2029    1752   0081D C0E0             div32:        push   acc                  ;registers op de stack zetten
    2030    1753   0081F C0D0                           push   psw
    2031    1754   00821 C070                           push   h0
    2032    1755   00823 C071                           push   h1
    2033    1756   00825 C072                           push   h2
    2034    1757   00827 C073                           push   h3
    2035    1758   00829 C074                           push   h4
    2036    1759   0082B C075                           push   h5
    2037    1760   0082D C076                           push   h6
    2038    1761   0082F C077                           push   h7
    2039    1762   00831 C078                           push   h8
    2040    1763   00833 C079                           push   h9
    2041    1764   00835 C07A                           push   h10
    2042    1765   00837 C07B                           push   h11
    2043    1766   00839 C07C                           push   h12
    2044    1767   0083B                  
    2045    1768   0083B                  ; eerst alles voorladen
    2046    1769   0083B                  
    2047    1770   0083B 757000                         mov    h0,#000h
    2048    1771   0083E 757100                         mov    h1,#000h
    2049    1772   00841 757200                         mov    h2,#000h
    2050    1773   00844 757300                         mov    h3,#000h
    2051    1774   00847 757400                         mov    h4,#000h
    2052    1775   0084A 757500                         mov    h5,#000h
    2053    1776   0084D 757600                         mov    h6,#000h
    2054    1777   00850 757700                         mov    h7,#000h
    2055    1778   00853 757800                         mov    h8,#000h
    2056    1779   00856 757900                         mov    h9,#000h
    2057    1780   00859 757A00                         mov    h10,#000h
    2058    1781   0085C 757B00                         mov    h11,#000h
    2059    1782   0085F 757C20                         mov    h12,#32              ;loopcounter
    2060    1783   00862                  
    2061    1784   00862                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2062    1785   00862                  
    2063    1786   00862                  ; deze lus moet 32 keer heraald worden
    2064    1787   00862                  
    2065    1788   00862 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2066    1789   00863 33                             rlc    a
    2067    1790   00864 F8                             mov    r0,a
    2068    1791   00865 E9                             mov    a,r1
    2069    1792   00866 33                             rlc    a
    2070    1793   00867 F9                             mov    r1,a
    2071    1794   00868 EA                             mov    a,r2
    2072    1795   00869 33                             rlc    a
    2073    1796   0086A FA                             mov    r2,a
    2074    1797   0086B EB                             mov    a,r3
    2075    1798   0086C 33                             rlc    a
    2076    1799   0086D FB                             mov    r3,a
    2077    1800   0086E E570                           mov    a,h0
    2078    1801   00870 33                             rlc    a
    2079    1802   00871 F570                           mov    h0,a
    2080    1803   00873 E571                           mov    a,h1
    2081    1804   00875 33                             rlc    a
    2082    1805   00876 F571                           mov    h1,a
    2083    1806   00878 E572                           mov    a,h2
    2084    1807   0087A 33                             rlc    a
    2085    1808   0087B F572                           mov    h2,a
    2086    1809   0087D E573                           mov    a,h3
    2087    1810   0087F 33                             rlc    a
    2088    1811   00880 F573                           mov    h3,a
    2089    1812   00882                  
    2090    1813   00882                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2091    1814   00882                  
    2092    1815   00882 C3                             clr    c                    ;zit in de weg
    2093    1816   00883 E570                           mov    a,h0
    2094    1817   00885 9C                             subb   a,r4
    2095    1818   00886 F574                           mov    h4,a
    2096    1819   00888 E571                           mov    a,h1
    2097    1820   0088A 9D                             subb   a,r5
    2098    1821   0088B F575                           mov    h5,a
    2099    1822   0088D E572                           mov    a,h2
    2100    1823   0088F 9E                             subb   a,r6
    2101    1824   00890 F576                           mov    h6,a
    2102    1825   00892 E573                           mov    a,h3
    2103    1826   00894 9F                             subb   a,r7
    2104    1827   00895 F577                           mov    h7,a
    2105    1828   00897                  
    2106    1829   00897                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2107    1830   00897                  ; vervangen worden door h7-h4
    2108    1831   00897                  
    2109    1832   00897 400C                           jc     div322               ;niet vervangen
    2110    1833   00899                  
    2111    1834   00899 857470                         mov    h0,h4
    2112    1835   0089C 857571                         mov    h1,h5
    2113    1836   0089F 857672                         mov    h2,h6
    2114    1837   008A2 857773                         mov    h3,h7                ;vervanging klaar
    2115    1838   008A5                  
    2116    1839   008A5 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2117    1840   008A6 E578                           mov    a,h8
    2118    1841   008A8 33                             rlc    a
    2119    1842   008A9 F578                           mov    h8,a
    2120    1843   008AB E579                           mov    a,h9
    2121    1844   008AD 33                             rlc    a
    2122    1845   008AE F579                           mov    h9,a
    2123    1846   008B0 E57A                           mov    a,h10
    2124    1847   008B2 33                             rlc    a
    2125    1848   008B3 F57A                           mov    h10,a
    2126    1849   008B5 E57B                           mov    a,h11
    2127    1850   008B7 33                             rlc    a
    2128    1851   008B8 F57B                           mov    h11,a                ;qoutient aangepast
    2129    1852   008BA                  
    2130    1853   008BA D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2131    1854   008BD                  
    2132    1855   008BD                  ; de berekening is klaar. uitkomstregisters nog laden
    2133    1856   008BD                  
    2134    1857   008BD AC78                           mov    r4,h8
    2135    1858   008BF AD79                           mov    r5,h9
    2136    1859   008C1 AE7A                           mov    r6,h10
    2137    1860   008C3 AF7B                           mov    r7,h11               ;uitkomst geladen
    2138    1861   008C5                  
    2139    1862   008C5 A870                           mov    r0,h0                ;rest laden
    2140    1863   008C7 A971                           mov    r1,h1
    2141    1864   008C9 AA72                           mov    r2,h2
    2142    1865   008CB AB73                           mov    r3,h3
    2143    1866   008CD                  
    2144    1867   008CD D07C                           pop    h12                  ;registers herstellen
    2145    1868   008CF D07B                           pop    h11
    2146    1869   008D1 D07A                           pop    h10
    2147    1870   008D3 D079                           pop    h9
    2148    1871   008D5 D078                           pop    h8
    2149    1872   008D7 D077                           pop    h7
    2150    1873   008D9 D076                           pop    h6
    2151    1874   008DB D075                           pop    h5
    2152    1875   008DD D074                           pop    h4
    2153    1876   008DF D073                           pop    h3
    2154    1877   008E1 D072                           pop    h2
    2155    1878   008E3 D071                           pop    h1
    2156    1879   008E5 D070                           pop    h0
    2157    1880   008E7 D0D0                           pop    psw
    2158    1881   008E9 D0E0                           pop    acc
    2159    1882   008EB 22                             ret
    2160    1883   008EC                  
    2161    1884   008EC                  
    2162    1885   008EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2163    1886   008EC                  ;
    2164    1887   008EC                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2165    1888   008EC                  ; input:      r1,r0 = eerste getal (r1=msb)
    2166    1889   008EC                  ;             r3,r2 = tweede getal (r3=msb)
    2167    1890   008EC                  ; output:     r3,r2 = quotient (r3=msb)
    2168    1891   008EC                  ;             r1,r0 = rest (r1=msb)
    2169    1892   008EC                  ;             carry=1 bij deling door 0
    2170    1893   008EC                  ;
    2171    1894   008EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2172    1895   008EC                  
    2173    1896   008EC C0E0             div16:        push   acc                  ;registers op de stack zetten
    2174    1897   008EE C0D0                           push   psw
    2175    1898   008F0 C070                           push   h0
    2176    1899   008F2 C071                           push   h1
    2177    1900   008F4 C072                           push   h2
    2178    1901   008F6 C073                           push   h3
    2179    1902   008F8 C074                           push   h4
    2180    1903   008FA C075                           push   h5
    2181    1904   008FC C076                           push   h6
    2182    1905   008FE                  
    2183    1906   008FE                  ; registers voorladen
    2184    1907   008FE                  
    2185    1908   008FE 757000                         mov    h0,#000h
    2186    1909   00901 757100                         mov    h1,#000h
    2187    1910   00904 757200                         mov    h2,#000h
    2188    1911   00907 757300                         mov    h3,#000h
    2189    1912   0090A 757400                         mov    h4,#000h
    2190    1913   0090D 757500                         mov    h5,#000h
    2191    1914   00910 757610                         mov    h6,#16               ;loopcounter
    2192    1915   00913                  
    2193    1916   00913                  ; eerst te delen getal 1*links shiften in hulpregisters
    2194    1917   00913                  
    2195    1918   00913                  ; deze lus moet 16 keer herhaald worden
    2196    1919   00913                  
    2197    1920   00913 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2198    1921   00914 33                             rlc    a
    2199    1922   00915 F8                             mov    r0,a
    2200    1923   00916 E9                             mov    a,r1
    2201    1924   00917 33                             rlc    a
    2202    1925   00918 F9                             mov    r1,a
    2203    1926   00919 E570                           mov    a,h0
    2204    1927   0091B 33                             rlc    a
    2205    1928   0091C F570                           mov    h0,a
    2206    1929   0091E E571                           mov    a,h1
    2207    1930   00920 33                             rlc    a
    2208    1931   00921 F571                           mov    h1,a
    2209    1932   00923                  
    2210    1933   00923                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2211    1934   00923                  ; het tussenresultaat.
    2212    1935   00923                  
    2213    1936   00923 C3                             clr    c
    2214    1937   00924 E570                           mov    a,h0
    2215    1938   00926 9A                             subb   a,r2
    2216    1939   00927 F572                           mov    h2,a
    2217    1940   00929 E571                           mov    a,h1
    2218    1941   0092B 9B                             subb   a,r3
    2219    1942   0092C F573                           mov    h3,a
    2220    1943   0092E                  
    2221    1944   0092E 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2222    1945   00930                                                            ;door h3,h2
    2223    1946   00930 857270                         mov    h0,h2
    2224    1947   00933 857371                         mov    h1,h3                ;vervanging klaar
    2225    1948   00936                  
    2226    1949   00936                  ; uitkomst moet aangepast worden
    2227    1950   00936                  
    2228    1951   00936 B3               div162:       cpl    c                    ;truuk
    2229    1952   00937 E574                           mov    a,h4
    2230    1953   00939 33                             rlc    a
    2231    1954   0093A F574                           mov    h4,a
    2232    1955   0093C E575                           mov    a,h5
    2233    1956   0093E 33                             rlc    a
    2234    1957   0093F F575                           mov    h5,a
    2235    1958   00941 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2236    1959   00944                  
    2237    1960   00944                  ; de berekening is klaar. uitkomsten in passende registers
    2238    1961   00944                  
    2239    1962   00944 AA74                           mov    r2,h4                ;quotient
    2240    1963   00946 AB75                           mov    r3,h5
    2241    1964   00948                  
    2242    1965   00948 A870                           mov    r0,h0                ;rest
    2243    1966   0094A A971                           mov    r1,h1
    2244    1967   0094C                  
    2245    1968   0094C D076                           pop    h6                   ;registers herstellen
    2246    1969   0094E D075                           pop    h5
    2247    1970   00950 D074                           pop    h4
    2248    1971   00952 D073                           pop    h3
    2249    1972   00954 D072                           pop    h2
    2250    1973   00956 D071                           pop    h1
    2251    1974   00958 D070                           pop    h0
    2252    1975   0095A D0D0                           pop    psw
    2253    1976   0095C D0E0                           pop    acc
    2254    1977   0095E 22                             ret
    2255    1978   0095F                  
    2256    1979   0095F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2257    1980   0095F                  ;
    2258    1981   0095F                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2259    1982   0095F                  ;
    2260    1983   0095F                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2261    1984   0095F                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2262    1985   0095F                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2263    1986   0095F                  ;
    2264    1987   0095F                  ; r4,r3,r2,r1,r0 worden aangepast
    2265    1988   0095F                  ;
    2266    1989   0095F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2267    1990   0095F                  
    2268    1991   0095F C0E0             add32:        push   acc                  ;registers op de stack zetten
    2269    1992   00961 C0D0                           push   psw
    2270    1993   00963 E8                             mov    a,r0                 ;eerste 8 bit
    2271    1994   00964 2C                             add    a,r4
    2272    1995   00965 F8                             mov    r0,a                 ;klaar
    2273    1996   00966 E9                             mov    a,r1                 ;volgende 8 bit
    2274    1997   00967 3D                             addc   a,r5
    2275    1998   00968 F9                             mov    r1,a                 ;klaar
    2276    1999   00969 EA                             mov    a,r2                 ;volgende 8 bit
    2277    2000   0096A 3E                             addc   a,r6
    2278    2001   0096B FA                             mov    r2,a                 ;klaar
    2279    2002   0096C EB                             mov    a,r3                 ;laatste 8 bit
    2280    2003   0096D 3F                             addc   a,r7
    2281    2004   0096E FB                             mov    r3,a                 ;32 bit klaar
    2282    2005   0096F 7400                           mov    a,#000h
    2283    2006   00971 3400                           addc   a,#000h              ;carry verrekenen
    2284    2007   00973 FC                             mov    r4,a
    2285    2008   00974 D0D0                           pop    psw                  ;registers herstellen
    2286    2009   00976 D0E0                           pop    acc
    2287    2010   00978 22                             ret
    2288    2011   00979                  
    2289    2012   00979                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2290    2013   00979                  ;
    2291    2014   00979                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2292    2015   00979                  ;
    2293    2016   00979                  ; input:      r1,r0 = eerste getal (r1=msb)
    2294    2017   00979                  ;             r3,r2 = tweede getal (r3=msb)
    2295    2018   00979                  ; output:     r2,r1,r0 (r2=msb)
    2296    2019   00979                  ;
    2297    2020   00979                  ; r3,r2,r1,r0 worden aangepast
    2298    2021   00979                  ;
    2299    2022   00979                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2300    2023   00979                  
    2301    2024   00979 C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2302    2025   0097B C0D0                           push   psw
    2303    2026   0097D E8                             mov    a,r0                 ;starten met de optelling
    2304    2027   0097E 2A                             add    a,r2                 ;8 bit klaar
    2305    2028   0097F F8                             mov    r0,a                 ;uitkomst wegschrijven
    2306    2029   00980 E9                             mov    a,r1                 ;volgende 8 bit
    2307    2030   00981 3B                             addc   a,r3                 ;16 bit klaar
    2308    2031   00982 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2309    2032   00983 7400                           mov    a,#000h              ;carry verrekenen
    2310    2033   00985 3400                           addc   a,#000h
    2311    2034   00987 FA                             mov    r2,a                 ;24 bit klaar
    2312    2035   00988 D0D0                           pop    psw                  ;registers herstellen
    2313    2036   0098A D0E0                           pop    acc
    2314    2037   0098C 22                             ret
    2315    2038   0098D                  
    2316    2039   0098D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2317    2040   0098D                  ;
    2318    2041   0098D                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2319    2042   0098D                  ;             40 bit groot. (eerste -tweede)
    2320    2043   0098D                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2321    2044   0098D                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2322    2045   0098D                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2323    2046   0098D                  ;
    2324    2047   0098D                  ; r4,r3,r2,r1,r0 worden aangepast
    2325    2048   0098D                  ;
    2326    2049   0098D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2327    2050   0098D                  
    2328    2051   0098D C0E0             sub32:        push   acc                  ;registers bewaren
    2329    2052   0098F C0D0                           push   psw                  ;ook de vlaggen
    2330    2053   00991 C3                             clr    c                    ;zit nog effe in de weg
    2331    2054   00992 E8                             mov    a,r0                 ;eerste 8 bit
    2332    2055   00993 9C                             subb   a,r4
    2333    2056   00994 F8                             mov    r0,a
    2334    2057   00995 E9                             mov    a,r1                 ;tweede 8 bit
    2335    2058   00996 9D                             subb   a,r5
    2336    2059   00997 F9                             mov    r1,a
    2337    2060   00998 EA                             mov    a,r2                 ;volgende 8 bit
    2338    2061   00999 9E                             subb   a,r6
    2339    2062   0099A FA                             mov    r2,a
    2340    2063   0099B EB                             mov    a,r3                 ;laatste 8 bit
    2341    2064   0099C 9F                             subb   a,r7
    2342    2065   0099D FB                             mov    r3,a
    2343    2066   0099E 7400                           mov    a,#000h              ;nu nog de carry
    2344    2067   009A0 9400                           subb   a,#000h
    2345    2068   009A2 FC                             mov    r4,a                 ;40 bit klaar
    2346    2069   009A3 D0D0                           pop    psw                  ;registers herstellen
    2347    2070   009A5 D0E0                           pop    acc
    2348    2071   009A7 22                             ret
    2349    2072   009A8                  
    2350    2073   009A8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2351    2074   009A8                  ;
    2352    2075   009A8                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2353    2076   009A8                  ;             24 bit groot. (eerste - tweede)
    2354    2077   009A8                  ; input:      r1,r0 = eerste getal (r1=msb)
    2355    2078   009A8                  ;             r3,r2 = tweede getal (r3=msb)
    2356    2079   009A8                  ; output:     r2,r1,r0 (r2=msb)
    2357    2080   009A8                  ;
    2358    2081   009A8                  ; r3,r2,r1,r0 worden aangepast
    2359    2082   009A8                  ;
    2360    2083   009A8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2361    2084   009A8                  
    2362    2085   009A8 C0E0             sub16:        push   acc                  ;registers bewaren
    2363    2086   009AA C0D0                           push   psw
    2364    2087   009AC C3                             clr    c                    ;mag nog niet meespelen
    2365    2088   009AD E8                             mov    a,r0                 ;eerste 8 bit verschil
    2366    2089   009AE 9A                             subb   a,r2
    2367    2090   009AF F8                             mov    r0,a                 ;klaar
    2368    2091   009B0 E9                             mov    a,r1
    2369    2092   009B1 9B                             subb   a,r3                 ;16 bit klaar
    2370    2093   009B2 F9                             mov    r1,a
    2371    2094   009B3 7400                           mov    a,#000h
    2372    2095   009B5 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2373    2096   009B7 FA                             mov    r2,a                 ;24 bit klaar
    2374    2097   009B8 D0D0                           pop    psw                  ;registers herstellen
    2375    2098   009BA D0E0                           pop    acc
    2376    2099   009BC 22                             ret
    2377    2100   009BD                  
    2378    2101   009BD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2379    2102   009BD                  ;
    2380    2103   009BD                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2381    2104   009BD                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2382    2105   009BD                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2383    2106   009BD                  ;
    2384    2107   009BD                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2385    2108   009BD                  ;
    2386    2109   009BD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2387    2110   009BD                  
    2388    2111   009BD C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2389    2112   009BF C0D0                           push   psw
    2390    2113   009C1                  
    2391    2114   009C1 C077                           push   h7                   ;nodig
    2392    2115   009C3 C078                           push   h8
    2393    2116   009C5                  
    2394    2117   009C5 C079                           push   h9                   ;ook
    2395    2118   009C7                  
    2396    2119   009C7 757905                         mov    h9,#005h             ;loopcounter
    2397    2120   009CA                  
    2398    2121   009CA 7B00             hexbcd161:    mov    r3,#000h
    2399    2122   009CC 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2400    2123   009CE 1208EC                         lcall  div16                ;deling uitvoeren
    2401    2124   009D1 E8                             mov    a,r0                 ;rest
    2402    2125   009D2 C0E0                           push   acc                  ;op stack zetten
    2403    2126   009D4 EA                             mov    a,r2
    2404    2127   009D5 F8                             mov    r0,a
    2405    2128   009D6 EB                             mov    a,r3
    2406    2129   009D7 F9                             mov    r1,a                 ;uitkomst terug delen
    2407    2130   009D8 D579EF                         djnz   h9,hexbcd161
    2408    2131   009DB                  
    2409    2132   009DB D0E0                           pop    acc                  ;hoogste bits van de stack
    2410    2133   009DD FA                             mov    r2,a                 ;klaar
    2411    2134   009DE D0E0                           pop    acc
    2412    2135   009E0 C4                             swap   a
    2413    2136   009E1 F579                           mov    h9,a
    2414    2137   009E3 D0E0                           pop    acc
    2415    2138   009E5 2579                           add    a,h9
    2416    2139   009E7 F9                             mov    r1,a                 ;volgende 8 klaar
    2417    2140   009E8 D0E0                           pop    acc
    2418    2141   009EA C4                             swap   a
    2419    2142   009EB F579                           mov    h9,a
    2420    2143   009ED D0E0                           pop    acc
    2421    2144   009EF 2579                           add    a,h9
    2422    2145   009F1 F8                             mov    r0,a                 ;klaar
    2423    2146   009F2                  
    2424    2147   009F2 D079                           pop    h9                   ;was naar de knoppen
    2425    2148   009F4                  
    2426    2149   009F4 D078                           pop    h8                   ;gebruikt
    2427    2150   009F6 D077                           pop    h7
    2428    2151   009F8                  
    2429    2152   009F8 D0D0                           pop    psw                  ;registers herstellen
    2430    2153   009FA D0E0                           pop    acc
    2431    2154   009FC 22                             ret
    2432    2155   009FD                  
    2433    2156   009FD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2434    2157   009FD                  ;
    2435    2158   009FD                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2436    2159   009FD                  ; input       a (maximale waarde = 63h)
    2437    2160   009FD                  ; output      a
    2438    2161   009FD                  ;
    2439    2162   009FD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2440    2163   009FD                  
    2441    2164   009FD C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2442    2165   009FF C0F0                           push   b
    2443    2166   00A01 75F00A                         mov    b,#00ah              ;hierdoor delen
    2444    2167   00A04 84                             div    ab                   ;in accu qoutient in b rest
    2445    2168   00A05 C4                             swap   a
    2446    2169   00A06 25F0                           add    a,b                  ;bcd getal klaar
    2447    2170   00A08 D0F0                           pop    b
    2448    2171   00A0A D0D0                           pop    psw
    2449    2172   00A0C 22                             ret
    2450    2173   00A0D                  
    2451    2174   00A0D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2452    2175   00A0D                  ;
    2453    2176   00A0D                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2454    2177   00A0D                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2455    2178   00A0D                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2456    2179   00A0D                  ;
    2457    2180   00A0D                  ; de routine gebruikt r1,r0 van de huidige bank
    2458    2181   00A0D                  ;
    2459    2182   00A0D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2460    2183   00A0D                  
    2461    2184   00A0D C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2462    2185   00A0F C0E0                           push   acc
    2463    2186   00A11 C0D0                           push   psw
    2464    2187   00A13                  
    2465    2188   00A13 E8                             mov    a,r0
    2466    2189   00A14 540F                           anl    a,#00fh              ;eenheden
    2467    2190   00A16 C0E0                           push   acc                  ;effe bewaren
    2468    2191   00A18                  
    2469    2192   00A18 E8                             mov    a,r0
    2470    2193   00A19 C4                             swap   a
    2471    2194   00A1A 540F                           anl    a,#00fh              ;tientallen
    2472    2195   00A1C 75F00A                         mov    b,#00ah              ;waarde berekenen
    2473    2196   00A1F A4                             mul    ab                   ;klaar
    2474    2197   00A20 D0F0                           pop    b                    ;truukje
    2475    2198   00A22 25F0                           add    a,b                  ;a is lage deel hex getal
    2476    2199   00A24 C0E0                           push   acc                  ;straks nodig
    2477    2200   00A26                  
    2478    2201   00A26 E9                             mov    a,r1                 ;hoge deel
    2479    2202   00A27 54F0                           anl    a,#0f0h
    2480    2203   00A29 C4                             swap   a
    2481    2204   00A2A C0E0                           push   acc                  ;straks nodig
    2482    2205   00A2C                  
    2483    2206   00A2C E9                             mov    a,r1
    2484    2207   00A2D 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2485    2208   00A2F 75F064                         mov    b,#100               ;waarde uitrekenen
    2486    2209   00A32 A4                             mul    ab
    2487    2210   00A33 A9F0                           mov    r1,b
    2488    2211   00A35 F8                             mov    r0,a
    2489    2212   00A36                  
    2490    2213   00A36 D0E0                           pop    acc
    2491    2214   00A38 75F00A                         mov    b,#10
    2492    2215   00A3B A4                             mul    ab                   ;kan nog in a
    2493    2216   00A3C 75F064                         mov    b,#100               ;*10*100=*1000
    2494    2217   00A3F A4                             mul    ab
    2495    2218   00A40 28                             add    a,r0
    2496    2219   00A41 F8                             mov    r0,a
    2497    2220   00A42 E9                             mov    a,r1
    2498    2221   00A43 35F0                           addc   a,b
    2499    2222   00A45 F9                             mov    r1,a
    2500    2223   00A46                  
    2501    2224   00A46 D0E0                           pop    acc
    2502    2225   00A48 28                             add    a,r0
    2503    2226   00A49 F8                             mov    r0,a
    2504    2227   00A4A 7400                           mov    a,#000h
    2505    2228   00A4C 39                             addc   a,r1
    2506    2229   00A4D F9                             mov    r1,a                 ;klaar
    2507    2230   00A4E                  
    2508    2231   00A4E D0D0                           pop    psw
    2509    2232   00A50 D0E0                           pop    acc
    2510    2233   00A52 D0F0                           pop    b
    2511    2234   00A54 22                             ret
    2512    2235   00A55                  
    2513    2236   00A55                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2514    2237   00A55                  ;
    2515    2238   00A55                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2516    2239   00A55                  ; input:      a (maximale waarde 99h)
    2517    2240   00A55                  ; output:     a
    2518    2241   00A55                  ;
    2519    2242   00A55                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2520    2243   00A55                  
    2521    2244   00A55 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2522    2245   00A57 C0F0                           push   b
    2523    2246   00A59 C070                           push   h0
    2524    2247   00A5B F570                           mov    h0,a                 ;effe bewaren
    2525    2248   00A5D 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2526    2249   00A60 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2527    2250   00A62 C4                             swap   a
    2528    2251   00A63 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2529    2252   00A66 A4                             mul    ab
    2530    2253   00A67 2570                           add    a,h0                 ;eenheden bijtellen
    2531    2254   00A69 D070                           pop    h0
    2532    2255   00A6B D0F0                           pop    b
    2533    2256   00A6D D0D0                           pop    psw
    2534    2257   00A6F 22                             ret
    2535    2258   00A70                  
    2536    2259   00A70                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2537    2260   00A70                  ;
    2538    2261   00A70                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2539    2262   00A70                  ;
    2540    2263   00A70                  ; Gebruikt geen registers
    2541    2264   00A70                  ;
    2542    2265   00A70                  ; Originele auteur: Danny Pawels (dp)
    2543    2266   00A70                  ;
    2544    2267   00A70                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2545    2268   00A70                  
    2546    2269   00A70                  
    2547    2270   00A70 C083             XCsw2xtal:  push  dph
    2548    2271   00A72 C082                         push  dpl
    2549    2272   00A74 C0D0                         push  psw
    2550    2273   00A76 C08F                         push  syscon0
    2551    2274   00A78 C0B2                         push  port_page
    2552    2275   00A7A C0BF                         push  scu_page
    2553    2276   00A7C                  
    2554    2277   00A7C 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2555    2278   00A7F 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2556    2279   00A82                  
    2557    2280   00A82 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2558    2281   00A85                                                            ;freq= VCO-free running =5MHz...20MHz?
    2559    2282   00A85 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2560    2283   00A88 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2561    2284   00A8B 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2562    2285   00A8E                  
    2563    2286   00A8E 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2564    2287   00A91 A3               XCsw2xtal0: inc   dptr
    2565    2288   00A92 E582                         mov   a,dpl
    2566    2289   00A94 4583                         orl   a,dph
    2567    2290   00A96 70F9                         jnz   XCsw2xtal0
    2568    2291   00A98                  
    2569    2292   00A98 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2570    2293   00A9B                  
    2571    2294   00A9B                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2572    2295   00A9B E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2573    2296   00A9D 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2574    2297   00AA0                  ;Oscillator run detectie is klaar...
    2575    2298   00AA0 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2576    2299   00AA3                  
    2577    2300   00AA3                  
    2578    2301   00AA3 E5B7                         mov   a,pll_con               ;lees pll_con
    2579    2302   00AA5 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2580    2303   00AA7 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2581    2304   00AA9                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2582    2305   00AA9                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2583    2306   00AA9                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2584    2307   00AA9 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2585    2308   00AAC                                                            ;bij aanpassing van de NDIV van de PLL
    2586    2309   00AAC F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2587    2310   00AAE 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2588    2311   00AB1 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2589    2312   00AB4                  
    2590    2313   00AB4 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2591    2314   00AB6 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2592    2315   00AB9                  
    2593    2316   00AB9 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2594    2317   00ABC 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2595    2318   00ABF                  
    2596    2319   00ABF D0BF                         pop   scu_page                ;herstel controller status
    2597    2320   00AC1 D0B2                         pop   port_page
    2598    2321   00AC3 D08F                         pop   syscon0
    2599    2322   00AC5 D0D0                         pop   psw
    2600    2323   00AC7 D082                         pop   dpl
    2601    2324   00AC9 D083                         pop   dph
    2602    2325   00ACB 22                           ret
    2603    2326   00ACC                  
    2604    2327   00ACC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2605    2328   00ACC                  ;
    2606    2329   00ACC                  ; mapregs	selecteer de SFR's in de mapped area
    2607    2330   00ACC                  ;
    2608    2331   00ACC                  ;
    2609    2332   00ACC                  ; Past syscon SFR aan
    2610    2333   00ACC                  ;
    2611    2334   00ACC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2612    2335   00ACC                  
    2613    2336   00ACC 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2614    2337   00ACF 22               		ret
    2615    2338   00AD0                  
    2616    2339   00AD0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2617    2340   00AD0                  ;
    2618    2341   00AD0                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2619    2342   00AD0                  ;
    2620    2343   00AD0                  ; Past syscon SFR aan
    2621    2344   00AD0                  ;
    2622    2345   00AD0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2623    2346   00AD0                  
    2624    2347   00AD0 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2625    2348   00AD3 22               		ret
    2626    2349   00AD4                  
    2627    2350   00AD4                  ;*******************************************************************************
    2628    2351   00AD4                  ;
    2629    2352   00AD4                  ; These are the register declarations for the XC888 microcontroller from
    2630    2353   00AD4                  ; Infineon.
    2631    2354   00AD4                  ;
    2632    2355   00AD4                  ;*******************************************************************************
    2633    2356   00AD4                  
    2634    2357   00AD4                  ;*******************************************************************************
    2635    2358   00AD4                  ;
    2636    2359   00AD4                  ; CPU registers are accessible independend of paging and mapping
    2637    2360   00AD4                  ; (always accessible)
    2638    2361   00AD4                  ;
    2639    2362   00AD4                  ;*******************************************************************************
    2640    2363   00AD4                  
    2641    2364   00AD4                  sp            data   081h          ;stack pointer                     reset=007h
    2642    2365   00AD4                  dpl           data   082h          ;datapointer low register          reset=000h
    2643    2366   00AD4                  dph           data   083h          ;datapointer high register         reset=000h
    2644    2367   00AD4                  pcon          data   087h          ;power control                     reset=000h
    2645    2368   00AD4                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2646    2369   00AD4                  ;tcon is bit addressable
    2647    2370   00AD4                         tf1    bit    08fh
    2648    2371   00AD4                         tr1    bit    08eh
    2649    2372   00AD4                         tf0    bit    08dh
    2650    2373   00AD4                         tr0    bit    08ch
    2651    2374   00AD4                         ie1    bit    08bh
    2652    2375   00AD4                         it1    bit    08ah
    2653    2376   00AD4                         ie0    bit    089h
    2654    2377   00AD4                         it0    bit    088h
    2655    2378   00AD4                  
    2656    2379   00AD4                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2657    2380   00AD4                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2658    2381   00AD4                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2659    2382   00AD4                  th0           data   08ch          ;timer 0 high                      reset=000h
    2660    2383   00AD4                  th1           data   08dh          ;timer 1 high                      reset=000h
    2661    2384   00AD4                  
    2662    2385   00AD4                  syscon0       data   08fh          ;system control register 0         reset=004h
    2663    2386   00AD4                  scon          data   098h          ;serial channel 0 control          reset=000h
    2664    2387   00AD4                  ;scon is bit addressable
    2665    2388   00AD4                         sm0    bit    09fh
    2666    2389   00AD4                         sm1    bit    09eh
    2667    2390   00AD4                         sm2    bit    09dh
    2668    2391   00AD4                         ren    bit    09ch
    2669    2392   00AD4                         tb8    bit    09bh
    2670    2393   00AD4                         rb8    bit    09ah
    2671    2394   00AD4                         ti     bit    099h
    2672    2395   00AD4                         ri     bit    098h
    2673    2396   00AD4                  
    2674    2397   00AD4                  sbuf          data   099h          ;serial data buffer channel 0
    2675    2398   00AD4                  eo            data   0a2h          ;extended operation                reset=000h
    2676    2399   00AD4                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2677    2400   00AD4                  ;ien0 is bit addressable
    2678    2401   00AD4                         ea     bit    0afh
    2679    2402   00AD4                                                     ;bit not implemented
    2680    2403   00AD4                         et2    bit    0adh
    2681    2404   00AD4                         es     bit    0ach
    2682    2405   00AD4                         et1    bit    0abh
    2683    2406   00AD4                         ex1    bit    0aah
    2684    2407   00AD4                         et0    bit    0a9h
    2685    2408   00AD4                         ex0    bit    0a8h
    2686    2409   00AD4                  
    2687    2410   00AD4                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2688    2411   00AD4                  ;ip is bit addressable
    2689    2412   00AD4                                                     ;bit not implemented
    2690    2413   00AD4                                                     ;bit not implemented
    2691    2414   00AD4                         pt2    bit    0bdh
    2692    2415   00AD4                         ps     bit    0bch
    2693    2416   00AD4                         pt1    bit    0bbh
    2694    2417   00AD4                         px1    bit    0bah
    2695    2418   00AD4                         pt0    bit    0b9h
    2696    2419   00AD4                         px0    bit    0b8h
    2697    2420   00AD4                  
    2698    2421   00AD4                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2699    2422   00AD4                  psw           data   0d0h          ;program status word               reset=000h
    2700    2423   00AD4                  ;psw is bit addressable
    2701    2424   00AD4                         cy     bit    0d7h
    2702    2425   00AD4                         ac     bit    0d6h
    2703    2426   00AD4                         f0     bit    0d5h
    2704    2427   00AD4                         rs1    bit    0d4h
    2705    2428   00AD4                         rs0    bit    0d3h
    2706    2429   00AD4                         ov     bit    0d2h
    2707    2430   00AD4                         f1     bit    0d1h
    2708    2431   00AD4                         p      bit    0d0h
    2709    2432   00AD4                  
    2710    2433   00AD4                  acc           data   0e0h          ;accumulator                       reset=000h
    2711    2434   00AD4                  ;acc is bit addressable
    2712    2435   00AD4                  
    2713    2436   00AD4                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2714    2437   00AD4                  ;ien1 is bit addressable
    2715    2438   00AD4                         eccip3 bit    0efh
    2716    2439   00AD4                         eccip2 bit    0eeh
    2717    2440   00AD4                         eccip1 bit    0edh
    2718    2441   00AD4                         eccip0 bit    0ech
    2719    2442   00AD4                         exm    bit    0ebh
    2720    2443   00AD4                         ex2    bit    0eah
    2721    2444   00AD4                         essc   bit    0e9h
    2722    2445   00AD4                         eadc   bit    0e8h
    2723    2446   00AD4                  
    2724    2447   00AD4                  b             data   0f0h          ;b register                        reset=000h
    2725    2448   00AD4                  ;b is bit addressable
    2726    2449   00AD4                  
    2727    2450   00AD4                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2728    2451   00AD4                  ;ip1 is bit addressable
    2729    2452   00AD4                         pccip3 bit    0ffh
    2730    2453   00AD4                         pccip2 bit    0feh
    2731    2454   00AD4                         pccip1 bit    0fdh
    2732    2455   00AD4                         pccip0 bit    0fch
    2733    2456   00AD4                         pxm    bit    0fbh
    2734    2457   00AD4                         px2    bit    0fah
    2735    2458   00AD4                         pssc   bit    0f9h
    2736    2459   00AD4                         padc   bit    0f8h
    2737    2460   00AD4                  
    2738    2461   00AD4                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2739    2462   00AD4                  
    2740    2463   00AD4                  
    2741    2464   00AD4                  ;*******************************************************************************
    2742    2465   00AD4                  ;
    2743    2466   00AD4                  ; system control registers registers that can only be accessed in the non
    2744    2467   00AD4                  ; mapped memory area (rmap=0) page independent
    2745    2468   00AD4                  ;
    2746    2469   00AD4                  ;*******************************************************************************
    2747    2470   00AD4                  
    2748    2471   00AD4                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2749    2472   00AD4                  
    2750    2473   00AD4                  ;*******************************************************************************
    2751    2474   00AD4                  ;
    2752    2475   00AD4                  ; system control registers registers that can only be accessed in the non
    2753    2476   00AD4                  ; mapped memory area (rmap=0) and page 0
    2754    2477   00AD4                  ;
    2755    2478   00AD4                  ;*******************************************************************************
    2756    2479   00AD4                  
    2757    2480   00AD4                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2758    2481   00AD4                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2759    2482   00AD4                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2760    2483   00AD4                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2761    2484   00AD4                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2762    2485   00AD4                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2763    2486   00AD4                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2764    2487   00AD4                  nmisr         data   0bch          ;nmi status                        reset=000h
    2765    2488   00AD4                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2766    2489   00AD4                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2767    2490   00AD4                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2768    2491   00AD4                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2769    2492   00AD4                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2770    2493   00AD4                  
    2771    2494   00AD4                  ;*******************************************************************************
    2772    2495   00AD4                  ;
    2773    2496   00AD4                  ; system control registers registers that can only be accessed in the non
    2774    2497   00AD4                  ; mapped memory area (rmap=0) and page 1
    2775    2498   00AD4                  ;
    2776    2499   00AD4                  ;*******************************************************************************
    2777    2500   00AD4                  
    2778    2501   00AD4                  id            data   0b3h          ;identity register     reset=device dependent
    2779    2502   00AD4                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2780    2503   00AD4                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2781    2504   00AD4                  osc_con       data   0b6h          ;osc control                       reset=008h
    2782    2505   00AD4                  pll_con       data   0b7h          ;pll control                       reset=090h
    2783    2506   00AD4                  cmcon         data   0bah          ;clock control                     reset=010h
    2784    2507   00AD4                  passwd        data   0bbh          ;password register                 reset=007h
    2785    2508   00AD4                  feal          data   0bch          ;flash error register              reset=000h
    2786    2509   00AD4                  feah          data   0bdh          ;flash error address high          reset=000h
    2787    2510   00AD4                  cocon         data   0beh          ;clock output control              reset=000h
    2788    2511   00AD4                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2789    2512   00AD4                  
    2790    2513   00AD4                  ;*******************************************************************************
    2791    2514   00AD4                  ;
    2792    2515   00AD4                  ; system control registers registers that can only be accessed in the non
    2793    2516   00AD4                  ; mapped memory area (rmap=0) and page 3
    2794    2517   00AD4                  ;
    2795    2518   00AD4                  ;*******************************************************************************
    2796    2519   00AD4                  
    2797    2520   00AD4                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2798    2521   00AD4                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2799    2522   00AD4                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2800    2523   00AD4                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2801    2524   00AD4                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2802    2525   00AD4                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2803    2526   00AD4                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2804    2527   00AD4                  
    2805    2528   00AD4                  ;*******************************************************************************
    2806    2529   00AD4                  ;
    2807    2530   00AD4                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2808    2531   00AD4                  ;
    2809    2532   00AD4                  ;*******************************************************************************
    2810    2533   00AD4                  
    2811    2534   00AD4                  port_page     data   0b2h          ;port page register                reset=000h
    2812    2535   00AD4                  
    2813    2536   00AD4                  ;*******************************************************************************
    2814    2537   00AD4                  ;
    2815    2538   00AD4                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2816    2539   00AD4                  ;
    2817    2540   00AD4                  ;*******************************************************************************
    2818    2541   00AD4                  
    2819    2542   00AD4                  p0_data       data   080h          ;port 0 data register              reset=000h
    2820    2543   00AD4                  ;p0_data is bit addressable
    2821    2544   00AD4                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2822    2545   00AD4                  p1_data       data   090h          ;port 1 data register              reset=000h
    2823    2546   00AD4                  ;p1_data is bit addressable
    2824    2547   00AD4                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2825    2548   00AD4                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2826    2549   00AD4                  ;p2_data is bit addressable
    2827    2550   00AD4                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2828    2551   00AD4                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2829    2552   00AD4                  ;p3_data is bit addressable
    2830    2553   00AD4                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2831    2554   00AD4                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2832    2555   00AD4                  ;p4_data is bit addressable
    2833    2556   00AD4                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2834    2557   00AD4                  p5_data       data   092h          ;port 5 data register              reset=000h
    2835    2558   00AD4                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2836    2559   00AD4                  
    2837    2560   00AD4                  ;*******************************************************************************
    2838    2561   00AD4                  ;
    2839    2562   00AD4                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2840    2563   00AD4                  ;
    2841    2564   00AD4                  ;*******************************************************************************
    2842    2565   00AD4                  
    2843    2566   00AD4                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2844    2567   00AD4                  ;p0_data is bit addressable
    2845    2568   00AD4                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2846    2569   00AD4                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2847    2570   00AD4                  ;p1_data is bit addressable
    2848    2571   00AD4                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2849    2572   00AD4                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2850    2573   00AD4                  ;p2_data is bit addressable
    2851    2574   00AD4                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2852    2575   00AD4                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2853    2576   00AD4                  ;p3_data is bit addressable
    2854    2577   00AD4                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2855    2578   00AD4                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2856    2579   00AD4                  ;p4_data is bit addressable
    2857    2580   00AD4                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2858    2581   00AD4                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2859    2582   00AD4                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2860    2583   00AD4                  
    2861    2584   00AD4                  ;*******************************************************************************
    2862    2585   00AD4                  ;
    2863    2586   00AD4                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2864    2587   00AD4                  ;
    2865    2588   00AD4                  ;*******************************************************************************
    2866    2589   00AD4                  
    2867    2590   00AD4                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2868    2591   00AD4                  ;p0_data is bit addressable
    2869    2592   00AD4                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2870    2593   00AD4                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2871    2594   00AD4                  ;p1_data is bit addressable
    2872    2595   00AD4                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2873    2596   00AD4                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2874    2597   00AD4                  ;p3_data is bit addressable
    2875    2598   00AD4                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2876    2599   00AD4                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2877    2600   00AD4                  ;p4_data is bit addressable
    2878    2601   00AD4                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2879    2602   00AD4                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2880    2603   00AD4                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2881    2604   00AD4                  
    2882    2605   00AD4                  ;*******************************************************************************
    2883    2606   00AD4                  ;
    2884    2607   00AD4                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2885    2608   00AD4                  ;
    2886    2609   00AD4                  ;*******************************************************************************
    2887    2610   00AD4                  
    2888    2611   00AD4                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2889    2612   00AD4                  ;p0_data is bit addressable
    2890    2613   00AD4                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2891    2614   00AD4                  ;p1_data is bit addressable
    2892    2615   00AD4                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2893    2616   00AD4                  ;p3_data is bit addressable
    2894    2617   00AD4                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2895    2618   00AD4                  ;p4_data is bit addressable
    2896    2619   00AD4                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2897    2620   00AD4                  
    2898    2621   00AD4                  ;*******************************************************************************
    2899    2622   00AD4                  ;
    2900    2623   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2901    2624   00AD4                  ;
    2902    2625   00AD4                  ;*******************************************************************************
    2903    2626   00AD4                  
    2904    2627   00AD4                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2905    2628   00AD4                  
    2906    2629   00AD4                  ;*******************************************************************************
    2907    2630   00AD4                  ;
    2908    2631   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2909    2632   00AD4                  ;
    2910    2633   00AD4                  ;*******************************************************************************
    2911    2634   00AD4                  
    2912    2635   00AD4                  adc_globctr   data   0cah          ;global control register           reset=030h
    2913    2636   00AD4                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2914    2637   00AD4                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2915    2638   00AD4                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2916    2639   00AD4                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2917    2640   00AD4                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2918    2641   00AD4                  
    2919    2642   00AD4                  ;*******************************************************************************
    2920    2643   00AD4                  ;
    2921    2644   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2922    2645   00AD4                  ;
    2923    2646   00AD4                  ;*******************************************************************************
    2924    2647   00AD4                  
    2925    2648   00AD4                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2926    2649   00AD4                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2927    2650   00AD4                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2928    2651   00AD4                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2929    2652   00AD4                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2930    2653   00AD4                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2931    2654   00AD4                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2932    2655   00AD4                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2933    2656   00AD4                  
    2934    2657   00AD4                  ;*******************************************************************************
    2935    2658   00AD4                  ;
    2936    2659   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2937    2660   00AD4                  ;
    2938    2661   00AD4                  ;*******************************************************************************
    2939    2662   00AD4                  
    2940    2663   00AD4                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2941    2664   00AD4                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2942    2665   00AD4                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2943    2666   00AD4                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2944    2667   00AD4                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2945    2668   00AD4                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2946    2669   00AD4                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2947    2670   00AD4                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2948    2671   00AD4                  
    2949    2672   00AD4                  ;*******************************************************************************
    2950    2673   00AD4                  ;
    2951    2674   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2952    2675   00AD4                  ;
    2953    2676   00AD4                  ;*******************************************************************************
    2954    2677   00AD4                  
    2955    2678   00AD4                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2956    2679   00AD4                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2957    2680   00AD4                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2958    2681   00AD4                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2959    2682   00AD4                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2960    2683   00AD4                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2961    2684   00AD4                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2962    2685   00AD4                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2963    2686   00AD4                  
    2964    2687   00AD4                  ;*******************************************************************************
    2965    2688   00AD4                  ;
    2966    2689   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2967    2690   00AD4                  ;
    2968    2691   00AD4                  ;*******************************************************************************
    2969    2692   00AD4                  
    2970    2693   00AD4                  adc_rcr0      data   0cah          ;result control register           reset=000h
    2971    2694   00AD4                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    2972    2695   00AD4                  adc_rcr2      data   0cch          ;result control register           reset=000h
    2973    2696   00AD4                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    2974    2697   00AD4                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    2975    2698   00AD4                  
    2976    2699   00AD4                  ;*******************************************************************************
    2977    2700   00AD4                  ;
    2978    2701   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    2979    2702   00AD4                  ;
    2980    2703   00AD4                  ;*******************************************************************************
    2981    2704   00AD4                  
    2982    2705   00AD4                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    2983    2706   00AD4                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    2984    2707   00AD4                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    2985    2708   00AD4                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    2986    2709   00AD4                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    2987    2710   00AD4                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    2988    2711   00AD4                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    2989    2712   00AD4                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    2990    2713   00AD4                  
    2991    2714   00AD4                  ;*******************************************************************************
    2992    2715   00AD4                  ;
    2993    2716   00AD4                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    2994    2717   00AD4                  ;
    2995    2718   00AD4                  ;*******************************************************************************
    2996    2719   00AD4                  
    2997    2720   00AD4                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    2998    2721   00AD4                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    2999    2722   00AD4                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3000    2723   00AD4                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3001    2724   00AD4                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3002    2725   00AD4                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3003    2726   00AD4                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3004    2727   00AD4                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3005    2728   00AD4                  
    3006    2729   00AD4                  ;*******************************************************************************
    3007    2730   00AD4                  
    3008    2731   00AD4                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3009    2732   00AD4                  ;
    3010    2733   00AD4                  ;*******************************************************************************
    3011    2734   00AD4                  
    3012    2735   00AD4                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3013    2736   00AD4                  ;t2_t2con is bit addressable
    3014    2737   00AD4                         tf2    bit    0c7h
    3015    2738   00AD4                         exf2   bit    0c6h
    3016    2739   00AD4                                                     ;2 bits are not implemented
    3017    2740   00AD4                         exen2  bit    0c3h
    3018    2741   00AD4                         tr2    bit    0c2h
    3019    2742   00AD4                         ct2    bit    0c1h
    3020    2743   00AD4                         cprl2  bit    0c0h
    3021    2744   00AD4                  
    3022    2745   00AD4                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3023    2746   00AD4                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3024    2747   00AD4                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3025    2748   00AD4                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3026    2749   00AD4                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3027    2750   00AD4                  
    3028    2751   00AD4                  ;*******************************************************************************
    3029    2752   00AD4                  ;
    3030    2753   00AD4                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3031    2754   00AD4                  ;
    3032    2755   00AD4                  ;*******************************************************************************
    3033    2756   00AD4                  
    3034    2757   00AD4                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3035    2758   00AD4                  
    3036    2759   00AD4                  ;*******************************************************************************
    3037    2760   00AD4                  ;
    3038    2761   00AD4                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3039    2762   00AD4                  ;
    3040    2763   00AD4                  ;*******************************************************************************
    3041    2764   00AD4                  
    3042    2765   00AD4                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3043    2766   00AD4                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3044    2767   00AD4                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3045    2768   00AD4                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3046    2769   00AD4                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3047    2770   00AD4                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3048    2771   00AD4                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3049    2772   00AD4                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3050    2773   00AD4                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3051    2774   00AD4                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3052    2775   00AD4                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3053    2776   00AD4                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3054    2777   00AD4                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3055    2778   00AD4                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3056    2779   00AD4                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3057    2780   00AD4                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3058    2781   00AD4                  
    3059    2782   00AD4                  ;*******************************************************************************
    3060    2783   00AD4                  ;
    3061    2784   00AD4                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3062    2785   00AD4                  ;
    3063    2786   00AD4                  ;*******************************************************************************
    3064    2787   00AD4                  
    3065    2788   00AD4                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3066    2789   00AD4                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3067    2790   00AD4                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3068    2791   00AD4                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3069    2792   00AD4                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3070    2793   00AD4                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3071    2794   00AD4                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3072    2795   00AD4                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3073    2796   00AD4                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3074    2797   00AD4                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3075    2798   00AD4                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3076    2799   00AD4                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3077    2800   00AD4                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3078    2801   00AD4                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3079    2802   00AD4                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3080    2803   00AD4                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3081    2804   00AD4                  
    3082    2805   00AD4                  ;*******************************************************************************
    3083    2806   00AD4                  ;
    3084    2807   00AD4                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3085    2808   00AD4                  ;
    3086    2809   00AD4                  ;*******************************************************************************
    3087    2810   00AD4                  
    3088    2811   00AD4                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3089    2812   00AD4                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3090    2813   00AD4                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3091    2814   00AD4                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3092    2815   00AD4                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3093    2816   00AD4                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3094    2817   00AD4                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3095    2818   00AD4                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3096    2819   00AD4                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3097    2820   00AD4                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3098    2821   00AD4                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3099    2822   00AD4                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3100    2823   00AD4                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3101    2824   00AD4                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3102    2825   00AD4                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3103    2826   00AD4                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3104    2827   00AD4                  
    3105    2828   00AD4                  ;*******************************************************************************
    3106    2829   00AD4                  ;
    3107    2830   00AD4                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3108    2831   00AD4                  ;
    3109    2832   00AD4                  ;*******************************************************************************
    3110    2833   00AD4                  
    3111    2834   00AD4                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3112    2835   00AD4                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3113    2836   00AD4                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3114    2837   00AD4                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3115    2838   00AD4                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3116    2839   00AD4                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3117    2840   00AD4                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3118    2841   00AD4                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3119    2842   00AD4                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3120    2843   00AD4                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3121    2844   00AD4                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3122    2845   00AD4                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3123    2846   00AD4                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3124    2847   00AD4                  
    3125    2848   00AD4                  ;*******************************************************************************
    3126    2849   00AD4                  ;
    3127    2850   00AD4                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3128    2851   00AD4                  ;
    3129    2852   00AD4                  ;*******************************************************************************
    3130    2853   00AD4                  
    3131    2854   00AD4                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3132    2855   00AD4                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3133    2856   00AD4                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3134    2857   00AD4                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3135    2858   00AD4                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3136    2859   00AD4                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3137    2860   00AD4                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3138    2861   00AD4                  
    3139    2862   00AD4                  ;*******************************************************************************
    3140    2863   00AD4                  ;
    3141    2864   00AD4                  ; can registers can be accessed in the standard memory map (rmap=0)
    3142    2865   00AD4                  ;
    3143    2866   00AD4                  ;*******************************************************************************
    3144    2867   00AD4                  
    3145    2868   00AD4                  adcon         data   0d8h          ;adres/data control                reset=000h
    3146    2869   00AD4                  ; adcon is bit addressable
    3147    2870   00AD4                         v3     bit    0dfh
    3148    2871   00AD4                         v2     bit    0deh
    3149    2872   00AD4                         v1     bit    0ddh
    3150    2873   00AD4                         v0     bit    0dch
    3151    2874   00AD4                         auad1  bit    0dbh
    3152    2875   00AD4                         auad0  bit    0dah
    3153    2876   00AD4                         can_bsy bit   0d9h
    3154    2877   00AD4                         rwen   bit    0d8h
    3155    2878   00AD4                  
    3156    2879   00AD4                  adl           data   0d9h          ;adres register low                reset=000h
    3157    2880   00AD4                  adh           data   0dah          ;adres register low                reset=000h
    3158    2881   00AD4                  data0         data   0dbh          ;can data                          reset=000h
    3159    2882   00AD4                  data1         data   0dch          ;can data                          reset=000h
    3160    2883   00AD4                  data2         data   0ddh          ;can data                          reset=000h
    3161    2884   00AD4                  data3         data   0deh          ;can data                          reset=000h
    3162    2885   00AD4                  
    3163    2886   00AD4                  ;*******************************************************************************
    3164    2887   00AD4                  ;
    3165    2888   00AD4                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3166    2889   00AD4                  ;
    3167    2890   00AD4                  ;*******************************************************************************
    3168    2891   00AD4                  
    3169    2892   00AD4                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3170    2893   00AD4                  ;mdustat is bit addressable
    3171    2894   00AD4                                                     ;5 bits are not implemented
    3172    2895   00AD4                         bsy    bit    0b2h
    3173    2896   00AD4                         ierr   bit    0b1h
    3174    2897   00AD4                         irdy   bit    0b0h
    3175    2898   00AD4                  
    3176    2899   00AD4                  mducon        data   0b1h          ;mdu control                       reset=000h
    3177    2900   00AD4                  md0           data   0b2h          ;mdu operand register              reset=000h
    3178    2901   00AD4                  mr0           data   0b2h          ;mdu result register               reset=000h
    3179    2902   00AD4                  md1           data   0b3h          ;mdu operand register              reset=000h
    3180    2903   00AD4                  mr1           data   0b3h          ;mdu result register               reset=000h
    3181    2904   00AD4                  md2           data   0b4h          ;mdu operand register              reset=000h
    3182    2905   00AD4                  mr2           data   0b4h          ;mdu result register               reset=000h
    3183    2906   00AD4                  md3           data   0b5h          ;mdu operand register              reset=000h
    3184    2907   00AD4                  mr3           data   0b5h          ;mdu result register               reset=000h
    3185    2908   00AD4                  md4           data   0b6h          ;mdu operand register              reset=000h
    3186    2909   00AD4                  mr4           data   0b6h          ;mdu result register               reset=000h
    3187    2910   00AD4                  md5           data   0b7h          ;mdu operand register              reset=000h
    3188    2911   00AD4                  mr5           data   0b7h          ;mdu result register               reset=000h
    3189    2912   00AD4                  
    3190    2913   00AD4                  ;*******************************************************************************
    3191    2914   00AD4                  ;
    3192    2915   00AD4                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3193    2916   00AD4                  ;
    3194    2917   00AD4                  ;*******************************************************************************
    3195    2918   00AD4                  
    3196    2919   00AD4                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3197    2920   00AD4                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3198    2921   00AD4                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3199    2922   00AD4                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3200    2923   00AD4                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3201    2924   00AD4                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3202    2925   00AD4                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3203    2926   00AD4                  ;cd_statc is bit addressable
    3204    2927   00AD4                         keepz  bit    0a7h
    3205    2928   00AD4                         keepy  bit    0a6h
    3206    2929   00AD4                         keepx  bit    0a5h
    3207    2930   00AD4                         dmap   bit    0a4h
    3208    2931   00AD4                         int_en bit    0a3h
    3209    2932   00AD4                         eoc    bit    0a2h
    3210    2933   00AD4                         error  bit    0a1h
    3211    2934   00AD4                         cd_bsy bit    0a0h
    3212    2935   00AD4                  
    3213    2936   00AD4                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3214    2937   00AD4                  
    3215    2938   00AD4                  ;*******************************************************************************
    3216    2939   00AD4                  ;
    3217    2940   00AD4                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3218    2941   00AD4                  ;
    3219    2942   00AD4                  ;*******************************************************************************
    3220    2943   00AD4                  
    3221    2944   00AD4                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3222    2945   00AD4                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3223    2946   00AD4                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3224    2947   00AD4                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3225    2948   00AD4                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3226    2949   00AD4                  
    3227    2950   00AD4                  ;*******************************************************************************
    3228    2951   00AD4                  ;
    3229    2952   00AD4                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3230    2953   00AD4                  ;
    3231    2954   00AD4                  ;*******************************************************************************
    3232    2955   00AD4                  
    3233    2956   00AD4                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3234    2957   00AD4                  ;t2_t2con is bit addressable bits are aalready defined
    3235    2958   00AD4                         ;tf2    bit    0c7h
    3236    2959   00AD4                         ;exf2   bit    0c6h
    3237    2960   00AD4                                                     ;2 bits are not implemented
    3238    2961   00AD4                         ;exen2  bit    0c3h
    3239    2962   00AD4                         ;tr2    bit    0c2h
    3240    2963   00AD4                         ;ct2    bit    0c1h
    3241    2964   00AD4                         ;cprl2  bit    0c0h
    3242    2965   00AD4                  
    3243    2966   00AD4                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3244    2967   00AD4                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3245    2968   00AD4                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3246    2969   00AD4                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3247    2970   00AD4                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3248    2971   00AD4                  
    3249    2972   00AD4                  ;*******************************************************************************
    3250    2973   00AD4                  ;
    3251    2974   00AD4                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3252    2975   00AD4                  ;
    3253    2976   00AD4                  ;*******************************************************************************
    3254    2977   00AD4                  
    3255    2978   00AD4                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3256    2979   00AD4                  ;s1con is bit addressable
    3257    2980   00AD4                         sm01   bit    0cfh
    3258    2981   00AD4                         sm11   bit    0ceh
    3259    2982   00AD4                         sm21   bit    0cdh
    3260    2983   00AD4                         ren1   bit    0cch
    3261    2984   00AD4                         tb81   bit    0cbh
    3262    2985   00AD4                         rb81   bit    0cah
    3263    2986   00AD4                         ti1    bit    0c9h
    3264    2987   00AD4                         ri1    bit    0c8h
    3265    2988   00AD4                  
    3266    2989   00AD4                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3267    2990   00AD4                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3268    2991   00AD4                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3269    2992   00AD4                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3270    2993   00AD4                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3271    2994   00AD4                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3272    2995   00AD4                  
    3273    2996   00AD4                  ;*******************************************************************************
    3274    2997   00AD4                  ;
    3275    2998   00AD4                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3276    2999   00AD4                  ;
    3277    3000   00AD4                  ;*******************************************************************************
    3278    3001   00AD4                  
    3279    3002   00AD4                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3280    3003   00AD4                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3281    3004   00AD4                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3282    3005   00AD4                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3283    3006   00AD4                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3284    3007   00AD4                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3285    3008   00AD4                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3286    3009   00AD4                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3287    3010   00AD4                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3288    3011   00AD4                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3289    3012   00AD4                  
    3290    3013   00AD4                  ;end directive must be used, but has no signification
    3291    3014   00AD4                  
    3292    3015   00AD4                  end
    3293    3016   00AD4                  
    3294    3017   00AD4                  
    3295    3018   00AD4                  
    3296    3019   00AD4                  
    3297    3020   00AD4                  
    3298    3021   00AD4                  
    3299    3022   00AD4                  
    3300    3023   00AD4                  
    3301    3024   00AD4                  
    3302    3025   00AD4                  
    3303    3026   00AD4                  
    3304    3027   00AD4                  
    3305    3028   00AD4                  
    3306    3029   00AD4                  
    3307    3030   00AD4                  
    3308    3031   00AD4                  
