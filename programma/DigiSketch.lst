C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  org 0000h
       2       2   00000                  
       3       3   00000                  
       4       4   00000                  
       5       5   00000                  ;------------------------------------------------------------------
       6       6   00000                  ;Hoofd programma
       7       7   00000                  ;------------------------------------------------------------------
       8       8   00000                  main:
       9       9   00000 75817F               mov     sp,#7fh                 ;stackpointer instellen
      10      10   00003 120009               lcall   inits
      11      11   00006                  
      12      12   00006                  
      13      13   00006                  lus2:
      14      14   00006                  
      15      15   00006 020006               ljmp    lus2
      16      16   00009                  
      17      17   00009                  
      18      18   00009                  
      19      19   00009                  ;------------------------------------------------------------------
      20      20   00009                  ;Initializatie van alle componenten nodig in het hoofd programma
      21      21   00009                  ;------------------------------------------------------------------
      22      22   00009                  inits:
      23      23   00009 120037               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      24      24   0000C 22               ret
      25      25   0000D                  
      26      26   0000D                  
      27      27   0000D                  
      28      28   0000D                  
      29      29   0000D                  
project.inc 
      31       1   0000D                  ;------------------------------------------------------------------
      32       2   0000D                  ;Lijst van functies:
      33       3   0000D                  ;   -statusCheck            Status check van scherm opslaan in STA register
      34       4   0000D                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      35       5   0000D                  ;   -P1out                  Initializatie poort 1 als output
      36       6   0000D                  ;   -P3in                   Initializatie poort 3 als output
      37       7   0000D                  ;   -P3out                  Initializatie poort 3 als input
      38       8   0000D                  ;   -zendData               Data verzeden naar scherm
      39       9   0000D                  ;   -zenComando             Comando verzeden naar scherm
      40      10   0000D                  ;   -debug                  debug info op seriele poot zetten
      41      11   0000D                  ;------------------------------------------------------------------
      42      12   0000D                  ;------------------------------------------------------------------
      43      13   0000D                  ;declaratie van pinnen
      44      14   0000D                  ;------------------------------------------------------------------
      45      15   0000D                      WR          bit     p3_data.0   ;write line van scherm actief laag
      46      16   0000D                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      47      17   0000D                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      48      18   0000D                      CD          bit     p3_data.3   ;Command write
      49      19   0000D                      RESET       bit     p1_data.1   ;reset van scherm actief laag
      50      20   0000D                      FS          bit     p1_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      51      21   0000D                  
      52      22   0000D                  
      53      23   0000D                  
      54      24   0000D                  ;------------------------------------------------------------------
      55      25   0000D                  ;declaratie van registers
      56      26   0000D                  ;------------------------------------------------------------------
      57      27   0000D                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      58      28   0000D                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      59      29   0000D                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      60      30   0000D                  
      61      31   0000D                  
      62      32   0000D                  ;------------------------------------------------------------------
      63      33   0000D                  ;Status check van scherm opslaan in STA register
      64      34   0000D                  ;-STA
      65      35   0000D                  ;------------------------------------------------------------------
      66      36   0000D                  statusCheck:
      67      37   0000D C0E0                 push    acc
      68      38   0000F C0D0                 push    psw
      69      39   00011 1200DF               lcall   P5in                        ;poort 4 als input schakelen
      70      40   00014 1200BB               lcall   P3out
      71      41   00017                  STAOPNIEUW:
      72      42   00017 75B000               mov     p3_data,#00h
      73      43   0001A 751000               mov     STA,#00h                    ;STA register leeg maken
      74      44   0001D 75B00E               mov     p3_data,#00001110b
      75      45   00020 1202DA               lcall   delay1ms
      76      46   00023 E592                 mov     a,p5_data                   ;status word inlezen
      77      47   00025 5403                 anl     a,#00000011b                ;masker voor STA0 en STA1
      78      48   00027                  ;    mov     r0,a                        ;debug status op aurt zetten
      79      49   00027                  ;    lcall   debug
      80      50   00027 B403ED               cjne    a,#00000011b,STAOPNIEUW      ;vergelijken
      81      51   0002A F510                 mov     STA,a                       ;data opslaan in STA voor eventuel gebruik later
      82      52   0002C F8                   mov     r0,a                        ;debug status op aurt zetten
      83      53   0002D 12012F               lcall   debug
      84      54   00030 C2B2                 clr     CE
      85      55   00032 D0D0                 pop     psw
      86      56   00034 D0E0                 pop     acc
      87      57   00036 22               ret
      88      58   00037                  
      89      59   00037                  ;------------------------------------------------------------------
      90      60   00037                  ;Initializatie van grafisch LCD scherm
      91      61   00037                  ;-Poort 1
      92      62   00037                  ;------------------------------------------------------------------
      93      63   00037                  initGLCD:
      94      64   00037 1200A0               lcall   P1out                   ;poort 1 initializeren
      95      65   0003A C291                 clr     RESET                   ;reseten van scherm
      96      66   0003C 7420                 mov     a,#20h                   ;reset lang genenoeg laten duren
      97      67   0003E 1202C1               lcall   delaya0k05s
      98      68   00041 D290                 setb    FS                      ;font op 6*8 zetten
      99      69   00043 D291                 setb    RESET                   ;reset terug af zetten
     100      70   00045                  
     101      71   00045                  
     102      72   00045 1204FA               lcall   initsio                 ;voor debug
     103      73   00048                  
     104      74   00048 12000D               lcall   statusCheck             ;initiele status check uitvoeren
     105      75   0004B                  
     106      76   0004B 751100               mov     DATAREG,#00h            ;grafisch home adres
     107      77   0004E 1200F1               lcall   zendData
     108      78   00051 751100               mov     DATAREG,#00h
     109      79   00054 1200F1               lcall   zendData
     110      80   00057 751242               mov     COMANDREG,#42h
     111      81   0005A 120110               lcall   zendComando
     112      82   0005D                  
     113      83   0005D 75111E               mov     DATAREG,#1eh            ;Grafic aeria set
     114      84   00060 1200F1               lcall   zendData
     115      85   00063 751100               mov     DATAREG,#00h
     116      86   00066 1200F1               lcall   zendData
     117      87   00069 751243               mov     COMANDREG,#43h
     118      88   0006C 120110               lcall   zendComando
     119      89   0006F                  
     120      90   0006F                  
     121      91   0006F 751100               mov     DATAREG,#00h            ;text home aderes
     122      92   00072 1200F1               lcall   zendData
     123      93   00075 751100               mov     DATAREG,#00h
     124      94   00078 1200F1               lcall   zendData
     125      95   0007B 751240               mov     COMANDREG,#40h
     126      96   0007E 120110               lcall   zendComando
     127      97   00081                  
     128      98   00081 75111E               mov     DATAREG,#1eh            ;aantal colommen text
     129      99   00084 1200F1               lcall   zendData
     130     100   00087 751100               mov     DATAREG,#00h
     131     101   0008A 1200F1               lcall   zendData
     132     102   0008D 751241               mov     COMANDREG,#41h
     133     103   00090 120110               lcall   zendComando
     134     104   00093                  
     135     105   00093 751280               mov     COMANDREG,#80h
     136     106   00096 120110               lcall   zendComando
     137     107   00099                  
     138     108   00099 75129E               mov     COMANDREG,#9Eh
     139     109   0009C 120110               lcall   zendComando
     140     110   0009F 22               ret
     141     111   000A0                  
     142     112   000A0                  
     143     113   000A0                  ;------------------------------------------------------------------
     144     114   000A0                  ;Initializatie poort 1 als output
     145     115   000A0                  ;-poort 1
     146     116   000A0                  ;------------------------------------------------------------------
     147     117   000A0                  P1out:
     148     118   000A0 C08F                 push    syscon0                 ;juiste map selecteren
     149     119   000A2 758F04               mov     syscon0,#004h
     150     120   000A5 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     151     121   000A7 75B201               mov     port_page,#001h         ;selecteer poort page 0
     152     122   000AA 7590FF               mov     p1_pudsel,#0ffh         ;selecteer pull_up device
     153     123   000AD 7591FF               mov     p1_puden,#0ffh          ;selectie inschakelen
     154     124   000B0 75B200               mov     port_page,#000h         ;selecteer poort page 0
     155     125   000B3 7591FF               mov     p1_dir,#0ffh            ;poort 1 als output schakelen
     156     126   000B6 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     157     127   000B8 D08F                 pop     syscon0                 ;pagina terug herstellen
     158     128   000BA 22               ret
     159     129   000BB                  
     160     130   000BB                  ;------------------------------------------------------------------
     161     131   000BB                  ;Initializatie poort 3 als output
     162     132   000BB                  ;-poort 3
     163     133   000BB                  ;------------------------------------------------------------------
     164     134   000BB                  P3out:
     165     135   000BB C08F                 push    syscon0                 ;juiste map selecteren
     166     136   000BD 758F04               mov     syscon0,#004h
     167     137   000C0 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     168     138   000C2 75B200               mov     port_page,#000h         ;selecteer poort page 0
     169     139   000C5 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output schakelen
     170     140   000C8 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     171     141   000CA D08F                 pop     syscon0                 ;pagina terug herstellen
     172     142   000CC 22               ret
     173     143   000CD                  
     174     144   000CD                  ;------------------------------------------------------------------
     175     145   000CD                  ;Initializatie poort 5 als output
     176     146   000CD                  ;-poort 5
     177     147   000CD                  ;------------------------------------------------------------------
     178     148   000CD                  P5out:
     179     149   000CD C08F                 push    syscon0                 ;juiste map selecteren
     180     150   000CF 758F04               mov     syscon0,#004h
     181     151   000D2 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     182     152   000D4 75B200               mov     port_page,#000h         ;selecteer poort page 0
     183     153   000D7 7593FF               mov     p5_dir,#0ffh            ;poort 5 als output schakelen
     184     154   000DA D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     185     155   000DC D08F                 pop     syscon0                 ;pagina terug herstellen
     186     156   000DE 22               ret
     187     157   000DF                  
     188     158   000DF                  ;------------------------------------------------------------------
     189     159   000DF                  ;Initializatie poort 4 als input
     190     160   000DF                  ;-poort 4
     191     161   000DF                  ;------------------------------------------------------------------
     192     162   000DF                  P5in:
     193     163   000DF C08F                 push    syscon0                 ;juiste map selecteren
     194     164   000E1 758F04               mov     syscon0,#004h
     195     165   000E4 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     196     166   000E6 75B200               mov     port_page,#000h         ;selecteer poort page 0
     197     167   000E9 759300               mov     p5_dir,#000h            ;poort 5 als input schakelen
     198     168   000EC D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     199     169   000EE D08F                 pop     syscon0                 ;pagina terug herstellen
     200     170   000F0 22               ret
     201     171   000F1                  ;------------------------------------------------------------------
     202     172   000F1                  ;Data verzeden naar scherm
     203     173   000F1                  ;-DATAREG
     204     174   000F1                  ;------------------------------------------------------------------
     205     175   000F1                  zendData:
     206     176   000F1 C0E0                 push    acc
     207     177   000F3 C0D0                 push    psw
     208     178   000F5 12000D               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     209     179   000F8 1200CD               lcall   P5out                   ;poort 5 als output schakelen
     210     180   000FB 851192               mov     p5_data,DATAREG               ;data op de poort zetten
     211     181   000FE 75B009               mov     p3_data,#00001001b
     212     182   00101 1202DA               lcall   delay1ms
     213     183   00104 C2B2                 clr     CE
     214     184   00106 A811                 mov     r0,DATAREG
     215     185   00108 12012F               lcall   debug
     216     186   0010B D0D0                 pop     psw
     217     187   0010D D0E0                 pop     acc
     218     188   0010F 22               ret
     219     189   00110                  
     220     190   00110                  ;------------------------------------------------------------------
     221     191   00110                  ;Comando verzeden naar scherm
     222     192   00110                  ;-COMANDREG
     223     193   00110                  ;------------------------------------------------------------------
     224     194   00110                  zendComando:
     225     195   00110 C0E0                 push    acc
     226     196   00112 C0D0                 push    psw
     227     197   00114 12000D               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     228     198   00117 1200CD               lcall   P5out                   ;poort 5 als output schakelen
     229     199   0011A 851292               mov     p5_data,COMANDREG       ;data op de poort zetten
     230     200   0011D 75B00E               mov     p3_data,#00001110b
     231     201   00120 1202DA               lcall   delay1ms
     232     202   00123 C2B2                 clr     CE
     233     203   00125 A812                 mov     r0,COMANDREG
     234     204   00127 12012F               lcall   debug
     235     205   0012A D0D0                 pop     psw
     236     206   0012C D0E0                 pop     acc
     237     207   0012E 22               ret
     238     208   0012F                  
     239     209   0012F                  ;------------------------------------------------------------------
     240     210   0012F                  ;debug info op seriele poort zetten
     241     211   0012F                  ;-r0
     242     212   0012F                  ;------------------------------------------------------------------
     243     213   0012F                  debug:
     244     214   0012F C0E0                 push    acc
     245     215   00131 C0D0                 push    psw
     246     216   00133 740D                 mov     a,#0dh
     247     217   00135 120532               lcall   siooutchar
     248     218   00138 E8                   mov     a,r0
     249     219   00139 12054E               lcall   siooutbyte
     250     220   0013C 740A                 mov     a,#0ah
     251     221   0013E 120532               lcall   siooutchar
     252     222   00141 D0D0                 pop     psw
     253     223   00143 D0E0                 pop     acc
     254     224   00145 22               ret
     255     225   00146                  
     256     226   00146                  
     257     227   00146                  
     258     228   00146                  
     259     229   00146                  
     260     230   00146                  
     261     231   00146                  
     262     232   00146                  
     263     233   00146                  
     264     234   00146                  
     265     235   00146                  
     266     236   00146                  
     267     237   00146                  
     268     238   00146                  
     269     239   00146                  
     270     240   00146                  
     271     241   00146                  
     272     242   00146                  
     273     243   00146                  
     274     244   00146                  
xcez1.inc 
     276       1   00146                  ;*******************************************************************************
     277       2   00146                  ;
     278       3   00146                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     279       4   00146                  ;
     280       5   00146                  ; The file contains drivers for various hardware and math applications.
     281       6   00146                  ; In addition all register declarations are added.
     282       7   00146                  ;
     283       8   00146                  ; WARNING:!!!!!!!
     284       9   00146                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     285      10   00146                  ;
     286      11   00146                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     287      12   00146                  ;
     288      13   00146                  ;*******************************************************************************
     289      14   00146                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     290      15   00146                  ;
     291      16   00146                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     292      17   00146                  ;
     293      18   00146                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     294      19   00146                  ; eenvoudige manier te gebruiken:
     295      20   00146                  ;
     296      21   00146                  ; standaard I/O:
     297      22   00146                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     298      23   00146                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     299      24   00146                  ;      initleds             klaar zetten LED's als outputs
     300      25   00146                  ;
     301      26   00146                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     302      27   00146                  ;      initiic              klaar zetten iic interface
     303      28   00146                  ;      iicstart             genereren van een startconditie op iic poort
     304      29   00146                  ;      iicstop              genereren stop conditie op iic poort
     305      30   00146                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     306      31   00146                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     307      32   00146                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     308      33   00146                  ;
     309      34   00146                  ; LCD interace
     310      35   00146                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     311      36   00146                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     312      37   00146                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     313      38   00146                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     314      39   00146                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     315      40   00146                  ;      lcdlighton           backlight aan
     316      41   00146                  ;      lcdlightoff          backlight uit
     317      42   00146                  ;      lcdbuzon             buzzer aan
     318      43   00146                  ;      lcdbuzof             buzzer uit
     319      44   00146                  ;
     320      45   00146                  ; Seriële interface (via USB stekker!!)
     321      46   00146                  ;      initsio              klaar zetten seriële poort 9600 baud
     322      47   00146                  ;      siooutchar           afdrukken ascii code (accu=input)
     323      48   00146                  ;      siooutbyte           afdrkken getal in accu
     324      49   00146                  ;      siooutnib            afdrukken 4 laagste bits accu
     325      50   00146                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     326      51   00146                  ;      sioinchar            inlezen van 1 ascii code in de accu
     327      52   00146                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     328      53   00146                  ;
     329      54   00146                  ; ADC
     330      55   00146                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     331      56   00146                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     332      57   00146                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     333      58   00146                  ;
     334      59   00146                  ; Arithmetic:
     335      60   00146                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     336      61   00146                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     337      62   00146                  ;      div16                delen 2 16 bit getallen
     338      63   00146                  ;      div32                delen 2 32 bit getallen
     339      64   00146                  ;      add16                optellen 2 16 bit getallen
     340      65   00146                  ;      add32                optellen 2 32 bit getallen
     341      66   00146                  ;      sub16                verschil 2 16 bit getallen
     342      67   00146                  ;      sub32                verschil 2 32 bit getallen
     343      68   00146                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     344      69   00146                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     345      70   00146                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     346      71   00146                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     347      72   00146                  ;
     348      73   00146                  ; Diverse
     349      74   00146                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     350      75   00146                  ;      delay1ms             tijdsverraging 1 milliseconde
     351      76   00146                  ;      delay10us            tijdsvertraging 10 microseconde
     352      77   00146                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     353      78   00146                  ;	mapregs 		selecteer de SFR's in de mapped area
     354      79   00146                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     355      80   00146                  ;
     356      81   00146                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     357      82   00146                  ; LET OP!!!!
     358      83   00146                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     359      84   00146                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     360      85   00146                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     361      86   00146                  ;
     362      87   00146                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     363      88   00146                  ;
     364      89   00146                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     365      90   00146                  
     366      91   00146                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     367      92   00146                  ;
     368      93   00146                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     369      94   00146                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     370      95   00146                  ; massa zonder extra weerstanden.
     371      96   00146                  ;
     372      97   00146                  ; Gebruikt geen registers
     373      98   00146                  ;
     374      99   00146                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     375     100   00146                  
     376     101   00146 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     377     102   00148 758F04                         mov    syscon0,#004h
     378     103   0014B C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     379     104   0014D 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     380     105   00150 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     381     106   00153 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     382     107   00156 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     383     108   00159 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     384     109   0015C D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     385     110   0015E D08F                           pop    syscon0              ;pagina terug herstellen
     386     111   00160 22                             ret
     387     112   00161                  
     388     113   00161                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     389     114   00161                  ;
     390     115   00161                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     391     116   00161                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     392     117   00161                  ; 2 behouden hun originele instelling.
     393     118   00161                  ;
     394     119   00161                  ; Gebruikt geen registers
     395     120   00161                  ;
     396     121   00161                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     397     122   00161                  
     398     123   00161 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     399     124   00163 758F04                         mov    syscon0,#004h
     400     125   00166 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     401     126   00168 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     402     127   0016B 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     403     128   0016E 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     404     129   00171 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     405     130   00174 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     406     131   00177 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     407     132   00179 D08F                           pop    syscon0              ;pagina terug herstellen
     408     133   0017B 22                             ret
     409     134   0017C                  
     410     135   0017C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     411     136   0017C                  ;
     412     137   0017C                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     413     138   0017C                  ; worden gedoofd (actief laag om ze te laden branden).
     414     139   0017C                  ;
     415     140   0017C                  ; Gebruikt geen registers
     416     141   0017C                  ;
     417     142   0017C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     418     143   0017C                  
     419     144   0017C                  
     420     145   0017C C08F             initleds:     push   syscon0              ;juiste map selecteren
     421     146   0017E 758F04                         mov    syscon0,#004h
     422     147   00181 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     423     148   00183 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     424     149   00186 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     425     150   00189 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     426     151   0018B D08F                           pop    syscon0              ;pagina terug herstellen
     427     152   0018D 22                             ret
     428     153   0018E                  
     429     154   0018E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     430     155   0018E                  ;
     431     156   0018E                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     432     157   0018E                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     433     158   0018E                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     434     159   0018E                  ; sda wordt als input geschakeld
     435     160   0018E                  ;
     436     161   0018E                  ; LET OP!!
     437     162   0018E                  ; Dit is een IIC bus met beperkte mogelijkheden:
     438     163   0018E                  ; -vaste communicatiesnleheid van 100kbit/s
     439     164   0018E                  ; -enkel master mode
     440     165   0018E                  ; -enkel 7 bit adressering
     441     166   0018E                  ; -geen klok stretching
     442     167   0018E                  ;
     443     168   0018E                  ; Gebruikt geen registers
     444     169   0018E                  ;
     445     170   0018E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     446     171   0018E                  
     447     172   0018E                  sda           bit    p0_data.7            ;pin gebruikt als sda
     448     173   0018E                  scl           bit    p0_data.3            ;pin gebruikt als scl
     449     174   0018E                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     450     175   0018E                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     451     176   0018E                  
     452     177   0018E C08F             initiic:      push   syscon0              ;juiste map selecteren
     453     178   00190 758F04                         mov    syscon0,#004h
     454     179   00193 C0B2                           push   port_page
     455     180   00195 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     456     181   00198 D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     457     182   0019A D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     458     183   0019C 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     459     184   0019F D283                           setb   scl                  ;klok werkt als od
     460     185   001A1 D287                           setb   sda                  ;sda werkt als od
     461     186   001A3 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     462     187   001A6 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     463     188   001A9 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     464     189   001AC D0B2                           pop    port_page            ;pagina herstellen
     465     190   001AE D08F                           pop    syscon0              ;map herstellen
     466     191   001B0 22                             ret
     467     192   001B1                  
     468     193   001B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     469     194   001B1                  ;
     470     195   001B1                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     471     196   001B1                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     472     197   001B1                  ; te garanderen volgt er een delay van 10us
     473     198   001B1                  ;
     474     199   001B1                  ; Gebruikt geen registers
     475     200   001B1                  ;
     476     201   001B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     477     202   001B1                  
     478     203   001B1 C08F             iicstart:     push   syscon0              ;map bewaren
     479     204   001B3 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     480     205   001B6 C0B2                           push   port_page            ;pagina bewaren
     481     206   001B8 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     482     207   001BB D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     483     208   001BD D287                           setb   sda                  ;idem
     484     209   001BF 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     485     210   001C2 1202B2                         lcall  delay10us            ;
     486     211   001C5 C287                           clr    sda                  ;data laag
     487     212   001C7 1202B2                         lcall  delay10us
     488     213   001CA C283                           clr    scl                  ;dan klok laag
     489     214   001CC 1202B2                         lcall  delay10us            ;bit lang genoeg maken
     490     215   001CF D0B2                           pop    port_page            ;registers herstellen
     491     216   001D1 D08F                           pop    syscon0
     492     217   001D3 22                             ret
     493     218   001D4                  
     494     219   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     495     220   001D4                  ;
     496     221   001D4                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     497     222   001D4                  ;
     498     223   001D4                  ; Gebruikt geen registers
     499     224   001D4                  ;
     500     225   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     501     226   001D4                  
     502     227   001D4 C08F             iicstop:      push   syscon0              ;map bewaren
     503     228   001D6 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     504     229   001D9 C0B2                           push   port_page            ;pagina bewaren
     505     230   001DB 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     506     231   001DE 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     507     232   001E1 C287                           clr    sda                  ;data naar omlaag
     508     233   001E3 1202B2                         lcall  delay10us
     509     234   001E6 D283                           setb   scl                  ;klok naar 1
     510     235   001E8 1202B2                         lcall  delay10us            ;wachten
     511     236   001EB D287                           setb   sda                  ;idem data
     512     237   001ED 1202B2                         lcall  delay10us            ;
     513     238   001F0 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     514     239   001F3 D0B2                           pop    port_page            ;registers herstellen
     515     240   001F5 D08F                           pop    syscon0
     516     241   001F7 22                             ret
     517     242   001F8                  
     518     243   001F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     519     244   001F8                  ;
     520     245   001F8                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     521     246   001F8                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     522     247   001F8                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     523     248   001F8                  ;
     524     249   001F8                  ; Gebruikt:
     525     250   001F8                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     526     251   001F8                  ;      cy=ack bit vanuit de slave
     527     252   001F8                  ;
     528     253   001F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     529     254   001F8                  
     530     255   001F8 C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     531     256   001FA C0F0                           push   b                    ;gebruikt als loopcounter
     532     257   001FC C08F                           push   syscon0              ;map juist zetten
     533     258   001FE 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     534     259   00201 C0B2                           push   port_page            ;poort pagina bewaren
     535     260   00203 75B200                         mov    port_page,#000h      ;basispagina selecteren
     536     261   00206 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     537     262   00209 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     538     263   0020C 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     539     264   0020D 9287                           mov    sda,c                ;op pin
     540     265   0020F 1202B2                         lcall  delay10us            ;wachten
     541     266   00212 D283                           setb   scl                  ;puls genereren
     542     267   00214 1202B2                         lcall  delay10us            ;ook hier wat tijd laten
     543     268   00217 C283                           clr    scl                  ;klok terug laag maken
     544     269   00219 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     545     270   0021C                  
     546     271   0021C                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     547     272   0021C                  
     548     273   0021C 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     549     274   0021F 1202B2                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     550     275   00222 D283                           setb   scl                  ;puls terug hoog
     551     276   00224 A287                           mov    c,sda                ;inlezen en naar carry
     552     277   00226 1202B2                         lcall  delay10us
     553     278   00229 C283                           clr    scl                  ;klok blijft laag achter
     554     279   0022B D0B2                           pop    port_page
     555     280   0022D D08F                           pop    syscon0
     556     281   0022F D0F0                           pop    b
     557     282   00231 D0E0                           pop    acc
     558     283   00233 22                             ret
     559     284   00234                  
     560     285   00234                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     561     286   00234                  ;
     562     287   00234                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     563     288   00234                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     564     289   00234                  ;
     565     290   00234                  ; Gebruikt:
     566     291   00234                  ;      -de accu als output
     567     292   00234                  ;
     568     293   00234                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     569     294   00234                  
     570     295   00234 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     571     296   00236 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     572     297   00239 C0B2                           push   port_page            ;pagina bewaren
     573     298   0023B 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     574     299   0023E C0F0                           push   b                    ;wordt gebruikt als loopcounter
     575     300   00240 C0D0                           push   psw                  ;vlaggen bewaren
     576     301   00242 75F008                         mov    b,#008h              ;loopcounter laden
     577     302   00245 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     578     303   00248 1202B2           iicinbyteack1:lcall  delay10us
     579     304   0024B D283                           setb   scl                  ;klok hoog
     580     305   0024D A287                           mov    c,sda                ;pin inlezen
     581     306   0024F 33                             rlc    a                    ;in accu shiften
     582     307   00250 1202B2                         lcall  delay10us
     583     308   00253 C283                           clr    scl                  ;klok terug laag
     584     309   00255 D5F0F0                         djnz   b,iicinbyteack1
     585     310   00258 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     586     311   0025B C287                           clr    sda                  ;ack genereren
     587     312   0025D 1202B2                         lcall  delay10us
     588     313   00260 D283                           setb   scl
     589     314   00262 1202B2                         lcall  delay10us
     590     315   00265 C283                           clr    scl
     591     316   00267 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     592     317   0026A D0D0                           pop    psw                  ;registers herstellen
     593     318   0026C D0F0                           pop    b
     594     319   0026E D0B2                           pop    port_page
     595     320   00270 D08F                           pop    syscon0
     596     321   00272 22                             ret
     597     322   00273                  
     598     323   00273                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     599     324   00273                  ;
     600     325   00273                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     601     326   00273                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     602     327   00273                  ;
     603     328   00273                  ; Gebruikt:
     604     329   00273                  ;      -de accu als output
     605     330   00273                  ;
     606     331   00273                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     607     332   00273                  
     608     333   00273 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     609     334   00275 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     610     335   00278 C0B2                           push   port_page            ;pagina bewaren
     611     336   0027A 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     612     337   0027D C0F0                           push   b                    ;wordt gebruikt als loopcounter
     613     338   0027F C0D0                           push   psw                  ;vlaggen bewaren
     614     339   00281 75F008                         mov    b,#008h              ;loopcounter laden
     615     340   00284 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     616     341   00287 1202B2           iicinbytenack1:lcall  delay10us
     617     342   0028A D283                           setb   scl                  ;klok hoog
     618     343   0028C A287                           mov    c,sda                ;pin inlezen
     619     344   0028E 33                             rlc    a                    ;in accu shiften
     620     345   0028F 1202B2                         lcall  delay10us
     621     346   00292 C283                           clr    scl                  ;klok terug laag
     622     347   00294 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     623     348   00297 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     624     349   0029A D287                           setb   sda                  ;nack genereren
     625     350   0029C 1202B2                         lcall  delay10us
     626     351   0029F D283                           setb   scl
     627     352   002A1 1202B2                         lcall  delay10us
     628     353   002A4 C283                           clr    scl
     629     354   002A6 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     630     355   002A9 D0D0                           pop    psw                  ;registers herstellen
     631     356   002AB D0F0                           pop    b
     632     357   002AD D0B2                           pop    port_page
     633     358   002AF D08F                           pop    syscon0
     634     359   002B1 22                             ret
     635     360   002B2                  
     636     361   002B2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     637     362   002B2                  ;
     638     363   002B2                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     639     364   002B2                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     640     365   002B2                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     641     366   002B2                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     642     367   002B2                  ;
     643     368   002B2                  ; Gebruikt geen registers
     644     369   002B2                  ;
     645     370   002B2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     646     371   002B2                  
     647     372   002B2 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     648     373   002B4 C0D0                           push   psw                  ;8*42ns=330ns
     649     374   002B6 75E01A                         mov    acc,#01ah            ;420ns
     650     375   002B9 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     651     376   002BC D0D0                           pop    psw                  ;8*42ns=330ns
     652     377   002BE D0E0                           pop    acc                  ;8*42ns=330ns
     653     378   002C0 22                             ret                         ;165ns
     654     379   002C1                  
     655     380   002C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     656     381   002C1                  ;
     657     382   002C1                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     658     383   002C1                  ;
     659     384   002C1                  ; Gebruikt geen registers
     660     385   002C1                  ;
     661     386   002C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     662     387   002C1                  
     663     388   002C1 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     664     389   002C3 C0D0                           push   psw
     665     390   002C5 C0F0                           push   b
     666     391   002C7 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     667     392   002CA 1202DA           delaya0k05s1: lcall  delay1ms
     668     393   002CD D5F0FA                         djnz   b,delaya0k05s1
     669     394   002D0 D5E0F4                         djnz   acc,delaya0k05s2
     670     395   002D3 D0F0                           pop    b                    ;registers herstellen
     671     396   002D5 D0D0                           pop    psw
     672     397   002D7 D0E0                           pop    acc
     673     398   002D9 22                             ret
     674     399   002DA                  
     675     400   002DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     676     401   002DA                  ;
     677     402   002DA                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     678     403   002DA                  ;
     679     404   002DA                  ; Gebruikt geen registers
     680     405   002DA                  ;
     681     406   002DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     682     407   002DA                  
     683     408   002DA C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     684     409   002DC C0D0                           push   psw                  ;8*42ns=330ns
     685     410   002DE 75E064                         mov    acc,#100             ;420ns
     686     411   002E1 1202B2           delay1ms1:    lcall  delay10us            ;10us
     687     412   002E4 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     688     413   002E7 D0D0                           pop    psw                  ;8*42ns=330ns
     689     414   002E9 D0E0                           pop    acc                  ;8*42ns=330ns
     690     415   002EB 22                             ret                         ;165ns
     691     416   002EC                  
     692     417   002EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     693     418   002EC                  ;
     694     419   002EC                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     695     420   002EC                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     696     421   002EC                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     697     422   002EC                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     698     423   002EC                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     699     424   002EC                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     700     425   002EC                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     701     426   002EC                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     702     427   002EC                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     703     428   002EC                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     704     429   002EC                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     705     430   002EC                  ; systemen!!!!
     706     431   002EC                  ;
     707     432   002EC                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     708     433   002EC                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     709     434   002EC                  ;       aduclcd0.inc
     710     435   002EC                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     711     436   002EC                  ;       aduclcd1.inc
     712     437   002EC                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     713     438   002EC                  ;
     714     439   002EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     715     440   002EC                  
     716     441   002EC                  e             bit    b.1                  ;enable
     717     442   002EC                  rs            bit    b.0                  ;register select
     718     443   002EC                  backlight     bit    b.6                  ;bit waar backlight op zit
     719     444   002EC                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     720     445   002EC                  
     721     446   002EC                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     722     447   002EC                  
     723     448   002EC                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     724     449   002EC                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     725     450   002EC                  
     726     451   002EC                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     727     452   002EC                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     728     453   002EC                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     729     454   002EC                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     730     455   002EC                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     731     456   002EC                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     732     457   002EC                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     733     458   002EC                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     734     459   002EC                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     735     460   002EC                  
     736     461   002EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     737     462   002EC                  ;
     738     463   002EC                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     739     464   002EC                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     740     465   002EC                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     741     466   002EC                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     742     467   002EC                  ;
     743     468   002EC                  ; registergebruik: geen
     744     469   002EC                  ;
     745     470   002EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     746     471   002EC                  
     747     472   002EC C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     748     473   002EE C0D0                           push   psw
     749     474   002F0 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     750     475   002F2 12018E                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     751     476   002F5 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     752     477   002F8                                                            ;buzzer en baklight worden nu op 1 gezet
     753     478   002F8 120490                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     754     479   002FB 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     755     480   002FD 120489           initlcd1:     lcall  delay2ms
     756     481   00300 D5E0FA                         djnz   acc,initlcd1
     757     482   00303 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     758     483   00305 120448                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     759     484   00308 120489                         lcall  delay2ms      ;te krijgen.
     760     485   0030B 7430                           mov    a,#00110000b
     761     486   0030D 120448                         lcall  outhnibc
     762     487   00310 120489                         lcall  delay2ms
     763     488   00313 7430                           mov    a,#00110000b
     764     489   00315 120448                         lcall  outhnibc
     765     490   00318 120489                         lcall  delay2ms
     766     491   0031B 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     767     492   0031D 120448                         lcall  outhnibc      ;hoge nibble naar het controleregister
     768     493   00320 120489                         lcall  delay2ms      ;niet nodig volgens datasheet
     769     494   00323 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     770     495   00325 120432                         lcall  outc          ;naar display
     771     496   00328 120489                         lcall  delay2ms      ;is iets te lang volgens datasheet
     772     497   0032B 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     773     498   0032D 120432                         lcall  outc
     774     499   00330 120489                         lcall  delay2ms      ;ook deze delay is iets te lang
     775     500   00333 7401                           mov    a,#displayon  ;clear display and home cursor
     776     501   00335 120432                         lcall  outc
     777     502   00338 120489                         lcall  delay2ms      ;deze wachttijd is bijna juist
     778     503   0033B 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     779     504   0033D 120432                         lcall  outc
     780     505   00340 120489                         lcall  delay2ms      ;wachten weer veel te lang
     781     506   00343 D0F0                           pop    b             ;registers terug in orde zetten
     782     507   00345 D0D0                           pop    psw
     783     508   00347 D0E0                           pop    acc
     784     509   00349 22                             ret                  ;einde van de initialisatie
     785     510   0034A                  
     786     511   0034A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     787     512   0034A                  ;
     788     513   0034A                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     789     514   0034A                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     790     515   0034A                  ;      00dh   =cursor in de home positie
     791     516   0034A                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     792     517   0034A                  ;      00ah   =cursor op tweede lijn plaatsen
     793     518   0034A                  ;      001h   =cursor on blink
     794     519   0034A                  ;      002h   =cursor on, no blink
     795     520   0034A                  ;      003h   =cursor off
     796     521   0034A                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     797     522   0034A                  ;
     798     523   0034A                  ; de routine gebruikt geen registers
     799     524   0034A                  ;
     800     525   0034A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     801     526   0034A                  
     802     527   0034A                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     803     528   0034A                  ; dan mag de data direct naar het dataregister van het scherm.
     804     529   0034A                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     805     530   0034A                  
     806     531   0034A                  lcdoutchar:
     807     532   0034A C0E0             outcharlcd:   push   acc           ;registers op stack
     808     533   0034C C0D0                           push   psw
     809     534   0034E B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     810     535   00351 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     811     536   00353 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     812     537   00356 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     813     538   00358                  
     814     539   00358                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     815     540   00358                  ; Het is dus een opdracht die we moeten uitvoeren.
     816     541   00358                  
     817     542   00358 B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     818     543   0035B 7401                           mov    a,#cleardisp         ;scherm leegmaken
     819     544   0035D 120432                         lcall  outc                 ;naar controleregister
     820     545   00360 803A                           sjmp   outcharlcde          ;afsluiten
     821     546   00362                  
     822     547   00362 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     823     548   00365 740F                           mov    a,#cursoronb         ;cursoron met blink
     824     549   00367 120432                         lcall  outc
     825     550   0036A 8030                           sjmp   outcharlcde
     826     551   0036C                  
     827     552   0036C B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     828     553   0036F 740E                           mov    a,#cursoronn         ;cursoron no blink
     829     554   00371 120432                         lcall  outc
     830     555   00374 8026                           sjmp   outcharlcde
     831     556   00376                  
     832     557   00376 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     833     558   00379 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     834     559   0037B 120432                         lcall  outc
     835     560   0037E 801C                           sjmp   outcharlcde
     836     561   00380                  
     837     562   00380 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     838     563   00383 7402                           mov    a,#cursathom         ;cursor in home positie
     839     564   00385 120432                         lcall  outc
     840     565   00388 8012                           sjmp   outcharlcde
     841     566   0038A                  
     842     567   0038A B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     843     568   0038D                                                            ;tweede lijn
     844     569   0038D 74C0                           mov    a,#0c0h
     845     570   0038F 120432                         lcall  outc
     846     571   00392 8008                           sjmp   outcharlcde
     847     572   00394                  
     848     573   00394                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     849     574   00394                  ; is. dit mag naar het data register.
     850     575   00394                  
     851     576   00394 1203F8           outcharlcd8:  lcall  outd          ;klaar
     852     577   00397 8003                           sjmp   outcharlcde   ;einde routine
     853     578   00399                  
     854     579   00399                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     855     580   00399                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     856     581   00399                  ; te schrijven.
     857     582   00399                  
     858     583   00399 120432           outcharlcd9:  lcall  outc          ;klaar
     859     584   0039C D0D0             outcharlcde:  pop    psw           ;registers herstellen
     860     585   0039E D0E0                           pop    acc
     861     586   003A0 22                             ret
     862     587   003A1                  
     863     588   003A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     864     589   003A1                  ;
     865     590   003A1                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     866     591   003A1                  ; op het lcd scherm.
     867     592   003A1                  ;
     868     593   003A1                  ; de routine gebruikt geen registers
     869     594   003A1                  ;
     870     595   003A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     871     596   003A1                  
     872     597   003A1                  lcdoutnib:
     873     598   003A1 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     874     599   003A3 C0D0                           push   psw
     875     600   003A5 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     876     601   003A7 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     877     602   003A9 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     878     603   003AC 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     879     604   003AE 2407                           add    a,#007h       ;omvormen naar hoofdletter
     880     605   003B0 1203F8           outniblcde:   lcall  outd          ;naar het scherm
     881     606   003B3 D0D0                           pop    psw
     882     607   003B5 D0E0                           pop    acc
     883     608   003B7 22                             ret
     884     609   003B8                  
     885     610   003B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     886     611   003B8                  ;
     887     612   003B8                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     888     613   003B8                  ;
     889     614   003B8                  ; de routine gebruikt geen registers
     890     615   003B8                  ;
     891     616   003B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     892     617   003B8                  
     893     618   003B8                  lcdoutbyte:
     894     619   003B8 C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     895     620   003BA C0D0                           push   psw
     896     621   003BC C4                             swap   a             ;bitjes omruilen
     897     622   003BD 1203A1                         lcall  outniblcd
     898     623   003C0 C4                             swap   a             ;nog eens
     899     624   003C1 1203A1                         lcall  outniblcd
     900     625   003C4 D0D0                           pop    psw
     901     626   003C6 D0E0                           pop    acc
     902     627   003C8 22                             ret
     903     628   003C9                  
     904     629   003C9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     905     630   003C9                  ;
     906     631   003C9                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     907     632   003C9                  ;
     908     633   003C9                  ; de routine gebruikt geen registers
     909     634   003C9                  ;
     910     635   003C9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     911     636   003C9                  
     912     637   003C9                  lcddispdptr:
     913     638   003C9 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     914     639   003CB C0D0                           push   psw
     915     640   003CD E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     916     641   003CF 1203B8                         lcall  outbytelcd
     917     642   003D2 E582                           mov    a,dpl         ;dan het lage deel
     918     643   003D4 1203B8                         lcall  outbytelcd
     919     644   003D7 D0D0                           pop    psw
     920     645   003D9 D0E0                           pop    acc
     921     646   003DB 22                             ret
     922     647   003DC                  
     923     648   003DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     924     649   003DC                  ;
     925     650   003DC                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     926     651   003DC                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     927     652   003DC                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     928     653   003DC                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     929     654   003DC                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     930     655   003DC                  ;
     931     656   003DC                  ; de routine gebruikt geen registers
     932     657   003DC                  ;
     933     658   003DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     934     659   003DC                  
     935     660   003DC                  lcdoutmsga:
     936     661   003DC C0E0             outmsgalcd:   push   acc           ;registers op de stack
     937     662   003DE C0D0                           push   psw
     938     663   003E0 C083                           push   dph           ;ook de data pointer
     939     664   003E2 C082                           push   dpl
     940     665   003E4                  
     941     666   003E4                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     942     667   003E4                  
     943     668   003E4 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     944     669   003E5 93                             movc   a,@a+dptr     ;waarde lezen
     945     670   003E6 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     946     671   003E8                  
     947     672   003E8                  ; de code is niet 0 dus versturen met outchar
     948     673   003E8                  
     949     674   003E8 12034A                         lcall  outcharlcd    ;weg er mee
     950     675   003EB A3                             inc    dptr          ;naar volgende ascii code wijzen
     951     676   003EC 0203E4                         ljmp   outmsgalcd1   ;lus sluiten
     952     677   003EF                  
     953     678   003EF D082             outmsgalcde:  pop    dpl           ;registers herstellen
     954     679   003F1 D083                           pop    dph
     955     680   003F3 D0D0                           pop    psw
     956     681   003F5 D0E0                           pop    acc
     957     682   003F7 22                             ret
     958     683   003F8                  
     959     684   003F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     960     685   003F8                  ;
     961     686   003F8                  ; outd is een routine die naar het data register van het display een
     962     687   003F8                  ; volledige byte stuurt.
     963     688   003F8                  ;
     964     689   003F8                  ; De routine gebruikt geen registers.
     965     690   003F8                  ;
     966     691   003F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     967     692   003F8                  
     968     693   003F8 C0E0             outd:         push   acc           ;registers op stack zetten
     969     694   003FA C0D0                           push   psw
     970     695   003FC 120408                         lcall  outhnibd      ;hoogste vier bits verzenden
     971     696   003FF C4                             swap   a             ;bitjes omruilen
     972     697   00400 120408                         lcall  outhnibd      ;naar het scherm sturen
     973     698   00403 D0D0                           pop    psw           ;registers terug herstellen
     974     699   00405 D0E0                           pop    acc
     975     700   00407 22                             ret
     976     701   00408                  
     977     702   00408                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     978     703   00408                  ;
     979     704   00408                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
     980     705   00408                  ; lcd scherm.
     981     706   00408                  ;
     982     707   00408                  ; de routine gebruikt geen registers.
     983     708   00408                  ;
     984     709   00408                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     985     710   00408                  
     986     711   00408 C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
     987     712   0040A C0D0                           push   psw
     988     713   0040C C0F0                           push   b             ;werkregister
     989     714   0040E 1204A9                         lcall  lcdtoport     ;lees de expander naar b register
     990     715   00411 D2F0                           setb   rs            ;controle lijn in orde
     991     716   00413 C2F1                           clr    e             ;deselectie display
     992     717   00415 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
     993     718   00417 03                             rr     a             ;bits op juiste plaats zetten
     994     719   00418 03                             rr     a             ;voor b reg
     995     720   00419 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
     996     721   0041C 42F0                           orl    b,a           ;bij elkaar voegen
     997     722   0041E 120490                         lcall  porttolcd     ;naar expnder
     998     723   00421 D2F1                           setb   e             ;display enabelen
     999     724   00423 120490                         lcall  porttolcd
    1000     725   00426 C2F1                           clr    e             ;display deselecteren
    1001     726   00428 120490                         lcall  porttolcd
    1002     727   0042B D0F0                           pop    b
    1003     728   0042D D0D0                           pop    psw           ;registers herstellen
    1004     729   0042F D0E0                           pop    acc
    1005     730   00431 22                             ret
    1006     731   00432                  
    1007     732   00432                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1008     733   00432                  ;
    1009     734   00432                  ; outc is een routine die naar het controleregister van het display een
    1010     735   00432                  ; volledige byte stuurt.
    1011     736   00432                  ;
    1012     737   00432                  ; De routine gebruikt geen registers.
    1013     738   00432                  ;
    1014     739   00432                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1015     740   00432                  
    1016     741   00432 C0E0             outc:         push   acc           ;registers op stack zetten
    1017     742   00434 C0D0                           push   psw
    1018     743   00436 120448                         lcall  outhnibc      ;hoogste vier bits verzenden
    1019     744   00439 120489                         lcall  delay2ms      ;niet echt nodig
    1020     745   0043C C4                             swap   a             ;bitjes omruilen
    1021     746   0043D 120448                         lcall  outhnibc      ;naar het scherm sturen
    1022     747   00440 120489                         lcall  delay2ms      ;altijd goed voor traagste commando
    1023     748   00443 D0D0                           pop    psw           ;registers terug herstellen
    1024     749   00445 D0E0                           pop    acc
    1025     750   00447 22                             ret
    1026     751   00448                  
    1027     752   00448                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1028     753   00448                  ;
    1029     754   00448                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1030     755   00448                  ; lcd scherm.
    1031     756   00448                  ;
    1032     757   00448                  ; de routine gebruikt geen registers.
    1033     758   00448                  ;
    1034     759   00448                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1035     760   00448                  
    1036     761   00448 C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1037     762   0044A C0D0                           push   psw
    1038     763   0044C C0F0                           push   b             ;werkregister
    1039     764   0044E 1204A9                         lcall  lcdtoport     ;lees de expander naar b register
    1040     765   00451 C2F0                           clr    rs            ;controle lijn in orde
    1041     766   00453 C2F1                           clr    e             ;deselectie display
    1042     767   00455 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1043     768   00457 03                             rr     a             ;bits op juiste plaats zetten
    1044     769   00458 03                             rr     a             ;voor b reg
    1045     770   00459 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1046     771   0045C 42F0                           orl    b,a           ;bij elkaar voegen
    1047     772   0045E 120490                         lcall  porttolcd     ;naar expnder
    1048     773   00461 D2F1                           setb   e             ;display enabelen
    1049     774   00463 120490                         lcall  porttolcd
    1050     775   00466 C2F1                           clr    e             ;display deselecteren
    1051     776   00468 120490                         lcall  porttolcd
    1052     777   0046B D0F0                           pop    b
    1053     778   0046D D0D0                           pop    psw           ;registers herstellen
    1054     779   0046F D0E0                           pop    acc
    1055     780   00471 22                             ret
    1056     781   00472                  
    1057     782   00472                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1058     783   00472                  ;
    1059     784   00472                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1060     785   00472                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1061     786   00472                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1062     787   00472                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1063     788   00472                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1064     789   00472                  ; DATA GESCHREVEN.
    1065     790   00472                  ;
    1066     791   00472                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1067     792   00472                  
    1068     793   00472 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1069     794   00474 120432           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1070     795   00477 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1071     796   00479 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1072     797   0047A 1203F8                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1073     798   0047D 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1074     799   00480 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1075     800   00481 80F4                           SJMP   BUILD3
    1076     801   00483 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1077     802   00485 120432                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1078     803   00488 22                             RET                  ;EINDE VAN DE ROUTINE
    1079     804   00489                  
    1080     805   00489                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1081     806   00489                  ;
    1082     807   00489                  ; Delay2ms is een vertragingsroutine van 2ms.
    1083     808   00489                  ;
    1084     809   00489                  ; De routine gebruikt geen registers.
    1085     810   00489                  ;
    1086     811   00489                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1087     812   00489                  
    1088     813   00489 1202DA           delay2ms:     lcall  delay1ms
    1089     814   0048C 1202DA                         lcall  delay1ms
    1090     815   0048F 22                             ret
    1091     816   00490                  
    1092     817   00490                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1093     818   00490                  ;
    1094     819   00490                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1095     820   00490                  ; scherm stuurt via de port expander.
    1096     821   00490                  ;
    1097     822   00490                  ; Gebruikt geen registers
    1098     823   00490                  ;
    1099     824   00490                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1100     825   00490                  
    1101     826   00490 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1102     827   00492 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1103     828   00494 1201B1                         lcall  iicstart      ;vertrokken
    1104     829   00497 7440                           mov    a,#01000000b  ;schrijven naar expander
    1105     830   00499 1201F8                         lcall  iicoutbyte    ;weg er mee
    1106     831   0049C E5F0                           mov    a,b           ;data verzenden
    1107     832   0049E 1201F8                         lcall  iicoutbyte
    1108     833   004A1 1201D4                         lcall  iicstop       ;transactie sluiten
    1109     834   004A4 D0D0                           pop    psw
    1110     835   004A6 D0E0                           pop    acc
    1111     836   004A8 22                             ret
    1112     837   004A9                  
    1113     838   004A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1114     839   004A9                  ;
    1115     840   004A9                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1116     841   004A9                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1117     842   004A9                  ; van buzzet en backlight is.
    1118     843   004A9                  ;
    1119     844   004A9                  ; Gebruikt b register
    1120     845   004A9                  ;
    1121     846   004A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1122     847   004A9                  
    1123     848   004A9 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1124     849   004AB C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1125     850   004AD 1201B1                         lcall  iicstart      ;vertrokken
    1126     851   004B0 7441                           mov    a,#01000001b  ;lezen van expander
    1127     852   004B2 1201F8                         lcall  iicoutbyte    ;weg er mee
    1128     853   004B5 120273                         lcall  iicinbytenack ;data inlezen
    1129     854   004B8 1201D4                         lcall  iicstop
    1130     855   004BB F5F0                           mov    b,a
    1131     856   004BD D0D0                           pop    psw
    1132     857   004BF D0E0                           pop    acc
    1133     858   004C1 22                             ret
    1134     859   004C2                  
    1135     860   004C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1136     861   004C2                  ;
    1137     862   004C2                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1138     863   004C2                  ;
    1139     864   004C2                  ; Gebruikt geen registers
    1140     865   004C2                  ;
    1141     866   004C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1142     867   004C2                  
    1143     868   004C2 C0F0             lcdlighton:   push   b
    1144     869   004C4 1204A9                         lcall  lcdtoport     ;expander lezen
    1145     870   004C7 C2F6                           clr    b.6           ;licht aan doen
    1146     871   004C9 120490                         lcall  porttolcd     ;expander scrijven
    1147     872   004CC D0F0                           pop    b
    1148     873   004CE 22                             ret
    1149     874   004CF                  
    1150     875   004CF                  
    1151     876   004CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1152     877   004CF                  ;
    1153     878   004CF                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1154     879   004CF                  ;
    1155     880   004CF                  ; Gebruikt geen registers
    1156     881   004CF                  ;
    1157     882   004CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1158     883   004CF                  
    1159     884   004CF C0F0             lcdlightoff:  push   b
    1160     885   004D1 1204A9                         lcall  lcdtoport     ;expander lezen
    1161     886   004D4 D2F6                           setb   b.6           ;licht uit doen
    1162     887   004D6 120490                         lcall  porttolcd     ;expander scrijven
    1163     888   004D9 D0F0                           pop    b
    1164     889   004DB 22                             ret
    1165     890   004DC                  
    1166     891   004DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1167     892   004DC                  ;
    1168     893   004DC                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1169     894   004DC                  ;
    1170     895   004DC                  ; Gebruikt geen registers
    1171     896   004DC                  ;
    1172     897   004DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1173     898   004DC                  
    1174     899   004DC C0F0             lcdbuzon:     push   b
    1175     900   004DE 1204A9                         lcall  lcdtoport     ;expander lezen
    1176     901   004E1 C2F7                           clr    b.7           ;buzzer aan doen
    1177     902   004E3 120490                         lcall  porttolcd     ;expander scrijven
    1178     903   004E6 D0F0                           pop    b
    1179     904   004E8 22                             ret
    1180     905   004E9                  
    1181     906   004E9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1182     907   004E9                  ;
    1183     908   004E9                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1184     909   004E9                  ;
    1185     910   004E9                  ; Gebruikt geen registers
    1186     911   004E9                  ;
    1187     912   004E9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1188     913   004E9                  
    1189     914   004E9 C0F0             lcdbuzoff:    push   b
    1190     915   004EB 1204A9                         lcall  lcdtoport     ;expander lezen
    1191     916   004EE D2F7                           setb   b.7           ;buzzer aan doen
    1192     917   004F0 120490                         lcall  porttolcd     ;expander scrijven
    1193     918   004F3 D0F0                           pop    b
    1194     919   004F5 22                             ret
    1195     920   004F6                  
    1196     921   004F6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1197     922   004F6                  ;
    1198     923   004F6                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1199     924   004F6                  ; een standaard com poort op 9600 baud.
    1200     925   004F6                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1201     926   004F6                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1202     927   004F6                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1203     928   004F6                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1204     929   004F6                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1205     930   004F6                  ; NIET door deze routine.
    1206     931   004F6                  ;
    1207     932   004F6                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1208     933   004F6                  ;
    1209     934   004F6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1210     935   004F6                  
    1211     936   004F6                  blank         equ    020h          ;ascii code voor een blank
    1212     937   004F6                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1213     938   004F6                  ff            equ    00ch          ;ascii code voor nieuw blad
    1214     939   004F6                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1215     940   004F6                  lf            equ    00ah          ;ascii code voor volgende lijn
    1216     941   004F6                  backsp        equ    008h          ;ascii code voor het bs karakter
    1217     942   004F6                  beep          equ    007h          ;ascii code voor een beep
    1218     943   004F6                  
    1219     944   004F6 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1220     945   004FA                                                                          ;van het scherm
    1221     946   004FA                  
    1222     947   004FA                  strtbuf       equ     054h         ;start adres van de buffer
    1223     948   004FA                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1224     949   004FA                  
    1225     950   004FA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1226     951   004FA                  ;
    1227     952   004FA                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1228     953   004FA                  ;
    1229     954   004FA                  ; Gebruikt geen registers
    1230     955   004FA                  ;
    1231     956   004FA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1232     957   004FA                  
    1233     958   004FA C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1234     959   004FC C08F                           push   syscon0              ;map bewaren
    1235     960   004FE 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1236     961   00501 C0B2                           push   port_page            ;pagina op stack zetten
    1237     962   00503 C0BF                           push   scu_page
    1238     963   00505 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1239     964   00508                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1240     965   00508                  ;      -p1.0 als input en alt1 selectie
    1241     966   00508                  ;      -p1.1 als output en alt2 selectie
    1242     967   00508                  
    1243     968   00508 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1244     969   0050B 5390FD                         anl    p1_altsel0,#11111101b
    1245     970   0050E 439001                         orl    p1_altsel0,#00000001b
    1246     971   00511 5391FE                         anl    p1_altsel1,#11111110b
    1247     972   00514 439102                         orl    p1_altsel1,#00000010b
    1248     973   00517 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1249     974   0051A 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1250     975   0051D 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1251     976   00520                  
    1252     977   00520                  ; Nu moet de baud rate generator ingesteld worden
    1253     978   00520                  ; We gaan er van uit dat de systeemklok 24MHz is
    1254     979   00520                  
    1255     980   00520 759850                         mov    scon,#01010000b      ;UART initialiseren
    1256     981   00523                  
    1257     982   00523                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1258     983   00523                  ; gebruikt!!
    1259     984   00523                  
    1260     985   00523 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1261     986   00526 75BD11                         mov    bcon,#00010001b
    1262     987   00529 D0BF                           pop    scu_page
    1263     988   0052B D0B2                           pop    port_page            ;alles terug herstellen
    1264     989   0052D D08F                           pop    syscon0
    1265     990   0052F D0E0                           pop    acc
    1266     991   00531 22                             ret
    1267     992   00532                  
    1268     993   00532                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1269     994   00532                  ;
    1270     995   00532                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1271     996   00532                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1272     997   00532                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1273     998   00532                  ;
    1274     999   00532                  ; de routine gebruikt geen registers.
    1275    1000   00532                  ;
    1276    1001   00532                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1277    1002   00532                  
    1278    1003   00532                  siooutchar:
    1279    1004   00532 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1280    1005   00534 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1281    1006   00537 C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1282    1007   00539 22                             RET
    1283    1008   0053A                  
    1284    1009   0053A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1285    1010   0053A                  ;
    1286    1011   0053A                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1287    1012   0053A                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1288    1013   0053A                  ;
    1289    1014   0053A                  ; de routine gebruikt geen registers.
    1290    1015   0053A                  ;
    1291    1016   0053A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1292    1017   0053A                  
    1293    1018   0053A                  siooutnib:
    1294    1019   0053A C0E0             OUTNIB:       push   acc           ;registers op de stack
    1295    1020   0053C C0D0                           push   psw
    1296    1021   0053E 540F                           ANL    A,#00FH       ;AFZONDEREN
    1297    1022   00540 12062A                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1298    1023   00543 120532                         LCALL  OUTCHAR       ;VERSTUREN
    1299    1024   00546 120593                         LCALL  XONXOFF       ;FLOW CONTROL
    1300    1025   00549 D0D0                           pop    psw           ;registers herstellen
    1301    1026   0054B D0E0                           pop    acc
    1302    1027   0054D 22                             RET
    1303    1028   0054E                  
    1304    1029   0054E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1305    1030   0054E                  ;
    1306    1031   0054E                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1307    1032   0054E                  ; WORDT XONXOFF GEBRUIKT.
    1308    1033   0054E                  ;
    1309    1034   0054E                  ; de routine gebruikt geen registers.
    1310    1035   0054E                  ;
    1311    1036   0054E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1312    1037   0054E                  
    1313    1038   0054E                  siooutbyte:
    1314    1039   0054E C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1315    1040   00550 C0D0                           push   psw
    1316    1041   00552 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1317    1042   00554 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1318    1043   00555 12053A                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1319    1044   00558 D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1320    1045   0055A 12053A                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1321    1046   0055D D0D0                           pop    psw           ;registers herstellen
    1322    1047   0055F D0E0                           pop    acc
    1323    1048   00561 22                             RET
    1324    1049   00562                  
    1325    1050   00562                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1326    1051   00562                  ;
    1327    1052   00562                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1328    1053   00562                  ; VAN DE CURSOR.
    1329    1054   00562                  ;
    1330    1055   00562                  ; de routine gebruikt geen registers.
    1331    1056   00562                  ;
    1332    1057   00562                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1333    1058   00562                  
    1334    1059   00562                  siodispdptr:
    1335    1060   00562 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1336    1061   00564 C0D0                           push   psw
    1337    1062   00566 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1338    1063   00568 12054E                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1339    1064   0056B E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1340    1065   0056D 12054E                         LCALL  OUTBYTE       ;WEG ER MEE
    1341    1066   00570 D0D0                           pop    psw           ;registers herstellen
    1342    1067   00572 D0E0                           pop    acc
    1343    1068   00574 22                             RET                  ;EINDE
    1344    1069   00575                  
    1345    1070   00575                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1346    1071   00575                  ;
    1347    1072   00575                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1348    1073   00575                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1349    1074   00575                  ;
    1350    1075   00575                  ; de routine gebruikt geen registers.
    1351    1076   00575                  ;
    1352    1077   00575                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1353    1078   00575                  
    1354    1079   00575                  siooutmsga:
    1355    1080   00575 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1356    1081   00577 C0D0                           push   psw
    1357    1082   00579 C082                           push   dpl
    1358    1083   0057B C083                           push   dph
    1359    1084   0057D E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1360    1085   0057E 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1361    1086   0057F 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1362    1087   00581 120532                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1363    1088   00584 120593                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1364    1089   00587 A3                             INC    DPTR          ;DPTR AANPASSEN
    1365    1090   00588 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1366    1091   0058A D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1367    1092   0058C D082                           pop    dpl
    1368    1093   0058E D0D0                           pop    psw
    1369    1094   00590 D0E0                           pop    acc
    1370    1095   00592 22                             RET                  ;EINDE ROUTINE
    1371    1096   00593                  
    1372    1097   00593                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1373    1098   00593                  ;
    1374    1099   00593                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1375    1100   00593                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1376    1101   00593                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1377    1102   00593                  ; VERDER DOORGEGEVEN.
    1378    1103   00593                  ;
    1379    1104   00593                  ; de routine gebruikt geen registers.
    1380    1105   00593                  ;
    1381    1106   00593                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1382    1107   00593                  
    1383    1108   00593 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1384    1109   00595 C0D0                           push   psw
    1385    1110   00597 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1386    1111   0059A D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1387    1112   0059C D0E0                           pop    acc
    1388    1113   0059E 22                             RET                  ;ANDERS EINDE
    1389    1114   0059F E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1390    1115   005A1 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1391    1116   005A4 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1392    1117   005A7 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1393    1118   005A9                  
    1394    1119   005A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1395    1120   005A9                  ;
    1396    1121   005A9                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1397    1122   005A9                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1398    1123   005A9                  ;
    1399    1124   005A9                  ; de routine gebruikt de accu.
    1400    1125   005A9                  ;
    1401    1126   005A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1402    1127   005A9                  
    1403    1128   005A9                  sioinchar:
    1404    1129   005A9 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1405    1130   005AC C298                           CLR    RI                   ;BIT LAAG MAKEN
    1406    1131   005AE E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1407    1132   005B0 22                             RET
    1408    1133   005B1                  
    1409    1134   005B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1410    1135   005B1                  ;
    1411    1136   005B1                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1412    1137   005B1                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1413    1138   005B1                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1414    1139   005B1                  ; DE CARRY OP 1 GEZET WORDEN.
    1415    1140   005B1                  ;
    1416    1141   005B1                  ; De routine gebruikt de accu, r0 en de psw.
    1417    1142   005B1                  ;
    1418    1143   005B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1419    1144   005B1                  
    1420    1145   005B1                  sioinbyte:
    1421    1146   005B1 1205A9           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1422    1147   005B4 12061D                         LCALL  LOWUPTR
    1423    1148   005B7 120634                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1424    1149   005BA 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1425    1150   005BC C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1426    1151   005BD F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1427    1152   005BE 1205A9                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1428    1153   005C1 12061D                         LCALL  LOWUPTR
    1429    1154   005C4 120634                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1430    1155   005C7 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1431    1156   005C9 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1432    1157   005CA 22               INBYTE1:      RET
    1433    1158   005CB                  
    1434    1159   005CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1435    1160   005CB                  ;
    1436    1161   005CB                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1437    1162   005CB                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1438    1163   005CB                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1439    1164   005CB                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1440    1165   005CB                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1441    1166   005CB                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1442    1167   005CB                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1443    1168   005CB                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1444    1169   005CB                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1445    1170   005CB                  ; bepalen.
    1446    1171   005CB                  ;
    1447    1172   005CB                  ; De routine gebruikt de accu, r0 en de psw.
    1448    1173   005CB                  ;
    1449    1174   005CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1450    1175   005CB                  
    1451    1176   005CB                  sioinbufa:
    1452    1177   005CB 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1453    1178   005CD 1205A9           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1454    1179   005D0 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1455    1180   005D2                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1456    1181   005D2                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1457    1182   005D2                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1458    1183   005D2                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1459    1184   005D2                  ; GEVOERD.
    1460    1185   005D2 12061D                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1461    1186   005D5 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1462    1187   005D8 F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1463    1188   005D9 22                             RET                         ;EINDE VAN DE ROUTINE
    1464    1189   005DA B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1465    1190   005DD B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1466    1191   005E0 7407             INBUFA4:      MOV    A,#BEEP
    1467    1192   005E2 120532           INBUFA7:      LCALL  OUTCHAR
    1468    1193   005E5 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1469    1194   005E7 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1470    1195   005E8 9004F6                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1471    1196   005EB 120575                         LCALL  OUTMSGA
    1472    1197   005EE 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1473    1198   005F0 12060F           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1474    1199   005F3 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1475    1200   005F5 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1476    1201   005F8 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1477    1202   005FA F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1478    1203   005FB 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1479    1204   005FC 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1480    1205   005FE                  
    1481    1206   005FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1482    1207   005FE                  ;
    1483    1208   005FE                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1484    1209   005FE                  ;
    1485    1210   005FE                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1486    1211   005FE                  ;
    1487    1212   005FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1488    1213   005FE                  
    1489    1214   005FE 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1490    1215   00600 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1491    1216   00602 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1492    1217   00603 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1493    1218   00606 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1494    1219   00607 B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1495    1220   0060A 22                             RET                         ;EINDE VAN DE ROUTINE
    1496    1221   0060B F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1497    1222   0060C 09                             INC    R1
    1498    1223   0060D 80F7                           SJMP   BDELETE3
    1499    1224   0060F                  
    1500    1225   0060F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1501    1226   0060F                  ;
    1502    1227   0060F                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1503    1228   0060F                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1504    1229   0060F                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1505    1230   0060F                  ; AANZIEN.
    1506    1231   0060F                  ;
    1507    1232   0060F                  ; De routine gebruikt de accu en de psw.
    1508    1233   0060F                  ;
    1509    1234   0060F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1510    1235   0060F                  
    1511    1236   0060F B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1512    1237   00612 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1513    1238   00614 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1514    1239   00617 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1515    1240   00619 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1516    1241   0061A 22                             RET
    1517    1242   0061B D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1518    1243   0061C 22                             RET
    1519    1244   0061D                  
    1520    1245   0061D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1521    1246   0061D                  ;
    1522    1247   0061D                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1523    1248   0061D                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1524    1249   0061D                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1525    1250   0061D                  ; AANGEPAST WORDEN.
    1526    1251   0061D                  ;
    1527    1252   0061D                  ; De routine gebruikt de accu en de psw.
    1528    1253   0061D                  ;
    1529    1254   0061D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1530    1255   0061D                  
    1531    1256   0061D B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1532    1257   00620 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1533    1258   00622 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1534    1259   00625 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1535    1260   00627 9420                           SUBB   A,#020H              ;OMZETTING
    1536    1261   00629 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1537    1262   0062A                  
    1538    1263   0062A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1539    1264   0062A                  ;
    1540    1265   0062A                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1541    1266   0062A                  ; ASCII CODE.
    1542    1267   0062A                  ;
    1543    1268   0062A                  ; De routine gebruikt de accu en de psw.
    1544    1269   0062A                  ;
    1545    1270   0062A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1546    1271   0062A                  
    1547    1272   0062A B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1548    1273   0062D 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1549    1274   0062F 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1550    1275   00631 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1551    1276   00633 22                             RET
    1552    1277   00634                  
    1553    1278   00634                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1554    1279   00634                  ;
    1555    1280   00634                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1556    1281   00634                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1557    1282   00634                  ; GEVAL WORDT DE CARRY GEZET.
    1558    1283   00634                  ;
    1559    1284   00634                  ; De routine gebruikt de accu en de psw.
    1560    1285   00634                  ;
    1561    1286   00634                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1562    1287   00634                  
    1563    1288   00634 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1564    1289   00635 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1565    1290   00637 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1566    1291   00639 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1567    1292   0063C 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1568    1293   0063E 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1569    1294   00640 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1570    1295   00642 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1571    1296   00645 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1572    1297   00646 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1573    1298   00648 C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1574    1299   00649 22               ASCBINTRANS1: RET
    1575    1300   0064A                  
    1576    1301   0064A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1577    1302   0064A                  ;
    1578    1303   0064A                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1579    1304   0064A                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1580    1305   0064A                  ;
    1581    1306   0064A                  ; De routine gebruikt de accu en de psw.
    1582    1307   0064A                  ;
    1583    1308   0064A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1584    1309   0064A                  
    1585    1310   0064A E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1586    1311   0064B 120634                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1587    1312   0064E 22                             RET                         ;EINDE OMZETTING
    1588    1313   0064F                  
    1589    1314   0064F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1590    1315   0064F                  ;
    1591    1316   0064F                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1592    1317   0064F                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1593    1318   0064F                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1594    1319   0064F                  ;
    1595    1320   0064F                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1596    1321   0064F                  ;
    1597    1322   0064F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1598    1323   0064F                  
    1599    1324   0064F 12064A           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1600    1325   00652 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1601    1326   00654 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1602    1327   00655 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1603    1328   00656 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1604    1329   00657 12064A                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1605    1330   0065A 4001                           JC     ASCII21               ;WEG ALS C=1
    1606    1331   0065C 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1607    1332   0065D 22               ASCII21:      RET
    1608    1333   0065E                  
    1609    1334   0065E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1610    1335   0065E                  ;
    1611    1336   0065E                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1612    1337   0065E                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1613    1338   0065E                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1614    1339   0065E                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1615    1340   0065E                  ;
    1616    1341   0065E                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1617    1342   0065E                  ;
    1618    1343   0065E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1619    1344   0065E                  
    1620    1345   0065E 12064F           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1621    1346   00661 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1622    1347   00663 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1623    1348   00665 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1624    1349   00666 12064F                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1625    1350   00669 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1626    1351   0066B F582                           MOV    DPL,A                ;IN DPTR LADEN
    1627    1352   0066D 22               ASCII41:      RET
    1628    1353   0066E                  
    1629    1354   0066E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1630    1355   0066E                  ;
    1631    1356   0066E                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1632    1357   0066E                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1633    1358   0066E                  ; geschakeld worden.
    1634    1359   0066E                  ;
    1635    1360   0066E                  ; Gebruikt geen registers
    1636    1361   0066E                  ;
    1637    1362   0066E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1638    1363   0066E                  
    1639    1364   0066E C08F             initadc:      push   syscon0                     ;map saven
    1640    1365   00670 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1641    1366   00673 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1642    1367   00676 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1643    1368   00679                                                                   ;klok delen door 32 (750kHz)
    1644    1369   00679                                                                   ;10 bit uitkomst
    1645    1370   00679 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1646    1371   0067C                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1647    1372   0067C 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1648    1373   0067F 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1649    1374   00682 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1650    1375   00685 D08F                           pop    syscon0                     ;herstellen syscon
    1651    1376   00687 22                             ret
    1652    1377   00688                  
    1653    1378   00688                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1654    1379   00688                  ;
    1655    1380   00688                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1656    1381   00688                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1657    1382   00688                  ;
    1658    1383   00688                  ; Gebruikt:
    1659    1384   00688                  ;      -accu als 8 msb meting
    1660    1385   00688                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1661    1386   00688                  ;
    1662    1387   00688                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1663    1388   00688                  
    1664    1389   00688 C08F             adclm335:     push   syscon0
    1665    1390   0068A 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1666    1391   0068D 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1667    1392   00690 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1668    1393   00693 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1669    1394   00696 00               		nop
    1670    1395   00697 00               		nop					;anders loopt het mis met het testen van de ready bit
    1671    1396   00698 E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1672    1397   0069A 20E0FB                         jb     acc.0,adclm3351
    1673    1398   0069D 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1674    1399   006A0 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1675    1400   006A2 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1676    1401   006A5 D08F                           pop    syscon0
    1677    1402   006A7 22                             ret
    1678    1403   006A8                  
    1679    1404   006A8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1680    1405   006A8                  ;
    1681    1406   006A8                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1682    1407   006A8                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1683    1408   006A8                  ;
    1684    1409   006A8                  ; Gebruikt:
    1685    1410   006A8                  ;      -accu als 8 msb meting
    1686    1411   006A8                  ;      -b als 2 lsb meting (links afgelijnd)
    1687    1412   006A8                  ;
    1688    1413   006A8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1689    1414   006A8                  
    1690    1415   006A8 C08F             adcpotmeter:  push   syscon0
    1691    1416   006AA 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1692    1417   006AD 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1693    1418   006B0 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1694    1419   006B3 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1695    1420   006B6 00               		nop
    1696    1421   006B7 00               		nop					;anders loopt het mis met het testen van de ready bit
    1697    1422   006B8 E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1698    1423   006BA 20E0FB                         jb     acc.0,adcpotmeter1
    1699    1424   006BD 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1700    1425   006C0 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1701    1426   006C2 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1702    1427   006C5 D08F                           pop    syscon0
    1703    1428   006C7                  
    1704    1429   006C7                  
    1705    1430   006C7 22                             ret
    1706    1431   006C8                  
    1707    1432   006C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1708    1433   006C8                  ;
    1709    1434   006C8                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1710    1435   006C8                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1711    1436   006C8                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1712    1437   006C8                  ; doelstellingen in het achterhoofd.
    1713    1438   006C8                  ;
    1714    1439   006C8                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1715    1440   006C8                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1716    1441   006C8                  ; bcd)
    1717    1442   006C8                  ;      8bit hex naar bcd
    1718    1443   006C8                  ;      8bit bcd naar hex
    1719    1444   006C8                  ;
    1720    1445   006C8                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1721    1446   006C8                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1722    1447   006C8                  ;      16*16 bit met 32 bit uitkomst
    1723    1448   006C8                  ;      16+16 bit met 24 bit uitkomst
    1724    1449   006C8                  ;      16-16 bit met 24 bit uitkomst
    1725    1450   006C8                  ;      16bit hex naar bcd
    1726    1451   006C8                  ;      16bit bcd naar hex
    1727    1452   006C8                  ;
    1728    1453   006C8                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1729    1454   006C8                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1730    1455   006C8                  ;      32*32 bit met 64 bit uitkomst
    1731    1456   006C8                  ;      32+32 bit met 40 bit uitkomst
    1732    1457   006C8                  ;      32-32 bit met 40 bit uitkomst
    1733    1458   006C8                  ;
    1734    1459   006C8                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1735    1460   006C8                  ;
    1736    1461   006C8                  ; De routines gebruiken als input en output de huidige registerbank.
    1737    1462   006C8                  ;
    1738    1463   006C8                  ;
    1739    1464   006C8                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1740    1465   006C8                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1741    1466   006C8                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1742    1467   006C8                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1743    1468   006C8                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1744    1469   006C8                  ;
    1745    1470   006C8                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1746    1471   006C8                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1747    1472   006C8                  ;      -routines gebruiken geen MDU!
    1748    1473   006C8                  ;
    1749    1474   006C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1750    1475   006C8                  
    1751    1476   006C8                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1752    1477   006C8                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1753    1478   006C8                  
    1754    1479   006C8                  h0            equ    070h
    1755    1480   006C8                  h1            equ    071h
    1756    1481   006C8                  h2            equ    072h
    1757    1482   006C8                  h3            equ    073h
    1758    1483   006C8                  h4            equ    074h
    1759    1484   006C8                  h5            equ    075h
    1760    1485   006C8                  h6            equ    076h
    1761    1486   006C8                  h7            equ    077h
    1762    1487   006C8                  h8            equ    078h
    1763    1488   006C8                  h9            equ    079h
    1764    1489   006C8                  h10           equ    07ah
    1765    1490   006C8                  h11           equ    07bh
    1766    1491   006C8                  h12           equ    07ch
    1767    1492   006C8                  
    1768    1493   006C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1769    1494   006C8                  ;
    1770    1495   006C8                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1771    1496   006C8                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1772    1497   006C8                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1773    1498   006C8                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1774    1499   006C8                  ;
    1775    1500   006C8                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1776    1501   006C8                  ;
    1777    1502   006C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1778    1503   006C8                  
    1779    1504   006C8 C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1780    1505   006CA C0D0                           push   psw
    1781    1506   006CC C070                           push   h0
    1782    1507   006CE C071                           push   h1
    1783    1508   006D0 C072                           push   h2
    1784    1509   006D2 C073                           push   h3
    1785    1510   006D4 C074                           push   h4
    1786    1511   006D6 C075                           push   h5
    1787    1512   006D8 C076                           push   h6
    1788    1513   006DA C077                           push   h7
    1789    1514   006DC C078                           push   h8
    1790    1515   006DE C079                           push   h9
    1791    1516   006E0 C07A                           push   h10
    1792    1517   006E2 C07B                           push   h11
    1793    1518   006E4 C07C                           push   h12
    1794    1519   006E6                  
    1795    1520   006E6                  ; eerst moeten de hulpregisters klaar gezet worden
    1796    1521   006E6                  
    1797    1522   006E6 757000                         mov    h0,#000h
    1798    1523   006E9 757100                         mov    h1,#000h
    1799    1524   006EC 757200                         mov    h2,#000h
    1800    1525   006EF 757300                         mov    h3,#000h
    1801    1526   006F2 757400                         mov    h4,#000h
    1802    1527   006F5 757500                         mov    h5,#000h
    1803    1528   006F8 757600                         mov    h6,#000h
    1804    1529   006FB 757700                         mov    h7,#000h
    1805    1530   006FE 757800                         mov    h8,#000h
    1806    1531   00701 757900                         mov    h9,#000h
    1807    1532   00704 757A00                         mov    h10,#000h
    1808    1533   00707 757B00                         mov    h11,#000h
    1809    1534   0070A 757C20                         mov    h12,#32              ;loopcounter
    1810    1535   0070D                  
    1811    1536   0070D                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1812    1537   0070D                  
    1813    1538   0070D                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1814    1539   0070D                  
    1815    1540   0070D EB               mul321:       mov    a,r3
    1816    1541   0070E 13                             rrc    a
    1817    1542   0070F FB                             mov    r3,a
    1818    1543   00710 EA                             mov    a,r2
    1819    1544   00711 13                             rrc    a
    1820    1545   00712 FA                             mov    r2,a
    1821    1546   00713 E9                             mov    a,r1
    1822    1547   00714 13                             rrc    a
    1823    1548   00715 F9                             mov    r1,a
    1824    1549   00716 E8                             mov    a,r0
    1825    1550   00717 13                             rrc    a
    1826    1551   00718 F8                             mov    r0,a                 ;32 bit shift klaar
    1827    1552   00719                  
    1828    1553   00719                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1829    1554   00719                  
    1830    1555   00719 502C                           jnc    mul322               ;optelling niet nodig
    1831    1556   0071B                  
    1832    1557   0071B                  ; hier staat en 64 bit optelling
    1833    1558   0071B                  
    1834    1559   0071B EC                             mov    a,r4
    1835    1560   0071C 2574                           add    a,h4
    1836    1561   0071E F574                           mov    h4,a
    1837    1562   00720 ED                             mov    a,r5
    1838    1563   00721 3575                           addc   a,h5
    1839    1564   00723 F575                           mov    h5,a
    1840    1565   00725 EE                             mov    a,r6
    1841    1566   00726 3576                           addc   a,h6
    1842    1567   00728 F576                           mov    h6,a
    1843    1568   0072A EF                             mov    a,r7
    1844    1569   0072B 3577                           addc   a,h7
    1845    1570   0072D F577                           mov    h7,a
    1846    1571   0072F E570                           mov    a,h0
    1847    1572   00731 3578                           addc   a,h8
    1848    1573   00733 F578                           mov    h8,a
    1849    1574   00735 E571                           mov    a,h1
    1850    1575   00737 3579                           addc   a,h9
    1851    1576   00739 F579                           mov    h9,a
    1852    1577   0073B E572                           mov    a,h2
    1853    1578   0073D 357A                           addc   a,h10
    1854    1579   0073F F57A                           mov    h10,a
    1855    1580   00741 E573                           mov    a,h3
    1856    1581   00743 357B                           addc   a,h11
    1857    1582   00745 F57B                           mov    h11,a                ;optelling klaar
    1858    1583   00747                  
    1859    1584   00747                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1860    1585   00747                  
    1861    1586   00747 C3               mul322:       clr    c                    ;moet op 0 staan
    1862    1587   00748 EC                             mov    a,r4
    1863    1588   00749 33                             rlc    a
    1864    1589   0074A FC                             mov    r4,a
    1865    1590   0074B ED                             mov    a,r5
    1866    1591   0074C 33                             rlc    a
    1867    1592   0074D FD                             mov    r5,a
    1868    1593   0074E EE                             mov    a,r6
    1869    1594   0074F 33                             rlc    a
    1870    1595   00750 FE                             mov    r6,a
    1871    1596   00751 EF                             mov    a,r7
    1872    1597   00752 33                             rlc    a
    1873    1598   00753 FF                             mov    r7,a
    1874    1599   00754 E570                           mov    a,h0
    1875    1600   00756 33                             rlc    a
    1876    1601   00757 F570                           mov    h0,a
    1877    1602   00759 E571                           mov    a,h1
    1878    1603   0075B 33                             rlc    a
    1879    1604   0075C F571                           mov    h1,a
    1880    1605   0075E E572                           mov    a,h2
    1881    1606   00760 33                             rlc    a
    1882    1607   00761 F572                           mov    h2,a
    1883    1608   00763 E573                           mov    a,h3
    1884    1609   00765 33                             rlc    a
    1885    1610   00766 F573                           mov    h3,a
    1886    1611   00768                  
    1887    1612   00768 D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1888    1613   0076B                  
    1889    1614   0076B                  ; de uitkomst moet in de juiste registers komen
    1890    1615   0076B                  
    1891    1616   0076B A874                           mov    r0,h4
    1892    1617   0076D A975                           mov    r1,h5
    1893    1618   0076F AA76                           mov    r2,h6
    1894    1619   00771 AB77                           mov    r3,h7
    1895    1620   00773 AC78                           mov    r4,h8
    1896    1621   00775 AD79                           mov    r5,h9
    1897    1622   00777 AE7A                           mov    r6,h10
    1898    1623   00779 AF7B                           mov    r7,h11               ;klaar
    1899    1624   0077B                  
    1900    1625   0077B D07C                           pop    h12                  ;registers herstellen
    1901    1626   0077D D07B                           pop    h11
    1902    1627   0077F D07A                           pop    h10
    1903    1628   00781 D079                           pop    h9
    1904    1629   00783 D078                           pop    h8
    1905    1630   00785 D077                           pop    h7
    1906    1631   00787 D076                           pop    h6
    1907    1632   00789 D075                           pop    h5
    1908    1633   0078B D074                           pop    h4
    1909    1634   0078D D073                           pop    h3
    1910    1635   0078F D072                           pop    h2
    1911    1636   00791 D071                           pop    h1
    1912    1637   00793 D070                           pop    h0
    1913    1638   00795 D0D0                           pop    psw
    1914    1639   00797 D0E0                           pop    acc
    1915    1640   00799 22                             ret
    1916    1641   0079A                  
    1917    1642   0079A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1918    1643   0079A                  ;
    1919    1644   0079A                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1920    1645   0079A                  ; input:      r1,r0 = eerste getal (r1=msb)
    1921    1646   0079A                  ;             r3,r2 = tweede getal (r3=msb)
    1922    1647   0079A                  ; output:     r3,r2,r1,r0 met r3=msb
    1923    1648   0079A                  ;
    1924    1649   0079A                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1925    1650   0079A                  ;
    1926    1651   0079A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1927    1652   0079A                  
    1928    1653   0079A C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1929    1654   0079C C0D0                           push   psw
    1930    1655   0079E C070                           push   h0
    1931    1656   007A0 C071                           push   h1
    1932    1657   007A2 C072                           push   h2
    1933    1658   007A4 C073                           push   h3
    1934    1659   007A6 C074                           push   h4
    1935    1660   007A8 C075                           push   h5
    1936    1661   007AA C076                           push   h6
    1937    1662   007AC                  
    1938    1663   007AC                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1939    1664   007AC                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1940    1665   007AC                  ; h6 is de loopcounter.
    1941    1666   007AC                  
    1942    1667   007AC 757000                         mov    h0,#000h
    1943    1668   007AF 757100                         mov    h1,#000h
    1944    1669   007B2 757200                         mov    h2,#000h
    1945    1670   007B5 757300                         mov    h3,#000h
    1946    1671   007B8 757400                         mov    h4,#000h
    1947    1672   007BB 757500                         mov    h5,#000h
    1948    1673   007BE 757610                         mov    h6,#16               ;loopcounter
    1949    1674   007C1                  
    1950    1675   007C1                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1951    1676   007C1                  ; berekening
    1952    1677   007C1                  
    1953    1678   007C1 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1954    1679   007C2 13                             rrc    a
    1955    1680   007C3 F9                             mov    r1,a
    1956    1681   007C4 E8                             mov    a,r0
    1957    1682   007C5 13                             rrc    a
    1958    1683   007C6 F8                             mov    r0,a                 ;ok
    1959    1684   007C7                  
    1960    1685   007C7                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1961    1686   007C7                  
    1962    1687   007C7 5016                           jnc    mul162
    1963    1688   007C9                  
    1964    1689   007C9 EA                             mov    a,r2
    1965    1690   007CA 2572                           add    a,h2
    1966    1691   007CC F572                           mov    h2,a                 ;32 bit som uitvoeren
    1967    1692   007CE EB                             mov    a,r3
    1968    1693   007CF 3573                           addc   a,h3
    1969    1694   007D1 F573                           mov    h3,a
    1970    1695   007D3 E570                           mov    a,h0
    1971    1696   007D5 3574                           addc   a,h4
    1972    1697   007D7 F574                           mov    h4,a
    1973    1698   007D9 E571                           mov    a,h1
    1974    1699   007DB 3575                           addc   a,h5
    1975    1700   007DD F575                           mov    h5,a                 ;klaar
    1976    1701   007DF                  
    1977    1702   007DF                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    1978    1703   007DF                  
    1979    1704   007DF C3               mul162:       clr    c
    1980    1705   007E0 EA                             mov    a,r2
    1981    1706   007E1 33                             rlc    a
    1982    1707   007E2 FA                             mov    r2,a                 ;ook 32 bit getal
    1983    1708   007E3 EB                             mov    a,r3
    1984    1709   007E4 33                             rlc    a
    1985    1710   007E5 FB                             mov    r3,a
    1986    1711   007E6 E570                           mov    a,h0
    1987    1712   007E8 33                             rlc    a
    1988    1713   007E9 F570                           mov    h0,a
    1989    1714   007EB E571                           mov    a,h1
    1990    1715   007ED 33                             rlc    a
    1991    1716   007EE F571                           mov    h1,a                 ;klaar
    1992    1717   007F0                  
    1993    1718   007F0 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    1994    1719   007F3                  
    1995    1720   007F3                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    1996    1721   007F3                  
    1997    1722   007F3 A872                           mov    r0,h2
    1998    1723   007F5 A973                           mov    r1,h3
    1999    1724   007F7 AA74                           mov    r2,h4
    2000    1725   007F9 AB75                           mov    r3,h5                ;klaar
    2001    1726   007FB                  
    2002    1727   007FB                  
    2003    1728   007FB D076                           pop    h6                   ;registers herstellen
    2004    1729   007FD D075                           pop    h5
    2005    1730   007FF D074                           pop    h4
    2006    1731   00801 D073                           pop    h3
    2007    1732   00803 D072                           pop    h2
    2008    1733   00805 D071                           pop    h1
    2009    1734   00807 D070                           pop    h0
    2010    1735   00809 D0D0                           pop    psw
    2011    1736   0080B D0E0                           pop    acc
    2012    1737   0080D 22                             ret
    2013    1738   0080E                  
    2014    1739   0080E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2015    1740   0080E                  ;
    2016    1741   0080E                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2017    1742   0080E                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2018    1743   0080E                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2019    1744   0080E                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2020    1745   0080E                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2021    1746   0080E                  ;             carry=1 bij delen door 0
    2022    1747   0080E                  ;
    2023    1748   0080E                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2024    1749   0080E                  ;
    2025    1750   0080E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2026    1751   0080E                  
    2027    1752   0080E C0E0             div32:        push   acc                  ;registers op de stack zetten
    2028    1753   00810 C0D0                           push   psw
    2029    1754   00812 C070                           push   h0
    2030    1755   00814 C071                           push   h1
    2031    1756   00816 C072                           push   h2
    2032    1757   00818 C073                           push   h3
    2033    1758   0081A C074                           push   h4
    2034    1759   0081C C075                           push   h5
    2035    1760   0081E C076                           push   h6
    2036    1761   00820 C077                           push   h7
    2037    1762   00822 C078                           push   h8
    2038    1763   00824 C079                           push   h9
    2039    1764   00826 C07A                           push   h10
    2040    1765   00828 C07B                           push   h11
    2041    1766   0082A C07C                           push   h12
    2042    1767   0082C                  
    2043    1768   0082C                  ; eerst alles voorladen
    2044    1769   0082C                  
    2045    1770   0082C 757000                         mov    h0,#000h
    2046    1771   0082F 757100                         mov    h1,#000h
    2047    1772   00832 757200                         mov    h2,#000h
    2048    1773   00835 757300                         mov    h3,#000h
    2049    1774   00838 757400                         mov    h4,#000h
    2050    1775   0083B 757500                         mov    h5,#000h
    2051    1776   0083E 757600                         mov    h6,#000h
    2052    1777   00841 757700                         mov    h7,#000h
    2053    1778   00844 757800                         mov    h8,#000h
    2054    1779   00847 757900                         mov    h9,#000h
    2055    1780   0084A 757A00                         mov    h10,#000h
    2056    1781   0084D 757B00                         mov    h11,#000h
    2057    1782   00850 757C20                         mov    h12,#32              ;loopcounter
    2058    1783   00853                  
    2059    1784   00853                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2060    1785   00853                  
    2061    1786   00853                  ; deze lus moet 32 keer heraald worden
    2062    1787   00853                  
    2063    1788   00853 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2064    1789   00854 33                             rlc    a
    2065    1790   00855 F8                             mov    r0,a
    2066    1791   00856 E9                             mov    a,r1
    2067    1792   00857 33                             rlc    a
    2068    1793   00858 F9                             mov    r1,a
    2069    1794   00859 EA                             mov    a,r2
    2070    1795   0085A 33                             rlc    a
    2071    1796   0085B FA                             mov    r2,a
    2072    1797   0085C EB                             mov    a,r3
    2073    1798   0085D 33                             rlc    a
    2074    1799   0085E FB                             mov    r3,a
    2075    1800   0085F E570                           mov    a,h0
    2076    1801   00861 33                             rlc    a
    2077    1802   00862 F570                           mov    h0,a
    2078    1803   00864 E571                           mov    a,h1
    2079    1804   00866 33                             rlc    a
    2080    1805   00867 F571                           mov    h1,a
    2081    1806   00869 E572                           mov    a,h2
    2082    1807   0086B 33                             rlc    a
    2083    1808   0086C F572                           mov    h2,a
    2084    1809   0086E E573                           mov    a,h3
    2085    1810   00870 33                             rlc    a
    2086    1811   00871 F573                           mov    h3,a
    2087    1812   00873                  
    2088    1813   00873                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2089    1814   00873                  
    2090    1815   00873 C3                             clr    c                    ;zit in de weg
    2091    1816   00874 E570                           mov    a,h0
    2092    1817   00876 9C                             subb   a,r4
    2093    1818   00877 F574                           mov    h4,a
    2094    1819   00879 E571                           mov    a,h1
    2095    1820   0087B 9D                             subb   a,r5
    2096    1821   0087C F575                           mov    h5,a
    2097    1822   0087E E572                           mov    a,h2
    2098    1823   00880 9E                             subb   a,r6
    2099    1824   00881 F576                           mov    h6,a
    2100    1825   00883 E573                           mov    a,h3
    2101    1826   00885 9F                             subb   a,r7
    2102    1827   00886 F577                           mov    h7,a
    2103    1828   00888                  
    2104    1829   00888                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2105    1830   00888                  ; vervangen worden door h7-h4
    2106    1831   00888                  
    2107    1832   00888 400C                           jc     div322               ;niet vervangen
    2108    1833   0088A                  
    2109    1834   0088A 857470                         mov    h0,h4
    2110    1835   0088D 857571                         mov    h1,h5
    2111    1836   00890 857672                         mov    h2,h6
    2112    1837   00893 857773                         mov    h3,h7                ;vervanging klaar
    2113    1838   00896                  
    2114    1839   00896 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2115    1840   00897 E578                           mov    a,h8
    2116    1841   00899 33                             rlc    a
    2117    1842   0089A F578                           mov    h8,a
    2118    1843   0089C E579                           mov    a,h9
    2119    1844   0089E 33                             rlc    a
    2120    1845   0089F F579                           mov    h9,a
    2121    1846   008A1 E57A                           mov    a,h10
    2122    1847   008A3 33                             rlc    a
    2123    1848   008A4 F57A                           mov    h10,a
    2124    1849   008A6 E57B                           mov    a,h11
    2125    1850   008A8 33                             rlc    a
    2126    1851   008A9 F57B                           mov    h11,a                ;qoutient aangepast
    2127    1852   008AB                  
    2128    1853   008AB D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2129    1854   008AE                  
    2130    1855   008AE                  ; de berekening is klaar. uitkomstregisters nog laden
    2131    1856   008AE                  
    2132    1857   008AE AC78                           mov    r4,h8
    2133    1858   008B0 AD79                           mov    r5,h9
    2134    1859   008B2 AE7A                           mov    r6,h10
    2135    1860   008B4 AF7B                           mov    r7,h11               ;uitkomst geladen
    2136    1861   008B6                  
    2137    1862   008B6 A870                           mov    r0,h0                ;rest laden
    2138    1863   008B8 A971                           mov    r1,h1
    2139    1864   008BA AA72                           mov    r2,h2
    2140    1865   008BC AB73                           mov    r3,h3
    2141    1866   008BE                  
    2142    1867   008BE D07C                           pop    h12                  ;registers herstellen
    2143    1868   008C0 D07B                           pop    h11
    2144    1869   008C2 D07A                           pop    h10
    2145    1870   008C4 D079                           pop    h9
    2146    1871   008C6 D078                           pop    h8
    2147    1872   008C8 D077                           pop    h7
    2148    1873   008CA D076                           pop    h6
    2149    1874   008CC D075                           pop    h5
    2150    1875   008CE D074                           pop    h4
    2151    1876   008D0 D073                           pop    h3
    2152    1877   008D2 D072                           pop    h2
    2153    1878   008D4 D071                           pop    h1
    2154    1879   008D6 D070                           pop    h0
    2155    1880   008D8 D0D0                           pop    psw
    2156    1881   008DA D0E0                           pop    acc
    2157    1882   008DC 22                             ret
    2158    1883   008DD                  
    2159    1884   008DD                  
    2160    1885   008DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2161    1886   008DD                  ;
    2162    1887   008DD                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2163    1888   008DD                  ; input:      r1,r0 = eerste getal (r1=msb)
    2164    1889   008DD                  ;             r3,r2 = tweede getal (r3=msb)
    2165    1890   008DD                  ; output:     r3,r2 = quotient (r3=msb)
    2166    1891   008DD                  ;             r1,r0 = rest (r1=msb)
    2167    1892   008DD                  ;             carry=1 bij deling door 0
    2168    1893   008DD                  ;
    2169    1894   008DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2170    1895   008DD                  
    2171    1896   008DD C0E0             div16:        push   acc                  ;registers op de stack zetten
    2172    1897   008DF C0D0                           push   psw
    2173    1898   008E1 C070                           push   h0
    2174    1899   008E3 C071                           push   h1
    2175    1900   008E5 C072                           push   h2
    2176    1901   008E7 C073                           push   h3
    2177    1902   008E9 C074                           push   h4
    2178    1903   008EB C075                           push   h5
    2179    1904   008ED C076                           push   h6
    2180    1905   008EF                  
    2181    1906   008EF                  ; registers voorladen
    2182    1907   008EF                  
    2183    1908   008EF 757000                         mov    h0,#000h
    2184    1909   008F2 757100                         mov    h1,#000h
    2185    1910   008F5 757200                         mov    h2,#000h
    2186    1911   008F8 757300                         mov    h3,#000h
    2187    1912   008FB 757400                         mov    h4,#000h
    2188    1913   008FE 757500                         mov    h5,#000h
    2189    1914   00901 757610                         mov    h6,#16               ;loopcounter
    2190    1915   00904                  
    2191    1916   00904                  ; eerst te delen getal 1*links shiften in hulpregisters
    2192    1917   00904                  
    2193    1918   00904                  ; deze lus moet 16 keer herhaald worden
    2194    1919   00904                  
    2195    1920   00904 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2196    1921   00905 33                             rlc    a
    2197    1922   00906 F8                             mov    r0,a
    2198    1923   00907 E9                             mov    a,r1
    2199    1924   00908 33                             rlc    a
    2200    1925   00909 F9                             mov    r1,a
    2201    1926   0090A E570                           mov    a,h0
    2202    1927   0090C 33                             rlc    a
    2203    1928   0090D F570                           mov    h0,a
    2204    1929   0090F E571                           mov    a,h1
    2205    1930   00911 33                             rlc    a
    2206    1931   00912 F571                           mov    h1,a
    2207    1932   00914                  
    2208    1933   00914                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2209    1934   00914                  ; het tussenresultaat.
    2210    1935   00914                  
    2211    1936   00914 C3                             clr    c
    2212    1937   00915 E570                           mov    a,h0
    2213    1938   00917 9A                             subb   a,r2
    2214    1939   00918 F572                           mov    h2,a
    2215    1940   0091A E571                           mov    a,h1
    2216    1941   0091C 9B                             subb   a,r3
    2217    1942   0091D F573                           mov    h3,a
    2218    1943   0091F                  
    2219    1944   0091F 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2220    1945   00921                                                            ;door h3,h2
    2221    1946   00921 857270                         mov    h0,h2
    2222    1947   00924 857371                         mov    h1,h3                ;vervanging klaar
    2223    1948   00927                  
    2224    1949   00927                  ; uitkomst moet aangepast worden
    2225    1950   00927                  
    2226    1951   00927 B3               div162:       cpl    c                    ;truuk
    2227    1952   00928 E574                           mov    a,h4
    2228    1953   0092A 33                             rlc    a
    2229    1954   0092B F574                           mov    h4,a
    2230    1955   0092D E575                           mov    a,h5
    2231    1956   0092F 33                             rlc    a
    2232    1957   00930 F575                           mov    h5,a
    2233    1958   00932 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2234    1959   00935                  
    2235    1960   00935                  ; de berekening is klaar. uitkomsten in passende registers
    2236    1961   00935                  
    2237    1962   00935 AA74                           mov    r2,h4                ;quotient
    2238    1963   00937 AB75                           mov    r3,h5
    2239    1964   00939                  
    2240    1965   00939 A870                           mov    r0,h0                ;rest
    2241    1966   0093B A971                           mov    r1,h1
    2242    1967   0093D                  
    2243    1968   0093D D076                           pop    h6                   ;registers herstellen
    2244    1969   0093F D075                           pop    h5
    2245    1970   00941 D074                           pop    h4
    2246    1971   00943 D073                           pop    h3
    2247    1972   00945 D072                           pop    h2
    2248    1973   00947 D071                           pop    h1
    2249    1974   00949 D070                           pop    h0
    2250    1975   0094B D0D0                           pop    psw
    2251    1976   0094D D0E0                           pop    acc
    2252    1977   0094F 22                             ret
    2253    1978   00950                  
    2254    1979   00950                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2255    1980   00950                  ;
    2256    1981   00950                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2257    1982   00950                  ;
    2258    1983   00950                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2259    1984   00950                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2260    1985   00950                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2261    1986   00950                  ;
    2262    1987   00950                  ; r4,r3,r2,r1,r0 worden aangepast
    2263    1988   00950                  ;
    2264    1989   00950                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2265    1990   00950                  
    2266    1991   00950 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2267    1992   00952 C0D0                           push   psw
    2268    1993   00954 E8                             mov    a,r0                 ;eerste 8 bit
    2269    1994   00955 2C                             add    a,r4
    2270    1995   00956 F8                             mov    r0,a                 ;klaar
    2271    1996   00957 E9                             mov    a,r1                 ;volgende 8 bit
    2272    1997   00958 3D                             addc   a,r5
    2273    1998   00959 F9                             mov    r1,a                 ;klaar
    2274    1999   0095A EA                             mov    a,r2                 ;volgende 8 bit
    2275    2000   0095B 3E                             addc   a,r6
    2276    2001   0095C FA                             mov    r2,a                 ;klaar
    2277    2002   0095D EB                             mov    a,r3                 ;laatste 8 bit
    2278    2003   0095E 3F                             addc   a,r7
    2279    2004   0095F FB                             mov    r3,a                 ;32 bit klaar
    2280    2005   00960 7400                           mov    a,#000h
    2281    2006   00962 3400                           addc   a,#000h              ;carry verrekenen
    2282    2007   00964 FC                             mov    r4,a
    2283    2008   00965 D0D0                           pop    psw                  ;registers herstellen
    2284    2009   00967 D0E0                           pop    acc
    2285    2010   00969 22                             ret
    2286    2011   0096A                  
    2287    2012   0096A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2288    2013   0096A                  ;
    2289    2014   0096A                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2290    2015   0096A                  ;
    2291    2016   0096A                  ; input:      r1,r0 = eerste getal (r1=msb)
    2292    2017   0096A                  ;             r3,r2 = tweede getal (r3=msb)
    2293    2018   0096A                  ; output:     r2,r1,r0 (r2=msb)
    2294    2019   0096A                  ;
    2295    2020   0096A                  ; r3,r2,r1,r0 worden aangepast
    2296    2021   0096A                  ;
    2297    2022   0096A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2298    2023   0096A                  
    2299    2024   0096A C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2300    2025   0096C C0D0                           push   psw
    2301    2026   0096E E8                             mov    a,r0                 ;starten met de optelling
    2302    2027   0096F 2A                             add    a,r2                 ;8 bit klaar
    2303    2028   00970 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2304    2029   00971 E9                             mov    a,r1                 ;volgende 8 bit
    2305    2030   00972 3B                             addc   a,r3                 ;16 bit klaar
    2306    2031   00973 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2307    2032   00974 7400                           mov    a,#000h              ;carry verrekenen
    2308    2033   00976 3400                           addc   a,#000h
    2309    2034   00978 FA                             mov    r2,a                 ;24 bit klaar
    2310    2035   00979 D0D0                           pop    psw                  ;registers herstellen
    2311    2036   0097B D0E0                           pop    acc
    2312    2037   0097D 22                             ret
    2313    2038   0097E                  
    2314    2039   0097E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2315    2040   0097E                  ;
    2316    2041   0097E                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2317    2042   0097E                  ;             40 bit groot. (eerste -tweede)
    2318    2043   0097E                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2319    2044   0097E                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2320    2045   0097E                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2321    2046   0097E                  ;
    2322    2047   0097E                  ; r4,r3,r2,r1,r0 worden aangepast
    2323    2048   0097E                  ;
    2324    2049   0097E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2325    2050   0097E                  
    2326    2051   0097E C0E0             sub32:        push   acc                  ;registers bewaren
    2327    2052   00980 C0D0                           push   psw                  ;ook de vlaggen
    2328    2053   00982 C3                             clr    c                    ;zit nog effe in de weg
    2329    2054   00983 E8                             mov    a,r0                 ;eerste 8 bit
    2330    2055   00984 9C                             subb   a,r4
    2331    2056   00985 F8                             mov    r0,a
    2332    2057   00986 E9                             mov    a,r1                 ;tweede 8 bit
    2333    2058   00987 9D                             subb   a,r5
    2334    2059   00988 F9                             mov    r1,a
    2335    2060   00989 EA                             mov    a,r2                 ;volgende 8 bit
    2336    2061   0098A 9E                             subb   a,r6
    2337    2062   0098B FA                             mov    r2,a
    2338    2063   0098C EB                             mov    a,r3                 ;laatste 8 bit
    2339    2064   0098D 9F                             subb   a,r7
    2340    2065   0098E FB                             mov    r3,a
    2341    2066   0098F 7400                           mov    a,#000h              ;nu nog de carry
    2342    2067   00991 9400                           subb   a,#000h
    2343    2068   00993 FC                             mov    r4,a                 ;40 bit klaar
    2344    2069   00994 D0D0                           pop    psw                  ;registers herstellen
    2345    2070   00996 D0E0                           pop    acc
    2346    2071   00998 22                             ret
    2347    2072   00999                  
    2348    2073   00999                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2349    2074   00999                  ;
    2350    2075   00999                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2351    2076   00999                  ;             24 bit groot. (eerste - tweede)
    2352    2077   00999                  ; input:      r1,r0 = eerste getal (r1=msb)
    2353    2078   00999                  ;             r3,r2 = tweede getal (r3=msb)
    2354    2079   00999                  ; output:     r2,r1,r0 (r2=msb)
    2355    2080   00999                  ;
    2356    2081   00999                  ; r3,r2,r1,r0 worden aangepast
    2357    2082   00999                  ;
    2358    2083   00999                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2359    2084   00999                  
    2360    2085   00999 C0E0             sub16:        push   acc                  ;registers bewaren
    2361    2086   0099B C0D0                           push   psw
    2362    2087   0099D C3                             clr    c                    ;mag nog niet meespelen
    2363    2088   0099E E8                             mov    a,r0                 ;eerste 8 bit verschil
    2364    2089   0099F 9A                             subb   a,r2
    2365    2090   009A0 F8                             mov    r0,a                 ;klaar
    2366    2091   009A1 E9                             mov    a,r1
    2367    2092   009A2 9B                             subb   a,r3                 ;16 bit klaar
    2368    2093   009A3 F9                             mov    r1,a
    2369    2094   009A4 7400                           mov    a,#000h
    2370    2095   009A6 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2371    2096   009A8 FA                             mov    r2,a                 ;24 bit klaar
    2372    2097   009A9 D0D0                           pop    psw                  ;registers herstellen
    2373    2098   009AB D0E0                           pop    acc
    2374    2099   009AD 22                             ret
    2375    2100   009AE                  
    2376    2101   009AE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2377    2102   009AE                  ;
    2378    2103   009AE                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2379    2104   009AE                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2380    2105   009AE                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2381    2106   009AE                  ;
    2382    2107   009AE                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2383    2108   009AE                  ;
    2384    2109   009AE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2385    2110   009AE                  
    2386    2111   009AE C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2387    2112   009B0 C0D0                           push   psw
    2388    2113   009B2                  
    2389    2114   009B2 C077                           push   h7                   ;nodig
    2390    2115   009B4 C078                           push   h8
    2391    2116   009B6                  
    2392    2117   009B6 C079                           push   h9                   ;ook
    2393    2118   009B8                  
    2394    2119   009B8 757905                         mov    h9,#005h             ;loopcounter
    2395    2120   009BB                  
    2396    2121   009BB 7B00             hexbcd161:    mov    r3,#000h
    2397    2122   009BD 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2398    2123   009BF 1208DD                         lcall  div16                ;deling uitvoeren
    2399    2124   009C2 E8                             mov    a,r0                 ;rest
    2400    2125   009C3 C0E0                           push   acc                  ;op stack zetten
    2401    2126   009C5 EA                             mov    a,r2
    2402    2127   009C6 F8                             mov    r0,a
    2403    2128   009C7 EB                             mov    a,r3
    2404    2129   009C8 F9                             mov    r1,a                 ;uitkomst terug delen
    2405    2130   009C9 D579EF                         djnz   h9,hexbcd161
    2406    2131   009CC                  
    2407    2132   009CC D0E0                           pop    acc                  ;hoogste bits van de stack
    2408    2133   009CE FA                             mov    r2,a                 ;klaar
    2409    2134   009CF D0E0                           pop    acc
    2410    2135   009D1 C4                             swap   a
    2411    2136   009D2 F579                           mov    h9,a
    2412    2137   009D4 D0E0                           pop    acc
    2413    2138   009D6 2579                           add    a,h9
    2414    2139   009D8 F9                             mov    r1,a                 ;volgende 8 klaar
    2415    2140   009D9 D0E0                           pop    acc
    2416    2141   009DB C4                             swap   a
    2417    2142   009DC F579                           mov    h9,a
    2418    2143   009DE D0E0                           pop    acc
    2419    2144   009E0 2579                           add    a,h9
    2420    2145   009E2 F8                             mov    r0,a                 ;klaar
    2421    2146   009E3                  
    2422    2147   009E3 D079                           pop    h9                   ;was naar de knoppen
    2423    2148   009E5                  
    2424    2149   009E5 D078                           pop    h8                   ;gebruikt
    2425    2150   009E7 D077                           pop    h7
    2426    2151   009E9                  
    2427    2152   009E9 D0D0                           pop    psw                  ;registers herstellen
    2428    2153   009EB D0E0                           pop    acc
    2429    2154   009ED 22                             ret
    2430    2155   009EE                  
    2431    2156   009EE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2432    2157   009EE                  ;
    2433    2158   009EE                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2434    2159   009EE                  ; input       a (maximale waarde = 63h)
    2435    2160   009EE                  ; output      a
    2436    2161   009EE                  ;
    2437    2162   009EE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2438    2163   009EE                  
    2439    2164   009EE C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2440    2165   009F0 C0F0                           push   b
    2441    2166   009F2 75F00A                         mov    b,#00ah              ;hierdoor delen
    2442    2167   009F5 84                             div    ab                   ;in accu qoutient in b rest
    2443    2168   009F6 C4                             swap   a
    2444    2169   009F7 25F0                           add    a,b                  ;bcd getal klaar
    2445    2170   009F9 D0F0                           pop    b
    2446    2171   009FB D0D0                           pop    psw
    2447    2172   009FD 22                             ret
    2448    2173   009FE                  
    2449    2174   009FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2450    2175   009FE                  ;
    2451    2176   009FE                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2452    2177   009FE                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2453    2178   009FE                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2454    2179   009FE                  ;
    2455    2180   009FE                  ; de routine gebruikt r1,r0 van de huidige bank
    2456    2181   009FE                  ;
    2457    2182   009FE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2458    2183   009FE                  
    2459    2184   009FE C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2460    2185   00A00 C0E0                           push   acc
    2461    2186   00A02 C0D0                           push   psw
    2462    2187   00A04                  
    2463    2188   00A04 E8                             mov    a,r0
    2464    2189   00A05 540F                           anl    a,#00fh              ;eenheden
    2465    2190   00A07 C0E0                           push   acc                  ;effe bewaren
    2466    2191   00A09                  
    2467    2192   00A09 E8                             mov    a,r0
    2468    2193   00A0A C4                             swap   a
    2469    2194   00A0B 540F                           anl    a,#00fh              ;tientallen
    2470    2195   00A0D 75F00A                         mov    b,#00ah              ;waarde berekenen
    2471    2196   00A10 A4                             mul    ab                   ;klaar
    2472    2197   00A11 D0F0                           pop    b                    ;truukje
    2473    2198   00A13 25F0                           add    a,b                  ;a is lage deel hex getal
    2474    2199   00A15 C0E0                           push   acc                  ;straks nodig
    2475    2200   00A17                  
    2476    2201   00A17 E9                             mov    a,r1                 ;hoge deel
    2477    2202   00A18 54F0                           anl    a,#0f0h
    2478    2203   00A1A C4                             swap   a
    2479    2204   00A1B C0E0                           push   acc                  ;straks nodig
    2480    2205   00A1D                  
    2481    2206   00A1D E9                             mov    a,r1
    2482    2207   00A1E 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2483    2208   00A20 75F064                         mov    b,#100               ;waarde uitrekenen
    2484    2209   00A23 A4                             mul    ab
    2485    2210   00A24 A9F0                           mov    r1,b
    2486    2211   00A26 F8                             mov    r0,a
    2487    2212   00A27                  
    2488    2213   00A27 D0E0                           pop    acc
    2489    2214   00A29 75F00A                         mov    b,#10
    2490    2215   00A2C A4                             mul    ab                   ;kan nog in a
    2491    2216   00A2D 75F064                         mov    b,#100               ;*10*100=*1000
    2492    2217   00A30 A4                             mul    ab
    2493    2218   00A31 28                             add    a,r0
    2494    2219   00A32 F8                             mov    r0,a
    2495    2220   00A33 E9                             mov    a,r1
    2496    2221   00A34 35F0                           addc   a,b
    2497    2222   00A36 F9                             mov    r1,a
    2498    2223   00A37                  
    2499    2224   00A37 D0E0                           pop    acc
    2500    2225   00A39 28                             add    a,r0
    2501    2226   00A3A F8                             mov    r0,a
    2502    2227   00A3B 7400                           mov    a,#000h
    2503    2228   00A3D 39                             addc   a,r1
    2504    2229   00A3E F9                             mov    r1,a                 ;klaar
    2505    2230   00A3F                  
    2506    2231   00A3F D0D0                           pop    psw
    2507    2232   00A41 D0E0                           pop    acc
    2508    2233   00A43 D0F0                           pop    b
    2509    2234   00A45 22                             ret
    2510    2235   00A46                  
    2511    2236   00A46                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2512    2237   00A46                  ;
    2513    2238   00A46                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2514    2239   00A46                  ; input:      a (maximale waarde 99h)
    2515    2240   00A46                  ; output:     a
    2516    2241   00A46                  ;
    2517    2242   00A46                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2518    2243   00A46                  
    2519    2244   00A46 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2520    2245   00A48 C0F0                           push   b
    2521    2246   00A4A C070                           push   h0
    2522    2247   00A4C F570                           mov    h0,a                 ;effe bewaren
    2523    2248   00A4E 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2524    2249   00A51 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2525    2250   00A53 C4                             swap   a
    2526    2251   00A54 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2527    2252   00A57 A4                             mul    ab
    2528    2253   00A58 2570                           add    a,h0                 ;eenheden bijtellen
    2529    2254   00A5A D070                           pop    h0
    2530    2255   00A5C D0F0                           pop    b
    2531    2256   00A5E D0D0                           pop    psw
    2532    2257   00A60 22                             ret
    2533    2258   00A61                  
    2534    2259   00A61                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2535    2260   00A61                  ;
    2536    2261   00A61                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2537    2262   00A61                  ;
    2538    2263   00A61                  ; Gebruikt geen registers
    2539    2264   00A61                  ;
    2540    2265   00A61                  ; Originele auteur: Danny Pawels (dp)
    2541    2266   00A61                  ;
    2542    2267   00A61                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2543    2268   00A61                  
    2544    2269   00A61                  
    2545    2270   00A61 C083             XCsw2xtal:  push  dph
    2546    2271   00A63 C082                         push  dpl
    2547    2272   00A65 C0D0                         push  psw
    2548    2273   00A67 C08F                         push  syscon0
    2549    2274   00A69 C0B2                         push  port_page
    2550    2275   00A6B C0BF                         push  scu_page
    2551    2276   00A6D                  
    2552    2277   00A6D 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2553    2278   00A70 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2554    2279   00A73                  
    2555    2280   00A73 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2556    2281   00A76                                                            ;freq= VCO-free running =5MHz...20MHz?
    2557    2282   00A76 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2558    2283   00A79 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2559    2284   00A7C 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2560    2285   00A7F                  
    2561    2286   00A7F 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2562    2287   00A82 A3               XCsw2xtal0: inc   dptr
    2563    2288   00A83 E582                         mov   a,dpl
    2564    2289   00A85 4583                         orl   a,dph
    2565    2290   00A87 70F9                         jnz   XCsw2xtal0
    2566    2291   00A89                  
    2567    2292   00A89 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2568    2293   00A8C                  
    2569    2294   00A8C                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2570    2295   00A8C E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2571    2296   00A8E 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2572    2297   00A91                  ;Oscillator run detectie is klaar...
    2573    2298   00A91 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2574    2299   00A94                  
    2575    2300   00A94                  
    2576    2301   00A94 E5B7                         mov   a,pll_con               ;lees pll_con
    2577    2302   00A96 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2578    2303   00A98 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2579    2304   00A9A                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2580    2305   00A9A                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2581    2306   00A9A                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2582    2307   00A9A 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2583    2308   00A9D                                                            ;bij aanpassing van de NDIV van de PLL
    2584    2309   00A9D F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2585    2310   00A9F 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2586    2311   00AA2 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2587    2312   00AA5                  
    2588    2313   00AA5 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2589    2314   00AA7 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2590    2315   00AAA                  
    2591    2316   00AAA 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2592    2317   00AAD 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2593    2318   00AB0                  
    2594    2319   00AB0 D0BF                         pop   scu_page                ;herstel controller status
    2595    2320   00AB2 D0B2                         pop   port_page
    2596    2321   00AB4 D08F                         pop   syscon0
    2597    2322   00AB6 D0D0                         pop   psw
    2598    2323   00AB8 D082                         pop   dpl
    2599    2324   00ABA D083                         pop   dph
    2600    2325   00ABC 22                           ret
    2601    2326   00ABD                  
    2602    2327   00ABD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2603    2328   00ABD                  ;
    2604    2329   00ABD                  ; mapregs	selecteer de SFR's in de mapped area
    2605    2330   00ABD                  ;
    2606    2331   00ABD                  ;
    2607    2332   00ABD                  ; Past syscon SFR aan
    2608    2333   00ABD                  ;
    2609    2334   00ABD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2610    2335   00ABD                  
    2611    2336   00ABD 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2612    2337   00AC0 22               		ret
    2613    2338   00AC1                  
    2614    2339   00AC1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2615    2340   00AC1                  ;
    2616    2341   00AC1                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2617    2342   00AC1                  ;
    2618    2343   00AC1                  ; Past syscon SFR aan
    2619    2344   00AC1                  ;
    2620    2345   00AC1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2621    2346   00AC1                  
    2622    2347   00AC1 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2623    2348   00AC4 22               		ret
    2624    2349   00AC5                  
    2625    2350   00AC5                  ;*******************************************************************************
    2626    2351   00AC5                  ;
    2627    2352   00AC5                  ; These are the register declarations for the XC888 microcontroller from
    2628    2353   00AC5                  ; Infineon.
    2629    2354   00AC5                  ;
    2630    2355   00AC5                  ;*******************************************************************************
    2631    2356   00AC5                  
    2632    2357   00AC5                  ;*******************************************************************************
    2633    2358   00AC5                  ;
    2634    2359   00AC5                  ; CPU registers are accessible independend of paging and mapping
    2635    2360   00AC5                  ; (always accessible)
    2636    2361   00AC5                  ;
    2637    2362   00AC5                  ;*******************************************************************************
    2638    2363   00AC5                  
    2639    2364   00AC5                  sp            data   081h          ;stack pointer                     reset=007h
    2640    2365   00AC5                  dpl           data   082h          ;datapointer low register          reset=000h
    2641    2366   00AC5                  dph           data   083h          ;datapointer high register         reset=000h
    2642    2367   00AC5                  pcon          data   087h          ;power control                     reset=000h
    2643    2368   00AC5                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2644    2369   00AC5                  ;tcon is bit addressable
    2645    2370   00AC5                         tf1    bit    08fh
    2646    2371   00AC5                         tr1    bit    08eh
    2647    2372   00AC5                         tf0    bit    08dh
    2648    2373   00AC5                         tr0    bit    08ch
    2649    2374   00AC5                         ie1    bit    08bh
    2650    2375   00AC5                         it1    bit    08ah
    2651    2376   00AC5                         ie0    bit    089h
    2652    2377   00AC5                         it0    bit    088h
    2653    2378   00AC5                  
    2654    2379   00AC5                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2655    2380   00AC5                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2656    2381   00AC5                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2657    2382   00AC5                  th0           data   08ch          ;timer 0 high                      reset=000h
    2658    2383   00AC5                  th1           data   08dh          ;timer 1 high                      reset=000h
    2659    2384   00AC5                  
    2660    2385   00AC5                  syscon0       data   08fh          ;system control register 0         reset=004h
    2661    2386   00AC5                  scon          data   098h          ;serial channel 0 control          reset=000h
    2662    2387   00AC5                  ;scon is bit addressable
    2663    2388   00AC5                         sm0    bit    09fh
    2664    2389   00AC5                         sm1    bit    09eh
    2665    2390   00AC5                         sm2    bit    09dh
    2666    2391   00AC5                         ren    bit    09ch
    2667    2392   00AC5                         tb8    bit    09bh
    2668    2393   00AC5                         rb8    bit    09ah
    2669    2394   00AC5                         ti     bit    099h
    2670    2395   00AC5                         ri     bit    098h
    2671    2396   00AC5                  
    2672    2397   00AC5                  sbuf          data   099h          ;serial data buffer channel 0
    2673    2398   00AC5                  eo            data   0a2h          ;extended operation                reset=000h
    2674    2399   00AC5                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2675    2400   00AC5                  ;ien0 is bit addressable
    2676    2401   00AC5                         ea     bit    0afh
    2677    2402   00AC5                                                     ;bit not implemented
    2678    2403   00AC5                         et2    bit    0adh
    2679    2404   00AC5                         es     bit    0ach
    2680    2405   00AC5                         et1    bit    0abh
    2681    2406   00AC5                         ex1    bit    0aah
    2682    2407   00AC5                         et0    bit    0a9h
    2683    2408   00AC5                         ex0    bit    0a8h
    2684    2409   00AC5                  
    2685    2410   00AC5                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2686    2411   00AC5                  ;ip is bit addressable
    2687    2412   00AC5                                                     ;bit not implemented
    2688    2413   00AC5                                                     ;bit not implemented
    2689    2414   00AC5                         pt2    bit    0bdh
    2690    2415   00AC5                         ps     bit    0bch
    2691    2416   00AC5                         pt1    bit    0bbh
    2692    2417   00AC5                         px1    bit    0bah
    2693    2418   00AC5                         pt0    bit    0b9h
    2694    2419   00AC5                         px0    bit    0b8h
    2695    2420   00AC5                  
    2696    2421   00AC5                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2697    2422   00AC5                  psw           data   0d0h          ;program status word               reset=000h
    2698    2423   00AC5                  ;psw is bit addressable
    2699    2424   00AC5                         cy     bit    0d7h
    2700    2425   00AC5                         ac     bit    0d6h
    2701    2426   00AC5                         f0     bit    0d5h
    2702    2427   00AC5                         rs1    bit    0d4h
    2703    2428   00AC5                         rs0    bit    0d3h
    2704    2429   00AC5                         ov     bit    0d2h
    2705    2430   00AC5                         f1     bit    0d1h
    2706    2431   00AC5                         p      bit    0d0h
    2707    2432   00AC5                  
    2708    2433   00AC5                  acc           data   0e0h          ;accumulator                       reset=000h
    2709    2434   00AC5                  ;acc is bit addressable
    2710    2435   00AC5                  
    2711    2436   00AC5                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2712    2437   00AC5                  ;ien1 is bit addressable
    2713    2438   00AC5                         eccip3 bit    0efh
    2714    2439   00AC5                         eccip2 bit    0eeh
    2715    2440   00AC5                         eccip1 bit    0edh
    2716    2441   00AC5                         eccip0 bit    0ech
    2717    2442   00AC5                         exm    bit    0ebh
    2718    2443   00AC5                         ex2    bit    0eah
    2719    2444   00AC5                         essc   bit    0e9h
    2720    2445   00AC5                         eadc   bit    0e8h
    2721    2446   00AC5                  
    2722    2447   00AC5                  b             data   0f0h          ;b register                        reset=000h
    2723    2448   00AC5                  ;b is bit addressable
    2724    2449   00AC5                  
    2725    2450   00AC5                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2726    2451   00AC5                  ;ip1 is bit addressable
    2727    2452   00AC5                         pccip3 bit    0ffh
    2728    2453   00AC5                         pccip2 bit    0feh
    2729    2454   00AC5                         pccip1 bit    0fdh
    2730    2455   00AC5                         pccip0 bit    0fch
    2731    2456   00AC5                         pxm    bit    0fbh
    2732    2457   00AC5                         px2    bit    0fah
    2733    2458   00AC5                         pssc   bit    0f9h
    2734    2459   00AC5                         padc   bit    0f8h
    2735    2460   00AC5                  
    2736    2461   00AC5                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2737    2462   00AC5                  
    2738    2463   00AC5                  
    2739    2464   00AC5                  ;*******************************************************************************
    2740    2465   00AC5                  ;
    2741    2466   00AC5                  ; system control registers registers that can only be accessed in the non
    2742    2467   00AC5                  ; mapped memory area (rmap=0) page independent
    2743    2468   00AC5                  ;
    2744    2469   00AC5                  ;*******************************************************************************
    2745    2470   00AC5                  
    2746    2471   00AC5                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2747    2472   00AC5                  
    2748    2473   00AC5                  ;*******************************************************************************
    2749    2474   00AC5                  ;
    2750    2475   00AC5                  ; system control registers registers that can only be accessed in the non
    2751    2476   00AC5                  ; mapped memory area (rmap=0) and page 0
    2752    2477   00AC5                  ;
    2753    2478   00AC5                  ;*******************************************************************************
    2754    2479   00AC5                  
    2755    2480   00AC5                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2756    2481   00AC5                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2757    2482   00AC5                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2758    2483   00AC5                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2759    2484   00AC5                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2760    2485   00AC5                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2761    2486   00AC5                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2762    2487   00AC5                  nmisr         data   0bch          ;nmi status                        reset=000h
    2763    2488   00AC5                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2764    2489   00AC5                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2765    2490   00AC5                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2766    2491   00AC5                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2767    2492   00AC5                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2768    2493   00AC5                  
    2769    2494   00AC5                  ;*******************************************************************************
    2770    2495   00AC5                  ;
    2771    2496   00AC5                  ; system control registers registers that can only be accessed in the non
    2772    2497   00AC5                  ; mapped memory area (rmap=0) and page 1
    2773    2498   00AC5                  ;
    2774    2499   00AC5                  ;*******************************************************************************
    2775    2500   00AC5                  
    2776    2501   00AC5                  id            data   0b3h          ;identity register     reset=device dependent
    2777    2502   00AC5                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2778    2503   00AC5                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2779    2504   00AC5                  osc_con       data   0b6h          ;osc control                       reset=008h
    2780    2505   00AC5                  pll_con       data   0b7h          ;pll control                       reset=090h
    2781    2506   00AC5                  cmcon         data   0bah          ;clock control                     reset=010h
    2782    2507   00AC5                  passwd        data   0bbh          ;password register                 reset=007h
    2783    2508   00AC5                  feal          data   0bch          ;flash error register              reset=000h
    2784    2509   00AC5                  feah          data   0bdh          ;flash error address high          reset=000h
    2785    2510   00AC5                  cocon         data   0beh          ;clock output control              reset=000h
    2786    2511   00AC5                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2787    2512   00AC5                  
    2788    2513   00AC5                  ;*******************************************************************************
    2789    2514   00AC5                  ;
    2790    2515   00AC5                  ; system control registers registers that can only be accessed in the non
    2791    2516   00AC5                  ; mapped memory area (rmap=0) and page 3
    2792    2517   00AC5                  ;
    2793    2518   00AC5                  ;*******************************************************************************
    2794    2519   00AC5                  
    2795    2520   00AC5                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2796    2521   00AC5                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2797    2522   00AC5                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2798    2523   00AC5                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2799    2524   00AC5                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2800    2525   00AC5                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2801    2526   00AC5                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2802    2527   00AC5                  
    2803    2528   00AC5                  ;*******************************************************************************
    2804    2529   00AC5                  ;
    2805    2530   00AC5                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2806    2531   00AC5                  ;
    2807    2532   00AC5                  ;*******************************************************************************
    2808    2533   00AC5                  
    2809    2534   00AC5                  port_page     data   0b2h          ;port page register                reset=000h
    2810    2535   00AC5                  
    2811    2536   00AC5                  ;*******************************************************************************
    2812    2537   00AC5                  ;
    2813    2538   00AC5                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2814    2539   00AC5                  ;
    2815    2540   00AC5                  ;*******************************************************************************
    2816    2541   00AC5                  
    2817    2542   00AC5                  p0_data       data   080h          ;port 0 data register              reset=000h
    2818    2543   00AC5                  ;p0_data is bit addressable
    2819    2544   00AC5                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2820    2545   00AC5                  p1_data       data   090h          ;port 1 data register              reset=000h
    2821    2546   00AC5                  ;p1_data is bit addressable
    2822    2547   00AC5                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2823    2548   00AC5                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2824    2549   00AC5                  ;p2_data is bit addressable
    2825    2550   00AC5                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2826    2551   00AC5                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2827    2552   00AC5                  ;p3_data is bit addressable
    2828    2553   00AC5                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2829    2554   00AC5                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2830    2555   00AC5                  ;p4_data is bit addressable
    2831    2556   00AC5                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2832    2557   00AC5                  p5_data       data   092h          ;port 5 data register              reset=000h
    2833    2558   00AC5                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2834    2559   00AC5                  
    2835    2560   00AC5                  ;*******************************************************************************
    2836    2561   00AC5                  ;
    2837    2562   00AC5                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2838    2563   00AC5                  ;
    2839    2564   00AC5                  ;*******************************************************************************
    2840    2565   00AC5                  
    2841    2566   00AC5                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2842    2567   00AC5                  ;p0_data is bit addressable
    2843    2568   00AC5                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2844    2569   00AC5                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2845    2570   00AC5                  ;p1_data is bit addressable
    2846    2571   00AC5                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2847    2572   00AC5                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2848    2573   00AC5                  ;p2_data is bit addressable
    2849    2574   00AC5                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2850    2575   00AC5                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2851    2576   00AC5                  ;p3_data is bit addressable
    2852    2577   00AC5                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2853    2578   00AC5                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2854    2579   00AC5                  ;p4_data is bit addressable
    2855    2580   00AC5                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2856    2581   00AC5                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2857    2582   00AC5                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2858    2583   00AC5                  
    2859    2584   00AC5                  ;*******************************************************************************
    2860    2585   00AC5                  ;
    2861    2586   00AC5                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2862    2587   00AC5                  ;
    2863    2588   00AC5                  ;*******************************************************************************
    2864    2589   00AC5                  
    2865    2590   00AC5                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2866    2591   00AC5                  ;p0_data is bit addressable
    2867    2592   00AC5                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2868    2593   00AC5                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2869    2594   00AC5                  ;p1_data is bit addressable
    2870    2595   00AC5                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2871    2596   00AC5                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2872    2597   00AC5                  ;p3_data is bit addressable
    2873    2598   00AC5                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2874    2599   00AC5                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2875    2600   00AC5                  ;p4_data is bit addressable
    2876    2601   00AC5                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2877    2602   00AC5                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2878    2603   00AC5                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2879    2604   00AC5                  
    2880    2605   00AC5                  ;*******************************************************************************
    2881    2606   00AC5                  ;
    2882    2607   00AC5                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2883    2608   00AC5                  ;
    2884    2609   00AC5                  ;*******************************************************************************
    2885    2610   00AC5                  
    2886    2611   00AC5                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2887    2612   00AC5                  ;p0_data is bit addressable
    2888    2613   00AC5                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2889    2614   00AC5                  ;p1_data is bit addressable
    2890    2615   00AC5                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2891    2616   00AC5                  ;p3_data is bit addressable
    2892    2617   00AC5                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2893    2618   00AC5                  ;p4_data is bit addressable
    2894    2619   00AC5                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2895    2620   00AC5                  
    2896    2621   00AC5                  ;*******************************************************************************
    2897    2622   00AC5                  ;
    2898    2623   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2899    2624   00AC5                  ;
    2900    2625   00AC5                  ;*******************************************************************************
    2901    2626   00AC5                  
    2902    2627   00AC5                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2903    2628   00AC5                  
    2904    2629   00AC5                  ;*******************************************************************************
    2905    2630   00AC5                  ;
    2906    2631   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2907    2632   00AC5                  ;
    2908    2633   00AC5                  ;*******************************************************************************
    2909    2634   00AC5                  
    2910    2635   00AC5                  adc_globctr   data   0cah          ;global control register           reset=030h
    2911    2636   00AC5                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2912    2637   00AC5                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2913    2638   00AC5                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2914    2639   00AC5                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2915    2640   00AC5                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2916    2641   00AC5                  
    2917    2642   00AC5                  ;*******************************************************************************
    2918    2643   00AC5                  ;
    2919    2644   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2920    2645   00AC5                  ;
    2921    2646   00AC5                  ;*******************************************************************************
    2922    2647   00AC5                  
    2923    2648   00AC5                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2924    2649   00AC5                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2925    2650   00AC5                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2926    2651   00AC5                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2927    2652   00AC5                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2928    2653   00AC5                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2929    2654   00AC5                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2930    2655   00AC5                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2931    2656   00AC5                  
    2932    2657   00AC5                  ;*******************************************************************************
    2933    2658   00AC5                  ;
    2934    2659   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2935    2660   00AC5                  ;
    2936    2661   00AC5                  ;*******************************************************************************
    2937    2662   00AC5                  
    2938    2663   00AC5                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2939    2664   00AC5                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2940    2665   00AC5                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2941    2666   00AC5                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2942    2667   00AC5                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2943    2668   00AC5                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2944    2669   00AC5                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2945    2670   00AC5                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2946    2671   00AC5                  
    2947    2672   00AC5                  ;*******************************************************************************
    2948    2673   00AC5                  ;
    2949    2674   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2950    2675   00AC5                  ;
    2951    2676   00AC5                  ;*******************************************************************************
    2952    2677   00AC5                  
    2953    2678   00AC5                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2954    2679   00AC5                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2955    2680   00AC5                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2956    2681   00AC5                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2957    2682   00AC5                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2958    2683   00AC5                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2959    2684   00AC5                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2960    2685   00AC5                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2961    2686   00AC5                  
    2962    2687   00AC5                  ;*******************************************************************************
    2963    2688   00AC5                  ;
    2964    2689   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2965    2690   00AC5                  ;
    2966    2691   00AC5                  ;*******************************************************************************
    2967    2692   00AC5                  
    2968    2693   00AC5                  adc_rcr0      data   0cah          ;result control register           reset=000h
    2969    2694   00AC5                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    2970    2695   00AC5                  adc_rcr2      data   0cch          ;result control register           reset=000h
    2971    2696   00AC5                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    2972    2697   00AC5                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    2973    2698   00AC5                  
    2974    2699   00AC5                  ;*******************************************************************************
    2975    2700   00AC5                  ;
    2976    2701   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    2977    2702   00AC5                  ;
    2978    2703   00AC5                  ;*******************************************************************************
    2979    2704   00AC5                  
    2980    2705   00AC5                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    2981    2706   00AC5                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    2982    2707   00AC5                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    2983    2708   00AC5                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    2984    2709   00AC5                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    2985    2710   00AC5                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    2986    2711   00AC5                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    2987    2712   00AC5                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    2988    2713   00AC5                  
    2989    2714   00AC5                  ;*******************************************************************************
    2990    2715   00AC5                  ;
    2991    2716   00AC5                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    2992    2717   00AC5                  ;
    2993    2718   00AC5                  ;*******************************************************************************
    2994    2719   00AC5                  
    2995    2720   00AC5                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    2996    2721   00AC5                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    2997    2722   00AC5                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    2998    2723   00AC5                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    2999    2724   00AC5                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3000    2725   00AC5                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3001    2726   00AC5                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3002    2727   00AC5                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3003    2728   00AC5                  
    3004    2729   00AC5                  ;*******************************************************************************
    3005    2730   00AC5                  
    3006    2731   00AC5                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3007    2732   00AC5                  ;
    3008    2733   00AC5                  ;*******************************************************************************
    3009    2734   00AC5                  
    3010    2735   00AC5                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3011    2736   00AC5                  ;t2_t2con is bit addressable
    3012    2737   00AC5                         tf2    bit    0c7h
    3013    2738   00AC5                         exf2   bit    0c6h
    3014    2739   00AC5                                                     ;2 bits are not implemented
    3015    2740   00AC5                         exen2  bit    0c3h
    3016    2741   00AC5                         tr2    bit    0c2h
    3017    2742   00AC5                         ct2    bit    0c1h
    3018    2743   00AC5                         cprl2  bit    0c0h
    3019    2744   00AC5                  
    3020    2745   00AC5                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3021    2746   00AC5                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3022    2747   00AC5                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3023    2748   00AC5                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3024    2749   00AC5                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3025    2750   00AC5                  
    3026    2751   00AC5                  ;*******************************************************************************
    3027    2752   00AC5                  ;
    3028    2753   00AC5                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3029    2754   00AC5                  ;
    3030    2755   00AC5                  ;*******************************************************************************
    3031    2756   00AC5                  
    3032    2757   00AC5                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3033    2758   00AC5                  
    3034    2759   00AC5                  ;*******************************************************************************
    3035    2760   00AC5                  ;
    3036    2761   00AC5                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3037    2762   00AC5                  ;
    3038    2763   00AC5                  ;*******************************************************************************
    3039    2764   00AC5                  
    3040    2765   00AC5                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3041    2766   00AC5                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3042    2767   00AC5                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3043    2768   00AC5                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3044    2769   00AC5                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3045    2770   00AC5                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3046    2771   00AC5                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3047    2772   00AC5                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3048    2773   00AC5                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3049    2774   00AC5                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3050    2775   00AC5                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3051    2776   00AC5                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3052    2777   00AC5                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3053    2778   00AC5                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3054    2779   00AC5                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3055    2780   00AC5                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3056    2781   00AC5                  
    3057    2782   00AC5                  ;*******************************************************************************
    3058    2783   00AC5                  ;
    3059    2784   00AC5                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3060    2785   00AC5                  ;
    3061    2786   00AC5                  ;*******************************************************************************
    3062    2787   00AC5                  
    3063    2788   00AC5                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3064    2789   00AC5                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3065    2790   00AC5                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3066    2791   00AC5                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3067    2792   00AC5                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3068    2793   00AC5                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3069    2794   00AC5                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3070    2795   00AC5                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3071    2796   00AC5                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3072    2797   00AC5                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3073    2798   00AC5                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3074    2799   00AC5                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3075    2800   00AC5                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3076    2801   00AC5                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3077    2802   00AC5                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3078    2803   00AC5                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3079    2804   00AC5                  
    3080    2805   00AC5                  ;*******************************************************************************
    3081    2806   00AC5                  ;
    3082    2807   00AC5                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3083    2808   00AC5                  ;
    3084    2809   00AC5                  ;*******************************************************************************
    3085    2810   00AC5                  
    3086    2811   00AC5                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3087    2812   00AC5                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3088    2813   00AC5                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3089    2814   00AC5                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3090    2815   00AC5                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3091    2816   00AC5                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3092    2817   00AC5                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3093    2818   00AC5                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3094    2819   00AC5                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3095    2820   00AC5                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3096    2821   00AC5                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3097    2822   00AC5                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3098    2823   00AC5                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3099    2824   00AC5                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3100    2825   00AC5                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3101    2826   00AC5                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3102    2827   00AC5                  
    3103    2828   00AC5                  ;*******************************************************************************
    3104    2829   00AC5                  ;
    3105    2830   00AC5                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3106    2831   00AC5                  ;
    3107    2832   00AC5                  ;*******************************************************************************
    3108    2833   00AC5                  
    3109    2834   00AC5                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3110    2835   00AC5                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3111    2836   00AC5                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3112    2837   00AC5                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3113    2838   00AC5                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3114    2839   00AC5                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3115    2840   00AC5                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3116    2841   00AC5                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3117    2842   00AC5                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3118    2843   00AC5                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3119    2844   00AC5                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3120    2845   00AC5                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3121    2846   00AC5                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3122    2847   00AC5                  
    3123    2848   00AC5                  ;*******************************************************************************
    3124    2849   00AC5                  ;
    3125    2850   00AC5                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3126    2851   00AC5                  ;
    3127    2852   00AC5                  ;*******************************************************************************
    3128    2853   00AC5                  
    3129    2854   00AC5                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3130    2855   00AC5                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3131    2856   00AC5                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3132    2857   00AC5                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3133    2858   00AC5                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3134    2859   00AC5                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3135    2860   00AC5                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3136    2861   00AC5                  
    3137    2862   00AC5                  ;*******************************************************************************
    3138    2863   00AC5                  ;
    3139    2864   00AC5                  ; can registers can be accessed in the standard memory map (rmap=0)
    3140    2865   00AC5                  ;
    3141    2866   00AC5                  ;*******************************************************************************
    3142    2867   00AC5                  
    3143    2868   00AC5                  adcon         data   0d8h          ;adres/data control                reset=000h
    3144    2869   00AC5                  ; adcon is bit addressable
    3145    2870   00AC5                         v3     bit    0dfh
    3146    2871   00AC5                         v2     bit    0deh
    3147    2872   00AC5                         v1     bit    0ddh
    3148    2873   00AC5                         v0     bit    0dch
    3149    2874   00AC5                         auad1  bit    0dbh
    3150    2875   00AC5                         auad0  bit    0dah
    3151    2876   00AC5                         can_bsy bit   0d9h
    3152    2877   00AC5                         rwen   bit    0d8h
    3153    2878   00AC5                  
    3154    2879   00AC5                  adl           data   0d9h          ;adres register low                reset=000h
    3155    2880   00AC5                  adh           data   0dah          ;adres register low                reset=000h
    3156    2881   00AC5                  data0         data   0dbh          ;can data                          reset=000h
    3157    2882   00AC5                  data1         data   0dch          ;can data                          reset=000h
    3158    2883   00AC5                  data2         data   0ddh          ;can data                          reset=000h
    3159    2884   00AC5                  data3         data   0deh          ;can data                          reset=000h
    3160    2885   00AC5                  
    3161    2886   00AC5                  ;*******************************************************************************
    3162    2887   00AC5                  ;
    3163    2888   00AC5                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3164    2889   00AC5                  ;
    3165    2890   00AC5                  ;*******************************************************************************
    3166    2891   00AC5                  
    3167    2892   00AC5                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3168    2893   00AC5                  ;mdustat is bit addressable
    3169    2894   00AC5                                                     ;5 bits are not implemented
    3170    2895   00AC5                         bsy    bit    0b2h
    3171    2896   00AC5                         ierr   bit    0b1h
    3172    2897   00AC5                         irdy   bit    0b0h
    3173    2898   00AC5                  
    3174    2899   00AC5                  mducon        data   0b1h          ;mdu control                       reset=000h
    3175    2900   00AC5                  md0           data   0b2h          ;mdu operand register              reset=000h
    3176    2901   00AC5                  mr0           data   0b2h          ;mdu result register               reset=000h
    3177    2902   00AC5                  md1           data   0b3h          ;mdu operand register              reset=000h
    3178    2903   00AC5                  mr1           data   0b3h          ;mdu result register               reset=000h
    3179    2904   00AC5                  md2           data   0b4h          ;mdu operand register              reset=000h
    3180    2905   00AC5                  mr2           data   0b4h          ;mdu result register               reset=000h
    3181    2906   00AC5                  md3           data   0b5h          ;mdu operand register              reset=000h
    3182    2907   00AC5                  mr3           data   0b5h          ;mdu result register               reset=000h
    3183    2908   00AC5                  md4           data   0b6h          ;mdu operand register              reset=000h
    3184    2909   00AC5                  mr4           data   0b6h          ;mdu result register               reset=000h
    3185    2910   00AC5                  md5           data   0b7h          ;mdu operand register              reset=000h
    3186    2911   00AC5                  mr5           data   0b7h          ;mdu result register               reset=000h
    3187    2912   00AC5                  
    3188    2913   00AC5                  ;*******************************************************************************
    3189    2914   00AC5                  ;
    3190    2915   00AC5                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3191    2916   00AC5                  ;
    3192    2917   00AC5                  ;*******************************************************************************
    3193    2918   00AC5                  
    3194    2919   00AC5                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3195    2920   00AC5                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3196    2921   00AC5                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3197    2922   00AC5                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3198    2923   00AC5                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3199    2924   00AC5                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3200    2925   00AC5                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3201    2926   00AC5                  ;cd_statc is bit addressable
    3202    2927   00AC5                         keepz  bit    0a7h
    3203    2928   00AC5                         keepy  bit    0a6h
    3204    2929   00AC5                         keepx  bit    0a5h
    3205    2930   00AC5                         dmap   bit    0a4h
    3206    2931   00AC5                         int_en bit    0a3h
    3207    2932   00AC5                         eoc    bit    0a2h
    3208    2933   00AC5                         error  bit    0a1h
    3209    2934   00AC5                         cd_bsy bit    0a0h
    3210    2935   00AC5                  
    3211    2936   00AC5                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3212    2937   00AC5                  
    3213    2938   00AC5                  ;*******************************************************************************
    3214    2939   00AC5                  ;
    3215    2940   00AC5                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3216    2941   00AC5                  ;
    3217    2942   00AC5                  ;*******************************************************************************
    3218    2943   00AC5                  
    3219    2944   00AC5                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3220    2945   00AC5                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3221    2946   00AC5                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3222    2947   00AC5                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3223    2948   00AC5                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3224    2949   00AC5                  
    3225    2950   00AC5                  ;*******************************************************************************
    3226    2951   00AC5                  ;
    3227    2952   00AC5                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3228    2953   00AC5                  ;
    3229    2954   00AC5                  ;*******************************************************************************
    3230    2955   00AC5                  
    3231    2956   00AC5                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3232    2957   00AC5                  ;t2_t2con is bit addressable bits are aalready defined
    3233    2958   00AC5                         ;tf2    bit    0c7h
    3234    2959   00AC5                         ;exf2   bit    0c6h
    3235    2960   00AC5                                                     ;2 bits are not implemented
    3236    2961   00AC5                         ;exen2  bit    0c3h
    3237    2962   00AC5                         ;tr2    bit    0c2h
    3238    2963   00AC5                         ;ct2    bit    0c1h
    3239    2964   00AC5                         ;cprl2  bit    0c0h
    3240    2965   00AC5                  
    3241    2966   00AC5                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3242    2967   00AC5                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3243    2968   00AC5                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3244    2969   00AC5                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3245    2970   00AC5                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3246    2971   00AC5                  
    3247    2972   00AC5                  ;*******************************************************************************
    3248    2973   00AC5                  ;
    3249    2974   00AC5                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3250    2975   00AC5                  ;
    3251    2976   00AC5                  ;*******************************************************************************
    3252    2977   00AC5                  
    3253    2978   00AC5                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3254    2979   00AC5                  ;s1con is bit addressable
    3255    2980   00AC5                         sm01   bit    0cfh
    3256    2981   00AC5                         sm11   bit    0ceh
    3257    2982   00AC5                         sm21   bit    0cdh
    3258    2983   00AC5                         ren1   bit    0cch
    3259    2984   00AC5                         tb81   bit    0cbh
    3260    2985   00AC5                         rb81   bit    0cah
    3261    2986   00AC5                         ti1    bit    0c9h
    3262    2987   00AC5                         ri1    bit    0c8h
    3263    2988   00AC5                  
    3264    2989   00AC5                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3265    2990   00AC5                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3266    2991   00AC5                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3267    2992   00AC5                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3268    2993   00AC5                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3269    2994   00AC5                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3270    2995   00AC5                  
    3271    2996   00AC5                  ;*******************************************************************************
    3272    2997   00AC5                  ;
    3273    2998   00AC5                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3274    2999   00AC5                  ;
    3275    3000   00AC5                  ;*******************************************************************************
    3276    3001   00AC5                  
    3277    3002   00AC5                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3278    3003   00AC5                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3279    3004   00AC5                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3280    3005   00AC5                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3281    3006   00AC5                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3282    3007   00AC5                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3283    3008   00AC5                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3284    3009   00AC5                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3285    3010   00AC5                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3286    3011   00AC5                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3287    3012   00AC5                  
    3288    3013   00AC5                  ;end directive must be used, but has no signification
    3289    3014   00AC5                  
    3290    3015   00AC5                  end
    3291    3016   00AC5                  
    3292    3017   00AC5                  
    3293    3018   00AC5                  
    3294    3019   00AC5                  
    3295    3020   00AC5                  
    3296    3021   00AC5                  
    3297    3022   00AC5                  
    3298    3023   00AC5                  
    3299    3024   00AC5                  
    3300    3025   00AC5                  
    3301    3026   00AC5                  
    3302    3027   00AC5                  
    3303    3028   00AC5                  
    3304    3029   00AC5                  
    3305    3030   00AC5                  
    3306    3031   00AC5                  
