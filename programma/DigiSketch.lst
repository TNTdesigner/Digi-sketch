I:\Bibliotheken\Documents\GitHub\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  org 0000h
       2       2   00000                  
       3       3   00000                  
       4       4   00000                  
       5       5   00000                  ;------------------------------------------------------------------
       6       6   00000                  ;Hoofd programma
       7       7   00000                  ;------------------------------------------------------------------
       8       8   00000                  main:
       9       9   00000 75817F               mov     sp,#7fh                 ;stackpointer instellen
      10      10   00003 1201B9               lcall   initftoetsen
      11      11   00006 120066               lcall   inits
      12      12   00009                  
      13      13   00009 751100               mov     DATAREG,#00h            ;adres pointer voor tekst instellen
      14      14   0000C 120146               lcall   zendData
      15      15   0000F 751100               mov     DATAREG,#00h
      16      16   00012 120146               lcall   zendData
      17      17   00015 751224               mov     COMANDREG,#24h
      18      18   00018 120166               lcall   zendComando
      19      19   0001B                  
      20      20   0001B 751124               mov     DATAREG,#24h
      21      21   0001E 120146               lcall   zendData
      22      22   00021 7512C0               mov     COMANDREG,#c0h
      23      23   00024 120166               lcall   zendComando
      24      24   00027                  
      25      25   00027 75129C               mov     COMANDREG,#9ch
      26      26   0002A 120166               lcall   zendComando
      27      27   0002D                  lus2:
      28      28   0002D 751124               mov     DATAREG,#24h
      29      29   00030 120146               lcall   zendData
      30      30   00033 7512C0               mov     COMANDREG,#c0h
      31      31   00036 120166               lcall   zendComando
      32      32   00039                  
      33      33   00039                  
      34      34   00039 751124               mov     DATAREG,#24h
      35      35   0003C 120146               lcall   zendData
      36      36   0003F 7512C0               mov     COMANDREG,#c0h
      37      37   00042 120166               lcall   zendComando
      38      38   00045                  
      39      39   00045                  
      40      40   00045 751124               mov     DATAREG,#24h
      41      41   00048 120146               lcall   zendData
      42      42   0004B 7512C0               mov     COMANDREG,#c0h
      43      43   0004E 120166               lcall   zendComando
      44      44   00051                  
      45      45   00051                  
      46      46   00051 751124               mov     DATAREG,#24h
      47      47   00054 120146               lcall   zendData
      48      48   00057 7512C0               mov     COMANDREG,#c0h
      49      49   0005A 120166               lcall   zendComando
      50      50   0005D                  
      51      51   0005D 75129C               mov     COMANDREG,#9ch
      52      52   00060 120166               lcall   zendComando
      53      53   00063 02002D               ljmp    lus2
      54      54   00066                  
      55      55   00066                  
      56      56   00066                  
      57      57   00066                  ;------------------------------------------------------------------
      58      58   00066                  ;Initializatie van alle componenten nodig in het hoofd programma
      59      59   00066                  ;------------------------------------------------------------------
      60      60   00066                  inits:
      61      61   00066 120099               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      62      62   00069 22               ret
      63      63   0006A                  
      64      64   0006A                  
      65      65   0006A                  
      66      66   0006A                  
      67      67   0006A                  
project.inc 
      69       1   0006A                  ;------------------------------------------------------------------
      70       2   0006A                  ;Lijst van functies:
      71       3   0006A                  ;   -statusCheck            Status check van scherm opslaan in STA register
      72       4   0006A                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      73       5   0006A                  ;   -P1out                  Initializatie poort 1 als output
      74       6   0006A                  ;   -P3in                   Initializatie poort 3 als output
      75       7   0006A                  ;   -P3out                  Initializatie poort 3 als input
      76       8   0006A                  ;   -zendData               Data verzeden naar scherm
      77       9   0006A                  ;   -zenComando             Comando verzeden naar scherm
      78      10   0006A                  ;   -debug                  debug info op seriele poot zetten
      79      11   0006A                  ;------------------------------------------------------------------
      80      12   0006A                  ;------------------------------------------------------------------
      81      13   0006A                  ;declaratie van pinnen
      82      14   0006A                  ;------------------------------------------------------------------
      83      15   0006A                      WR          bit     p3_data.0   ;write line van scherm actief laag
      84      16   0006A                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      85      17   0006A                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      86      18   0006A                      CD          bit     p3_data.3   ;Command write
      87      19   0006A                      RESET       bit     p1_data.1   ;reset van scherm actief laag
      88      20   0006A                      FS          bit     p1_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      89      21   0006A                  
      90      22   0006A                  
      91      23   0006A                  
      92      24   0006A                  ;------------------------------------------------------------------
      93      25   0006A                  ;declaratie van registers
      94      26   0006A                  ;------------------------------------------------------------------
      95      27   0006A                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      96      28   0006A                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      97      29   0006A                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      98      30   0006A                  
      99      31   0006A                  
     100      32   0006A                  ;------------------------------------------------------------------
     101      33   0006A                  ;Status check van scherm opslaan in STA register
     102      34   0006A                  ;-STA
     103      35   0006A                  ;------------------------------------------------------------------
     104      36   0006A                  statusCheck:
     105      37   0006A C0E0                 push    acc
     106      38   0006C C0D0                 push    psw
     107      39   0006E 120134               lcall   P4in                        ;poort 4 als input schakelen
     108      40   00071 120110               lcall   P3out
     109      41   00074 75C800               mov     p4_data,#00h
     110      42   00077                  STAOPNIEUW:
     111      43   00077 751000               mov     STA,#00h                    ;STA register leeg maken
     112      44   0007A D2B3                 setb    CD                          ;C/D hoog maken
     113      45   0007C 43900E               orl     p1_data,#00001110b
     114      46   0007F D2B1                 setb    RD                          ;RD' laag maken
     115      47   00081 C2B0                 clr     WR                          ;WR' hoog maken
     116      48   00083 D2B2                 setb    CE                          ;CE' laag maken
     117      49   00085 E5B0                 mov     a,p3_data                   ;status word inlezen
     118      50   00087 5403                 anl     a,#03h                      ;masker voor STA0 en STA1
     119      51   00089                  
     120      52   00089 F8                   mov     r0,a                      ;debug status op aurt zetten
     121      53   0008A 120187               lcall   debug
     122      54   0008D                  
     123      55   0008D B403E7               cjne    a,#03h,STAOPNIEUW           ;vergelijken
     124      56   00090 F510                 mov     STA,a                       ;data opslaan in STA voor eventuel gebruik later
     125      57   00092 C2B2                 clr     CE                          ;CE' terug hoog maken
     126      58   00094 D0D0                 pop     psw
     127      59   00096 D0E0                 pop     acc
     128      60   00098 22               ret
     129      61   00099                  
     130      62   00099                  ;------------------------------------------------------------------
     131      63   00099                  ;Initializatie van grafisch LCD scherm
     132      64   00099                  ;-Poort 1
     133      65   00099                  ;------------------------------------------------------------------
     134      66   00099                  initGLCD:
     135      67   00099 1200FE               lcall   P1out                   ;poort 1 initializeren
     136      68   0009C C291                 clr     RESET                   ;reseten van scherm
     137      69   0009E D290                 setb    FS                      ;font op 6*8 zetten
     138      70   000A0 C2B2                 clr     CE                      ;chip enable hoog zetten
     139      71   000A2 7414                 mov     a,#20                   ;reset lang genenoeg laten duren
     140      72   000A4 120319               lcall   delaya0k05s
     141      73   000A7 D291                 setb    RESET                   ;reset terug af zetten
     142      74   000A9 120552               lcall   initsio                 ;voor debug
     143      75   000AC                  
     144      76   000AC 12006A               lcall   statusCheck             ;initiele status check uitvoeren
     145      77   000AF                  
     146      78   000AF 751280               mov     COMANDREG,#80h          ;mode instellen
     147      79   000B2 120166               lcall   zendComando             ;mode instellen
     148      80   000B5                  
     149      81   000B5 751100               mov     DATAREG,#00h            ;grafisch home adres
     150      82   000B8 120146               lcall   zendData
     151      83   000BB 751100               mov     DATAREG,#00h
     152      84   000BE 120146               lcall   zendData
     153      85   000C1 751242               mov     COMANDREG,#42h
     154      86   000C4 120166               lcall   zendComando
     155      87   000C7                  
     156      88   000C7 751128               mov     DATAREG,#28h            ;Grafic aeria set
     157      89   000CA 120146               lcall   zendData
     158      90   000CD 751100               mov     DATAREG,#00h
     159      91   000D0 120146               lcall   zendData
     160      92   000D3 751243               mov     COMANDREG,#43h
     161      93   000D6 120166               lcall   zendComando
     162      94   000D9                  
     163      95   000D9                  
     164      96   000D9 751100               mov     DATAREG,#00h            ;text home aderes
     165      97   000DC 120146               lcall   zendData
     166      98   000DF 751100               mov     DATAREG,#00h
     167      99   000E2 120146               lcall   zendData
     168     100   000E5 751240               mov     COMANDREG,#40h
     169     101   000E8 120166               lcall   zendComando
     170     102   000EB                  
     171     103   000EB 751128               mov     DATAREG,#28h            ;aantal colommen text
     172     104   000EE 120146               lcall   zendData
     173     105   000F1 751100               mov     DATAREG,#00h
     174     106   000F4 120146               lcall   zendData
     175     107   000F7 751241               mov     COMANDREG,#41h
     176     108   000FA 120166               lcall   zendComando
     177     109   000FD 22               ret
     178     110   000FE                  
     179     111   000FE                  
     180     112   000FE                  ;------------------------------------------------------------------
     181     113   000FE                  ;Initializatie poort 1 als output
     182     114   000FE                  ;-poort 1
     183     115   000FE                  ;------------------------------------------------------------------
     184     116   000FE                  P1out:
     185     117   000FE C08F                 push    syscon0                 ;juiste map selecteren
     186     118   00100 758F04               mov     syscon0,#004h
     187     119   00103 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     188     120   00105 75B200               mov     port_page,#000h         ;selecteer poort page 0
     189     121   00108 7591FF               mov     p1_dir,#0ffh            ;poort 3 als output schakelen
     190     122   0010B D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     191     123   0010D D08F                 pop     syscon0                 ;pagina terug herstellen
     192     124   0010F 22               ret
     193     125   00110                  
     194     126   00110                  ;------------------------------------------------------------------
     195     127   00110                  ;Initializatie poort 3 als output
     196     128   00110                  ;-poort 3
     197     129   00110                  ;------------------------------------------------------------------
     198     130   00110                  P3out:
     199     131   00110 C08F                 push    syscon0                 ;juiste map selecteren
     200     132   00112 758F04               mov     syscon0,#004h
     201     133   00115 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     202     134   00117 75B200               mov     port_page,#000h         ;selecteer poort page 0
     203     135   0011A 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output schakelen
     204     136   0011D D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     205     137   0011F D08F                 pop     syscon0                 ;pagina terug herstellen
     206     138   00121 22               ret
     207     139   00122                  
     208     140   00122                  ;------------------------------------------------------------------
     209     141   00122                  ;Initializatie poort 4 als output
     210     142   00122                  ;-poort 4
     211     143   00122                  ;------------------------------------------------------------------
     212     144   00122                  P4out:
     213     145   00122 C08F                 push    syscon0                 ;juiste map selecteren
     214     146   00124 758F04               mov     syscon0,#004h
     215     147   00127 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     216     148   00129 75B200               mov     port_page,#000h         ;selecteer poort page 0
     217     149   0012C 75C9FF               mov     p4_dir,#0ffh            ;poort 3 als output schakelen
     218     150   0012F D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     219     151   00131 D08F                 pop     syscon0                 ;pagina terug herstellen
     220     152   00133 22               ret
     221     153   00134                  
     222     154   00134                  ;------------------------------------------------------------------
     223     155   00134                  ;Initializatie poort 4 als input
     224     156   00134                  ;-poort 4
     225     157   00134                  ;------------------------------------------------------------------
     226     158   00134                  P4in:
     227     159   00134 C08F                 push    syscon0                 ;juiste map selecteren
     228     160   00136 758F04               mov     syscon0,#004h
     229     161   00139 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     230     162   0013B 75B200               mov     port_page,#000h         ;selecteer poort page 0
     231     163   0013E 75C900               mov     p4_dir,#000h            ;poort 3 als input schakelen
     232     164   00141 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     233     165   00143 D08F                 pop     syscon0                 ;pagina terug herstellen
     234     166   00145 22               ret
     235     167   00146                  ;------------------------------------------------------------------
     236     168   00146                  ;Data verzeden naar scherm
     237     169   00146                  ;-DATAREG
     238     170   00146                  ;------------------------------------------------------------------
     239     171   00146                  zendData:
     240     172   00146 C0E0                 push    acc
     241     173   00148 C0D0                 push    psw
     242     174   0014A 120110               lcall   P3out                   ;poort 3 als output schakelen
     243     175   0014D C2B3                 clr     CD                      ;C/D laag maken
     244     176   0014F 12030A               lcall   delay10us
     245     177   00152 759069               mov     p1_data,#01101001b
     246     178   00155 F5B0                 mov     p3_data,a               ;data op de poort zetten
     247     179   00157 C2B2                 clr     CE                      ;CE' hoog maken
     248     180   00159 A811                 mov     r0,DATAREG
     249     181   0015B 120187               lcall   debug
     250     182   0015E 12006A               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     251     183   00161 D0D0                 pop     psw
     252     184   00163 D0E0                 pop     acc
     253     185   00165 22               ret
     254     186   00166                  
     255     187   00166                  ;------------------------------------------------------------------
     256     188   00166                  ;Comando verzeden naar scherm
     257     189   00166                  ;-COMANDREG
     258     190   00166                  ;------------------------------------------------------------------
     259     191   00166                  zendComando:
     260     192   00166 C0E0                 push    acc
     261     193   00168 C0D0                 push    psw
     262     194   0016A 120110               lcall   P3out                   ;poort 3 als output schakelen
     263     195   0016D D2B3                 setb    CD                      ;C/D hoog maken
     264     196   0016F 12030A               lcall   delay10us
     265     197   00172 43906D               orl     p1_data,#01101101b
     266     198   00175 8512B0               mov     p3_data,COMANDREG       ;data op de poort zetten
     267     199   00178 C2B2                 clr     CE                      ;CE' hoog maken
     268     200   0017A A812                 mov     r0,COMANDREG
     269     201   0017C 120187               lcall   debug
     270     202   0017F 12006A               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     271     203   00182 D0D0                 pop     psw
     272     204   00184 D0E0                 pop     acc
     273     205   00186 22               ret
     274     206   00187                  
     275     207   00187                  ;------------------------------------------------------------------
     276     208   00187                  ;debug info op seriele poort zetten
     277     209   00187                  ;-r0
     278     210   00187                  ;------------------------------------------------------------------
     279     211   00187                  debug:
     280     212   00187 C0E0                 push    acc
     281     213   00189 C0D0                 push    psw
     282     214   0018B 740D                 mov     a,#0dh
     283     215   0018D 12058A               lcall   siooutchar
     284     216   00190 E8                   mov     a,r0
     285     217   00191 1205A6               lcall   siooutbyte
     286     218   00194 740A                 mov     a,#0ah
     287     219   00196 12058A               lcall   siooutchar
     288     220   00199 D0D0                 pop     psw
     289     221   0019B D0E0                 pop     acc
     290     222   0019D 22               ret
     291     223   0019E                  
     292     224   0019E                  
     293     225   0019E                  
     294     226   0019E                  
     295     227   0019E                  
     296     228   0019E                  
     297     229   0019E                  
     298     230   0019E                  
     299     231   0019E                  
     300     232   0019E                  
     301     233   0019E                  
     302     234   0019E                  
     303     235   0019E                  
     304     236   0019E                  
     305     237   0019E                  
     306     238   0019E                  
     307     239   0019E                  
     308     240   0019E                  
     309     241   0019E                  
     310     242   0019E                  
xcez1.inc 
     312       1   0019E                  ;*******************************************************************************
     313       2   0019E                  ;
     314       3   0019E                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     315       4   0019E                  ;
     316       5   0019E                  ; The file contains drivers for various hardware and math applications.
     317       6   0019E                  ; In addition all register declarations are added.
     318       7   0019E                  ;
     319       8   0019E                  ; WARNING:!!!!!!!
     320       9   0019E                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     321      10   0019E                  ;
     322      11   0019E                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     323      12   0019E                  ;
     324      13   0019E                  ;*******************************************************************************
     325      14   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     326      15   0019E                  ;
     327      16   0019E                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     328      17   0019E                  ;
     329      18   0019E                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     330      19   0019E                  ; eenvoudige manier te gebruiken:
     331      20   0019E                  ;
     332      21   0019E                  ; standaard I/O:
     333      22   0019E                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     334      23   0019E                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     335      24   0019E                  ;      initleds             klaar zetten LED's als outputs
     336      25   0019E                  ;
     337      26   0019E                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     338      27   0019E                  ;      initiic              klaar zetten iic interface
     339      28   0019E                  ;      iicstart             genereren van een startconditie op iic poort
     340      29   0019E                  ;      iicstop              genereren stop conditie op iic poort
     341      30   0019E                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     342      31   0019E                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     343      32   0019E                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     344      33   0019E                  ;
     345      34   0019E                  ; LCD interace
     346      35   0019E                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     347      36   0019E                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     348      37   0019E                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     349      38   0019E                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     350      39   0019E                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     351      40   0019E                  ;      lcdlighton           backlight aan
     352      41   0019E                  ;      lcdlightoff          backlight uit
     353      42   0019E                  ;      lcdbuzon             buzzer aan
     354      43   0019E                  ;      lcdbuzof             buzzer uit
     355      44   0019E                  ;
     356      45   0019E                  ; Seriële interface (via USB stekker!!)
     357      46   0019E                  ;      initsio              klaar zetten seriële poort 9600 baud
     358      47   0019E                  ;      siooutchar           afdrukken ascii code (accu=input)
     359      48   0019E                  ;      siooutbyte           afdrkken getal in accu
     360      49   0019E                  ;      siooutnib            afdrukken 4 laagste bits accu
     361      50   0019E                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     362      51   0019E                  ;      sioinchar            inlezen van 1 ascii code in de accu
     363      52   0019E                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     364      53   0019E                  ;
     365      54   0019E                  ; ADC
     366      55   0019E                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     367      56   0019E                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     368      57   0019E                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     369      58   0019E                  ;
     370      59   0019E                  ; Arithmetic:
     371      60   0019E                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     372      61   0019E                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     373      62   0019E                  ;      div16                delen 2 16 bit getallen
     374      63   0019E                  ;      div32                delen 2 32 bit getallen
     375      64   0019E                  ;      add16                optellen 2 16 bit getallen
     376      65   0019E                  ;      add32                optellen 2 32 bit getallen
     377      66   0019E                  ;      sub16                verschil 2 16 bit getallen
     378      67   0019E                  ;      sub32                verschil 2 32 bit getallen
     379      68   0019E                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     380      69   0019E                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     381      70   0019E                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     382      71   0019E                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     383      72   0019E                  ;
     384      73   0019E                  ; Diverse
     385      74   0019E                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     386      75   0019E                  ;      delay1ms             tijdsverraging 1 milliseconde
     387      76   0019E                  ;      delay10us            tijdsvertraging 10 microseconde
     388      77   0019E                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     389      78   0019E                  ;	mapregs 		selecteer de SFR's in de mapped area
     390      79   0019E                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     391      80   0019E                  ;
     392      81   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     393      82   0019E                  ; LET OP!!!!
     394      83   0019E                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     395      84   0019E                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     396      85   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     397      86   0019E                  ;
     398      87   0019E                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     399      88   0019E                  ;
     400      89   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     401      90   0019E                  
     402      91   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     403      92   0019E                  ;
     404      93   0019E                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     405      94   0019E                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     406      95   0019E                  ; massa zonder extra weerstanden.
     407      96   0019E                  ;
     408      97   0019E                  ; Gebruikt geen registers
     409      98   0019E                  ;
     410      99   0019E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     411     100   0019E                  
     412     101   0019E C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     413     102   001A0 758F04                         mov    syscon0,#004h
     414     103   001A3 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     415     104   001A5 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     416     105   001A8 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     417     106   001AB 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     418     107   001AE 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     419     108   001B1 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     420     109   001B4 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     421     110   001B6 D08F                           pop    syscon0              ;pagina terug herstellen
     422     111   001B8 22                             ret
     423     112   001B9                  
     424     113   001B9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     425     114   001B9                  ;
     426     115   001B9                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     427     116   001B9                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     428     117   001B9                  ; 2 behouden hun originele instelling.
     429     118   001B9                  ;
     430     119   001B9                  ; Gebruikt geen registers
     431     120   001B9                  ;
     432     121   001B9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     433     122   001B9                  
     434     123   001B9 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     435     124   001BB 758F04                         mov    syscon0,#004h
     436     125   001BE C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     437     126   001C0 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     438     127   001C3 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     439     128   001C6 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     440     129   001C9 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     441     130   001CC 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     442     131   001CF D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     443     132   001D1 D08F                           pop    syscon0              ;pagina terug herstellen
     444     133   001D3 22                             ret
     445     134   001D4                  
     446     135   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     447     136   001D4                  ;
     448     137   001D4                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     449     138   001D4                  ; worden gedoofd (actief laag om ze te laden branden).
     450     139   001D4                  ;
     451     140   001D4                  ; Gebruikt geen registers
     452     141   001D4                  ;
     453     142   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     454     143   001D4                  
     455     144   001D4                  
     456     145   001D4 C08F             initleds:     push   syscon0              ;juiste map selecteren
     457     146   001D6 758F04                         mov    syscon0,#004h
     458     147   001D9 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     459     148   001DB 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     460     149   001DE 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     461     150   001E1 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     462     151   001E3 D08F                           pop    syscon0              ;pagina terug herstellen
     463     152   001E5 22                             ret
     464     153   001E6                  
     465     154   001E6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     466     155   001E6                  ;
     467     156   001E6                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     468     157   001E6                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     469     158   001E6                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     470     159   001E6                  ; sda wordt als input geschakeld
     471     160   001E6                  ;
     472     161   001E6                  ; LET OP!!
     473     162   001E6                  ; Dit is een IIC bus met beperkte mogelijkheden:
     474     163   001E6                  ; -vaste communicatiesnleheid van 100kbit/s
     475     164   001E6                  ; -enkel master mode
     476     165   001E6                  ; -enkel 7 bit adressering
     477     166   001E6                  ; -geen klok stretching
     478     167   001E6                  ;
     479     168   001E6                  ; Gebruikt geen registers
     480     169   001E6                  ;
     481     170   001E6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     482     171   001E6                  
     483     172   001E6                  sda           bit    p0_data.7            ;pin gebruikt als sda
     484     173   001E6                  scl           bit    p0_data.3            ;pin gebruikt als scl
     485     174   001E6                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     486     175   001E6                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     487     176   001E6                  
     488     177   001E6 C08F             initiic:      push   syscon0              ;juiste map selecteren
     489     178   001E8 758F04                         mov    syscon0,#004h
     490     179   001EB C0B2                           push   port_page
     491     180   001ED 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     492     181   001F0 D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     493     182   001F2 D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     494     183   001F4 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     495     184   001F7 D283                           setb   scl                  ;klok werkt als od
     496     185   001F9 D287                           setb   sda                  ;sda werkt als od
     497     186   001FB 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     498     187   001FE 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     499     188   00201 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     500     189   00204 D0B2                           pop    port_page            ;pagina herstellen
     501     190   00206 D08F                           pop    syscon0              ;map herstellen
     502     191   00208 22                             ret
     503     192   00209                  
     504     193   00209                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     505     194   00209                  ;
     506     195   00209                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     507     196   00209                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     508     197   00209                  ; te garanderen volgt er een delay van 10us
     509     198   00209                  ;
     510     199   00209                  ; Gebruikt geen registers
     511     200   00209                  ;
     512     201   00209                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     513     202   00209                  
     514     203   00209 C08F             iicstart:     push   syscon0              ;map bewaren
     515     204   0020B 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     516     205   0020E C0B2                           push   port_page            ;pagina bewaren
     517     206   00210 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     518     207   00213 D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     519     208   00215 D287                           setb   sda                  ;idem
     520     209   00217 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     521     210   0021A 12030A                         lcall  delay10us            ;
     522     211   0021D C287                           clr    sda                  ;data laag
     523     212   0021F 12030A                         lcall  delay10us
     524     213   00222 C283                           clr    scl                  ;dan klok laag
     525     214   00224 12030A                         lcall  delay10us            ;bit lang genoeg maken
     526     215   00227 D0B2                           pop    port_page            ;registers herstellen
     527     216   00229 D08F                           pop    syscon0
     528     217   0022B 22                             ret
     529     218   0022C                  
     530     219   0022C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     531     220   0022C                  ;
     532     221   0022C                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     533     222   0022C                  ;
     534     223   0022C                  ; Gebruikt geen registers
     535     224   0022C                  ;
     536     225   0022C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     537     226   0022C                  
     538     227   0022C C08F             iicstop:      push   syscon0              ;map bewaren
     539     228   0022E 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     540     229   00231 C0B2                           push   port_page            ;pagina bewaren
     541     230   00233 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     542     231   00236 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     543     232   00239 C287                           clr    sda                  ;data naar omlaag
     544     233   0023B 12030A                         lcall  delay10us
     545     234   0023E D283                           setb   scl                  ;klok naar 1
     546     235   00240 12030A                         lcall  delay10us            ;wachten
     547     236   00243 D287                           setb   sda                  ;idem data
     548     237   00245 12030A                         lcall  delay10us            ;
     549     238   00248 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     550     239   0024B D0B2                           pop    port_page            ;registers herstellen
     551     240   0024D D08F                           pop    syscon0
     552     241   0024F 22                             ret
     553     242   00250                  
     554     243   00250                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     555     244   00250                  ;
     556     245   00250                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     557     246   00250                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     558     247   00250                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     559     248   00250                  ;
     560     249   00250                  ; Gebruikt:
     561     250   00250                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     562     251   00250                  ;      cy=ack bit vanuit de slave
     563     252   00250                  ;
     564     253   00250                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     565     254   00250                  
     566     255   00250 C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     567     256   00252 C0F0                           push   b                    ;gebruikt als loopcounter
     568     257   00254 C08F                           push   syscon0              ;map juist zetten
     569     258   00256 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     570     259   00259 C0B2                           push   port_page            ;poort pagina bewaren
     571     260   0025B 75B200                         mov    port_page,#000h      ;basispagina selecteren
     572     261   0025E 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     573     262   00261 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     574     263   00264 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     575     264   00265 9287                           mov    sda,c                ;op pin
     576     265   00267 12030A                         lcall  delay10us            ;wachten
     577     266   0026A D283                           setb   scl                  ;puls genereren
     578     267   0026C 12030A                         lcall  delay10us            ;ook hier wat tijd laten
     579     268   0026F C283                           clr    scl                  ;klok terug laag maken
     580     269   00271 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     581     270   00274                  
     582     271   00274                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     583     272   00274                  
     584     273   00274 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     585     274   00277 12030A                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     586     275   0027A D283                           setb   scl                  ;puls terug hoog
     587     276   0027C A287                           mov    c,sda                ;inlezen en naar carry
     588     277   0027E 12030A                         lcall  delay10us
     589     278   00281 C283                           clr    scl                  ;klok blijft laag achter
     590     279   00283 D0B2                           pop    port_page
     591     280   00285 D08F                           pop    syscon0
     592     281   00287 D0F0                           pop    b
     593     282   00289 D0E0                           pop    acc
     594     283   0028B 22                             ret
     595     284   0028C                  
     596     285   0028C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     597     286   0028C                  ;
     598     287   0028C                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     599     288   0028C                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     600     289   0028C                  ;
     601     290   0028C                  ; Gebruikt:
     602     291   0028C                  ;      -de accu als output
     603     292   0028C                  ;
     604     293   0028C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     605     294   0028C                  
     606     295   0028C C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     607     296   0028E 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     608     297   00291 C0B2                           push   port_page            ;pagina bewaren
     609     298   00293 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     610     299   00296 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     611     300   00298 C0D0                           push   psw                  ;vlaggen bewaren
     612     301   0029A 75F008                         mov    b,#008h              ;loopcounter laden
     613     302   0029D 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     614     303   002A0 12030A           iicinbyteack1:lcall  delay10us
     615     304   002A3 D283                           setb   scl                  ;klok hoog
     616     305   002A5 A287                           mov    c,sda                ;pin inlezen
     617     306   002A7 33                             rlc    a                    ;in accu shiften
     618     307   002A8 12030A                         lcall  delay10us
     619     308   002AB C283                           clr    scl                  ;klok terug laag
     620     309   002AD D5F0F0                         djnz   b,iicinbyteack1
     621     310   002B0 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     622     311   002B3 C287                           clr    sda                  ;ack genereren
     623     312   002B5 12030A                         lcall  delay10us
     624     313   002B8 D283                           setb   scl
     625     314   002BA 12030A                         lcall  delay10us
     626     315   002BD C283                           clr    scl
     627     316   002BF 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     628     317   002C2 D0D0                           pop    psw                  ;registers herstellen
     629     318   002C4 D0F0                           pop    b
     630     319   002C6 D0B2                           pop    port_page
     631     320   002C8 D08F                           pop    syscon0
     632     321   002CA 22                             ret
     633     322   002CB                  
     634     323   002CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     635     324   002CB                  ;
     636     325   002CB                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     637     326   002CB                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     638     327   002CB                  ;
     639     328   002CB                  ; Gebruikt:
     640     329   002CB                  ;      -de accu als output
     641     330   002CB                  ;
     642     331   002CB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     643     332   002CB                  
     644     333   002CB C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     645     334   002CD 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     646     335   002D0 C0B2                           push   port_page            ;pagina bewaren
     647     336   002D2 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     648     337   002D5 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     649     338   002D7 C0D0                           push   psw                  ;vlaggen bewaren
     650     339   002D9 75F008                         mov    b,#008h              ;loopcounter laden
     651     340   002DC 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     652     341   002DF 12030A           iicinbytenack1:lcall  delay10us
     653     342   002E2 D283                           setb   scl                  ;klok hoog
     654     343   002E4 A287                           mov    c,sda                ;pin inlezen
     655     344   002E6 33                             rlc    a                    ;in accu shiften
     656     345   002E7 12030A                         lcall  delay10us
     657     346   002EA C283                           clr    scl                  ;klok terug laag
     658     347   002EC D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     659     348   002EF 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     660     349   002F2 D287                           setb   sda                  ;nack genereren
     661     350   002F4 12030A                         lcall  delay10us
     662     351   002F7 D283                           setb   scl
     663     352   002F9 12030A                         lcall  delay10us
     664     353   002FC C283                           clr    scl
     665     354   002FE 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     666     355   00301 D0D0                           pop    psw                  ;registers herstellen
     667     356   00303 D0F0                           pop    b
     668     357   00305 D0B2                           pop    port_page
     669     358   00307 D08F                           pop    syscon0
     670     359   00309 22                             ret
     671     360   0030A                  
     672     361   0030A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     673     362   0030A                  ;
     674     363   0030A                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     675     364   0030A                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     676     365   0030A                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     677     366   0030A                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     678     367   0030A                  ;
     679     368   0030A                  ; Gebruikt geen registers
     680     369   0030A                  ;
     681     370   0030A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     682     371   0030A                  
     683     372   0030A C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     684     373   0030C C0D0                           push   psw                  ;8*42ns=330ns
     685     374   0030E 75E01A                         mov    acc,#01ah            ;420ns
     686     375   00311 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     687     376   00314 D0D0                           pop    psw                  ;8*42ns=330ns
     688     377   00316 D0E0                           pop    acc                  ;8*42ns=330ns
     689     378   00318 22                             ret                         ;165ns
     690     379   00319                  
     691     380   00319                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     692     381   00319                  ;
     693     382   00319                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     694     383   00319                  ;
     695     384   00319                  ; Gebruikt geen registers
     696     385   00319                  ;
     697     386   00319                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     698     387   00319                  
     699     388   00319 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     700     389   0031B C0D0                           push   psw
     701     390   0031D C0F0                           push   b
     702     391   0031F 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     703     392   00322 120332           delaya0k05s1: lcall  delay1ms
     704     393   00325 D5F0FA                         djnz   b,delaya0k05s1
     705     394   00328 D5E0F4                         djnz   acc,delaya0k05s2
     706     395   0032B D0F0                           pop    b                    ;registers herstellen
     707     396   0032D D0D0                           pop    psw
     708     397   0032F D0E0                           pop    acc
     709     398   00331 22                             ret
     710     399   00332                  
     711     400   00332                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     712     401   00332                  ;
     713     402   00332                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     714     403   00332                  ;
     715     404   00332                  ; Gebruikt geen registers
     716     405   00332                  ;
     717     406   00332                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     718     407   00332                  
     719     408   00332 C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     720     409   00334 C0D0                           push   psw                  ;8*42ns=330ns
     721     410   00336 75E064                         mov    acc,#100             ;420ns
     722     411   00339 12030A           delay1ms1:    lcall  delay10us            ;10us
     723     412   0033C D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     724     413   0033F D0D0                           pop    psw                  ;8*42ns=330ns
     725     414   00341 D0E0                           pop    acc                  ;8*42ns=330ns
     726     415   00343 22                             ret                         ;165ns
     727     416   00344                  
     728     417   00344                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     729     418   00344                  ;
     730     419   00344                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     731     420   00344                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     732     421   00344                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     733     422   00344                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     734     423   00344                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     735     424   00344                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     736     425   00344                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     737     426   00344                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     738     427   00344                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     739     428   00344                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     740     429   00344                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     741     430   00344                  ; systemen!!!!
     742     431   00344                  ;
     743     432   00344                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     744     433   00344                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     745     434   00344                  ;       aduclcd0.inc
     746     435   00344                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     747     436   00344                  ;       aduclcd1.inc
     748     437   00344                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     749     438   00344                  ;
     750     439   00344                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     751     440   00344                  
     752     441   00344                  e             bit    b.1                  ;enable
     753     442   00344                  rs            bit    b.0                  ;register select
     754     443   00344                  backlight     bit    b.6                  ;bit waar backlight op zit
     755     444   00344                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     756     445   00344                  
     757     446   00344                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     758     447   00344                  
     759     448   00344                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     760     449   00344                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     761     450   00344                  
     762     451   00344                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     763     452   00344                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     764     453   00344                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     765     454   00344                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     766     455   00344                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     767     456   00344                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     768     457   00344                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     769     458   00344                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     770     459   00344                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     771     460   00344                  
     772     461   00344                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     773     462   00344                  ;
     774     463   00344                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     775     464   00344                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     776     465   00344                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     777     466   00344                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     778     467   00344                  ;
     779     468   00344                  ; registergebruik: geen
     780     469   00344                  ;
     781     470   00344                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     782     471   00344                  
     783     472   00344 C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     784     473   00346 C0D0                           push   psw
     785     474   00348 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     786     475   0034A 1201E6                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     787     476   0034D 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     788     477   00350                                                            ;buzzer en baklight worden nu op 1 gezet
     789     478   00350 1204E8                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     790     479   00353 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     791     480   00355 1204E1           initlcd1:     lcall  delay2ms
     792     481   00358 D5E0FA                         djnz   acc,initlcd1
     793     482   0035B 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     794     483   0035D 1204A0                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     795     484   00360 1204E1                         lcall  delay2ms      ;te krijgen.
     796     485   00363 7430                           mov    a,#00110000b
     797     486   00365 1204A0                         lcall  outhnibc
     798     487   00368 1204E1                         lcall  delay2ms
     799     488   0036B 7430                           mov    a,#00110000b
     800     489   0036D 1204A0                         lcall  outhnibc
     801     490   00370 1204E1                         lcall  delay2ms
     802     491   00373 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     803     492   00375 1204A0                         lcall  outhnibc      ;hoge nibble naar het controleregister
     804     493   00378 1204E1                         lcall  delay2ms      ;niet nodig volgens datasheet
     805     494   0037B 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     806     495   0037D 12048A                         lcall  outc          ;naar display
     807     496   00380 1204E1                         lcall  delay2ms      ;is iets te lang volgens datasheet
     808     497   00383 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     809     498   00385 12048A                         lcall  outc
     810     499   00388 1204E1                         lcall  delay2ms      ;ook deze delay is iets te lang
     811     500   0038B 7401                           mov    a,#displayon  ;clear display and home cursor
     812     501   0038D 12048A                         lcall  outc
     813     502   00390 1204E1                         lcall  delay2ms      ;deze wachttijd is bijna juist
     814     503   00393 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     815     504   00395 12048A                         lcall  outc
     816     505   00398 1204E1                         lcall  delay2ms      ;wachten weer veel te lang
     817     506   0039B D0F0                           pop    b             ;registers terug in orde zetten
     818     507   0039D D0D0                           pop    psw
     819     508   0039F D0E0                           pop    acc
     820     509   003A1 22                             ret                  ;einde van de initialisatie
     821     510   003A2                  
     822     511   003A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     823     512   003A2                  ;
     824     513   003A2                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     825     514   003A2                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     826     515   003A2                  ;      00dh   =cursor in de home positie
     827     516   003A2                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     828     517   003A2                  ;      00ah   =cursor op tweede lijn plaatsen
     829     518   003A2                  ;      001h   =cursor on blink
     830     519   003A2                  ;      002h   =cursor on, no blink
     831     520   003A2                  ;      003h   =cursor off
     832     521   003A2                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     833     522   003A2                  ;
     834     523   003A2                  ; de routine gebruikt geen registers
     835     524   003A2                  ;
     836     525   003A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     837     526   003A2                  
     838     527   003A2                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     839     528   003A2                  ; dan mag de data direct naar het dataregister van het scherm.
     840     529   003A2                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     841     530   003A2                  
     842     531   003A2                  lcdoutchar:
     843     532   003A2 C0E0             outcharlcd:   push   acc           ;registers op stack
     844     533   003A4 C0D0                           push   psw
     845     534   003A6 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     846     535   003A9 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     847     536   003AB B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     848     537   003AE 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     849     538   003B0                  
     850     539   003B0                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     851     540   003B0                  ; Het is dus een opdracht die we moeten uitvoeren.
     852     541   003B0                  
     853     542   003B0 B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     854     543   003B3 7401                           mov    a,#cleardisp         ;scherm leegmaken
     855     544   003B5 12048A                         lcall  outc                 ;naar controleregister
     856     545   003B8 803A                           sjmp   outcharlcde          ;afsluiten
     857     546   003BA                  
     858     547   003BA B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     859     548   003BD 740F                           mov    a,#cursoronb         ;cursoron met blink
     860     549   003BF 12048A                         lcall  outc
     861     550   003C2 8030                           sjmp   outcharlcde
     862     551   003C4                  
     863     552   003C4 B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     864     553   003C7 740E                           mov    a,#cursoronn         ;cursoron no blink
     865     554   003C9 12048A                         lcall  outc
     866     555   003CC 8026                           sjmp   outcharlcde
     867     556   003CE                  
     868     557   003CE B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     869     558   003D1 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     870     559   003D3 12048A                         lcall  outc
     871     560   003D6 801C                           sjmp   outcharlcde
     872     561   003D8                  
     873     562   003D8 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     874     563   003DB 7402                           mov    a,#cursathom         ;cursor in home positie
     875     564   003DD 12048A                         lcall  outc
     876     565   003E0 8012                           sjmp   outcharlcde
     877     566   003E2                  
     878     567   003E2 B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     879     568   003E5                                                            ;tweede lijn
     880     569   003E5 74C0                           mov    a,#0c0h
     881     570   003E7 12048A                         lcall  outc
     882     571   003EA 8008                           sjmp   outcharlcde
     883     572   003EC                  
     884     573   003EC                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     885     574   003EC                  ; is. dit mag naar het data register.
     886     575   003EC                  
     887     576   003EC 120450           outcharlcd8:  lcall  outd          ;klaar
     888     577   003EF 8003                           sjmp   outcharlcde   ;einde routine
     889     578   003F1                  
     890     579   003F1                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     891     580   003F1                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     892     581   003F1                  ; te schrijven.
     893     582   003F1                  
     894     583   003F1 12048A           outcharlcd9:  lcall  outc          ;klaar
     895     584   003F4 D0D0             outcharlcde:  pop    psw           ;registers herstellen
     896     585   003F6 D0E0                           pop    acc
     897     586   003F8 22                             ret
     898     587   003F9                  
     899     588   003F9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     900     589   003F9                  ;
     901     590   003F9                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     902     591   003F9                  ; op het lcd scherm.
     903     592   003F9                  ;
     904     593   003F9                  ; de routine gebruikt geen registers
     905     594   003F9                  ;
     906     595   003F9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     907     596   003F9                  
     908     597   003F9                  lcdoutnib:
     909     598   003F9 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     910     599   003FB C0D0                           push   psw
     911     600   003FD 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     912     601   003FF 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     913     602   00401 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     914     603   00404 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     915     604   00406 2407                           add    a,#007h       ;omvormen naar hoofdletter
     916     605   00408 120450           outniblcde:   lcall  outd          ;naar het scherm
     917     606   0040B D0D0                           pop    psw
     918     607   0040D D0E0                           pop    acc
     919     608   0040F 22                             ret
     920     609   00410                  
     921     610   00410                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     922     611   00410                  ;
     923     612   00410                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     924     613   00410                  ;
     925     614   00410                  ; de routine gebruikt geen registers
     926     615   00410                  ;
     927     616   00410                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     928     617   00410                  
     929     618   00410                  lcdoutbyte:
     930     619   00410 C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     931     620   00412 C0D0                           push   psw
     932     621   00414 C4                             swap   a             ;bitjes omruilen
     933     622   00415 1203F9                         lcall  outniblcd
     934     623   00418 C4                             swap   a             ;nog eens
     935     624   00419 1203F9                         lcall  outniblcd
     936     625   0041C D0D0                           pop    psw
     937     626   0041E D0E0                           pop    acc
     938     627   00420 22                             ret
     939     628   00421                  
     940     629   00421                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     941     630   00421                  ;
     942     631   00421                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     943     632   00421                  ;
     944     633   00421                  ; de routine gebruikt geen registers
     945     634   00421                  ;
     946     635   00421                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     947     636   00421                  
     948     637   00421                  lcddispdptr:
     949     638   00421 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     950     639   00423 C0D0                           push   psw
     951     640   00425 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     952     641   00427 120410                         lcall  outbytelcd
     953     642   0042A E582                           mov    a,dpl         ;dan het lage deel
     954     643   0042C 120410                         lcall  outbytelcd
     955     644   0042F D0D0                           pop    psw
     956     645   00431 D0E0                           pop    acc
     957     646   00433 22                             ret
     958     647   00434                  
     959     648   00434                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     960     649   00434                  ;
     961     650   00434                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     962     651   00434                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     963     652   00434                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     964     653   00434                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     965     654   00434                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     966     655   00434                  ;
     967     656   00434                  ; de routine gebruikt geen registers
     968     657   00434                  ;
     969     658   00434                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     970     659   00434                  
     971     660   00434                  lcdoutmsga:
     972     661   00434 C0E0             outmsgalcd:   push   acc           ;registers op de stack
     973     662   00436 C0D0                           push   psw
     974     663   00438 C083                           push   dph           ;ook de data pointer
     975     664   0043A C082                           push   dpl
     976     665   0043C                  
     977     666   0043C                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     978     667   0043C                  
     979     668   0043C E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     980     669   0043D 93                             movc   a,@a+dptr     ;waarde lezen
     981     670   0043E 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     982     671   00440                  
     983     672   00440                  ; de code is niet 0 dus versturen met outchar
     984     673   00440                  
     985     674   00440 1203A2                         lcall  outcharlcd    ;weg er mee
     986     675   00443 A3                             inc    dptr          ;naar volgende ascii code wijzen
     987     676   00444 02043C                         ljmp   outmsgalcd1   ;lus sluiten
     988     677   00447                  
     989     678   00447 D082             outmsgalcde:  pop    dpl           ;registers herstellen
     990     679   00449 D083                           pop    dph
     991     680   0044B D0D0                           pop    psw
     992     681   0044D D0E0                           pop    acc
     993     682   0044F 22                             ret
     994     683   00450                  
     995     684   00450                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     996     685   00450                  ;
     997     686   00450                  ; outd is een routine die naar het data register van het display een
     998     687   00450                  ; volledige byte stuurt.
     999     688   00450                  ;
    1000     689   00450                  ; De routine gebruikt geen registers.
    1001     690   00450                  ;
    1002     691   00450                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1003     692   00450                  
    1004     693   00450 C0E0             outd:         push   acc           ;registers op stack zetten
    1005     694   00452 C0D0                           push   psw
    1006     695   00454 120460                         lcall  outhnibd      ;hoogste vier bits verzenden
    1007     696   00457 C4                             swap   a             ;bitjes omruilen
    1008     697   00458 120460                         lcall  outhnibd      ;naar het scherm sturen
    1009     698   0045B D0D0                           pop    psw           ;registers terug herstellen
    1010     699   0045D D0E0                           pop    acc
    1011     700   0045F 22                             ret
    1012     701   00460                  
    1013     702   00460                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1014     703   00460                  ;
    1015     704   00460                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
    1016     705   00460                  ; lcd scherm.
    1017     706   00460                  ;
    1018     707   00460                  ; de routine gebruikt geen registers.
    1019     708   00460                  ;
    1020     709   00460                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1021     710   00460                  
    1022     711   00460 C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
    1023     712   00462 C0D0                           push   psw
    1024     713   00464 C0F0                           push   b             ;werkregister
    1025     714   00466 120501                         lcall  lcdtoport     ;lees de expander naar b register
    1026     715   00469 D2F0                           setb   rs            ;controle lijn in orde
    1027     716   0046B C2F1                           clr    e             ;deselectie display
    1028     717   0046D 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1029     718   0046F 03                             rr     a             ;bits op juiste plaats zetten
    1030     719   00470 03                             rr     a             ;voor b reg
    1031     720   00471 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1032     721   00474 42F0                           orl    b,a           ;bij elkaar voegen
    1033     722   00476 1204E8                         lcall  porttolcd     ;naar expnder
    1034     723   00479 D2F1                           setb   e             ;display enabelen
    1035     724   0047B 1204E8                         lcall  porttolcd
    1036     725   0047E C2F1                           clr    e             ;display deselecteren
    1037     726   00480 1204E8                         lcall  porttolcd
    1038     727   00483 D0F0                           pop    b
    1039     728   00485 D0D0                           pop    psw           ;registers herstellen
    1040     729   00487 D0E0                           pop    acc
    1041     730   00489 22                             ret
    1042     731   0048A                  
    1043     732   0048A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1044     733   0048A                  ;
    1045     734   0048A                  ; outc is een routine die naar het controleregister van het display een
    1046     735   0048A                  ; volledige byte stuurt.
    1047     736   0048A                  ;
    1048     737   0048A                  ; De routine gebruikt geen registers.
    1049     738   0048A                  ;
    1050     739   0048A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1051     740   0048A                  
    1052     741   0048A C0E0             outc:         push   acc           ;registers op stack zetten
    1053     742   0048C C0D0                           push   psw
    1054     743   0048E 1204A0                         lcall  outhnibc      ;hoogste vier bits verzenden
    1055     744   00491 1204E1                         lcall  delay2ms      ;niet echt nodig
    1056     745   00494 C4                             swap   a             ;bitjes omruilen
    1057     746   00495 1204A0                         lcall  outhnibc      ;naar het scherm sturen
    1058     747   00498 1204E1                         lcall  delay2ms      ;altijd goed voor traagste commando
    1059     748   0049B D0D0                           pop    psw           ;registers terug herstellen
    1060     749   0049D D0E0                           pop    acc
    1061     750   0049F 22                             ret
    1062     751   004A0                  
    1063     752   004A0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1064     753   004A0                  ;
    1065     754   004A0                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1066     755   004A0                  ; lcd scherm.
    1067     756   004A0                  ;
    1068     757   004A0                  ; de routine gebruikt geen registers.
    1069     758   004A0                  ;
    1070     759   004A0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1071     760   004A0                  
    1072     761   004A0 C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1073     762   004A2 C0D0                           push   psw
    1074     763   004A4 C0F0                           push   b             ;werkregister
    1075     764   004A6 120501                         lcall  lcdtoport     ;lees de expander naar b register
    1076     765   004A9 C2F0                           clr    rs            ;controle lijn in orde
    1077     766   004AB C2F1                           clr    e             ;deselectie display
    1078     767   004AD 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1079     768   004AF 03                             rr     a             ;bits op juiste plaats zetten
    1080     769   004B0 03                             rr     a             ;voor b reg
    1081     770   004B1 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1082     771   004B4 42F0                           orl    b,a           ;bij elkaar voegen
    1083     772   004B6 1204E8                         lcall  porttolcd     ;naar expnder
    1084     773   004B9 D2F1                           setb   e             ;display enabelen
    1085     774   004BB 1204E8                         lcall  porttolcd
    1086     775   004BE C2F1                           clr    e             ;display deselecteren
    1087     776   004C0 1204E8                         lcall  porttolcd
    1088     777   004C3 D0F0                           pop    b
    1089     778   004C5 D0D0                           pop    psw           ;registers herstellen
    1090     779   004C7 D0E0                           pop    acc
    1091     780   004C9 22                             ret
    1092     781   004CA                  
    1093     782   004CA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1094     783   004CA                  ;
    1095     784   004CA                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1096     785   004CA                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1097     786   004CA                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1098     787   004CA                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1099     788   004CA                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1100     789   004CA                  ; DATA GESCHREVEN.
    1101     790   004CA                  ;
    1102     791   004CA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1103     792   004CA                  
    1104     793   004CA 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1105     794   004CC 12048A           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1106     795   004CF 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1107     796   004D1 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1108     797   004D2 120450                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1109     798   004D5 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1110     799   004D8 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1111     800   004D9 80F4                           SJMP   BUILD3
    1112     801   004DB 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1113     802   004DD 12048A                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1114     803   004E0 22                             RET                  ;EINDE VAN DE ROUTINE
    1115     804   004E1                  
    1116     805   004E1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1117     806   004E1                  ;
    1118     807   004E1                  ; Delay2ms is een vertragingsroutine van 2ms.
    1119     808   004E1                  ;
    1120     809   004E1                  ; De routine gebruikt geen registers.
    1121     810   004E1                  ;
    1122     811   004E1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1123     812   004E1                  
    1124     813   004E1 120332           delay2ms:     lcall  delay1ms
    1125     814   004E4 120332                         lcall  delay1ms
    1126     815   004E7 22                             ret
    1127     816   004E8                  
    1128     817   004E8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1129     818   004E8                  ;
    1130     819   004E8                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1131     820   004E8                  ; scherm stuurt via de port expander.
    1132     821   004E8                  ;
    1133     822   004E8                  ; Gebruikt geen registers
    1134     823   004E8                  ;
    1135     824   004E8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1136     825   004E8                  
    1137     826   004E8 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1138     827   004EA C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1139     828   004EC 120209                         lcall  iicstart      ;vertrokken
    1140     829   004EF 7440                           mov    a,#01000000b  ;schrijven naar expander
    1141     830   004F1 120250                         lcall  iicoutbyte    ;weg er mee
    1142     831   004F4 E5F0                           mov    a,b           ;data verzenden
    1143     832   004F6 120250                         lcall  iicoutbyte
    1144     833   004F9 12022C                         lcall  iicstop       ;transactie sluiten
    1145     834   004FC D0D0                           pop    psw
    1146     835   004FE D0E0                           pop    acc
    1147     836   00500 22                             ret
    1148     837   00501                  
    1149     838   00501                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1150     839   00501                  ;
    1151     840   00501                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1152     841   00501                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1153     842   00501                  ; van buzzet en backlight is.
    1154     843   00501                  ;
    1155     844   00501                  ; Gebruikt b register
    1156     845   00501                  ;
    1157     846   00501                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1158     847   00501                  
    1159     848   00501 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1160     849   00503 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1161     850   00505 120209                         lcall  iicstart      ;vertrokken
    1162     851   00508 7441                           mov    a,#01000001b  ;lezen van expander
    1163     852   0050A 120250                         lcall  iicoutbyte    ;weg er mee
    1164     853   0050D 1202CB                         lcall  iicinbytenack ;data inlezen
    1165     854   00510 12022C                         lcall  iicstop
    1166     855   00513 F5F0                           mov    b,a
    1167     856   00515 D0D0                           pop    psw
    1168     857   00517 D0E0                           pop    acc
    1169     858   00519 22                             ret
    1170     859   0051A                  
    1171     860   0051A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1172     861   0051A                  ;
    1173     862   0051A                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1174     863   0051A                  ;
    1175     864   0051A                  ; Gebruikt geen registers
    1176     865   0051A                  ;
    1177     866   0051A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1178     867   0051A                  
    1179     868   0051A C0F0             lcdlighton:   push   b
    1180     869   0051C 120501                         lcall  lcdtoport     ;expander lezen
    1181     870   0051F C2F6                           clr    b.6           ;licht aan doen
    1182     871   00521 1204E8                         lcall  porttolcd     ;expander scrijven
    1183     872   00524 D0F0                           pop    b
    1184     873   00526 22                             ret
    1185     874   00527                  
    1186     875   00527                  
    1187     876   00527                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1188     877   00527                  ;
    1189     878   00527                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1190     879   00527                  ;
    1191     880   00527                  ; Gebruikt geen registers
    1192     881   00527                  ;
    1193     882   00527                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1194     883   00527                  
    1195     884   00527 C0F0             lcdlightoff:  push   b
    1196     885   00529 120501                         lcall  lcdtoport     ;expander lezen
    1197     886   0052C D2F6                           setb   b.6           ;licht uit doen
    1198     887   0052E 1204E8                         lcall  porttolcd     ;expander scrijven
    1199     888   00531 D0F0                           pop    b
    1200     889   00533 22                             ret
    1201     890   00534                  
    1202     891   00534                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1203     892   00534                  ;
    1204     893   00534                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1205     894   00534                  ;
    1206     895   00534                  ; Gebruikt geen registers
    1207     896   00534                  ;
    1208     897   00534                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1209     898   00534                  
    1210     899   00534 C0F0             lcdbuzon:     push   b
    1211     900   00536 120501                         lcall  lcdtoport     ;expander lezen
    1212     901   00539 C2F7                           clr    b.7           ;buzzer aan doen
    1213     902   0053B 1204E8                         lcall  porttolcd     ;expander scrijven
    1214     903   0053E D0F0                           pop    b
    1215     904   00540 22                             ret
    1216     905   00541                  
    1217     906   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1218     907   00541                  ;
    1219     908   00541                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1220     909   00541                  ;
    1221     910   00541                  ; Gebruikt geen registers
    1222     911   00541                  ;
    1223     912   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1224     913   00541                  
    1225     914   00541 C0F0             lcdbuzoff:    push   b
    1226     915   00543 120501                         lcall  lcdtoport     ;expander lezen
    1227     916   00546 D2F7                           setb   b.7           ;buzzer aan doen
    1228     917   00548 1204E8                         lcall  porttolcd     ;expander scrijven
    1229     918   0054B D0F0                           pop    b
    1230     919   0054D 22                             ret
    1231     920   0054E                  
    1232     921   0054E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1233     922   0054E                  ;
    1234     923   0054E                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1235     924   0054E                  ; een standaard com poort op 9600 baud.
    1236     925   0054E                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1237     926   0054E                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1238     927   0054E                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1239     928   0054E                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1240     929   0054E                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1241     930   0054E                  ; NIET door deze routine.
    1242     931   0054E                  ;
    1243     932   0054E                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1244     933   0054E                  ;
    1245     934   0054E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1246     935   0054E                  
    1247     936   0054E                  blank         equ    020h          ;ascii code voor een blank
    1248     937   0054E                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1249     938   0054E                  ff            equ    00ch          ;ascii code voor nieuw blad
    1250     939   0054E                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1251     940   0054E                  lf            equ    00ah          ;ascii code voor volgende lijn
    1252     941   0054E                  backsp        equ    008h          ;ascii code voor het bs karakter
    1253     942   0054E                  beep          equ    007h          ;ascii code voor een beep
    1254     943   0054E                  
    1255     944   0054E 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1256     945   00552                                                                          ;van het scherm
    1257     946   00552                  
    1258     947   00552                  strtbuf       equ     054h         ;start adres van de buffer
    1259     948   00552                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1260     949   00552                  
    1261     950   00552                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1262     951   00552                  ;
    1263     952   00552                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1264     953   00552                  ;
    1265     954   00552                  ; Gebruikt geen registers
    1266     955   00552                  ;
    1267     956   00552                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1268     957   00552                  
    1269     958   00552 C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1270     959   00554 C08F                           push   syscon0              ;map bewaren
    1271     960   00556 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1272     961   00559 C0B2                           push   port_page            ;pagina op stack zetten
    1273     962   0055B C0BF                           push   scu_page
    1274     963   0055D 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1275     964   00560                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1276     965   00560                  ;      -p1.0 als input en alt1 selectie
    1277     966   00560                  ;      -p1.1 als output en alt2 selectie
    1278     967   00560                  
    1279     968   00560 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1280     969   00563 5390FD                         anl    p1_altsel0,#11111101b
    1281     970   00566 439001                         orl    p1_altsel0,#00000001b
    1282     971   00569 5391FE                         anl    p1_altsel1,#11111110b
    1283     972   0056C 439102                         orl    p1_altsel1,#00000010b
    1284     973   0056F 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1285     974   00572 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1286     975   00575 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1287     976   00578                  
    1288     977   00578                  ; Nu moet de baud rate generator ingesteld worden
    1289     978   00578                  ; We gaan er van uit dat de systeemklok 24MHz is
    1290     979   00578                  
    1291     980   00578 759850                         mov    scon,#01010000b      ;UART initialiseren
    1292     981   0057B                  
    1293     982   0057B                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1294     983   0057B                  ; gebruikt!!
    1295     984   0057B                  
    1296     985   0057B 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1297     986   0057E 75BD11                         mov    bcon,#00010001b
    1298     987   00581 D0BF                           pop    scu_page
    1299     988   00583 D0B2                           pop    port_page            ;alles terug herstellen
    1300     989   00585 D08F                           pop    syscon0
    1301     990   00587 D0E0                           pop    acc
    1302     991   00589 22                             ret
    1303     992   0058A                  
    1304     993   0058A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1305     994   0058A                  ;
    1306     995   0058A                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1307     996   0058A                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1308     997   0058A                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1309     998   0058A                  ;
    1310     999   0058A                  ; de routine gebruikt geen registers.
    1311    1000   0058A                  ;
    1312    1001   0058A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1313    1002   0058A                  
    1314    1003   0058A                  siooutchar:
    1315    1004   0058A F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1316    1005   0058C 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1317    1006   0058F C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1318    1007   00591 22                             RET
    1319    1008   00592                  
    1320    1009   00592                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1321    1010   00592                  ;
    1322    1011   00592                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1323    1012   00592                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1324    1013   00592                  ;
    1325    1014   00592                  ; de routine gebruikt geen registers.
    1326    1015   00592                  ;
    1327    1016   00592                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1328    1017   00592                  
    1329    1018   00592                  siooutnib:
    1330    1019   00592 C0E0             OUTNIB:       push   acc           ;registers op de stack
    1331    1020   00594 C0D0                           push   psw
    1332    1021   00596 540F                           ANL    A,#00FH       ;AFZONDEREN
    1333    1022   00598 120682                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1334    1023   0059B 12058A                         LCALL  OUTCHAR       ;VERSTUREN
    1335    1024   0059E 1205EB                         LCALL  XONXOFF       ;FLOW CONTROL
    1336    1025   005A1 D0D0                           pop    psw           ;registers herstellen
    1337    1026   005A3 D0E0                           pop    acc
    1338    1027   005A5 22                             RET
    1339    1028   005A6                  
    1340    1029   005A6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1341    1030   005A6                  ;
    1342    1031   005A6                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1343    1032   005A6                  ; WORDT XONXOFF GEBRUIKT.
    1344    1033   005A6                  ;
    1345    1034   005A6                  ; de routine gebruikt geen registers.
    1346    1035   005A6                  ;
    1347    1036   005A6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1348    1037   005A6                  
    1349    1038   005A6                  siooutbyte:
    1350    1039   005A6 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1351    1040   005A8 C0D0                           push   psw
    1352    1041   005AA C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1353    1042   005AC C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1354    1043   005AD 120592                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1355    1044   005B0 D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1356    1045   005B2 120592                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1357    1046   005B5 D0D0                           pop    psw           ;registers herstellen
    1358    1047   005B7 D0E0                           pop    acc
    1359    1048   005B9 22                             RET
    1360    1049   005BA                  
    1361    1050   005BA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1362    1051   005BA                  ;
    1363    1052   005BA                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1364    1053   005BA                  ; VAN DE CURSOR.
    1365    1054   005BA                  ;
    1366    1055   005BA                  ; de routine gebruikt geen registers.
    1367    1056   005BA                  ;
    1368    1057   005BA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1369    1058   005BA                  
    1370    1059   005BA                  siodispdptr:
    1371    1060   005BA C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1372    1061   005BC C0D0                           push   psw
    1373    1062   005BE E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1374    1063   005C0 1205A6                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1375    1064   005C3 E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1376    1065   005C5 1205A6                         LCALL  OUTBYTE       ;WEG ER MEE
    1377    1066   005C8 D0D0                           pop    psw           ;registers herstellen
    1378    1067   005CA D0E0                           pop    acc
    1379    1068   005CC 22                             RET                  ;EINDE
    1380    1069   005CD                  
    1381    1070   005CD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1382    1071   005CD                  ;
    1383    1072   005CD                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1384    1073   005CD                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1385    1074   005CD                  ;
    1386    1075   005CD                  ; de routine gebruikt geen registers.
    1387    1076   005CD                  ;
    1388    1077   005CD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1389    1078   005CD                  
    1390    1079   005CD                  siooutmsga:
    1391    1080   005CD C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1392    1081   005CF C0D0                           push   psw
    1393    1082   005D1 C082                           push   dpl
    1394    1083   005D3 C083                           push   dph
    1395    1084   005D5 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1396    1085   005D6 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1397    1086   005D7 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1398    1087   005D9 12058A                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1399    1088   005DC 1205EB                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1400    1089   005DF A3                             INC    DPTR          ;DPTR AANPASSEN
    1401    1090   005E0 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1402    1091   005E2 D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1403    1092   005E4 D082                           pop    dpl
    1404    1093   005E6 D0D0                           pop    psw
    1405    1094   005E8 D0E0                           pop    acc
    1406    1095   005EA 22                             RET                  ;EINDE ROUTINE
    1407    1096   005EB                  
    1408    1097   005EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1409    1098   005EB                  ;
    1410    1099   005EB                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1411    1100   005EB                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1412    1101   005EB                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1413    1102   005EB                  ; VERDER DOORGEGEVEN.
    1414    1103   005EB                  ;
    1415    1104   005EB                  ; de routine gebruikt geen registers.
    1416    1105   005EB                  ;
    1417    1106   005EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1418    1107   005EB                  
    1419    1108   005EB C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1420    1109   005ED C0D0                           push   psw
    1421    1110   005EF 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1422    1111   005F2 D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1423    1112   005F4 D0E0                           pop    acc
    1424    1113   005F6 22                             RET                  ;ANDERS EINDE
    1425    1114   005F7 E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1426    1115   005F9 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1427    1116   005FC 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1428    1117   005FF 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1429    1118   00601                  
    1430    1119   00601                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1431    1120   00601                  ;
    1432    1121   00601                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1433    1122   00601                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1434    1123   00601                  ;
    1435    1124   00601                  ; de routine gebruikt de accu.
    1436    1125   00601                  ;
    1437    1126   00601                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1438    1127   00601                  
    1439    1128   00601                  sioinchar:
    1440    1129   00601 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1441    1130   00604 C298                           CLR    RI                   ;BIT LAAG MAKEN
    1442    1131   00606 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1443    1132   00608 22                             RET
    1444    1133   00609                  
    1445    1134   00609                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1446    1135   00609                  ;
    1447    1136   00609                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1448    1137   00609                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1449    1138   00609                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1450    1139   00609                  ; DE CARRY OP 1 GEZET WORDEN.
    1451    1140   00609                  ;
    1452    1141   00609                  ; De routine gebruikt de accu, r0 en de psw.
    1453    1142   00609                  ;
    1454    1143   00609                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1455    1144   00609                  
    1456    1145   00609                  sioinbyte:
    1457    1146   00609 120601           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1458    1147   0060C 120675                         LCALL  LOWUPTR
    1459    1148   0060F 12068C                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1460    1149   00612 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1461    1150   00614 C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1462    1151   00615 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1463    1152   00616 120601                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1464    1153   00619 120675                         LCALL  LOWUPTR
    1465    1154   0061C 12068C                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1466    1155   0061F 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1467    1156   00621 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1468    1157   00622 22               INBYTE1:      RET
    1469    1158   00623                  
    1470    1159   00623                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1471    1160   00623                  ;
    1472    1161   00623                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1473    1162   00623                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1474    1163   00623                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1475    1164   00623                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1476    1165   00623                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1477    1166   00623                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1478    1167   00623                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1479    1168   00623                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1480    1169   00623                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1481    1170   00623                  ; bepalen.
    1482    1171   00623                  ;
    1483    1172   00623                  ; De routine gebruikt de accu, r0 en de psw.
    1484    1173   00623                  ;
    1485    1174   00623                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1486    1175   00623                  
    1487    1176   00623                  sioinbufa:
    1488    1177   00623 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1489    1178   00625 120601           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1490    1179   00628 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1491    1180   0062A                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1492    1181   0062A                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1493    1182   0062A                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1494    1183   0062A                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1495    1184   0062A                  ; GEVOERD.
    1496    1185   0062A 120675                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1497    1186   0062D B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1498    1187   00630 F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1499    1188   00631 22                             RET                         ;EINDE VAN DE ROUTINE
    1500    1189   00632 B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1501    1190   00635 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1502    1191   00638 7407             INBUFA4:      MOV    A,#BEEP
    1503    1192   0063A 12058A           INBUFA7:      LCALL  OUTCHAR
    1504    1193   0063D 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1505    1194   0063F 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1506    1195   00640 90054E                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1507    1196   00643 1205CD                         LCALL  OUTMSGA
    1508    1197   00646 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1509    1198   00648 120667           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1510    1199   0064B 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1511    1200   0064D B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1512    1201   00650 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1513    1202   00652 F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1514    1203   00653 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1515    1204   00654 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1516    1205   00656                  
    1517    1206   00656                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1518    1207   00656                  ;
    1519    1208   00656                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1520    1209   00656                  ;
    1521    1210   00656                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1522    1211   00656                  ;
    1523    1212   00656                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1524    1213   00656                  
    1525    1214   00656 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1526    1215   00658 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1527    1216   0065A E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1528    1217   0065B B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1529    1218   0065E 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1530    1219   0065F B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1531    1220   00662 22                             RET                         ;EINDE VAN DE ROUTINE
    1532    1221   00663 F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1533    1222   00664 09                             INC    R1
    1534    1223   00665 80F7                           SJMP   BDELETE3
    1535    1224   00667                  
    1536    1225   00667                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1537    1226   00667                  ;
    1538    1227   00667                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1539    1228   00667                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1540    1229   00667                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1541    1230   00667                  ; AANZIEN.
    1542    1231   00667                  ;
    1543    1232   00667                  ; De routine gebruikt de accu en de psw.
    1544    1233   00667                  ;
    1545    1234   00667                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1546    1235   00667                  
    1547    1236   00667 B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1548    1237   0066A 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1549    1238   0066C B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1550    1239   0066F 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1551    1240   00671 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1552    1241   00672 22                             RET
    1553    1242   00673 D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1554    1243   00674 22                             RET
    1555    1244   00675                  
    1556    1245   00675                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1557    1246   00675                  ;
    1558    1247   00675                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1559    1248   00675                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1560    1249   00675                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1561    1250   00675                  ; AANGEPAST WORDEN.
    1562    1251   00675                  ;
    1563    1252   00675                  ; De routine gebruikt de accu en de psw.
    1564    1253   00675                  ;
    1565    1254   00675                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1566    1255   00675                  
    1567    1256   00675 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1568    1257   00678 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1569    1258   0067A B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1570    1259   0067D 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1571    1260   0067F 9420                           SUBB   A,#020H              ;OMZETTING
    1572    1261   00681 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1573    1262   00682                  
    1574    1263   00682                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1575    1264   00682                  ;
    1576    1265   00682                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1577    1266   00682                  ; ASCII CODE.
    1578    1267   00682                  ;
    1579    1268   00682                  ; De routine gebruikt de accu en de psw.
    1580    1269   00682                  ;
    1581    1270   00682                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1582    1271   00682                  
    1583    1272   00682 B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1584    1273   00685 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1585    1274   00687 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1586    1275   00689 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1587    1276   0068B 22                             RET
    1588    1277   0068C                  
    1589    1278   0068C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1590    1279   0068C                  ;
    1591    1280   0068C                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1592    1281   0068C                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1593    1282   0068C                  ; GEVAL WORDT DE CARRY GEZET.
    1594    1283   0068C                  ;
    1595    1284   0068C                  ; De routine gebruikt de accu en de psw.
    1596    1285   0068C                  ;
    1597    1286   0068C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1598    1287   0068C                  
    1599    1288   0068C C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1600    1289   0068D 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1601    1290   0068F 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1602    1291   00691 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1603    1292   00694 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1604    1293   00696 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1605    1294   00698 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1606    1295   0069A B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1607    1296   0069D B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1608    1297   0069E 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1609    1298   006A0 C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1610    1299   006A1 22               ASCBINTRANS1: RET
    1611    1300   006A2                  
    1612    1301   006A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1613    1302   006A2                  ;
    1614    1303   006A2                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1615    1304   006A2                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1616    1305   006A2                  ;
    1617    1306   006A2                  ; De routine gebruikt de accu en de psw.
    1618    1307   006A2                  ;
    1619    1308   006A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1620    1309   006A2                  
    1621    1310   006A2 E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1622    1311   006A3 12068C                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1623    1312   006A6 22                             RET                         ;EINDE OMZETTING
    1624    1313   006A7                  
    1625    1314   006A7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1626    1315   006A7                  ;
    1627    1316   006A7                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1628    1317   006A7                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1629    1318   006A7                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1630    1319   006A7                  ;
    1631    1320   006A7                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1632    1321   006A7                  ;
    1633    1322   006A7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1634    1323   006A7                  
    1635    1324   006A7 1206A2           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1636    1325   006AA 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1637    1326   006AC C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1638    1327   006AD F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1639    1328   006AE 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1640    1329   006AF 1206A2                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1641    1330   006B2 4001                           JC     ASCII21               ;WEG ALS C=1
    1642    1331   006B4 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1643    1332   006B5 22               ASCII21:      RET
    1644    1333   006B6                  
    1645    1334   006B6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1646    1335   006B6                  ;
    1647    1336   006B6                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1648    1337   006B6                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1649    1338   006B6                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1650    1339   006B6                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1651    1340   006B6                  ;
    1652    1341   006B6                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1653    1342   006B6                  ;
    1654    1343   006B6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1655    1344   006B6                  
    1656    1345   006B6 1206A7           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1657    1346   006B9 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1658    1347   006BB F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1659    1348   006BD 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1660    1349   006BE 1206A7                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1661    1350   006C1 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1662    1351   006C3 F582                           MOV    DPL,A                ;IN DPTR LADEN
    1663    1352   006C5 22               ASCII41:      RET
    1664    1353   006C6                  
    1665    1354   006C6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1666    1355   006C6                  ;
    1667    1356   006C6                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1668    1357   006C6                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1669    1358   006C6                  ; geschakeld worden.
    1670    1359   006C6                  ;
    1671    1360   006C6                  ; Gebruikt geen registers
    1672    1361   006C6                  ;
    1673    1362   006C6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1674    1363   006C6                  
    1675    1364   006C6 C08F             initadc:      push   syscon0                     ;map saven
    1676    1365   006C8 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1677    1366   006CB 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1678    1367   006CE 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1679    1368   006D1                                                                   ;klok delen door 32 (750kHz)
    1680    1369   006D1                                                                   ;10 bit uitkomst
    1681    1370   006D1 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1682    1371   006D4                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1683    1372   006D4 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1684    1373   006D7 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1685    1374   006DA 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1686    1375   006DD D08F                           pop    syscon0                     ;herstellen syscon
    1687    1376   006DF 22                             ret
    1688    1377   006E0                  
    1689    1378   006E0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1690    1379   006E0                  ;
    1691    1380   006E0                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1692    1381   006E0                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1693    1382   006E0                  ;
    1694    1383   006E0                  ; Gebruikt:
    1695    1384   006E0                  ;      -accu als 8 msb meting
    1696    1385   006E0                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1697    1386   006E0                  ;
    1698    1387   006E0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1699    1388   006E0                  
    1700    1389   006E0 C08F             adclm335:     push   syscon0
    1701    1390   006E2 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1702    1391   006E5 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1703    1392   006E8 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1704    1393   006EB 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1705    1394   006EE 00               		nop
    1706    1395   006EF 00               		nop					;anders loopt het mis met het testen van de ready bit
    1707    1396   006F0 E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1708    1397   006F2 20E0FB                         jb     acc.0,adclm3351
    1709    1398   006F5 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1710    1399   006F8 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1711    1400   006FA 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1712    1401   006FD D08F                           pop    syscon0
    1713    1402   006FF 22                             ret
    1714    1403   00700                  
    1715    1404   00700                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1716    1405   00700                  ;
    1717    1406   00700                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1718    1407   00700                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1719    1408   00700                  ;
    1720    1409   00700                  ; Gebruikt:
    1721    1410   00700                  ;      -accu als 8 msb meting
    1722    1411   00700                  ;      -b als 2 lsb meting (links afgelijnd)
    1723    1412   00700                  ;
    1724    1413   00700                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1725    1414   00700                  
    1726    1415   00700 C08F             adcpotmeter:  push   syscon0
    1727    1416   00702 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1728    1417   00705 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1729    1418   00708 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1730    1419   0070B 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1731    1420   0070E 00               		nop
    1732    1421   0070F 00               		nop					;anders loopt het mis met het testen van de ready bit
    1733    1422   00710 E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1734    1423   00712 20E0FB                         jb     acc.0,adcpotmeter1
    1735    1424   00715 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1736    1425   00718 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1737    1426   0071A 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1738    1427   0071D D08F                           pop    syscon0
    1739    1428   0071F                  
    1740    1429   0071F                  
    1741    1430   0071F 22                             ret
    1742    1431   00720                  
    1743    1432   00720                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1744    1433   00720                  ;
    1745    1434   00720                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1746    1435   00720                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1747    1436   00720                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1748    1437   00720                  ; doelstellingen in het achterhoofd.
    1749    1438   00720                  ;
    1750    1439   00720                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1751    1440   00720                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1752    1441   00720                  ; bcd)
    1753    1442   00720                  ;      8bit hex naar bcd
    1754    1443   00720                  ;      8bit bcd naar hex
    1755    1444   00720                  ;
    1756    1445   00720                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1757    1446   00720                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1758    1447   00720                  ;      16*16 bit met 32 bit uitkomst
    1759    1448   00720                  ;      16+16 bit met 24 bit uitkomst
    1760    1449   00720                  ;      16-16 bit met 24 bit uitkomst
    1761    1450   00720                  ;      16bit hex naar bcd
    1762    1451   00720                  ;      16bit bcd naar hex
    1763    1452   00720                  ;
    1764    1453   00720                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1765    1454   00720                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1766    1455   00720                  ;      32*32 bit met 64 bit uitkomst
    1767    1456   00720                  ;      32+32 bit met 40 bit uitkomst
    1768    1457   00720                  ;      32-32 bit met 40 bit uitkomst
    1769    1458   00720                  ;
    1770    1459   00720                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1771    1460   00720                  ;
    1772    1461   00720                  ; De routines gebruiken als input en output de huidige registerbank.
    1773    1462   00720                  ;
    1774    1463   00720                  ;
    1775    1464   00720                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1776    1465   00720                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1777    1466   00720                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1778    1467   00720                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1779    1468   00720                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1780    1469   00720                  ;
    1781    1470   00720                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1782    1471   00720                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1783    1472   00720                  ;      -routines gebruiken geen MDU!
    1784    1473   00720                  ;
    1785    1474   00720                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1786    1475   00720                  
    1787    1476   00720                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1788    1477   00720                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1789    1478   00720                  
    1790    1479   00720                  h0            equ    070h
    1791    1480   00720                  h1            equ    071h
    1792    1481   00720                  h2            equ    072h
    1793    1482   00720                  h3            equ    073h
    1794    1483   00720                  h4            equ    074h
    1795    1484   00720                  h5            equ    075h
    1796    1485   00720                  h6            equ    076h
    1797    1486   00720                  h7            equ    077h
    1798    1487   00720                  h8            equ    078h
    1799    1488   00720                  h9            equ    079h
    1800    1489   00720                  h10           equ    07ah
    1801    1490   00720                  h11           equ    07bh
    1802    1491   00720                  h12           equ    07ch
    1803    1492   00720                  
    1804    1493   00720                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1805    1494   00720                  ;
    1806    1495   00720                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1807    1496   00720                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1808    1497   00720                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1809    1498   00720                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1810    1499   00720                  ;
    1811    1500   00720                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1812    1501   00720                  ;
    1813    1502   00720                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1814    1503   00720                  
    1815    1504   00720 C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1816    1505   00722 C0D0                           push   psw
    1817    1506   00724 C070                           push   h0
    1818    1507   00726 C071                           push   h1
    1819    1508   00728 C072                           push   h2
    1820    1509   0072A C073                           push   h3
    1821    1510   0072C C074                           push   h4
    1822    1511   0072E C075                           push   h5
    1823    1512   00730 C076                           push   h6
    1824    1513   00732 C077                           push   h7
    1825    1514   00734 C078                           push   h8
    1826    1515   00736 C079                           push   h9
    1827    1516   00738 C07A                           push   h10
    1828    1517   0073A C07B                           push   h11
    1829    1518   0073C C07C                           push   h12
    1830    1519   0073E                  
    1831    1520   0073E                  ; eerst moeten de hulpregisters klaar gezet worden
    1832    1521   0073E                  
    1833    1522   0073E 757000                         mov    h0,#000h
    1834    1523   00741 757100                         mov    h1,#000h
    1835    1524   00744 757200                         mov    h2,#000h
    1836    1525   00747 757300                         mov    h3,#000h
    1837    1526   0074A 757400                         mov    h4,#000h
    1838    1527   0074D 757500                         mov    h5,#000h
    1839    1528   00750 757600                         mov    h6,#000h
    1840    1529   00753 757700                         mov    h7,#000h
    1841    1530   00756 757800                         mov    h8,#000h
    1842    1531   00759 757900                         mov    h9,#000h
    1843    1532   0075C 757A00                         mov    h10,#000h
    1844    1533   0075F 757B00                         mov    h11,#000h
    1845    1534   00762 757C20                         mov    h12,#32              ;loopcounter
    1846    1535   00765                  
    1847    1536   00765                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1848    1537   00765                  
    1849    1538   00765                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1850    1539   00765                  
    1851    1540   00765 EB               mul321:       mov    a,r3
    1852    1541   00766 13                             rrc    a
    1853    1542   00767 FB                             mov    r3,a
    1854    1543   00768 EA                             mov    a,r2
    1855    1544   00769 13                             rrc    a
    1856    1545   0076A FA                             mov    r2,a
    1857    1546   0076B E9                             mov    a,r1
    1858    1547   0076C 13                             rrc    a
    1859    1548   0076D F9                             mov    r1,a
    1860    1549   0076E E8                             mov    a,r0
    1861    1550   0076F 13                             rrc    a
    1862    1551   00770 F8                             mov    r0,a                 ;32 bit shift klaar
    1863    1552   00771                  
    1864    1553   00771                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1865    1554   00771                  
    1866    1555   00771 502C                           jnc    mul322               ;optelling niet nodig
    1867    1556   00773                  
    1868    1557   00773                  ; hier staat en 64 bit optelling
    1869    1558   00773                  
    1870    1559   00773 EC                             mov    a,r4
    1871    1560   00774 2574                           add    a,h4
    1872    1561   00776 F574                           mov    h4,a
    1873    1562   00778 ED                             mov    a,r5
    1874    1563   00779 3575                           addc   a,h5
    1875    1564   0077B F575                           mov    h5,a
    1876    1565   0077D EE                             mov    a,r6
    1877    1566   0077E 3576                           addc   a,h6
    1878    1567   00780 F576                           mov    h6,a
    1879    1568   00782 EF                             mov    a,r7
    1880    1569   00783 3577                           addc   a,h7
    1881    1570   00785 F577                           mov    h7,a
    1882    1571   00787 E570                           mov    a,h0
    1883    1572   00789 3578                           addc   a,h8
    1884    1573   0078B F578                           mov    h8,a
    1885    1574   0078D E571                           mov    a,h1
    1886    1575   0078F 3579                           addc   a,h9
    1887    1576   00791 F579                           mov    h9,a
    1888    1577   00793 E572                           mov    a,h2
    1889    1578   00795 357A                           addc   a,h10
    1890    1579   00797 F57A                           mov    h10,a
    1891    1580   00799 E573                           mov    a,h3
    1892    1581   0079B 357B                           addc   a,h11
    1893    1582   0079D F57B                           mov    h11,a                ;optelling klaar
    1894    1583   0079F                  
    1895    1584   0079F                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1896    1585   0079F                  
    1897    1586   0079F C3               mul322:       clr    c                    ;moet op 0 staan
    1898    1587   007A0 EC                             mov    a,r4
    1899    1588   007A1 33                             rlc    a
    1900    1589   007A2 FC                             mov    r4,a
    1901    1590   007A3 ED                             mov    a,r5
    1902    1591   007A4 33                             rlc    a
    1903    1592   007A5 FD                             mov    r5,a
    1904    1593   007A6 EE                             mov    a,r6
    1905    1594   007A7 33                             rlc    a
    1906    1595   007A8 FE                             mov    r6,a
    1907    1596   007A9 EF                             mov    a,r7
    1908    1597   007AA 33                             rlc    a
    1909    1598   007AB FF                             mov    r7,a
    1910    1599   007AC E570                           mov    a,h0
    1911    1600   007AE 33                             rlc    a
    1912    1601   007AF F570                           mov    h0,a
    1913    1602   007B1 E571                           mov    a,h1
    1914    1603   007B3 33                             rlc    a
    1915    1604   007B4 F571                           mov    h1,a
    1916    1605   007B6 E572                           mov    a,h2
    1917    1606   007B8 33                             rlc    a
    1918    1607   007B9 F572                           mov    h2,a
    1919    1608   007BB E573                           mov    a,h3
    1920    1609   007BD 33                             rlc    a
    1921    1610   007BE F573                           mov    h3,a
    1922    1611   007C0                  
    1923    1612   007C0 D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1924    1613   007C3                  
    1925    1614   007C3                  ; de uitkomst moet in de juiste registers komen
    1926    1615   007C3                  
    1927    1616   007C3 A874                           mov    r0,h4
    1928    1617   007C5 A975                           mov    r1,h5
    1929    1618   007C7 AA76                           mov    r2,h6
    1930    1619   007C9 AB77                           mov    r3,h7
    1931    1620   007CB AC78                           mov    r4,h8
    1932    1621   007CD AD79                           mov    r5,h9
    1933    1622   007CF AE7A                           mov    r6,h10
    1934    1623   007D1 AF7B                           mov    r7,h11               ;klaar
    1935    1624   007D3                  
    1936    1625   007D3 D07C                           pop    h12                  ;registers herstellen
    1937    1626   007D5 D07B                           pop    h11
    1938    1627   007D7 D07A                           pop    h10
    1939    1628   007D9 D079                           pop    h9
    1940    1629   007DB D078                           pop    h8
    1941    1630   007DD D077                           pop    h7
    1942    1631   007DF D076                           pop    h6
    1943    1632   007E1 D075                           pop    h5
    1944    1633   007E3 D074                           pop    h4
    1945    1634   007E5 D073                           pop    h3
    1946    1635   007E7 D072                           pop    h2
    1947    1636   007E9 D071                           pop    h1
    1948    1637   007EB D070                           pop    h0
    1949    1638   007ED D0D0                           pop    psw
    1950    1639   007EF D0E0                           pop    acc
    1951    1640   007F1 22                             ret
    1952    1641   007F2                  
    1953    1642   007F2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1954    1643   007F2                  ;
    1955    1644   007F2                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1956    1645   007F2                  ; input:      r1,r0 = eerste getal (r1=msb)
    1957    1646   007F2                  ;             r3,r2 = tweede getal (r3=msb)
    1958    1647   007F2                  ; output:     r3,r2,r1,r0 met r3=msb
    1959    1648   007F2                  ;
    1960    1649   007F2                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1961    1650   007F2                  ;
    1962    1651   007F2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1963    1652   007F2                  
    1964    1653   007F2 C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1965    1654   007F4 C0D0                           push   psw
    1966    1655   007F6 C070                           push   h0
    1967    1656   007F8 C071                           push   h1
    1968    1657   007FA C072                           push   h2
    1969    1658   007FC C073                           push   h3
    1970    1659   007FE C074                           push   h4
    1971    1660   00800 C075                           push   h5
    1972    1661   00802 C076                           push   h6
    1973    1662   00804                  
    1974    1663   00804                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1975    1664   00804                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1976    1665   00804                  ; h6 is de loopcounter.
    1977    1666   00804                  
    1978    1667   00804 757000                         mov    h0,#000h
    1979    1668   00807 757100                         mov    h1,#000h
    1980    1669   0080A 757200                         mov    h2,#000h
    1981    1670   0080D 757300                         mov    h3,#000h
    1982    1671   00810 757400                         mov    h4,#000h
    1983    1672   00813 757500                         mov    h5,#000h
    1984    1673   00816 757610                         mov    h6,#16               ;loopcounter
    1985    1674   00819                  
    1986    1675   00819                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1987    1676   00819                  ; berekening
    1988    1677   00819                  
    1989    1678   00819 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1990    1679   0081A 13                             rrc    a
    1991    1680   0081B F9                             mov    r1,a
    1992    1681   0081C E8                             mov    a,r0
    1993    1682   0081D 13                             rrc    a
    1994    1683   0081E F8                             mov    r0,a                 ;ok
    1995    1684   0081F                  
    1996    1685   0081F                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1997    1686   0081F                  
    1998    1687   0081F 5016                           jnc    mul162
    1999    1688   00821                  
    2000    1689   00821 EA                             mov    a,r2
    2001    1690   00822 2572                           add    a,h2
    2002    1691   00824 F572                           mov    h2,a                 ;32 bit som uitvoeren
    2003    1692   00826 EB                             mov    a,r3
    2004    1693   00827 3573                           addc   a,h3
    2005    1694   00829 F573                           mov    h3,a
    2006    1695   0082B E570                           mov    a,h0
    2007    1696   0082D 3574                           addc   a,h4
    2008    1697   0082F F574                           mov    h4,a
    2009    1698   00831 E571                           mov    a,h1
    2010    1699   00833 3575                           addc   a,h5
    2011    1700   00835 F575                           mov    h5,a                 ;klaar
    2012    1701   00837                  
    2013    1702   00837                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    2014    1703   00837                  
    2015    1704   00837 C3               mul162:       clr    c
    2016    1705   00838 EA                             mov    a,r2
    2017    1706   00839 33                             rlc    a
    2018    1707   0083A FA                             mov    r2,a                 ;ook 32 bit getal
    2019    1708   0083B EB                             mov    a,r3
    2020    1709   0083C 33                             rlc    a
    2021    1710   0083D FB                             mov    r3,a
    2022    1711   0083E E570                           mov    a,h0
    2023    1712   00840 33                             rlc    a
    2024    1713   00841 F570                           mov    h0,a
    2025    1714   00843 E571                           mov    a,h1
    2026    1715   00845 33                             rlc    a
    2027    1716   00846 F571                           mov    h1,a                 ;klaar
    2028    1717   00848                  
    2029    1718   00848 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    2030    1719   0084B                  
    2031    1720   0084B                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    2032    1721   0084B                  
    2033    1722   0084B A872                           mov    r0,h2
    2034    1723   0084D A973                           mov    r1,h3
    2035    1724   0084F AA74                           mov    r2,h4
    2036    1725   00851 AB75                           mov    r3,h5                ;klaar
    2037    1726   00853                  
    2038    1727   00853                  
    2039    1728   00853 D076                           pop    h6                   ;registers herstellen
    2040    1729   00855 D075                           pop    h5
    2041    1730   00857 D074                           pop    h4
    2042    1731   00859 D073                           pop    h3
    2043    1732   0085B D072                           pop    h2
    2044    1733   0085D D071                           pop    h1
    2045    1734   0085F D070                           pop    h0
    2046    1735   00861 D0D0                           pop    psw
    2047    1736   00863 D0E0                           pop    acc
    2048    1737   00865 22                             ret
    2049    1738   00866                  
    2050    1739   00866                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2051    1740   00866                  ;
    2052    1741   00866                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2053    1742   00866                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2054    1743   00866                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2055    1744   00866                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2056    1745   00866                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2057    1746   00866                  ;             carry=1 bij delen door 0
    2058    1747   00866                  ;
    2059    1748   00866                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2060    1749   00866                  ;
    2061    1750   00866                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2062    1751   00866                  
    2063    1752   00866 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2064    1753   00868 C0D0                           push   psw
    2065    1754   0086A C070                           push   h0
    2066    1755   0086C C071                           push   h1
    2067    1756   0086E C072                           push   h2
    2068    1757   00870 C073                           push   h3
    2069    1758   00872 C074                           push   h4
    2070    1759   00874 C075                           push   h5
    2071    1760   00876 C076                           push   h6
    2072    1761   00878 C077                           push   h7
    2073    1762   0087A C078                           push   h8
    2074    1763   0087C C079                           push   h9
    2075    1764   0087E C07A                           push   h10
    2076    1765   00880 C07B                           push   h11
    2077    1766   00882 C07C                           push   h12
    2078    1767   00884                  
    2079    1768   00884                  ; eerst alles voorladen
    2080    1769   00884                  
    2081    1770   00884 757000                         mov    h0,#000h
    2082    1771   00887 757100                         mov    h1,#000h
    2083    1772   0088A 757200                         mov    h2,#000h
    2084    1773   0088D 757300                         mov    h3,#000h
    2085    1774   00890 757400                         mov    h4,#000h
    2086    1775   00893 757500                         mov    h5,#000h
    2087    1776   00896 757600                         mov    h6,#000h
    2088    1777   00899 757700                         mov    h7,#000h
    2089    1778   0089C 757800                         mov    h8,#000h
    2090    1779   0089F 757900                         mov    h9,#000h
    2091    1780   008A2 757A00                         mov    h10,#000h
    2092    1781   008A5 757B00                         mov    h11,#000h
    2093    1782   008A8 757C20                         mov    h12,#32              ;loopcounter
    2094    1783   008AB                  
    2095    1784   008AB                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2096    1785   008AB                  
    2097    1786   008AB                  ; deze lus moet 32 keer heraald worden
    2098    1787   008AB                  
    2099    1788   008AB E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2100    1789   008AC 33                             rlc    a
    2101    1790   008AD F8                             mov    r0,a
    2102    1791   008AE E9                             mov    a,r1
    2103    1792   008AF 33                             rlc    a
    2104    1793   008B0 F9                             mov    r1,a
    2105    1794   008B1 EA                             mov    a,r2
    2106    1795   008B2 33                             rlc    a
    2107    1796   008B3 FA                             mov    r2,a
    2108    1797   008B4 EB                             mov    a,r3
    2109    1798   008B5 33                             rlc    a
    2110    1799   008B6 FB                             mov    r3,a
    2111    1800   008B7 E570                           mov    a,h0
    2112    1801   008B9 33                             rlc    a
    2113    1802   008BA F570                           mov    h0,a
    2114    1803   008BC E571                           mov    a,h1
    2115    1804   008BE 33                             rlc    a
    2116    1805   008BF F571                           mov    h1,a
    2117    1806   008C1 E572                           mov    a,h2
    2118    1807   008C3 33                             rlc    a
    2119    1808   008C4 F572                           mov    h2,a
    2120    1809   008C6 E573                           mov    a,h3
    2121    1810   008C8 33                             rlc    a
    2122    1811   008C9 F573                           mov    h3,a
    2123    1812   008CB                  
    2124    1813   008CB                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2125    1814   008CB                  
    2126    1815   008CB C3                             clr    c                    ;zit in de weg
    2127    1816   008CC E570                           mov    a,h0
    2128    1817   008CE 9C                             subb   a,r4
    2129    1818   008CF F574                           mov    h4,a
    2130    1819   008D1 E571                           mov    a,h1
    2131    1820   008D3 9D                             subb   a,r5
    2132    1821   008D4 F575                           mov    h5,a
    2133    1822   008D6 E572                           mov    a,h2
    2134    1823   008D8 9E                             subb   a,r6
    2135    1824   008D9 F576                           mov    h6,a
    2136    1825   008DB E573                           mov    a,h3
    2137    1826   008DD 9F                             subb   a,r7
    2138    1827   008DE F577                           mov    h7,a
    2139    1828   008E0                  
    2140    1829   008E0                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2141    1830   008E0                  ; vervangen worden door h7-h4
    2142    1831   008E0                  
    2143    1832   008E0 400C                           jc     div322               ;niet vervangen
    2144    1833   008E2                  
    2145    1834   008E2 857470                         mov    h0,h4
    2146    1835   008E5 857571                         mov    h1,h5
    2147    1836   008E8 857672                         mov    h2,h6
    2148    1837   008EB 857773                         mov    h3,h7                ;vervanging klaar
    2149    1838   008EE                  
    2150    1839   008EE B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2151    1840   008EF E578                           mov    a,h8
    2152    1841   008F1 33                             rlc    a
    2153    1842   008F2 F578                           mov    h8,a
    2154    1843   008F4 E579                           mov    a,h9
    2155    1844   008F6 33                             rlc    a
    2156    1845   008F7 F579                           mov    h9,a
    2157    1846   008F9 E57A                           mov    a,h10
    2158    1847   008FB 33                             rlc    a
    2159    1848   008FC F57A                           mov    h10,a
    2160    1849   008FE E57B                           mov    a,h11
    2161    1850   00900 33                             rlc    a
    2162    1851   00901 F57B                           mov    h11,a                ;qoutient aangepast
    2163    1852   00903                  
    2164    1853   00903 D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2165    1854   00906                  
    2166    1855   00906                  ; de berekening is klaar. uitkomstregisters nog laden
    2167    1856   00906                  
    2168    1857   00906 AC78                           mov    r4,h8
    2169    1858   00908 AD79                           mov    r5,h9
    2170    1859   0090A AE7A                           mov    r6,h10
    2171    1860   0090C AF7B                           mov    r7,h11               ;uitkomst geladen
    2172    1861   0090E                  
    2173    1862   0090E A870                           mov    r0,h0                ;rest laden
    2174    1863   00910 A971                           mov    r1,h1
    2175    1864   00912 AA72                           mov    r2,h2
    2176    1865   00914 AB73                           mov    r3,h3
    2177    1866   00916                  
    2178    1867   00916 D07C                           pop    h12                  ;registers herstellen
    2179    1868   00918 D07B                           pop    h11
    2180    1869   0091A D07A                           pop    h10
    2181    1870   0091C D079                           pop    h9
    2182    1871   0091E D078                           pop    h8
    2183    1872   00920 D077                           pop    h7
    2184    1873   00922 D076                           pop    h6
    2185    1874   00924 D075                           pop    h5
    2186    1875   00926 D074                           pop    h4
    2187    1876   00928 D073                           pop    h3
    2188    1877   0092A D072                           pop    h2
    2189    1878   0092C D071                           pop    h1
    2190    1879   0092E D070                           pop    h0
    2191    1880   00930 D0D0                           pop    psw
    2192    1881   00932 D0E0                           pop    acc
    2193    1882   00934 22                             ret
    2194    1883   00935                  
    2195    1884   00935                  
    2196    1885   00935                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2197    1886   00935                  ;
    2198    1887   00935                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2199    1888   00935                  ; input:      r1,r0 = eerste getal (r1=msb)
    2200    1889   00935                  ;             r3,r2 = tweede getal (r3=msb)
    2201    1890   00935                  ; output:     r3,r2 = quotient (r3=msb)
    2202    1891   00935                  ;             r1,r0 = rest (r1=msb)
    2203    1892   00935                  ;             carry=1 bij deling door 0
    2204    1893   00935                  ;
    2205    1894   00935                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2206    1895   00935                  
    2207    1896   00935 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2208    1897   00937 C0D0                           push   psw
    2209    1898   00939 C070                           push   h0
    2210    1899   0093B C071                           push   h1
    2211    1900   0093D C072                           push   h2
    2212    1901   0093F C073                           push   h3
    2213    1902   00941 C074                           push   h4
    2214    1903   00943 C075                           push   h5
    2215    1904   00945 C076                           push   h6
    2216    1905   00947                  
    2217    1906   00947                  ; registers voorladen
    2218    1907   00947                  
    2219    1908   00947 757000                         mov    h0,#000h
    2220    1909   0094A 757100                         mov    h1,#000h
    2221    1910   0094D 757200                         mov    h2,#000h
    2222    1911   00950 757300                         mov    h3,#000h
    2223    1912   00953 757400                         mov    h4,#000h
    2224    1913   00956 757500                         mov    h5,#000h
    2225    1914   00959 757610                         mov    h6,#16               ;loopcounter
    2226    1915   0095C                  
    2227    1916   0095C                  ; eerst te delen getal 1*links shiften in hulpregisters
    2228    1917   0095C                  
    2229    1918   0095C                  ; deze lus moet 16 keer herhaald worden
    2230    1919   0095C                  
    2231    1920   0095C E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2232    1921   0095D 33                             rlc    a
    2233    1922   0095E F8                             mov    r0,a
    2234    1923   0095F E9                             mov    a,r1
    2235    1924   00960 33                             rlc    a
    2236    1925   00961 F9                             mov    r1,a
    2237    1926   00962 E570                           mov    a,h0
    2238    1927   00964 33                             rlc    a
    2239    1928   00965 F570                           mov    h0,a
    2240    1929   00967 E571                           mov    a,h1
    2241    1930   00969 33                             rlc    a
    2242    1931   0096A F571                           mov    h1,a
    2243    1932   0096C                  
    2244    1933   0096C                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2245    1934   0096C                  ; het tussenresultaat.
    2246    1935   0096C                  
    2247    1936   0096C C3                             clr    c
    2248    1937   0096D E570                           mov    a,h0
    2249    1938   0096F 9A                             subb   a,r2
    2250    1939   00970 F572                           mov    h2,a
    2251    1940   00972 E571                           mov    a,h1
    2252    1941   00974 9B                             subb   a,r3
    2253    1942   00975 F573                           mov    h3,a
    2254    1943   00977                  
    2255    1944   00977 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2256    1945   00979                                                            ;door h3,h2
    2257    1946   00979 857270                         mov    h0,h2
    2258    1947   0097C 857371                         mov    h1,h3                ;vervanging klaar
    2259    1948   0097F                  
    2260    1949   0097F                  ; uitkomst moet aangepast worden
    2261    1950   0097F                  
    2262    1951   0097F B3               div162:       cpl    c                    ;truuk
    2263    1952   00980 E574                           mov    a,h4
    2264    1953   00982 33                             rlc    a
    2265    1954   00983 F574                           mov    h4,a
    2266    1955   00985 E575                           mov    a,h5
    2267    1956   00987 33                             rlc    a
    2268    1957   00988 F575                           mov    h5,a
    2269    1958   0098A D576CF                         djnz   h6,div161            ;16 keer herhalen
    2270    1959   0098D                  
    2271    1960   0098D                  ; de berekening is klaar. uitkomsten in passende registers
    2272    1961   0098D                  
    2273    1962   0098D AA74                           mov    r2,h4                ;quotient
    2274    1963   0098F AB75                           mov    r3,h5
    2275    1964   00991                  
    2276    1965   00991 A870                           mov    r0,h0                ;rest
    2277    1966   00993 A971                           mov    r1,h1
    2278    1967   00995                  
    2279    1968   00995 D076                           pop    h6                   ;registers herstellen
    2280    1969   00997 D075                           pop    h5
    2281    1970   00999 D074                           pop    h4
    2282    1971   0099B D073                           pop    h3
    2283    1972   0099D D072                           pop    h2
    2284    1973   0099F D071                           pop    h1
    2285    1974   009A1 D070                           pop    h0
    2286    1975   009A3 D0D0                           pop    psw
    2287    1976   009A5 D0E0                           pop    acc
    2288    1977   009A7 22                             ret
    2289    1978   009A8                  
    2290    1979   009A8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2291    1980   009A8                  ;
    2292    1981   009A8                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2293    1982   009A8                  ;
    2294    1983   009A8                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2295    1984   009A8                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2296    1985   009A8                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2297    1986   009A8                  ;
    2298    1987   009A8                  ; r4,r3,r2,r1,r0 worden aangepast
    2299    1988   009A8                  ;
    2300    1989   009A8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2301    1990   009A8                  
    2302    1991   009A8 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2303    1992   009AA C0D0                           push   psw
    2304    1993   009AC E8                             mov    a,r0                 ;eerste 8 bit
    2305    1994   009AD 2C                             add    a,r4
    2306    1995   009AE F8                             mov    r0,a                 ;klaar
    2307    1996   009AF E9                             mov    a,r1                 ;volgende 8 bit
    2308    1997   009B0 3D                             addc   a,r5
    2309    1998   009B1 F9                             mov    r1,a                 ;klaar
    2310    1999   009B2 EA                             mov    a,r2                 ;volgende 8 bit
    2311    2000   009B3 3E                             addc   a,r6
    2312    2001   009B4 FA                             mov    r2,a                 ;klaar
    2313    2002   009B5 EB                             mov    a,r3                 ;laatste 8 bit
    2314    2003   009B6 3F                             addc   a,r7
    2315    2004   009B7 FB                             mov    r3,a                 ;32 bit klaar
    2316    2005   009B8 7400                           mov    a,#000h
    2317    2006   009BA 3400                           addc   a,#000h              ;carry verrekenen
    2318    2007   009BC FC                             mov    r4,a
    2319    2008   009BD D0D0                           pop    psw                  ;registers herstellen
    2320    2009   009BF D0E0                           pop    acc
    2321    2010   009C1 22                             ret
    2322    2011   009C2                  
    2323    2012   009C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2324    2013   009C2                  ;
    2325    2014   009C2                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2326    2015   009C2                  ;
    2327    2016   009C2                  ; input:      r1,r0 = eerste getal (r1=msb)
    2328    2017   009C2                  ;             r3,r2 = tweede getal (r3=msb)
    2329    2018   009C2                  ; output:     r2,r1,r0 (r2=msb)
    2330    2019   009C2                  ;
    2331    2020   009C2                  ; r3,r2,r1,r0 worden aangepast
    2332    2021   009C2                  ;
    2333    2022   009C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2334    2023   009C2                  
    2335    2024   009C2 C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2336    2025   009C4 C0D0                           push   psw
    2337    2026   009C6 E8                             mov    a,r0                 ;starten met de optelling
    2338    2027   009C7 2A                             add    a,r2                 ;8 bit klaar
    2339    2028   009C8 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2340    2029   009C9 E9                             mov    a,r1                 ;volgende 8 bit
    2341    2030   009CA 3B                             addc   a,r3                 ;16 bit klaar
    2342    2031   009CB F9                             mov    r1,a                 ;uitkomst weggeschreven
    2343    2032   009CC 7400                           mov    a,#000h              ;carry verrekenen
    2344    2033   009CE 3400                           addc   a,#000h
    2345    2034   009D0 FA                             mov    r2,a                 ;24 bit klaar
    2346    2035   009D1 D0D0                           pop    psw                  ;registers herstellen
    2347    2036   009D3 D0E0                           pop    acc
    2348    2037   009D5 22                             ret
    2349    2038   009D6                  
    2350    2039   009D6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2351    2040   009D6                  ;
    2352    2041   009D6                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2353    2042   009D6                  ;             40 bit groot. (eerste -tweede)
    2354    2043   009D6                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2355    2044   009D6                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2356    2045   009D6                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2357    2046   009D6                  ;
    2358    2047   009D6                  ; r4,r3,r2,r1,r0 worden aangepast
    2359    2048   009D6                  ;
    2360    2049   009D6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2361    2050   009D6                  
    2362    2051   009D6 C0E0             sub32:        push   acc                  ;registers bewaren
    2363    2052   009D8 C0D0                           push   psw                  ;ook de vlaggen
    2364    2053   009DA C3                             clr    c                    ;zit nog effe in de weg
    2365    2054   009DB E8                             mov    a,r0                 ;eerste 8 bit
    2366    2055   009DC 9C                             subb   a,r4
    2367    2056   009DD F8                             mov    r0,a
    2368    2057   009DE E9                             mov    a,r1                 ;tweede 8 bit
    2369    2058   009DF 9D                             subb   a,r5
    2370    2059   009E0 F9                             mov    r1,a
    2371    2060   009E1 EA                             mov    a,r2                 ;volgende 8 bit
    2372    2061   009E2 9E                             subb   a,r6
    2373    2062   009E3 FA                             mov    r2,a
    2374    2063   009E4 EB                             mov    a,r3                 ;laatste 8 bit
    2375    2064   009E5 9F                             subb   a,r7
    2376    2065   009E6 FB                             mov    r3,a
    2377    2066   009E7 7400                           mov    a,#000h              ;nu nog de carry
    2378    2067   009E9 9400                           subb   a,#000h
    2379    2068   009EB FC                             mov    r4,a                 ;40 bit klaar
    2380    2069   009EC D0D0                           pop    psw                  ;registers herstellen
    2381    2070   009EE D0E0                           pop    acc
    2382    2071   009F0 22                             ret
    2383    2072   009F1                  
    2384    2073   009F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2385    2074   009F1                  ;
    2386    2075   009F1                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2387    2076   009F1                  ;             24 bit groot. (eerste - tweede)
    2388    2077   009F1                  ; input:      r1,r0 = eerste getal (r1=msb)
    2389    2078   009F1                  ;             r3,r2 = tweede getal (r3=msb)
    2390    2079   009F1                  ; output:     r2,r1,r0 (r2=msb)
    2391    2080   009F1                  ;
    2392    2081   009F1                  ; r3,r2,r1,r0 worden aangepast
    2393    2082   009F1                  ;
    2394    2083   009F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2395    2084   009F1                  
    2396    2085   009F1 C0E0             sub16:        push   acc                  ;registers bewaren
    2397    2086   009F3 C0D0                           push   psw
    2398    2087   009F5 C3                             clr    c                    ;mag nog niet meespelen
    2399    2088   009F6 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2400    2089   009F7 9A                             subb   a,r2
    2401    2090   009F8 F8                             mov    r0,a                 ;klaar
    2402    2091   009F9 E9                             mov    a,r1
    2403    2092   009FA 9B                             subb   a,r3                 ;16 bit klaar
    2404    2093   009FB F9                             mov    r1,a
    2405    2094   009FC 7400                           mov    a,#000h
    2406    2095   009FE 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2407    2096   00A00 FA                             mov    r2,a                 ;24 bit klaar
    2408    2097   00A01 D0D0                           pop    psw                  ;registers herstellen
    2409    2098   00A03 D0E0                           pop    acc
    2410    2099   00A05 22                             ret
    2411    2100   00A06                  
    2412    2101   00A06                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2413    2102   00A06                  ;
    2414    2103   00A06                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2415    2104   00A06                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2416    2105   00A06                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2417    2106   00A06                  ;
    2418    2107   00A06                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2419    2108   00A06                  ;
    2420    2109   00A06                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2421    2110   00A06                  
    2422    2111   00A06 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2423    2112   00A08 C0D0                           push   psw
    2424    2113   00A0A                  
    2425    2114   00A0A C077                           push   h7                   ;nodig
    2426    2115   00A0C C078                           push   h8
    2427    2116   00A0E                  
    2428    2117   00A0E C079                           push   h9                   ;ook
    2429    2118   00A10                  
    2430    2119   00A10 757905                         mov    h9,#005h             ;loopcounter
    2431    2120   00A13                  
    2432    2121   00A13 7B00             hexbcd161:    mov    r3,#000h
    2433    2122   00A15 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2434    2123   00A17 120935                         lcall  div16                ;deling uitvoeren
    2435    2124   00A1A E8                             mov    a,r0                 ;rest
    2436    2125   00A1B C0E0                           push   acc                  ;op stack zetten
    2437    2126   00A1D EA                             mov    a,r2
    2438    2127   00A1E F8                             mov    r0,a
    2439    2128   00A1F EB                             mov    a,r3
    2440    2129   00A20 F9                             mov    r1,a                 ;uitkomst terug delen
    2441    2130   00A21 D579EF                         djnz   h9,hexbcd161
    2442    2131   00A24                  
    2443    2132   00A24 D0E0                           pop    acc                  ;hoogste bits van de stack
    2444    2133   00A26 FA                             mov    r2,a                 ;klaar
    2445    2134   00A27 D0E0                           pop    acc
    2446    2135   00A29 C4                             swap   a
    2447    2136   00A2A F579                           mov    h9,a
    2448    2137   00A2C D0E0                           pop    acc
    2449    2138   00A2E 2579                           add    a,h9
    2450    2139   00A30 F9                             mov    r1,a                 ;volgende 8 klaar
    2451    2140   00A31 D0E0                           pop    acc
    2452    2141   00A33 C4                             swap   a
    2453    2142   00A34 F579                           mov    h9,a
    2454    2143   00A36 D0E0                           pop    acc
    2455    2144   00A38 2579                           add    a,h9
    2456    2145   00A3A F8                             mov    r0,a                 ;klaar
    2457    2146   00A3B                  
    2458    2147   00A3B D079                           pop    h9                   ;was naar de knoppen
    2459    2148   00A3D                  
    2460    2149   00A3D D078                           pop    h8                   ;gebruikt
    2461    2150   00A3F D077                           pop    h7
    2462    2151   00A41                  
    2463    2152   00A41 D0D0                           pop    psw                  ;registers herstellen
    2464    2153   00A43 D0E0                           pop    acc
    2465    2154   00A45 22                             ret
    2466    2155   00A46                  
    2467    2156   00A46                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2468    2157   00A46                  ;
    2469    2158   00A46                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2470    2159   00A46                  ; input       a (maximale waarde = 63h)
    2471    2160   00A46                  ; output      a
    2472    2161   00A46                  ;
    2473    2162   00A46                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2474    2163   00A46                  
    2475    2164   00A46 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2476    2165   00A48 C0F0                           push   b
    2477    2166   00A4A 75F00A                         mov    b,#00ah              ;hierdoor delen
    2478    2167   00A4D 84                             div    ab                   ;in accu qoutient in b rest
    2479    2168   00A4E C4                             swap   a
    2480    2169   00A4F 25F0                           add    a,b                  ;bcd getal klaar
    2481    2170   00A51 D0F0                           pop    b
    2482    2171   00A53 D0D0                           pop    psw
    2483    2172   00A55 22                             ret
    2484    2173   00A56                  
    2485    2174   00A56                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2486    2175   00A56                  ;
    2487    2176   00A56                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2488    2177   00A56                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2489    2178   00A56                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2490    2179   00A56                  ;
    2491    2180   00A56                  ; de routine gebruikt r1,r0 van de huidige bank
    2492    2181   00A56                  ;
    2493    2182   00A56                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2494    2183   00A56                  
    2495    2184   00A56 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2496    2185   00A58 C0E0                           push   acc
    2497    2186   00A5A C0D0                           push   psw
    2498    2187   00A5C                  
    2499    2188   00A5C E8                             mov    a,r0
    2500    2189   00A5D 540F                           anl    a,#00fh              ;eenheden
    2501    2190   00A5F C0E0                           push   acc                  ;effe bewaren
    2502    2191   00A61                  
    2503    2192   00A61 E8                             mov    a,r0
    2504    2193   00A62 C4                             swap   a
    2505    2194   00A63 540F                           anl    a,#00fh              ;tientallen
    2506    2195   00A65 75F00A                         mov    b,#00ah              ;waarde berekenen
    2507    2196   00A68 A4                             mul    ab                   ;klaar
    2508    2197   00A69 D0F0                           pop    b                    ;truukje
    2509    2198   00A6B 25F0                           add    a,b                  ;a is lage deel hex getal
    2510    2199   00A6D C0E0                           push   acc                  ;straks nodig
    2511    2200   00A6F                  
    2512    2201   00A6F E9                             mov    a,r1                 ;hoge deel
    2513    2202   00A70 54F0                           anl    a,#0f0h
    2514    2203   00A72 C4                             swap   a
    2515    2204   00A73 C0E0                           push   acc                  ;straks nodig
    2516    2205   00A75                  
    2517    2206   00A75 E9                             mov    a,r1
    2518    2207   00A76 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2519    2208   00A78 75F064                         mov    b,#100               ;waarde uitrekenen
    2520    2209   00A7B A4                             mul    ab
    2521    2210   00A7C A9F0                           mov    r1,b
    2522    2211   00A7E F8                             mov    r0,a
    2523    2212   00A7F                  
    2524    2213   00A7F D0E0                           pop    acc
    2525    2214   00A81 75F00A                         mov    b,#10
    2526    2215   00A84 A4                             mul    ab                   ;kan nog in a
    2527    2216   00A85 75F064                         mov    b,#100               ;*10*100=*1000
    2528    2217   00A88 A4                             mul    ab
    2529    2218   00A89 28                             add    a,r0
    2530    2219   00A8A F8                             mov    r0,a
    2531    2220   00A8B E9                             mov    a,r1
    2532    2221   00A8C 35F0                           addc   a,b
    2533    2222   00A8E F9                             mov    r1,a
    2534    2223   00A8F                  
    2535    2224   00A8F D0E0                           pop    acc
    2536    2225   00A91 28                             add    a,r0
    2537    2226   00A92 F8                             mov    r0,a
    2538    2227   00A93 7400                           mov    a,#000h
    2539    2228   00A95 39                             addc   a,r1
    2540    2229   00A96 F9                             mov    r1,a                 ;klaar
    2541    2230   00A97                  
    2542    2231   00A97 D0D0                           pop    psw
    2543    2232   00A99 D0E0                           pop    acc
    2544    2233   00A9B D0F0                           pop    b
    2545    2234   00A9D 22                             ret
    2546    2235   00A9E                  
    2547    2236   00A9E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2548    2237   00A9E                  ;
    2549    2238   00A9E                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2550    2239   00A9E                  ; input:      a (maximale waarde 99h)
    2551    2240   00A9E                  ; output:     a
    2552    2241   00A9E                  ;
    2553    2242   00A9E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2554    2243   00A9E                  
    2555    2244   00A9E C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2556    2245   00AA0 C0F0                           push   b
    2557    2246   00AA2 C070                           push   h0
    2558    2247   00AA4 F570                           mov    h0,a                 ;effe bewaren
    2559    2248   00AA6 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2560    2249   00AA9 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2561    2250   00AAB C4                             swap   a
    2562    2251   00AAC 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2563    2252   00AAF A4                             mul    ab
    2564    2253   00AB0 2570                           add    a,h0                 ;eenheden bijtellen
    2565    2254   00AB2 D070                           pop    h0
    2566    2255   00AB4 D0F0                           pop    b
    2567    2256   00AB6 D0D0                           pop    psw
    2568    2257   00AB8 22                             ret
    2569    2258   00AB9                  
    2570    2259   00AB9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2571    2260   00AB9                  ;
    2572    2261   00AB9                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2573    2262   00AB9                  ;
    2574    2263   00AB9                  ; Gebruikt geen registers
    2575    2264   00AB9                  ;
    2576    2265   00AB9                  ; Originele auteur: Danny Pawels (dp)
    2577    2266   00AB9                  ;
    2578    2267   00AB9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2579    2268   00AB9                  
    2580    2269   00AB9                  
    2581    2270   00AB9 C083             XCsw2xtal:  push  dph
    2582    2271   00ABB C082                         push  dpl
    2583    2272   00ABD C0D0                         push  psw
    2584    2273   00ABF C08F                         push  syscon0
    2585    2274   00AC1 C0B2                         push  port_page
    2586    2275   00AC3 C0BF                         push  scu_page
    2587    2276   00AC5                  
    2588    2277   00AC5 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2589    2278   00AC8 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2590    2279   00ACB                  
    2591    2280   00ACB 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2592    2281   00ACE                                                            ;freq= VCO-free running =5MHz...20MHz?
    2593    2282   00ACE 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2594    2283   00AD1 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2595    2284   00AD4 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2596    2285   00AD7                  
    2597    2286   00AD7 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2598    2287   00ADA A3               XCsw2xtal0: inc   dptr
    2599    2288   00ADB E582                         mov   a,dpl
    2600    2289   00ADD 4583                         orl   a,dph
    2601    2290   00ADF 70F9                         jnz   XCsw2xtal0
    2602    2291   00AE1                  
    2603    2292   00AE1 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2604    2293   00AE4                  
    2605    2294   00AE4                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2606    2295   00AE4 E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2607    2296   00AE6 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2608    2297   00AE9                  ;Oscillator run detectie is klaar...
    2609    2298   00AE9 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2610    2299   00AEC                  
    2611    2300   00AEC                  
    2612    2301   00AEC E5B7                         mov   a,pll_con               ;lees pll_con
    2613    2302   00AEE 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2614    2303   00AF0 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2615    2304   00AF2                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2616    2305   00AF2                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2617    2306   00AF2                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2618    2307   00AF2 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2619    2308   00AF5                                                            ;bij aanpassing van de NDIV van de PLL
    2620    2309   00AF5 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2621    2310   00AF7 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2622    2311   00AFA 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2623    2312   00AFD                  
    2624    2313   00AFD E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2625    2314   00AFF 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2626    2315   00B02                  
    2627    2316   00B02 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2628    2317   00B05 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2629    2318   00B08                  
    2630    2319   00B08 D0BF                         pop   scu_page                ;herstel controller status
    2631    2320   00B0A D0B2                         pop   port_page
    2632    2321   00B0C D08F                         pop   syscon0
    2633    2322   00B0E D0D0                         pop   psw
    2634    2323   00B10 D082                         pop   dpl
    2635    2324   00B12 D083                         pop   dph
    2636    2325   00B14 22                           ret
    2637    2326   00B15                  
    2638    2327   00B15                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2639    2328   00B15                  ;
    2640    2329   00B15                  ; mapregs	selecteer de SFR's in de mapped area
    2641    2330   00B15                  ;
    2642    2331   00B15                  ;
    2643    2332   00B15                  ; Past syscon SFR aan
    2644    2333   00B15                  ;
    2645    2334   00B15                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2646    2335   00B15                  
    2647    2336   00B15 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2648    2337   00B18 22               		ret
    2649    2338   00B19                  
    2650    2339   00B19                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2651    2340   00B19                  ;
    2652    2341   00B19                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2653    2342   00B19                  ;
    2654    2343   00B19                  ; Past syscon SFR aan
    2655    2344   00B19                  ;
    2656    2345   00B19                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2657    2346   00B19                  
    2658    2347   00B19 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2659    2348   00B1C 22               		ret
    2660    2349   00B1D                  
    2661    2350   00B1D                  ;*******************************************************************************
    2662    2351   00B1D                  ;
    2663    2352   00B1D                  ; These are the register declarations for the XC888 microcontroller from
    2664    2353   00B1D                  ; Infineon.
    2665    2354   00B1D                  ;
    2666    2355   00B1D                  ;*******************************************************************************
    2667    2356   00B1D                  
    2668    2357   00B1D                  ;*******************************************************************************
    2669    2358   00B1D                  ;
    2670    2359   00B1D                  ; CPU registers are accessible independend of paging and mapping
    2671    2360   00B1D                  ; (always accessible)
    2672    2361   00B1D                  ;
    2673    2362   00B1D                  ;*******************************************************************************
    2674    2363   00B1D                  
    2675    2364   00B1D                  sp            data   081h          ;stack pointer                     reset=007h
    2676    2365   00B1D                  dpl           data   082h          ;datapointer low register          reset=000h
    2677    2366   00B1D                  dph           data   083h          ;datapointer high register         reset=000h
    2678    2367   00B1D                  pcon          data   087h          ;power control                     reset=000h
    2679    2368   00B1D                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2680    2369   00B1D                  ;tcon is bit addressable
    2681    2370   00B1D                         tf1    bit    08fh
    2682    2371   00B1D                         tr1    bit    08eh
    2683    2372   00B1D                         tf0    bit    08dh
    2684    2373   00B1D                         tr0    bit    08ch
    2685    2374   00B1D                         ie1    bit    08bh
    2686    2375   00B1D                         it1    bit    08ah
    2687    2376   00B1D                         ie0    bit    089h
    2688    2377   00B1D                         it0    bit    088h
    2689    2378   00B1D                  
    2690    2379   00B1D                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2691    2380   00B1D                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2692    2381   00B1D                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2693    2382   00B1D                  th0           data   08ch          ;timer 0 high                      reset=000h
    2694    2383   00B1D                  th1           data   08dh          ;timer 1 high                      reset=000h
    2695    2384   00B1D                  
    2696    2385   00B1D                  syscon0       data   08fh          ;system control register 0         reset=004h
    2697    2386   00B1D                  scon          data   098h          ;serial channel 0 control          reset=000h
    2698    2387   00B1D                  ;scon is bit addressable
    2699    2388   00B1D                         sm0    bit    09fh
    2700    2389   00B1D                         sm1    bit    09eh
    2701    2390   00B1D                         sm2    bit    09dh
    2702    2391   00B1D                         ren    bit    09ch
    2703    2392   00B1D                         tb8    bit    09bh
    2704    2393   00B1D                         rb8    bit    09ah
    2705    2394   00B1D                         ti     bit    099h
    2706    2395   00B1D                         ri     bit    098h
    2707    2396   00B1D                  
    2708    2397   00B1D                  sbuf          data   099h          ;serial data buffer channel 0
    2709    2398   00B1D                  eo            data   0a2h          ;extended operation                reset=000h
    2710    2399   00B1D                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2711    2400   00B1D                  ;ien0 is bit addressable
    2712    2401   00B1D                         ea     bit    0afh
    2713    2402   00B1D                                                     ;bit not implemented
    2714    2403   00B1D                         et2    bit    0adh
    2715    2404   00B1D                         es     bit    0ach
    2716    2405   00B1D                         et1    bit    0abh
    2717    2406   00B1D                         ex1    bit    0aah
    2718    2407   00B1D                         et0    bit    0a9h
    2719    2408   00B1D                         ex0    bit    0a8h
    2720    2409   00B1D                  
    2721    2410   00B1D                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2722    2411   00B1D                  ;ip is bit addressable
    2723    2412   00B1D                                                     ;bit not implemented
    2724    2413   00B1D                                                     ;bit not implemented
    2725    2414   00B1D                         pt2    bit    0bdh
    2726    2415   00B1D                         ps     bit    0bch
    2727    2416   00B1D                         pt1    bit    0bbh
    2728    2417   00B1D                         px1    bit    0bah
    2729    2418   00B1D                         pt0    bit    0b9h
    2730    2419   00B1D                         px0    bit    0b8h
    2731    2420   00B1D                  
    2732    2421   00B1D                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2733    2422   00B1D                  psw           data   0d0h          ;program status word               reset=000h
    2734    2423   00B1D                  ;psw is bit addressable
    2735    2424   00B1D                         cy     bit    0d7h
    2736    2425   00B1D                         ac     bit    0d6h
    2737    2426   00B1D                         f0     bit    0d5h
    2738    2427   00B1D                         rs1    bit    0d4h
    2739    2428   00B1D                         rs0    bit    0d3h
    2740    2429   00B1D                         ov     bit    0d2h
    2741    2430   00B1D                         f1     bit    0d1h
    2742    2431   00B1D                         p      bit    0d0h
    2743    2432   00B1D                  
    2744    2433   00B1D                  acc           data   0e0h          ;accumulator                       reset=000h
    2745    2434   00B1D                  ;acc is bit addressable
    2746    2435   00B1D                  
    2747    2436   00B1D                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2748    2437   00B1D                  ;ien1 is bit addressable
    2749    2438   00B1D                         eccip3 bit    0efh
    2750    2439   00B1D                         eccip2 bit    0eeh
    2751    2440   00B1D                         eccip1 bit    0edh
    2752    2441   00B1D                         eccip0 bit    0ech
    2753    2442   00B1D                         exm    bit    0ebh
    2754    2443   00B1D                         ex2    bit    0eah
    2755    2444   00B1D                         essc   bit    0e9h
    2756    2445   00B1D                         eadc   bit    0e8h
    2757    2446   00B1D                  
    2758    2447   00B1D                  b             data   0f0h          ;b register                        reset=000h
    2759    2448   00B1D                  ;b is bit addressable
    2760    2449   00B1D                  
    2761    2450   00B1D                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2762    2451   00B1D                  ;ip1 is bit addressable
    2763    2452   00B1D                         pccip3 bit    0ffh
    2764    2453   00B1D                         pccip2 bit    0feh
    2765    2454   00B1D                         pccip1 bit    0fdh
    2766    2455   00B1D                         pccip0 bit    0fch
    2767    2456   00B1D                         pxm    bit    0fbh
    2768    2457   00B1D                         px2    bit    0fah
    2769    2458   00B1D                         pssc   bit    0f9h
    2770    2459   00B1D                         padc   bit    0f8h
    2771    2460   00B1D                  
    2772    2461   00B1D                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2773    2462   00B1D                  
    2774    2463   00B1D                  
    2775    2464   00B1D                  ;*******************************************************************************
    2776    2465   00B1D                  ;
    2777    2466   00B1D                  ; system control registers registers that can only be accessed in the non
    2778    2467   00B1D                  ; mapped memory area (rmap=0) page independent
    2779    2468   00B1D                  ;
    2780    2469   00B1D                  ;*******************************************************************************
    2781    2470   00B1D                  
    2782    2471   00B1D                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2783    2472   00B1D                  
    2784    2473   00B1D                  ;*******************************************************************************
    2785    2474   00B1D                  ;
    2786    2475   00B1D                  ; system control registers registers that can only be accessed in the non
    2787    2476   00B1D                  ; mapped memory area (rmap=0) and page 0
    2788    2477   00B1D                  ;
    2789    2478   00B1D                  ;*******************************************************************************
    2790    2479   00B1D                  
    2791    2480   00B1D                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2792    2481   00B1D                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2793    2482   00B1D                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2794    2483   00B1D                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2795    2484   00B1D                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2796    2485   00B1D                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2797    2486   00B1D                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2798    2487   00B1D                  nmisr         data   0bch          ;nmi status                        reset=000h
    2799    2488   00B1D                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2800    2489   00B1D                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2801    2490   00B1D                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2802    2491   00B1D                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2803    2492   00B1D                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2804    2493   00B1D                  
    2805    2494   00B1D                  ;*******************************************************************************
    2806    2495   00B1D                  ;
    2807    2496   00B1D                  ; system control registers registers that can only be accessed in the non
    2808    2497   00B1D                  ; mapped memory area (rmap=0) and page 1
    2809    2498   00B1D                  ;
    2810    2499   00B1D                  ;*******************************************************************************
    2811    2500   00B1D                  
    2812    2501   00B1D                  id            data   0b3h          ;identity register     reset=device dependent
    2813    2502   00B1D                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2814    2503   00B1D                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2815    2504   00B1D                  osc_con       data   0b6h          ;osc control                       reset=008h
    2816    2505   00B1D                  pll_con       data   0b7h          ;pll control                       reset=090h
    2817    2506   00B1D                  cmcon         data   0bah          ;clock control                     reset=010h
    2818    2507   00B1D                  passwd        data   0bbh          ;password register                 reset=007h
    2819    2508   00B1D                  feal          data   0bch          ;flash error register              reset=000h
    2820    2509   00B1D                  feah          data   0bdh          ;flash error address high          reset=000h
    2821    2510   00B1D                  cocon         data   0beh          ;clock output control              reset=000h
    2822    2511   00B1D                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2823    2512   00B1D                  
    2824    2513   00B1D                  ;*******************************************************************************
    2825    2514   00B1D                  ;
    2826    2515   00B1D                  ; system control registers registers that can only be accessed in the non
    2827    2516   00B1D                  ; mapped memory area (rmap=0) and page 3
    2828    2517   00B1D                  ;
    2829    2518   00B1D                  ;*******************************************************************************
    2830    2519   00B1D                  
    2831    2520   00B1D                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2832    2521   00B1D                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2833    2522   00B1D                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2834    2523   00B1D                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2835    2524   00B1D                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2836    2525   00B1D                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2837    2526   00B1D                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2838    2527   00B1D                  
    2839    2528   00B1D                  ;*******************************************************************************
    2840    2529   00B1D                  ;
    2841    2530   00B1D                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2842    2531   00B1D                  ;
    2843    2532   00B1D                  ;*******************************************************************************
    2844    2533   00B1D                  
    2845    2534   00B1D                  port_page     data   0b2h          ;port page register                reset=000h
    2846    2535   00B1D                  
    2847    2536   00B1D                  ;*******************************************************************************
    2848    2537   00B1D                  ;
    2849    2538   00B1D                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2850    2539   00B1D                  ;
    2851    2540   00B1D                  ;*******************************************************************************
    2852    2541   00B1D                  
    2853    2542   00B1D                  p0_data       data   080h          ;port 0 data register              reset=000h
    2854    2543   00B1D                  ;p0_data is bit addressable
    2855    2544   00B1D                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2856    2545   00B1D                  p1_data       data   090h          ;port 1 data register              reset=000h
    2857    2546   00B1D                  ;p1_data is bit addressable
    2858    2547   00B1D                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2859    2548   00B1D                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2860    2549   00B1D                  ;p2_data is bit addressable
    2861    2550   00B1D                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2862    2551   00B1D                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2863    2552   00B1D                  ;p3_data is bit addressable
    2864    2553   00B1D                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2865    2554   00B1D                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2866    2555   00B1D                  ;p4_data is bit addressable
    2867    2556   00B1D                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2868    2557   00B1D                  p5_data       data   092h          ;port 5 data register              reset=000h
    2869    2558   00B1D                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2870    2559   00B1D                  
    2871    2560   00B1D                  ;*******************************************************************************
    2872    2561   00B1D                  ;
    2873    2562   00B1D                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2874    2563   00B1D                  ;
    2875    2564   00B1D                  ;*******************************************************************************
    2876    2565   00B1D                  
    2877    2566   00B1D                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2878    2567   00B1D                  ;p0_data is bit addressable
    2879    2568   00B1D                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2880    2569   00B1D                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2881    2570   00B1D                  ;p1_data is bit addressable
    2882    2571   00B1D                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2883    2572   00B1D                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2884    2573   00B1D                  ;p2_data is bit addressable
    2885    2574   00B1D                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2886    2575   00B1D                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2887    2576   00B1D                  ;p3_data is bit addressable
    2888    2577   00B1D                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2889    2578   00B1D                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2890    2579   00B1D                  ;p4_data is bit addressable
    2891    2580   00B1D                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2892    2581   00B1D                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2893    2582   00B1D                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2894    2583   00B1D                  
    2895    2584   00B1D                  ;*******************************************************************************
    2896    2585   00B1D                  ;
    2897    2586   00B1D                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2898    2587   00B1D                  ;
    2899    2588   00B1D                  ;*******************************************************************************
    2900    2589   00B1D                  
    2901    2590   00B1D                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2902    2591   00B1D                  ;p0_data is bit addressable
    2903    2592   00B1D                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2904    2593   00B1D                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2905    2594   00B1D                  ;p1_data is bit addressable
    2906    2595   00B1D                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2907    2596   00B1D                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2908    2597   00B1D                  ;p3_data is bit addressable
    2909    2598   00B1D                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2910    2599   00B1D                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2911    2600   00B1D                  ;p4_data is bit addressable
    2912    2601   00B1D                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2913    2602   00B1D                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2914    2603   00B1D                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2915    2604   00B1D                  
    2916    2605   00B1D                  ;*******************************************************************************
    2917    2606   00B1D                  ;
    2918    2607   00B1D                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2919    2608   00B1D                  ;
    2920    2609   00B1D                  ;*******************************************************************************
    2921    2610   00B1D                  
    2922    2611   00B1D                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2923    2612   00B1D                  ;p0_data is bit addressable
    2924    2613   00B1D                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2925    2614   00B1D                  ;p1_data is bit addressable
    2926    2615   00B1D                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2927    2616   00B1D                  ;p3_data is bit addressable
    2928    2617   00B1D                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2929    2618   00B1D                  ;p4_data is bit addressable
    2930    2619   00B1D                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2931    2620   00B1D                  
    2932    2621   00B1D                  ;*******************************************************************************
    2933    2622   00B1D                  ;
    2934    2623   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2935    2624   00B1D                  ;
    2936    2625   00B1D                  ;*******************************************************************************
    2937    2626   00B1D                  
    2938    2627   00B1D                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2939    2628   00B1D                  
    2940    2629   00B1D                  ;*******************************************************************************
    2941    2630   00B1D                  ;
    2942    2631   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2943    2632   00B1D                  ;
    2944    2633   00B1D                  ;*******************************************************************************
    2945    2634   00B1D                  
    2946    2635   00B1D                  adc_globctr   data   0cah          ;global control register           reset=030h
    2947    2636   00B1D                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2948    2637   00B1D                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2949    2638   00B1D                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2950    2639   00B1D                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2951    2640   00B1D                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2952    2641   00B1D                  
    2953    2642   00B1D                  ;*******************************************************************************
    2954    2643   00B1D                  ;
    2955    2644   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2956    2645   00B1D                  ;
    2957    2646   00B1D                  ;*******************************************************************************
    2958    2647   00B1D                  
    2959    2648   00B1D                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2960    2649   00B1D                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2961    2650   00B1D                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2962    2651   00B1D                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2963    2652   00B1D                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2964    2653   00B1D                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2965    2654   00B1D                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2966    2655   00B1D                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2967    2656   00B1D                  
    2968    2657   00B1D                  ;*******************************************************************************
    2969    2658   00B1D                  ;
    2970    2659   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2971    2660   00B1D                  ;
    2972    2661   00B1D                  ;*******************************************************************************
    2973    2662   00B1D                  
    2974    2663   00B1D                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2975    2664   00B1D                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2976    2665   00B1D                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2977    2666   00B1D                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2978    2667   00B1D                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2979    2668   00B1D                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2980    2669   00B1D                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2981    2670   00B1D                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2982    2671   00B1D                  
    2983    2672   00B1D                  ;*******************************************************************************
    2984    2673   00B1D                  ;
    2985    2674   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2986    2675   00B1D                  ;
    2987    2676   00B1D                  ;*******************************************************************************
    2988    2677   00B1D                  
    2989    2678   00B1D                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2990    2679   00B1D                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2991    2680   00B1D                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2992    2681   00B1D                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2993    2682   00B1D                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2994    2683   00B1D                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2995    2684   00B1D                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2996    2685   00B1D                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2997    2686   00B1D                  
    2998    2687   00B1D                  ;*******************************************************************************
    2999    2688   00B1D                  ;
    3000    2689   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    3001    2690   00B1D                  ;
    3002    2691   00B1D                  ;*******************************************************************************
    3003    2692   00B1D                  
    3004    2693   00B1D                  adc_rcr0      data   0cah          ;result control register           reset=000h
    3005    2694   00B1D                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    3006    2695   00B1D                  adc_rcr2      data   0cch          ;result control register           reset=000h
    3007    2696   00B1D                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    3008    2697   00B1D                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    3009    2698   00B1D                  
    3010    2699   00B1D                  ;*******************************************************************************
    3011    2700   00B1D                  ;
    3012    2701   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    3013    2702   00B1D                  ;
    3014    2703   00B1D                  ;*******************************************************************************
    3015    2704   00B1D                  
    3016    2705   00B1D                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    3017    2706   00B1D                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    3018    2707   00B1D                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    3019    2708   00B1D                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    3020    2709   00B1D                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    3021    2710   00B1D                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    3022    2711   00B1D                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    3023    2712   00B1D                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    3024    2713   00B1D                  
    3025    2714   00B1D                  ;*******************************************************************************
    3026    2715   00B1D                  ;
    3027    2716   00B1D                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    3028    2717   00B1D                  ;
    3029    2718   00B1D                  ;*******************************************************************************
    3030    2719   00B1D                  
    3031    2720   00B1D                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    3032    2721   00B1D                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    3033    2722   00B1D                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3034    2723   00B1D                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3035    2724   00B1D                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3036    2725   00B1D                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3037    2726   00B1D                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3038    2727   00B1D                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3039    2728   00B1D                  
    3040    2729   00B1D                  ;*******************************************************************************
    3041    2730   00B1D                  
    3042    2731   00B1D                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3043    2732   00B1D                  ;
    3044    2733   00B1D                  ;*******************************************************************************
    3045    2734   00B1D                  
    3046    2735   00B1D                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3047    2736   00B1D                  ;t2_t2con is bit addressable
    3048    2737   00B1D                         tf2    bit    0c7h
    3049    2738   00B1D                         exf2   bit    0c6h
    3050    2739   00B1D                                                     ;2 bits are not implemented
    3051    2740   00B1D                         exen2  bit    0c3h
    3052    2741   00B1D                         tr2    bit    0c2h
    3053    2742   00B1D                         ct2    bit    0c1h
    3054    2743   00B1D                         cprl2  bit    0c0h
    3055    2744   00B1D                  
    3056    2745   00B1D                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3057    2746   00B1D                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3058    2747   00B1D                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3059    2748   00B1D                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3060    2749   00B1D                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3061    2750   00B1D                  
    3062    2751   00B1D                  ;*******************************************************************************
    3063    2752   00B1D                  ;
    3064    2753   00B1D                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3065    2754   00B1D                  ;
    3066    2755   00B1D                  ;*******************************************************************************
    3067    2756   00B1D                  
    3068    2757   00B1D                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3069    2758   00B1D                  
    3070    2759   00B1D                  ;*******************************************************************************
    3071    2760   00B1D                  ;
    3072    2761   00B1D                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3073    2762   00B1D                  ;
    3074    2763   00B1D                  ;*******************************************************************************
    3075    2764   00B1D                  
    3076    2765   00B1D                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3077    2766   00B1D                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3078    2767   00B1D                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3079    2768   00B1D                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3080    2769   00B1D                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3081    2770   00B1D                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3082    2771   00B1D                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3083    2772   00B1D                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3084    2773   00B1D                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3085    2774   00B1D                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3086    2775   00B1D                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3087    2776   00B1D                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3088    2777   00B1D                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3089    2778   00B1D                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3090    2779   00B1D                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3091    2780   00B1D                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3092    2781   00B1D                  
    3093    2782   00B1D                  ;*******************************************************************************
    3094    2783   00B1D                  ;
    3095    2784   00B1D                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3096    2785   00B1D                  ;
    3097    2786   00B1D                  ;*******************************************************************************
    3098    2787   00B1D                  
    3099    2788   00B1D                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3100    2789   00B1D                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3101    2790   00B1D                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3102    2791   00B1D                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3103    2792   00B1D                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3104    2793   00B1D                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3105    2794   00B1D                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3106    2795   00B1D                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3107    2796   00B1D                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3108    2797   00B1D                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3109    2798   00B1D                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3110    2799   00B1D                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3111    2800   00B1D                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3112    2801   00B1D                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3113    2802   00B1D                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3114    2803   00B1D                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3115    2804   00B1D                  
    3116    2805   00B1D                  ;*******************************************************************************
    3117    2806   00B1D                  ;
    3118    2807   00B1D                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3119    2808   00B1D                  ;
    3120    2809   00B1D                  ;*******************************************************************************
    3121    2810   00B1D                  
    3122    2811   00B1D                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3123    2812   00B1D                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3124    2813   00B1D                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3125    2814   00B1D                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3126    2815   00B1D                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3127    2816   00B1D                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3128    2817   00B1D                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3129    2818   00B1D                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3130    2819   00B1D                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3131    2820   00B1D                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3132    2821   00B1D                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3133    2822   00B1D                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3134    2823   00B1D                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3135    2824   00B1D                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3136    2825   00B1D                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3137    2826   00B1D                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3138    2827   00B1D                  
    3139    2828   00B1D                  ;*******************************************************************************
    3140    2829   00B1D                  ;
    3141    2830   00B1D                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3142    2831   00B1D                  ;
    3143    2832   00B1D                  ;*******************************************************************************
    3144    2833   00B1D                  
    3145    2834   00B1D                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3146    2835   00B1D                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3147    2836   00B1D                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3148    2837   00B1D                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3149    2838   00B1D                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3150    2839   00B1D                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3151    2840   00B1D                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3152    2841   00B1D                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3153    2842   00B1D                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3154    2843   00B1D                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3155    2844   00B1D                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3156    2845   00B1D                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3157    2846   00B1D                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3158    2847   00B1D                  
    3159    2848   00B1D                  ;*******************************************************************************
    3160    2849   00B1D                  ;
    3161    2850   00B1D                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3162    2851   00B1D                  ;
    3163    2852   00B1D                  ;*******************************************************************************
    3164    2853   00B1D                  
    3165    2854   00B1D                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3166    2855   00B1D                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3167    2856   00B1D                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3168    2857   00B1D                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3169    2858   00B1D                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3170    2859   00B1D                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3171    2860   00B1D                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3172    2861   00B1D                  
    3173    2862   00B1D                  ;*******************************************************************************
    3174    2863   00B1D                  ;
    3175    2864   00B1D                  ; can registers can be accessed in the standard memory map (rmap=0)
    3176    2865   00B1D                  ;
    3177    2866   00B1D                  ;*******************************************************************************
    3178    2867   00B1D                  
    3179    2868   00B1D                  adcon         data   0d8h          ;adres/data control                reset=000h
    3180    2869   00B1D                  ; adcon is bit addressable
    3181    2870   00B1D                         v3     bit    0dfh
    3182    2871   00B1D                         v2     bit    0deh
    3183    2872   00B1D                         v1     bit    0ddh
    3184    2873   00B1D                         v0     bit    0dch
    3185    2874   00B1D                         auad1  bit    0dbh
    3186    2875   00B1D                         auad0  bit    0dah
    3187    2876   00B1D                         can_bsy bit   0d9h
    3188    2877   00B1D                         rwen   bit    0d8h
    3189    2878   00B1D                  
    3190    2879   00B1D                  adl           data   0d9h          ;adres register low                reset=000h
    3191    2880   00B1D                  adh           data   0dah          ;adres register low                reset=000h
    3192    2881   00B1D                  data0         data   0dbh          ;can data                          reset=000h
    3193    2882   00B1D                  data1         data   0dch          ;can data                          reset=000h
    3194    2883   00B1D                  data2         data   0ddh          ;can data                          reset=000h
    3195    2884   00B1D                  data3         data   0deh          ;can data                          reset=000h
    3196    2885   00B1D                  
    3197    2886   00B1D                  ;*******************************************************************************
    3198    2887   00B1D                  ;
    3199    2888   00B1D                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3200    2889   00B1D                  ;
    3201    2890   00B1D                  ;*******************************************************************************
    3202    2891   00B1D                  
    3203    2892   00B1D                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3204    2893   00B1D                  ;mdustat is bit addressable
    3205    2894   00B1D                                                     ;5 bits are not implemented
    3206    2895   00B1D                         bsy    bit    0b2h
    3207    2896   00B1D                         ierr   bit    0b1h
    3208    2897   00B1D                         irdy   bit    0b0h
    3209    2898   00B1D                  
    3210    2899   00B1D                  mducon        data   0b1h          ;mdu control                       reset=000h
    3211    2900   00B1D                  md0           data   0b2h          ;mdu operand register              reset=000h
    3212    2901   00B1D                  mr0           data   0b2h          ;mdu result register               reset=000h
    3213    2902   00B1D                  md1           data   0b3h          ;mdu operand register              reset=000h
    3214    2903   00B1D                  mr1           data   0b3h          ;mdu result register               reset=000h
    3215    2904   00B1D                  md2           data   0b4h          ;mdu operand register              reset=000h
    3216    2905   00B1D                  mr2           data   0b4h          ;mdu result register               reset=000h
    3217    2906   00B1D                  md3           data   0b5h          ;mdu operand register              reset=000h
    3218    2907   00B1D                  mr3           data   0b5h          ;mdu result register               reset=000h
    3219    2908   00B1D                  md4           data   0b6h          ;mdu operand register              reset=000h
    3220    2909   00B1D                  mr4           data   0b6h          ;mdu result register               reset=000h
    3221    2910   00B1D                  md5           data   0b7h          ;mdu operand register              reset=000h
    3222    2911   00B1D                  mr5           data   0b7h          ;mdu result register               reset=000h
    3223    2912   00B1D                  
    3224    2913   00B1D                  ;*******************************************************************************
    3225    2914   00B1D                  ;
    3226    2915   00B1D                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3227    2916   00B1D                  ;
    3228    2917   00B1D                  ;*******************************************************************************
    3229    2918   00B1D                  
    3230    2919   00B1D                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3231    2920   00B1D                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3232    2921   00B1D                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3233    2922   00B1D                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3234    2923   00B1D                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3235    2924   00B1D                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3236    2925   00B1D                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3237    2926   00B1D                  ;cd_statc is bit addressable
    3238    2927   00B1D                         keepz  bit    0a7h
    3239    2928   00B1D                         keepy  bit    0a6h
    3240    2929   00B1D                         keepx  bit    0a5h
    3241    2930   00B1D                         dmap   bit    0a4h
    3242    2931   00B1D                         int_en bit    0a3h
    3243    2932   00B1D                         eoc    bit    0a2h
    3244    2933   00B1D                         error  bit    0a1h
    3245    2934   00B1D                         cd_bsy bit    0a0h
    3246    2935   00B1D                  
    3247    2936   00B1D                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3248    2937   00B1D                  
    3249    2938   00B1D                  ;*******************************************************************************
    3250    2939   00B1D                  ;
    3251    2940   00B1D                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3252    2941   00B1D                  ;
    3253    2942   00B1D                  ;*******************************************************************************
    3254    2943   00B1D                  
    3255    2944   00B1D                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3256    2945   00B1D                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3257    2946   00B1D                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3258    2947   00B1D                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3259    2948   00B1D                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3260    2949   00B1D                  
    3261    2950   00B1D                  ;*******************************************************************************
    3262    2951   00B1D                  ;
    3263    2952   00B1D                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3264    2953   00B1D                  ;
    3265    2954   00B1D                  ;*******************************************************************************
    3266    2955   00B1D                  
    3267    2956   00B1D                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3268    2957   00B1D                  ;t2_t2con is bit addressable bits are aalready defined
    3269    2958   00B1D                         ;tf2    bit    0c7h
    3270    2959   00B1D                         ;exf2   bit    0c6h
    3271    2960   00B1D                                                     ;2 bits are not implemented
    3272    2961   00B1D                         ;exen2  bit    0c3h
    3273    2962   00B1D                         ;tr2    bit    0c2h
    3274    2963   00B1D                         ;ct2    bit    0c1h
    3275    2964   00B1D                         ;cprl2  bit    0c0h
    3276    2965   00B1D                  
    3277    2966   00B1D                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3278    2967   00B1D                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3279    2968   00B1D                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3280    2969   00B1D                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3281    2970   00B1D                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3282    2971   00B1D                  
    3283    2972   00B1D                  ;*******************************************************************************
    3284    2973   00B1D                  ;
    3285    2974   00B1D                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3286    2975   00B1D                  ;
    3287    2976   00B1D                  ;*******************************************************************************
    3288    2977   00B1D                  
    3289    2978   00B1D                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3290    2979   00B1D                  ;s1con is bit addressable
    3291    2980   00B1D                         sm01   bit    0cfh
    3292    2981   00B1D                         sm11   bit    0ceh
    3293    2982   00B1D                         sm21   bit    0cdh
    3294    2983   00B1D                         ren1   bit    0cch
    3295    2984   00B1D                         tb81   bit    0cbh
    3296    2985   00B1D                         rb81   bit    0cah
    3297    2986   00B1D                         ti1    bit    0c9h
    3298    2987   00B1D                         ri1    bit    0c8h
    3299    2988   00B1D                  
    3300    2989   00B1D                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3301    2990   00B1D                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3302    2991   00B1D                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3303    2992   00B1D                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3304    2993   00B1D                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3305    2994   00B1D                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3306    2995   00B1D                  
    3307    2996   00B1D                  ;*******************************************************************************
    3308    2997   00B1D                  ;
    3309    2998   00B1D                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3310    2999   00B1D                  ;
    3311    3000   00B1D                  ;*******************************************************************************
    3312    3001   00B1D                  
    3313    3002   00B1D                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3314    3003   00B1D                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3315    3004   00B1D                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3316    3005   00B1D                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3317    3006   00B1D                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3318    3007   00B1D                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3319    3008   00B1D                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3320    3009   00B1D                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3321    3010   00B1D                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3322    3011   00B1D                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3323    3012   00B1D                  
    3324    3013   00B1D                  ;end directive must be used, but has no signification
    3325    3014   00B1D                  
    3326    3015   00B1D                  end
    3327    3016   00B1D                  
    3328    3017   00B1D                  
    3329    3018   00B1D                  
    3330    3019   00B1D                  
    3331    3020   00B1D                  
    3332    3021   00B1D                  
    3333    3022   00B1D                  
    3334    3023   00B1D                  
    3335    3024   00B1D                  
    3336    3025   00B1D                  
    3337    3026   00B1D                  
    3338    3027   00B1D                  
    3339    3028   00B1D                  
    3340    3029   00B1D                  
    3341    3030   00B1D                  
    3342    3031   00B1D                  


*** Symbols ***
name                    hex      dec          type     segment
--------------------------------------------------------------
fdcon1               0x00CC      204          data     absolute
v2                   0x00DE      222           bit     absolute
ccu6_pisel0h         0x009F      159          data     absolute
ccu6_mcmctr          0x00A7      167          data     absolute
ccu6_pslr            0x00A6      166          data     absolute
ccu6_cc62srl         0x00FE      254          data     absolute
ccu6_cmpmodifh       0x00A7      167          data     absolute
adc_resr1l           0x00CC      204          data     absolute
adc_chctr3           0x00CD      205          data     absolute
adc_globctr          0x00CA      202          data     absolute
p1_altsel1           0x0091      145          data     absolute
p1_data              0x0090      144          data     absolute
p0_dir               0x0086      134          data     absolute
xaddrh               0x00B3      179          data     absolute
bcon                 0x00BD      189          data     absolute
et1                  0x00AB      171           bit     absolute
scon                 0x0098      152          data     absolute
tr1                  0x008E      142           bit     absolute
add16                0x09C2     2498          code     absolute
div162               0x097F     2431          code     absolute
mul321               0x0765     1893          code     absolute
h5                   0x0075      117        number     absolute
adclm335             0x06E0     1760          code     absolute
ASCBINTRANS1         0x06A1     1697          code     absolute
INBUFA3              0x063F     1599          code     absolute
siooutbyte           0x05A6     1446          code     absolute
ff                   0x000C       12        number     absolute
lcdbuzoff            0x0541     1345          code     absolute
dispdptrlcd          0x0421     1057          code     absolute
outcharlcd5          0x03CE      974          code     absolute
displayon            0x0001        1        number     absolute
initiic              0x01E6      486          code     absolute
P4out                0x0122      290          code     absolute
rs                   0xF000    61440          data           bit     absolute
CD                   0xB003    45059          data           bit     absolute
mmicr                0x00F4      244          data     absolute
mmcr2                0x00E9      233          data     absolute
v3                   0x00DF      223           bit     absolute
ccu6_mcmoutl         0x009A      154          data     absolute
ccu6_cc61srl         0x00FC      252          data     absolute
ccu6_mcmoutsh        0x009F      159          data     absolute
tr2                  0x00C2      194           bit     absolute
exf2                 0x00C6      198           bit     absolute
adc_resr0l           0x00CA      202          data     absolute
adc_chctr4           0x00CE      206          data     absolute
adc_inpcr0           0x00CE      206          data     absolute
p1_dir               0x0091      145          data     absolute
p0_data              0x0080      128          data     absolute
cocon                0x00BE      190          data     absolute
padc                 0x00F8      248           bit     absolute
et2                  0x00AD      173           bit     absolute
ie0                  0x0089      137           bit     absolute
XCsw2xtal            0x0AB9     2745          code     absolute
mul322               0x079F     1951          code     absolute
h10                  0x007A      122        number     absolute
h6                   0x0076      118        number     absolute
ASCBINTRANS2         0x06A0     1696          code     absolute
ASCBINTRANS          0x068C     1676          code     absolute
INBUFA4              0x0638     1592          code     absolute
lcddispdptr          0x0421     1057          code     absolute
outcharlcd6          0x03D8      984          code     absolute
lcdoutchar           0x03A2      930          code     absolute
iicstop              0x022C      556          code     absolute
P3out                0x0110      272          code     absolute
initGLCD             0x0099      153          code     absolute
CE                   0xB002    45058          data           bit     absolute
t21_t2h              0x00C5      197          data     absolute
wdtrel               0x00BC      188          data     absolute
error                0x00A1      161           bit     absolute
bsy                  0x00B2      178           bit     absolute
data0                0x00DB      219          data     absolute
ccu6_cmpstatl        0x00FE      254          data     absolute
ccu6_ienl            0x009C      156          data     absolute
ccu6_cc60srl         0x00FA      250          data     absolute
adc_chinpr           0x00CD      205          data     absolute
adc_chctr5           0x00CF      207          data     absolute
p5_altsel0           0x0092      146          data     absolute
p0_altsel0           0x0080      128          data     absolute
p2_dir               0x00A1      161          data     absolute
ac                   0x00D6      214           bit     absolute
ien0                 0x00A8      168          data     absolute
sbuf                 0x0099      153          data     absolute
ie1                  0x008B      139           bit     absolute
bcdhex8              0x0A9E     2718          code     absolute
h11                  0x007B      123        number     absolute
h7                   0x0077      119        number     absolute
ASCII1               0x06A2     1698          code     absolute
ASCBINTRANS3         0x0694     1684          code     absolute
INBUFA5              0x0652     1618          code     absolute
INBUFA               0x0623     1571          code     absolute
lcdoutnib            0x03F9     1017          code     absolute
outcharlcd7          0x03E2      994          code     absolute
entrymode            0x0006        6        number     absolute
delaya0k05s          0x0319      793          code     absolute
initdipswitch        0x019E      414          code     absolute
STAOPNIEUW           0x0077      119          code     absolute
RD                   0xB001    45057          data           bit     absolute
mmwr1                0x00EB      235          data     absolute
wdth                 0x00BF      191          data     absolute
data1                0x00DC      220          data     absolute
adl                  0x00D9      217          data     absolute
ssc_conl             0x00AA      170          data     absolute
ccu6_trpctrh         0x00FF      255          data     absolute
adc_crmr1            0x00CC      204          data     absolute
adc_chctr6           0x00D2      210          data     absolute
adc_etrcr            0x00CF      207          data     absolute
p5_altsel1           0x0093      147          data     absolute
p0_altsel1           0x0086      134          data     absolute
p3_dir               0x00B1      177          data     absolute
cmcon                0x00BA      186          data     absolute
nmisr                0x00BC      188          data     absolute
iph1                 0x00F9      249          data     absolute
ien1                 0x00E8      232          data     absolute
ps                   0x00BC      188           bit     absolute
sm0                  0x009F      159           bit     absolute
it0                  0x0088      136           bit     absolute
pcon                 0x0087      135          data     absolute
mul16                0x07F2     2034          code     absolute
h12                  0x007C      124        number     absolute
h8                   0x0078      120        number     absolute
ASCII2               0x06A7     1703          code     absolute
ASCBINTRANS4         0x069D     1693          code     absolute
ASCCTR1              0x066A     1642          code     absolute
INBUFA6              0x0648     1608          code     absolute
outcharlcd8          0x03EC     1004          code     absolute
initlcd1             0x0355      853          code     absolute
cgram                0x0040       64        number     absolute
initleds             0x01D4      468          code     absolute
P1out                0x00FE      254          code     absolute
mmwr2                0x00EC      236          data     absolute
fdres1               0x00CE      206          data     absolute
cd_con               0x00A1      161          data     absolute
eoc                  0x00A2      162           bit     absolute
data2                0x00DD      221          data     absolute
ccu6_pisel0l         0x009E      158          data     absolute
ccu6_t12dtch         0x00A5      165          data     absolute
ccu6_cmpmodifl       0x00A6      166          data     absolute
ccu6_tctr4h          0x009D      157          data     absolute
adc_resra3h          0x00D3      211          data     absolute
adc_chctr7           0x00D3      211          data     absolute
p1_pudsel            0x0090      144          data     absolute
p4_dir               0x00C9      201          data     absolute
modpisel             0x00B3      179          data     absolute
pssc                 0x00F9      249           bit     absolute
rb8                  0x009A      154           bit     absolute
ren                  0x009C      156           bit     absolute
sm1                  0x009E      158           bit     absolute
it1                  0x008A      138           bit     absolute
h9                   0x0079      121        number     absolute
ASCCTR2              0x066F     1647          code     absolute
INBUFA7              0x063A     1594          code     absolute
INBYTE1              0x0622     1570          code     absolute
OUTCHAR1             0x058C     1420          code     absolute
backsp               0x0008        8        number     absolute
lcdlighton           0x051A     1306          code     absolute
lcdoutbyte           0x0410     1040          code     absolute
outcharlcd9          0x03F1     1009          code     absolute
functions            0x0028       40        number     absolute
cursoronb            0x000F       15        number     absolute
delay1ms1            0x0339      825          code     absolute
scl                  0x8003    32771          data           bit     absolute
wdtwinb              0x00BD      189          data     absolute
mducon               0x00B1      177          data     absolute
data3                0x00DE      222          data     absolute
ccu6_inph            0x009F      159          data     absolute
ccu6_mcmoutsl        0x009E      158          data     absolute
exen2                0x00C3      195           bit     absolute
adc_resra2h          0x00CF      207          data     absolute
p4_altsel0           0x00C8      200          data     absolute
p4_pudsel            0x00C8      200          data     absolute
p5_dir               0x0093      147          data     absolute
bg                   0x00BE      190          data     absolute
exicon0              0x00B7      183          data     absolute
exm                  0x00EB      235           bit     absolute
cy                   0x00D7      215           bit     absolute
sm2                  0x009D      157           bit     absolute
tl0                  0x008A      138          data     absolute
mapregs              0x0B15     2837          code     absolute
div321               0x08AB     2219          code     absolute
ASCII4               0x06B6     1718          code     absolute
ASCCTR3              0x0673     1651          code     absolute
sioinchar            0x0601     1537          code     absolute
XONXOFF              0x05EB     1515          code     absolute
siodispdptr          0x05BA     1466          code     absolute
siooutnib            0x0592     1426          code     absolute
initsio              0x0552     1362          code     absolute
lcdlightoff          0x0527     1319          code     absolute
lcdtoport            0x0501     1281          code     absolute
BUILD1               0x04CC     1228          code     absolute
initftoetsen         0x01B9      441          code     absolute
t21_t2l              0x00C4      196          data     absolute
t21_t2mod            0x00C1      193          data     absolute
t21_t2con            0x00C0      192          data     absolute
cd_cordzh            0x009F      159          data     absolute
md0                  0x00B2      178          data     absolute
can_bsy              0x00D9      217           bit     absolute
ssc_brh              0x00AF      175          data     absolute
ccu6_modctrh         0x00FD      253          data     absolute
ccu6_tctr2h          0x00FB      251          data     absolute
ccu6_cc60rh          0x00FB      251          data     absolute
ccu6_t13prh          0x009F      159          data     absolute
adc_qbur0            0x00D2      210          data     absolute
adc_crpr1            0x00CB      203          data     absolute
adc_resra1h          0x00CD      205          data     absolute
p4_altsel1           0x00C9      201          data     absolute
port_page            0x00B2      178          data     absolute
feah                 0x00BD      189          data     absolute
exicon1              0x00BA      186          data     absolute
px0                  0x00B8      184           bit     absolute
ti                   0x0099      153           bit     absolute
tb8                  0x009B      155           bit     absolute
tl1                  0x008B      139          data     absolute
hexbcd16             0x0A06     2566          code     absolute
div322               0x08EE     2286          code     absolute
BDELETE1             0x065A     1626          code     absolute
XONXOFF1             0x05F7     1527          code     absolute
BUILD2               0x04DB     1243          code     absolute
outc                 0x048A     1162          code     absolute
outniblcd            0x03F9     1017          code     absolute
delay1ms             0x0332      818          code     absolute
iicinbytenack1       0x02DF      735          code     absolute
DATAREG              0x0011       17        number     absolute
RESET                0x9001    36865          data           bit     absolute
ri1                  0x00C8      200           bit     absolute
wdtl                 0x00BE      190          data     absolute
dmap                 0x00A4      164           bit     absolute
cd_cordyh            0x009D      157          data     absolute
md1                  0x00B3      179          data     absolute
ccu6_trpctrl         0x00FE      254          data     absolute
ccu6_issh            0x00A5      165          data     absolute
ccu6_cc61rh          0x00FD      253          data     absolute
ccu6_t12prh          0x009D      157          data     absolute
adc_qmr0             0x00CD      205          data     absolute
adc_evinfr           0x00CE      206          data     absolute
adc_resra0h          0x00CB      203          data     absolute
p5_od                0x0092      146          data     absolute
ov                   0x00D2      210           bit     absolute
px1                  0x00BA      186           bit     absolute
ip                   0x00B8      184          data     absolute
syscon0              0x008F      143          data     absolute
dph                  0x0083      131          data     absolute
BATRANS              0x0682     1666          code     absolute
LOWUPTR1             0x0678     1656          code     absolute
BDELETE2             0x0663     1635          code     absolute
XONXOFF2             0x05F2     1522          code     absolute
delay2ms             0x04E1     1249          code     absolute
BUILD3               0x04CF     1231          code     absolute
outd                 0x0450     1104          code     absolute
outbytelcd           0x0410     1040          code     absolute
ddram                0x0080      128        number     absolute
delay10us            0x030A      778          code     absolute
backlight            0xF006    61446          data           bit     absolute
fdstep1              0x00CD      205          data     absolute
cd_cordxh            0x009B      155          data     absolute
md2                  0x00B4      180          data     absolute
auad0                0x00DA      218           bit     absolute
ssc_rbl              0x00AD      173          data     absolute
ccu6_cc62rh          0x00FF      255          data     absolute
ccu6_tctr0h          0x00A7      167          data     absolute
ccu6_t12dtcl         0x00A4      164          data     absolute
ccu6_isrh            0x00A5      165          data     absolute
ccu6_tctr4l          0x009C      156          data     absolute
ccu6_page            0x00A3      163          data     absolute
t2_t2h               0x00C5      197          data     absolute
adc_vfcr             0x00CE      206          data     absolute
adc_resra3l          0x00D2      210          data     absolute
p4_od                0x00C8      200          data     absolute
misc_con             0x00E9      233          data     absolute
nmicon               0x00BB      187          data     absolute
px2                  0x00FA      250           bit     absolute
ip1                  0x00F8      248          data     absolute
eccip0               0x00EC      236           bit     absolute
ri                   0x0098      152           bit     absolute
adcpotmeter1         0x0710     1808          code     absolute
LOWUPTR2             0x0681     1665          code     absolute
LOWUPTR              0x0675     1653          code     absolute
BDELETE3             0x065E     1630          code     absolute
sioinbyte            0x0609     1545          code     absolute
XONXOFF3             0x05FC     1532          code     absolute
OUTMSGA              0x05CD     1485          code     absolute
DISPDPTR             0x05BA     1466          code     absolute
xoff                 0x0013       19        number     absolute
porttolcd            0x04E8     1256          code     absolute
outmsgalcd1          0x043C     1084          code     absolute
cursathom            0x0002        2        number     absolute
lcdport              0x00F0      240        number     absolute
hwbpdr               0x00F7      247          data     absolute
ti1                  0x00C9      201           bit     absolute
tb81                 0x00CB      203           bit     absolute
t21_rc2h             0x00C3      195          data     absolute
cd_statc             0x00A0      160          data     absolute
md3                  0x00B5      181          data     absolute
mr0                  0x00B2      178          data     absolute
auad1                0x00DB      219           bit     absolute
ccu6_inpl            0x009E      158          data     absolute
ccu6_cc63rh          0x009B      155          data     absolute
cprl2                0x00C0      192           bit     absolute
adc_qinr0            0x00D3      211          data     absolute
adc_resra2l          0x00CE      206          data     absolute
adc_page             0x00D1      209          data     absolute
p3_od                0x00B0      176          data     absolute
p3_altsel0           0x00B0      176          data     absolute
p0_puden             0x0086      134          data     absolute
eccip1               0x00ED      237           bit     absolute
th0                  0x008C      140          data     absolute
XCsw2xtal0           0x0ADA     2778          code     absolute
adcpotmeter          0x0700     1792          code     absolute
LOWUPTR3             0x067D     1661          code     absolute
OUTMSGA1             0x05E2     1506          code     absolute
siooutmsga           0x05CD     1485          code     absolute
OUTNIB               0x0592     1426          code     absolute
endbuf               0x007F      127        number     absolute
outhnibc             0x04A0     1184          code     absolute
outmsgalcde          0x0447     1095          code     absolute
displayof            0x0008        8        number     absolute
iicinbyteack         0x028C      652          code     absolute
statusCheck          0x006A      106          code     absolute
sda                  0x8007    32775          data           bit     absolute
bg1                  0x00CB      203          data     absolute
sm21                 0x00CD      205           bit     absolute
cd_bsy               0x00A0      160           bit     absolute
int_en               0x00A3      163           bit     absolute
cd_cordzl            0x009E      158          data     absolute
md4                  0x00B6      182          data     absolute
mr1                  0x00B3      179          data     absolute
adcon                0x00D8      216          data     absolute
ssc_brl              0x00AE      174          data     absolute
ssc_tbl              0x00AC      172          data     absolute
ccu6_modctrl         0x00FC      252          data     absolute
ccu6_tctr2l          0x00FA      250          data     absolute
ccu6_t12mselh        0x009B      155          data     absolute
ccu6_cc60rl          0x00FA      250          data     absolute
ccu6_t13prl          0x009E      158          data     absolute
t2_t2mod             0x00C1      193          data     absolute
t2_t2con             0x00C0      192          data     absolute
adc_crcr1            0x00CA      202          data     absolute
adc_evincr           0x00CF      207          data     absolute
adc_resra1l          0x00CC      204          data     absolute
p3_altsel1           0x00B1      177          data     absolute
p2_puden             0x00A1      161          data     absolute
p2_pudsel            0x00A0      160          data     absolute
p1_puden             0x0091      145          data     absolute
feal                 0x00BC      188          data     absolute
fdstep               0x00EA      234          data     absolute
ircon0               0x00B4      180          data     absolute
eccip2               0x00EE      238           bit     absolute
p                    0x00D0      208           bit     absolute
pt0                  0x00B9      185           bit     absolute
eo                   0x00A2      162          data     absolute
th1                  0x008D      141          data     absolute
nomapregs            0x0B19     2841          code     absolute
XCsw2xtal1           0x0AE1     2785          code     absolute
sub32                0x09D6     2518          code     absolute
div32                0x0866     2150          code     absolute
INCHAR               0x0601     1537          code     absolute
outmsga2             0x05D5     1493          code     absolute
BUILD                0x04CA     1226          code     absolute
outhnibd             0x0460     1120          code     absolute
outcharlcd           0x03A2      930          code     absolute
initlcd              0x0344      836          code     absolute
delaya0k05s1         0x0322      802          code     absolute
iicoutbyte1          0x0264      612          code     absolute
main                 0x0000        0          code     absolute
hwbpsr               0x00F6      246          data     absolute
mmbpcr               0x00F3      243          data     absolute
rb81                 0x00CA      202           bit     absolute
ren1                 0x00CC      204           bit     absolute
sm11                 0x00CE      206           bit     absolute
cd_cordyl            0x009C      156          data     absolute
md5                  0x00B7      183          data     absolute
mr2                  0x00B4      180          data     absolute
mdustat              0x00B0      176          data     absolute
ccu6_t13h            0x00FD      253          data     absolute
ccu6_pisel2          0x00A4      164          data     absolute
ccu6_ish             0x009D      157          data     absolute
ccu6_issl            0x00A4      164          data     absolute
ccu6_cc61rl          0x00FC      252          data     absolute
ccu6_t12prl          0x009C      156          data     absolute
adc_evinsr           0x00D2      210          data     absolute
adc_resra0l          0x00CA      202          data     absolute
adc_resr3h           0x00D3      211          data     absolute
adc_prar             0x00CC      204          data     absolute
p1_od                0x0090      144          data     absolute
p5_pudsel            0x0092      146          data     absolute
p3_puden             0x00B1      177          data     absolute
fdres                0x00EB      235          data     absolute
ircon1               0x00B5      181          data     absolute
eccip3               0x00EF      239           bit     absolute
pt1                  0x00BB      187           bit     absolute
tf0                  0x008D      141           bit     absolute
dpl                  0x0082      130          data     absolute
XCsw2xtal2           0x0AE4     2788          code     absolute
hexbcd161            0x0A13     2579          code     absolute
add32                0x09A8     2472          code     absolute
mul161               0x0819     2073          code     absolute
strtbuf              0x0054       84        number     absolute
wissen               0x054E     1358          code     absolute
lf                   0x000A       10        number     absolute
delaya0k05s2         0x031F      799          code     absolute
STA                  0x0010       16        number     absolute
WR                   0xB000    45056          data           bit     absolute
sm01                 0x00CF      207           bit     absolute
cd_cordxl            0x009A      154          data     absolute
mr3                  0x00B5      181          data     absolute
ccu6_t12h            0x00FB      251          data     absolute
ccu6_cc62rl          0x00FE      254          data     absolute
ccu6_tctr0l          0x00A6      166          data     absolute
ccu6_isrl            0x00A4      164          data     absolute
ccu6_cc63srh         0x009B      155          data     absolute
t2_t2l               0x00C4      196          data     absolute
t2_rc2h              0x00C3      195          data     absolute
adc_chinfr           0x00CA      202          data     absolute
adc_resr2h           0x00CF      207          data     absolute
p0_od                0x0080      128          data     absolute
p5_puden             0x0093      147          data     absolute
p4_puden             0x00C9      201          data     absolute
id                   0x00B3      179          data     absolute
ircon2               0x00B6      182          data     absolute
eadc                 0x00E8      232           bit     absolute
acc                  0x00E0      224          data     absolute
iph                  0x00B9      185          data     absolute
pt2                  0x00BD      189           bit     absolute
ex0                  0x00A8      168           bit     absolute
tf1                  0x008F      143           bit     absolute
XCsw2xtal3           0x0AFD     2813          code     absolute
bcdhex16             0x0A56     2646          code     absolute
mul162               0x0837     2103          code     absolute
h0                   0x0070      112        number     absolute
outmsgalcd           0x0434     1076          code     absolute
cleardisp            0x0001        1        number     absolute
zendComando          0x0166      358          code     absolute
COMANDREG            0x0012       18        number     absolute
lus2                 0x002D       45          code     absolute
FS                   0x9000    36864          data           bit     absolute
sbuf1                0x00C9      201          data     absolute
t21_rc2l             0x00C2      194          data     absolute
wdtcon               0x00BB      187          data     absolute
keepx                0x00A5      165           bit     absolute
mr4                  0x00B6      182          data     absolute
irdy                 0x00B0      176           bit     absolute
ierr                 0x00B1      177           bit     absolute
ssc_pisel            0x00A9      169          data     absolute
ccu6_cc63rl          0x009A      154          data     absolute
ccu6_cc62srh         0x00FF      255          data     absolute
tf2                  0x00C7      199           bit     absolute
adc_qsr0             0x00CE      206          data     absolute
adc_rcr0             0x00CA      202          data     absolute
adc_resr1h           0x00CD      205          data     absolute
p5_data              0x0092      146          data     absolute
modsusp              0x00BD      189          data     absolute
ircon3               0x00B4      180          data     absolute
pll_con              0x00B7      183          data     absolute
osc_con              0x00B6      182          data     absolute
pccip0               0x00FC      252           bit     absolute
b                    0x00F0      240          data     absolute
rs0                  0x00D3      211           bit     absolute
ex1                  0x00AA      170           bit     absolute
ea                   0x00AF      175           bit     absolute
h1                   0x0071      113        number     absolute
BATRANS1             0x0685     1669          code     absolute
BDELETE              0x0656     1622          code     absolute
INBYTE               0x0609     1545          code     absolute
OUTCHAR              0x058A     1418          code     absolute
lcdbuzon             0x0534     1332          code     absolute
lcdoutmsga           0x0434     1076          code     absolute
outniblcd1           0x0404     1028          code     absolute
outcharlcd1          0x03A9      937          code     absolute
iicoutbyte           0x0250      592          code     absolute
iicstart             0x0209      521          code     absolute
P4in                 0x0134      308          code     absolute
mmdr                 0x00F5      245          data     absolute
keepy                0x00A6      166           bit     absolute
mr5                  0x00B7      183          data     absolute
rwen                 0x00D8      216           bit     absolute
ccu6_mcmouth         0x009B      155          data     absolute
ccu6_t12msell        0x009A      154          data     absolute
ccu6_cc61srh         0x00FD      253          data     absolute
adc_q0r0             0x00CF      207          data     absolute
adc_evinpr           0x00D3      211          data     absolute
adc_rcr1             0x00CB      203          data     absolute
adc_resr0h           0x00CB      203          data     absolute
adc_chctr0           0x00CA      202          data     absolute
p4_data              0x00C8      200          data     absolute
ircon4               0x00B5      181          data     absolute
pmcon0               0x00B4      180          data     absolute
pccip1               0x00FD      253           bit     absolute
ex2                  0x00EA      234           bit     absolute
rs1                  0x00D4      212           bit     absolute
f0                   0x00D5      213           bit     absolute
psw                  0x00D0      208          data     absolute
es                   0x00AC      172           bit     absolute
sp                   0x0081      129          data     absolute
hexbcd8              0x0A46     2630          code     absolute
mul32                0x0720     1824          code     absolute
h2                   0x0072      114        number     absolute
initadc              0x06C6     1734          code     absolute
ASCII41              0x06C5     1733          code     absolute
BATRANS2             0x0689     1673          code     absolute
sioinbufa            0x0623     1571          code     absolute
siooutchar           0x058A     1418          code     absolute
beep                 0x0007        7        number     absolute
outniblcde           0x0408     1032          code     absolute
outcharlcde          0x03F4     1012          code     absolute
outcharlcd2          0x03AE      942          code     absolute
sdaout               0x0080      128        number     absolute
inits                0x0066      102          code     absolute
buzzer               0xF007    61447          data           bit     absolute
mmcr                 0x00F1      241          data     absolute
bcon1                0x00CA      202          data     absolute
scon1                0x00C8      200          data     absolute
keepz                0x00A7      167           bit     absolute
v0                   0x00DC      220           bit     absolute
ccu6_cmpstath        0x00FF      255          data     absolute
ccu6_t13l            0x00FC      252          data     absolute
ccu6_isl             0x009C      156          data     absolute
ccu6_ienh            0x009D      157          data     absolute
ccu6_cc60srh         0x00FB      251          data     absolute
adc_chincr           0x00CB      203          data     absolute
adc_rcr2             0x00CC      204          data     absolute
adc_resr3l           0x00D2      210          data     absolute
adc_chctr1           0x00CB      203          data     absolute
p0_pudsel            0x0080      128          data     absolute
p3_data              0x00B0      176          data     absolute
modpisel1            0x00B7      183          data     absolute
pmcon1               0x00B5      181          data     absolute
fdcon                0x00E9      233          data     absolute
scu_page             0x00BF      191          data     absolute
pccip2               0x00FE      254           bit     absolute
essc                 0x00E9      233           bit     absolute
f1                   0x00D1      209           bit     absolute
h3                   0x0073      115        number     absolute
adclm3351            0x06F0     1776          code     absolute
INBUFA1              0x0632     1586          code     absolute
cr                   0x000D       13        number     absolute
outcharlcd3          0x03BA      954          code     absolute
sdain                0x007F      127        number     absolute
debug                0x0187      391          code     absolute
zendData             0x0146      326          code     absolute
e                    0xF001    61441          data           bit     absolute
mmsr                 0x00F2      242          data     absolute
adh                  0x00DA      218          data     absolute
v1                   0x00DD      221           bit     absolute
ssc_conh             0x00AB      171          data     absolute
ccu6_t12l            0x00FA      250          data     absolute
ccu6_cc63srl         0x009A      154          data     absolute
t2_rc2l              0x00C2      194          data     absolute
ct2                  0x00C1      193           bit     absolute
adc_chinsr           0x00CC      204          data     absolute
adc_rcr3             0x00CD      205          data     absolute
adc_resr2l           0x00CE      206          data     absolute
adc_chctr2           0x00CC      204          data     absolute
adc_lcbr             0x00CD      205          data     absolute
adc_globstr          0x00CB      203          data     absolute
p1_altsel0           0x0090      144          data     absolute
p3_pudsel            0x00B0      176          data     absolute
p2_data              0x00A0      160          data     absolute
pmcon2               0x00BB      187          data     absolute
modpisel2            0x00BA      186          data     absolute
passwd               0x00BB      187          data     absolute
pxm                  0x00FB      251           bit     absolute
pccip3               0x00FF      255           bit     absolute
et0                  0x00A9      169           bit     absolute
tmod                 0x0089      137          data     absolute
tr0                  0x008C      140           bit     absolute
tcon                 0x0088      136          data     absolute
sub16                0x09F1     2545          code     absolute
div161               0x095C     2396          code     absolute
div16                0x0935     2357          code     absolute
h4                   0x0074      116        number     absolute
ASCII21              0x06B5     1717          code     absolute
ASCCTR               0x0667     1639          code     absolute
INBUFA2              0x0625     1573          code     absolute
OUTBYTE              0x05A6     1446          code     absolute
blank                0x0020       32        number     absolute
outcharlcd4          0x03C4      964          code     absolute
cursoronn            0x000E       14        number     absolute
cursoroff            0x000C       12        number     absolute
iicinbytenack        0x02CB      715          code     absolute
iicinbyteack1        0x02A0      672          code     absolute


*** Externals (Imports) ***
name                    hex      dec          type
--------------------------------------------------


*** Publics (Exports) ***
name                    hex      dec          type
--------------------------------------------------
