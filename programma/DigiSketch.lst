C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  org 0000h
       2       2   00000                  
       3       3   00000                  
       4       4   00000                  
       5       5   00000                  ;------------------------------------------------------------------
       6       6   00000                  ;Hoofd programma
       7       7   00000                  ;------------------------------------------------------------------
       8       8   00000                  main:
       9       9   00000 75817F               mov     sp,#7fh                 ;stackpointer instellen
      10      10   00003 12005D               lcall   inits
      11      11   00006                  
      12      12   00006 751128               mov     DATAREG,#28h            ;adres pointer voor tekst instellen
      13      13   00009 120140               lcall   zendData
      14      14   0000C 751100               mov     DATAREG,#00h
      15      15   0000F 120140               lcall   zendData
      16      16   00012 751224               mov     COMANDREG,#24h
      17      17   00015 12015D               lcall   zendComando
      18      18   00018                  
      19      19   00018 751124               mov     DATAREG,#24h
      20      20   0001B 120140               lcall   zendData
      21      21   0001E 7512C0               mov     COMANDREG,#c0h
      22      22   00021 12015D               lcall   zendComando
      23      23   00024                  
      24      24   00024                  
      25      25   00024 751124               mov     DATAREG,#24h
      26      26   00027 120140               lcall   zendData
      27      27   0002A 7512C0               mov     COMANDREG,#c0h
      28      28   0002D 12015D               lcall   zendComando
      29      29   00030                  
      30      30   00030                  
      31      31   00030 751124               mov     DATAREG,#24h
      32      32   00033 120140               lcall   zendData
      33      33   00036 7512C0               mov     COMANDREG,#c0h
      34      34   00039 12015D               lcall   zendComando
      35      35   0003C                  
      36      36   0003C                  
      37      37   0003C 751124               mov     DATAREG,#24h
      38      38   0003F 120140               lcall   zendData
      39      39   00042 7512C0               mov     COMANDREG,#c0h
      40      40   00045 12015D               lcall   zendComando
      41      41   00048                  
      42      42   00048                  
      43      43   00048 751124               mov     DATAREG,#24h
      44      44   0004B 120140               lcall   zendData
      45      45   0004E 7512C0               mov     COMANDREG,#c0h
      46      46   00051 12015D               lcall   zendComando
      47      47   00054 75129C               mov     COMANDREG,#9ch
      48      48   00057 12015D               lcall   zendComando
      49      49   0005A                  lus2:
      50      50   0005A                  
      51      51   0005A 02005A               ljmp    lus2
      52      52   0005D                  
      53      53   0005D                  
      54      54   0005D                  
      55      55   0005D                  ;------------------------------------------------------------------
      56      56   0005D                  ;Initializatie van alle componenten nodig in het hoofd programma
      57      57   0005D                  ;------------------------------------------------------------------
      58      58   0005D                  inits:
      59      59   0005D 12008C               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      60      60   00060 22               ret
      61      61   00061                  
      62      62   00061                  
      63      63   00061                  
      64      64   00061                  
      65      65   00061                  
project.inc 
      67       1   00061                  ;------------------------------------------------------------------
      68       2   00061                  ;Lijst van functies:
      69       3   00061                  ;   -statusCheck            Status check van scherm opslaan in STA register
      70       4   00061                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      71       5   00061                  ;   -P1out                  Initializatie poort 1 als output
      72       6   00061                  ;   -P3in                   Initializatie poort 3 als output
      73       7   00061                  ;   -P3out                  Initializatie poort 3 als input
      74       8   00061                  ;   -zendData               Data verzeden naar scherm
      75       9   00061                  ;   -zenComando             Comando verzeden naar scherm
      76      10   00061                  ;   -debug                  debug info op seriele poot zetten
      77      11   00061                  ;------------------------------------------------------------------
      78      12   00061                  ;------------------------------------------------------------------
      79      13   00061                  ;declaratie van pinnen
      80      14   00061                  ;------------------------------------------------------------------
      81      15   00061                      WR          bit     p3_data.0   ;write line van scherm actief laag
      82      16   00061                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      83      17   00061                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      84      18   00061                      CD          bit     p3_data.3   ;Command write
      85      19   00061                      RESET       bit     p1_data.1   ;reset van scherm actief laag
      86      20   00061                      FS          bit     p1_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      87      21   00061                  
      88      22   00061                  
      89      23   00061                  
      90      24   00061                  ;------------------------------------------------------------------
      91      25   00061                  ;declaratie van registers
      92      26   00061                  ;------------------------------------------------------------------
      93      27   00061                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      94      28   00061                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      95      29   00061                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      96      30   00061                  
      97      31   00061                  
      98      32   00061                  ;------------------------------------------------------------------
      99      33   00061                  ;Status check van scherm opslaan in STA register
     100      34   00061                  ;-STA
     101      35   00061                  ;------------------------------------------------------------------
     102      36   00061                  statusCheck:
     103      37   00061 C0E0                 push    acc
     104      38   00063 C0D0                 push    psw
     105      39   00065 12012E               lcall   P5in                        ;poort 4 als input schakelen
     106      40   00068 12010A               lcall   P3out
     107      41   0006B                  STAOPNIEUW:
     108      42   0006B 75B000               mov     p3_data,#00h
     109      43   0006E 751000               mov     STA,#00h                    ;STA register leeg maken
     110      44   00071 75B00E               mov     p3_data,#00001110b
     111      45   00074 120325               lcall   delay1ms
     112      46   00077 E592                 mov     a,p5_data                   ;status word inlezen
     113      47   00079 5403                 anl     a,#00000011b                ;masker voor STA0 en STA1
     114      48   0007B                  ;    mov     r0,a                        ;debug status op aurt zetten
     115      49   0007B                  ;    lcall   debug
     116      50   0007B B403ED               cjne    a,#00000011b,STAOPNIEUW      ;vergelijken
     117      51   0007E F510                 mov     STA,a                       ;data opslaan in STA voor eventuel gebruik later
     118      52   00080 F8                   mov     r0,a                        ;debug status op aurt zetten
     119      53   00081 12017A               lcall   debug
     120      54   00084 75B000               mov     p3_data,#00h
     121      55   00087 D0D0                 pop     psw
     122      56   00089 D0E0                 pop     acc
     123      57   0008B 22               ret
     124      58   0008C                  
     125      59   0008C                  ;------------------------------------------------------------------
     126      60   0008C                  ;Initializatie van grafisch LCD scherm
     127      61   0008C                  ;-Poort 1
     128      62   0008C                  ;------------------------------------------------------------------
     129      63   0008C                  initGLCD:
     130      64   0008C 1200EF               lcall   P1out                   ;poort 1 initializeren
     131      65   0008F C291                 clr     RESET                   ;reseten van scherm
     132      66   00091 7420                 mov     a,#20h                   ;reset lang genenoeg laten duren
     133      67   00093 12030C               lcall   delaya0k05s
     134      68   00096 D290                 setb    FS                      ;font op 6*8 zetten
     135      69   00098 D291                 setb    RESET                   ;reset terug af zetten
     136      70   0009A                  
     137      71   0009A                  
     138      72   0009A 120545               lcall   initsio                 ;voor debug
     139      73   0009D                  
     140      74   0009D 120061               lcall   statusCheck             ;initiele status check uitvoeren
     141      75   000A0                  
     142      76   000A0 751280               mov     COMANDREG,#80h          ;mode instellen
     143      77   000A3 12015D               lcall   zendComando             ;mode instellen
     144      78   000A6                  
     145      79   000A6 751100               mov     DATAREG,#00h            ;grafisch home adres
     146      80   000A9 120140               lcall   zendData
     147      81   000AC 751100               mov     DATAREG,#00h
     148      82   000AF 120140               lcall   zendData
     149      83   000B2 751242               mov     COMANDREG,#42h
     150      84   000B5 12015D               lcall   zendComando
     151      85   000B8                  
     152      86   000B8 751128               mov     DATAREG,#28h            ;Grafic aeria set
     153      87   000BB 120140               lcall   zendData
     154      88   000BE 751100               mov     DATAREG,#00h
     155      89   000C1 120140               lcall   zendData
     156      90   000C4 751243               mov     COMANDREG,#43h
     157      91   000C7 12015D               lcall   zendComando
     158      92   000CA                  
     159      93   000CA                  
     160      94   000CA 751100               mov     DATAREG,#00h            ;text home aderes
     161      95   000CD 120140               lcall   zendData
     162      96   000D0 751100               mov     DATAREG,#00h
     163      97   000D3 120140               lcall   zendData
     164      98   000D6 751240               mov     COMANDREG,#40h
     165      99   000D9 12015D               lcall   zendComando
     166     100   000DC                  
     167     101   000DC 751128               mov     DATAREG,#28h            ;aantal colommen text
     168     102   000DF 120140               lcall   zendData
     169     103   000E2 751100               mov     DATAREG,#00h
     170     104   000E5 120140               lcall   zendData
     171     105   000E8 751241               mov     COMANDREG,#41h
     172     106   000EB 12015D               lcall   zendComando
     173     107   000EE 22               ret
     174     108   000EF                  
     175     109   000EF                  
     176     110   000EF                  ;------------------------------------------------------------------
     177     111   000EF                  ;Initializatie poort 1 als output
     178     112   000EF                  ;-poort 1
     179     113   000EF                  ;------------------------------------------------------------------
     180     114   000EF                  P1out:
     181     115   000EF C08F                 push    syscon0                 ;juiste map selecteren
     182     116   000F1 758F04               mov     syscon0,#004h
     183     117   000F4 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     184     118   000F6 75B201               mov     port_page,#001h         ;selecteer poort page 0
     185     119   000F9 7590FF               mov     p1_pudsel,#0ffh         ;selecteer pull_up device
     186     120   000FC 7591FF               mov     p1_puden,#0ffh          ;selectie inschakelen
     187     121   000FF 75B200               mov     port_page,#000h         ;selecteer poort page 0
     188     122   00102 7591FF               mov     p1_dir,#0ffh            ;poort 1 als output schakelen
     189     123   00105 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     190     124   00107 D08F                 pop     syscon0                 ;pagina terug herstellen
     191     125   00109 22               ret
     192     126   0010A                  
     193     127   0010A                  ;------------------------------------------------------------------
     194     128   0010A                  ;Initializatie poort 3 als output
     195     129   0010A                  ;-poort 3
     196     130   0010A                  ;------------------------------------------------------------------
     197     131   0010A                  P3out:
     198     132   0010A C08F                 push    syscon0                 ;juiste map selecteren
     199     133   0010C 758F04               mov     syscon0,#004h
     200     134   0010F C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     201     135   00111 75B200               mov     port_page,#000h         ;selecteer poort page 0
     202     136   00114 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output schakelen
     203     137   00117 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     204     138   00119 D08F                 pop     syscon0                 ;pagina terug herstellen
     205     139   0011B 22               ret
     206     140   0011C                  
     207     141   0011C                  ;------------------------------------------------------------------
     208     142   0011C                  ;Initializatie poort 5 als output
     209     143   0011C                  ;-poort 5
     210     144   0011C                  ;------------------------------------------------------------------
     211     145   0011C                  P5out:
     212     146   0011C C08F                 push    syscon0                 ;juiste map selecteren
     213     147   0011E 758F04               mov     syscon0,#004h
     214     148   00121 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     215     149   00123 75B200               mov     port_page,#000h         ;selecteer poort page 0
     216     150   00126 7593FF               mov     p5_dir,#0ffh            ;poort 5 als output schakelen
     217     151   00129 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     218     152   0012B D08F                 pop     syscon0                 ;pagina terug herstellen
     219     153   0012D 22               ret
     220     154   0012E                  
     221     155   0012E                  ;------------------------------------------------------------------
     222     156   0012E                  ;Initializatie poort 4 als input
     223     157   0012E                  ;-poort 4
     224     158   0012E                  ;------------------------------------------------------------------
     225     159   0012E                  P5in:
     226     160   0012E C08F                 push    syscon0                 ;juiste map selecteren
     227     161   00130 758F04               mov     syscon0,#004h
     228     162   00133 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     229     163   00135 75B200               mov     port_page,#000h         ;selecteer poort page 0
     230     164   00138 759300               mov     p5_dir,#000h            ;poort 5 als input schakelen
     231     165   0013B D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     232     166   0013D D08F                 pop     syscon0                 ;pagina terug herstellen
     233     167   0013F 22               ret
     234     168   00140                  ;------------------------------------------------------------------
     235     169   00140                  ;Data verzeden naar scherm
     236     170   00140                  ;-DATAREG
     237     171   00140                  ;------------------------------------------------------------------
     238     172   00140                  zendData:
     239     173   00140 C0E0                 push    acc
     240     174   00142 C0D0                 push    psw
     241     175   00144 12011C               lcall   P5out                   ;poort 5 als output schakelen
     242     176   00147 75B002               mov     p3_data,#0000010b
     243     177   0014A 120325               lcall   delay1ms
     244     178   0014D 851192               mov     p5_data,DATAREG               ;data op de poort zetten
     245     179   00150 A811                 mov     r0,DATAREG
     246     180   00152 12017A               lcall   debug
     247     181   00155 120061               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     248     182   00158 D0D0                 pop     psw
     249     183   0015A D0E0                 pop     acc
     250     184   0015C 22               ret
     251     185   0015D                  
     252     186   0015D                  ;------------------------------------------------------------------
     253     187   0015D                  ;Comando verzeden naar scherm
     254     188   0015D                  ;-COMANDREG
     255     189   0015D                  ;------------------------------------------------------------------
     256     190   0015D                  zendComando:
     257     191   0015D C0E0                 push    acc
     258     192   0015F C0D0                 push    psw
     259     193   00161 12011C               lcall   P5out                   ;poort 5 als output schakelen
     260     194   00164 75B00A               mov     p3_data,#00001010b
     261     195   00167 120325               lcall   delay1ms
     262     196   0016A 851292               mov     p5_data,COMANDREG       ;data op de poort zetten
     263     197   0016D A812                 mov     r0,COMANDREG
     264     198   0016F 12017A               lcall   debug
     265     199   00172 120061               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     266     200   00175 D0D0                 pop     psw
     267     201   00177 D0E0                 pop     acc
     268     202   00179 22               ret
     269     203   0017A                  
     270     204   0017A                  ;------------------------------------------------------------------
     271     205   0017A                  ;debug info op seriele poort zetten
     272     206   0017A                  ;-r0
     273     207   0017A                  ;------------------------------------------------------------------
     274     208   0017A                  debug:
     275     209   0017A C0E0                 push    acc
     276     210   0017C C0D0                 push    psw
     277     211   0017E 740D                 mov     a,#0dh
     278     212   00180 12057D               lcall   siooutchar
     279     213   00183 E8                   mov     a,r0
     280     214   00184 120599               lcall   siooutbyte
     281     215   00187 740A                 mov     a,#0ah
     282     216   00189 12057D               lcall   siooutchar
     283     217   0018C D0D0                 pop     psw
     284     218   0018E D0E0                 pop     acc
     285     219   00190 22               ret
     286     220   00191                  
     287     221   00191                  
     288     222   00191                  
     289     223   00191                  
     290     224   00191                  
     291     225   00191                  
     292     226   00191                  
     293     227   00191                  
     294     228   00191                  
     295     229   00191                  
     296     230   00191                  
     297     231   00191                  
     298     232   00191                  
     299     233   00191                  
     300     234   00191                  
     301     235   00191                  
     302     236   00191                  
     303     237   00191                  
     304     238   00191                  
     305     239   00191                  
xcez1.inc 
     307       1   00191                  ;*******************************************************************************
     308       2   00191                  ;
     309       3   00191                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     310       4   00191                  ;
     311       5   00191                  ; The file contains drivers for various hardware and math applications.
     312       6   00191                  ; In addition all register declarations are added.
     313       7   00191                  ;
     314       8   00191                  ; WARNING:!!!!!!!
     315       9   00191                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     316      10   00191                  ;
     317      11   00191                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     318      12   00191                  ;
     319      13   00191                  ;*******************************************************************************
     320      14   00191                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     321      15   00191                  ;
     322      16   00191                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     323      17   00191                  ;
     324      18   00191                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     325      19   00191                  ; eenvoudige manier te gebruiken:
     326      20   00191                  ;
     327      21   00191                  ; standaard I/O:
     328      22   00191                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     329      23   00191                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     330      24   00191                  ;      initleds             klaar zetten LED's als outputs
     331      25   00191                  ;
     332      26   00191                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     333      27   00191                  ;      initiic              klaar zetten iic interface
     334      28   00191                  ;      iicstart             genereren van een startconditie op iic poort
     335      29   00191                  ;      iicstop              genereren stop conditie op iic poort
     336      30   00191                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     337      31   00191                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     338      32   00191                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     339      33   00191                  ;
     340      34   00191                  ; LCD interace
     341      35   00191                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     342      36   00191                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     343      37   00191                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     344      38   00191                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     345      39   00191                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     346      40   00191                  ;      lcdlighton           backlight aan
     347      41   00191                  ;      lcdlightoff          backlight uit
     348      42   00191                  ;      lcdbuzon             buzzer aan
     349      43   00191                  ;      lcdbuzof             buzzer uit
     350      44   00191                  ;
     351      45   00191                  ; Seriële interface (via USB stekker!!)
     352      46   00191                  ;      initsio              klaar zetten seriële poort 9600 baud
     353      47   00191                  ;      siooutchar           afdrukken ascii code (accu=input)
     354      48   00191                  ;      siooutbyte           afdrkken getal in accu
     355      49   00191                  ;      siooutnib            afdrukken 4 laagste bits accu
     356      50   00191                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     357      51   00191                  ;      sioinchar            inlezen van 1 ascii code in de accu
     358      52   00191                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     359      53   00191                  ;
     360      54   00191                  ; ADC
     361      55   00191                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     362      56   00191                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     363      57   00191                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     364      58   00191                  ;
     365      59   00191                  ; Arithmetic:
     366      60   00191                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     367      61   00191                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     368      62   00191                  ;      div16                delen 2 16 bit getallen
     369      63   00191                  ;      div32                delen 2 32 bit getallen
     370      64   00191                  ;      add16                optellen 2 16 bit getallen
     371      65   00191                  ;      add32                optellen 2 32 bit getallen
     372      66   00191                  ;      sub16                verschil 2 16 bit getallen
     373      67   00191                  ;      sub32                verschil 2 32 bit getallen
     374      68   00191                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     375      69   00191                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     376      70   00191                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     377      71   00191                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     378      72   00191                  ;
     379      73   00191                  ; Diverse
     380      74   00191                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     381      75   00191                  ;      delay1ms             tijdsverraging 1 milliseconde
     382      76   00191                  ;      delay10us            tijdsvertraging 10 microseconde
     383      77   00191                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     384      78   00191                  ;	mapregs 		selecteer de SFR's in de mapped area
     385      79   00191                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     386      80   00191                  ;
     387      81   00191                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     388      82   00191                  ; LET OP!!!!
     389      83   00191                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     390      84   00191                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     391      85   00191                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     392      86   00191                  ;
     393      87   00191                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     394      88   00191                  ;
     395      89   00191                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     396      90   00191                  
     397      91   00191                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     398      92   00191                  ;
     399      93   00191                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     400      94   00191                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     401      95   00191                  ; massa zonder extra weerstanden.
     402      96   00191                  ;
     403      97   00191                  ; Gebruikt geen registers
     404      98   00191                  ;
     405      99   00191                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     406     100   00191                  
     407     101   00191 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     408     102   00193 758F04                         mov    syscon0,#004h
     409     103   00196 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     410     104   00198 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     411     105   0019B 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     412     106   0019E 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     413     107   001A1 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     414     108   001A4 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     415     109   001A7 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     416     110   001A9 D08F                           pop    syscon0              ;pagina terug herstellen
     417     111   001AB 22                             ret
     418     112   001AC                  
     419     113   001AC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     420     114   001AC                  ;
     421     115   001AC                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     422     116   001AC                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     423     117   001AC                  ; 2 behouden hun originele instelling.
     424     118   001AC                  ;
     425     119   001AC                  ; Gebruikt geen registers
     426     120   001AC                  ;
     427     121   001AC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     428     122   001AC                  
     429     123   001AC C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     430     124   001AE 758F04                         mov    syscon0,#004h
     431     125   001B1 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     432     126   001B3 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     433     127   001B6 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     434     128   001B9 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     435     129   001BC 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     436     130   001BF 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     437     131   001C2 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     438     132   001C4 D08F                           pop    syscon0              ;pagina terug herstellen
     439     133   001C6 22                             ret
     440     134   001C7                  
     441     135   001C7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     442     136   001C7                  ;
     443     137   001C7                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     444     138   001C7                  ; worden gedoofd (actief laag om ze te laden branden).
     445     139   001C7                  ;
     446     140   001C7                  ; Gebruikt geen registers
     447     141   001C7                  ;
     448     142   001C7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     449     143   001C7                  
     450     144   001C7                  
     451     145   001C7 C08F             initleds:     push   syscon0              ;juiste map selecteren
     452     146   001C9 758F04                         mov    syscon0,#004h
     453     147   001CC C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     454     148   001CE 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     455     149   001D1 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     456     150   001D4 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     457     151   001D6 D08F                           pop    syscon0              ;pagina terug herstellen
     458     152   001D8 22                             ret
     459     153   001D9                  
     460     154   001D9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     461     155   001D9                  ;
     462     156   001D9                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     463     157   001D9                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     464     158   001D9                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     465     159   001D9                  ; sda wordt als input geschakeld
     466     160   001D9                  ;
     467     161   001D9                  ; LET OP!!
     468     162   001D9                  ; Dit is een IIC bus met beperkte mogelijkheden:
     469     163   001D9                  ; -vaste communicatiesnleheid van 100kbit/s
     470     164   001D9                  ; -enkel master mode
     471     165   001D9                  ; -enkel 7 bit adressering
     472     166   001D9                  ; -geen klok stretching
     473     167   001D9                  ;
     474     168   001D9                  ; Gebruikt geen registers
     475     169   001D9                  ;
     476     170   001D9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     477     171   001D9                  
     478     172   001D9                  sda           bit    p0_data.7            ;pin gebruikt als sda
     479     173   001D9                  scl           bit    p0_data.3            ;pin gebruikt als scl
     480     174   001D9                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     481     175   001D9                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     482     176   001D9                  
     483     177   001D9 C08F             initiic:      push   syscon0              ;juiste map selecteren
     484     178   001DB 758F04                         mov    syscon0,#004h
     485     179   001DE C0B2                           push   port_page
     486     180   001E0 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     487     181   001E3 D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     488     182   001E5 D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     489     183   001E7 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     490     184   001EA D283                           setb   scl                  ;klok werkt als od
     491     185   001EC D287                           setb   sda                  ;sda werkt als od
     492     186   001EE 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     493     187   001F1 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     494     188   001F4 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     495     189   001F7 D0B2                           pop    port_page            ;pagina herstellen
     496     190   001F9 D08F                           pop    syscon0              ;map herstellen
     497     191   001FB 22                             ret
     498     192   001FC                  
     499     193   001FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     500     194   001FC                  ;
     501     195   001FC                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     502     196   001FC                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     503     197   001FC                  ; te garanderen volgt er een delay van 10us
     504     198   001FC                  ;
     505     199   001FC                  ; Gebruikt geen registers
     506     200   001FC                  ;
     507     201   001FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     508     202   001FC                  
     509     203   001FC C08F             iicstart:     push   syscon0              ;map bewaren
     510     204   001FE 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     511     205   00201 C0B2                           push   port_page            ;pagina bewaren
     512     206   00203 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     513     207   00206 D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     514     208   00208 D287                           setb   sda                  ;idem
     515     209   0020A 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     516     210   0020D 1202FD                         lcall  delay10us            ;
     517     211   00210 C287                           clr    sda                  ;data laag
     518     212   00212 1202FD                         lcall  delay10us
     519     213   00215 C283                           clr    scl                  ;dan klok laag
     520     214   00217 1202FD                         lcall  delay10us            ;bit lang genoeg maken
     521     215   0021A D0B2                           pop    port_page            ;registers herstellen
     522     216   0021C D08F                           pop    syscon0
     523     217   0021E 22                             ret
     524     218   0021F                  
     525     219   0021F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     526     220   0021F                  ;
     527     221   0021F                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     528     222   0021F                  ;
     529     223   0021F                  ; Gebruikt geen registers
     530     224   0021F                  ;
     531     225   0021F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     532     226   0021F                  
     533     227   0021F C08F             iicstop:      push   syscon0              ;map bewaren
     534     228   00221 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     535     229   00224 C0B2                           push   port_page            ;pagina bewaren
     536     230   00226 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     537     231   00229 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     538     232   0022C C287                           clr    sda                  ;data naar omlaag
     539     233   0022E 1202FD                         lcall  delay10us
     540     234   00231 D283                           setb   scl                  ;klok naar 1
     541     235   00233 1202FD                         lcall  delay10us            ;wachten
     542     236   00236 D287                           setb   sda                  ;idem data
     543     237   00238 1202FD                         lcall  delay10us            ;
     544     238   0023B 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     545     239   0023E D0B2                           pop    port_page            ;registers herstellen
     546     240   00240 D08F                           pop    syscon0
     547     241   00242 22                             ret
     548     242   00243                  
     549     243   00243                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     550     244   00243                  ;
     551     245   00243                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     552     246   00243                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     553     247   00243                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     554     248   00243                  ;
     555     249   00243                  ; Gebruikt:
     556     250   00243                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     557     251   00243                  ;      cy=ack bit vanuit de slave
     558     252   00243                  ;
     559     253   00243                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     560     254   00243                  
     561     255   00243 C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     562     256   00245 C0F0                           push   b                    ;gebruikt als loopcounter
     563     257   00247 C08F                           push   syscon0              ;map juist zetten
     564     258   00249 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     565     259   0024C C0B2                           push   port_page            ;poort pagina bewaren
     566     260   0024E 75B200                         mov    port_page,#000h      ;basispagina selecteren
     567     261   00251 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     568     262   00254 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     569     263   00257 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     570     264   00258 9287                           mov    sda,c                ;op pin
     571     265   0025A 1202FD                         lcall  delay10us            ;wachten
     572     266   0025D D283                           setb   scl                  ;puls genereren
     573     267   0025F 1202FD                         lcall  delay10us            ;ook hier wat tijd laten
     574     268   00262 C283                           clr    scl                  ;klok terug laag maken
     575     269   00264 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     576     270   00267                  
     577     271   00267                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     578     272   00267                  
     579     273   00267 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     580     274   0026A 1202FD                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     581     275   0026D D283                           setb   scl                  ;puls terug hoog
     582     276   0026F A287                           mov    c,sda                ;inlezen en naar carry
     583     277   00271 1202FD                         lcall  delay10us
     584     278   00274 C283                           clr    scl                  ;klok blijft laag achter
     585     279   00276 D0B2                           pop    port_page
     586     280   00278 D08F                           pop    syscon0
     587     281   0027A D0F0                           pop    b
     588     282   0027C D0E0                           pop    acc
     589     283   0027E 22                             ret
     590     284   0027F                  
     591     285   0027F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     592     286   0027F                  ;
     593     287   0027F                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     594     288   0027F                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     595     289   0027F                  ;
     596     290   0027F                  ; Gebruikt:
     597     291   0027F                  ;      -de accu als output
     598     292   0027F                  ;
     599     293   0027F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     600     294   0027F                  
     601     295   0027F C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     602     296   00281 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     603     297   00284 C0B2                           push   port_page            ;pagina bewaren
     604     298   00286 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     605     299   00289 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     606     300   0028B C0D0                           push   psw                  ;vlaggen bewaren
     607     301   0028D 75F008                         mov    b,#008h              ;loopcounter laden
     608     302   00290 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     609     303   00293 1202FD           iicinbyteack1:lcall  delay10us
     610     304   00296 D283                           setb   scl                  ;klok hoog
     611     305   00298 A287                           mov    c,sda                ;pin inlezen
     612     306   0029A 33                             rlc    a                    ;in accu shiften
     613     307   0029B 1202FD                         lcall  delay10us
     614     308   0029E C283                           clr    scl                  ;klok terug laag
     615     309   002A0 D5F0F0                         djnz   b,iicinbyteack1
     616     310   002A3 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     617     311   002A6 C287                           clr    sda                  ;ack genereren
     618     312   002A8 1202FD                         lcall  delay10us
     619     313   002AB D283                           setb   scl
     620     314   002AD 1202FD                         lcall  delay10us
     621     315   002B0 C283                           clr    scl
     622     316   002B2 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     623     317   002B5 D0D0                           pop    psw                  ;registers herstellen
     624     318   002B7 D0F0                           pop    b
     625     319   002B9 D0B2                           pop    port_page
     626     320   002BB D08F                           pop    syscon0
     627     321   002BD 22                             ret
     628     322   002BE                  
     629     323   002BE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     630     324   002BE                  ;
     631     325   002BE                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     632     326   002BE                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     633     327   002BE                  ;
     634     328   002BE                  ; Gebruikt:
     635     329   002BE                  ;      -de accu als output
     636     330   002BE                  ;
     637     331   002BE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     638     332   002BE                  
     639     333   002BE C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     640     334   002C0 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     641     335   002C3 C0B2                           push   port_page            ;pagina bewaren
     642     336   002C5 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     643     337   002C8 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     644     338   002CA C0D0                           push   psw                  ;vlaggen bewaren
     645     339   002CC 75F008                         mov    b,#008h              ;loopcounter laden
     646     340   002CF 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     647     341   002D2 1202FD           iicinbytenack1:lcall  delay10us
     648     342   002D5 D283                           setb   scl                  ;klok hoog
     649     343   002D7 A287                           mov    c,sda                ;pin inlezen
     650     344   002D9 33                             rlc    a                    ;in accu shiften
     651     345   002DA 1202FD                         lcall  delay10us
     652     346   002DD C283                           clr    scl                  ;klok terug laag
     653     347   002DF D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     654     348   002E2 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     655     349   002E5 D287                           setb   sda                  ;nack genereren
     656     350   002E7 1202FD                         lcall  delay10us
     657     351   002EA D283                           setb   scl
     658     352   002EC 1202FD                         lcall  delay10us
     659     353   002EF C283                           clr    scl
     660     354   002F1 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     661     355   002F4 D0D0                           pop    psw                  ;registers herstellen
     662     356   002F6 D0F0                           pop    b
     663     357   002F8 D0B2                           pop    port_page
     664     358   002FA D08F                           pop    syscon0
     665     359   002FC 22                             ret
     666     360   002FD                  
     667     361   002FD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     668     362   002FD                  ;
     669     363   002FD                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     670     364   002FD                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     671     365   002FD                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     672     366   002FD                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     673     367   002FD                  ;
     674     368   002FD                  ; Gebruikt geen registers
     675     369   002FD                  ;
     676     370   002FD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     677     371   002FD                  
     678     372   002FD C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     679     373   002FF C0D0                           push   psw                  ;8*42ns=330ns
     680     374   00301 75E01A                         mov    acc,#01ah            ;420ns
     681     375   00304 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     682     376   00307 D0D0                           pop    psw                  ;8*42ns=330ns
     683     377   00309 D0E0                           pop    acc                  ;8*42ns=330ns
     684     378   0030B 22                             ret                         ;165ns
     685     379   0030C                  
     686     380   0030C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     687     381   0030C                  ;
     688     382   0030C                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     689     383   0030C                  ;
     690     384   0030C                  ; Gebruikt geen registers
     691     385   0030C                  ;
     692     386   0030C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     693     387   0030C                  
     694     388   0030C C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     695     389   0030E C0D0                           push   psw
     696     390   00310 C0F0                           push   b
     697     391   00312 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     698     392   00315 120325           delaya0k05s1: lcall  delay1ms
     699     393   00318 D5F0FA                         djnz   b,delaya0k05s1
     700     394   0031B D5E0F4                         djnz   acc,delaya0k05s2
     701     395   0031E D0F0                           pop    b                    ;registers herstellen
     702     396   00320 D0D0                           pop    psw
     703     397   00322 D0E0                           pop    acc
     704     398   00324 22                             ret
     705     399   00325                  
     706     400   00325                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     707     401   00325                  ;
     708     402   00325                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     709     403   00325                  ;
     710     404   00325                  ; Gebruikt geen registers
     711     405   00325                  ;
     712     406   00325                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     713     407   00325                  
     714     408   00325 C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     715     409   00327 C0D0                           push   psw                  ;8*42ns=330ns
     716     410   00329 75E064                         mov    acc,#100             ;420ns
     717     411   0032C 1202FD           delay1ms1:    lcall  delay10us            ;10us
     718     412   0032F D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     719     413   00332 D0D0                           pop    psw                  ;8*42ns=330ns
     720     414   00334 D0E0                           pop    acc                  ;8*42ns=330ns
     721     415   00336 22                             ret                         ;165ns
     722     416   00337                  
     723     417   00337                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     724     418   00337                  ;
     725     419   00337                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     726     420   00337                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     727     421   00337                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     728     422   00337                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     729     423   00337                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     730     424   00337                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     731     425   00337                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     732     426   00337                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     733     427   00337                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     734     428   00337                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     735     429   00337                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     736     430   00337                  ; systemen!!!!
     737     431   00337                  ;
     738     432   00337                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     739     433   00337                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     740     434   00337                  ;       aduclcd0.inc
     741     435   00337                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     742     436   00337                  ;       aduclcd1.inc
     743     437   00337                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     744     438   00337                  ;
     745     439   00337                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     746     440   00337                  
     747     441   00337                  e             bit    b.1                  ;enable
     748     442   00337                  rs            bit    b.0                  ;register select
     749     443   00337                  backlight     bit    b.6                  ;bit waar backlight op zit
     750     444   00337                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     751     445   00337                  
     752     446   00337                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     753     447   00337                  
     754     448   00337                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     755     449   00337                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     756     450   00337                  
     757     451   00337                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     758     452   00337                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     759     453   00337                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     760     454   00337                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     761     455   00337                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     762     456   00337                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     763     457   00337                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     764     458   00337                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     765     459   00337                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     766     460   00337                  
     767     461   00337                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     768     462   00337                  ;
     769     463   00337                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     770     464   00337                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     771     465   00337                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     772     466   00337                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     773     467   00337                  ;
     774     468   00337                  ; registergebruik: geen
     775     469   00337                  ;
     776     470   00337                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     777     471   00337                  
     778     472   00337 C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     779     473   00339 C0D0                           push   psw
     780     474   0033B C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     781     475   0033D 1201D9                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     782     476   00340 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     783     477   00343                                                            ;buzzer en baklight worden nu op 1 gezet
     784     478   00343 1204DB                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     785     479   00346 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     786     480   00348 1204D4           initlcd1:     lcall  delay2ms
     787     481   0034B D5E0FA                         djnz   acc,initlcd1
     788     482   0034E 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     789     483   00350 120493                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     790     484   00353 1204D4                         lcall  delay2ms      ;te krijgen.
     791     485   00356 7430                           mov    a,#00110000b
     792     486   00358 120493                         lcall  outhnibc
     793     487   0035B 1204D4                         lcall  delay2ms
     794     488   0035E 7430                           mov    a,#00110000b
     795     489   00360 120493                         lcall  outhnibc
     796     490   00363 1204D4                         lcall  delay2ms
     797     491   00366 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     798     492   00368 120493                         lcall  outhnibc      ;hoge nibble naar het controleregister
     799     493   0036B 1204D4                         lcall  delay2ms      ;niet nodig volgens datasheet
     800     494   0036E 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     801     495   00370 12047D                         lcall  outc          ;naar display
     802     496   00373 1204D4                         lcall  delay2ms      ;is iets te lang volgens datasheet
     803     497   00376 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     804     498   00378 12047D                         lcall  outc
     805     499   0037B 1204D4                         lcall  delay2ms      ;ook deze delay is iets te lang
     806     500   0037E 7401                           mov    a,#displayon  ;clear display and home cursor
     807     501   00380 12047D                         lcall  outc
     808     502   00383 1204D4                         lcall  delay2ms      ;deze wachttijd is bijna juist
     809     503   00386 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     810     504   00388 12047D                         lcall  outc
     811     505   0038B 1204D4                         lcall  delay2ms      ;wachten weer veel te lang
     812     506   0038E D0F0                           pop    b             ;registers terug in orde zetten
     813     507   00390 D0D0                           pop    psw
     814     508   00392 D0E0                           pop    acc
     815     509   00394 22                             ret                  ;einde van de initialisatie
     816     510   00395                  
     817     511   00395                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     818     512   00395                  ;
     819     513   00395                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     820     514   00395                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     821     515   00395                  ;      00dh   =cursor in de home positie
     822     516   00395                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     823     517   00395                  ;      00ah   =cursor op tweede lijn plaatsen
     824     518   00395                  ;      001h   =cursor on blink
     825     519   00395                  ;      002h   =cursor on, no blink
     826     520   00395                  ;      003h   =cursor off
     827     521   00395                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     828     522   00395                  ;
     829     523   00395                  ; de routine gebruikt geen registers
     830     524   00395                  ;
     831     525   00395                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     832     526   00395                  
     833     527   00395                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     834     528   00395                  ; dan mag de data direct naar het dataregister van het scherm.
     835     529   00395                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     836     530   00395                  
     837     531   00395                  lcdoutchar:
     838     532   00395 C0E0             outcharlcd:   push   acc           ;registers op stack
     839     533   00397 C0D0                           push   psw
     840     534   00399 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     841     535   0039C 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     842     536   0039E B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     843     537   003A1 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     844     538   003A3                  
     845     539   003A3                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     846     540   003A3                  ; Het is dus een opdracht die we moeten uitvoeren.
     847     541   003A3                  
     848     542   003A3 B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     849     543   003A6 7401                           mov    a,#cleardisp         ;scherm leegmaken
     850     544   003A8 12047D                         lcall  outc                 ;naar controleregister
     851     545   003AB 803A                           sjmp   outcharlcde          ;afsluiten
     852     546   003AD                  
     853     547   003AD B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     854     548   003B0 740F                           mov    a,#cursoronb         ;cursoron met blink
     855     549   003B2 12047D                         lcall  outc
     856     550   003B5 8030                           sjmp   outcharlcde
     857     551   003B7                  
     858     552   003B7 B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     859     553   003BA 740E                           mov    a,#cursoronn         ;cursoron no blink
     860     554   003BC 12047D                         lcall  outc
     861     555   003BF 8026                           sjmp   outcharlcde
     862     556   003C1                  
     863     557   003C1 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     864     558   003C4 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     865     559   003C6 12047D                         lcall  outc
     866     560   003C9 801C                           sjmp   outcharlcde
     867     561   003CB                  
     868     562   003CB B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     869     563   003CE 7402                           mov    a,#cursathom         ;cursor in home positie
     870     564   003D0 12047D                         lcall  outc
     871     565   003D3 8012                           sjmp   outcharlcde
     872     566   003D5                  
     873     567   003D5 B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     874     568   003D8                                                            ;tweede lijn
     875     569   003D8 74C0                           mov    a,#0c0h
     876     570   003DA 12047D                         lcall  outc
     877     571   003DD 8008                           sjmp   outcharlcde
     878     572   003DF                  
     879     573   003DF                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     880     574   003DF                  ; is. dit mag naar het data register.
     881     575   003DF                  
     882     576   003DF 120443           outcharlcd8:  lcall  outd          ;klaar
     883     577   003E2 8003                           sjmp   outcharlcde   ;einde routine
     884     578   003E4                  
     885     579   003E4                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     886     580   003E4                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     887     581   003E4                  ; te schrijven.
     888     582   003E4                  
     889     583   003E4 12047D           outcharlcd9:  lcall  outc          ;klaar
     890     584   003E7 D0D0             outcharlcde:  pop    psw           ;registers herstellen
     891     585   003E9 D0E0                           pop    acc
     892     586   003EB 22                             ret
     893     587   003EC                  
     894     588   003EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     895     589   003EC                  ;
     896     590   003EC                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     897     591   003EC                  ; op het lcd scherm.
     898     592   003EC                  ;
     899     593   003EC                  ; de routine gebruikt geen registers
     900     594   003EC                  ;
     901     595   003EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     902     596   003EC                  
     903     597   003EC                  lcdoutnib:
     904     598   003EC C0E0             outniblcd:    push   acc           ;registers op stack zetten
     905     599   003EE C0D0                           push   psw
     906     600   003F0 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     907     601   003F2 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     908     602   003F4 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     909     603   003F7 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     910     604   003F9 2407                           add    a,#007h       ;omvormen naar hoofdletter
     911     605   003FB 120443           outniblcde:   lcall  outd          ;naar het scherm
     912     606   003FE D0D0                           pop    psw
     913     607   00400 D0E0                           pop    acc
     914     608   00402 22                             ret
     915     609   00403                  
     916     610   00403                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     917     611   00403                  ;
     918     612   00403                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     919     613   00403                  ;
     920     614   00403                  ; de routine gebruikt geen registers
     921     615   00403                  ;
     922     616   00403                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     923     617   00403                  
     924     618   00403                  lcdoutbyte:
     925     619   00403 C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     926     620   00405 C0D0                           push   psw
     927     621   00407 C4                             swap   a             ;bitjes omruilen
     928     622   00408 1203EC                         lcall  outniblcd
     929     623   0040B C4                             swap   a             ;nog eens
     930     624   0040C 1203EC                         lcall  outniblcd
     931     625   0040F D0D0                           pop    psw
     932     626   00411 D0E0                           pop    acc
     933     627   00413 22                             ret
     934     628   00414                  
     935     629   00414                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     936     630   00414                  ;
     937     631   00414                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     938     632   00414                  ;
     939     633   00414                  ; de routine gebruikt geen registers
     940     634   00414                  ;
     941     635   00414                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     942     636   00414                  
     943     637   00414                  lcddispdptr:
     944     638   00414 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     945     639   00416 C0D0                           push   psw
     946     640   00418 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     947     641   0041A 120403                         lcall  outbytelcd
     948     642   0041D E582                           mov    a,dpl         ;dan het lage deel
     949     643   0041F 120403                         lcall  outbytelcd
     950     644   00422 D0D0                           pop    psw
     951     645   00424 D0E0                           pop    acc
     952     646   00426 22                             ret
     953     647   00427                  
     954     648   00427                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     955     649   00427                  ;
     956     650   00427                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     957     651   00427                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     958     652   00427                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     959     653   00427                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     960     654   00427                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     961     655   00427                  ;
     962     656   00427                  ; de routine gebruikt geen registers
     963     657   00427                  ;
     964     658   00427                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     965     659   00427                  
     966     660   00427                  lcdoutmsga:
     967     661   00427 C0E0             outmsgalcd:   push   acc           ;registers op de stack
     968     662   00429 C0D0                           push   psw
     969     663   0042B C083                           push   dph           ;ook de data pointer
     970     664   0042D C082                           push   dpl
     971     665   0042F                  
     972     666   0042F                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     973     667   0042F                  
     974     668   0042F E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     975     669   00430 93                             movc   a,@a+dptr     ;waarde lezen
     976     670   00431 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     977     671   00433                  
     978     672   00433                  ; de code is niet 0 dus versturen met outchar
     979     673   00433                  
     980     674   00433 120395                         lcall  outcharlcd    ;weg er mee
     981     675   00436 A3                             inc    dptr          ;naar volgende ascii code wijzen
     982     676   00437 02042F                         ljmp   outmsgalcd1   ;lus sluiten
     983     677   0043A                  
     984     678   0043A D082             outmsgalcde:  pop    dpl           ;registers herstellen
     985     679   0043C D083                           pop    dph
     986     680   0043E D0D0                           pop    psw
     987     681   00440 D0E0                           pop    acc
     988     682   00442 22                             ret
     989     683   00443                  
     990     684   00443                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     991     685   00443                  ;
     992     686   00443                  ; outd is een routine die naar het data register van het display een
     993     687   00443                  ; volledige byte stuurt.
     994     688   00443                  ;
     995     689   00443                  ; De routine gebruikt geen registers.
     996     690   00443                  ;
     997     691   00443                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     998     692   00443                  
     999     693   00443 C0E0             outd:         push   acc           ;registers op stack zetten
    1000     694   00445 C0D0                           push   psw
    1001     695   00447 120453                         lcall  outhnibd      ;hoogste vier bits verzenden
    1002     696   0044A C4                             swap   a             ;bitjes omruilen
    1003     697   0044B 120453                         lcall  outhnibd      ;naar het scherm sturen
    1004     698   0044E D0D0                           pop    psw           ;registers terug herstellen
    1005     699   00450 D0E0                           pop    acc
    1006     700   00452 22                             ret
    1007     701   00453                  
    1008     702   00453                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1009     703   00453                  ;
    1010     704   00453                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
    1011     705   00453                  ; lcd scherm.
    1012     706   00453                  ;
    1013     707   00453                  ; de routine gebruikt geen registers.
    1014     708   00453                  ;
    1015     709   00453                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1016     710   00453                  
    1017     711   00453 C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
    1018     712   00455 C0D0                           push   psw
    1019     713   00457 C0F0                           push   b             ;werkregister
    1020     714   00459 1204F4                         lcall  lcdtoport     ;lees de expander naar b register
    1021     715   0045C D2F0                           setb   rs            ;controle lijn in orde
    1022     716   0045E C2F1                           clr    e             ;deselectie display
    1023     717   00460 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1024     718   00462 03                             rr     a             ;bits op juiste plaats zetten
    1025     719   00463 03                             rr     a             ;voor b reg
    1026     720   00464 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1027     721   00467 42F0                           orl    b,a           ;bij elkaar voegen
    1028     722   00469 1204DB                         lcall  porttolcd     ;naar expnder
    1029     723   0046C D2F1                           setb   e             ;display enabelen
    1030     724   0046E 1204DB                         lcall  porttolcd
    1031     725   00471 C2F1                           clr    e             ;display deselecteren
    1032     726   00473 1204DB                         lcall  porttolcd
    1033     727   00476 D0F0                           pop    b
    1034     728   00478 D0D0                           pop    psw           ;registers herstellen
    1035     729   0047A D0E0                           pop    acc
    1036     730   0047C 22                             ret
    1037     731   0047D                  
    1038     732   0047D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1039     733   0047D                  ;
    1040     734   0047D                  ; outc is een routine die naar het controleregister van het display een
    1041     735   0047D                  ; volledige byte stuurt.
    1042     736   0047D                  ;
    1043     737   0047D                  ; De routine gebruikt geen registers.
    1044     738   0047D                  ;
    1045     739   0047D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1046     740   0047D                  
    1047     741   0047D C0E0             outc:         push   acc           ;registers op stack zetten
    1048     742   0047F C0D0                           push   psw
    1049     743   00481 120493                         lcall  outhnibc      ;hoogste vier bits verzenden
    1050     744   00484 1204D4                         lcall  delay2ms      ;niet echt nodig
    1051     745   00487 C4                             swap   a             ;bitjes omruilen
    1052     746   00488 120493                         lcall  outhnibc      ;naar het scherm sturen
    1053     747   0048B 1204D4                         lcall  delay2ms      ;altijd goed voor traagste commando
    1054     748   0048E D0D0                           pop    psw           ;registers terug herstellen
    1055     749   00490 D0E0                           pop    acc
    1056     750   00492 22                             ret
    1057     751   00493                  
    1058     752   00493                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1059     753   00493                  ;
    1060     754   00493                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1061     755   00493                  ; lcd scherm.
    1062     756   00493                  ;
    1063     757   00493                  ; de routine gebruikt geen registers.
    1064     758   00493                  ;
    1065     759   00493                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1066     760   00493                  
    1067     761   00493 C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1068     762   00495 C0D0                           push   psw
    1069     763   00497 C0F0                           push   b             ;werkregister
    1070     764   00499 1204F4                         lcall  lcdtoport     ;lees de expander naar b register
    1071     765   0049C C2F0                           clr    rs            ;controle lijn in orde
    1072     766   0049E C2F1                           clr    e             ;deselectie display
    1073     767   004A0 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1074     768   004A2 03                             rr     a             ;bits op juiste plaats zetten
    1075     769   004A3 03                             rr     a             ;voor b reg
    1076     770   004A4 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1077     771   004A7 42F0                           orl    b,a           ;bij elkaar voegen
    1078     772   004A9 1204DB                         lcall  porttolcd     ;naar expnder
    1079     773   004AC D2F1                           setb   e             ;display enabelen
    1080     774   004AE 1204DB                         lcall  porttolcd
    1081     775   004B1 C2F1                           clr    e             ;display deselecteren
    1082     776   004B3 1204DB                         lcall  porttolcd
    1083     777   004B6 D0F0                           pop    b
    1084     778   004B8 D0D0                           pop    psw           ;registers herstellen
    1085     779   004BA D0E0                           pop    acc
    1086     780   004BC 22                             ret
    1087     781   004BD                  
    1088     782   004BD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1089     783   004BD                  ;
    1090     784   004BD                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1091     785   004BD                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1092     786   004BD                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1093     787   004BD                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1094     788   004BD                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1095     789   004BD                  ; DATA GESCHREVEN.
    1096     790   004BD                  ;
    1097     791   004BD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1098     792   004BD                  
    1099     793   004BD 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1100     794   004BF 12047D           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1101     795   004C2 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1102     796   004C4 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1103     797   004C5 120443                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1104     798   004C8 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1105     799   004CB A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1106     800   004CC 80F4                           SJMP   BUILD3
    1107     801   004CE 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1108     802   004D0 12047D                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1109     803   004D3 22                             RET                  ;EINDE VAN DE ROUTINE
    1110     804   004D4                  
    1111     805   004D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1112     806   004D4                  ;
    1113     807   004D4                  ; Delay2ms is een vertragingsroutine van 2ms.
    1114     808   004D4                  ;
    1115     809   004D4                  ; De routine gebruikt geen registers.
    1116     810   004D4                  ;
    1117     811   004D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1118     812   004D4                  
    1119     813   004D4 120325           delay2ms:     lcall  delay1ms
    1120     814   004D7 120325                         lcall  delay1ms
    1121     815   004DA 22                             ret
    1122     816   004DB                  
    1123     817   004DB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1124     818   004DB                  ;
    1125     819   004DB                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1126     820   004DB                  ; scherm stuurt via de port expander.
    1127     821   004DB                  ;
    1128     822   004DB                  ; Gebruikt geen registers
    1129     823   004DB                  ;
    1130     824   004DB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1131     825   004DB                  
    1132     826   004DB C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1133     827   004DD C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1134     828   004DF 1201FC                         lcall  iicstart      ;vertrokken
    1135     829   004E2 7440                           mov    a,#01000000b  ;schrijven naar expander
    1136     830   004E4 120243                         lcall  iicoutbyte    ;weg er mee
    1137     831   004E7 E5F0                           mov    a,b           ;data verzenden
    1138     832   004E9 120243                         lcall  iicoutbyte
    1139     833   004EC 12021F                         lcall  iicstop       ;transactie sluiten
    1140     834   004EF D0D0                           pop    psw
    1141     835   004F1 D0E0                           pop    acc
    1142     836   004F3 22                             ret
    1143     837   004F4                  
    1144     838   004F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1145     839   004F4                  ;
    1146     840   004F4                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1147     841   004F4                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1148     842   004F4                  ; van buzzet en backlight is.
    1149     843   004F4                  ;
    1150     844   004F4                  ; Gebruikt b register
    1151     845   004F4                  ;
    1152     846   004F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1153     847   004F4                  
    1154     848   004F4 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1155     849   004F6 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1156     850   004F8 1201FC                         lcall  iicstart      ;vertrokken
    1157     851   004FB 7441                           mov    a,#01000001b  ;lezen van expander
    1158     852   004FD 120243                         lcall  iicoutbyte    ;weg er mee
    1159     853   00500 1202BE                         lcall  iicinbytenack ;data inlezen
    1160     854   00503 12021F                         lcall  iicstop
    1161     855   00506 F5F0                           mov    b,a
    1162     856   00508 D0D0                           pop    psw
    1163     857   0050A D0E0                           pop    acc
    1164     858   0050C 22                             ret
    1165     859   0050D                  
    1166     860   0050D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1167     861   0050D                  ;
    1168     862   0050D                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1169     863   0050D                  ;
    1170     864   0050D                  ; Gebruikt geen registers
    1171     865   0050D                  ;
    1172     866   0050D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1173     867   0050D                  
    1174     868   0050D C0F0             lcdlighton:   push   b
    1175     869   0050F 1204F4                         lcall  lcdtoport     ;expander lezen
    1176     870   00512 C2F6                           clr    b.6           ;licht aan doen
    1177     871   00514 1204DB                         lcall  porttolcd     ;expander scrijven
    1178     872   00517 D0F0                           pop    b
    1179     873   00519 22                             ret
    1180     874   0051A                  
    1181     875   0051A                  
    1182     876   0051A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1183     877   0051A                  ;
    1184     878   0051A                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1185     879   0051A                  ;
    1186     880   0051A                  ; Gebruikt geen registers
    1187     881   0051A                  ;
    1188     882   0051A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1189     883   0051A                  
    1190     884   0051A C0F0             lcdlightoff:  push   b
    1191     885   0051C 1204F4                         lcall  lcdtoport     ;expander lezen
    1192     886   0051F D2F6                           setb   b.6           ;licht uit doen
    1193     887   00521 1204DB                         lcall  porttolcd     ;expander scrijven
    1194     888   00524 D0F0                           pop    b
    1195     889   00526 22                             ret
    1196     890   00527                  
    1197     891   00527                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1198     892   00527                  ;
    1199     893   00527                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1200     894   00527                  ;
    1201     895   00527                  ; Gebruikt geen registers
    1202     896   00527                  ;
    1203     897   00527                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1204     898   00527                  
    1205     899   00527 C0F0             lcdbuzon:     push   b
    1206     900   00529 1204F4                         lcall  lcdtoport     ;expander lezen
    1207     901   0052C C2F7                           clr    b.7           ;buzzer aan doen
    1208     902   0052E 1204DB                         lcall  porttolcd     ;expander scrijven
    1209     903   00531 D0F0                           pop    b
    1210     904   00533 22                             ret
    1211     905   00534                  
    1212     906   00534                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1213     907   00534                  ;
    1214     908   00534                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1215     909   00534                  ;
    1216     910   00534                  ; Gebruikt geen registers
    1217     911   00534                  ;
    1218     912   00534                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1219     913   00534                  
    1220     914   00534 C0F0             lcdbuzoff:    push   b
    1221     915   00536 1204F4                         lcall  lcdtoport     ;expander lezen
    1222     916   00539 D2F7                           setb   b.7           ;buzzer aan doen
    1223     917   0053B 1204DB                         lcall  porttolcd     ;expander scrijven
    1224     918   0053E D0F0                           pop    b
    1225     919   00540 22                             ret
    1226     920   00541                  
    1227     921   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1228     922   00541                  ;
    1229     923   00541                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1230     924   00541                  ; een standaard com poort op 9600 baud.
    1231     925   00541                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1232     926   00541                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1233     927   00541                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1234     928   00541                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1235     929   00541                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1236     930   00541                  ; NIET door deze routine.
    1237     931   00541                  ;
    1238     932   00541                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1239     933   00541                  ;
    1240     934   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1241     935   00541                  
    1242     936   00541                  blank         equ    020h          ;ascii code voor een blank
    1243     937   00541                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1244     938   00541                  ff            equ    00ch          ;ascii code voor nieuw blad
    1245     939   00541                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1246     940   00541                  lf            equ    00ah          ;ascii code voor volgende lijn
    1247     941   00541                  backsp        equ    008h          ;ascii code voor het bs karakter
    1248     942   00541                  beep          equ    007h          ;ascii code voor een beep
    1249     943   00541                  
    1250     944   00541 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1251     945   00545                                                                          ;van het scherm
    1252     946   00545                  
    1253     947   00545                  strtbuf       equ     054h         ;start adres van de buffer
    1254     948   00545                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1255     949   00545                  
    1256     950   00545                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1257     951   00545                  ;
    1258     952   00545                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1259     953   00545                  ;
    1260     954   00545                  ; Gebruikt geen registers
    1261     955   00545                  ;
    1262     956   00545                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1263     957   00545                  
    1264     958   00545 C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1265     959   00547 C08F                           push   syscon0              ;map bewaren
    1266     960   00549 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1267     961   0054C C0B2                           push   port_page            ;pagina op stack zetten
    1268     962   0054E C0BF                           push   scu_page
    1269     963   00550 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1270     964   00553                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1271     965   00553                  ;      -p1.0 als input en alt1 selectie
    1272     966   00553                  ;      -p1.1 als output en alt2 selectie
    1273     967   00553                  
    1274     968   00553 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1275     969   00556 5390FD                         anl    p1_altsel0,#11111101b
    1276     970   00559 439001                         orl    p1_altsel0,#00000001b
    1277     971   0055C 5391FE                         anl    p1_altsel1,#11111110b
    1278     972   0055F 439102                         orl    p1_altsel1,#00000010b
    1279     973   00562 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1280     974   00565 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1281     975   00568 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1282     976   0056B                  
    1283     977   0056B                  ; Nu moet de baud rate generator ingesteld worden
    1284     978   0056B                  ; We gaan er van uit dat de systeemklok 24MHz is
    1285     979   0056B                  
    1286     980   0056B 759850                         mov    scon,#01010000b      ;UART initialiseren
    1287     981   0056E                  
    1288     982   0056E                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1289     983   0056E                  ; gebruikt!!
    1290     984   0056E                  
    1291     985   0056E 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1292     986   00571 75BD11                         mov    bcon,#00010001b
    1293     987   00574 D0BF                           pop    scu_page
    1294     988   00576 D0B2                           pop    port_page            ;alles terug herstellen
    1295     989   00578 D08F                           pop    syscon0
    1296     990   0057A D0E0                           pop    acc
    1297     991   0057C 22                             ret
    1298     992   0057D                  
    1299     993   0057D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1300     994   0057D                  ;
    1301     995   0057D                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1302     996   0057D                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1303     997   0057D                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1304     998   0057D                  ;
    1305     999   0057D                  ; de routine gebruikt geen registers.
    1306    1000   0057D                  ;
    1307    1001   0057D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1308    1002   0057D                  
    1309    1003   0057D                  siooutchar:
    1310    1004   0057D F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1311    1005   0057F 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1312    1006   00582 C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1313    1007   00584 22                             RET
    1314    1008   00585                  
    1315    1009   00585                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1316    1010   00585                  ;
    1317    1011   00585                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1318    1012   00585                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1319    1013   00585                  ;
    1320    1014   00585                  ; de routine gebruikt geen registers.
    1321    1015   00585                  ;
    1322    1016   00585                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1323    1017   00585                  
    1324    1018   00585                  siooutnib:
    1325    1019   00585 C0E0             OUTNIB:       push   acc           ;registers op de stack
    1326    1020   00587 C0D0                           push   psw
    1327    1021   00589 540F                           ANL    A,#00FH       ;AFZONDEREN
    1328    1022   0058B 120675                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1329    1023   0058E 12057D                         LCALL  OUTCHAR       ;VERSTUREN
    1330    1024   00591 1205DE                         LCALL  XONXOFF       ;FLOW CONTROL
    1331    1025   00594 D0D0                           pop    psw           ;registers herstellen
    1332    1026   00596 D0E0                           pop    acc
    1333    1027   00598 22                             RET
    1334    1028   00599                  
    1335    1029   00599                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1336    1030   00599                  ;
    1337    1031   00599                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1338    1032   00599                  ; WORDT XONXOFF GEBRUIKT.
    1339    1033   00599                  ;
    1340    1034   00599                  ; de routine gebruikt geen registers.
    1341    1035   00599                  ;
    1342    1036   00599                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1343    1037   00599                  
    1344    1038   00599                  siooutbyte:
    1345    1039   00599 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1346    1040   0059B C0D0                           push   psw
    1347    1041   0059D C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1348    1042   0059F C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1349    1043   005A0 120585                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1350    1044   005A3 D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1351    1045   005A5 120585                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1352    1046   005A8 D0D0                           pop    psw           ;registers herstellen
    1353    1047   005AA D0E0                           pop    acc
    1354    1048   005AC 22                             RET
    1355    1049   005AD                  
    1356    1050   005AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1357    1051   005AD                  ;
    1358    1052   005AD                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1359    1053   005AD                  ; VAN DE CURSOR.
    1360    1054   005AD                  ;
    1361    1055   005AD                  ; de routine gebruikt geen registers.
    1362    1056   005AD                  ;
    1363    1057   005AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1364    1058   005AD                  
    1365    1059   005AD                  siodispdptr:
    1366    1060   005AD C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1367    1061   005AF C0D0                           push   psw
    1368    1062   005B1 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1369    1063   005B3 120599                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1370    1064   005B6 E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1371    1065   005B8 120599                         LCALL  OUTBYTE       ;WEG ER MEE
    1372    1066   005BB D0D0                           pop    psw           ;registers herstellen
    1373    1067   005BD D0E0                           pop    acc
    1374    1068   005BF 22                             RET                  ;EINDE
    1375    1069   005C0                  
    1376    1070   005C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1377    1071   005C0                  ;
    1378    1072   005C0                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1379    1073   005C0                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1380    1074   005C0                  ;
    1381    1075   005C0                  ; de routine gebruikt geen registers.
    1382    1076   005C0                  ;
    1383    1077   005C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1384    1078   005C0                  
    1385    1079   005C0                  siooutmsga:
    1386    1080   005C0 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1387    1081   005C2 C0D0                           push   psw
    1388    1082   005C4 C082                           push   dpl
    1389    1083   005C6 C083                           push   dph
    1390    1084   005C8 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1391    1085   005C9 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1392    1086   005CA 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1393    1087   005CC 12057D                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1394    1088   005CF 1205DE                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1395    1089   005D2 A3                             INC    DPTR          ;DPTR AANPASSEN
    1396    1090   005D3 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1397    1091   005D5 D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1398    1092   005D7 D082                           pop    dpl
    1399    1093   005D9 D0D0                           pop    psw
    1400    1094   005DB D0E0                           pop    acc
    1401    1095   005DD 22                             RET                  ;EINDE ROUTINE
    1402    1096   005DE                  
    1403    1097   005DE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1404    1098   005DE                  ;
    1405    1099   005DE                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1406    1100   005DE                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1407    1101   005DE                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1408    1102   005DE                  ; VERDER DOORGEGEVEN.
    1409    1103   005DE                  ;
    1410    1104   005DE                  ; de routine gebruikt geen registers.
    1411    1105   005DE                  ;
    1412    1106   005DE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1413    1107   005DE                  
    1414    1108   005DE C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1415    1109   005E0 C0D0                           push   psw
    1416    1110   005E2 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1417    1111   005E5 D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1418    1112   005E7 D0E0                           pop    acc
    1419    1113   005E9 22                             RET                  ;ANDERS EINDE
    1420    1114   005EA E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1421    1115   005EC B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1422    1116   005EF 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1423    1117   005F2 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1424    1118   005F4                  
    1425    1119   005F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1426    1120   005F4                  ;
    1427    1121   005F4                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1428    1122   005F4                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1429    1123   005F4                  ;
    1430    1124   005F4                  ; de routine gebruikt de accu.
    1431    1125   005F4                  ;
    1432    1126   005F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1433    1127   005F4                  
    1434    1128   005F4                  sioinchar:
    1435    1129   005F4 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1436    1130   005F7 C298                           CLR    RI                   ;BIT LAAG MAKEN
    1437    1131   005F9 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1438    1132   005FB 22                             RET
    1439    1133   005FC                  
    1440    1134   005FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1441    1135   005FC                  ;
    1442    1136   005FC                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1443    1137   005FC                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1444    1138   005FC                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1445    1139   005FC                  ; DE CARRY OP 1 GEZET WORDEN.
    1446    1140   005FC                  ;
    1447    1141   005FC                  ; De routine gebruikt de accu, r0 en de psw.
    1448    1142   005FC                  ;
    1449    1143   005FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1450    1144   005FC                  
    1451    1145   005FC                  sioinbyte:
    1452    1146   005FC 1205F4           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1453    1147   005FF 120668                         LCALL  LOWUPTR
    1454    1148   00602 12067F                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1455    1149   00605 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1456    1150   00607 C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1457    1151   00608 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1458    1152   00609 1205F4                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1459    1153   0060C 120668                         LCALL  LOWUPTR
    1460    1154   0060F 12067F                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1461    1155   00612 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1462    1156   00614 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1463    1157   00615 22               INBYTE1:      RET
    1464    1158   00616                  
    1465    1159   00616                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1466    1160   00616                  ;
    1467    1161   00616                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1468    1162   00616                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1469    1163   00616                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1470    1164   00616                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1471    1165   00616                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1472    1166   00616                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1473    1167   00616                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1474    1168   00616                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1475    1169   00616                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1476    1170   00616                  ; bepalen.
    1477    1171   00616                  ;
    1478    1172   00616                  ; De routine gebruikt de accu, r0 en de psw.
    1479    1173   00616                  ;
    1480    1174   00616                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1481    1175   00616                  
    1482    1176   00616                  sioinbufa:
    1483    1177   00616 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1484    1178   00618 1205F4           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1485    1179   0061B 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1486    1180   0061D                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1487    1181   0061D                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1488    1182   0061D                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1489    1183   0061D                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1490    1184   0061D                  ; GEVOERD.
    1491    1185   0061D 120668                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1492    1186   00620 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1493    1187   00623 F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1494    1188   00624 22                             RET                         ;EINDE VAN DE ROUTINE
    1495    1189   00625 B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1496    1190   00628 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1497    1191   0062B 7407             INBUFA4:      MOV    A,#BEEP
    1498    1192   0062D 12057D           INBUFA7:      LCALL  OUTCHAR
    1499    1193   00630 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1500    1194   00632 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1501    1195   00633 900541                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1502    1196   00636 1205C0                         LCALL  OUTMSGA
    1503    1197   00639 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1504    1198   0063B 12065A           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1505    1199   0063E 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1506    1200   00640 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1507    1201   00643 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1508    1202   00645 F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1509    1203   00646 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1510    1204   00647 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1511    1205   00649                  
    1512    1206   00649                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1513    1207   00649                  ;
    1514    1208   00649                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1515    1209   00649                  ;
    1516    1210   00649                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1517    1211   00649                  ;
    1518    1212   00649                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1519    1213   00649                  
    1520    1214   00649 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1521    1215   0064B 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1522    1216   0064D E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1523    1217   0064E B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1524    1218   00651 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1525    1219   00652 B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1526    1220   00655 22                             RET                         ;EINDE VAN DE ROUTINE
    1527    1221   00656 F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1528    1222   00657 09                             INC    R1
    1529    1223   00658 80F7                           SJMP   BDELETE3
    1530    1224   0065A                  
    1531    1225   0065A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1532    1226   0065A                  ;
    1533    1227   0065A                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1534    1228   0065A                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1535    1229   0065A                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1536    1230   0065A                  ; AANZIEN.
    1537    1231   0065A                  ;
    1538    1232   0065A                  ; De routine gebruikt de accu en de psw.
    1539    1233   0065A                  ;
    1540    1234   0065A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1541    1235   0065A                  
    1542    1236   0065A B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1543    1237   0065D 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1544    1238   0065F B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1545    1239   00662 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1546    1240   00664 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1547    1241   00665 22                             RET
    1548    1242   00666 D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1549    1243   00667 22                             RET
    1550    1244   00668                  
    1551    1245   00668                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1552    1246   00668                  ;
    1553    1247   00668                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1554    1248   00668                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1555    1249   00668                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1556    1250   00668                  ; AANGEPAST WORDEN.
    1557    1251   00668                  ;
    1558    1252   00668                  ; De routine gebruikt de accu en de psw.
    1559    1253   00668                  ;
    1560    1254   00668                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1561    1255   00668                  
    1562    1256   00668 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1563    1257   0066B 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1564    1258   0066D B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1565    1259   00670 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1566    1260   00672 9420                           SUBB   A,#020H              ;OMZETTING
    1567    1261   00674 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1568    1262   00675                  
    1569    1263   00675                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1570    1264   00675                  ;
    1571    1265   00675                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1572    1266   00675                  ; ASCII CODE.
    1573    1267   00675                  ;
    1574    1268   00675                  ; De routine gebruikt de accu en de psw.
    1575    1269   00675                  ;
    1576    1270   00675                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1577    1271   00675                  
    1578    1272   00675 B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1579    1273   00678 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1580    1274   0067A 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1581    1275   0067C 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1582    1276   0067E 22                             RET
    1583    1277   0067F                  
    1584    1278   0067F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1585    1279   0067F                  ;
    1586    1280   0067F                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1587    1281   0067F                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1588    1282   0067F                  ; GEVAL WORDT DE CARRY GEZET.
    1589    1283   0067F                  ;
    1590    1284   0067F                  ; De routine gebruikt de accu en de psw.
    1591    1285   0067F                  ;
    1592    1286   0067F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1593    1287   0067F                  
    1594    1288   0067F C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1595    1289   00680 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1596    1290   00682 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1597    1291   00684 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1598    1292   00687 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1599    1293   00689 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1600    1294   0068B 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1601    1295   0068D B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1602    1296   00690 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1603    1297   00691 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1604    1298   00693 C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1605    1299   00694 22               ASCBINTRANS1: RET
    1606    1300   00695                  
    1607    1301   00695                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1608    1302   00695                  ;
    1609    1303   00695                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1610    1304   00695                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1611    1305   00695                  ;
    1612    1306   00695                  ; De routine gebruikt de accu en de psw.
    1613    1307   00695                  ;
    1614    1308   00695                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1615    1309   00695                  
    1616    1310   00695 E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1617    1311   00696 12067F                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1618    1312   00699 22                             RET                         ;EINDE OMZETTING
    1619    1313   0069A                  
    1620    1314   0069A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1621    1315   0069A                  ;
    1622    1316   0069A                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1623    1317   0069A                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1624    1318   0069A                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1625    1319   0069A                  ;
    1626    1320   0069A                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1627    1321   0069A                  ;
    1628    1322   0069A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1629    1323   0069A                  
    1630    1324   0069A 120695           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1631    1325   0069D 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1632    1326   0069F C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1633    1327   006A0 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1634    1328   006A1 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1635    1329   006A2 120695                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1636    1330   006A5 4001                           JC     ASCII21               ;WEG ALS C=1
    1637    1331   006A7 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1638    1332   006A8 22               ASCII21:      RET
    1639    1333   006A9                  
    1640    1334   006A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1641    1335   006A9                  ;
    1642    1336   006A9                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1643    1337   006A9                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1644    1338   006A9                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1645    1339   006A9                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1646    1340   006A9                  ;
    1647    1341   006A9                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1648    1342   006A9                  ;
    1649    1343   006A9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1650    1344   006A9                  
    1651    1345   006A9 12069A           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1652    1346   006AC 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1653    1347   006AE F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1654    1348   006B0 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1655    1349   006B1 12069A                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1656    1350   006B4 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1657    1351   006B6 F582                           MOV    DPL,A                ;IN DPTR LADEN
    1658    1352   006B8 22               ASCII41:      RET
    1659    1353   006B9                  
    1660    1354   006B9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1661    1355   006B9                  ;
    1662    1356   006B9                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1663    1357   006B9                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1664    1358   006B9                  ; geschakeld worden.
    1665    1359   006B9                  ;
    1666    1360   006B9                  ; Gebruikt geen registers
    1667    1361   006B9                  ;
    1668    1362   006B9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1669    1363   006B9                  
    1670    1364   006B9 C08F             initadc:      push   syscon0                     ;map saven
    1671    1365   006BB 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1672    1366   006BE 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1673    1367   006C1 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1674    1368   006C4                                                                   ;klok delen door 32 (750kHz)
    1675    1369   006C4                                                                   ;10 bit uitkomst
    1676    1370   006C4 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1677    1371   006C7                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1678    1372   006C7 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1679    1373   006CA 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1680    1374   006CD 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1681    1375   006D0 D08F                           pop    syscon0                     ;herstellen syscon
    1682    1376   006D2 22                             ret
    1683    1377   006D3                  
    1684    1378   006D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1685    1379   006D3                  ;
    1686    1380   006D3                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1687    1381   006D3                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1688    1382   006D3                  ;
    1689    1383   006D3                  ; Gebruikt:
    1690    1384   006D3                  ;      -accu als 8 msb meting
    1691    1385   006D3                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1692    1386   006D3                  ;
    1693    1387   006D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1694    1388   006D3                  
    1695    1389   006D3 C08F             adclm335:     push   syscon0
    1696    1390   006D5 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1697    1391   006D8 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1698    1392   006DB 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1699    1393   006DE 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1700    1394   006E1 00               		nop
    1701    1395   006E2 00               		nop					;anders loopt het mis met het testen van de ready bit
    1702    1396   006E3 E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1703    1397   006E5 20E0FB                         jb     acc.0,adclm3351
    1704    1398   006E8 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1705    1399   006EB E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1706    1400   006ED 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1707    1401   006F0 D08F                           pop    syscon0
    1708    1402   006F2 22                             ret
    1709    1403   006F3                  
    1710    1404   006F3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1711    1405   006F3                  ;
    1712    1406   006F3                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1713    1407   006F3                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1714    1408   006F3                  ;
    1715    1409   006F3                  ; Gebruikt:
    1716    1410   006F3                  ;      -accu als 8 msb meting
    1717    1411   006F3                  ;      -b als 2 lsb meting (links afgelijnd)
    1718    1412   006F3                  ;
    1719    1413   006F3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1720    1414   006F3                  
    1721    1415   006F3 C08F             adcpotmeter:  push   syscon0
    1722    1416   006F5 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1723    1417   006F8 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1724    1418   006FB 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1725    1419   006FE 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1726    1420   00701 00               		nop
    1727    1421   00702 00               		nop					;anders loopt het mis met het testen van de ready bit
    1728    1422   00703 E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1729    1423   00705 20E0FB                         jb     acc.0,adcpotmeter1
    1730    1424   00708 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1731    1425   0070B E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1732    1426   0070D 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1733    1427   00710 D08F                           pop    syscon0
    1734    1428   00712                  
    1735    1429   00712                  
    1736    1430   00712 22                             ret
    1737    1431   00713                  
    1738    1432   00713                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1739    1433   00713                  ;
    1740    1434   00713                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1741    1435   00713                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1742    1436   00713                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1743    1437   00713                  ; doelstellingen in het achterhoofd.
    1744    1438   00713                  ;
    1745    1439   00713                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1746    1440   00713                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1747    1441   00713                  ; bcd)
    1748    1442   00713                  ;      8bit hex naar bcd
    1749    1443   00713                  ;      8bit bcd naar hex
    1750    1444   00713                  ;
    1751    1445   00713                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1752    1446   00713                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1753    1447   00713                  ;      16*16 bit met 32 bit uitkomst
    1754    1448   00713                  ;      16+16 bit met 24 bit uitkomst
    1755    1449   00713                  ;      16-16 bit met 24 bit uitkomst
    1756    1450   00713                  ;      16bit hex naar bcd
    1757    1451   00713                  ;      16bit bcd naar hex
    1758    1452   00713                  ;
    1759    1453   00713                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1760    1454   00713                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1761    1455   00713                  ;      32*32 bit met 64 bit uitkomst
    1762    1456   00713                  ;      32+32 bit met 40 bit uitkomst
    1763    1457   00713                  ;      32-32 bit met 40 bit uitkomst
    1764    1458   00713                  ;
    1765    1459   00713                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1766    1460   00713                  ;
    1767    1461   00713                  ; De routines gebruiken als input en output de huidige registerbank.
    1768    1462   00713                  ;
    1769    1463   00713                  ;
    1770    1464   00713                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1771    1465   00713                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1772    1466   00713                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1773    1467   00713                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1774    1468   00713                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1775    1469   00713                  ;
    1776    1470   00713                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1777    1471   00713                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1778    1472   00713                  ;      -routines gebruiken geen MDU!
    1779    1473   00713                  ;
    1780    1474   00713                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1781    1475   00713                  
    1782    1476   00713                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1783    1477   00713                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1784    1478   00713                  
    1785    1479   00713                  h0            equ    070h
    1786    1480   00713                  h1            equ    071h
    1787    1481   00713                  h2            equ    072h
    1788    1482   00713                  h3            equ    073h
    1789    1483   00713                  h4            equ    074h
    1790    1484   00713                  h5            equ    075h
    1791    1485   00713                  h6            equ    076h
    1792    1486   00713                  h7            equ    077h
    1793    1487   00713                  h8            equ    078h
    1794    1488   00713                  h9            equ    079h
    1795    1489   00713                  h10           equ    07ah
    1796    1490   00713                  h11           equ    07bh
    1797    1491   00713                  h12           equ    07ch
    1798    1492   00713                  
    1799    1493   00713                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1800    1494   00713                  ;
    1801    1495   00713                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1802    1496   00713                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1803    1497   00713                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1804    1498   00713                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1805    1499   00713                  ;
    1806    1500   00713                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1807    1501   00713                  ;
    1808    1502   00713                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1809    1503   00713                  
    1810    1504   00713 C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1811    1505   00715 C0D0                           push   psw
    1812    1506   00717 C070                           push   h0
    1813    1507   00719 C071                           push   h1
    1814    1508   0071B C072                           push   h2
    1815    1509   0071D C073                           push   h3
    1816    1510   0071F C074                           push   h4
    1817    1511   00721 C075                           push   h5
    1818    1512   00723 C076                           push   h6
    1819    1513   00725 C077                           push   h7
    1820    1514   00727 C078                           push   h8
    1821    1515   00729 C079                           push   h9
    1822    1516   0072B C07A                           push   h10
    1823    1517   0072D C07B                           push   h11
    1824    1518   0072F C07C                           push   h12
    1825    1519   00731                  
    1826    1520   00731                  ; eerst moeten de hulpregisters klaar gezet worden
    1827    1521   00731                  
    1828    1522   00731 757000                         mov    h0,#000h
    1829    1523   00734 757100                         mov    h1,#000h
    1830    1524   00737 757200                         mov    h2,#000h
    1831    1525   0073A 757300                         mov    h3,#000h
    1832    1526   0073D 757400                         mov    h4,#000h
    1833    1527   00740 757500                         mov    h5,#000h
    1834    1528   00743 757600                         mov    h6,#000h
    1835    1529   00746 757700                         mov    h7,#000h
    1836    1530   00749 757800                         mov    h8,#000h
    1837    1531   0074C 757900                         mov    h9,#000h
    1838    1532   0074F 757A00                         mov    h10,#000h
    1839    1533   00752 757B00                         mov    h11,#000h
    1840    1534   00755 757C20                         mov    h12,#32              ;loopcounter
    1841    1535   00758                  
    1842    1536   00758                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1843    1537   00758                  
    1844    1538   00758                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1845    1539   00758                  
    1846    1540   00758 EB               mul321:       mov    a,r3
    1847    1541   00759 13                             rrc    a
    1848    1542   0075A FB                             mov    r3,a
    1849    1543   0075B EA                             mov    a,r2
    1850    1544   0075C 13                             rrc    a
    1851    1545   0075D FA                             mov    r2,a
    1852    1546   0075E E9                             mov    a,r1
    1853    1547   0075F 13                             rrc    a
    1854    1548   00760 F9                             mov    r1,a
    1855    1549   00761 E8                             mov    a,r0
    1856    1550   00762 13                             rrc    a
    1857    1551   00763 F8                             mov    r0,a                 ;32 bit shift klaar
    1858    1552   00764                  
    1859    1553   00764                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1860    1554   00764                  
    1861    1555   00764 502C                           jnc    mul322               ;optelling niet nodig
    1862    1556   00766                  
    1863    1557   00766                  ; hier staat en 64 bit optelling
    1864    1558   00766                  
    1865    1559   00766 EC                             mov    a,r4
    1866    1560   00767 2574                           add    a,h4
    1867    1561   00769 F574                           mov    h4,a
    1868    1562   0076B ED                             mov    a,r5
    1869    1563   0076C 3575                           addc   a,h5
    1870    1564   0076E F575                           mov    h5,a
    1871    1565   00770 EE                             mov    a,r6
    1872    1566   00771 3576                           addc   a,h6
    1873    1567   00773 F576                           mov    h6,a
    1874    1568   00775 EF                             mov    a,r7
    1875    1569   00776 3577                           addc   a,h7
    1876    1570   00778 F577                           mov    h7,a
    1877    1571   0077A E570                           mov    a,h0
    1878    1572   0077C 3578                           addc   a,h8
    1879    1573   0077E F578                           mov    h8,a
    1880    1574   00780 E571                           mov    a,h1
    1881    1575   00782 3579                           addc   a,h9
    1882    1576   00784 F579                           mov    h9,a
    1883    1577   00786 E572                           mov    a,h2
    1884    1578   00788 357A                           addc   a,h10
    1885    1579   0078A F57A                           mov    h10,a
    1886    1580   0078C E573                           mov    a,h3
    1887    1581   0078E 357B                           addc   a,h11
    1888    1582   00790 F57B                           mov    h11,a                ;optelling klaar
    1889    1583   00792                  
    1890    1584   00792                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1891    1585   00792                  
    1892    1586   00792 C3               mul322:       clr    c                    ;moet op 0 staan
    1893    1587   00793 EC                             mov    a,r4
    1894    1588   00794 33                             rlc    a
    1895    1589   00795 FC                             mov    r4,a
    1896    1590   00796 ED                             mov    a,r5
    1897    1591   00797 33                             rlc    a
    1898    1592   00798 FD                             mov    r5,a
    1899    1593   00799 EE                             mov    a,r6
    1900    1594   0079A 33                             rlc    a
    1901    1595   0079B FE                             mov    r6,a
    1902    1596   0079C EF                             mov    a,r7
    1903    1597   0079D 33                             rlc    a
    1904    1598   0079E FF                             mov    r7,a
    1905    1599   0079F E570                           mov    a,h0
    1906    1600   007A1 33                             rlc    a
    1907    1601   007A2 F570                           mov    h0,a
    1908    1602   007A4 E571                           mov    a,h1
    1909    1603   007A6 33                             rlc    a
    1910    1604   007A7 F571                           mov    h1,a
    1911    1605   007A9 E572                           mov    a,h2
    1912    1606   007AB 33                             rlc    a
    1913    1607   007AC F572                           mov    h2,a
    1914    1608   007AE E573                           mov    a,h3
    1915    1609   007B0 33                             rlc    a
    1916    1610   007B1 F573                           mov    h3,a
    1917    1611   007B3                  
    1918    1612   007B3 D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1919    1613   007B6                  
    1920    1614   007B6                  ; de uitkomst moet in de juiste registers komen
    1921    1615   007B6                  
    1922    1616   007B6 A874                           mov    r0,h4
    1923    1617   007B8 A975                           mov    r1,h5
    1924    1618   007BA AA76                           mov    r2,h6
    1925    1619   007BC AB77                           mov    r3,h7
    1926    1620   007BE AC78                           mov    r4,h8
    1927    1621   007C0 AD79                           mov    r5,h9
    1928    1622   007C2 AE7A                           mov    r6,h10
    1929    1623   007C4 AF7B                           mov    r7,h11               ;klaar
    1930    1624   007C6                  
    1931    1625   007C6 D07C                           pop    h12                  ;registers herstellen
    1932    1626   007C8 D07B                           pop    h11
    1933    1627   007CA D07A                           pop    h10
    1934    1628   007CC D079                           pop    h9
    1935    1629   007CE D078                           pop    h8
    1936    1630   007D0 D077                           pop    h7
    1937    1631   007D2 D076                           pop    h6
    1938    1632   007D4 D075                           pop    h5
    1939    1633   007D6 D074                           pop    h4
    1940    1634   007D8 D073                           pop    h3
    1941    1635   007DA D072                           pop    h2
    1942    1636   007DC D071                           pop    h1
    1943    1637   007DE D070                           pop    h0
    1944    1638   007E0 D0D0                           pop    psw
    1945    1639   007E2 D0E0                           pop    acc
    1946    1640   007E4 22                             ret
    1947    1641   007E5                  
    1948    1642   007E5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1949    1643   007E5                  ;
    1950    1644   007E5                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1951    1645   007E5                  ; input:      r1,r0 = eerste getal (r1=msb)
    1952    1646   007E5                  ;             r3,r2 = tweede getal (r3=msb)
    1953    1647   007E5                  ; output:     r3,r2,r1,r0 met r3=msb
    1954    1648   007E5                  ;
    1955    1649   007E5                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1956    1650   007E5                  ;
    1957    1651   007E5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1958    1652   007E5                  
    1959    1653   007E5 C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1960    1654   007E7 C0D0                           push   psw
    1961    1655   007E9 C070                           push   h0
    1962    1656   007EB C071                           push   h1
    1963    1657   007ED C072                           push   h2
    1964    1658   007EF C073                           push   h3
    1965    1659   007F1 C074                           push   h4
    1966    1660   007F3 C075                           push   h5
    1967    1661   007F5 C076                           push   h6
    1968    1662   007F7                  
    1969    1663   007F7                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1970    1664   007F7                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1971    1665   007F7                  ; h6 is de loopcounter.
    1972    1666   007F7                  
    1973    1667   007F7 757000                         mov    h0,#000h
    1974    1668   007FA 757100                         mov    h1,#000h
    1975    1669   007FD 757200                         mov    h2,#000h
    1976    1670   00800 757300                         mov    h3,#000h
    1977    1671   00803 757400                         mov    h4,#000h
    1978    1672   00806 757500                         mov    h5,#000h
    1979    1673   00809 757610                         mov    h6,#16               ;loopcounter
    1980    1674   0080C                  
    1981    1675   0080C                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1982    1676   0080C                  ; berekening
    1983    1677   0080C                  
    1984    1678   0080C E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1985    1679   0080D 13                             rrc    a
    1986    1680   0080E F9                             mov    r1,a
    1987    1681   0080F E8                             mov    a,r0
    1988    1682   00810 13                             rrc    a
    1989    1683   00811 F8                             mov    r0,a                 ;ok
    1990    1684   00812                  
    1991    1685   00812                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1992    1686   00812                  
    1993    1687   00812 5016                           jnc    mul162
    1994    1688   00814                  
    1995    1689   00814 EA                             mov    a,r2
    1996    1690   00815 2572                           add    a,h2
    1997    1691   00817 F572                           mov    h2,a                 ;32 bit som uitvoeren
    1998    1692   00819 EB                             mov    a,r3
    1999    1693   0081A 3573                           addc   a,h3
    2000    1694   0081C F573                           mov    h3,a
    2001    1695   0081E E570                           mov    a,h0
    2002    1696   00820 3574                           addc   a,h4
    2003    1697   00822 F574                           mov    h4,a
    2004    1698   00824 E571                           mov    a,h1
    2005    1699   00826 3575                           addc   a,h5
    2006    1700   00828 F575                           mov    h5,a                 ;klaar
    2007    1701   0082A                  
    2008    1702   0082A                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    2009    1703   0082A                  
    2010    1704   0082A C3               mul162:       clr    c
    2011    1705   0082B EA                             mov    a,r2
    2012    1706   0082C 33                             rlc    a
    2013    1707   0082D FA                             mov    r2,a                 ;ook 32 bit getal
    2014    1708   0082E EB                             mov    a,r3
    2015    1709   0082F 33                             rlc    a
    2016    1710   00830 FB                             mov    r3,a
    2017    1711   00831 E570                           mov    a,h0
    2018    1712   00833 33                             rlc    a
    2019    1713   00834 F570                           mov    h0,a
    2020    1714   00836 E571                           mov    a,h1
    2021    1715   00838 33                             rlc    a
    2022    1716   00839 F571                           mov    h1,a                 ;klaar
    2023    1717   0083B                  
    2024    1718   0083B D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    2025    1719   0083E                  
    2026    1720   0083E                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    2027    1721   0083E                  
    2028    1722   0083E A872                           mov    r0,h2
    2029    1723   00840 A973                           mov    r1,h3
    2030    1724   00842 AA74                           mov    r2,h4
    2031    1725   00844 AB75                           mov    r3,h5                ;klaar
    2032    1726   00846                  
    2033    1727   00846                  
    2034    1728   00846 D076                           pop    h6                   ;registers herstellen
    2035    1729   00848 D075                           pop    h5
    2036    1730   0084A D074                           pop    h4
    2037    1731   0084C D073                           pop    h3
    2038    1732   0084E D072                           pop    h2
    2039    1733   00850 D071                           pop    h1
    2040    1734   00852 D070                           pop    h0
    2041    1735   00854 D0D0                           pop    psw
    2042    1736   00856 D0E0                           pop    acc
    2043    1737   00858 22                             ret
    2044    1738   00859                  
    2045    1739   00859                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2046    1740   00859                  ;
    2047    1741   00859                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2048    1742   00859                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2049    1743   00859                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2050    1744   00859                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2051    1745   00859                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2052    1746   00859                  ;             carry=1 bij delen door 0
    2053    1747   00859                  ;
    2054    1748   00859                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2055    1749   00859                  ;
    2056    1750   00859                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2057    1751   00859                  
    2058    1752   00859 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2059    1753   0085B C0D0                           push   psw
    2060    1754   0085D C070                           push   h0
    2061    1755   0085F C071                           push   h1
    2062    1756   00861 C072                           push   h2
    2063    1757   00863 C073                           push   h3
    2064    1758   00865 C074                           push   h4
    2065    1759   00867 C075                           push   h5
    2066    1760   00869 C076                           push   h6
    2067    1761   0086B C077                           push   h7
    2068    1762   0086D C078                           push   h8
    2069    1763   0086F C079                           push   h9
    2070    1764   00871 C07A                           push   h10
    2071    1765   00873 C07B                           push   h11
    2072    1766   00875 C07C                           push   h12
    2073    1767   00877                  
    2074    1768   00877                  ; eerst alles voorladen
    2075    1769   00877                  
    2076    1770   00877 757000                         mov    h0,#000h
    2077    1771   0087A 757100                         mov    h1,#000h
    2078    1772   0087D 757200                         mov    h2,#000h
    2079    1773   00880 757300                         mov    h3,#000h
    2080    1774   00883 757400                         mov    h4,#000h
    2081    1775   00886 757500                         mov    h5,#000h
    2082    1776   00889 757600                         mov    h6,#000h
    2083    1777   0088C 757700                         mov    h7,#000h
    2084    1778   0088F 757800                         mov    h8,#000h
    2085    1779   00892 757900                         mov    h9,#000h
    2086    1780   00895 757A00                         mov    h10,#000h
    2087    1781   00898 757B00                         mov    h11,#000h
    2088    1782   0089B 757C20                         mov    h12,#32              ;loopcounter
    2089    1783   0089E                  
    2090    1784   0089E                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2091    1785   0089E                  
    2092    1786   0089E                  ; deze lus moet 32 keer heraald worden
    2093    1787   0089E                  
    2094    1788   0089E E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2095    1789   0089F 33                             rlc    a
    2096    1790   008A0 F8                             mov    r0,a
    2097    1791   008A1 E9                             mov    a,r1
    2098    1792   008A2 33                             rlc    a
    2099    1793   008A3 F9                             mov    r1,a
    2100    1794   008A4 EA                             mov    a,r2
    2101    1795   008A5 33                             rlc    a
    2102    1796   008A6 FA                             mov    r2,a
    2103    1797   008A7 EB                             mov    a,r3
    2104    1798   008A8 33                             rlc    a
    2105    1799   008A9 FB                             mov    r3,a
    2106    1800   008AA E570                           mov    a,h0
    2107    1801   008AC 33                             rlc    a
    2108    1802   008AD F570                           mov    h0,a
    2109    1803   008AF E571                           mov    a,h1
    2110    1804   008B1 33                             rlc    a
    2111    1805   008B2 F571                           mov    h1,a
    2112    1806   008B4 E572                           mov    a,h2
    2113    1807   008B6 33                             rlc    a
    2114    1808   008B7 F572                           mov    h2,a
    2115    1809   008B9 E573                           mov    a,h3
    2116    1810   008BB 33                             rlc    a
    2117    1811   008BC F573                           mov    h3,a
    2118    1812   008BE                  
    2119    1813   008BE                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2120    1814   008BE                  
    2121    1815   008BE C3                             clr    c                    ;zit in de weg
    2122    1816   008BF E570                           mov    a,h0
    2123    1817   008C1 9C                             subb   a,r4
    2124    1818   008C2 F574                           mov    h4,a
    2125    1819   008C4 E571                           mov    a,h1
    2126    1820   008C6 9D                             subb   a,r5
    2127    1821   008C7 F575                           mov    h5,a
    2128    1822   008C9 E572                           mov    a,h2
    2129    1823   008CB 9E                             subb   a,r6
    2130    1824   008CC F576                           mov    h6,a
    2131    1825   008CE E573                           mov    a,h3
    2132    1826   008D0 9F                             subb   a,r7
    2133    1827   008D1 F577                           mov    h7,a
    2134    1828   008D3                  
    2135    1829   008D3                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2136    1830   008D3                  ; vervangen worden door h7-h4
    2137    1831   008D3                  
    2138    1832   008D3 400C                           jc     div322               ;niet vervangen
    2139    1833   008D5                  
    2140    1834   008D5 857470                         mov    h0,h4
    2141    1835   008D8 857571                         mov    h1,h5
    2142    1836   008DB 857672                         mov    h2,h6
    2143    1837   008DE 857773                         mov    h3,h7                ;vervanging klaar
    2144    1838   008E1                  
    2145    1839   008E1 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2146    1840   008E2 E578                           mov    a,h8
    2147    1841   008E4 33                             rlc    a
    2148    1842   008E5 F578                           mov    h8,a
    2149    1843   008E7 E579                           mov    a,h9
    2150    1844   008E9 33                             rlc    a
    2151    1845   008EA F579                           mov    h9,a
    2152    1846   008EC E57A                           mov    a,h10
    2153    1847   008EE 33                             rlc    a
    2154    1848   008EF F57A                           mov    h10,a
    2155    1849   008F1 E57B                           mov    a,h11
    2156    1850   008F3 33                             rlc    a
    2157    1851   008F4 F57B                           mov    h11,a                ;qoutient aangepast
    2158    1852   008F6                  
    2159    1853   008F6 D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2160    1854   008F9                  
    2161    1855   008F9                  ; de berekening is klaar. uitkomstregisters nog laden
    2162    1856   008F9                  
    2163    1857   008F9 AC78                           mov    r4,h8
    2164    1858   008FB AD79                           mov    r5,h9
    2165    1859   008FD AE7A                           mov    r6,h10
    2166    1860   008FF AF7B                           mov    r7,h11               ;uitkomst geladen
    2167    1861   00901                  
    2168    1862   00901 A870                           mov    r0,h0                ;rest laden
    2169    1863   00903 A971                           mov    r1,h1
    2170    1864   00905 AA72                           mov    r2,h2
    2171    1865   00907 AB73                           mov    r3,h3
    2172    1866   00909                  
    2173    1867   00909 D07C                           pop    h12                  ;registers herstellen
    2174    1868   0090B D07B                           pop    h11
    2175    1869   0090D D07A                           pop    h10
    2176    1870   0090F D079                           pop    h9
    2177    1871   00911 D078                           pop    h8
    2178    1872   00913 D077                           pop    h7
    2179    1873   00915 D076                           pop    h6
    2180    1874   00917 D075                           pop    h5
    2181    1875   00919 D074                           pop    h4
    2182    1876   0091B D073                           pop    h3
    2183    1877   0091D D072                           pop    h2
    2184    1878   0091F D071                           pop    h1
    2185    1879   00921 D070                           pop    h0
    2186    1880   00923 D0D0                           pop    psw
    2187    1881   00925 D0E0                           pop    acc
    2188    1882   00927 22                             ret
    2189    1883   00928                  
    2190    1884   00928                  
    2191    1885   00928                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2192    1886   00928                  ;
    2193    1887   00928                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2194    1888   00928                  ; input:      r1,r0 = eerste getal (r1=msb)
    2195    1889   00928                  ;             r3,r2 = tweede getal (r3=msb)
    2196    1890   00928                  ; output:     r3,r2 = quotient (r3=msb)
    2197    1891   00928                  ;             r1,r0 = rest (r1=msb)
    2198    1892   00928                  ;             carry=1 bij deling door 0
    2199    1893   00928                  ;
    2200    1894   00928                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2201    1895   00928                  
    2202    1896   00928 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2203    1897   0092A C0D0                           push   psw
    2204    1898   0092C C070                           push   h0
    2205    1899   0092E C071                           push   h1
    2206    1900   00930 C072                           push   h2
    2207    1901   00932 C073                           push   h3
    2208    1902   00934 C074                           push   h4
    2209    1903   00936 C075                           push   h5
    2210    1904   00938 C076                           push   h6
    2211    1905   0093A                  
    2212    1906   0093A                  ; registers voorladen
    2213    1907   0093A                  
    2214    1908   0093A 757000                         mov    h0,#000h
    2215    1909   0093D 757100                         mov    h1,#000h
    2216    1910   00940 757200                         mov    h2,#000h
    2217    1911   00943 757300                         mov    h3,#000h
    2218    1912   00946 757400                         mov    h4,#000h
    2219    1913   00949 757500                         mov    h5,#000h
    2220    1914   0094C 757610                         mov    h6,#16               ;loopcounter
    2221    1915   0094F                  
    2222    1916   0094F                  ; eerst te delen getal 1*links shiften in hulpregisters
    2223    1917   0094F                  
    2224    1918   0094F                  ; deze lus moet 16 keer herhaald worden
    2225    1919   0094F                  
    2226    1920   0094F E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2227    1921   00950 33                             rlc    a
    2228    1922   00951 F8                             mov    r0,a
    2229    1923   00952 E9                             mov    a,r1
    2230    1924   00953 33                             rlc    a
    2231    1925   00954 F9                             mov    r1,a
    2232    1926   00955 E570                           mov    a,h0
    2233    1927   00957 33                             rlc    a
    2234    1928   00958 F570                           mov    h0,a
    2235    1929   0095A E571                           mov    a,h1
    2236    1930   0095C 33                             rlc    a
    2237    1931   0095D F571                           mov    h1,a
    2238    1932   0095F                  
    2239    1933   0095F                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2240    1934   0095F                  ; het tussenresultaat.
    2241    1935   0095F                  
    2242    1936   0095F C3                             clr    c
    2243    1937   00960 E570                           mov    a,h0
    2244    1938   00962 9A                             subb   a,r2
    2245    1939   00963 F572                           mov    h2,a
    2246    1940   00965 E571                           mov    a,h1
    2247    1941   00967 9B                             subb   a,r3
    2248    1942   00968 F573                           mov    h3,a
    2249    1943   0096A                  
    2250    1944   0096A 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2251    1945   0096C                                                            ;door h3,h2
    2252    1946   0096C 857270                         mov    h0,h2
    2253    1947   0096F 857371                         mov    h1,h3                ;vervanging klaar
    2254    1948   00972                  
    2255    1949   00972                  ; uitkomst moet aangepast worden
    2256    1950   00972                  
    2257    1951   00972 B3               div162:       cpl    c                    ;truuk
    2258    1952   00973 E574                           mov    a,h4
    2259    1953   00975 33                             rlc    a
    2260    1954   00976 F574                           mov    h4,a
    2261    1955   00978 E575                           mov    a,h5
    2262    1956   0097A 33                             rlc    a
    2263    1957   0097B F575                           mov    h5,a
    2264    1958   0097D D576CF                         djnz   h6,div161            ;16 keer herhalen
    2265    1959   00980                  
    2266    1960   00980                  ; de berekening is klaar. uitkomsten in passende registers
    2267    1961   00980                  
    2268    1962   00980 AA74                           mov    r2,h4                ;quotient
    2269    1963   00982 AB75                           mov    r3,h5
    2270    1964   00984                  
    2271    1965   00984 A870                           mov    r0,h0                ;rest
    2272    1966   00986 A971                           mov    r1,h1
    2273    1967   00988                  
    2274    1968   00988 D076                           pop    h6                   ;registers herstellen
    2275    1969   0098A D075                           pop    h5
    2276    1970   0098C D074                           pop    h4
    2277    1971   0098E D073                           pop    h3
    2278    1972   00990 D072                           pop    h2
    2279    1973   00992 D071                           pop    h1
    2280    1974   00994 D070                           pop    h0
    2281    1975   00996 D0D0                           pop    psw
    2282    1976   00998 D0E0                           pop    acc
    2283    1977   0099A 22                             ret
    2284    1978   0099B                  
    2285    1979   0099B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2286    1980   0099B                  ;
    2287    1981   0099B                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2288    1982   0099B                  ;
    2289    1983   0099B                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2290    1984   0099B                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2291    1985   0099B                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2292    1986   0099B                  ;
    2293    1987   0099B                  ; r4,r3,r2,r1,r0 worden aangepast
    2294    1988   0099B                  ;
    2295    1989   0099B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2296    1990   0099B                  
    2297    1991   0099B C0E0             add32:        push   acc                  ;registers op de stack zetten
    2298    1992   0099D C0D0                           push   psw
    2299    1993   0099F E8                             mov    a,r0                 ;eerste 8 bit
    2300    1994   009A0 2C                             add    a,r4
    2301    1995   009A1 F8                             mov    r0,a                 ;klaar
    2302    1996   009A2 E9                             mov    a,r1                 ;volgende 8 bit
    2303    1997   009A3 3D                             addc   a,r5
    2304    1998   009A4 F9                             mov    r1,a                 ;klaar
    2305    1999   009A5 EA                             mov    a,r2                 ;volgende 8 bit
    2306    2000   009A6 3E                             addc   a,r6
    2307    2001   009A7 FA                             mov    r2,a                 ;klaar
    2308    2002   009A8 EB                             mov    a,r3                 ;laatste 8 bit
    2309    2003   009A9 3F                             addc   a,r7
    2310    2004   009AA FB                             mov    r3,a                 ;32 bit klaar
    2311    2005   009AB 7400                           mov    a,#000h
    2312    2006   009AD 3400                           addc   a,#000h              ;carry verrekenen
    2313    2007   009AF FC                             mov    r4,a
    2314    2008   009B0 D0D0                           pop    psw                  ;registers herstellen
    2315    2009   009B2 D0E0                           pop    acc
    2316    2010   009B4 22                             ret
    2317    2011   009B5                  
    2318    2012   009B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2319    2013   009B5                  ;
    2320    2014   009B5                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2321    2015   009B5                  ;
    2322    2016   009B5                  ; input:      r1,r0 = eerste getal (r1=msb)
    2323    2017   009B5                  ;             r3,r2 = tweede getal (r3=msb)
    2324    2018   009B5                  ; output:     r2,r1,r0 (r2=msb)
    2325    2019   009B5                  ;
    2326    2020   009B5                  ; r3,r2,r1,r0 worden aangepast
    2327    2021   009B5                  ;
    2328    2022   009B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2329    2023   009B5                  
    2330    2024   009B5 C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2331    2025   009B7 C0D0                           push   psw
    2332    2026   009B9 E8                             mov    a,r0                 ;starten met de optelling
    2333    2027   009BA 2A                             add    a,r2                 ;8 bit klaar
    2334    2028   009BB F8                             mov    r0,a                 ;uitkomst wegschrijven
    2335    2029   009BC E9                             mov    a,r1                 ;volgende 8 bit
    2336    2030   009BD 3B                             addc   a,r3                 ;16 bit klaar
    2337    2031   009BE F9                             mov    r1,a                 ;uitkomst weggeschreven
    2338    2032   009BF 7400                           mov    a,#000h              ;carry verrekenen
    2339    2033   009C1 3400                           addc   a,#000h
    2340    2034   009C3 FA                             mov    r2,a                 ;24 bit klaar
    2341    2035   009C4 D0D0                           pop    psw                  ;registers herstellen
    2342    2036   009C6 D0E0                           pop    acc
    2343    2037   009C8 22                             ret
    2344    2038   009C9                  
    2345    2039   009C9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2346    2040   009C9                  ;
    2347    2041   009C9                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2348    2042   009C9                  ;             40 bit groot. (eerste -tweede)
    2349    2043   009C9                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2350    2044   009C9                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2351    2045   009C9                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2352    2046   009C9                  ;
    2353    2047   009C9                  ; r4,r3,r2,r1,r0 worden aangepast
    2354    2048   009C9                  ;
    2355    2049   009C9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2356    2050   009C9                  
    2357    2051   009C9 C0E0             sub32:        push   acc                  ;registers bewaren
    2358    2052   009CB C0D0                           push   psw                  ;ook de vlaggen
    2359    2053   009CD C3                             clr    c                    ;zit nog effe in de weg
    2360    2054   009CE E8                             mov    a,r0                 ;eerste 8 bit
    2361    2055   009CF 9C                             subb   a,r4
    2362    2056   009D0 F8                             mov    r0,a
    2363    2057   009D1 E9                             mov    a,r1                 ;tweede 8 bit
    2364    2058   009D2 9D                             subb   a,r5
    2365    2059   009D3 F9                             mov    r1,a
    2366    2060   009D4 EA                             mov    a,r2                 ;volgende 8 bit
    2367    2061   009D5 9E                             subb   a,r6
    2368    2062   009D6 FA                             mov    r2,a
    2369    2063   009D7 EB                             mov    a,r3                 ;laatste 8 bit
    2370    2064   009D8 9F                             subb   a,r7
    2371    2065   009D9 FB                             mov    r3,a
    2372    2066   009DA 7400                           mov    a,#000h              ;nu nog de carry
    2373    2067   009DC 9400                           subb   a,#000h
    2374    2068   009DE FC                             mov    r4,a                 ;40 bit klaar
    2375    2069   009DF D0D0                           pop    psw                  ;registers herstellen
    2376    2070   009E1 D0E0                           pop    acc
    2377    2071   009E3 22                             ret
    2378    2072   009E4                  
    2379    2073   009E4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2380    2074   009E4                  ;
    2381    2075   009E4                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2382    2076   009E4                  ;             24 bit groot. (eerste - tweede)
    2383    2077   009E4                  ; input:      r1,r0 = eerste getal (r1=msb)
    2384    2078   009E4                  ;             r3,r2 = tweede getal (r3=msb)
    2385    2079   009E4                  ; output:     r2,r1,r0 (r2=msb)
    2386    2080   009E4                  ;
    2387    2081   009E4                  ; r3,r2,r1,r0 worden aangepast
    2388    2082   009E4                  ;
    2389    2083   009E4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2390    2084   009E4                  
    2391    2085   009E4 C0E0             sub16:        push   acc                  ;registers bewaren
    2392    2086   009E6 C0D0                           push   psw
    2393    2087   009E8 C3                             clr    c                    ;mag nog niet meespelen
    2394    2088   009E9 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2395    2089   009EA 9A                             subb   a,r2
    2396    2090   009EB F8                             mov    r0,a                 ;klaar
    2397    2091   009EC E9                             mov    a,r1
    2398    2092   009ED 9B                             subb   a,r3                 ;16 bit klaar
    2399    2093   009EE F9                             mov    r1,a
    2400    2094   009EF 7400                           mov    a,#000h
    2401    2095   009F1 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2402    2096   009F3 FA                             mov    r2,a                 ;24 bit klaar
    2403    2097   009F4 D0D0                           pop    psw                  ;registers herstellen
    2404    2098   009F6 D0E0                           pop    acc
    2405    2099   009F8 22                             ret
    2406    2100   009F9                  
    2407    2101   009F9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2408    2102   009F9                  ;
    2409    2103   009F9                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2410    2104   009F9                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2411    2105   009F9                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2412    2106   009F9                  ;
    2413    2107   009F9                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2414    2108   009F9                  ;
    2415    2109   009F9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2416    2110   009F9                  
    2417    2111   009F9 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2418    2112   009FB C0D0                           push   psw
    2419    2113   009FD                  
    2420    2114   009FD C077                           push   h7                   ;nodig
    2421    2115   009FF C078                           push   h8
    2422    2116   00A01                  
    2423    2117   00A01 C079                           push   h9                   ;ook
    2424    2118   00A03                  
    2425    2119   00A03 757905                         mov    h9,#005h             ;loopcounter
    2426    2120   00A06                  
    2427    2121   00A06 7B00             hexbcd161:    mov    r3,#000h
    2428    2122   00A08 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2429    2123   00A0A 120928                         lcall  div16                ;deling uitvoeren
    2430    2124   00A0D E8                             mov    a,r0                 ;rest
    2431    2125   00A0E C0E0                           push   acc                  ;op stack zetten
    2432    2126   00A10 EA                             mov    a,r2
    2433    2127   00A11 F8                             mov    r0,a
    2434    2128   00A12 EB                             mov    a,r3
    2435    2129   00A13 F9                             mov    r1,a                 ;uitkomst terug delen
    2436    2130   00A14 D579EF                         djnz   h9,hexbcd161
    2437    2131   00A17                  
    2438    2132   00A17 D0E0                           pop    acc                  ;hoogste bits van de stack
    2439    2133   00A19 FA                             mov    r2,a                 ;klaar
    2440    2134   00A1A D0E0                           pop    acc
    2441    2135   00A1C C4                             swap   a
    2442    2136   00A1D F579                           mov    h9,a
    2443    2137   00A1F D0E0                           pop    acc
    2444    2138   00A21 2579                           add    a,h9
    2445    2139   00A23 F9                             mov    r1,a                 ;volgende 8 klaar
    2446    2140   00A24 D0E0                           pop    acc
    2447    2141   00A26 C4                             swap   a
    2448    2142   00A27 F579                           mov    h9,a
    2449    2143   00A29 D0E0                           pop    acc
    2450    2144   00A2B 2579                           add    a,h9
    2451    2145   00A2D F8                             mov    r0,a                 ;klaar
    2452    2146   00A2E                  
    2453    2147   00A2E D079                           pop    h9                   ;was naar de knoppen
    2454    2148   00A30                  
    2455    2149   00A30 D078                           pop    h8                   ;gebruikt
    2456    2150   00A32 D077                           pop    h7
    2457    2151   00A34                  
    2458    2152   00A34 D0D0                           pop    psw                  ;registers herstellen
    2459    2153   00A36 D0E0                           pop    acc
    2460    2154   00A38 22                             ret
    2461    2155   00A39                  
    2462    2156   00A39                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2463    2157   00A39                  ;
    2464    2158   00A39                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2465    2159   00A39                  ; input       a (maximale waarde = 63h)
    2466    2160   00A39                  ; output      a
    2467    2161   00A39                  ;
    2468    2162   00A39                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2469    2163   00A39                  
    2470    2164   00A39 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2471    2165   00A3B C0F0                           push   b
    2472    2166   00A3D 75F00A                         mov    b,#00ah              ;hierdoor delen
    2473    2167   00A40 84                             div    ab                   ;in accu qoutient in b rest
    2474    2168   00A41 C4                             swap   a
    2475    2169   00A42 25F0                           add    a,b                  ;bcd getal klaar
    2476    2170   00A44 D0F0                           pop    b
    2477    2171   00A46 D0D0                           pop    psw
    2478    2172   00A48 22                             ret
    2479    2173   00A49                  
    2480    2174   00A49                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2481    2175   00A49                  ;
    2482    2176   00A49                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2483    2177   00A49                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2484    2178   00A49                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2485    2179   00A49                  ;
    2486    2180   00A49                  ; de routine gebruikt r1,r0 van de huidige bank
    2487    2181   00A49                  ;
    2488    2182   00A49                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2489    2183   00A49                  
    2490    2184   00A49 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2491    2185   00A4B C0E0                           push   acc
    2492    2186   00A4D C0D0                           push   psw
    2493    2187   00A4F                  
    2494    2188   00A4F E8                             mov    a,r0
    2495    2189   00A50 540F                           anl    a,#00fh              ;eenheden
    2496    2190   00A52 C0E0                           push   acc                  ;effe bewaren
    2497    2191   00A54                  
    2498    2192   00A54 E8                             mov    a,r0
    2499    2193   00A55 C4                             swap   a
    2500    2194   00A56 540F                           anl    a,#00fh              ;tientallen
    2501    2195   00A58 75F00A                         mov    b,#00ah              ;waarde berekenen
    2502    2196   00A5B A4                             mul    ab                   ;klaar
    2503    2197   00A5C D0F0                           pop    b                    ;truukje
    2504    2198   00A5E 25F0                           add    a,b                  ;a is lage deel hex getal
    2505    2199   00A60 C0E0                           push   acc                  ;straks nodig
    2506    2200   00A62                  
    2507    2201   00A62 E9                             mov    a,r1                 ;hoge deel
    2508    2202   00A63 54F0                           anl    a,#0f0h
    2509    2203   00A65 C4                             swap   a
    2510    2204   00A66 C0E0                           push   acc                  ;straks nodig
    2511    2205   00A68                  
    2512    2206   00A68 E9                             mov    a,r1
    2513    2207   00A69 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2514    2208   00A6B 75F064                         mov    b,#100               ;waarde uitrekenen
    2515    2209   00A6E A4                             mul    ab
    2516    2210   00A6F A9F0                           mov    r1,b
    2517    2211   00A71 F8                             mov    r0,a
    2518    2212   00A72                  
    2519    2213   00A72 D0E0                           pop    acc
    2520    2214   00A74 75F00A                         mov    b,#10
    2521    2215   00A77 A4                             mul    ab                   ;kan nog in a
    2522    2216   00A78 75F064                         mov    b,#100               ;*10*100=*1000
    2523    2217   00A7B A4                             mul    ab
    2524    2218   00A7C 28                             add    a,r0
    2525    2219   00A7D F8                             mov    r0,a
    2526    2220   00A7E E9                             mov    a,r1
    2527    2221   00A7F 35F0                           addc   a,b
    2528    2222   00A81 F9                             mov    r1,a
    2529    2223   00A82                  
    2530    2224   00A82 D0E0                           pop    acc
    2531    2225   00A84 28                             add    a,r0
    2532    2226   00A85 F8                             mov    r0,a
    2533    2227   00A86 7400                           mov    a,#000h
    2534    2228   00A88 39                             addc   a,r1
    2535    2229   00A89 F9                             mov    r1,a                 ;klaar
    2536    2230   00A8A                  
    2537    2231   00A8A D0D0                           pop    psw
    2538    2232   00A8C D0E0                           pop    acc
    2539    2233   00A8E D0F0                           pop    b
    2540    2234   00A90 22                             ret
    2541    2235   00A91                  
    2542    2236   00A91                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2543    2237   00A91                  ;
    2544    2238   00A91                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2545    2239   00A91                  ; input:      a (maximale waarde 99h)
    2546    2240   00A91                  ; output:     a
    2547    2241   00A91                  ;
    2548    2242   00A91                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2549    2243   00A91                  
    2550    2244   00A91 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2551    2245   00A93 C0F0                           push   b
    2552    2246   00A95 C070                           push   h0
    2553    2247   00A97 F570                           mov    h0,a                 ;effe bewaren
    2554    2248   00A99 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2555    2249   00A9C 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2556    2250   00A9E C4                             swap   a
    2557    2251   00A9F 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2558    2252   00AA2 A4                             mul    ab
    2559    2253   00AA3 2570                           add    a,h0                 ;eenheden bijtellen
    2560    2254   00AA5 D070                           pop    h0
    2561    2255   00AA7 D0F0                           pop    b
    2562    2256   00AA9 D0D0                           pop    psw
    2563    2257   00AAB 22                             ret
    2564    2258   00AAC                  
    2565    2259   00AAC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2566    2260   00AAC                  ;
    2567    2261   00AAC                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2568    2262   00AAC                  ;
    2569    2263   00AAC                  ; Gebruikt geen registers
    2570    2264   00AAC                  ;
    2571    2265   00AAC                  ; Originele auteur: Danny Pawels (dp)
    2572    2266   00AAC                  ;
    2573    2267   00AAC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2574    2268   00AAC                  
    2575    2269   00AAC                  
    2576    2270   00AAC C083             XCsw2xtal:  push  dph
    2577    2271   00AAE C082                         push  dpl
    2578    2272   00AB0 C0D0                         push  psw
    2579    2273   00AB2 C08F                         push  syscon0
    2580    2274   00AB4 C0B2                         push  port_page
    2581    2275   00AB6 C0BF                         push  scu_page
    2582    2276   00AB8                  
    2583    2277   00AB8 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2584    2278   00ABB 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2585    2279   00ABE                  
    2586    2280   00ABE 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2587    2281   00AC1                                                            ;freq= VCO-free running =5MHz...20MHz?
    2588    2282   00AC1 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2589    2283   00AC4 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2590    2284   00AC7 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2591    2285   00ACA                  
    2592    2286   00ACA 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2593    2287   00ACD A3               XCsw2xtal0: inc   dptr
    2594    2288   00ACE E582                         mov   a,dpl
    2595    2289   00AD0 4583                         orl   a,dph
    2596    2290   00AD2 70F9                         jnz   XCsw2xtal0
    2597    2291   00AD4                  
    2598    2292   00AD4 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2599    2293   00AD7                  
    2600    2294   00AD7                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2601    2295   00AD7 E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2602    2296   00AD9 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2603    2297   00ADC                  ;Oscillator run detectie is klaar...
    2604    2298   00ADC 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2605    2299   00ADF                  
    2606    2300   00ADF                  
    2607    2301   00ADF E5B7                         mov   a,pll_con               ;lees pll_con
    2608    2302   00AE1 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2609    2303   00AE3 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2610    2304   00AE5                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2611    2305   00AE5                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2612    2306   00AE5                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2613    2307   00AE5 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2614    2308   00AE8                                                            ;bij aanpassing van de NDIV van de PLL
    2615    2309   00AE8 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2616    2310   00AEA 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2617    2311   00AED 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2618    2312   00AF0                  
    2619    2313   00AF0 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2620    2314   00AF2 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2621    2315   00AF5                  
    2622    2316   00AF5 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2623    2317   00AF8 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2624    2318   00AFB                  
    2625    2319   00AFB D0BF                         pop   scu_page                ;herstel controller status
    2626    2320   00AFD D0B2                         pop   port_page
    2627    2321   00AFF D08F                         pop   syscon0
    2628    2322   00B01 D0D0                         pop   psw
    2629    2323   00B03 D082                         pop   dpl
    2630    2324   00B05 D083                         pop   dph
    2631    2325   00B07 22                           ret
    2632    2326   00B08                  
    2633    2327   00B08                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2634    2328   00B08                  ;
    2635    2329   00B08                  ; mapregs	selecteer de SFR's in de mapped area
    2636    2330   00B08                  ;
    2637    2331   00B08                  ;
    2638    2332   00B08                  ; Past syscon SFR aan
    2639    2333   00B08                  ;
    2640    2334   00B08                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2641    2335   00B08                  
    2642    2336   00B08 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2643    2337   00B0B 22               		ret
    2644    2338   00B0C                  
    2645    2339   00B0C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2646    2340   00B0C                  ;
    2647    2341   00B0C                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2648    2342   00B0C                  ;
    2649    2343   00B0C                  ; Past syscon SFR aan
    2650    2344   00B0C                  ;
    2651    2345   00B0C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2652    2346   00B0C                  
    2653    2347   00B0C 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2654    2348   00B0F 22               		ret
    2655    2349   00B10                  
    2656    2350   00B10                  ;*******************************************************************************
    2657    2351   00B10                  ;
    2658    2352   00B10                  ; These are the register declarations for the XC888 microcontroller from
    2659    2353   00B10                  ; Infineon.
    2660    2354   00B10                  ;
    2661    2355   00B10                  ;*******************************************************************************
    2662    2356   00B10                  
    2663    2357   00B10                  ;*******************************************************************************
    2664    2358   00B10                  ;
    2665    2359   00B10                  ; CPU registers are accessible independend of paging and mapping
    2666    2360   00B10                  ; (always accessible)
    2667    2361   00B10                  ;
    2668    2362   00B10                  ;*******************************************************************************
    2669    2363   00B10                  
    2670    2364   00B10                  sp            data   081h          ;stack pointer                     reset=007h
    2671    2365   00B10                  dpl           data   082h          ;datapointer low register          reset=000h
    2672    2366   00B10                  dph           data   083h          ;datapointer high register         reset=000h
    2673    2367   00B10                  pcon          data   087h          ;power control                     reset=000h
    2674    2368   00B10                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2675    2369   00B10                  ;tcon is bit addressable
    2676    2370   00B10                         tf1    bit    08fh
    2677    2371   00B10                         tr1    bit    08eh
    2678    2372   00B10                         tf0    bit    08dh
    2679    2373   00B10                         tr0    bit    08ch
    2680    2374   00B10                         ie1    bit    08bh
    2681    2375   00B10                         it1    bit    08ah
    2682    2376   00B10                         ie0    bit    089h
    2683    2377   00B10                         it0    bit    088h
    2684    2378   00B10                  
    2685    2379   00B10                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2686    2380   00B10                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2687    2381   00B10                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2688    2382   00B10                  th0           data   08ch          ;timer 0 high                      reset=000h
    2689    2383   00B10                  th1           data   08dh          ;timer 1 high                      reset=000h
    2690    2384   00B10                  
    2691    2385   00B10                  syscon0       data   08fh          ;system control register 0         reset=004h
    2692    2386   00B10                  scon          data   098h          ;serial channel 0 control          reset=000h
    2693    2387   00B10                  ;scon is bit addressable
    2694    2388   00B10                         sm0    bit    09fh
    2695    2389   00B10                         sm1    bit    09eh
    2696    2390   00B10                         sm2    bit    09dh
    2697    2391   00B10                         ren    bit    09ch
    2698    2392   00B10                         tb8    bit    09bh
    2699    2393   00B10                         rb8    bit    09ah
    2700    2394   00B10                         ti     bit    099h
    2701    2395   00B10                         ri     bit    098h
    2702    2396   00B10                  
    2703    2397   00B10                  sbuf          data   099h          ;serial data buffer channel 0
    2704    2398   00B10                  eo            data   0a2h          ;extended operation                reset=000h
    2705    2399   00B10                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2706    2400   00B10                  ;ien0 is bit addressable
    2707    2401   00B10                         ea     bit    0afh
    2708    2402   00B10                                                     ;bit not implemented
    2709    2403   00B10                         et2    bit    0adh
    2710    2404   00B10                         es     bit    0ach
    2711    2405   00B10                         et1    bit    0abh
    2712    2406   00B10                         ex1    bit    0aah
    2713    2407   00B10                         et0    bit    0a9h
    2714    2408   00B10                         ex0    bit    0a8h
    2715    2409   00B10                  
    2716    2410   00B10                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2717    2411   00B10                  ;ip is bit addressable
    2718    2412   00B10                                                     ;bit not implemented
    2719    2413   00B10                                                     ;bit not implemented
    2720    2414   00B10                         pt2    bit    0bdh
    2721    2415   00B10                         ps     bit    0bch
    2722    2416   00B10                         pt1    bit    0bbh
    2723    2417   00B10                         px1    bit    0bah
    2724    2418   00B10                         pt0    bit    0b9h
    2725    2419   00B10                         px0    bit    0b8h
    2726    2420   00B10                  
    2727    2421   00B10                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2728    2422   00B10                  psw           data   0d0h          ;program status word               reset=000h
    2729    2423   00B10                  ;psw is bit addressable
    2730    2424   00B10                         cy     bit    0d7h
    2731    2425   00B10                         ac     bit    0d6h
    2732    2426   00B10                         f0     bit    0d5h
    2733    2427   00B10                         rs1    bit    0d4h
    2734    2428   00B10                         rs0    bit    0d3h
    2735    2429   00B10                         ov     bit    0d2h
    2736    2430   00B10                         f1     bit    0d1h
    2737    2431   00B10                         p      bit    0d0h
    2738    2432   00B10                  
    2739    2433   00B10                  acc           data   0e0h          ;accumulator                       reset=000h
    2740    2434   00B10                  ;acc is bit addressable
    2741    2435   00B10                  
    2742    2436   00B10                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2743    2437   00B10                  ;ien1 is bit addressable
    2744    2438   00B10                         eccip3 bit    0efh
    2745    2439   00B10                         eccip2 bit    0eeh
    2746    2440   00B10                         eccip1 bit    0edh
    2747    2441   00B10                         eccip0 bit    0ech
    2748    2442   00B10                         exm    bit    0ebh
    2749    2443   00B10                         ex2    bit    0eah
    2750    2444   00B10                         essc   bit    0e9h
    2751    2445   00B10                         eadc   bit    0e8h
    2752    2446   00B10                  
    2753    2447   00B10                  b             data   0f0h          ;b register                        reset=000h
    2754    2448   00B10                  ;b is bit addressable
    2755    2449   00B10                  
    2756    2450   00B10                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2757    2451   00B10                  ;ip1 is bit addressable
    2758    2452   00B10                         pccip3 bit    0ffh
    2759    2453   00B10                         pccip2 bit    0feh
    2760    2454   00B10                         pccip1 bit    0fdh
    2761    2455   00B10                         pccip0 bit    0fch
    2762    2456   00B10                         pxm    bit    0fbh
    2763    2457   00B10                         px2    bit    0fah
    2764    2458   00B10                         pssc   bit    0f9h
    2765    2459   00B10                         padc   bit    0f8h
    2766    2460   00B10                  
    2767    2461   00B10                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2768    2462   00B10                  
    2769    2463   00B10                  
    2770    2464   00B10                  ;*******************************************************************************
    2771    2465   00B10                  ;
    2772    2466   00B10                  ; system control registers registers that can only be accessed in the non
    2773    2467   00B10                  ; mapped memory area (rmap=0) page independent
    2774    2468   00B10                  ;
    2775    2469   00B10                  ;*******************************************************************************
    2776    2470   00B10                  
    2777    2471   00B10                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2778    2472   00B10                  
    2779    2473   00B10                  ;*******************************************************************************
    2780    2474   00B10                  ;
    2781    2475   00B10                  ; system control registers registers that can only be accessed in the non
    2782    2476   00B10                  ; mapped memory area (rmap=0) and page 0
    2783    2477   00B10                  ;
    2784    2478   00B10                  ;*******************************************************************************
    2785    2479   00B10                  
    2786    2480   00B10                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2787    2481   00B10                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2788    2482   00B10                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2789    2483   00B10                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2790    2484   00B10                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2791    2485   00B10                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2792    2486   00B10                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2793    2487   00B10                  nmisr         data   0bch          ;nmi status                        reset=000h
    2794    2488   00B10                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2795    2489   00B10                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2796    2490   00B10                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2797    2491   00B10                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2798    2492   00B10                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2799    2493   00B10                  
    2800    2494   00B10                  ;*******************************************************************************
    2801    2495   00B10                  ;
    2802    2496   00B10                  ; system control registers registers that can only be accessed in the non
    2803    2497   00B10                  ; mapped memory area (rmap=0) and page 1
    2804    2498   00B10                  ;
    2805    2499   00B10                  ;*******************************************************************************
    2806    2500   00B10                  
    2807    2501   00B10                  id            data   0b3h          ;identity register     reset=device dependent
    2808    2502   00B10                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2809    2503   00B10                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2810    2504   00B10                  osc_con       data   0b6h          ;osc control                       reset=008h
    2811    2505   00B10                  pll_con       data   0b7h          ;pll control                       reset=090h
    2812    2506   00B10                  cmcon         data   0bah          ;clock control                     reset=010h
    2813    2507   00B10                  passwd        data   0bbh          ;password register                 reset=007h
    2814    2508   00B10                  feal          data   0bch          ;flash error register              reset=000h
    2815    2509   00B10                  feah          data   0bdh          ;flash error address high          reset=000h
    2816    2510   00B10                  cocon         data   0beh          ;clock output control              reset=000h
    2817    2511   00B10                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2818    2512   00B10                  
    2819    2513   00B10                  ;*******************************************************************************
    2820    2514   00B10                  ;
    2821    2515   00B10                  ; system control registers registers that can only be accessed in the non
    2822    2516   00B10                  ; mapped memory area (rmap=0) and page 3
    2823    2517   00B10                  ;
    2824    2518   00B10                  ;*******************************************************************************
    2825    2519   00B10                  
    2826    2520   00B10                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2827    2521   00B10                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2828    2522   00B10                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2829    2523   00B10                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2830    2524   00B10                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2831    2525   00B10                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2832    2526   00B10                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2833    2527   00B10                  
    2834    2528   00B10                  ;*******************************************************************************
    2835    2529   00B10                  ;
    2836    2530   00B10                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2837    2531   00B10                  ;
    2838    2532   00B10                  ;*******************************************************************************
    2839    2533   00B10                  
    2840    2534   00B10                  port_page     data   0b2h          ;port page register                reset=000h
    2841    2535   00B10                  
    2842    2536   00B10                  ;*******************************************************************************
    2843    2537   00B10                  ;
    2844    2538   00B10                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2845    2539   00B10                  ;
    2846    2540   00B10                  ;*******************************************************************************
    2847    2541   00B10                  
    2848    2542   00B10                  p0_data       data   080h          ;port 0 data register              reset=000h
    2849    2543   00B10                  ;p0_data is bit addressable
    2850    2544   00B10                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2851    2545   00B10                  p1_data       data   090h          ;port 1 data register              reset=000h
    2852    2546   00B10                  ;p1_data is bit addressable
    2853    2547   00B10                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2854    2548   00B10                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2855    2549   00B10                  ;p2_data is bit addressable
    2856    2550   00B10                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2857    2551   00B10                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2858    2552   00B10                  ;p3_data is bit addressable
    2859    2553   00B10                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2860    2554   00B10                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2861    2555   00B10                  ;p4_data is bit addressable
    2862    2556   00B10                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2863    2557   00B10                  p5_data       data   092h          ;port 5 data register              reset=000h
    2864    2558   00B10                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2865    2559   00B10                  
    2866    2560   00B10                  ;*******************************************************************************
    2867    2561   00B10                  ;
    2868    2562   00B10                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2869    2563   00B10                  ;
    2870    2564   00B10                  ;*******************************************************************************
    2871    2565   00B10                  
    2872    2566   00B10                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2873    2567   00B10                  ;p0_data is bit addressable
    2874    2568   00B10                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2875    2569   00B10                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2876    2570   00B10                  ;p1_data is bit addressable
    2877    2571   00B10                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2878    2572   00B10                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2879    2573   00B10                  ;p2_data is bit addressable
    2880    2574   00B10                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2881    2575   00B10                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2882    2576   00B10                  ;p3_data is bit addressable
    2883    2577   00B10                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2884    2578   00B10                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2885    2579   00B10                  ;p4_data is bit addressable
    2886    2580   00B10                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2887    2581   00B10                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2888    2582   00B10                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2889    2583   00B10                  
    2890    2584   00B10                  ;*******************************************************************************
    2891    2585   00B10                  ;
    2892    2586   00B10                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2893    2587   00B10                  ;
    2894    2588   00B10                  ;*******************************************************************************
    2895    2589   00B10                  
    2896    2590   00B10                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2897    2591   00B10                  ;p0_data is bit addressable
    2898    2592   00B10                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2899    2593   00B10                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2900    2594   00B10                  ;p1_data is bit addressable
    2901    2595   00B10                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2902    2596   00B10                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2903    2597   00B10                  ;p3_data is bit addressable
    2904    2598   00B10                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2905    2599   00B10                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2906    2600   00B10                  ;p4_data is bit addressable
    2907    2601   00B10                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2908    2602   00B10                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2909    2603   00B10                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2910    2604   00B10                  
    2911    2605   00B10                  ;*******************************************************************************
    2912    2606   00B10                  ;
    2913    2607   00B10                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2914    2608   00B10                  ;
    2915    2609   00B10                  ;*******************************************************************************
    2916    2610   00B10                  
    2917    2611   00B10                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2918    2612   00B10                  ;p0_data is bit addressable
    2919    2613   00B10                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2920    2614   00B10                  ;p1_data is bit addressable
    2921    2615   00B10                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2922    2616   00B10                  ;p3_data is bit addressable
    2923    2617   00B10                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2924    2618   00B10                  ;p4_data is bit addressable
    2925    2619   00B10                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2926    2620   00B10                  
    2927    2621   00B10                  ;*******************************************************************************
    2928    2622   00B10                  ;
    2929    2623   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2930    2624   00B10                  ;
    2931    2625   00B10                  ;*******************************************************************************
    2932    2626   00B10                  
    2933    2627   00B10                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2934    2628   00B10                  
    2935    2629   00B10                  ;*******************************************************************************
    2936    2630   00B10                  ;
    2937    2631   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2938    2632   00B10                  ;
    2939    2633   00B10                  ;*******************************************************************************
    2940    2634   00B10                  
    2941    2635   00B10                  adc_globctr   data   0cah          ;global control register           reset=030h
    2942    2636   00B10                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2943    2637   00B10                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2944    2638   00B10                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2945    2639   00B10                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2946    2640   00B10                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2947    2641   00B10                  
    2948    2642   00B10                  ;*******************************************************************************
    2949    2643   00B10                  ;
    2950    2644   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2951    2645   00B10                  ;
    2952    2646   00B10                  ;*******************************************************************************
    2953    2647   00B10                  
    2954    2648   00B10                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2955    2649   00B10                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2956    2650   00B10                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2957    2651   00B10                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2958    2652   00B10                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2959    2653   00B10                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2960    2654   00B10                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2961    2655   00B10                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2962    2656   00B10                  
    2963    2657   00B10                  ;*******************************************************************************
    2964    2658   00B10                  ;
    2965    2659   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2966    2660   00B10                  ;
    2967    2661   00B10                  ;*******************************************************************************
    2968    2662   00B10                  
    2969    2663   00B10                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2970    2664   00B10                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2971    2665   00B10                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2972    2666   00B10                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2973    2667   00B10                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2974    2668   00B10                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2975    2669   00B10                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2976    2670   00B10                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2977    2671   00B10                  
    2978    2672   00B10                  ;*******************************************************************************
    2979    2673   00B10                  ;
    2980    2674   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2981    2675   00B10                  ;
    2982    2676   00B10                  ;*******************************************************************************
    2983    2677   00B10                  
    2984    2678   00B10                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2985    2679   00B10                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2986    2680   00B10                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2987    2681   00B10                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2988    2682   00B10                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2989    2683   00B10                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2990    2684   00B10                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2991    2685   00B10                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2992    2686   00B10                  
    2993    2687   00B10                  ;*******************************************************************************
    2994    2688   00B10                  ;
    2995    2689   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2996    2690   00B10                  ;
    2997    2691   00B10                  ;*******************************************************************************
    2998    2692   00B10                  
    2999    2693   00B10                  adc_rcr0      data   0cah          ;result control register           reset=000h
    3000    2694   00B10                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    3001    2695   00B10                  adc_rcr2      data   0cch          ;result control register           reset=000h
    3002    2696   00B10                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    3003    2697   00B10                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    3004    2698   00B10                  
    3005    2699   00B10                  ;*******************************************************************************
    3006    2700   00B10                  ;
    3007    2701   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    3008    2702   00B10                  ;
    3009    2703   00B10                  ;*******************************************************************************
    3010    2704   00B10                  
    3011    2705   00B10                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    3012    2706   00B10                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    3013    2707   00B10                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    3014    2708   00B10                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    3015    2709   00B10                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    3016    2710   00B10                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    3017    2711   00B10                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    3018    2712   00B10                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    3019    2713   00B10                  
    3020    2714   00B10                  ;*******************************************************************************
    3021    2715   00B10                  ;
    3022    2716   00B10                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    3023    2717   00B10                  ;
    3024    2718   00B10                  ;*******************************************************************************
    3025    2719   00B10                  
    3026    2720   00B10                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    3027    2721   00B10                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    3028    2722   00B10                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3029    2723   00B10                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3030    2724   00B10                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3031    2725   00B10                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3032    2726   00B10                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3033    2727   00B10                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3034    2728   00B10                  
    3035    2729   00B10                  ;*******************************************************************************
    3036    2730   00B10                  
    3037    2731   00B10                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3038    2732   00B10                  ;
    3039    2733   00B10                  ;*******************************************************************************
    3040    2734   00B10                  
    3041    2735   00B10                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3042    2736   00B10                  ;t2_t2con is bit addressable
    3043    2737   00B10                         tf2    bit    0c7h
    3044    2738   00B10                         exf2   bit    0c6h
    3045    2739   00B10                                                     ;2 bits are not implemented
    3046    2740   00B10                         exen2  bit    0c3h
    3047    2741   00B10                         tr2    bit    0c2h
    3048    2742   00B10                         ct2    bit    0c1h
    3049    2743   00B10                         cprl2  bit    0c0h
    3050    2744   00B10                  
    3051    2745   00B10                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3052    2746   00B10                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3053    2747   00B10                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3054    2748   00B10                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3055    2749   00B10                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3056    2750   00B10                  
    3057    2751   00B10                  ;*******************************************************************************
    3058    2752   00B10                  ;
    3059    2753   00B10                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3060    2754   00B10                  ;
    3061    2755   00B10                  ;*******************************************************************************
    3062    2756   00B10                  
    3063    2757   00B10                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3064    2758   00B10                  
    3065    2759   00B10                  ;*******************************************************************************
    3066    2760   00B10                  ;
    3067    2761   00B10                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3068    2762   00B10                  ;
    3069    2763   00B10                  ;*******************************************************************************
    3070    2764   00B10                  
    3071    2765   00B10                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3072    2766   00B10                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3073    2767   00B10                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3074    2768   00B10                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3075    2769   00B10                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3076    2770   00B10                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3077    2771   00B10                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3078    2772   00B10                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3079    2773   00B10                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3080    2774   00B10                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3081    2775   00B10                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3082    2776   00B10                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3083    2777   00B10                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3084    2778   00B10                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3085    2779   00B10                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3086    2780   00B10                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3087    2781   00B10                  
    3088    2782   00B10                  ;*******************************************************************************
    3089    2783   00B10                  ;
    3090    2784   00B10                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3091    2785   00B10                  ;
    3092    2786   00B10                  ;*******************************************************************************
    3093    2787   00B10                  
    3094    2788   00B10                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3095    2789   00B10                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3096    2790   00B10                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3097    2791   00B10                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3098    2792   00B10                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3099    2793   00B10                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3100    2794   00B10                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3101    2795   00B10                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3102    2796   00B10                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3103    2797   00B10                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3104    2798   00B10                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3105    2799   00B10                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3106    2800   00B10                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3107    2801   00B10                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3108    2802   00B10                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3109    2803   00B10                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3110    2804   00B10                  
    3111    2805   00B10                  ;*******************************************************************************
    3112    2806   00B10                  ;
    3113    2807   00B10                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3114    2808   00B10                  ;
    3115    2809   00B10                  ;*******************************************************************************
    3116    2810   00B10                  
    3117    2811   00B10                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3118    2812   00B10                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3119    2813   00B10                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3120    2814   00B10                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3121    2815   00B10                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3122    2816   00B10                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3123    2817   00B10                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3124    2818   00B10                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3125    2819   00B10                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3126    2820   00B10                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3127    2821   00B10                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3128    2822   00B10                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3129    2823   00B10                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3130    2824   00B10                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3131    2825   00B10                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3132    2826   00B10                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3133    2827   00B10                  
    3134    2828   00B10                  ;*******************************************************************************
    3135    2829   00B10                  ;
    3136    2830   00B10                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3137    2831   00B10                  ;
    3138    2832   00B10                  ;*******************************************************************************
    3139    2833   00B10                  
    3140    2834   00B10                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3141    2835   00B10                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3142    2836   00B10                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3143    2837   00B10                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3144    2838   00B10                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3145    2839   00B10                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3146    2840   00B10                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3147    2841   00B10                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3148    2842   00B10                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3149    2843   00B10                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3150    2844   00B10                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3151    2845   00B10                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3152    2846   00B10                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3153    2847   00B10                  
    3154    2848   00B10                  ;*******************************************************************************
    3155    2849   00B10                  ;
    3156    2850   00B10                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3157    2851   00B10                  ;
    3158    2852   00B10                  ;*******************************************************************************
    3159    2853   00B10                  
    3160    2854   00B10                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3161    2855   00B10                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3162    2856   00B10                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3163    2857   00B10                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3164    2858   00B10                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3165    2859   00B10                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3166    2860   00B10                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3167    2861   00B10                  
    3168    2862   00B10                  ;*******************************************************************************
    3169    2863   00B10                  ;
    3170    2864   00B10                  ; can registers can be accessed in the standard memory map (rmap=0)
    3171    2865   00B10                  ;
    3172    2866   00B10                  ;*******************************************************************************
    3173    2867   00B10                  
    3174    2868   00B10                  adcon         data   0d8h          ;adres/data control                reset=000h
    3175    2869   00B10                  ; adcon is bit addressable
    3176    2870   00B10                         v3     bit    0dfh
    3177    2871   00B10                         v2     bit    0deh
    3178    2872   00B10                         v1     bit    0ddh
    3179    2873   00B10                         v0     bit    0dch
    3180    2874   00B10                         auad1  bit    0dbh
    3181    2875   00B10                         auad0  bit    0dah
    3182    2876   00B10                         can_bsy bit   0d9h
    3183    2877   00B10                         rwen   bit    0d8h
    3184    2878   00B10                  
    3185    2879   00B10                  adl           data   0d9h          ;adres register low                reset=000h
    3186    2880   00B10                  adh           data   0dah          ;adres register low                reset=000h
    3187    2881   00B10                  data0         data   0dbh          ;can data                          reset=000h
    3188    2882   00B10                  data1         data   0dch          ;can data                          reset=000h
    3189    2883   00B10                  data2         data   0ddh          ;can data                          reset=000h
    3190    2884   00B10                  data3         data   0deh          ;can data                          reset=000h
    3191    2885   00B10                  
    3192    2886   00B10                  ;*******************************************************************************
    3193    2887   00B10                  ;
    3194    2888   00B10                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3195    2889   00B10                  ;
    3196    2890   00B10                  ;*******************************************************************************
    3197    2891   00B10                  
    3198    2892   00B10                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3199    2893   00B10                  ;mdustat is bit addressable
    3200    2894   00B10                                                     ;5 bits are not implemented
    3201    2895   00B10                         bsy    bit    0b2h
    3202    2896   00B10                         ierr   bit    0b1h
    3203    2897   00B10                         irdy   bit    0b0h
    3204    2898   00B10                  
    3205    2899   00B10                  mducon        data   0b1h          ;mdu control                       reset=000h
    3206    2900   00B10                  md0           data   0b2h          ;mdu operand register              reset=000h
    3207    2901   00B10                  mr0           data   0b2h          ;mdu result register               reset=000h
    3208    2902   00B10                  md1           data   0b3h          ;mdu operand register              reset=000h
    3209    2903   00B10                  mr1           data   0b3h          ;mdu result register               reset=000h
    3210    2904   00B10                  md2           data   0b4h          ;mdu operand register              reset=000h
    3211    2905   00B10                  mr2           data   0b4h          ;mdu result register               reset=000h
    3212    2906   00B10                  md3           data   0b5h          ;mdu operand register              reset=000h
    3213    2907   00B10                  mr3           data   0b5h          ;mdu result register               reset=000h
    3214    2908   00B10                  md4           data   0b6h          ;mdu operand register              reset=000h
    3215    2909   00B10                  mr4           data   0b6h          ;mdu result register               reset=000h
    3216    2910   00B10                  md5           data   0b7h          ;mdu operand register              reset=000h
    3217    2911   00B10                  mr5           data   0b7h          ;mdu result register               reset=000h
    3218    2912   00B10                  
    3219    2913   00B10                  ;*******************************************************************************
    3220    2914   00B10                  ;
    3221    2915   00B10                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3222    2916   00B10                  ;
    3223    2917   00B10                  ;*******************************************************************************
    3224    2918   00B10                  
    3225    2919   00B10                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3226    2920   00B10                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3227    2921   00B10                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3228    2922   00B10                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3229    2923   00B10                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3230    2924   00B10                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3231    2925   00B10                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3232    2926   00B10                  ;cd_statc is bit addressable
    3233    2927   00B10                         keepz  bit    0a7h
    3234    2928   00B10                         keepy  bit    0a6h
    3235    2929   00B10                         keepx  bit    0a5h
    3236    2930   00B10                         dmap   bit    0a4h
    3237    2931   00B10                         int_en bit    0a3h
    3238    2932   00B10                         eoc    bit    0a2h
    3239    2933   00B10                         error  bit    0a1h
    3240    2934   00B10                         cd_bsy bit    0a0h
    3241    2935   00B10                  
    3242    2936   00B10                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3243    2937   00B10                  
    3244    2938   00B10                  ;*******************************************************************************
    3245    2939   00B10                  ;
    3246    2940   00B10                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3247    2941   00B10                  ;
    3248    2942   00B10                  ;*******************************************************************************
    3249    2943   00B10                  
    3250    2944   00B10                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3251    2945   00B10                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3252    2946   00B10                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3253    2947   00B10                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3254    2948   00B10                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3255    2949   00B10                  
    3256    2950   00B10                  ;*******************************************************************************
    3257    2951   00B10                  ;
    3258    2952   00B10                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3259    2953   00B10                  ;
    3260    2954   00B10                  ;*******************************************************************************
    3261    2955   00B10                  
    3262    2956   00B10                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3263    2957   00B10                  ;t2_t2con is bit addressable bits are aalready defined
    3264    2958   00B10                         ;tf2    bit    0c7h
    3265    2959   00B10                         ;exf2   bit    0c6h
    3266    2960   00B10                                                     ;2 bits are not implemented
    3267    2961   00B10                         ;exen2  bit    0c3h
    3268    2962   00B10                         ;tr2    bit    0c2h
    3269    2963   00B10                         ;ct2    bit    0c1h
    3270    2964   00B10                         ;cprl2  bit    0c0h
    3271    2965   00B10                  
    3272    2966   00B10                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3273    2967   00B10                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3274    2968   00B10                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3275    2969   00B10                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3276    2970   00B10                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3277    2971   00B10                  
    3278    2972   00B10                  ;*******************************************************************************
    3279    2973   00B10                  ;
    3280    2974   00B10                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3281    2975   00B10                  ;
    3282    2976   00B10                  ;*******************************************************************************
    3283    2977   00B10                  
    3284    2978   00B10                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3285    2979   00B10                  ;s1con is bit addressable
    3286    2980   00B10                         sm01   bit    0cfh
    3287    2981   00B10                         sm11   bit    0ceh
    3288    2982   00B10                         sm21   bit    0cdh
    3289    2983   00B10                         ren1   bit    0cch
    3290    2984   00B10                         tb81   bit    0cbh
    3291    2985   00B10                         rb81   bit    0cah
    3292    2986   00B10                         ti1    bit    0c9h
    3293    2987   00B10                         ri1    bit    0c8h
    3294    2988   00B10                  
    3295    2989   00B10                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3296    2990   00B10                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3297    2991   00B10                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3298    2992   00B10                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3299    2993   00B10                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3300    2994   00B10                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3301    2995   00B10                  
    3302    2996   00B10                  ;*******************************************************************************
    3303    2997   00B10                  ;
    3304    2998   00B10                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3305    2999   00B10                  ;
    3306    3000   00B10                  ;*******************************************************************************
    3307    3001   00B10                  
    3308    3002   00B10                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3309    3003   00B10                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3310    3004   00B10                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3311    3005   00B10                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3312    3006   00B10                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3313    3007   00B10                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3314    3008   00B10                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3315    3009   00B10                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3316    3010   00B10                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3317    3011   00B10                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3318    3012   00B10                  
    3319    3013   00B10                  ;end directive must be used, but has no signification
    3320    3014   00B10                  
    3321    3015   00B10                  end
    3322    3016   00B10                  
    3323    3017   00B10                  
    3324    3018   00B10                  
    3325    3019   00B10                  
    3326    3020   00B10                  
    3327    3021   00B10                  
    3328    3022   00B10                  
    3329    3023   00B10                  
    3330    3024   00B10                  
    3331    3025   00B10                  
    3332    3026   00B10                  
    3333    3027   00B10                  
    3334    3028   00B10                  
    3335    3029   00B10                  
    3336    3030   00B10                  
    3337    3031   00B10                  
