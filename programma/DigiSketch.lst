C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  tel1    equ     14h
       2       2   00000                  
       3       3   00000                  org 0000h
       4       4   00000 020003           ljmp   main
       5       5   00003                  
       6       6   00003                  ;------------------------------------------------------------------
       7       7   00003                  ;Hoofd programma
       8       8   00003                  ;------------------------------------------------------------------
       9       9   00003                  main:
      10      10   00003 75817F               mov     sp,#7fh                 ;stackpointer instellen
      11      11   00006 120027               lcall   inits
      12      12   00009 751400               mov     tel1,#00h
      13      13   0000C                  lus0:
      14      14   0000C 90002E               mov     dptr,#batman
      15      15   0000F                  lus:
      16      16   0000F 7400                 mov     a,#000h
      17      17   00011 93                   movc	a,@a+dptr
      18      18   00012 B48003               cjne    a,#10000000b,laatzien
      19      19   00015 02000C               ljmp    lus0
      20      20   00018                  laatzien:
      21      21   00018                      ;letter
      22      22   00018 F511                 mov     DATAREG,a
      23      23   0001A 120215               lcall   dataWrite
      24      24   0001D 7512C0               mov     COMANDREG,#c0h
      25      25   00020 120244               lcall   comandWrite
      26      26   00023 09                   inc     r1
      27      27   00024 02000F               ljmp    lus
      28      28   00027                  
      29      29   00027                  
      30      30   00027                  ;------------------------------------------------------------------
      31      31   00027                  ;Initializatie van alle componenten nodig in het hoofd programma
      32      32   00027                  ;------------------------------------------------------------------
      33      33   00027                  inits:
      34      34   00027 75B200               mov     port_page,#000h         ;selecteer poort page 0
      35      35   0002A 120193               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      36      36   0002D                  
      37      37   0002D 22               ret
      38      38   0002E                  
      39      39   0002E                  batman:
      40      40   0002E FFFFFFFFFFFFFFFF db  11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      41      41   00046 FCFFCFFFFFFFFFFF db  11111100b,11111111b,11001111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      42      42   0005E F1F3E3FFFFFFFFFF db  11110001b,11110011b,11100011b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      43      43   00076 C1E1E0FFFFFFFFFF db  11000001b,11100001b,11100000b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      44      44   0008E 80E1C07FFFFFFFFF db  10000000b,11100001b,11000000b,01111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      45      45   000A6 8000007FFFFFFFFF db  10000000b,00000000b,00000000b,01111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      46      46   000BE 0000003FFFFFFFFF db  00000000b,00000000b,00000000b,00111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      47      47   000D6 0000003FFFFFFFFF db  00000000b,00000000b,00000000b,00111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      48      48   000EE 8000007FFFFFFFFF db  10000000b,00000000b,00000000b,01111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      49      49   00106 8621187FFFFFFFFF db  10000110b,00100001b,00011000b,01111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      50      50   0011E CFF3FCFFFFFFFFFF db  11001111b,11110011b,11111100b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      51      51   00136 E7F3F9FFFFFFFFFF db  11100111b,11110011b,11111001b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      52      52   0014E FFFFFFFFFFFFFFFF db  11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b,11111111b
                         FFFFFFFFFFFFFFFF
                         FFFFFFFFFFFFFFFF
      53      53   00166 08               db  00001000b
      54      54   00167                  
      55      55   00167                  
      56      56   00167                  
project.inc 
      58       1   00167                  ;------------------------------------------------------------------
      59       2   00167                  ;Lijst van functies:
      60       3   00167                  ;   -statusCheck            Status check van scherm opslaan in STA register
      61       4   00167                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      62       5   00167                  ;   -debug                  debug info op seriele poot zetten
      63       6   00167                  ;------------------------------------------------------------------
      64       7   00167                  ;------------------------------------------------------------------
      65       8   00167                  ;declaratie van pinnen
      66       9   00167                  ;------------------------------------------------------------------
      67      10   00167                      WR          bit     p3_data.0   ;write line van scherm actief laag
      68      11   00167                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      69      12   00167                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      70      13   00167                      CD          bit     p3_data.3   ;Command write
      71      14   00167                      RESET       bit     p0_data.1   ;reset van scherm actief laag
      72      15   00167                      FS          bit     p0_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      73      16   00167                  
      74      17   00167                  
      75      18   00167                  
      76      19   00167                  ;------------------------------------------------------------------
      77      20   00167                  ;declaratie van registers
      78      21   00167                  ;------------------------------------------------------------------
      79      22   00167                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      80      23   00167                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      81      24   00167                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      82      25   00167                  
      83      26   00167                  
      84      27   00167                  ;------------------------------------------------------------------
      85      28   00167                  ;Status check van scherm opslaan in STA register
      86      29   00167                  ;-STA
      87      30   00167                  ;------------------------------------------------------------------
      88      31   00167                  statusCheck:
      89      32   00167 C0E0                 push    acc
      90      33   00169 C0D0                 push    psw
      91      34   0016B C210                 clr     STA                     ;STA register leeg maken
      92      35   0016D 75C900               mov     p4_dir,#000h            ;p4 als input zetten
      93      36   00170 D2B3                 setb    CD
      94      37   00172 D2B0                 setb    WR
      95      38   00174                  stan:
      96      39   00174 C2B1                 clr     RD
      97      40   00176 E5C8                 mov     a,p4_data
      98      41   00178 D2B1                 setb    RD
      99      42   0017A D2B3                 setb    CD
     100      43   0017C F8                   mov     r0,a
     101      44   0017D 12025A               lcall   debug
     102      45   00180 F510                 mov     STA,a                   ;bijhouden voor eventueel gebruik
     103      46   00182 5403                 anl     a,#03h                  ;masker voor STA0 en STA1
     104      47   00184 B403ED               cjne    a,#03h,stan
     105      48   00187 F8                   mov     r0,a
     106      49   00188 12025A               lcall   debug
     107      50   0018B 75C9FF               mov     p4_dir,#0ffh
     108      51   0018E D0D0                 pop     psw
     109      52   00190 D0E0                 pop     acc
     110      53   00192 22               ret
     111      54   00193                  
     112      55   00193                  ;------------------------------------------------------------------
     113      56   00193                  ;Initializatie van grafisch LCD scherm
     114      57   00193                  ;-Poort 1
     115      58   00193                  ;------------------------------------------------------------------
     116      59   00193                  initGLCD:
     117      60   00193 120625               lcall   initsio                 ;voor debug
     118      61   00196 7586FF               mov     p0_dir,#0ffh            ;poort 1 als output
     119      62   00199 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output
     120      63   0019C C2B2                 clr     CE
     121      64   0019E D2B0                 setb    WR
     122      65   001A0 D2B1                 setb    RD
     123      66   001A2 D280                 setb    FS                      ;font op 6*8 zetten
     124      67   001A4 C281                 clr     RESET                   ;reseten van scherm
     125      68   001A6 120405               lcall   delay1ms
     126      69   001A9 D281                 setb    RESET                   ;reset terug af zetten
     127      70   001AB 120167               lcall   statusCheck             ;initiele status check uitvoeren
     128      71   001AE                  
     129      72   001AE                      ;Mode set
     130      73   001AE 751282               mov     COMANDREG,#10000010b
     131      74   001B1 120244               lcall   comandWrite
     132      75   001B4                  
     133      76   001B4                      ;Graphics home address
     134      77   001B4 751100               mov     DATAREG,#00h
     135      78   001B7 120215               lcall   dataWrite
     136      79   001BA 751100               mov     DATAREG,#00h
     137      80   001BD 120215               lcall   dataWrite
     138      81   001C0 751242               mov     COMANDREG,#42h
     139      82   001C3 120244               lcall   comandWrite
     140      83   001C6                  
     141      84   001C6                      ;Graphics area set
     142      85   001C6 75111E               mov     DATAREG,#1eh
     143      86   001C9 120215               lcall   dataWrite
     144      87   001CC 751100               mov     DATAREG,#00h
     145      88   001CF 120215               lcall   dataWrite
     146      89   001D2 751243               mov     COMANDREG,#43h
     147      90   001D5 120244               lcall   comandWrite
     148      91   001D8                  
     149      92   001D8                      ;text home address
     150      93   001D8 751100               mov     DATAREG,#00h
     151      94   001DB 120215               lcall   dataWrite
     152      95   001DE 751100               mov     DATAREG,#00h
     153      96   001E1 120215               lcall   dataWrite
     154      97   001E4 751240               mov     COMANDREG,#40h
     155      98   001E7 120244               lcall   comandWrite
     156      99   001EA                  
     157     100   001EA                      ;text area set
     158     101   001EA 751128               mov     DATAREG,#28h
     159     102   001ED 120215               lcall   dataWrite
     160     103   001F0 751100               mov     DATAREG,#00h
     161     104   001F3 120215               lcall   dataWrite
     162     105   001F6 751241               mov     COMANDREG,#41h
     163     106   001F9 120244               lcall   comandWrite
     164     107   001FC                  
     165     108   001FC                      ;adres data pointer
     166     109   001FC 751100               mov     DATAREG,#00h            ;lower address
     167     110   001FF 120215               lcall   dataWrite
     168     111   00202 751100               mov     DATAREG,#00h
     169     112   00205 120215               lcall   dataWrite
     170     113   00208 751224               mov     COMANDREG,#24h
     171     114   0020B 120244               lcall   comandWrite
     172     115   0020E                  
     173     116   0020E                      ;Display mode
     174     117   0020E 75129F               mov     COMANDREG,#10011111b
     175     118   00211 120244               lcall   comandWrite
     176     119   00214                  
     177     120   00214 22               ret
     178     121   00215                  
     179     122   00215                  ;------------------------------------------------------------------
     180     123   00215                  ;Data naar het schem sturen
     181     124   00215                  ;-DATAREG
     182     125   00215                  ;------------------------------------------------------------------
     183     126   00215                  DataWrite:
     184     127   00215 C0E0                 push    acc
     185     128   00217 C0D0                 push    psw
     186     129   00219 120167               lcall   statusCheck             ;status checken
     187     130   0021C 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     188     131   0021F C2B3                 clr     CD
     189     132   00221 00                   nop
     190     133   00222 C2B0                 clr     WR
     191     134   00224 00                   nop
     192     135   00225 D2B0                 setb    WR
     193     136   00227 D0D0                 pop     psw
     194     137   00229 D0E0                 pop     acc
     195     138   0022B 22               ret
     196     139   0022C                  
     197     140   0022C                  ;------------------------------------------------------------------
     198     141   0022C                  ;data van het scherm inlezen
     199     142   0022C                  ;-DATAREG
     200     143   0022C                  ;------------------------------------------------------------------
     201     144   0022C                  DataRead:
     202     145   0022C C0E0                 push    acc
     203     146   0022E C0D0                 push    psw
     204     147   00230 120167               lcall   statusCheck             ;status checken
     205     148   00233 75C900               mov     p4_dir,#000h            ;p4 als ingang
     206     149   00236 C2B3                 clr     CD
     207     150   00238 C2B1                 clr     RD
     208     151   0023A 00                   nop                             ;wachten
     209     152   0023B 00                   nop
     210     153   0023C 85C811               mov     DATAREG,p4_data         ;data inlezeen van scherm
     211     154   0023F D0D0                 pop     psw
     212     155   00241 D0E0                 pop     acc
     213     156   00243 22               ret
     214     157   00244                  
     215     158   00244                  ;------------------------------------------------------------------
     216     159   00244                  ;comando naar het scherrm sturen
     217     160   00244                  ;-COMANDREG
     218     161   00244                  ;------------------------------------------------------------------
     219     162   00244                  ComandWrite:
     220     163   00244 C0E0                 push    acc
     221     164   00246 C0D0                 push    psw
     222     165   00248 120167               lcall   statusCheck             ;status checken
     223     166   0024B 8512C8               mov     p4_data,COMANDREG       ;comando op de bus zetten
     224     167   0024E D2B3                 setb    CD
     225     168   00250 C2B0                 clr     WR
     226     169   00252 00                   nop
     227     170   00253 D2B0                 setb    WR
     228     171   00255 D0D0                 pop     psw
     229     172   00257 D0E0                 pop     acc
     230     173   00259 22               ret
     231     174   0025A                  
     232     175   0025A                  ;------------------------------------------------------------------
     233     176   0025A                  ;debug info op seriele poort zetten
     234     177   0025A                  ;-r0
     235     178   0025A                  ;------------------------------------------------------------------
     236     179   0025A                  debug:
     237     180   0025A C0E0                 push    acc
     238     181   0025C C0D0                 push    psw
     239     182   0025E 740D                 mov     a,#0dh
     240     183   00260 12065D               lcall   siooutchar
     241     184   00263 E8                   mov     a,r0
     242     185   00264 120679               lcall   siooutbyte
     243     186   00267 740A                 mov     a,#0ah
     244     187   00269 12065D               lcall   siooutchar
     245     188   0026C D0D0                 pop     psw
     246     189   0026E D0E0                 pop     acc
     247     190   00270 22               ret
     248     191   00271                  
     249     192   00271                  
     250     193   00271                  
     251     194   00271                  
xcez1.inc 
     253       1   00271                  ;*******************************************************************************
     254       2   00271                  ;
     255       3   00271                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     256       4   00271                  ;
     257       5   00271                  ; The file contains drivers for various hardware and math applications.
     258       6   00271                  ; In addition all register declarations are added.
     259       7   00271                  ;
     260       8   00271                  ; WARNING:!!!!!!!
     261       9   00271                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     262      10   00271                  ;
     263      11   00271                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     264      12   00271                  ;
     265      13   00271                  ;*******************************************************************************
     266      14   00271                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     267      15   00271                  ;
     268      16   00271                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     269      17   00271                  ;
     270      18   00271                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     271      19   00271                  ; eenvoudige manier te gebruiken:
     272      20   00271                  ;
     273      21   00271                  ; standaard I/O:
     274      22   00271                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     275      23   00271                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     276      24   00271                  ;      initleds             klaar zetten LED's als outputs
     277      25   00271                  ;
     278      26   00271                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     279      27   00271                  ;      initiic              klaar zetten iic interface
     280      28   00271                  ;      iicstart             genereren van een startconditie op iic poort
     281      29   00271                  ;      iicstop              genereren stop conditie op iic poort
     282      30   00271                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     283      31   00271                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     284      32   00271                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     285      33   00271                  ;
     286      34   00271                  ; LCD interace
     287      35   00271                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     288      36   00271                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     289      37   00271                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     290      38   00271                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     291      39   00271                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     292      40   00271                  ;      lcdlighton           backlight aan
     293      41   00271                  ;      lcdlightoff          backlight uit
     294      42   00271                  ;      lcdbuzon             buzzer aan
     295      43   00271                  ;      lcdbuzof             buzzer uit
     296      44   00271                  ;
     297      45   00271                  ; Seriële interface (via USB stekker!!)
     298      46   00271                  ;      initsio              klaar zetten seriële poort 9600 baud
     299      47   00271                  ;      siooutchar           afdrukken ascii code (accu=input)
     300      48   00271                  ;      siooutbyte           afdrkken getal in accu
     301      49   00271                  ;      siooutnib            afdrukken 4 laagste bits accu
     302      50   00271                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     303      51   00271                  ;      sioinchar            inlezen van 1 ascii code in de accu
     304      52   00271                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     305      53   00271                  ;
     306      54   00271                  ; ADC
     307      55   00271                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     308      56   00271                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     309      57   00271                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     310      58   00271                  ;
     311      59   00271                  ; Arithmetic:
     312      60   00271                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     313      61   00271                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     314      62   00271                  ;      div16                delen 2 16 bit getallen
     315      63   00271                  ;      div32                delen 2 32 bit getallen
     316      64   00271                  ;      add16                optellen 2 16 bit getallen
     317      65   00271                  ;      add32                optellen 2 32 bit getallen
     318      66   00271                  ;      sub16                verschil 2 16 bit getallen
     319      67   00271                  ;      sub32                verschil 2 32 bit getallen
     320      68   00271                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     321      69   00271                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     322      70   00271                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     323      71   00271                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     324      72   00271                  ;
     325      73   00271                  ; Diverse
     326      74   00271                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     327      75   00271                  ;      delay1ms             tijdsverraging 1 milliseconde
     328      76   00271                  ;      delay10us            tijdsvertraging 10 microseconde
     329      77   00271                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     330      78   00271                  ;	mapregs 		selecteer de SFR's in de mapped area
     331      79   00271                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     332      80   00271                  ;
     333      81   00271                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     334      82   00271                  ; LET OP!!!!
     335      83   00271                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     336      84   00271                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     337      85   00271                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     338      86   00271                  ;
     339      87   00271                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     340      88   00271                  ;
     341      89   00271                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     342      90   00271                  
     343      91   00271                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     344      92   00271                  ;
     345      93   00271                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     346      94   00271                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     347      95   00271                  ; massa zonder extra weerstanden.
     348      96   00271                  ;
     349      97   00271                  ; Gebruikt geen registers
     350      98   00271                  ;
     351      99   00271                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     352     100   00271                  
     353     101   00271 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     354     102   00273 758F04                         mov    syscon0,#004h
     355     103   00276 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     356     104   00278 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     357     105   0027B 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     358     106   0027E 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     359     107   00281 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     360     108   00284 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     361     109   00287 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     362     110   00289 D08F                           pop    syscon0              ;pagina terug herstellen
     363     111   0028B 22                             ret
     364     112   0028C                  
     365     113   0028C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     366     114   0028C                  ;
     367     115   0028C                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     368     116   0028C                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     369     117   0028C                  ; 2 behouden hun originele instelling.
     370     118   0028C                  ;
     371     119   0028C                  ; Gebruikt geen registers
     372     120   0028C                  ;
     373     121   0028C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     374     122   0028C                  
     375     123   0028C C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     376     124   0028E 758F04                         mov    syscon0,#004h
     377     125   00291 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     378     126   00293 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     379     127   00296 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     380     128   00299 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     381     129   0029C 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     382     130   0029F 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     383     131   002A2 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     384     132   002A4 D08F                           pop    syscon0              ;pagina terug herstellen
     385     133   002A6 22                             ret
     386     134   002A7                  
     387     135   002A7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     388     136   002A7                  ;
     389     137   002A7                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     390     138   002A7                  ; worden gedoofd (actief laag om ze te laden branden).
     391     139   002A7                  ;
     392     140   002A7                  ; Gebruikt geen registers
     393     141   002A7                  ;
     394     142   002A7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     395     143   002A7                  
     396     144   002A7                  
     397     145   002A7 C08F             initleds:     push   syscon0              ;juiste map selecteren
     398     146   002A9 758F04                         mov    syscon0,#004h
     399     147   002AC C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     400     148   002AE 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     401     149   002B1 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     402     150   002B4 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     403     151   002B6 D08F                           pop    syscon0              ;pagina terug herstellen
     404     152   002B8 22                             ret
     405     153   002B9                  
     406     154   002B9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     407     155   002B9                  ;
     408     156   002B9                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     409     157   002B9                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     410     158   002B9                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     411     159   002B9                  ; sda wordt als input geschakeld
     412     160   002B9                  ;
     413     161   002B9                  ; LET OP!!
     414     162   002B9                  ; Dit is een IIC bus met beperkte mogelijkheden:
     415     163   002B9                  ; -vaste communicatiesnleheid van 100kbit/s
     416     164   002B9                  ; -enkel master mode
     417     165   002B9                  ; -enkel 7 bit adressering
     418     166   002B9                  ; -geen klok stretching
     419     167   002B9                  ;
     420     168   002B9                  ; Gebruikt geen registers
     421     169   002B9                  ;
     422     170   002B9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     423     171   002B9                  
     424     172   002B9                  sda           bit    p0_data.7            ;pin gebruikt als sda
     425     173   002B9                  scl           bit    p0_data.3            ;pin gebruikt als scl
     426     174   002B9                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     427     175   002B9                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     428     176   002B9                  
     429     177   002B9 C08F             initiic:      push   syscon0              ;juiste map selecteren
     430     178   002BB 758F04                         mov    syscon0,#004h
     431     179   002BE C0B2                           push   port_page
     432     180   002C0 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     433     181   002C3 D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     434     182   002C5 D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     435     183   002C7 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     436     184   002CA D283                           setb   scl                  ;klok werkt als od
     437     185   002CC D287                           setb   sda                  ;sda werkt als od
     438     186   002CE 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     439     187   002D1 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     440     188   002D4 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     441     189   002D7 D0B2                           pop    port_page            ;pagina herstellen
     442     190   002D9 D08F                           pop    syscon0              ;map herstellen
     443     191   002DB 22                             ret
     444     192   002DC                  
     445     193   002DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     446     194   002DC                  ;
     447     195   002DC                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     448     196   002DC                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     449     197   002DC                  ; te garanderen volgt er een delay van 10us
     450     198   002DC                  ;
     451     199   002DC                  ; Gebruikt geen registers
     452     200   002DC                  ;
     453     201   002DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     454     202   002DC                  
     455     203   002DC C08F             iicstart:     push   syscon0              ;map bewaren
     456     204   002DE 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     457     205   002E1 C0B2                           push   port_page            ;pagina bewaren
     458     206   002E3 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     459     207   002E6 D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     460     208   002E8 D287                           setb   sda                  ;idem
     461     209   002EA 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     462     210   002ED 1203DD                         lcall  delay10us            ;
     463     211   002F0 C287                           clr    sda                  ;data laag
     464     212   002F2 1203DD                         lcall  delay10us
     465     213   002F5 C283                           clr    scl                  ;dan klok laag
     466     214   002F7 1203DD                         lcall  delay10us            ;bit lang genoeg maken
     467     215   002FA D0B2                           pop    port_page            ;registers herstellen
     468     216   002FC D08F                           pop    syscon0
     469     217   002FE 22                             ret
     470     218   002FF                  
     471     219   002FF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     472     220   002FF                  ;
     473     221   002FF                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     474     222   002FF                  ;
     475     223   002FF                  ; Gebruikt geen registers
     476     224   002FF                  ;
     477     225   002FF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     478     226   002FF                  
     479     227   002FF C08F             iicstop:      push   syscon0              ;map bewaren
     480     228   00301 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     481     229   00304 C0B2                           push   port_page            ;pagina bewaren
     482     230   00306 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     483     231   00309 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     484     232   0030C C287                           clr    sda                  ;data naar omlaag
     485     233   0030E 1203DD                         lcall  delay10us
     486     234   00311 D283                           setb   scl                  ;klok naar 1
     487     235   00313 1203DD                         lcall  delay10us            ;wachten
     488     236   00316 D287                           setb   sda                  ;idem data
     489     237   00318 1203DD                         lcall  delay10us            ;
     490     238   0031B 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     491     239   0031E D0B2                           pop    port_page            ;registers herstellen
     492     240   00320 D08F                           pop    syscon0
     493     241   00322 22                             ret
     494     242   00323                  
     495     243   00323                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     496     244   00323                  ;
     497     245   00323                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     498     246   00323                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     499     247   00323                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     500     248   00323                  ;
     501     249   00323                  ; Gebruikt:
     502     250   00323                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     503     251   00323                  ;      cy=ack bit vanuit de slave
     504     252   00323                  ;
     505     253   00323                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     506     254   00323                  
     507     255   00323 C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     508     256   00325 C0F0                           push   b                    ;gebruikt als loopcounter
     509     257   00327 C08F                           push   syscon0              ;map juist zetten
     510     258   00329 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     511     259   0032C C0B2                           push   port_page            ;poort pagina bewaren
     512     260   0032E 75B200                         mov    port_page,#000h      ;basispagina selecteren
     513     261   00331 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     514     262   00334 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     515     263   00337 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     516     264   00338 9287                           mov    sda,c                ;op pin
     517     265   0033A 1203DD                         lcall  delay10us            ;wachten
     518     266   0033D D283                           setb   scl                  ;puls genereren
     519     267   0033F 1203DD                         lcall  delay10us            ;ook hier wat tijd laten
     520     268   00342 C283                           clr    scl                  ;klok terug laag maken
     521     269   00344 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     522     270   00347                  
     523     271   00347                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     524     272   00347                  
     525     273   00347 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     526     274   0034A 1203DD                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     527     275   0034D D283                           setb   scl                  ;puls terug hoog
     528     276   0034F A287                           mov    c,sda                ;inlezen en naar carry
     529     277   00351 1203DD                         lcall  delay10us
     530     278   00354 C283                           clr    scl                  ;klok blijft laag achter
     531     279   00356 D0B2                           pop    port_page
     532     280   00358 D08F                           pop    syscon0
     533     281   0035A D0F0                           pop    b
     534     282   0035C D0E0                           pop    acc
     535     283   0035E 22                             ret
     536     284   0035F                  
     537     285   0035F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     538     286   0035F                  ;
     539     287   0035F                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     540     288   0035F                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     541     289   0035F                  ;
     542     290   0035F                  ; Gebruikt:
     543     291   0035F                  ;      -de accu als output
     544     292   0035F                  ;
     545     293   0035F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     546     294   0035F                  
     547     295   0035F C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     548     296   00361 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     549     297   00364 C0B2                           push   port_page            ;pagina bewaren
     550     298   00366 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     551     299   00369 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     552     300   0036B C0D0                           push   psw                  ;vlaggen bewaren
     553     301   0036D 75F008                         mov    b,#008h              ;loopcounter laden
     554     302   00370 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     555     303   00373 1203DD           iicinbyteack1:lcall  delay10us
     556     304   00376 D283                           setb   scl                  ;klok hoog
     557     305   00378 A287                           mov    c,sda                ;pin inlezen
     558     306   0037A 33                             rlc    a                    ;in accu shiften
     559     307   0037B 1203DD                         lcall  delay10us
     560     308   0037E C283                           clr    scl                  ;klok terug laag
     561     309   00380 D5F0F0                         djnz   b,iicinbyteack1
     562     310   00383 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     563     311   00386 C287                           clr    sda                  ;ack genereren
     564     312   00388 1203DD                         lcall  delay10us
     565     313   0038B D283                           setb   scl
     566     314   0038D 1203DD                         lcall  delay10us
     567     315   00390 C283                           clr    scl
     568     316   00392 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     569     317   00395 D0D0                           pop    psw                  ;registers herstellen
     570     318   00397 D0F0                           pop    b
     571     319   00399 D0B2                           pop    port_page
     572     320   0039B D08F                           pop    syscon0
     573     321   0039D 22                             ret
     574     322   0039E                  
     575     323   0039E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     576     324   0039E                  ;
     577     325   0039E                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     578     326   0039E                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     579     327   0039E                  ;
     580     328   0039E                  ; Gebruikt:
     581     329   0039E                  ;      -de accu als output
     582     330   0039E                  ;
     583     331   0039E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     584     332   0039E                  
     585     333   0039E C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     586     334   003A0 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     587     335   003A3 C0B2                           push   port_page            ;pagina bewaren
     588     336   003A5 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     589     337   003A8 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     590     338   003AA C0D0                           push   psw                  ;vlaggen bewaren
     591     339   003AC 75F008                         mov    b,#008h              ;loopcounter laden
     592     340   003AF 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     593     341   003B2 1203DD           iicinbytenack1:lcall  delay10us
     594     342   003B5 D283                           setb   scl                  ;klok hoog
     595     343   003B7 A287                           mov    c,sda                ;pin inlezen
     596     344   003B9 33                             rlc    a                    ;in accu shiften
     597     345   003BA 1203DD                         lcall  delay10us
     598     346   003BD C283                           clr    scl                  ;klok terug laag
     599     347   003BF D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     600     348   003C2 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     601     349   003C5 D287                           setb   sda                  ;nack genereren
     602     350   003C7 1203DD                         lcall  delay10us
     603     351   003CA D283                           setb   scl
     604     352   003CC 1203DD                         lcall  delay10us
     605     353   003CF C283                           clr    scl
     606     354   003D1 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     607     355   003D4 D0D0                           pop    psw                  ;registers herstellen
     608     356   003D6 D0F0                           pop    b
     609     357   003D8 D0B2                           pop    port_page
     610     358   003DA D08F                           pop    syscon0
     611     359   003DC 22                             ret
     612     360   003DD                  
     613     361   003DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     614     362   003DD                  ;
     615     363   003DD                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     616     364   003DD                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     617     365   003DD                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     618     366   003DD                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     619     367   003DD                  ;
     620     368   003DD                  ; Gebruikt geen registers
     621     369   003DD                  ;
     622     370   003DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     623     371   003DD                  
     624     372   003DD C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     625     373   003DF C0D0                           push   psw                  ;8*42ns=330ns
     626     374   003E1 75E01A                         mov    acc,#01ah            ;420ns
     627     375   003E4 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     628     376   003E7 D0D0                           pop    psw                  ;8*42ns=330ns
     629     377   003E9 D0E0                           pop    acc                  ;8*42ns=330ns
     630     378   003EB 22                             ret                         ;165ns
     631     379   003EC                  
     632     380   003EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     633     381   003EC                  ;
     634     382   003EC                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     635     383   003EC                  ;
     636     384   003EC                  ; Gebruikt geen registers
     637     385   003EC                  ;
     638     386   003EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     639     387   003EC                  
     640     388   003EC C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     641     389   003EE C0D0                           push   psw
     642     390   003F0 C0F0                           push   b
     643     391   003F2 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     644     392   003F5 120405           delaya0k05s1: lcall  delay1ms
     645     393   003F8 D5F0FA                         djnz   b,delaya0k05s1
     646     394   003FB D5E0F4                         djnz   acc,delaya0k05s2
     647     395   003FE D0F0                           pop    b                    ;registers herstellen
     648     396   00400 D0D0                           pop    psw
     649     397   00402 D0E0                           pop    acc
     650     398   00404 22                             ret
     651     399   00405                  
     652     400   00405                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     653     401   00405                  ;
     654     402   00405                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     655     403   00405                  ;
     656     404   00405                  ; Gebruikt geen registers
     657     405   00405                  ;
     658     406   00405                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     659     407   00405                  
     660     408   00405 C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     661     409   00407 C0D0                           push   psw                  ;8*42ns=330ns
     662     410   00409 75E064                         mov    acc,#100             ;420ns
     663     411   0040C 1203DD           delay1ms1:    lcall  delay10us            ;10us
     664     412   0040F D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     665     413   00412 D0D0                           pop    psw                  ;8*42ns=330ns
     666     414   00414 D0E0                           pop    acc                  ;8*42ns=330ns
     667     415   00416 22                             ret                         ;165ns
     668     416   00417                  
     669     417   00417                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     670     418   00417                  ;
     671     419   00417                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     672     420   00417                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     673     421   00417                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     674     422   00417                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     675     423   00417                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     676     424   00417                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     677     425   00417                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     678     426   00417                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     679     427   00417                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     680     428   00417                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     681     429   00417                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     682     430   00417                  ; systemen!!!!
     683     431   00417                  ;
     684     432   00417                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     685     433   00417                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     686     434   00417                  ;       aduclcd0.inc
     687     435   00417                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     688     436   00417                  ;       aduclcd1.inc
     689     437   00417                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     690     438   00417                  ;
     691     439   00417                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     692     440   00417                  
     693     441   00417                  e             bit    b.1                  ;enable
     694     442   00417                  rs            bit    b.0                  ;register select
     695     443   00417                  backlight     bit    b.6                  ;bit waar backlight op zit
     696     444   00417                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     697     445   00417                  
     698     446   00417                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     699     447   00417                  
     700     448   00417                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     701     449   00417                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     702     450   00417                  
     703     451   00417                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     704     452   00417                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     705     453   00417                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     706     454   00417                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     707     455   00417                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     708     456   00417                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     709     457   00417                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     710     458   00417                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     711     459   00417                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     712     460   00417                  
     713     461   00417                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     714     462   00417                  ;
     715     463   00417                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     716     464   00417                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     717     465   00417                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     718     466   00417                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     719     467   00417                  ;
     720     468   00417                  ; registergebruik: geen
     721     469   00417                  ;
     722     470   00417                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     723     471   00417                  
     724     472   00417 C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     725     473   00419 C0D0                           push   psw
     726     474   0041B C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     727     475   0041D 1202B9                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     728     476   00420 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     729     477   00423                                                            ;buzzer en baklight worden nu op 1 gezet
     730     478   00423 1205BB                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     731     479   00426 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     732     480   00428 1205B4           initlcd1:     lcall  delay2ms
     733     481   0042B D5E0FA                         djnz   acc,initlcd1
     734     482   0042E 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     735     483   00430 120573                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     736     484   00433 1205B4                         lcall  delay2ms      ;te krijgen.
     737     485   00436 7430                           mov    a,#00110000b
     738     486   00438 120573                         lcall  outhnibc
     739     487   0043B 1205B4                         lcall  delay2ms
     740     488   0043E 7430                           mov    a,#00110000b
     741     489   00440 120573                         lcall  outhnibc
     742     490   00443 1205B4                         lcall  delay2ms
     743     491   00446 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     744     492   00448 120573                         lcall  outhnibc      ;hoge nibble naar het controleregister
     745     493   0044B 1205B4                         lcall  delay2ms      ;niet nodig volgens datasheet
     746     494   0044E 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     747     495   00450 12055D                         lcall  outc          ;naar display
     748     496   00453 1205B4                         lcall  delay2ms      ;is iets te lang volgens datasheet
     749     497   00456 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     750     498   00458 12055D                         lcall  outc
     751     499   0045B 1205B4                         lcall  delay2ms      ;ook deze delay is iets te lang
     752     500   0045E 7401                           mov    a,#displayon  ;clear display and home cursor
     753     501   00460 12055D                         lcall  outc
     754     502   00463 1205B4                         lcall  delay2ms      ;deze wachttijd is bijna juist
     755     503   00466 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     756     504   00468 12055D                         lcall  outc
     757     505   0046B 1205B4                         lcall  delay2ms      ;wachten weer veel te lang
     758     506   0046E D0F0                           pop    b             ;registers terug in orde zetten
     759     507   00470 D0D0                           pop    psw
     760     508   00472 D0E0                           pop    acc
     761     509   00474 22                             ret                  ;einde van de initialisatie
     762     510   00475                  
     763     511   00475                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     764     512   00475                  ;
     765     513   00475                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     766     514   00475                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     767     515   00475                  ;      00dh   =cursor in de home positie
     768     516   00475                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     769     517   00475                  ;      00ah   =cursor op tweede lijn plaatsen
     770     518   00475                  ;      001h   =cursor on blink
     771     519   00475                  ;      002h   =cursor on, no blink
     772     520   00475                  ;      003h   =cursor off
     773     521   00475                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     774     522   00475                  ;
     775     523   00475                  ; de routine gebruikt geen registers
     776     524   00475                  ;
     777     525   00475                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     778     526   00475                  
     779     527   00475                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     780     528   00475                  ; dan mag de data direct naar het dataregister van het scherm.
     781     529   00475                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     782     530   00475                  
     783     531   00475                  lcdoutchar:
     784     532   00475 C0E0             outcharlcd:   push   acc           ;registers op stack
     785     533   00477 C0D0                           push   psw
     786     534   00479 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     787     535   0047C 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     788     536   0047E B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     789     537   00481 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     790     538   00483                  
     791     539   00483                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     792     540   00483                  ; Het is dus een opdracht die we moeten uitvoeren.
     793     541   00483                  
     794     542   00483 B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     795     543   00486 7401                           mov    a,#cleardisp         ;scherm leegmaken
     796     544   00488 12055D                         lcall  outc                 ;naar controleregister
     797     545   0048B 803A                           sjmp   outcharlcde          ;afsluiten
     798     546   0048D                  
     799     547   0048D B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     800     548   00490 740F                           mov    a,#cursoronb         ;cursoron met blink
     801     549   00492 12055D                         lcall  outc
     802     550   00495 8030                           sjmp   outcharlcde
     803     551   00497                  
     804     552   00497 B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     805     553   0049A 740E                           mov    a,#cursoronn         ;cursoron no blink
     806     554   0049C 12055D                         lcall  outc
     807     555   0049F 8026                           sjmp   outcharlcde
     808     556   004A1                  
     809     557   004A1 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     810     558   004A4 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     811     559   004A6 12055D                         lcall  outc
     812     560   004A9 801C                           sjmp   outcharlcde
     813     561   004AB                  
     814     562   004AB B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     815     563   004AE 7402                           mov    a,#cursathom         ;cursor in home positie
     816     564   004B0 12055D                         lcall  outc
     817     565   004B3 8012                           sjmp   outcharlcde
     818     566   004B5                  
     819     567   004B5 B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     820     568   004B8                                                            ;tweede lijn
     821     569   004B8 74C0                           mov    a,#0c0h
     822     570   004BA 12055D                         lcall  outc
     823     571   004BD 8008                           sjmp   outcharlcde
     824     572   004BF                  
     825     573   004BF                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     826     574   004BF                  ; is. dit mag naar het data register.
     827     575   004BF                  
     828     576   004BF 120523           outcharlcd8:  lcall  outd          ;klaar
     829     577   004C2 8003                           sjmp   outcharlcde   ;einde routine
     830     578   004C4                  
     831     579   004C4                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     832     580   004C4                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     833     581   004C4                  ; te schrijven.
     834     582   004C4                  
     835     583   004C4 12055D           outcharlcd9:  lcall  outc          ;klaar
     836     584   004C7 D0D0             outcharlcde:  pop    psw           ;registers herstellen
     837     585   004C9 D0E0                           pop    acc
     838     586   004CB 22                             ret
     839     587   004CC                  
     840     588   004CC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     841     589   004CC                  ;
     842     590   004CC                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     843     591   004CC                  ; op het lcd scherm.
     844     592   004CC                  ;
     845     593   004CC                  ; de routine gebruikt geen registers
     846     594   004CC                  ;
     847     595   004CC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     848     596   004CC                  
     849     597   004CC                  lcdoutnib:
     850     598   004CC C0E0             outniblcd:    push   acc           ;registers op stack zetten
     851     599   004CE C0D0                           push   psw
     852     600   004D0 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     853     601   004D2 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     854     602   004D4 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     855     603   004D7 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     856     604   004D9 2407                           add    a,#007h       ;omvormen naar hoofdletter
     857     605   004DB 120523           outniblcde:   lcall  outd          ;naar het scherm
     858     606   004DE D0D0                           pop    psw
     859     607   004E0 D0E0                           pop    acc
     860     608   004E2 22                             ret
     861     609   004E3                  
     862     610   004E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     863     611   004E3                  ;
     864     612   004E3                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     865     613   004E3                  ;
     866     614   004E3                  ; de routine gebruikt geen registers
     867     615   004E3                  ;
     868     616   004E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     869     617   004E3                  
     870     618   004E3                  lcdoutbyte:
     871     619   004E3 C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     872     620   004E5 C0D0                           push   psw
     873     621   004E7 C4                             swap   a             ;bitjes omruilen
     874     622   004E8 1204CC                         lcall  outniblcd
     875     623   004EB C4                             swap   a             ;nog eens
     876     624   004EC 1204CC                         lcall  outniblcd
     877     625   004EF D0D0                           pop    psw
     878     626   004F1 D0E0                           pop    acc
     879     627   004F3 22                             ret
     880     628   004F4                  
     881     629   004F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     882     630   004F4                  ;
     883     631   004F4                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     884     632   004F4                  ;
     885     633   004F4                  ; de routine gebruikt geen registers
     886     634   004F4                  ;
     887     635   004F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     888     636   004F4                  
     889     637   004F4                  lcddispdptr:
     890     638   004F4 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     891     639   004F6 C0D0                           push   psw
     892     640   004F8 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     893     641   004FA 1204E3                         lcall  outbytelcd
     894     642   004FD E582                           mov    a,dpl         ;dan het lage deel
     895     643   004FF 1204E3                         lcall  outbytelcd
     896     644   00502 D0D0                           pop    psw
     897     645   00504 D0E0                           pop    acc
     898     646   00506 22                             ret
     899     647   00507                  
     900     648   00507                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     901     649   00507                  ;
     902     650   00507                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     903     651   00507                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     904     652   00507                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     905     653   00507                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     906     654   00507                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     907     655   00507                  ;
     908     656   00507                  ; de routine gebruikt geen registers
     909     657   00507                  ;
     910     658   00507                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     911     659   00507                  
     912     660   00507                  lcdoutmsga:
     913     661   00507 C0E0             outmsgalcd:   push   acc           ;registers op de stack
     914     662   00509 C0D0                           push   psw
     915     663   0050B C083                           push   dph           ;ook de data pointer
     916     664   0050D C082                           push   dpl
     917     665   0050F                  
     918     666   0050F                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     919     667   0050F                  
     920     668   0050F E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     921     669   00510 93                             movc   a,@a+dptr     ;waarde lezen
     922     670   00511 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     923     671   00513                  
     924     672   00513                  ; de code is niet 0 dus versturen met outchar
     925     673   00513                  
     926     674   00513 120475                         lcall  outcharlcd    ;weg er mee
     927     675   00516 A3                             inc    dptr          ;naar volgende ascii code wijzen
     928     676   00517 02050F                         ljmp   outmsgalcd1   ;lus sluiten
     929     677   0051A                  
     930     678   0051A D082             outmsgalcde:  pop    dpl           ;registers herstellen
     931     679   0051C D083                           pop    dph
     932     680   0051E D0D0                           pop    psw
     933     681   00520 D0E0                           pop    acc
     934     682   00522 22                             ret
     935     683   00523                  
     936     684   00523                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     937     685   00523                  ;
     938     686   00523                  ; outd is een routine die naar het data register van het display een
     939     687   00523                  ; volledige byte stuurt.
     940     688   00523                  ;
     941     689   00523                  ; De routine gebruikt geen registers.
     942     690   00523                  ;
     943     691   00523                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     944     692   00523                  
     945     693   00523 C0E0             outd:         push   acc           ;registers op stack zetten
     946     694   00525 C0D0                           push   psw
     947     695   00527 120533                         lcall  outhnibd      ;hoogste vier bits verzenden
     948     696   0052A C4                             swap   a             ;bitjes omruilen
     949     697   0052B 120533                         lcall  outhnibd      ;naar het scherm sturen
     950     698   0052E D0D0                           pop    psw           ;registers terug herstellen
     951     699   00530 D0E0                           pop    acc
     952     700   00532 22                             ret
     953     701   00533                  
     954     702   00533                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     955     703   00533                  ;
     956     704   00533                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
     957     705   00533                  ; lcd scherm.
     958     706   00533                  ;
     959     707   00533                  ; de routine gebruikt geen registers.
     960     708   00533                  ;
     961     709   00533                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     962     710   00533                  
     963     711   00533 C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
     964     712   00535 C0D0                           push   psw
     965     713   00537 C0F0                           push   b             ;werkregister
     966     714   00539 1205D4                         lcall  lcdtoport     ;lees de expander naar b register
     967     715   0053C D2F0                           setb   rs            ;controle lijn in orde
     968     716   0053E C2F1                           clr    e             ;deselectie display
     969     717   00540 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
     970     718   00542 03                             rr     a             ;bits op juiste plaats zetten
     971     719   00543 03                             rr     a             ;voor b reg
     972     720   00544 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
     973     721   00547 42F0                           orl    b,a           ;bij elkaar voegen
     974     722   00549 1205BB                         lcall  porttolcd     ;naar expnder
     975     723   0054C D2F1                           setb   e             ;display enabelen
     976     724   0054E 1205BB                         lcall  porttolcd
     977     725   00551 C2F1                           clr    e             ;display deselecteren
     978     726   00553 1205BB                         lcall  porttolcd
     979     727   00556 D0F0                           pop    b
     980     728   00558 D0D0                           pop    psw           ;registers herstellen
     981     729   0055A D0E0                           pop    acc
     982     730   0055C 22                             ret
     983     731   0055D                  
     984     732   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     985     733   0055D                  ;
     986     734   0055D                  ; outc is een routine die naar het controleregister van het display een
     987     735   0055D                  ; volledige byte stuurt.
     988     736   0055D                  ;
     989     737   0055D                  ; De routine gebruikt geen registers.
     990     738   0055D                  ;
     991     739   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     992     740   0055D                  
     993     741   0055D C0E0             outc:         push   acc           ;registers op stack zetten
     994     742   0055F C0D0                           push   psw
     995     743   00561 120573                         lcall  outhnibc      ;hoogste vier bits verzenden
     996     744   00564 1205B4                         lcall  delay2ms      ;niet echt nodig
     997     745   00567 C4                             swap   a             ;bitjes omruilen
     998     746   00568 120573                         lcall  outhnibc      ;naar het scherm sturen
     999     747   0056B 1205B4                         lcall  delay2ms      ;altijd goed voor traagste commando
    1000     748   0056E D0D0                           pop    psw           ;registers terug herstellen
    1001     749   00570 D0E0                           pop    acc
    1002     750   00572 22                             ret
    1003     751   00573                  
    1004     752   00573                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1005     753   00573                  ;
    1006     754   00573                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1007     755   00573                  ; lcd scherm.
    1008     756   00573                  ;
    1009     757   00573                  ; de routine gebruikt geen registers.
    1010     758   00573                  ;
    1011     759   00573                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1012     760   00573                  
    1013     761   00573 C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1014     762   00575 C0D0                           push   psw
    1015     763   00577 C0F0                           push   b             ;werkregister
    1016     764   00579 1205D4                         lcall  lcdtoport     ;lees de expander naar b register
    1017     765   0057C C2F0                           clr    rs            ;controle lijn in orde
    1018     766   0057E C2F1                           clr    e             ;deselectie display
    1019     767   00580 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1020     768   00582 03                             rr     a             ;bits op juiste plaats zetten
    1021     769   00583 03                             rr     a             ;voor b reg
    1022     770   00584 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1023     771   00587 42F0                           orl    b,a           ;bij elkaar voegen
    1024     772   00589 1205BB                         lcall  porttolcd     ;naar expnder
    1025     773   0058C D2F1                           setb   e             ;display enabelen
    1026     774   0058E 1205BB                         lcall  porttolcd
    1027     775   00591 C2F1                           clr    e             ;display deselecteren
    1028     776   00593 1205BB                         lcall  porttolcd
    1029     777   00596 D0F0                           pop    b
    1030     778   00598 D0D0                           pop    psw           ;registers herstellen
    1031     779   0059A D0E0                           pop    acc
    1032     780   0059C 22                             ret
    1033     781   0059D                  
    1034     782   0059D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1035     783   0059D                  ;
    1036     784   0059D                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1037     785   0059D                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1038     786   0059D                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1039     787   0059D                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1040     788   0059D                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1041     789   0059D                  ; DATA GESCHREVEN.
    1042     790   0059D                  ;
    1043     791   0059D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1044     792   0059D                  
    1045     793   0059D 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1046     794   0059F 12055D           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1047     795   005A2 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1048     796   005A4 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1049     797   005A5 120523                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1050     798   005A8 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1051     799   005AB A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1052     800   005AC 80F4                           SJMP   BUILD3
    1053     801   005AE 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1054     802   005B0 12055D                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1055     803   005B3 22                             RET                  ;EINDE VAN DE ROUTINE
    1056     804   005B4                  
    1057     805   005B4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1058     806   005B4                  ;
    1059     807   005B4                  ; Delay2ms is een vertragingsroutine van 2ms.
    1060     808   005B4                  ;
    1061     809   005B4                  ; De routine gebruikt geen registers.
    1062     810   005B4                  ;
    1063     811   005B4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1064     812   005B4                  
    1065     813   005B4 120405           delay2ms:     lcall  delay1ms
    1066     814   005B7 120405                         lcall  delay1ms
    1067     815   005BA 22                             ret
    1068     816   005BB                  
    1069     817   005BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1070     818   005BB                  ;
    1071     819   005BB                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1072     820   005BB                  ; scherm stuurt via de port expander.
    1073     821   005BB                  ;
    1074     822   005BB                  ; Gebruikt geen registers
    1075     823   005BB                  ;
    1076     824   005BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1077     825   005BB                  
    1078     826   005BB C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1079     827   005BD C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1080     828   005BF 1202DC                         lcall  iicstart      ;vertrokken
    1081     829   005C2 7440                           mov    a,#01000000b  ;schrijven naar expander
    1082     830   005C4 120323                         lcall  iicoutbyte    ;weg er mee
    1083     831   005C7 E5F0                           mov    a,b           ;data verzenden
    1084     832   005C9 120323                         lcall  iicoutbyte
    1085     833   005CC 1202FF                         lcall  iicstop       ;transactie sluiten
    1086     834   005CF D0D0                           pop    psw
    1087     835   005D1 D0E0                           pop    acc
    1088     836   005D3 22                             ret
    1089     837   005D4                  
    1090     838   005D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1091     839   005D4                  ;
    1092     840   005D4                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1093     841   005D4                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1094     842   005D4                  ; van buzzet en backlight is.
    1095     843   005D4                  ;
    1096     844   005D4                  ; Gebruikt b register
    1097     845   005D4                  ;
    1098     846   005D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1099     847   005D4                  
    1100     848   005D4 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1101     849   005D6 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1102     850   005D8 1202DC                         lcall  iicstart      ;vertrokken
    1103     851   005DB 7441                           mov    a,#01000001b  ;lezen van expander
    1104     852   005DD 120323                         lcall  iicoutbyte    ;weg er mee
    1105     853   005E0 12039E                         lcall  iicinbytenack ;data inlezen
    1106     854   005E3 1202FF                         lcall  iicstop
    1107     855   005E6 F5F0                           mov    b,a
    1108     856   005E8 D0D0                           pop    psw
    1109     857   005EA D0E0                           pop    acc
    1110     858   005EC 22                             ret
    1111     859   005ED                  
    1112     860   005ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1113     861   005ED                  ;
    1114     862   005ED                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1115     863   005ED                  ;
    1116     864   005ED                  ; Gebruikt geen registers
    1117     865   005ED                  ;
    1118     866   005ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1119     867   005ED                  
    1120     868   005ED C0F0             lcdlighton:   push   b
    1121     869   005EF 1205D4                         lcall  lcdtoport     ;expander lezen
    1122     870   005F2 C2F6                           clr    b.6           ;licht aan doen
    1123     871   005F4 1205BB                         lcall  porttolcd     ;expander scrijven
    1124     872   005F7 D0F0                           pop    b
    1125     873   005F9 22                             ret
    1126     874   005FA                  
    1127     875   005FA                  
    1128     876   005FA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1129     877   005FA                  ;
    1130     878   005FA                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1131     879   005FA                  ;
    1132     880   005FA                  ; Gebruikt geen registers
    1133     881   005FA                  ;
    1134     882   005FA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1135     883   005FA                  
    1136     884   005FA C0F0             lcdlightoff:  push   b
    1137     885   005FC 1205D4                         lcall  lcdtoport     ;expander lezen
    1138     886   005FF D2F6                           setb   b.6           ;licht uit doen
    1139     887   00601 1205BB                         lcall  porttolcd     ;expander scrijven
    1140     888   00604 D0F0                           pop    b
    1141     889   00606 22                             ret
    1142     890   00607                  
    1143     891   00607                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1144     892   00607                  ;
    1145     893   00607                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1146     894   00607                  ;
    1147     895   00607                  ; Gebruikt geen registers
    1148     896   00607                  ;
    1149     897   00607                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1150     898   00607                  
    1151     899   00607 C0F0             lcdbuzon:     push   b
    1152     900   00609 1205D4                         lcall  lcdtoport     ;expander lezen
    1153     901   0060C C2F7                           clr    b.7           ;buzzer aan doen
    1154     902   0060E 1205BB                         lcall  porttolcd     ;expander scrijven
    1155     903   00611 D0F0                           pop    b
    1156     904   00613 22                             ret
    1157     905   00614                  
    1158     906   00614                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1159     907   00614                  ;
    1160     908   00614                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1161     909   00614                  ;
    1162     910   00614                  ; Gebruikt geen registers
    1163     911   00614                  ;
    1164     912   00614                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1165     913   00614                  
    1166     914   00614 C0F0             lcdbuzoff:    push   b
    1167     915   00616 1205D4                         lcall  lcdtoport     ;expander lezen
    1168     916   00619 D2F7                           setb   b.7           ;buzzer aan doen
    1169     917   0061B 1205BB                         lcall  porttolcd     ;expander scrijven
    1170     918   0061E D0F0                           pop    b
    1171     919   00620 22                             ret
    1172     920   00621                  
    1173     921   00621                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1174     922   00621                  ;
    1175     923   00621                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1176     924   00621                  ; een standaard com poort op 9600 baud.
    1177     925   00621                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1178     926   00621                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1179     927   00621                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1180     928   00621                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1181     929   00621                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1182     930   00621                  ; NIET door deze routine.
    1183     931   00621                  ;
    1184     932   00621                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1185     933   00621                  ;
    1186     934   00621                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1187     935   00621                  
    1188     936   00621                  blank         equ    020h          ;ascii code voor een blank
    1189     937   00621                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1190     938   00621                  ff            equ    00ch          ;ascii code voor nieuw blad
    1191     939   00621                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1192     940   00621                  lf            equ    00ah          ;ascii code voor volgende lijn
    1193     941   00621                  backsp        equ    008h          ;ascii code voor het bs karakter
    1194     942   00621                  beep          equ    007h          ;ascii code voor een beep
    1195     943   00621                  
    1196     944   00621 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1197     945   00625                                                                          ;van het scherm
    1198     946   00625                  
    1199     947   00625                  strtbuf       equ     054h         ;start adres van de buffer
    1200     948   00625                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1201     949   00625                  
    1202     950   00625                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1203     951   00625                  ;
    1204     952   00625                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1205     953   00625                  ;
    1206     954   00625                  ; Gebruikt geen registers
    1207     955   00625                  ;
    1208     956   00625                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1209     957   00625                  
    1210     958   00625 C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1211     959   00627 C08F                           push   syscon0              ;map bewaren
    1212     960   00629 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1213     961   0062C C0B2                           push   port_page            ;pagina op stack zetten
    1214     962   0062E C0BF                           push   scu_page
    1215     963   00630 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1216     964   00633                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1217     965   00633                  ;      -p1.0 als input en alt1 selectie
    1218     966   00633                  ;      -p1.1 als output en alt2 selectie
    1219     967   00633                  
    1220     968   00633 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1221     969   00636 5390FD                         anl    p1_altsel0,#11111101b
    1222     970   00639 439001                         orl    p1_altsel0,#00000001b
    1223     971   0063C 5391FE                         anl    p1_altsel1,#11111110b
    1224     972   0063F 439102                         orl    p1_altsel1,#00000010b
    1225     973   00642 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1226     974   00645 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1227     975   00648 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1228     976   0064B                  
    1229     977   0064B                  ; Nu moet de baud rate generator ingesteld worden
    1230     978   0064B                  ; We gaan er van uit dat de systeemklok 24MHz is
    1231     979   0064B                  
    1232     980   0064B 759850                         mov    scon,#01010000b      ;UART initialiseren
    1233     981   0064E                  
    1234     982   0064E                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1235     983   0064E                  ; gebruikt!!
    1236     984   0064E                  
    1237     985   0064E 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1238     986   00651 75BD11                         mov    bcon,#00010001b
    1239     987   00654 D0BF                           pop    scu_page
    1240     988   00656 D0B2                           pop    port_page            ;alles terug herstellen
    1241     989   00658 D08F                           pop    syscon0
    1242     990   0065A D0E0                           pop    acc
    1243     991   0065C 22                             ret
    1244     992   0065D                  
    1245     993   0065D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1246     994   0065D                  ;
    1247     995   0065D                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1248     996   0065D                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1249     997   0065D                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1250     998   0065D                  ;
    1251     999   0065D                  ; de routine gebruikt geen registers.
    1252    1000   0065D                  ;
    1253    1001   0065D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1254    1002   0065D                  
    1255    1003   0065D                  siooutchar:
    1256    1004   0065D F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1257    1005   0065F 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1258    1006   00662 C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1259    1007   00664 22                             RET
    1260    1008   00665                  
    1261    1009   00665                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1262    1010   00665                  ;
    1263    1011   00665                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1264    1012   00665                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1265    1013   00665                  ;
    1266    1014   00665                  ; de routine gebruikt geen registers.
    1267    1015   00665                  ;
    1268    1016   00665                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1269    1017   00665                  
    1270    1018   00665                  siooutnib:
    1271    1019   00665 C0E0             OUTNIB:       push   acc           ;registers op de stack
    1272    1020   00667 C0D0                           push   psw
    1273    1021   00669 540F                           ANL    A,#00FH       ;AFZONDEREN
    1274    1022   0066B 120755                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1275    1023   0066E 12065D                         LCALL  OUTCHAR       ;VERSTUREN
    1276    1024   00671 1206BE                         LCALL  XONXOFF       ;FLOW CONTROL
    1277    1025   00674 D0D0                           pop    psw           ;registers herstellen
    1278    1026   00676 D0E0                           pop    acc
    1279    1027   00678 22                             RET
    1280    1028   00679                  
    1281    1029   00679                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1282    1030   00679                  ;
    1283    1031   00679                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1284    1032   00679                  ; WORDT XONXOFF GEBRUIKT.
    1285    1033   00679                  ;
    1286    1034   00679                  ; de routine gebruikt geen registers.
    1287    1035   00679                  ;
    1288    1036   00679                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1289    1037   00679                  
    1290    1038   00679                  siooutbyte:
    1291    1039   00679 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1292    1040   0067B C0D0                           push   psw
    1293    1041   0067D C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1294    1042   0067F C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1295    1043   00680 120665                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1296    1044   00683 D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1297    1045   00685 120665                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1298    1046   00688 D0D0                           pop    psw           ;registers herstellen
    1299    1047   0068A D0E0                           pop    acc
    1300    1048   0068C 22                             RET
    1301    1049   0068D                  
    1302    1050   0068D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1303    1051   0068D                  ;
    1304    1052   0068D                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1305    1053   0068D                  ; VAN DE CURSOR.
    1306    1054   0068D                  ;
    1307    1055   0068D                  ; de routine gebruikt geen registers.
    1308    1056   0068D                  ;
    1309    1057   0068D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1310    1058   0068D                  
    1311    1059   0068D                  siodispdptr:
    1312    1060   0068D C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1313    1061   0068F C0D0                           push   psw
    1314    1062   00691 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1315    1063   00693 120679                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1316    1064   00696 E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1317    1065   00698 120679                         LCALL  OUTBYTE       ;WEG ER MEE
    1318    1066   0069B D0D0                           pop    psw           ;registers herstellen
    1319    1067   0069D D0E0                           pop    acc
    1320    1068   0069F 22                             RET                  ;EINDE
    1321    1069   006A0                  
    1322    1070   006A0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1323    1071   006A0                  ;
    1324    1072   006A0                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1325    1073   006A0                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1326    1074   006A0                  ;
    1327    1075   006A0                  ; de routine gebruikt geen registers.
    1328    1076   006A0                  ;
    1329    1077   006A0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1330    1078   006A0                  
    1331    1079   006A0                  siooutmsga:
    1332    1080   006A0 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1333    1081   006A2 C0D0                           push   psw
    1334    1082   006A4 C082                           push   dpl
    1335    1083   006A6 C083                           push   dph
    1336    1084   006A8 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1337    1085   006A9 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1338    1086   006AA 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1339    1087   006AC 12065D                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1340    1088   006AF 1206BE                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1341    1089   006B2 A3                             INC    DPTR          ;DPTR AANPASSEN
    1342    1090   006B3 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1343    1091   006B5 D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1344    1092   006B7 D082                           pop    dpl
    1345    1093   006B9 D0D0                           pop    psw
    1346    1094   006BB D0E0                           pop    acc
    1347    1095   006BD 22                             RET                  ;EINDE ROUTINE
    1348    1096   006BE                  
    1349    1097   006BE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1350    1098   006BE                  ;
    1351    1099   006BE                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1352    1100   006BE                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1353    1101   006BE                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1354    1102   006BE                  ; VERDER DOORGEGEVEN.
    1355    1103   006BE                  ;
    1356    1104   006BE                  ; de routine gebruikt geen registers.
    1357    1105   006BE                  ;
    1358    1106   006BE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1359    1107   006BE                  
    1360    1108   006BE C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1361    1109   006C0 C0D0                           push   psw
    1362    1110   006C2 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1363    1111   006C5 D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1364    1112   006C7 D0E0                           pop    acc
    1365    1113   006C9 22                             RET                  ;ANDERS EINDE
    1366    1114   006CA E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1367    1115   006CC B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1368    1116   006CF 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1369    1117   006D2 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1370    1118   006D4                  
    1371    1119   006D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1372    1120   006D4                  ;
    1373    1121   006D4                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1374    1122   006D4                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1375    1123   006D4                  ;
    1376    1124   006D4                  ; de routine gebruikt de accu.
    1377    1125   006D4                  ;
    1378    1126   006D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1379    1127   006D4                  
    1380    1128   006D4                  sioinchar:
    1381    1129   006D4 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1382    1130   006D7 C298                           CLR    RI                   ;BIT LAAG MAKEN
    1383    1131   006D9 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1384    1132   006DB 22                             RET
    1385    1133   006DC                  
    1386    1134   006DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1387    1135   006DC                  ;
    1388    1136   006DC                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1389    1137   006DC                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1390    1138   006DC                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1391    1139   006DC                  ; DE CARRY OP 1 GEZET WORDEN.
    1392    1140   006DC                  ;
    1393    1141   006DC                  ; De routine gebruikt de accu, r0 en de psw.
    1394    1142   006DC                  ;
    1395    1143   006DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1396    1144   006DC                  
    1397    1145   006DC                  sioinbyte:
    1398    1146   006DC 1206D4           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1399    1147   006DF 120748                         LCALL  LOWUPTR
    1400    1148   006E2 12075F                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1401    1149   006E5 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1402    1150   006E7 C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1403    1151   006E8 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1404    1152   006E9 1206D4                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1405    1153   006EC 120748                         LCALL  LOWUPTR
    1406    1154   006EF 12075F                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1407    1155   006F2 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1408    1156   006F4 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1409    1157   006F5 22               INBYTE1:      RET
    1410    1158   006F6                  
    1411    1159   006F6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1412    1160   006F6                  ;
    1413    1161   006F6                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1414    1162   006F6                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1415    1163   006F6                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1416    1164   006F6                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1417    1165   006F6                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1418    1166   006F6                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1419    1167   006F6                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1420    1168   006F6                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1421    1169   006F6                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1422    1170   006F6                  ; bepalen.
    1423    1171   006F6                  ;
    1424    1172   006F6                  ; De routine gebruikt de accu, r0 en de psw.
    1425    1173   006F6                  ;
    1426    1174   006F6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1427    1175   006F6                  
    1428    1176   006F6                  sioinbufa:
    1429    1177   006F6 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1430    1178   006F8 1206D4           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1431    1179   006FB 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1432    1180   006FD                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1433    1181   006FD                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1434    1182   006FD                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1435    1183   006FD                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1436    1184   006FD                  ; GEVOERD.
    1437    1185   006FD 120748                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1438    1186   00700 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1439    1187   00703 F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1440    1188   00704 22                             RET                         ;EINDE VAN DE ROUTINE
    1441    1189   00705 B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1442    1190   00708 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1443    1191   0070B 7407             INBUFA4:      MOV    A,#BEEP
    1444    1192   0070D 12065D           INBUFA7:      LCALL  OUTCHAR
    1445    1193   00710 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1446    1194   00712 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1447    1195   00713 900621                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1448    1196   00716 1206A0                         LCALL  OUTMSGA
    1449    1197   00719 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1450    1198   0071B 12073A           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1451    1199   0071E 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1452    1200   00720 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1453    1201   00723 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1454    1202   00725 F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1455    1203   00726 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1456    1204   00727 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1457    1205   00729                  
    1458    1206   00729                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1459    1207   00729                  ;
    1460    1208   00729                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1461    1209   00729                  ;
    1462    1210   00729                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1463    1211   00729                  ;
    1464    1212   00729                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1465    1213   00729                  
    1466    1214   00729 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1467    1215   0072B 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1468    1216   0072D E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1469    1217   0072E B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1470    1218   00731 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1471    1219   00732 B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1472    1220   00735 22                             RET                         ;EINDE VAN DE ROUTINE
    1473    1221   00736 F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1474    1222   00737 09                             INC    R1
    1475    1223   00738 80F7                           SJMP   BDELETE3
    1476    1224   0073A                  
    1477    1225   0073A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1478    1226   0073A                  ;
    1479    1227   0073A                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1480    1228   0073A                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1481    1229   0073A                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1482    1230   0073A                  ; AANZIEN.
    1483    1231   0073A                  ;
    1484    1232   0073A                  ; De routine gebruikt de accu en de psw.
    1485    1233   0073A                  ;
    1486    1234   0073A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1487    1235   0073A                  
    1488    1236   0073A B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1489    1237   0073D 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1490    1238   0073F B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1491    1239   00742 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1492    1240   00744 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1493    1241   00745 22                             RET
    1494    1242   00746 D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1495    1243   00747 22                             RET
    1496    1244   00748                  
    1497    1245   00748                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1498    1246   00748                  ;
    1499    1247   00748                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1500    1248   00748                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1501    1249   00748                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1502    1250   00748                  ; AANGEPAST WORDEN.
    1503    1251   00748                  ;
    1504    1252   00748                  ; De routine gebruikt de accu en de psw.
    1505    1253   00748                  ;
    1506    1254   00748                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1507    1255   00748                  
    1508    1256   00748 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1509    1257   0074B 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1510    1258   0074D B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1511    1259   00750 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1512    1260   00752 9420                           SUBB   A,#020H              ;OMZETTING
    1513    1261   00754 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1514    1262   00755                  
    1515    1263   00755                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1516    1264   00755                  ;
    1517    1265   00755                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1518    1266   00755                  ; ASCII CODE.
    1519    1267   00755                  ;
    1520    1268   00755                  ; De routine gebruikt de accu en de psw.
    1521    1269   00755                  ;
    1522    1270   00755                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1523    1271   00755                  
    1524    1272   00755 B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1525    1273   00758 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1526    1274   0075A 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1527    1275   0075C 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1528    1276   0075E 22                             RET
    1529    1277   0075F                  
    1530    1278   0075F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1531    1279   0075F                  ;
    1532    1280   0075F                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1533    1281   0075F                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1534    1282   0075F                  ; GEVAL WORDT DE CARRY GEZET.
    1535    1283   0075F                  ;
    1536    1284   0075F                  ; De routine gebruikt de accu en de psw.
    1537    1285   0075F                  ;
    1538    1286   0075F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1539    1287   0075F                  
    1540    1288   0075F C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1541    1289   00760 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1542    1290   00762 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1543    1291   00764 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1544    1292   00767 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1545    1293   00769 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1546    1294   0076B 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1547    1295   0076D B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1548    1296   00770 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1549    1297   00771 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1550    1298   00773 C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1551    1299   00774 22               ASCBINTRANS1: RET
    1552    1300   00775                  
    1553    1301   00775                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1554    1302   00775                  ;
    1555    1303   00775                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1556    1304   00775                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1557    1305   00775                  ;
    1558    1306   00775                  ; De routine gebruikt de accu en de psw.
    1559    1307   00775                  ;
    1560    1308   00775                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1561    1309   00775                  
    1562    1310   00775 E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1563    1311   00776 12075F                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1564    1312   00779 22                             RET                         ;EINDE OMZETTING
    1565    1313   0077A                  
    1566    1314   0077A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1567    1315   0077A                  ;
    1568    1316   0077A                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1569    1317   0077A                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1570    1318   0077A                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1571    1319   0077A                  ;
    1572    1320   0077A                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1573    1321   0077A                  ;
    1574    1322   0077A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1575    1323   0077A                  
    1576    1324   0077A 120775           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1577    1325   0077D 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1578    1326   0077F C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1579    1327   00780 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1580    1328   00781 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1581    1329   00782 120775                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1582    1330   00785 4001                           JC     ASCII21               ;WEG ALS C=1
    1583    1331   00787 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1584    1332   00788 22               ASCII21:      RET
    1585    1333   00789                  
    1586    1334   00789                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1587    1335   00789                  ;
    1588    1336   00789                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1589    1337   00789                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1590    1338   00789                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1591    1339   00789                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1592    1340   00789                  ;
    1593    1341   00789                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1594    1342   00789                  ;
    1595    1343   00789                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1596    1344   00789                  
    1597    1345   00789 12077A           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1598    1346   0078C 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1599    1347   0078E F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1600    1348   00790 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1601    1349   00791 12077A                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1602    1350   00794 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1603    1351   00796 F582                           MOV    DPL,A                ;IN DPTR LADEN
    1604    1352   00798 22               ASCII41:      RET
    1605    1353   00799                  
    1606    1354   00799                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1607    1355   00799                  ;
    1608    1356   00799                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1609    1357   00799                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1610    1358   00799                  ; geschakeld worden.
    1611    1359   00799                  ;
    1612    1360   00799                  ; Gebruikt geen registers
    1613    1361   00799                  ;
    1614    1362   00799                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1615    1363   00799                  
    1616    1364   00799 C08F             initadc:      push   syscon0                     ;map saven
    1617    1365   0079B 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1618    1366   0079E 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1619    1367   007A1 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1620    1368   007A4                                                                   ;klok delen door 32 (750kHz)
    1621    1369   007A4                                                                   ;10 bit uitkomst
    1622    1370   007A4 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1623    1371   007A7                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1624    1372   007A7 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1625    1373   007AA 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1626    1374   007AD 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1627    1375   007B0 D08F                           pop    syscon0                     ;herstellen syscon
    1628    1376   007B2 22                             ret
    1629    1377   007B3                  
    1630    1378   007B3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1631    1379   007B3                  ;
    1632    1380   007B3                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1633    1381   007B3                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1634    1382   007B3                  ;
    1635    1383   007B3                  ; Gebruikt:
    1636    1384   007B3                  ;      -accu als 8 msb meting
    1637    1385   007B3                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1638    1386   007B3                  ;
    1639    1387   007B3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1640    1388   007B3                  
    1641    1389   007B3 C08F             adclm335:     push   syscon0
    1642    1390   007B5 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1643    1391   007B8 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1644    1392   007BB 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1645    1393   007BE 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1646    1394   007C1 00               		nop
    1647    1395   007C2 00               		nop					;anders loopt het mis met het testen van de ready bit
    1648    1396   007C3 E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1649    1397   007C5 20E0FB                         jb     acc.0,adclm3351
    1650    1398   007C8 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1651    1399   007CB E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1652    1400   007CD 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1653    1401   007D0 D08F                           pop    syscon0
    1654    1402   007D2 22                             ret
    1655    1403   007D3                  
    1656    1404   007D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1657    1405   007D3                  ;
    1658    1406   007D3                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1659    1407   007D3                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1660    1408   007D3                  ;
    1661    1409   007D3                  ; Gebruikt:
    1662    1410   007D3                  ;      -accu als 8 msb meting
    1663    1411   007D3                  ;      -b als 2 lsb meting (links afgelijnd)
    1664    1412   007D3                  ;
    1665    1413   007D3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1666    1414   007D3                  
    1667    1415   007D3 C08F             adcpotmeter:  push   syscon0
    1668    1416   007D5 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1669    1417   007D8 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1670    1418   007DB 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1671    1419   007DE 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1672    1420   007E1 00               		nop
    1673    1421   007E2 00               		nop					;anders loopt het mis met het testen van de ready bit
    1674    1422   007E3 E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1675    1423   007E5 20E0FB                         jb     acc.0,adcpotmeter1
    1676    1424   007E8 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1677    1425   007EB E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1678    1426   007ED 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1679    1427   007F0 D08F                           pop    syscon0
    1680    1428   007F2                  
    1681    1429   007F2                  
    1682    1430   007F2 22                             ret
    1683    1431   007F3                  
    1684    1432   007F3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1685    1433   007F3                  ;
    1686    1434   007F3                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1687    1435   007F3                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1688    1436   007F3                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1689    1437   007F3                  ; doelstellingen in het achterhoofd.
    1690    1438   007F3                  ;
    1691    1439   007F3                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1692    1440   007F3                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1693    1441   007F3                  ; bcd)
    1694    1442   007F3                  ;      8bit hex naar bcd
    1695    1443   007F3                  ;      8bit bcd naar hex
    1696    1444   007F3                  ;
    1697    1445   007F3                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1698    1446   007F3                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1699    1447   007F3                  ;      16*16 bit met 32 bit uitkomst
    1700    1448   007F3                  ;      16+16 bit met 24 bit uitkomst
    1701    1449   007F3                  ;      16-16 bit met 24 bit uitkomst
    1702    1450   007F3                  ;      16bit hex naar bcd
    1703    1451   007F3                  ;      16bit bcd naar hex
    1704    1452   007F3                  ;
    1705    1453   007F3                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1706    1454   007F3                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1707    1455   007F3                  ;      32*32 bit met 64 bit uitkomst
    1708    1456   007F3                  ;      32+32 bit met 40 bit uitkomst
    1709    1457   007F3                  ;      32-32 bit met 40 bit uitkomst
    1710    1458   007F3                  ;
    1711    1459   007F3                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1712    1460   007F3                  ;
    1713    1461   007F3                  ; De routines gebruiken als input en output de huidige registerbank.
    1714    1462   007F3                  ;
    1715    1463   007F3                  ;
    1716    1464   007F3                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1717    1465   007F3                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1718    1466   007F3                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1719    1467   007F3                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1720    1468   007F3                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1721    1469   007F3                  ;
    1722    1470   007F3                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1723    1471   007F3                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1724    1472   007F3                  ;      -routines gebruiken geen MDU!
    1725    1473   007F3                  ;
    1726    1474   007F3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1727    1475   007F3                  
    1728    1476   007F3                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1729    1477   007F3                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1730    1478   007F3                  
    1731    1479   007F3                  h0            equ    070h
    1732    1480   007F3                  h1            equ    071h
    1733    1481   007F3                  h2            equ    072h
    1734    1482   007F3                  h3            equ    073h
    1735    1483   007F3                  h4            equ    074h
    1736    1484   007F3                  h5            equ    075h
    1737    1485   007F3                  h6            equ    076h
    1738    1486   007F3                  h7            equ    077h
    1739    1487   007F3                  h8            equ    078h
    1740    1488   007F3                  h9            equ    079h
    1741    1489   007F3                  h10           equ    07ah
    1742    1490   007F3                  h11           equ    07bh
    1743    1491   007F3                  h12           equ    07ch
    1744    1492   007F3                  
    1745    1493   007F3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1746    1494   007F3                  ;
    1747    1495   007F3                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1748    1496   007F3                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1749    1497   007F3                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1750    1498   007F3                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1751    1499   007F3                  ;
    1752    1500   007F3                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1753    1501   007F3                  ;
    1754    1502   007F3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1755    1503   007F3                  
    1756    1504   007F3 C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1757    1505   007F5 C0D0                           push   psw
    1758    1506   007F7 C070                           push   h0
    1759    1507   007F9 C071                           push   h1
    1760    1508   007FB C072                           push   h2
    1761    1509   007FD C073                           push   h3
    1762    1510   007FF C074                           push   h4
    1763    1511   00801 C075                           push   h5
    1764    1512   00803 C076                           push   h6
    1765    1513   00805 C077                           push   h7
    1766    1514   00807 C078                           push   h8
    1767    1515   00809 C079                           push   h9
    1768    1516   0080B C07A                           push   h10
    1769    1517   0080D C07B                           push   h11
    1770    1518   0080F C07C                           push   h12
    1771    1519   00811                  
    1772    1520   00811                  ; eerst moeten de hulpregisters klaar gezet worden
    1773    1521   00811                  
    1774    1522   00811 757000                         mov    h0,#000h
    1775    1523   00814 757100                         mov    h1,#000h
    1776    1524   00817 757200                         mov    h2,#000h
    1777    1525   0081A 757300                         mov    h3,#000h
    1778    1526   0081D 757400                         mov    h4,#000h
    1779    1527   00820 757500                         mov    h5,#000h
    1780    1528   00823 757600                         mov    h6,#000h
    1781    1529   00826 757700                         mov    h7,#000h
    1782    1530   00829 757800                         mov    h8,#000h
    1783    1531   0082C 757900                         mov    h9,#000h
    1784    1532   0082F 757A00                         mov    h10,#000h
    1785    1533   00832 757B00                         mov    h11,#000h
    1786    1534   00835 757C20                         mov    h12,#32              ;loopcounter
    1787    1535   00838                  
    1788    1536   00838                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1789    1537   00838                  
    1790    1538   00838                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1791    1539   00838                  
    1792    1540   00838 EB               mul321:       mov    a,r3
    1793    1541   00839 13                             rrc    a
    1794    1542   0083A FB                             mov    r3,a
    1795    1543   0083B EA                             mov    a,r2
    1796    1544   0083C 13                             rrc    a
    1797    1545   0083D FA                             mov    r2,a
    1798    1546   0083E E9                             mov    a,r1
    1799    1547   0083F 13                             rrc    a
    1800    1548   00840 F9                             mov    r1,a
    1801    1549   00841 E8                             mov    a,r0
    1802    1550   00842 13                             rrc    a
    1803    1551   00843 F8                             mov    r0,a                 ;32 bit shift klaar
    1804    1552   00844                  
    1805    1553   00844                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1806    1554   00844                  
    1807    1555   00844 502C                           jnc    mul322               ;optelling niet nodig
    1808    1556   00846                  
    1809    1557   00846                  ; hier staat en 64 bit optelling
    1810    1558   00846                  
    1811    1559   00846 EC                             mov    a,r4
    1812    1560   00847 2574                           add    a,h4
    1813    1561   00849 F574                           mov    h4,a
    1814    1562   0084B ED                             mov    a,r5
    1815    1563   0084C 3575                           addc   a,h5
    1816    1564   0084E F575                           mov    h5,a
    1817    1565   00850 EE                             mov    a,r6
    1818    1566   00851 3576                           addc   a,h6
    1819    1567   00853 F576                           mov    h6,a
    1820    1568   00855 EF                             mov    a,r7
    1821    1569   00856 3577                           addc   a,h7
    1822    1570   00858 F577                           mov    h7,a
    1823    1571   0085A E570                           mov    a,h0
    1824    1572   0085C 3578                           addc   a,h8
    1825    1573   0085E F578                           mov    h8,a
    1826    1574   00860 E571                           mov    a,h1
    1827    1575   00862 3579                           addc   a,h9
    1828    1576   00864 F579                           mov    h9,a
    1829    1577   00866 E572                           mov    a,h2
    1830    1578   00868 357A                           addc   a,h10
    1831    1579   0086A F57A                           mov    h10,a
    1832    1580   0086C E573                           mov    a,h3
    1833    1581   0086E 357B                           addc   a,h11
    1834    1582   00870 F57B                           mov    h11,a                ;optelling klaar
    1835    1583   00872                  
    1836    1584   00872                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1837    1585   00872                  
    1838    1586   00872 C3               mul322:       clr    c                    ;moet op 0 staan
    1839    1587   00873 EC                             mov    a,r4
    1840    1588   00874 33                             rlc    a
    1841    1589   00875 FC                             mov    r4,a
    1842    1590   00876 ED                             mov    a,r5
    1843    1591   00877 33                             rlc    a
    1844    1592   00878 FD                             mov    r5,a
    1845    1593   00879 EE                             mov    a,r6
    1846    1594   0087A 33                             rlc    a
    1847    1595   0087B FE                             mov    r6,a
    1848    1596   0087C EF                             mov    a,r7
    1849    1597   0087D 33                             rlc    a
    1850    1598   0087E FF                             mov    r7,a
    1851    1599   0087F E570                           mov    a,h0
    1852    1600   00881 33                             rlc    a
    1853    1601   00882 F570                           mov    h0,a
    1854    1602   00884 E571                           mov    a,h1
    1855    1603   00886 33                             rlc    a
    1856    1604   00887 F571                           mov    h1,a
    1857    1605   00889 E572                           mov    a,h2
    1858    1606   0088B 33                             rlc    a
    1859    1607   0088C F572                           mov    h2,a
    1860    1608   0088E E573                           mov    a,h3
    1861    1609   00890 33                             rlc    a
    1862    1610   00891 F573                           mov    h3,a
    1863    1611   00893                  
    1864    1612   00893 D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1865    1613   00896                  
    1866    1614   00896                  ; de uitkomst moet in de juiste registers komen
    1867    1615   00896                  
    1868    1616   00896 A874                           mov    r0,h4
    1869    1617   00898 A975                           mov    r1,h5
    1870    1618   0089A AA76                           mov    r2,h6
    1871    1619   0089C AB77                           mov    r3,h7
    1872    1620   0089E AC78                           mov    r4,h8
    1873    1621   008A0 AD79                           mov    r5,h9
    1874    1622   008A2 AE7A                           mov    r6,h10
    1875    1623   008A4 AF7B                           mov    r7,h11               ;klaar
    1876    1624   008A6                  
    1877    1625   008A6 D07C                           pop    h12                  ;registers herstellen
    1878    1626   008A8 D07B                           pop    h11
    1879    1627   008AA D07A                           pop    h10
    1880    1628   008AC D079                           pop    h9
    1881    1629   008AE D078                           pop    h8
    1882    1630   008B0 D077                           pop    h7
    1883    1631   008B2 D076                           pop    h6
    1884    1632   008B4 D075                           pop    h5
    1885    1633   008B6 D074                           pop    h4
    1886    1634   008B8 D073                           pop    h3
    1887    1635   008BA D072                           pop    h2
    1888    1636   008BC D071                           pop    h1
    1889    1637   008BE D070                           pop    h0
    1890    1638   008C0 D0D0                           pop    psw
    1891    1639   008C2 D0E0                           pop    acc
    1892    1640   008C4 22                             ret
    1893    1641   008C5                  
    1894    1642   008C5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1895    1643   008C5                  ;
    1896    1644   008C5                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1897    1645   008C5                  ; input:      r1,r0 = eerste getal (r1=msb)
    1898    1646   008C5                  ;             r3,r2 = tweede getal (r3=msb)
    1899    1647   008C5                  ; output:     r3,r2,r1,r0 met r3=msb
    1900    1648   008C5                  ;
    1901    1649   008C5                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1902    1650   008C5                  ;
    1903    1651   008C5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1904    1652   008C5                  
    1905    1653   008C5 C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1906    1654   008C7 C0D0                           push   psw
    1907    1655   008C9 C070                           push   h0
    1908    1656   008CB C071                           push   h1
    1909    1657   008CD C072                           push   h2
    1910    1658   008CF C073                           push   h3
    1911    1659   008D1 C074                           push   h4
    1912    1660   008D3 C075                           push   h5
    1913    1661   008D5 C076                           push   h6
    1914    1662   008D7                  
    1915    1663   008D7                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1916    1664   008D7                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1917    1665   008D7                  ; h6 is de loopcounter.
    1918    1666   008D7                  
    1919    1667   008D7 757000                         mov    h0,#000h
    1920    1668   008DA 757100                         mov    h1,#000h
    1921    1669   008DD 757200                         mov    h2,#000h
    1922    1670   008E0 757300                         mov    h3,#000h
    1923    1671   008E3 757400                         mov    h4,#000h
    1924    1672   008E6 757500                         mov    h5,#000h
    1925    1673   008E9 757610                         mov    h6,#16               ;loopcounter
    1926    1674   008EC                  
    1927    1675   008EC                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1928    1676   008EC                  ; berekening
    1929    1677   008EC                  
    1930    1678   008EC E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1931    1679   008ED 13                             rrc    a
    1932    1680   008EE F9                             mov    r1,a
    1933    1681   008EF E8                             mov    a,r0
    1934    1682   008F0 13                             rrc    a
    1935    1683   008F1 F8                             mov    r0,a                 ;ok
    1936    1684   008F2                  
    1937    1685   008F2                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1938    1686   008F2                  
    1939    1687   008F2 5016                           jnc    mul162
    1940    1688   008F4                  
    1941    1689   008F4 EA                             mov    a,r2
    1942    1690   008F5 2572                           add    a,h2
    1943    1691   008F7 F572                           mov    h2,a                 ;32 bit som uitvoeren
    1944    1692   008F9 EB                             mov    a,r3
    1945    1693   008FA 3573                           addc   a,h3
    1946    1694   008FC F573                           mov    h3,a
    1947    1695   008FE E570                           mov    a,h0
    1948    1696   00900 3574                           addc   a,h4
    1949    1697   00902 F574                           mov    h4,a
    1950    1698   00904 E571                           mov    a,h1
    1951    1699   00906 3575                           addc   a,h5
    1952    1700   00908 F575                           mov    h5,a                 ;klaar
    1953    1701   0090A                  
    1954    1702   0090A                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    1955    1703   0090A                  
    1956    1704   0090A C3               mul162:       clr    c
    1957    1705   0090B EA                             mov    a,r2
    1958    1706   0090C 33                             rlc    a
    1959    1707   0090D FA                             mov    r2,a                 ;ook 32 bit getal
    1960    1708   0090E EB                             mov    a,r3
    1961    1709   0090F 33                             rlc    a
    1962    1710   00910 FB                             mov    r3,a
    1963    1711   00911 E570                           mov    a,h0
    1964    1712   00913 33                             rlc    a
    1965    1713   00914 F570                           mov    h0,a
    1966    1714   00916 E571                           mov    a,h1
    1967    1715   00918 33                             rlc    a
    1968    1716   00919 F571                           mov    h1,a                 ;klaar
    1969    1717   0091B                  
    1970    1718   0091B D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    1971    1719   0091E                  
    1972    1720   0091E                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    1973    1721   0091E                  
    1974    1722   0091E A872                           mov    r0,h2
    1975    1723   00920 A973                           mov    r1,h3
    1976    1724   00922 AA74                           mov    r2,h4
    1977    1725   00924 AB75                           mov    r3,h5                ;klaar
    1978    1726   00926                  
    1979    1727   00926                  
    1980    1728   00926 D076                           pop    h6                   ;registers herstellen
    1981    1729   00928 D075                           pop    h5
    1982    1730   0092A D074                           pop    h4
    1983    1731   0092C D073                           pop    h3
    1984    1732   0092E D072                           pop    h2
    1985    1733   00930 D071                           pop    h1
    1986    1734   00932 D070                           pop    h0
    1987    1735   00934 D0D0                           pop    psw
    1988    1736   00936 D0E0                           pop    acc
    1989    1737   00938 22                             ret
    1990    1738   00939                  
    1991    1739   00939                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1992    1740   00939                  ;
    1993    1741   00939                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    1994    1742   00939                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1995    1743   00939                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1996    1744   00939                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    1997    1745   00939                  ;             r3,r2,r1,r0 = rest (r3=msb)
    1998    1746   00939                  ;             carry=1 bij delen door 0
    1999    1747   00939                  ;
    2000    1748   00939                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2001    1749   00939                  ;
    2002    1750   00939                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2003    1751   00939                  
    2004    1752   00939 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2005    1753   0093B C0D0                           push   psw
    2006    1754   0093D C070                           push   h0
    2007    1755   0093F C071                           push   h1
    2008    1756   00941 C072                           push   h2
    2009    1757   00943 C073                           push   h3
    2010    1758   00945 C074                           push   h4
    2011    1759   00947 C075                           push   h5
    2012    1760   00949 C076                           push   h6
    2013    1761   0094B C077                           push   h7
    2014    1762   0094D C078                           push   h8
    2015    1763   0094F C079                           push   h9
    2016    1764   00951 C07A                           push   h10
    2017    1765   00953 C07B                           push   h11
    2018    1766   00955 C07C                           push   h12
    2019    1767   00957                  
    2020    1768   00957                  ; eerst alles voorladen
    2021    1769   00957                  
    2022    1770   00957 757000                         mov    h0,#000h
    2023    1771   0095A 757100                         mov    h1,#000h
    2024    1772   0095D 757200                         mov    h2,#000h
    2025    1773   00960 757300                         mov    h3,#000h
    2026    1774   00963 757400                         mov    h4,#000h
    2027    1775   00966 757500                         mov    h5,#000h
    2028    1776   00969 757600                         mov    h6,#000h
    2029    1777   0096C 757700                         mov    h7,#000h
    2030    1778   0096F 757800                         mov    h8,#000h
    2031    1779   00972 757900                         mov    h9,#000h
    2032    1780   00975 757A00                         mov    h10,#000h
    2033    1781   00978 757B00                         mov    h11,#000h
    2034    1782   0097B 757C20                         mov    h12,#32              ;loopcounter
    2035    1783   0097E                  
    2036    1784   0097E                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2037    1785   0097E                  
    2038    1786   0097E                  ; deze lus moet 32 keer heraald worden
    2039    1787   0097E                  
    2040    1788   0097E E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2041    1789   0097F 33                             rlc    a
    2042    1790   00980 F8                             mov    r0,a
    2043    1791   00981 E9                             mov    a,r1
    2044    1792   00982 33                             rlc    a
    2045    1793   00983 F9                             mov    r1,a
    2046    1794   00984 EA                             mov    a,r2
    2047    1795   00985 33                             rlc    a
    2048    1796   00986 FA                             mov    r2,a
    2049    1797   00987 EB                             mov    a,r3
    2050    1798   00988 33                             rlc    a
    2051    1799   00989 FB                             mov    r3,a
    2052    1800   0098A E570                           mov    a,h0
    2053    1801   0098C 33                             rlc    a
    2054    1802   0098D F570                           mov    h0,a
    2055    1803   0098F E571                           mov    a,h1
    2056    1804   00991 33                             rlc    a
    2057    1805   00992 F571                           mov    h1,a
    2058    1806   00994 E572                           mov    a,h2
    2059    1807   00996 33                             rlc    a
    2060    1808   00997 F572                           mov    h2,a
    2061    1809   00999 E573                           mov    a,h3
    2062    1810   0099B 33                             rlc    a
    2063    1811   0099C F573                           mov    h3,a
    2064    1812   0099E                  
    2065    1813   0099E                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2066    1814   0099E                  
    2067    1815   0099E C3                             clr    c                    ;zit in de weg
    2068    1816   0099F E570                           mov    a,h0
    2069    1817   009A1 9C                             subb   a,r4
    2070    1818   009A2 F574                           mov    h4,a
    2071    1819   009A4 E571                           mov    a,h1
    2072    1820   009A6 9D                             subb   a,r5
    2073    1821   009A7 F575                           mov    h5,a
    2074    1822   009A9 E572                           mov    a,h2
    2075    1823   009AB 9E                             subb   a,r6
    2076    1824   009AC F576                           mov    h6,a
    2077    1825   009AE E573                           mov    a,h3
    2078    1826   009B0 9F                             subb   a,r7
    2079    1827   009B1 F577                           mov    h7,a
    2080    1828   009B3                  
    2081    1829   009B3                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2082    1830   009B3                  ; vervangen worden door h7-h4
    2083    1831   009B3                  
    2084    1832   009B3 400C                           jc     div322               ;niet vervangen
    2085    1833   009B5                  
    2086    1834   009B5 857470                         mov    h0,h4
    2087    1835   009B8 857571                         mov    h1,h5
    2088    1836   009BB 857672                         mov    h2,h6
    2089    1837   009BE 857773                         mov    h3,h7                ;vervanging klaar
    2090    1838   009C1                  
    2091    1839   009C1 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2092    1840   009C2 E578                           mov    a,h8
    2093    1841   009C4 33                             rlc    a
    2094    1842   009C5 F578                           mov    h8,a
    2095    1843   009C7 E579                           mov    a,h9
    2096    1844   009C9 33                             rlc    a
    2097    1845   009CA F579                           mov    h9,a
    2098    1846   009CC E57A                           mov    a,h10
    2099    1847   009CE 33                             rlc    a
    2100    1848   009CF F57A                           mov    h10,a
    2101    1849   009D1 E57B                           mov    a,h11
    2102    1850   009D3 33                             rlc    a
    2103    1851   009D4 F57B                           mov    h11,a                ;qoutient aangepast
    2104    1852   009D6                  
    2105    1853   009D6 D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2106    1854   009D9                  
    2107    1855   009D9                  ; de berekening is klaar. uitkomstregisters nog laden
    2108    1856   009D9                  
    2109    1857   009D9 AC78                           mov    r4,h8
    2110    1858   009DB AD79                           mov    r5,h9
    2111    1859   009DD AE7A                           mov    r6,h10
    2112    1860   009DF AF7B                           mov    r7,h11               ;uitkomst geladen
    2113    1861   009E1                  
    2114    1862   009E1 A870                           mov    r0,h0                ;rest laden
    2115    1863   009E3 A971                           mov    r1,h1
    2116    1864   009E5 AA72                           mov    r2,h2
    2117    1865   009E7 AB73                           mov    r3,h3
    2118    1866   009E9                  
    2119    1867   009E9 D07C                           pop    h12                  ;registers herstellen
    2120    1868   009EB D07B                           pop    h11
    2121    1869   009ED D07A                           pop    h10
    2122    1870   009EF D079                           pop    h9
    2123    1871   009F1 D078                           pop    h8
    2124    1872   009F3 D077                           pop    h7
    2125    1873   009F5 D076                           pop    h6
    2126    1874   009F7 D075                           pop    h5
    2127    1875   009F9 D074                           pop    h4
    2128    1876   009FB D073                           pop    h3
    2129    1877   009FD D072                           pop    h2
    2130    1878   009FF D071                           pop    h1
    2131    1879   00A01 D070                           pop    h0
    2132    1880   00A03 D0D0                           pop    psw
    2133    1881   00A05 D0E0                           pop    acc
    2134    1882   00A07 22                             ret
    2135    1883   00A08                  
    2136    1884   00A08                  
    2137    1885   00A08                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2138    1886   00A08                  ;
    2139    1887   00A08                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2140    1888   00A08                  ; input:      r1,r0 = eerste getal (r1=msb)
    2141    1889   00A08                  ;             r3,r2 = tweede getal (r3=msb)
    2142    1890   00A08                  ; output:     r3,r2 = quotient (r3=msb)
    2143    1891   00A08                  ;             r1,r0 = rest (r1=msb)
    2144    1892   00A08                  ;             carry=1 bij deling door 0
    2145    1893   00A08                  ;
    2146    1894   00A08                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2147    1895   00A08                  
    2148    1896   00A08 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2149    1897   00A0A C0D0                           push   psw
    2150    1898   00A0C C070                           push   h0
    2151    1899   00A0E C071                           push   h1
    2152    1900   00A10 C072                           push   h2
    2153    1901   00A12 C073                           push   h3
    2154    1902   00A14 C074                           push   h4
    2155    1903   00A16 C075                           push   h5
    2156    1904   00A18 C076                           push   h6
    2157    1905   00A1A                  
    2158    1906   00A1A                  ; registers voorladen
    2159    1907   00A1A                  
    2160    1908   00A1A 757000                         mov    h0,#000h
    2161    1909   00A1D 757100                         mov    h1,#000h
    2162    1910   00A20 757200                         mov    h2,#000h
    2163    1911   00A23 757300                         mov    h3,#000h
    2164    1912   00A26 757400                         mov    h4,#000h
    2165    1913   00A29 757500                         mov    h5,#000h
    2166    1914   00A2C 757610                         mov    h6,#16               ;loopcounter
    2167    1915   00A2F                  
    2168    1916   00A2F                  ; eerst te delen getal 1*links shiften in hulpregisters
    2169    1917   00A2F                  
    2170    1918   00A2F                  ; deze lus moet 16 keer herhaald worden
    2171    1919   00A2F                  
    2172    1920   00A2F E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2173    1921   00A30 33                             rlc    a
    2174    1922   00A31 F8                             mov    r0,a
    2175    1923   00A32 E9                             mov    a,r1
    2176    1924   00A33 33                             rlc    a
    2177    1925   00A34 F9                             mov    r1,a
    2178    1926   00A35 E570                           mov    a,h0
    2179    1927   00A37 33                             rlc    a
    2180    1928   00A38 F570                           mov    h0,a
    2181    1929   00A3A E571                           mov    a,h1
    2182    1930   00A3C 33                             rlc    a
    2183    1931   00A3D F571                           mov    h1,a
    2184    1932   00A3F                  
    2185    1933   00A3F                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2186    1934   00A3F                  ; het tussenresultaat.
    2187    1935   00A3F                  
    2188    1936   00A3F C3                             clr    c
    2189    1937   00A40 E570                           mov    a,h0
    2190    1938   00A42 9A                             subb   a,r2
    2191    1939   00A43 F572                           mov    h2,a
    2192    1940   00A45 E571                           mov    a,h1
    2193    1941   00A47 9B                             subb   a,r3
    2194    1942   00A48 F573                           mov    h3,a
    2195    1943   00A4A                  
    2196    1944   00A4A 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2197    1945   00A4C                                                            ;door h3,h2
    2198    1946   00A4C 857270                         mov    h0,h2
    2199    1947   00A4F 857371                         mov    h1,h3                ;vervanging klaar
    2200    1948   00A52                  
    2201    1949   00A52                  ; uitkomst moet aangepast worden
    2202    1950   00A52                  
    2203    1951   00A52 B3               div162:       cpl    c                    ;truuk
    2204    1952   00A53 E574                           mov    a,h4
    2205    1953   00A55 33                             rlc    a
    2206    1954   00A56 F574                           mov    h4,a
    2207    1955   00A58 E575                           mov    a,h5
    2208    1956   00A5A 33                             rlc    a
    2209    1957   00A5B F575                           mov    h5,a
    2210    1958   00A5D D576CF                         djnz   h6,div161            ;16 keer herhalen
    2211    1959   00A60                  
    2212    1960   00A60                  ; de berekening is klaar. uitkomsten in passende registers
    2213    1961   00A60                  
    2214    1962   00A60 AA74                           mov    r2,h4                ;quotient
    2215    1963   00A62 AB75                           mov    r3,h5
    2216    1964   00A64                  
    2217    1965   00A64 A870                           mov    r0,h0                ;rest
    2218    1966   00A66 A971                           mov    r1,h1
    2219    1967   00A68                  
    2220    1968   00A68 D076                           pop    h6                   ;registers herstellen
    2221    1969   00A6A D075                           pop    h5
    2222    1970   00A6C D074                           pop    h4
    2223    1971   00A6E D073                           pop    h3
    2224    1972   00A70 D072                           pop    h2
    2225    1973   00A72 D071                           pop    h1
    2226    1974   00A74 D070                           pop    h0
    2227    1975   00A76 D0D0                           pop    psw
    2228    1976   00A78 D0E0                           pop    acc
    2229    1977   00A7A 22                             ret
    2230    1978   00A7B                  
    2231    1979   00A7B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2232    1980   00A7B                  ;
    2233    1981   00A7B                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2234    1982   00A7B                  ;
    2235    1983   00A7B                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2236    1984   00A7B                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2237    1985   00A7B                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2238    1986   00A7B                  ;
    2239    1987   00A7B                  ; r4,r3,r2,r1,r0 worden aangepast
    2240    1988   00A7B                  ;
    2241    1989   00A7B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2242    1990   00A7B                  
    2243    1991   00A7B C0E0             add32:        push   acc                  ;registers op de stack zetten
    2244    1992   00A7D C0D0                           push   psw
    2245    1993   00A7F E8                             mov    a,r0                 ;eerste 8 bit
    2246    1994   00A80 2C                             add    a,r4
    2247    1995   00A81 F8                             mov    r0,a                 ;klaar
    2248    1996   00A82 E9                             mov    a,r1                 ;volgende 8 bit
    2249    1997   00A83 3D                             addc   a,r5
    2250    1998   00A84 F9                             mov    r1,a                 ;klaar
    2251    1999   00A85 EA                             mov    a,r2                 ;volgende 8 bit
    2252    2000   00A86 3E                             addc   a,r6
    2253    2001   00A87 FA                             mov    r2,a                 ;klaar
    2254    2002   00A88 EB                             mov    a,r3                 ;laatste 8 bit
    2255    2003   00A89 3F                             addc   a,r7
    2256    2004   00A8A FB                             mov    r3,a                 ;32 bit klaar
    2257    2005   00A8B 7400                           mov    a,#000h
    2258    2006   00A8D 3400                           addc   a,#000h              ;carry verrekenen
    2259    2007   00A8F FC                             mov    r4,a
    2260    2008   00A90 D0D0                           pop    psw                  ;registers herstellen
    2261    2009   00A92 D0E0                           pop    acc
    2262    2010   00A94 22                             ret
    2263    2011   00A95                  
    2264    2012   00A95                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2265    2013   00A95                  ;
    2266    2014   00A95                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2267    2015   00A95                  ;
    2268    2016   00A95                  ; input:      r1,r0 = eerste getal (r1=msb)
    2269    2017   00A95                  ;             r3,r2 = tweede getal (r3=msb)
    2270    2018   00A95                  ; output:     r2,r1,r0 (r2=msb)
    2271    2019   00A95                  ;
    2272    2020   00A95                  ; r3,r2,r1,r0 worden aangepast
    2273    2021   00A95                  ;
    2274    2022   00A95                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2275    2023   00A95                  
    2276    2024   00A95 C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2277    2025   00A97 C0D0                           push   psw
    2278    2026   00A99 E8                             mov    a,r0                 ;starten met de optelling
    2279    2027   00A9A 2A                             add    a,r2                 ;8 bit klaar
    2280    2028   00A9B F8                             mov    r0,a                 ;uitkomst wegschrijven
    2281    2029   00A9C E9                             mov    a,r1                 ;volgende 8 bit
    2282    2030   00A9D 3B                             addc   a,r3                 ;16 bit klaar
    2283    2031   00A9E F9                             mov    r1,a                 ;uitkomst weggeschreven
    2284    2032   00A9F 7400                           mov    a,#000h              ;carry verrekenen
    2285    2033   00AA1 3400                           addc   a,#000h
    2286    2034   00AA3 FA                             mov    r2,a                 ;24 bit klaar
    2287    2035   00AA4 D0D0                           pop    psw                  ;registers herstellen
    2288    2036   00AA6 D0E0                           pop    acc
    2289    2037   00AA8 22                             ret
    2290    2038   00AA9                  
    2291    2039   00AA9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2292    2040   00AA9                  ;
    2293    2041   00AA9                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2294    2042   00AA9                  ;             40 bit groot. (eerste -tweede)
    2295    2043   00AA9                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2296    2044   00AA9                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2297    2045   00AA9                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2298    2046   00AA9                  ;
    2299    2047   00AA9                  ; r4,r3,r2,r1,r0 worden aangepast
    2300    2048   00AA9                  ;
    2301    2049   00AA9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2302    2050   00AA9                  
    2303    2051   00AA9 C0E0             sub32:        push   acc                  ;registers bewaren
    2304    2052   00AAB C0D0                           push   psw                  ;ook de vlaggen
    2305    2053   00AAD C3                             clr    c                    ;zit nog effe in de weg
    2306    2054   00AAE E8                             mov    a,r0                 ;eerste 8 bit
    2307    2055   00AAF 9C                             subb   a,r4
    2308    2056   00AB0 F8                             mov    r0,a
    2309    2057   00AB1 E9                             mov    a,r1                 ;tweede 8 bit
    2310    2058   00AB2 9D                             subb   a,r5
    2311    2059   00AB3 F9                             mov    r1,a
    2312    2060   00AB4 EA                             mov    a,r2                 ;volgende 8 bit
    2313    2061   00AB5 9E                             subb   a,r6
    2314    2062   00AB6 FA                             mov    r2,a
    2315    2063   00AB7 EB                             mov    a,r3                 ;laatste 8 bit
    2316    2064   00AB8 9F                             subb   a,r7
    2317    2065   00AB9 FB                             mov    r3,a
    2318    2066   00ABA 7400                           mov    a,#000h              ;nu nog de carry
    2319    2067   00ABC 9400                           subb   a,#000h
    2320    2068   00ABE FC                             mov    r4,a                 ;40 bit klaar
    2321    2069   00ABF D0D0                           pop    psw                  ;registers herstellen
    2322    2070   00AC1 D0E0                           pop    acc
    2323    2071   00AC3 22                             ret
    2324    2072   00AC4                  
    2325    2073   00AC4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2326    2074   00AC4                  ;
    2327    2075   00AC4                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2328    2076   00AC4                  ;             24 bit groot. (eerste - tweede)
    2329    2077   00AC4                  ; input:      r1,r0 = eerste getal (r1=msb)
    2330    2078   00AC4                  ;             r3,r2 = tweede getal (r3=msb)
    2331    2079   00AC4                  ; output:     r2,r1,r0 (r2=msb)
    2332    2080   00AC4                  ;
    2333    2081   00AC4                  ; r3,r2,r1,r0 worden aangepast
    2334    2082   00AC4                  ;
    2335    2083   00AC4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2336    2084   00AC4                  
    2337    2085   00AC4 C0E0             sub16:        push   acc                  ;registers bewaren
    2338    2086   00AC6 C0D0                           push   psw
    2339    2087   00AC8 C3                             clr    c                    ;mag nog niet meespelen
    2340    2088   00AC9 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2341    2089   00ACA 9A                             subb   a,r2
    2342    2090   00ACB F8                             mov    r0,a                 ;klaar
    2343    2091   00ACC E9                             mov    a,r1
    2344    2092   00ACD 9B                             subb   a,r3                 ;16 bit klaar
    2345    2093   00ACE F9                             mov    r1,a
    2346    2094   00ACF 7400                           mov    a,#000h
    2347    2095   00AD1 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2348    2096   00AD3 FA                             mov    r2,a                 ;24 bit klaar
    2349    2097   00AD4 D0D0                           pop    psw                  ;registers herstellen
    2350    2098   00AD6 D0E0                           pop    acc
    2351    2099   00AD8 22                             ret
    2352    2100   00AD9                  
    2353    2101   00AD9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2354    2102   00AD9                  ;
    2355    2103   00AD9                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2356    2104   00AD9                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2357    2105   00AD9                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2358    2106   00AD9                  ;
    2359    2107   00AD9                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2360    2108   00AD9                  ;
    2361    2109   00AD9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2362    2110   00AD9                  
    2363    2111   00AD9 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2364    2112   00ADB C0D0                           push   psw
    2365    2113   00ADD                  
    2366    2114   00ADD C077                           push   h7                   ;nodig
    2367    2115   00ADF C078                           push   h8
    2368    2116   00AE1                  
    2369    2117   00AE1 C079                           push   h9                   ;ook
    2370    2118   00AE3                  
    2371    2119   00AE3 757905                         mov    h9,#005h             ;loopcounter
    2372    2120   00AE6                  
    2373    2121   00AE6 7B00             hexbcd161:    mov    r3,#000h
    2374    2122   00AE8 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2375    2123   00AEA 120A08                         lcall  div16                ;deling uitvoeren
    2376    2124   00AED E8                             mov    a,r0                 ;rest
    2377    2125   00AEE C0E0                           push   acc                  ;op stack zetten
    2378    2126   00AF0 EA                             mov    a,r2
    2379    2127   00AF1 F8                             mov    r0,a
    2380    2128   00AF2 EB                             mov    a,r3
    2381    2129   00AF3 F9                             mov    r1,a                 ;uitkomst terug delen
    2382    2130   00AF4 D579EF                         djnz   h9,hexbcd161
    2383    2131   00AF7                  
    2384    2132   00AF7 D0E0                           pop    acc                  ;hoogste bits van de stack
    2385    2133   00AF9 FA                             mov    r2,a                 ;klaar
    2386    2134   00AFA D0E0                           pop    acc
    2387    2135   00AFC C4                             swap   a
    2388    2136   00AFD F579                           mov    h9,a
    2389    2137   00AFF D0E0                           pop    acc
    2390    2138   00B01 2579                           add    a,h9
    2391    2139   00B03 F9                             mov    r1,a                 ;volgende 8 klaar
    2392    2140   00B04 D0E0                           pop    acc
    2393    2141   00B06 C4                             swap   a
    2394    2142   00B07 F579                           mov    h9,a
    2395    2143   00B09 D0E0                           pop    acc
    2396    2144   00B0B 2579                           add    a,h9
    2397    2145   00B0D F8                             mov    r0,a                 ;klaar
    2398    2146   00B0E                  
    2399    2147   00B0E D079                           pop    h9                   ;was naar de knoppen
    2400    2148   00B10                  
    2401    2149   00B10 D078                           pop    h8                   ;gebruikt
    2402    2150   00B12 D077                           pop    h7
    2403    2151   00B14                  
    2404    2152   00B14 D0D0                           pop    psw                  ;registers herstellen
    2405    2153   00B16 D0E0                           pop    acc
    2406    2154   00B18 22                             ret
    2407    2155   00B19                  
    2408    2156   00B19                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2409    2157   00B19                  ;
    2410    2158   00B19                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2411    2159   00B19                  ; input       a (maximale waarde = 63h)
    2412    2160   00B19                  ; output      a
    2413    2161   00B19                  ;
    2414    2162   00B19                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2415    2163   00B19                  
    2416    2164   00B19 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2417    2165   00B1B C0F0                           push   b
    2418    2166   00B1D 75F00A                         mov    b,#00ah              ;hierdoor delen
    2419    2167   00B20 84                             div    ab                   ;in accu qoutient in b rest
    2420    2168   00B21 C4                             swap   a
    2421    2169   00B22 25F0                           add    a,b                  ;bcd getal klaar
    2422    2170   00B24 D0F0                           pop    b
    2423    2171   00B26 D0D0                           pop    psw
    2424    2172   00B28 22                             ret
    2425    2173   00B29                  
    2426    2174   00B29                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2427    2175   00B29                  ;
    2428    2176   00B29                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2429    2177   00B29                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2430    2178   00B29                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2431    2179   00B29                  ;
    2432    2180   00B29                  ; de routine gebruikt r1,r0 van de huidige bank
    2433    2181   00B29                  ;
    2434    2182   00B29                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2435    2183   00B29                  
    2436    2184   00B29 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2437    2185   00B2B C0E0                           push   acc
    2438    2186   00B2D C0D0                           push   psw
    2439    2187   00B2F                  
    2440    2188   00B2F E8                             mov    a,r0
    2441    2189   00B30 540F                           anl    a,#00fh              ;eenheden
    2442    2190   00B32 C0E0                           push   acc                  ;effe bewaren
    2443    2191   00B34                  
    2444    2192   00B34 E8                             mov    a,r0
    2445    2193   00B35 C4                             swap   a
    2446    2194   00B36 540F                           anl    a,#00fh              ;tientallen
    2447    2195   00B38 75F00A                         mov    b,#00ah              ;waarde berekenen
    2448    2196   00B3B A4                             mul    ab                   ;klaar
    2449    2197   00B3C D0F0                           pop    b                    ;truukje
    2450    2198   00B3E 25F0                           add    a,b                  ;a is lage deel hex getal
    2451    2199   00B40 C0E0                           push   acc                  ;straks nodig
    2452    2200   00B42                  
    2453    2201   00B42 E9                             mov    a,r1                 ;hoge deel
    2454    2202   00B43 54F0                           anl    a,#0f0h
    2455    2203   00B45 C4                             swap   a
    2456    2204   00B46 C0E0                           push   acc                  ;straks nodig
    2457    2205   00B48                  
    2458    2206   00B48 E9                             mov    a,r1
    2459    2207   00B49 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2460    2208   00B4B 75F064                         mov    b,#100               ;waarde uitrekenen
    2461    2209   00B4E A4                             mul    ab
    2462    2210   00B4F A9F0                           mov    r1,b
    2463    2211   00B51 F8                             mov    r0,a
    2464    2212   00B52                  
    2465    2213   00B52 D0E0                           pop    acc
    2466    2214   00B54 75F00A                         mov    b,#10
    2467    2215   00B57 A4                             mul    ab                   ;kan nog in a
    2468    2216   00B58 75F064                         mov    b,#100               ;*10*100=*1000
    2469    2217   00B5B A4                             mul    ab
    2470    2218   00B5C 28                             add    a,r0
    2471    2219   00B5D F8                             mov    r0,a
    2472    2220   00B5E E9                             mov    a,r1
    2473    2221   00B5F 35F0                           addc   a,b
    2474    2222   00B61 F9                             mov    r1,a
    2475    2223   00B62                  
    2476    2224   00B62 D0E0                           pop    acc
    2477    2225   00B64 28                             add    a,r0
    2478    2226   00B65 F8                             mov    r0,a
    2479    2227   00B66 7400                           mov    a,#000h
    2480    2228   00B68 39                             addc   a,r1
    2481    2229   00B69 F9                             mov    r1,a                 ;klaar
    2482    2230   00B6A                  
    2483    2231   00B6A D0D0                           pop    psw
    2484    2232   00B6C D0E0                           pop    acc
    2485    2233   00B6E D0F0                           pop    b
    2486    2234   00B70 22                             ret
    2487    2235   00B71                  
    2488    2236   00B71                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2489    2237   00B71                  ;
    2490    2238   00B71                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2491    2239   00B71                  ; input:      a (maximale waarde 99h)
    2492    2240   00B71                  ; output:     a
    2493    2241   00B71                  ;
    2494    2242   00B71                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2495    2243   00B71                  
    2496    2244   00B71 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2497    2245   00B73 C0F0                           push   b
    2498    2246   00B75 C070                           push   h0
    2499    2247   00B77 F570                           mov    h0,a                 ;effe bewaren
    2500    2248   00B79 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2501    2249   00B7C 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2502    2250   00B7E C4                             swap   a
    2503    2251   00B7F 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2504    2252   00B82 A4                             mul    ab
    2505    2253   00B83 2570                           add    a,h0                 ;eenheden bijtellen
    2506    2254   00B85 D070                           pop    h0
    2507    2255   00B87 D0F0                           pop    b
    2508    2256   00B89 D0D0                           pop    psw
    2509    2257   00B8B 22                             ret
    2510    2258   00B8C                  
    2511    2259   00B8C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2512    2260   00B8C                  ;
    2513    2261   00B8C                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2514    2262   00B8C                  ;
    2515    2263   00B8C                  ; Gebruikt geen registers
    2516    2264   00B8C                  ;
    2517    2265   00B8C                  ; Originele auteur: Danny Pawels (dp)
    2518    2266   00B8C                  ;
    2519    2267   00B8C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2520    2268   00B8C                  
    2521    2269   00B8C                  
    2522    2270   00B8C C083             XCsw2xtal:  push  dph
    2523    2271   00B8E C082                         push  dpl
    2524    2272   00B90 C0D0                         push  psw
    2525    2273   00B92 C08F                         push  syscon0
    2526    2274   00B94 C0B2                         push  port_page
    2527    2275   00B96 C0BF                         push  scu_page
    2528    2276   00B98                  
    2529    2277   00B98 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2530    2278   00B9B 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2531    2279   00B9E                  
    2532    2280   00B9E 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2533    2281   00BA1                                                            ;freq= VCO-free running =5MHz...20MHz?
    2534    2282   00BA1 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2535    2283   00BA4 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2536    2284   00BA7 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2537    2285   00BAA                  
    2538    2286   00BAA 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2539    2287   00BAD A3               XCsw2xtal0: inc   dptr
    2540    2288   00BAE E582                         mov   a,dpl
    2541    2289   00BB0 4583                         orl   a,dph
    2542    2290   00BB2 70F9                         jnz   XCsw2xtal0
    2543    2291   00BB4                  
    2544    2292   00BB4 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2545    2293   00BB7                  
    2546    2294   00BB7                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2547    2295   00BB7 E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2548    2296   00BB9 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2549    2297   00BBC                  ;Oscillator run detectie is klaar...
    2550    2298   00BBC 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2551    2299   00BBF                  
    2552    2300   00BBF                  
    2553    2301   00BBF E5B7                         mov   a,pll_con               ;lees pll_con
    2554    2302   00BC1 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2555    2303   00BC3 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2556    2304   00BC5                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2557    2305   00BC5                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2558    2306   00BC5                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2559    2307   00BC5 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2560    2308   00BC8                                                            ;bij aanpassing van de NDIV van de PLL
    2561    2309   00BC8 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2562    2310   00BCA 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2563    2311   00BCD 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2564    2312   00BD0                  
    2565    2313   00BD0 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2566    2314   00BD2 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2567    2315   00BD5                  
    2568    2316   00BD5 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2569    2317   00BD8 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2570    2318   00BDB                  
    2571    2319   00BDB D0BF                         pop   scu_page                ;herstel controller status
    2572    2320   00BDD D0B2                         pop   port_page
    2573    2321   00BDF D08F                         pop   syscon0
    2574    2322   00BE1 D0D0                         pop   psw
    2575    2323   00BE3 D082                         pop   dpl
    2576    2324   00BE5 D083                         pop   dph
    2577    2325   00BE7 22                           ret
    2578    2326   00BE8                  
    2579    2327   00BE8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2580    2328   00BE8                  ;
    2581    2329   00BE8                  ; mapregs	selecteer de SFR's in de mapped area
    2582    2330   00BE8                  ;
    2583    2331   00BE8                  ;
    2584    2332   00BE8                  ; Past syscon SFR aan
    2585    2333   00BE8                  ;
    2586    2334   00BE8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2587    2335   00BE8                  
    2588    2336   00BE8 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2589    2337   00BEB 22               		ret
    2590    2338   00BEC                  
    2591    2339   00BEC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2592    2340   00BEC                  ;
    2593    2341   00BEC                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2594    2342   00BEC                  ;
    2595    2343   00BEC                  ; Past syscon SFR aan
    2596    2344   00BEC                  ;
    2597    2345   00BEC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2598    2346   00BEC                  
    2599    2347   00BEC 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2600    2348   00BEF 22               		ret
    2601    2349   00BF0                  
    2602    2350   00BF0                  ;*******************************************************************************
    2603    2351   00BF0                  ;
    2604    2352   00BF0                  ; These are the register declarations for the XC888 microcontroller from
    2605    2353   00BF0                  ; Infineon.
    2606    2354   00BF0                  ;
    2607    2355   00BF0                  ;*******************************************************************************
    2608    2356   00BF0                  
    2609    2357   00BF0                  ;*******************************************************************************
    2610    2358   00BF0                  ;
    2611    2359   00BF0                  ; CPU registers are accessible independend of paging and mapping
    2612    2360   00BF0                  ; (always accessible)
    2613    2361   00BF0                  ;
    2614    2362   00BF0                  ;*******************************************************************************
    2615    2363   00BF0                  
    2616    2364   00BF0                  sp            data   081h          ;stack pointer                     reset=007h
    2617    2365   00BF0                  dpl           data   082h          ;datapointer low register          reset=000h
    2618    2366   00BF0                  dph           data   083h          ;datapointer high register         reset=000h
    2619    2367   00BF0                  pcon          data   087h          ;power control                     reset=000h
    2620    2368   00BF0                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2621    2369   00BF0                  ;tcon is bit addressable
    2622    2370   00BF0                         tf1    bit    08fh
    2623    2371   00BF0                         tr1    bit    08eh
    2624    2372   00BF0                         tf0    bit    08dh
    2625    2373   00BF0                         tr0    bit    08ch
    2626    2374   00BF0                         ie1    bit    08bh
    2627    2375   00BF0                         it1    bit    08ah
    2628    2376   00BF0                         ie0    bit    089h
    2629    2377   00BF0                         it0    bit    088h
    2630    2378   00BF0                  
    2631    2379   00BF0                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2632    2380   00BF0                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2633    2381   00BF0                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2634    2382   00BF0                  th0           data   08ch          ;timer 0 high                      reset=000h
    2635    2383   00BF0                  th1           data   08dh          ;timer 1 high                      reset=000h
    2636    2384   00BF0                  
    2637    2385   00BF0                  syscon0       data   08fh          ;system control register 0         reset=004h
    2638    2386   00BF0                  scon          data   098h          ;serial channel 0 control          reset=000h
    2639    2387   00BF0                  ;scon is bit addressable
    2640    2388   00BF0                         sm0    bit    09fh
    2641    2389   00BF0                         sm1    bit    09eh
    2642    2390   00BF0                         sm2    bit    09dh
    2643    2391   00BF0                         ren    bit    09ch
    2644    2392   00BF0                         tb8    bit    09bh
    2645    2393   00BF0                         rb8    bit    09ah
    2646    2394   00BF0                         ti     bit    099h
    2647    2395   00BF0                         ri     bit    098h
    2648    2396   00BF0                  
    2649    2397   00BF0                  sbuf          data   099h          ;serial data buffer channel 0
    2650    2398   00BF0                  eo            data   0a2h          ;extended operation                reset=000h
    2651    2399   00BF0                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2652    2400   00BF0                  ;ien0 is bit addressable
    2653    2401   00BF0                         ea     bit    0afh
    2654    2402   00BF0                                                     ;bit not implemented
    2655    2403   00BF0                         et2    bit    0adh
    2656    2404   00BF0                         es     bit    0ach
    2657    2405   00BF0                         et1    bit    0abh
    2658    2406   00BF0                         ex1    bit    0aah
    2659    2407   00BF0                         et0    bit    0a9h
    2660    2408   00BF0                         ex0    bit    0a8h
    2661    2409   00BF0                  
    2662    2410   00BF0                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2663    2411   00BF0                  ;ip is bit addressable
    2664    2412   00BF0                                                     ;bit not implemented
    2665    2413   00BF0                                                     ;bit not implemented
    2666    2414   00BF0                         pt2    bit    0bdh
    2667    2415   00BF0                         ps     bit    0bch
    2668    2416   00BF0                         pt1    bit    0bbh
    2669    2417   00BF0                         px1    bit    0bah
    2670    2418   00BF0                         pt0    bit    0b9h
    2671    2419   00BF0                         px0    bit    0b8h
    2672    2420   00BF0                  
    2673    2421   00BF0                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2674    2422   00BF0                  psw           data   0d0h          ;program status word               reset=000h
    2675    2423   00BF0                  ;psw is bit addressable
    2676    2424   00BF0                         cy     bit    0d7h
    2677    2425   00BF0                         ac     bit    0d6h
    2678    2426   00BF0                         f0     bit    0d5h
    2679    2427   00BF0                         rs1    bit    0d4h
    2680    2428   00BF0                         rs0    bit    0d3h
    2681    2429   00BF0                         ov     bit    0d2h
    2682    2430   00BF0                         f1     bit    0d1h
    2683    2431   00BF0                         p      bit    0d0h
    2684    2432   00BF0                  
    2685    2433   00BF0                  acc           data   0e0h          ;accumulator                       reset=000h
    2686    2434   00BF0                  ;acc is bit addressable
    2687    2435   00BF0                  
    2688    2436   00BF0                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2689    2437   00BF0                  ;ien1 is bit addressable
    2690    2438   00BF0                         eccip3 bit    0efh
    2691    2439   00BF0                         eccip2 bit    0eeh
    2692    2440   00BF0                         eccip1 bit    0edh
    2693    2441   00BF0                         eccip0 bit    0ech
    2694    2442   00BF0                         exm    bit    0ebh
    2695    2443   00BF0                         ex2    bit    0eah
    2696    2444   00BF0                         essc   bit    0e9h
    2697    2445   00BF0                         eadc   bit    0e8h
    2698    2446   00BF0                  
    2699    2447   00BF0                  b             data   0f0h          ;b register                        reset=000h
    2700    2448   00BF0                  ;b is bit addressable
    2701    2449   00BF0                  
    2702    2450   00BF0                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2703    2451   00BF0                  ;ip1 is bit addressable
    2704    2452   00BF0                         pccip3 bit    0ffh
    2705    2453   00BF0                         pccip2 bit    0feh
    2706    2454   00BF0                         pccip1 bit    0fdh
    2707    2455   00BF0                         pccip0 bit    0fch
    2708    2456   00BF0                         pxm    bit    0fbh
    2709    2457   00BF0                         px2    bit    0fah
    2710    2458   00BF0                         pssc   bit    0f9h
    2711    2459   00BF0                         padc   bit    0f8h
    2712    2460   00BF0                  
    2713    2461   00BF0                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2714    2462   00BF0                  
    2715    2463   00BF0                  
    2716    2464   00BF0                  ;*******************************************************************************
    2717    2465   00BF0                  ;
    2718    2466   00BF0                  ; system control registers registers that can only be accessed in the non
    2719    2467   00BF0                  ; mapped memory area (rmap=0) page independent
    2720    2468   00BF0                  ;
    2721    2469   00BF0                  ;*******************************************************************************
    2722    2470   00BF0                  
    2723    2471   00BF0                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2724    2472   00BF0                  
    2725    2473   00BF0                  ;*******************************************************************************
    2726    2474   00BF0                  ;
    2727    2475   00BF0                  ; system control registers registers that can only be accessed in the non
    2728    2476   00BF0                  ; mapped memory area (rmap=0) and page 0
    2729    2477   00BF0                  ;
    2730    2478   00BF0                  ;*******************************************************************************
    2731    2479   00BF0                  
    2732    2480   00BF0                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2733    2481   00BF0                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2734    2482   00BF0                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2735    2483   00BF0                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2736    2484   00BF0                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2737    2485   00BF0                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2738    2486   00BF0                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2739    2487   00BF0                  nmisr         data   0bch          ;nmi status                        reset=000h
    2740    2488   00BF0                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2741    2489   00BF0                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2742    2490   00BF0                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2743    2491   00BF0                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2744    2492   00BF0                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2745    2493   00BF0                  
    2746    2494   00BF0                  ;*******************************************************************************
    2747    2495   00BF0                  ;
    2748    2496   00BF0                  ; system control registers registers that can only be accessed in the non
    2749    2497   00BF0                  ; mapped memory area (rmap=0) and page 1
    2750    2498   00BF0                  ;
    2751    2499   00BF0                  ;*******************************************************************************
    2752    2500   00BF0                  
    2753    2501   00BF0                  id            data   0b3h          ;identity register     reset=device dependent
    2754    2502   00BF0                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2755    2503   00BF0                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2756    2504   00BF0                  osc_con       data   0b6h          ;osc control                       reset=008h
    2757    2505   00BF0                  pll_con       data   0b7h          ;pll control                       reset=090h
    2758    2506   00BF0                  cmcon         data   0bah          ;clock control                     reset=010h
    2759    2507   00BF0                  passwd        data   0bbh          ;password register                 reset=007h
    2760    2508   00BF0                  feal          data   0bch          ;flash error register              reset=000h
    2761    2509   00BF0                  feah          data   0bdh          ;flash error address high          reset=000h
    2762    2510   00BF0                  cocon         data   0beh          ;clock output control              reset=000h
    2763    2511   00BF0                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2764    2512   00BF0                  
    2765    2513   00BF0                  ;*******************************************************************************
    2766    2514   00BF0                  ;
    2767    2515   00BF0                  ; system control registers registers that can only be accessed in the non
    2768    2516   00BF0                  ; mapped memory area (rmap=0) and page 3
    2769    2517   00BF0                  ;
    2770    2518   00BF0                  ;*******************************************************************************
    2771    2519   00BF0                  
    2772    2520   00BF0                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2773    2521   00BF0                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2774    2522   00BF0                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2775    2523   00BF0                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2776    2524   00BF0                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2777    2525   00BF0                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2778    2526   00BF0                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2779    2527   00BF0                  
    2780    2528   00BF0                  ;*******************************************************************************
    2781    2529   00BF0                  ;
    2782    2530   00BF0                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2783    2531   00BF0                  ;
    2784    2532   00BF0                  ;*******************************************************************************
    2785    2533   00BF0                  
    2786    2534   00BF0                  port_page     data   0b2h          ;port page register                reset=000h
    2787    2535   00BF0                  
    2788    2536   00BF0                  ;*******************************************************************************
    2789    2537   00BF0                  ;
    2790    2538   00BF0                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2791    2539   00BF0                  ;
    2792    2540   00BF0                  ;*******************************************************************************
    2793    2541   00BF0                  
    2794    2542   00BF0                  p0_data       data   080h          ;port 0 data register              reset=000h
    2795    2543   00BF0                  ;p0_data is bit addressable
    2796    2544   00BF0                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2797    2545   00BF0                  p1_data       data   090h          ;port 1 data register              reset=000h
    2798    2546   00BF0                  ;p1_data is bit addressable
    2799    2547   00BF0                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2800    2548   00BF0                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2801    2549   00BF0                  ;p2_data is bit addressable
    2802    2550   00BF0                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2803    2551   00BF0                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2804    2552   00BF0                  ;p3_data is bit addressable
    2805    2553   00BF0                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2806    2554   00BF0                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2807    2555   00BF0                  ;p4_data is bit addressable
    2808    2556   00BF0                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2809    2557   00BF0                  p5_data       data   092h          ;port 5 data register              reset=000h
    2810    2558   00BF0                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2811    2559   00BF0                  
    2812    2560   00BF0                  ;*******************************************************************************
    2813    2561   00BF0                  ;
    2814    2562   00BF0                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2815    2563   00BF0                  ;
    2816    2564   00BF0                  ;*******************************************************************************
    2817    2565   00BF0                  
    2818    2566   00BF0                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2819    2567   00BF0                  ;p0_data is bit addressable
    2820    2568   00BF0                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2821    2569   00BF0                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2822    2570   00BF0                  ;p1_data is bit addressable
    2823    2571   00BF0                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2824    2572   00BF0                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2825    2573   00BF0                  ;p2_data is bit addressable
    2826    2574   00BF0                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2827    2575   00BF0                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2828    2576   00BF0                  ;p3_data is bit addressable
    2829    2577   00BF0                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2830    2578   00BF0                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2831    2579   00BF0                  ;p4_data is bit addressable
    2832    2580   00BF0                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2833    2581   00BF0                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2834    2582   00BF0                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2835    2583   00BF0                  
    2836    2584   00BF0                  ;*******************************************************************************
    2837    2585   00BF0                  ;
    2838    2586   00BF0                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2839    2587   00BF0                  ;
    2840    2588   00BF0                  ;*******************************************************************************
    2841    2589   00BF0                  
    2842    2590   00BF0                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2843    2591   00BF0                  ;p0_data is bit addressable
    2844    2592   00BF0                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2845    2593   00BF0                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2846    2594   00BF0                  ;p1_data is bit addressable
    2847    2595   00BF0                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2848    2596   00BF0                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2849    2597   00BF0                  ;p3_data is bit addressable
    2850    2598   00BF0                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2851    2599   00BF0                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2852    2600   00BF0                  ;p4_data is bit addressable
    2853    2601   00BF0                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2854    2602   00BF0                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2855    2603   00BF0                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2856    2604   00BF0                  
    2857    2605   00BF0                  ;*******************************************************************************
    2858    2606   00BF0                  ;
    2859    2607   00BF0                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2860    2608   00BF0                  ;
    2861    2609   00BF0                  ;*******************************************************************************
    2862    2610   00BF0                  
    2863    2611   00BF0                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2864    2612   00BF0                  ;p0_data is bit addressable
    2865    2613   00BF0                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2866    2614   00BF0                  ;p1_data is bit addressable
    2867    2615   00BF0                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2868    2616   00BF0                  ;p3_data is bit addressable
    2869    2617   00BF0                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2870    2618   00BF0                  ;p4_data is bit addressable
    2871    2619   00BF0                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2872    2620   00BF0                  
    2873    2621   00BF0                  ;*******************************************************************************
    2874    2622   00BF0                  ;
    2875    2623   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2876    2624   00BF0                  ;
    2877    2625   00BF0                  ;*******************************************************************************
    2878    2626   00BF0                  
    2879    2627   00BF0                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2880    2628   00BF0                  
    2881    2629   00BF0                  ;*******************************************************************************
    2882    2630   00BF0                  ;
    2883    2631   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2884    2632   00BF0                  ;
    2885    2633   00BF0                  ;*******************************************************************************
    2886    2634   00BF0                  
    2887    2635   00BF0                  adc_globctr   data   0cah          ;global control register           reset=030h
    2888    2636   00BF0                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2889    2637   00BF0                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2890    2638   00BF0                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2891    2639   00BF0                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2892    2640   00BF0                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2893    2641   00BF0                  
    2894    2642   00BF0                  ;*******************************************************************************
    2895    2643   00BF0                  ;
    2896    2644   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2897    2645   00BF0                  ;
    2898    2646   00BF0                  ;*******************************************************************************
    2899    2647   00BF0                  
    2900    2648   00BF0                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2901    2649   00BF0                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2902    2650   00BF0                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2903    2651   00BF0                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2904    2652   00BF0                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2905    2653   00BF0                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2906    2654   00BF0                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2907    2655   00BF0                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2908    2656   00BF0                  
    2909    2657   00BF0                  ;*******************************************************************************
    2910    2658   00BF0                  ;
    2911    2659   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2912    2660   00BF0                  ;
    2913    2661   00BF0                  ;*******************************************************************************
    2914    2662   00BF0                  
    2915    2663   00BF0                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2916    2664   00BF0                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2917    2665   00BF0                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2918    2666   00BF0                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2919    2667   00BF0                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2920    2668   00BF0                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2921    2669   00BF0                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2922    2670   00BF0                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2923    2671   00BF0                  
    2924    2672   00BF0                  ;*******************************************************************************
    2925    2673   00BF0                  ;
    2926    2674   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2927    2675   00BF0                  ;
    2928    2676   00BF0                  ;*******************************************************************************
    2929    2677   00BF0                  
    2930    2678   00BF0                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2931    2679   00BF0                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2932    2680   00BF0                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2933    2681   00BF0                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2934    2682   00BF0                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2935    2683   00BF0                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2936    2684   00BF0                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2937    2685   00BF0                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2938    2686   00BF0                  
    2939    2687   00BF0                  ;*******************************************************************************
    2940    2688   00BF0                  ;
    2941    2689   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2942    2690   00BF0                  ;
    2943    2691   00BF0                  ;*******************************************************************************
    2944    2692   00BF0                  
    2945    2693   00BF0                  adc_rcr0      data   0cah          ;result control register           reset=000h
    2946    2694   00BF0                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    2947    2695   00BF0                  adc_rcr2      data   0cch          ;result control register           reset=000h
    2948    2696   00BF0                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    2949    2697   00BF0                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    2950    2698   00BF0                  
    2951    2699   00BF0                  ;*******************************************************************************
    2952    2700   00BF0                  ;
    2953    2701   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    2954    2702   00BF0                  ;
    2955    2703   00BF0                  ;*******************************************************************************
    2956    2704   00BF0                  
    2957    2705   00BF0                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    2958    2706   00BF0                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    2959    2707   00BF0                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    2960    2708   00BF0                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    2961    2709   00BF0                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    2962    2710   00BF0                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    2963    2711   00BF0                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    2964    2712   00BF0                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    2965    2713   00BF0                  
    2966    2714   00BF0                  ;*******************************************************************************
    2967    2715   00BF0                  ;
    2968    2716   00BF0                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    2969    2717   00BF0                  ;
    2970    2718   00BF0                  ;*******************************************************************************
    2971    2719   00BF0                  
    2972    2720   00BF0                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    2973    2721   00BF0                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    2974    2722   00BF0                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    2975    2723   00BF0                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    2976    2724   00BF0                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    2977    2725   00BF0                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    2978    2726   00BF0                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    2979    2727   00BF0                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    2980    2728   00BF0                  
    2981    2729   00BF0                  ;*******************************************************************************
    2982    2730   00BF0                  
    2983    2731   00BF0                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    2984    2732   00BF0                  ;
    2985    2733   00BF0                  ;*******************************************************************************
    2986    2734   00BF0                  
    2987    2735   00BF0                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    2988    2736   00BF0                  ;t2_t2con is bit addressable
    2989    2737   00BF0                         tf2    bit    0c7h
    2990    2738   00BF0                         exf2   bit    0c6h
    2991    2739   00BF0                                                     ;2 bits are not implemented
    2992    2740   00BF0                         exen2  bit    0c3h
    2993    2741   00BF0                         tr2    bit    0c2h
    2994    2742   00BF0                         ct2    bit    0c1h
    2995    2743   00BF0                         cprl2  bit    0c0h
    2996    2744   00BF0                  
    2997    2745   00BF0                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    2998    2746   00BF0                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    2999    2747   00BF0                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3000    2748   00BF0                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3001    2749   00BF0                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3002    2750   00BF0                  
    3003    2751   00BF0                  ;*******************************************************************************
    3004    2752   00BF0                  ;
    3005    2753   00BF0                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3006    2754   00BF0                  ;
    3007    2755   00BF0                  ;*******************************************************************************
    3008    2756   00BF0                  
    3009    2757   00BF0                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3010    2758   00BF0                  
    3011    2759   00BF0                  ;*******************************************************************************
    3012    2760   00BF0                  ;
    3013    2761   00BF0                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3014    2762   00BF0                  ;
    3015    2763   00BF0                  ;*******************************************************************************
    3016    2764   00BF0                  
    3017    2765   00BF0                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3018    2766   00BF0                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3019    2767   00BF0                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3020    2768   00BF0                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3021    2769   00BF0                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3022    2770   00BF0                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3023    2771   00BF0                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3024    2772   00BF0                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3025    2773   00BF0                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3026    2774   00BF0                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3027    2775   00BF0                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3028    2776   00BF0                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3029    2777   00BF0                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3030    2778   00BF0                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3031    2779   00BF0                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3032    2780   00BF0                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3033    2781   00BF0                  
    3034    2782   00BF0                  ;*******************************************************************************
    3035    2783   00BF0                  ;
    3036    2784   00BF0                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3037    2785   00BF0                  ;
    3038    2786   00BF0                  ;*******************************************************************************
    3039    2787   00BF0                  
    3040    2788   00BF0                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3041    2789   00BF0                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3042    2790   00BF0                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3043    2791   00BF0                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3044    2792   00BF0                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3045    2793   00BF0                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3046    2794   00BF0                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3047    2795   00BF0                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3048    2796   00BF0                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3049    2797   00BF0                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3050    2798   00BF0                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3051    2799   00BF0                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3052    2800   00BF0                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3053    2801   00BF0                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3054    2802   00BF0                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3055    2803   00BF0                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3056    2804   00BF0                  
    3057    2805   00BF0                  ;*******************************************************************************
    3058    2806   00BF0                  ;
    3059    2807   00BF0                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3060    2808   00BF0                  ;
    3061    2809   00BF0                  ;*******************************************************************************
    3062    2810   00BF0                  
    3063    2811   00BF0                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3064    2812   00BF0                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3065    2813   00BF0                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3066    2814   00BF0                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3067    2815   00BF0                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3068    2816   00BF0                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3069    2817   00BF0                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3070    2818   00BF0                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3071    2819   00BF0                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3072    2820   00BF0                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3073    2821   00BF0                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3074    2822   00BF0                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3075    2823   00BF0                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3076    2824   00BF0                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3077    2825   00BF0                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3078    2826   00BF0                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3079    2827   00BF0                  
    3080    2828   00BF0                  ;*******************************************************************************
    3081    2829   00BF0                  ;
    3082    2830   00BF0                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3083    2831   00BF0                  ;
    3084    2832   00BF0                  ;*******************************************************************************
    3085    2833   00BF0                  
    3086    2834   00BF0                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3087    2835   00BF0                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3088    2836   00BF0                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3089    2837   00BF0                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3090    2838   00BF0                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3091    2839   00BF0                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3092    2840   00BF0                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3093    2841   00BF0                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3094    2842   00BF0                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3095    2843   00BF0                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3096    2844   00BF0                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3097    2845   00BF0                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3098    2846   00BF0                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3099    2847   00BF0                  
    3100    2848   00BF0                  ;*******************************************************************************
    3101    2849   00BF0                  ;
    3102    2850   00BF0                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3103    2851   00BF0                  ;
    3104    2852   00BF0                  ;*******************************************************************************
    3105    2853   00BF0                  
    3106    2854   00BF0                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3107    2855   00BF0                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3108    2856   00BF0                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3109    2857   00BF0                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3110    2858   00BF0                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3111    2859   00BF0                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3112    2860   00BF0                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3113    2861   00BF0                  
    3114    2862   00BF0                  ;*******************************************************************************
    3115    2863   00BF0                  ;
    3116    2864   00BF0                  ; can registers can be accessed in the standard memory map (rmap=0)
    3117    2865   00BF0                  ;
    3118    2866   00BF0                  ;*******************************************************************************
    3119    2867   00BF0                  
    3120    2868   00BF0                  adcon         data   0d8h          ;adres/data control                reset=000h
    3121    2869   00BF0                  ; adcon is bit addressable
    3122    2870   00BF0                         v3     bit    0dfh
    3123    2871   00BF0                         v2     bit    0deh
    3124    2872   00BF0                         v1     bit    0ddh
    3125    2873   00BF0                         v0     bit    0dch
    3126    2874   00BF0                         auad1  bit    0dbh
    3127    2875   00BF0                         auad0  bit    0dah
    3128    2876   00BF0                         can_bsy bit   0d9h
    3129    2877   00BF0                         rwen   bit    0d8h
    3130    2878   00BF0                  
    3131    2879   00BF0                  adl           data   0d9h          ;adres register low                reset=000h
    3132    2880   00BF0                  adh           data   0dah          ;adres register low                reset=000h
    3133    2881   00BF0                  data0         data   0dbh          ;can data                          reset=000h
    3134    2882   00BF0                  data1         data   0dch          ;can data                          reset=000h
    3135    2883   00BF0                  data2         data   0ddh          ;can data                          reset=000h
    3136    2884   00BF0                  data3         data   0deh          ;can data                          reset=000h
    3137    2885   00BF0                  
    3138    2886   00BF0                  ;*******************************************************************************
    3139    2887   00BF0                  ;
    3140    2888   00BF0                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3141    2889   00BF0                  ;
    3142    2890   00BF0                  ;*******************************************************************************
    3143    2891   00BF0                  
    3144    2892   00BF0                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3145    2893   00BF0                  ;mdustat is bit addressable
    3146    2894   00BF0                                                     ;5 bits are not implemented
    3147    2895   00BF0                         bsy    bit    0b2h
    3148    2896   00BF0                         ierr   bit    0b1h
    3149    2897   00BF0                         irdy   bit    0b0h
    3150    2898   00BF0                  
    3151    2899   00BF0                  mducon        data   0b1h          ;mdu control                       reset=000h
    3152    2900   00BF0                  md0           data   0b2h          ;mdu operand register              reset=000h
    3153    2901   00BF0                  mr0           data   0b2h          ;mdu result register               reset=000h
    3154    2902   00BF0                  md1           data   0b3h          ;mdu operand register              reset=000h
    3155    2903   00BF0                  mr1           data   0b3h          ;mdu result register               reset=000h
    3156    2904   00BF0                  md2           data   0b4h          ;mdu operand register              reset=000h
    3157    2905   00BF0                  mr2           data   0b4h          ;mdu result register               reset=000h
    3158    2906   00BF0                  md3           data   0b5h          ;mdu operand register              reset=000h
    3159    2907   00BF0                  mr3           data   0b5h          ;mdu result register               reset=000h
    3160    2908   00BF0                  md4           data   0b6h          ;mdu operand register              reset=000h
    3161    2909   00BF0                  mr4           data   0b6h          ;mdu result register               reset=000h
    3162    2910   00BF0                  md5           data   0b7h          ;mdu operand register              reset=000h
    3163    2911   00BF0                  mr5           data   0b7h          ;mdu result register               reset=000h
    3164    2912   00BF0                  
    3165    2913   00BF0                  ;*******************************************************************************
    3166    2914   00BF0                  ;
    3167    2915   00BF0                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3168    2916   00BF0                  ;
    3169    2917   00BF0                  ;*******************************************************************************
    3170    2918   00BF0                  
    3171    2919   00BF0                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3172    2920   00BF0                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3173    2921   00BF0                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3174    2922   00BF0                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3175    2923   00BF0                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3176    2924   00BF0                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3177    2925   00BF0                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3178    2926   00BF0                  ;cd_statc is bit addressable
    3179    2927   00BF0                         keepz  bit    0a7h
    3180    2928   00BF0                         keepy  bit    0a6h
    3181    2929   00BF0                         keepx  bit    0a5h
    3182    2930   00BF0                         dmap   bit    0a4h
    3183    2931   00BF0                         int_en bit    0a3h
    3184    2932   00BF0                         eoc    bit    0a2h
    3185    2933   00BF0                         error  bit    0a1h
    3186    2934   00BF0                         cd_bsy bit    0a0h
    3187    2935   00BF0                  
    3188    2936   00BF0                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3189    2937   00BF0                  
    3190    2938   00BF0                  ;*******************************************************************************
    3191    2939   00BF0                  ;
    3192    2940   00BF0                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3193    2941   00BF0                  ;
    3194    2942   00BF0                  ;*******************************************************************************
    3195    2943   00BF0                  
    3196    2944   00BF0                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3197    2945   00BF0                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3198    2946   00BF0                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3199    2947   00BF0                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3200    2948   00BF0                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3201    2949   00BF0                  
    3202    2950   00BF0                  ;*******************************************************************************
    3203    2951   00BF0                  ;
    3204    2952   00BF0                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3205    2953   00BF0                  ;
    3206    2954   00BF0                  ;*******************************************************************************
    3207    2955   00BF0                  
    3208    2956   00BF0                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3209    2957   00BF0                  ;t2_t2con is bit addressable bits are aalready defined
    3210    2958   00BF0                         ;tf2    bit    0c7h
    3211    2959   00BF0                         ;exf2   bit    0c6h
    3212    2960   00BF0                                                     ;2 bits are not implemented
    3213    2961   00BF0                         ;exen2  bit    0c3h
    3214    2962   00BF0                         ;tr2    bit    0c2h
    3215    2963   00BF0                         ;ct2    bit    0c1h
    3216    2964   00BF0                         ;cprl2  bit    0c0h
    3217    2965   00BF0                  
    3218    2966   00BF0                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3219    2967   00BF0                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3220    2968   00BF0                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3221    2969   00BF0                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3222    2970   00BF0                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3223    2971   00BF0                  
    3224    2972   00BF0                  ;*******************************************************************************
    3225    2973   00BF0                  ;
    3226    2974   00BF0                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3227    2975   00BF0                  ;
    3228    2976   00BF0                  ;*******************************************************************************
    3229    2977   00BF0                  
    3230    2978   00BF0                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3231    2979   00BF0                  ;s1con is bit addressable
    3232    2980   00BF0                         sm01   bit    0cfh
    3233    2981   00BF0                         sm11   bit    0ceh
    3234    2982   00BF0                         sm21   bit    0cdh
    3235    2983   00BF0                         ren1   bit    0cch
    3236    2984   00BF0                         tb81   bit    0cbh
    3237    2985   00BF0                         rb81   bit    0cah
    3238    2986   00BF0                         ti1    bit    0c9h
    3239    2987   00BF0                         ri1    bit    0c8h
    3240    2988   00BF0                  
    3241    2989   00BF0                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3242    2990   00BF0                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3243    2991   00BF0                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3244    2992   00BF0                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3245    2993   00BF0                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3246    2994   00BF0                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3247    2995   00BF0                  
    3248    2996   00BF0                  ;*******************************************************************************
    3249    2997   00BF0                  ;
    3250    2998   00BF0                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3251    2999   00BF0                  ;
    3252    3000   00BF0                  ;*******************************************************************************
    3253    3001   00BF0                  
    3254    3002   00BF0                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3255    3003   00BF0                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3256    3004   00BF0                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3257    3005   00BF0                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3258    3006   00BF0                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3259    3007   00BF0                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3260    3008   00BF0                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3261    3009   00BF0                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3262    3010   00BF0                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3263    3011   00BF0                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3264    3012   00BF0                  
    3265    3013   00BF0                  ;end directive must be used, but has no signification
    3266    3014   00BF0                  
    3267    3015   00BF0                  end
    3268    3016   00BF0                  
    3269    3017   00BF0                  
    3270    3018   00BF0                  
    3271    3019   00BF0                  
    3272    3020   00BF0                  
    3273    3021   00BF0                  
    3274    3022   00BF0                  
    3275    3023   00BF0                  
    3276    3024   00BF0                  
    3277    3025   00BF0                  
    3278    3026   00BF0                  
    3279    3027   00BF0                  
    3280    3028   00BF0                  
    3281    3029   00BF0                  
    3282    3030   00BF0                  
    3283    3031   00BF0                  
