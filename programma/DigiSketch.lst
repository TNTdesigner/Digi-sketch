C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.asm 
       1       1   00000                  
       2       2   00000                  org 0000h
       3       3   00000 020003           ljmp   main
       4       4   00003                  
       5       5   00003                  ;------------------------------------------------------------------
       6       6   00003                  ;Hoofd programma
       7       7   00003                  ;------------------------------------------------------------------
       8       8   00003                  main:
       9       9   00003 75817F               mov     sp,#7fh                 ;stackpointer instellen
      10      10   00006 12000C               lcall   inits
      11      11   00009                  
      12      12   00009                  lus:
      13      13   00009                  
      14      14   00009 020009           ljmp    lus
      15      15   0000C                  
      16      16   0000C                  
      17      17   0000C                  ;------------------------------------------------------------------
      18      18   0000C                  ;Initializatie van alle componenten nodig in het hoofd programma
      19      19   0000C                  ;------------------------------------------------------------------
      20      20   0000C                  inits:
      21      21   0000C 75B200               mov     port_page,#000h         ;selecteer poort page 0
      22      22   0000F 120041               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      23      23   00012                  
      24      24   00012 22               ret
      25      25   00013                  
      26      26   00013                  
project.inc 
      28       1   00013                  ;------------------------------------------------------------------
      29       2   00013                  ;Lijst van functies:
      30       3   00013                  ;   -statusCheck            Status check van scherm opslaan in STA register
      31       4   00013                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      32       5   00013                  ;   -debug                  debug info op seriele poot zetten
      33       6   00013                  ;------------------------------------------------------------------
      34       7   00013                  ;------------------------------------------------------------------
      35       8   00013                  ;declaratie van pinnen
      36       9   00013                  ;------------------------------------------------------------------
      37      10   00013                      WR          bit     p3_data.0   ;write line van scherm actief laag
      38      11   00013                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      39      12   00013                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      40      13   00013                      CD          bit     p3_data.3   ;Command write
      41      14   00013                      RESET       bit     p0_data.1   ;reset van scherm actief laag
      42      15   00013                      FS          bit     p0_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      43      16   00013                  
      44      17   00013                  
      45      18   00013                  
      46      19   00013                  ;------------------------------------------------------------------
      47      20   00013                  ;declaratie van registers
      48      21   00013                  ;------------------------------------------------------------------
      49      22   00013                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      50      23   00013                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      51      24   00013                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      52      25   00013                  
      53      26   00013                  
      54      27   00013                  ;------------------------------------------------------------------
      55      28   00013                  ;Status check van scherm opslaan in STA register
      56      29   00013                  ;-STA
      57      30   00013                  ;------------------------------------------------------------------
      58      31   00013                  statusCheck:
      59      32   00013 C0E0                 push    acc
      60      33   00015 C0D0                 push    psw
      61      34   00017 C210                 clr     STA                     ;STA register leeg maken
      62      35   00019 75C900               mov     p4_dir,#000h            ;p4 als input zetten
      63      36   0001C D2B3                 setb    CD
      64      37   0001E D2B0                 setb    WR
      65      38   00020                  stan:
      66      39   00020 C2B2                 clr     CE
      67      40   00022 C2B1                 clr     RD
      68      41   00024 E5C8                 mov     a,p4_data
      69      42   00026 D2B1                 setb    RD
      70      43   00028 D2B3                 setb    CD
      71      44   0002A F8                   mov     r0,a
      72      45   0002B 120122               lcall   debug
      73      46   0002E F510                 mov     STA,a                   ;bijhouden voor eventueel gebruik
      74      47   00030 5403                 anl     a,#03h                  ;masker voor STA0 en STA1
      75      48   00032 B403EB               cjne    a,#03h,stan
      76      49   00035 F8                   mov     r0,a
      77      50   00036 120122               lcall   debug
      78      51   00039 75C9FF               mov     p4_dir,#0ffh
      79      52   0003C D0D0                 pop     psw
      80      53   0003E D0E0                 pop     acc
      81      54   00040 22               ret
      82      55   00041                  
      83      56   00041                  ;------------------------------------------------------------------
      84      57   00041                  ;Initializatie van grafisch LCD scherm
      85      58   00041                  ;-Poort 1
      86      59   00041                  ;------------------------------------------------------------------
      87      60   00041                  initGLCD:
      88      61   00041 1204ED               lcall   initsio                 ;voor debug
      89      62   00044 7586FF               mov     p0_dir,#0ffh            ;poort 1 als output
      90      63   00047 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output
      91      64   0004A D2B2                 setb    CE
      92      65   0004C D2B0                 setb    WR
      93      66   0004E D2B1                 setb    RD
      94      67   00050 D280                 setb    FS                      ;font op 6*8 zetten
      95      68   00052 C281                 clr     RESET                   ;reseten van scherm
      96      69   00054 1202CD               lcall   delay1ms
      97      70   00057 D281                 setb    RESET                   ;reset terug af zetten
      98      71   00059 120013               lcall   statusCheck             ;initiele status check uitvoeren
      99      72   0005C                  
     100      73   0005C                      ;Graphics home address
     101      74   0005C 751100               mov     DATAREG,#00h
     102      75   0005F 1200CF               lcall   dataWrite
     103      76   00062 751100               mov     DATAREG,#00h
     104      77   00065 1200CF               lcall   dataWrite
     105      78   00068 751242               mov     COMANDREG,#42h
     106      79   0006B 120108               lcall   comandWrite
     107      80   0006E                  
     108      81   0006E                      ;Graphics area set
     109      82   0006E 75111E               mov     DATAREG,#1eh
     110      83   00071 1200CF               lcall   dataWrite
     111      84   00074 751100               mov     DATAREG,#00h
     112      85   00077 1200CF               lcall   dataWrite
     113      86   0007A 751243               mov     COMANDREG,#43h
     114      87   0007D 120108               lcall   comandWrite
     115      88   00080                  
     116      89   00080                      ;text home address
     117      90   00080 751100               mov     DATAREG,#00h
     118      91   00083 1200CF               lcall   dataWrite
     119      92   00086 751100               mov     DATAREG,#00h
     120      93   00089 1200CF               lcall   dataWrite
     121      94   0008C 751240               mov     COMANDREG,#40h
     122      95   0008F 120108               lcall   comandWrite
     123      96   00092                  
     124      97   00092                      ;text area set
     125      98   00092 75111E               mov     DATAREG,#1eh
     126      99   00095 1200CF               lcall   dataWrite
     127     100   00098 751100               mov     DATAREG,#00h
     128     101   0009B 1200CF               lcall   dataWrite
     129     102   0009E 751241               mov     COMANDREG,#41h
     130     103   000A1 120108               lcall   comandWrite
     131     104   000A4                  
     132     105   000A4                      ;Mode set
     133     106   000A4 751281               mov     COMANDREG,#81h
     134     107   000A7 120108               lcall   comandWrite
     135     108   000AA                  
     136     109   000AA                      ;adres data pointer
     137     110   000AA 751100               mov     DATAREG,#00h            ;lower address
     138     111   000AD 1200CF               lcall   dataWrite
     139     112   000B0 751100               mov     DATAREG,#00h
     140     113   000B3 1200CF               lcall   dataWrite
     141     114   000B6 751224               mov     COMANDREG,#24h
     142     115   000B9 120108               lcall   comandWrite
     143     116   000BC                  
     144     117   000BC                      ;Display mode
     145     118   000BC 751298               mov     COMANDREG,#98h
     146     119   000BF 120108               lcall   comandWrite
     147     120   000C2                  
     148     121   000C2                      ;letter A
     149     122   000C2 75117F               mov     DATAREG,#7fh
     150     123   000C5 1200CF               lcall   dataWrite
     151     124   000C8 7512C0               mov     COMANDREG,#c0h
     152     125   000CB 120108               lcall   comandWrite
     153     126   000CE                  
     154     127   000CE 22               ret
     155     128   000CF                  
     156     129   000CF                  ;------------------------------------------------------------------
     157     130   000CF                  ;Data naar het schem sturen
     158     131   000CF                  ;-DATAREG
     159     132   000CF                  ;------------------------------------------------------------------
     160     133   000CF                  DataWrite:
     161     134   000CF C0E0                 push    acc
     162     135   000D1 C0D0                 push    psw
     163     136   000D3 120013               lcall   statusCheck             ;status checken
     164     137   000D6 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     165     138   000D9 C2B3                 clr     CD
     166     139   000DB 00                   nop
     167     140   000DC C2B2                 clr     CE
     168     141   000DE C2B0                 clr     WR
     169     142   000E0 00                   nop
     170     143   000E1 D2B2                 setb    CE
     171     144   000E3 D2B0                 setb    WR
     172     145   000E5 D0D0                 pop     psw
     173     146   000E7 D0E0                 pop     acc
     174     147   000E9 22               ret
     175     148   000EA                  
     176     149   000EA                  ;------------------------------------------------------------------
     177     150   000EA                  ;data van het scherm inlezen
     178     151   000EA                  ;-DATAREG
     179     152   000EA                  ;------------------------------------------------------------------
     180     153   000EA                  DataRead:
     181     154   000EA C0E0                 push    acc
     182     155   000EC C0D0                 push    psw
     183     156   000EE 120013               lcall   statusCheck             ;status checken
     184     157   000F1 75C900               mov     p4_dir,#000h            ;p4 als ingang
     185     158   000F4 C2B3                 clr     CD
     186     159   000F6 C2B1                 clr     RD
     187     160   000F8 D2B0                 setb    WR
     188     161   000FA C2B2                 clr     CE
     189     162   000FC 00                   nop                             ;wachten
     190     163   000FD 00                   nop
     191     164   000FE 85C811               mov     DATAREG,p4_data         ;data inlezeen van scherm
     192     165   00101 D2B2                 setb    CE
     193     166   00103 D0D0                 pop     psw
     194     167   00105 D0E0                 pop     acc
     195     168   00107 22               ret
     196     169   00108                  
     197     170   00108                  ;------------------------------------------------------------------
     198     171   00108                  ;comando naar het scherrm sturen
     199     172   00108                  ;-COMANDREG
     200     173   00108                  ;------------------------------------------------------------------
     201     174   00108                  ComandWrite:
     202     175   00108 C0E0                 push    acc
     203     176   0010A C0D0                 push    psw
     204     177   0010C 120013               lcall   statusCheck             ;status checken
     205     178   0010F 8512C8               mov     p4_data,COMANDREG       ;comando op de bus zetten
     206     179   00112 D2B3                 setb    CD
     207     180   00114 C2B0                 clr     WR
     208     181   00116 C2B2                 clr     CE
     209     182   00118 00                   nop
     210     183   00119 D2B2                 setb    CE
     211     184   0011B D2B0                 setb    WR
     212     185   0011D D0D0                 pop     psw
     213     186   0011F D0E0                 pop     acc
     214     187   00121 22               ret
     215     188   00122                  
     216     189   00122                  ;------------------------------------------------------------------
     217     190   00122                  ;debug info op seriele poort zetten
     218     191   00122                  ;-r0
     219     192   00122                  ;------------------------------------------------------------------
     220     193   00122                  debug:
     221     194   00122 C0E0                 push    acc
     222     195   00124 C0D0                 push    psw
     223     196   00126 740D                 mov     a,#0dh
     224     197   00128 120525               lcall   siooutchar
     225     198   0012B E8                   mov     a,r0
     226     199   0012C 120541               lcall   siooutbyte
     227     200   0012F 740A                 mov     a,#0ah
     228     201   00131 120525               lcall   siooutchar
     229     202   00134 D0D0                 pop     psw
     230     203   00136 D0E0                 pop     acc
     231     204   00138 22               ret
     232     205   00139                  
     233     206   00139                  
     234     207   00139                  
     235     208   00139                  
xcez1.inc 
     237       1   00139                  ;*******************************************************************************
     238       2   00139                  ;
     239       3   00139                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     240       4   00139                  ;
     241       5   00139                  ; The file contains drivers for various hardware and math applications.
     242       6   00139                  ; In addition all register declarations are added.
     243       7   00139                  ;
     244       8   00139                  ; WARNING:!!!!!!!
     245       9   00139                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     246      10   00139                  ;
     247      11   00139                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     248      12   00139                  ;
     249      13   00139                  ;*******************************************************************************
     250      14   00139                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     251      15   00139                  ;
     252      16   00139                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     253      17   00139                  ;
     254      18   00139                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     255      19   00139                  ; eenvoudige manier te gebruiken:
     256      20   00139                  ;
     257      21   00139                  ; standaard I/O:
     258      22   00139                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     259      23   00139                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     260      24   00139                  ;      initleds             klaar zetten LED's als outputs
     261      25   00139                  ;
     262      26   00139                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     263      27   00139                  ;      initiic              klaar zetten iic interface
     264      28   00139                  ;      iicstart             genereren van een startconditie op iic poort
     265      29   00139                  ;      iicstop              genereren stop conditie op iic poort
     266      30   00139                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     267      31   00139                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     268      32   00139                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     269      33   00139                  ;
     270      34   00139                  ; LCD interace
     271      35   00139                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     272      36   00139                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     273      37   00139                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     274      38   00139                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     275      39   00139                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     276      40   00139                  ;      lcdlighton           backlight aan
     277      41   00139                  ;      lcdlightoff          backlight uit
     278      42   00139                  ;      lcdbuzon             buzzer aan
     279      43   00139                  ;      lcdbuzof             buzzer uit
     280      44   00139                  ;
     281      45   00139                  ; Seriële interface (via USB stekker!!)
     282      46   00139                  ;      initsio              klaar zetten seriële poort 9600 baud
     283      47   00139                  ;      siooutchar           afdrukken ascii code (accu=input)
     284      48   00139                  ;      siooutbyte           afdrkken getal in accu
     285      49   00139                  ;      siooutnib            afdrukken 4 laagste bits accu
     286      50   00139                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     287      51   00139                  ;      sioinchar            inlezen van 1 ascii code in de accu
     288      52   00139                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     289      53   00139                  ;
     290      54   00139                  ; ADC
     291      55   00139                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     292      56   00139                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     293      57   00139                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     294      58   00139                  ;
     295      59   00139                  ; Arithmetic:
     296      60   00139                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     297      61   00139                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     298      62   00139                  ;      div16                delen 2 16 bit getallen
     299      63   00139                  ;      div32                delen 2 32 bit getallen
     300      64   00139                  ;      add16                optellen 2 16 bit getallen
     301      65   00139                  ;      add32                optellen 2 32 bit getallen
     302      66   00139                  ;      sub16                verschil 2 16 bit getallen
     303      67   00139                  ;      sub32                verschil 2 32 bit getallen
     304      68   00139                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     305      69   00139                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     306      70   00139                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     307      71   00139                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     308      72   00139                  ;
     309      73   00139                  ; Diverse
     310      74   00139                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     311      75   00139                  ;      delay1ms             tijdsverraging 1 milliseconde
     312      76   00139                  ;      delay10us            tijdsvertraging 10 microseconde
     313      77   00139                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     314      78   00139                  ;	mapregs 		selecteer de SFR's in de mapped area
     315      79   00139                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     316      80   00139                  ;
     317      81   00139                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     318      82   00139                  ; LET OP!!!!
     319      83   00139                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     320      84   00139                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     321      85   00139                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     322      86   00139                  ;
     323      87   00139                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     324      88   00139                  ;
     325      89   00139                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     326      90   00139                  
     327      91   00139                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     328      92   00139                  ;
     329      93   00139                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     330      94   00139                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     331      95   00139                  ; massa zonder extra weerstanden.
     332      96   00139                  ;
     333      97   00139                  ; Gebruikt geen registers
     334      98   00139                  ;
     335      99   00139                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     336     100   00139                  
     337     101   00139 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     338     102   0013B 758F04                         mov    syscon0,#004h
     339     103   0013E C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     340     104   00140 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     341     105   00143 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     342     106   00146 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     343     107   00149 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     344     108   0014C 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     345     109   0014F D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     346     110   00151 D08F                           pop    syscon0              ;pagina terug herstellen
     347     111   00153 22                             ret
     348     112   00154                  
     349     113   00154                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     350     114   00154                  ;
     351     115   00154                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     352     116   00154                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     353     117   00154                  ; 2 behouden hun originele instelling.
     354     118   00154                  ;
     355     119   00154                  ; Gebruikt geen registers
     356     120   00154                  ;
     357     121   00154                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     358     122   00154                  
     359     123   00154 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     360     124   00156 758F04                         mov    syscon0,#004h
     361     125   00159 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     362     126   0015B 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     363     127   0015E 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     364     128   00161 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     365     129   00164 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     366     130   00167 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     367     131   0016A D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     368     132   0016C D08F                           pop    syscon0              ;pagina terug herstellen
     369     133   0016E 22                             ret
     370     134   0016F                  
     371     135   0016F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     372     136   0016F                  ;
     373     137   0016F                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     374     138   0016F                  ; worden gedoofd (actief laag om ze te laden branden).
     375     139   0016F                  ;
     376     140   0016F                  ; Gebruikt geen registers
     377     141   0016F                  ;
     378     142   0016F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     379     143   0016F                  
     380     144   0016F                  
     381     145   0016F C08F             initleds:     push   syscon0              ;juiste map selecteren
     382     146   00171 758F04                         mov    syscon0,#004h
     383     147   00174 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     384     148   00176 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     385     149   00179 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     386     150   0017C D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     387     151   0017E D08F                           pop    syscon0              ;pagina terug herstellen
     388     152   00180 22                             ret
     389     153   00181                  
     390     154   00181                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     391     155   00181                  ;
     392     156   00181                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     393     157   00181                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     394     158   00181                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     395     159   00181                  ; sda wordt als input geschakeld
     396     160   00181                  ;
     397     161   00181                  ; LET OP!!
     398     162   00181                  ; Dit is een IIC bus met beperkte mogelijkheden:
     399     163   00181                  ; -vaste communicatiesnleheid van 100kbit/s
     400     164   00181                  ; -enkel master mode
     401     165   00181                  ; -enkel 7 bit adressering
     402     166   00181                  ; -geen klok stretching
     403     167   00181                  ;
     404     168   00181                  ; Gebruikt geen registers
     405     169   00181                  ;
     406     170   00181                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     407     171   00181                  
     408     172   00181                  sda           bit    p0_data.7            ;pin gebruikt als sda
     409     173   00181                  scl           bit    p0_data.3            ;pin gebruikt als scl
     410     174   00181                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     411     175   00181                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     412     176   00181                  
     413     177   00181 C08F             initiic:      push   syscon0              ;juiste map selecteren
     414     178   00183 758F04                         mov    syscon0,#004h
     415     179   00186 C0B2                           push   port_page
     416     180   00188 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     417     181   0018B D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     418     182   0018D D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     419     183   0018F 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     420     184   00192 D283                           setb   scl                  ;klok werkt als od
     421     185   00194 D287                           setb   sda                  ;sda werkt als od
     422     186   00196 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     423     187   00199 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     424     188   0019C 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     425     189   0019F D0B2                           pop    port_page            ;pagina herstellen
     426     190   001A1 D08F                           pop    syscon0              ;map herstellen
     427     191   001A3 22                             ret
     428     192   001A4                  
     429     193   001A4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     430     194   001A4                  ;
     431     195   001A4                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     432     196   001A4                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     433     197   001A4                  ; te garanderen volgt er een delay van 10us
     434     198   001A4                  ;
     435     199   001A4                  ; Gebruikt geen registers
     436     200   001A4                  ;
     437     201   001A4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     438     202   001A4                  
     439     203   001A4 C08F             iicstart:     push   syscon0              ;map bewaren
     440     204   001A6 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     441     205   001A9 C0B2                           push   port_page            ;pagina bewaren
     442     206   001AB 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     443     207   001AE D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     444     208   001B0 D287                           setb   sda                  ;idem
     445     209   001B2 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     446     210   001B5 1202A5                         lcall  delay10us            ;
     447     211   001B8 C287                           clr    sda                  ;data laag
     448     212   001BA 1202A5                         lcall  delay10us
     449     213   001BD C283                           clr    scl                  ;dan klok laag
     450     214   001BF 1202A5                         lcall  delay10us            ;bit lang genoeg maken
     451     215   001C2 D0B2                           pop    port_page            ;registers herstellen
     452     216   001C4 D08F                           pop    syscon0
     453     217   001C6 22                             ret
     454     218   001C7                  
     455     219   001C7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     456     220   001C7                  ;
     457     221   001C7                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     458     222   001C7                  ;
     459     223   001C7                  ; Gebruikt geen registers
     460     224   001C7                  ;
     461     225   001C7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     462     226   001C7                  
     463     227   001C7 C08F             iicstop:      push   syscon0              ;map bewaren
     464     228   001C9 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     465     229   001CC C0B2                           push   port_page            ;pagina bewaren
     466     230   001CE 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     467     231   001D1 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     468     232   001D4 C287                           clr    sda                  ;data naar omlaag
     469     233   001D6 1202A5                         lcall  delay10us
     470     234   001D9 D283                           setb   scl                  ;klok naar 1
     471     235   001DB 1202A5                         lcall  delay10us            ;wachten
     472     236   001DE D287                           setb   sda                  ;idem data
     473     237   001E0 1202A5                         lcall  delay10us            ;
     474     238   001E3 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     475     239   001E6 D0B2                           pop    port_page            ;registers herstellen
     476     240   001E8 D08F                           pop    syscon0
     477     241   001EA 22                             ret
     478     242   001EB                  
     479     243   001EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     480     244   001EB                  ;
     481     245   001EB                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     482     246   001EB                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     483     247   001EB                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     484     248   001EB                  ;
     485     249   001EB                  ; Gebruikt:
     486     250   001EB                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     487     251   001EB                  ;      cy=ack bit vanuit de slave
     488     252   001EB                  ;
     489     253   001EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     490     254   001EB                  
     491     255   001EB C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     492     256   001ED C0F0                           push   b                    ;gebruikt als loopcounter
     493     257   001EF C08F                           push   syscon0              ;map juist zetten
     494     258   001F1 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     495     259   001F4 C0B2                           push   port_page            ;poort pagina bewaren
     496     260   001F6 75B200                         mov    port_page,#000h      ;basispagina selecteren
     497     261   001F9 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     498     262   001FC 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     499     263   001FF 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     500     264   00200 9287                           mov    sda,c                ;op pin
     501     265   00202 1202A5                         lcall  delay10us            ;wachten
     502     266   00205 D283                           setb   scl                  ;puls genereren
     503     267   00207 1202A5                         lcall  delay10us            ;ook hier wat tijd laten
     504     268   0020A C283                           clr    scl                  ;klok terug laag maken
     505     269   0020C D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     506     270   0020F                  
     507     271   0020F                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     508     272   0020F                  
     509     273   0020F 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     510     274   00212 1202A5                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     511     275   00215 D283                           setb   scl                  ;puls terug hoog
     512     276   00217 A287                           mov    c,sda                ;inlezen en naar carry
     513     277   00219 1202A5                         lcall  delay10us
     514     278   0021C C283                           clr    scl                  ;klok blijft laag achter
     515     279   0021E D0B2                           pop    port_page
     516     280   00220 D08F                           pop    syscon0
     517     281   00222 D0F0                           pop    b
     518     282   00224 D0E0                           pop    acc
     519     283   00226 22                             ret
     520     284   00227                  
     521     285   00227                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     522     286   00227                  ;
     523     287   00227                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     524     288   00227                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     525     289   00227                  ;
     526     290   00227                  ; Gebruikt:
     527     291   00227                  ;      -de accu als output
     528     292   00227                  ;
     529     293   00227                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     530     294   00227                  
     531     295   00227 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     532     296   00229 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     533     297   0022C C0B2                           push   port_page            ;pagina bewaren
     534     298   0022E 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     535     299   00231 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     536     300   00233 C0D0                           push   psw                  ;vlaggen bewaren
     537     301   00235 75F008                         mov    b,#008h              ;loopcounter laden
     538     302   00238 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     539     303   0023B 1202A5           iicinbyteack1:lcall  delay10us
     540     304   0023E D283                           setb   scl                  ;klok hoog
     541     305   00240 A287                           mov    c,sda                ;pin inlezen
     542     306   00242 33                             rlc    a                    ;in accu shiften
     543     307   00243 1202A5                         lcall  delay10us
     544     308   00246 C283                           clr    scl                  ;klok terug laag
     545     309   00248 D5F0F0                         djnz   b,iicinbyteack1
     546     310   0024B 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     547     311   0024E C287                           clr    sda                  ;ack genereren
     548     312   00250 1202A5                         lcall  delay10us
     549     313   00253 D283                           setb   scl
     550     314   00255 1202A5                         lcall  delay10us
     551     315   00258 C283                           clr    scl
     552     316   0025A 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     553     317   0025D D0D0                           pop    psw                  ;registers herstellen
     554     318   0025F D0F0                           pop    b
     555     319   00261 D0B2                           pop    port_page
     556     320   00263 D08F                           pop    syscon0
     557     321   00265 22                             ret
     558     322   00266                  
     559     323   00266                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     560     324   00266                  ;
     561     325   00266                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     562     326   00266                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     563     327   00266                  ;
     564     328   00266                  ; Gebruikt:
     565     329   00266                  ;      -de accu als output
     566     330   00266                  ;
     567     331   00266                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     568     332   00266                  
     569     333   00266 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     570     334   00268 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     571     335   0026B C0B2                           push   port_page            ;pagina bewaren
     572     336   0026D 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     573     337   00270 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     574     338   00272 C0D0                           push   psw                  ;vlaggen bewaren
     575     339   00274 75F008                         mov    b,#008h              ;loopcounter laden
     576     340   00277 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     577     341   0027A 1202A5           iicinbytenack1:lcall  delay10us
     578     342   0027D D283                           setb   scl                  ;klok hoog
     579     343   0027F A287                           mov    c,sda                ;pin inlezen
     580     344   00281 33                             rlc    a                    ;in accu shiften
     581     345   00282 1202A5                         lcall  delay10us
     582     346   00285 C283                           clr    scl                  ;klok terug laag
     583     347   00287 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     584     348   0028A 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     585     349   0028D D287                           setb   sda                  ;nack genereren
     586     350   0028F 1202A5                         lcall  delay10us
     587     351   00292 D283                           setb   scl
     588     352   00294 1202A5                         lcall  delay10us
     589     353   00297 C283                           clr    scl
     590     354   00299 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     591     355   0029C D0D0                           pop    psw                  ;registers herstellen
     592     356   0029E D0F0                           pop    b
     593     357   002A0 D0B2                           pop    port_page
     594     358   002A2 D08F                           pop    syscon0
     595     359   002A4 22                             ret
     596     360   002A5                  
     597     361   002A5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     598     362   002A5                  ;
     599     363   002A5                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     600     364   002A5                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     601     365   002A5                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     602     366   002A5                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     603     367   002A5                  ;
     604     368   002A5                  ; Gebruikt geen registers
     605     369   002A5                  ;
     606     370   002A5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     607     371   002A5                  
     608     372   002A5 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     609     373   002A7 C0D0                           push   psw                  ;8*42ns=330ns
     610     374   002A9 75E01A                         mov    acc,#01ah            ;420ns
     611     375   002AC D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     612     376   002AF D0D0                           pop    psw                  ;8*42ns=330ns
     613     377   002B1 D0E0                           pop    acc                  ;8*42ns=330ns
     614     378   002B3 22                             ret                         ;165ns
     615     379   002B4                  
     616     380   002B4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     617     381   002B4                  ;
     618     382   002B4                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     619     383   002B4                  ;
     620     384   002B4                  ; Gebruikt geen registers
     621     385   002B4                  ;
     622     386   002B4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     623     387   002B4                  
     624     388   002B4 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     625     389   002B6 C0D0                           push   psw
     626     390   002B8 C0F0                           push   b
     627     391   002BA 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     628     392   002BD 1202CD           delaya0k05s1: lcall  delay1ms
     629     393   002C0 D5F0FA                         djnz   b,delaya0k05s1
     630     394   002C3 D5E0F4                         djnz   acc,delaya0k05s2
     631     395   002C6 D0F0                           pop    b                    ;registers herstellen
     632     396   002C8 D0D0                           pop    psw
     633     397   002CA D0E0                           pop    acc
     634     398   002CC 22                             ret
     635     399   002CD                  
     636     400   002CD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     637     401   002CD                  ;
     638     402   002CD                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     639     403   002CD                  ;
     640     404   002CD                  ; Gebruikt geen registers
     641     405   002CD                  ;
     642     406   002CD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     643     407   002CD                  
     644     408   002CD C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     645     409   002CF C0D0                           push   psw                  ;8*42ns=330ns
     646     410   002D1 75E064                         mov    acc,#100             ;420ns
     647     411   002D4 1202A5           delay1ms1:    lcall  delay10us            ;10us
     648     412   002D7 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     649     413   002DA D0D0                           pop    psw                  ;8*42ns=330ns
     650     414   002DC D0E0                           pop    acc                  ;8*42ns=330ns
     651     415   002DE 22                             ret                         ;165ns
     652     416   002DF                  
     653     417   002DF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     654     418   002DF                  ;
     655     419   002DF                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     656     420   002DF                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     657     421   002DF                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     658     422   002DF                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     659     423   002DF                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     660     424   002DF                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     661     425   002DF                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     662     426   002DF                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     663     427   002DF                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     664     428   002DF                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     665     429   002DF                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     666     430   002DF                  ; systemen!!!!
     667     431   002DF                  ;
     668     432   002DF                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     669     433   002DF                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     670     434   002DF                  ;       aduclcd0.inc
     671     435   002DF                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     672     436   002DF                  ;       aduclcd1.inc
     673     437   002DF                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     674     438   002DF                  ;
     675     439   002DF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     676     440   002DF                  
     677     441   002DF                  e             bit    b.1                  ;enable
     678     442   002DF                  rs            bit    b.0                  ;register select
     679     443   002DF                  backlight     bit    b.6                  ;bit waar backlight op zit
     680     444   002DF                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     681     445   002DF                  
     682     446   002DF                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     683     447   002DF                  
     684     448   002DF                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     685     449   002DF                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     686     450   002DF                  
     687     451   002DF                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     688     452   002DF                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     689     453   002DF                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     690     454   002DF                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     691     455   002DF                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     692     456   002DF                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     693     457   002DF                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     694     458   002DF                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     695     459   002DF                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     696     460   002DF                  
     697     461   002DF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     698     462   002DF                  ;
     699     463   002DF                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     700     464   002DF                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     701     465   002DF                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     702     466   002DF                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     703     467   002DF                  ;
     704     468   002DF                  ; registergebruik: geen
     705     469   002DF                  ;
     706     470   002DF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     707     471   002DF                  
     708     472   002DF C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     709     473   002E1 C0D0                           push   psw
     710     474   002E3 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     711     475   002E5 120181                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     712     476   002E8 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     713     477   002EB                                                            ;buzzer en baklight worden nu op 1 gezet
     714     478   002EB 120483                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     715     479   002EE 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     716     480   002F0 12047C           initlcd1:     lcall  delay2ms
     717     481   002F3 D5E0FA                         djnz   acc,initlcd1
     718     482   002F6 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     719     483   002F8 12043B                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     720     484   002FB 12047C                         lcall  delay2ms      ;te krijgen.
     721     485   002FE 7430                           mov    a,#00110000b
     722     486   00300 12043B                         lcall  outhnibc
     723     487   00303 12047C                         lcall  delay2ms
     724     488   00306 7430                           mov    a,#00110000b
     725     489   00308 12043B                         lcall  outhnibc
     726     490   0030B 12047C                         lcall  delay2ms
     727     491   0030E 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     728     492   00310 12043B                         lcall  outhnibc      ;hoge nibble naar het controleregister
     729     493   00313 12047C                         lcall  delay2ms      ;niet nodig volgens datasheet
     730     494   00316 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     731     495   00318 120425                         lcall  outc          ;naar display
     732     496   0031B 12047C                         lcall  delay2ms      ;is iets te lang volgens datasheet
     733     497   0031E 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     734     498   00320 120425                         lcall  outc
     735     499   00323 12047C                         lcall  delay2ms      ;ook deze delay is iets te lang
     736     500   00326 7401                           mov    a,#displayon  ;clear display and home cursor
     737     501   00328 120425                         lcall  outc
     738     502   0032B 12047C                         lcall  delay2ms      ;deze wachttijd is bijna juist
     739     503   0032E 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     740     504   00330 120425                         lcall  outc
     741     505   00333 12047C                         lcall  delay2ms      ;wachten weer veel te lang
     742     506   00336 D0F0                           pop    b             ;registers terug in orde zetten
     743     507   00338 D0D0                           pop    psw
     744     508   0033A D0E0                           pop    acc
     745     509   0033C 22                             ret                  ;einde van de initialisatie
     746     510   0033D                  
     747     511   0033D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     748     512   0033D                  ;
     749     513   0033D                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     750     514   0033D                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     751     515   0033D                  ;      00dh   =cursor in de home positie
     752     516   0033D                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     753     517   0033D                  ;      00ah   =cursor op tweede lijn plaatsen
     754     518   0033D                  ;      001h   =cursor on blink
     755     519   0033D                  ;      002h   =cursor on, no blink
     756     520   0033D                  ;      003h   =cursor off
     757     521   0033D                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     758     522   0033D                  ;
     759     523   0033D                  ; de routine gebruikt geen registers
     760     524   0033D                  ;
     761     525   0033D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     762     526   0033D                  
     763     527   0033D                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     764     528   0033D                  ; dan mag de data direct naar het dataregister van het scherm.
     765     529   0033D                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     766     530   0033D                  
     767     531   0033D                  lcdoutchar:
     768     532   0033D C0E0             outcharlcd:   push   acc           ;registers op stack
     769     533   0033F C0D0                           push   psw
     770     534   00341 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     771     535   00344 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     772     536   00346 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     773     537   00349 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     774     538   0034B                  
     775     539   0034B                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     776     540   0034B                  ; Het is dus een opdracht die we moeten uitvoeren.
     777     541   0034B                  
     778     542   0034B B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     779     543   0034E 7401                           mov    a,#cleardisp         ;scherm leegmaken
     780     544   00350 120425                         lcall  outc                 ;naar controleregister
     781     545   00353 803A                           sjmp   outcharlcde          ;afsluiten
     782     546   00355                  
     783     547   00355 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     784     548   00358 740F                           mov    a,#cursoronb         ;cursoron met blink
     785     549   0035A 120425                         lcall  outc
     786     550   0035D 8030                           sjmp   outcharlcde
     787     551   0035F                  
     788     552   0035F B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     789     553   00362 740E                           mov    a,#cursoronn         ;cursoron no blink
     790     554   00364 120425                         lcall  outc
     791     555   00367 8026                           sjmp   outcharlcde
     792     556   00369                  
     793     557   00369 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     794     558   0036C 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     795     559   0036E 120425                         lcall  outc
     796     560   00371 801C                           sjmp   outcharlcde
     797     561   00373                  
     798     562   00373 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     799     563   00376 7402                           mov    a,#cursathom         ;cursor in home positie
     800     564   00378 120425                         lcall  outc
     801     565   0037B 8012                           sjmp   outcharlcde
     802     566   0037D                  
     803     567   0037D B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     804     568   00380                                                            ;tweede lijn
     805     569   00380 74C0                           mov    a,#0c0h
     806     570   00382 120425                         lcall  outc
     807     571   00385 8008                           sjmp   outcharlcde
     808     572   00387                  
     809     573   00387                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     810     574   00387                  ; is. dit mag naar het data register.
     811     575   00387                  
     812     576   00387 1203EB           outcharlcd8:  lcall  outd          ;klaar
     813     577   0038A 8003                           sjmp   outcharlcde   ;einde routine
     814     578   0038C                  
     815     579   0038C                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     816     580   0038C                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     817     581   0038C                  ; te schrijven.
     818     582   0038C                  
     819     583   0038C 120425           outcharlcd9:  lcall  outc          ;klaar
     820     584   0038F D0D0             outcharlcde:  pop    psw           ;registers herstellen
     821     585   00391 D0E0                           pop    acc
     822     586   00393 22                             ret
     823     587   00394                  
     824     588   00394                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     825     589   00394                  ;
     826     590   00394                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     827     591   00394                  ; op het lcd scherm.
     828     592   00394                  ;
     829     593   00394                  ; de routine gebruikt geen registers
     830     594   00394                  ;
     831     595   00394                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     832     596   00394                  
     833     597   00394                  lcdoutnib:
     834     598   00394 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     835     599   00396 C0D0                           push   psw
     836     600   00398 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     837     601   0039A 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     838     602   0039C B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     839     603   0039F 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     840     604   003A1 2407                           add    a,#007h       ;omvormen naar hoofdletter
     841     605   003A3 1203EB           outniblcde:   lcall  outd          ;naar het scherm
     842     606   003A6 D0D0                           pop    psw
     843     607   003A8 D0E0                           pop    acc
     844     608   003AA 22                             ret
     845     609   003AB                  
     846     610   003AB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     847     611   003AB                  ;
     848     612   003AB                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     849     613   003AB                  ;
     850     614   003AB                  ; de routine gebruikt geen registers
     851     615   003AB                  ;
     852     616   003AB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     853     617   003AB                  
     854     618   003AB                  lcdoutbyte:
     855     619   003AB C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     856     620   003AD C0D0                           push   psw
     857     621   003AF C4                             swap   a             ;bitjes omruilen
     858     622   003B0 120394                         lcall  outniblcd
     859     623   003B3 C4                             swap   a             ;nog eens
     860     624   003B4 120394                         lcall  outniblcd
     861     625   003B7 D0D0                           pop    psw
     862     626   003B9 D0E0                           pop    acc
     863     627   003BB 22                             ret
     864     628   003BC                  
     865     629   003BC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     866     630   003BC                  ;
     867     631   003BC                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     868     632   003BC                  ;
     869     633   003BC                  ; de routine gebruikt geen registers
     870     634   003BC                  ;
     871     635   003BC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     872     636   003BC                  
     873     637   003BC                  lcddispdptr:
     874     638   003BC C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     875     639   003BE C0D0                           push   psw
     876     640   003C0 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     877     641   003C2 1203AB                         lcall  outbytelcd
     878     642   003C5 E582                           mov    a,dpl         ;dan het lage deel
     879     643   003C7 1203AB                         lcall  outbytelcd
     880     644   003CA D0D0                           pop    psw
     881     645   003CC D0E0                           pop    acc
     882     646   003CE 22                             ret
     883     647   003CF                  
     884     648   003CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     885     649   003CF                  ;
     886     650   003CF                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     887     651   003CF                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     888     652   003CF                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     889     653   003CF                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     890     654   003CF                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     891     655   003CF                  ;
     892     656   003CF                  ; de routine gebruikt geen registers
     893     657   003CF                  ;
     894     658   003CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     895     659   003CF                  
     896     660   003CF                  lcdoutmsga:
     897     661   003CF C0E0             outmsgalcd:   push   acc           ;registers op de stack
     898     662   003D1 C0D0                           push   psw
     899     663   003D3 C083                           push   dph           ;ook de data pointer
     900     664   003D5 C082                           push   dpl
     901     665   003D7                  
     902     666   003D7                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     903     667   003D7                  
     904     668   003D7 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     905     669   003D8 93                             movc   a,@a+dptr     ;waarde lezen
     906     670   003D9 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     907     671   003DB                  
     908     672   003DB                  ; de code is niet 0 dus versturen met outchar
     909     673   003DB                  
     910     674   003DB 12033D                         lcall  outcharlcd    ;weg er mee
     911     675   003DE A3                             inc    dptr          ;naar volgende ascii code wijzen
     912     676   003DF 0203D7                         ljmp   outmsgalcd1   ;lus sluiten
     913     677   003E2                  
     914     678   003E2 D082             outmsgalcde:  pop    dpl           ;registers herstellen
     915     679   003E4 D083                           pop    dph
     916     680   003E6 D0D0                           pop    psw
     917     681   003E8 D0E0                           pop    acc
     918     682   003EA 22                             ret
     919     683   003EB                  
     920     684   003EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     921     685   003EB                  ;
     922     686   003EB                  ; outd is een routine die naar het data register van het display een
     923     687   003EB                  ; volledige byte stuurt.
     924     688   003EB                  ;
     925     689   003EB                  ; De routine gebruikt geen registers.
     926     690   003EB                  ;
     927     691   003EB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     928     692   003EB                  
     929     693   003EB C0E0             outd:         push   acc           ;registers op stack zetten
     930     694   003ED C0D0                           push   psw
     931     695   003EF 1203FB                         lcall  outhnibd      ;hoogste vier bits verzenden
     932     696   003F2 C4                             swap   a             ;bitjes omruilen
     933     697   003F3 1203FB                         lcall  outhnibd      ;naar het scherm sturen
     934     698   003F6 D0D0                           pop    psw           ;registers terug herstellen
     935     699   003F8 D0E0                           pop    acc
     936     700   003FA 22                             ret
     937     701   003FB                  
     938     702   003FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     939     703   003FB                  ;
     940     704   003FB                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
     941     705   003FB                  ; lcd scherm.
     942     706   003FB                  ;
     943     707   003FB                  ; de routine gebruikt geen registers.
     944     708   003FB                  ;
     945     709   003FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     946     710   003FB                  
     947     711   003FB C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
     948     712   003FD C0D0                           push   psw
     949     713   003FF C0F0                           push   b             ;werkregister
     950     714   00401 12049C                         lcall  lcdtoport     ;lees de expander naar b register
     951     715   00404 D2F0                           setb   rs            ;controle lijn in orde
     952     716   00406 C2F1                           clr    e             ;deselectie display
     953     717   00408 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
     954     718   0040A 03                             rr     a             ;bits op juiste plaats zetten
     955     719   0040B 03                             rr     a             ;voor b reg
     956     720   0040C 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
     957     721   0040F 42F0                           orl    b,a           ;bij elkaar voegen
     958     722   00411 120483                         lcall  porttolcd     ;naar expnder
     959     723   00414 D2F1                           setb   e             ;display enabelen
     960     724   00416 120483                         lcall  porttolcd
     961     725   00419 C2F1                           clr    e             ;display deselecteren
     962     726   0041B 120483                         lcall  porttolcd
     963     727   0041E D0F0                           pop    b
     964     728   00420 D0D0                           pop    psw           ;registers herstellen
     965     729   00422 D0E0                           pop    acc
     966     730   00424 22                             ret
     967     731   00425                  
     968     732   00425                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     969     733   00425                  ;
     970     734   00425                  ; outc is een routine die naar het controleregister van het display een
     971     735   00425                  ; volledige byte stuurt.
     972     736   00425                  ;
     973     737   00425                  ; De routine gebruikt geen registers.
     974     738   00425                  ;
     975     739   00425                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     976     740   00425                  
     977     741   00425 C0E0             outc:         push   acc           ;registers op stack zetten
     978     742   00427 C0D0                           push   psw
     979     743   00429 12043B                         lcall  outhnibc      ;hoogste vier bits verzenden
     980     744   0042C 12047C                         lcall  delay2ms      ;niet echt nodig
     981     745   0042F C4                             swap   a             ;bitjes omruilen
     982     746   00430 12043B                         lcall  outhnibc      ;naar het scherm sturen
     983     747   00433 12047C                         lcall  delay2ms      ;altijd goed voor traagste commando
     984     748   00436 D0D0                           pop    psw           ;registers terug herstellen
     985     749   00438 D0E0                           pop    acc
     986     750   0043A 22                             ret
     987     751   0043B                  
     988     752   0043B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     989     753   0043B                  ;
     990     754   0043B                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
     991     755   0043B                  ; lcd scherm.
     992     756   0043B                  ;
     993     757   0043B                  ; de routine gebruikt geen registers.
     994     758   0043B                  ;
     995     759   0043B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     996     760   0043B                  
     997     761   0043B C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
     998     762   0043D C0D0                           push   psw
     999     763   0043F C0F0                           push   b             ;werkregister
    1000     764   00441 12049C                         lcall  lcdtoport     ;lees de expander naar b register
    1001     765   00444 C2F0                           clr    rs            ;controle lijn in orde
    1002     766   00446 C2F1                           clr    e             ;deselectie display
    1003     767   00448 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1004     768   0044A 03                             rr     a             ;bits op juiste plaats zetten
    1005     769   0044B 03                             rr     a             ;voor b reg
    1006     770   0044C 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1007     771   0044F 42F0                           orl    b,a           ;bij elkaar voegen
    1008     772   00451 120483                         lcall  porttolcd     ;naar expnder
    1009     773   00454 D2F1                           setb   e             ;display enabelen
    1010     774   00456 120483                         lcall  porttolcd
    1011     775   00459 C2F1                           clr    e             ;display deselecteren
    1012     776   0045B 120483                         lcall  porttolcd
    1013     777   0045E D0F0                           pop    b
    1014     778   00460 D0D0                           pop    psw           ;registers herstellen
    1015     779   00462 D0E0                           pop    acc
    1016     780   00464 22                             ret
    1017     781   00465                  
    1018     782   00465                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1019     783   00465                  ;
    1020     784   00465                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1021     785   00465                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1022     786   00465                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1023     787   00465                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1024     788   00465                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1025     789   00465                  ; DATA GESCHREVEN.
    1026     790   00465                  ;
    1027     791   00465                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1028     792   00465                  
    1029     793   00465 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1030     794   00467 120425           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1031     795   0046A 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1032     796   0046C 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1033     797   0046D 1203EB                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1034     798   00470 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1035     799   00473 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1036     800   00474 80F4                           SJMP   BUILD3
    1037     801   00476 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1038     802   00478 120425                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1039     803   0047B 22                             RET                  ;EINDE VAN DE ROUTINE
    1040     804   0047C                  
    1041     805   0047C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1042     806   0047C                  ;
    1043     807   0047C                  ; Delay2ms is een vertragingsroutine van 2ms.
    1044     808   0047C                  ;
    1045     809   0047C                  ; De routine gebruikt geen registers.
    1046     810   0047C                  ;
    1047     811   0047C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1048     812   0047C                  
    1049     813   0047C 1202CD           delay2ms:     lcall  delay1ms
    1050     814   0047F 1202CD                         lcall  delay1ms
    1051     815   00482 22                             ret
    1052     816   00483                  
    1053     817   00483                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1054     818   00483                  ;
    1055     819   00483                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1056     820   00483                  ; scherm stuurt via de port expander.
    1057     821   00483                  ;
    1058     822   00483                  ; Gebruikt geen registers
    1059     823   00483                  ;
    1060     824   00483                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1061     825   00483                  
    1062     826   00483 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1063     827   00485 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1064     828   00487 1201A4                         lcall  iicstart      ;vertrokken
    1065     829   0048A 7440                           mov    a,#01000000b  ;schrijven naar expander
    1066     830   0048C 1201EB                         lcall  iicoutbyte    ;weg er mee
    1067     831   0048F E5F0                           mov    a,b           ;data verzenden
    1068     832   00491 1201EB                         lcall  iicoutbyte
    1069     833   00494 1201C7                         lcall  iicstop       ;transactie sluiten
    1070     834   00497 D0D0                           pop    psw
    1071     835   00499 D0E0                           pop    acc
    1072     836   0049B 22                             ret
    1073     837   0049C                  
    1074     838   0049C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1075     839   0049C                  ;
    1076     840   0049C                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1077     841   0049C                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1078     842   0049C                  ; van buzzet en backlight is.
    1079     843   0049C                  ;
    1080     844   0049C                  ; Gebruikt b register
    1081     845   0049C                  ;
    1082     846   0049C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1083     847   0049C                  
    1084     848   0049C C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1085     849   0049E C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1086     850   004A0 1201A4                         lcall  iicstart      ;vertrokken
    1087     851   004A3 7441                           mov    a,#01000001b  ;lezen van expander
    1088     852   004A5 1201EB                         lcall  iicoutbyte    ;weg er mee
    1089     853   004A8 120266                         lcall  iicinbytenack ;data inlezen
    1090     854   004AB 1201C7                         lcall  iicstop
    1091     855   004AE F5F0                           mov    b,a
    1092     856   004B0 D0D0                           pop    psw
    1093     857   004B2 D0E0                           pop    acc
    1094     858   004B4 22                             ret
    1095     859   004B5                  
    1096     860   004B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1097     861   004B5                  ;
    1098     862   004B5                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1099     863   004B5                  ;
    1100     864   004B5                  ; Gebruikt geen registers
    1101     865   004B5                  ;
    1102     866   004B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1103     867   004B5                  
    1104     868   004B5 C0F0             lcdlighton:   push   b
    1105     869   004B7 12049C                         lcall  lcdtoport     ;expander lezen
    1106     870   004BA C2F6                           clr    b.6           ;licht aan doen
    1107     871   004BC 120483                         lcall  porttolcd     ;expander scrijven
    1108     872   004BF D0F0                           pop    b
    1109     873   004C1 22                             ret
    1110     874   004C2                  
    1111     875   004C2                  
    1112     876   004C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1113     877   004C2                  ;
    1114     878   004C2                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1115     879   004C2                  ;
    1116     880   004C2                  ; Gebruikt geen registers
    1117     881   004C2                  ;
    1118     882   004C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1119     883   004C2                  
    1120     884   004C2 C0F0             lcdlightoff:  push   b
    1121     885   004C4 12049C                         lcall  lcdtoport     ;expander lezen
    1122     886   004C7 D2F6                           setb   b.6           ;licht uit doen
    1123     887   004C9 120483                         lcall  porttolcd     ;expander scrijven
    1124     888   004CC D0F0                           pop    b
    1125     889   004CE 22                             ret
    1126     890   004CF                  
    1127     891   004CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1128     892   004CF                  ;
    1129     893   004CF                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1130     894   004CF                  ;
    1131     895   004CF                  ; Gebruikt geen registers
    1132     896   004CF                  ;
    1133     897   004CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1134     898   004CF                  
    1135     899   004CF C0F0             lcdbuzon:     push   b
    1136     900   004D1 12049C                         lcall  lcdtoport     ;expander lezen
    1137     901   004D4 C2F7                           clr    b.7           ;buzzer aan doen
    1138     902   004D6 120483                         lcall  porttolcd     ;expander scrijven
    1139     903   004D9 D0F0                           pop    b
    1140     904   004DB 22                             ret
    1141     905   004DC                  
    1142     906   004DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1143     907   004DC                  ;
    1144     908   004DC                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1145     909   004DC                  ;
    1146     910   004DC                  ; Gebruikt geen registers
    1147     911   004DC                  ;
    1148     912   004DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1149     913   004DC                  
    1150     914   004DC C0F0             lcdbuzoff:    push   b
    1151     915   004DE 12049C                         lcall  lcdtoport     ;expander lezen
    1152     916   004E1 D2F7                           setb   b.7           ;buzzer aan doen
    1153     917   004E3 120483                         lcall  porttolcd     ;expander scrijven
    1154     918   004E6 D0F0                           pop    b
    1155     919   004E8 22                             ret
    1156     920   004E9                  
    1157     921   004E9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1158     922   004E9                  ;
    1159     923   004E9                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1160     924   004E9                  ; een standaard com poort op 9600 baud.
    1161     925   004E9                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1162     926   004E9                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1163     927   004E9                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1164     928   004E9                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1165     929   004E9                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1166     930   004E9                  ; NIET door deze routine.
    1167     931   004E9                  ;
    1168     932   004E9                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1169     933   004E9                  ;
    1170     934   004E9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1171     935   004E9                  
    1172     936   004E9                  blank         equ    020h          ;ascii code voor een blank
    1173     937   004E9                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1174     938   004E9                  ff            equ    00ch          ;ascii code voor nieuw blad
    1175     939   004E9                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1176     940   004E9                  lf            equ    00ah          ;ascii code voor volgende lijn
    1177     941   004E9                  backsp        equ    008h          ;ascii code voor het bs karakter
    1178     942   004E9                  beep          equ    007h          ;ascii code voor een beep
    1179     943   004E9                  
    1180     944   004E9 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1181     945   004ED                                                                          ;van het scherm
    1182     946   004ED                  
    1183     947   004ED                  strtbuf       equ     054h         ;start adres van de buffer
    1184     948   004ED                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1185     949   004ED                  
    1186     950   004ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1187     951   004ED                  ;
    1188     952   004ED                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1189     953   004ED                  ;
    1190     954   004ED                  ; Gebruikt geen registers
    1191     955   004ED                  ;
    1192     956   004ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1193     957   004ED                  
    1194     958   004ED C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1195     959   004EF C08F                           push   syscon0              ;map bewaren
    1196     960   004F1 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1197     961   004F4 C0B2                           push   port_page            ;pagina op stack zetten
    1198     962   004F6 C0BF                           push   scu_page
    1199     963   004F8 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1200     964   004FB                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1201     965   004FB                  ;      -p1.0 als input en alt1 selectie
    1202     966   004FB                  ;      -p1.1 als output en alt2 selectie
    1203     967   004FB                  
    1204     968   004FB 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1205     969   004FE 5390FD                         anl    p1_altsel0,#11111101b
    1206     970   00501 439001                         orl    p1_altsel0,#00000001b
    1207     971   00504 5391FE                         anl    p1_altsel1,#11111110b
    1208     972   00507 439102                         orl    p1_altsel1,#00000010b
    1209     973   0050A 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1210     974   0050D 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1211     975   00510 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1212     976   00513                  
    1213     977   00513                  ; Nu moet de baud rate generator ingesteld worden
    1214     978   00513                  ; We gaan er van uit dat de systeemklok 24MHz is
    1215     979   00513                  
    1216     980   00513 759850                         mov    scon,#01010000b      ;UART initialiseren
    1217     981   00516                  
    1218     982   00516                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1219     983   00516                  ; gebruikt!!
    1220     984   00516                  
    1221     985   00516 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1222     986   00519 75BD11                         mov    bcon,#00010001b
    1223     987   0051C D0BF                           pop    scu_page
    1224     988   0051E D0B2                           pop    port_page            ;alles terug herstellen
    1225     989   00520 D08F                           pop    syscon0
    1226     990   00522 D0E0                           pop    acc
    1227     991   00524 22                             ret
    1228     992   00525                  
    1229     993   00525                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1230     994   00525                  ;
    1231     995   00525                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1232     996   00525                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1233     997   00525                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1234     998   00525                  ;
    1235     999   00525                  ; de routine gebruikt geen registers.
    1236    1000   00525                  ;
    1237    1001   00525                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1238    1002   00525                  
    1239    1003   00525                  siooutchar:
    1240    1004   00525 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1241    1005   00527 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1242    1006   0052A C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1243    1007   0052C 22                             RET
    1244    1008   0052D                  
    1245    1009   0052D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1246    1010   0052D                  ;
    1247    1011   0052D                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1248    1012   0052D                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1249    1013   0052D                  ;
    1250    1014   0052D                  ; de routine gebruikt geen registers.
    1251    1015   0052D                  ;
    1252    1016   0052D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1253    1017   0052D                  
    1254    1018   0052D                  siooutnib:
    1255    1019   0052D C0E0             OUTNIB:       push   acc           ;registers op de stack
    1256    1020   0052F C0D0                           push   psw
    1257    1021   00531 540F                           ANL    A,#00FH       ;AFZONDEREN
    1258    1022   00533 12061D                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1259    1023   00536 120525                         LCALL  OUTCHAR       ;VERSTUREN
    1260    1024   00539 120586                         LCALL  XONXOFF       ;FLOW CONTROL
    1261    1025   0053C D0D0                           pop    psw           ;registers herstellen
    1262    1026   0053E D0E0                           pop    acc
    1263    1027   00540 22                             RET
    1264    1028   00541                  
    1265    1029   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1266    1030   00541                  ;
    1267    1031   00541                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1268    1032   00541                  ; WORDT XONXOFF GEBRUIKT.
    1269    1033   00541                  ;
    1270    1034   00541                  ; de routine gebruikt geen registers.
    1271    1035   00541                  ;
    1272    1036   00541                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1273    1037   00541                  
    1274    1038   00541                  siooutbyte:
    1275    1039   00541 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1276    1040   00543 C0D0                           push   psw
    1277    1041   00545 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1278    1042   00547 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1279    1043   00548 12052D                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1280    1044   0054B D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1281    1045   0054D 12052D                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1282    1046   00550 D0D0                           pop    psw           ;registers herstellen
    1283    1047   00552 D0E0                           pop    acc
    1284    1048   00554 22                             RET
    1285    1049   00555                  
    1286    1050   00555                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1287    1051   00555                  ;
    1288    1052   00555                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1289    1053   00555                  ; VAN DE CURSOR.
    1290    1054   00555                  ;
    1291    1055   00555                  ; de routine gebruikt geen registers.
    1292    1056   00555                  ;
    1293    1057   00555                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1294    1058   00555                  
    1295    1059   00555                  siodispdptr:
    1296    1060   00555 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1297    1061   00557 C0D0                           push   psw
    1298    1062   00559 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1299    1063   0055B 120541                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1300    1064   0055E E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1301    1065   00560 120541                         LCALL  OUTBYTE       ;WEG ER MEE
    1302    1066   00563 D0D0                           pop    psw           ;registers herstellen
    1303    1067   00565 D0E0                           pop    acc
    1304    1068   00567 22                             RET                  ;EINDE
    1305    1069   00568                  
    1306    1070   00568                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1307    1071   00568                  ;
    1308    1072   00568                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1309    1073   00568                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1310    1074   00568                  ;
    1311    1075   00568                  ; de routine gebruikt geen registers.
    1312    1076   00568                  ;
    1313    1077   00568                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1314    1078   00568                  
    1315    1079   00568                  siooutmsga:
    1316    1080   00568 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1317    1081   0056A C0D0                           push   psw
    1318    1082   0056C C082                           push   dpl
    1319    1083   0056E C083                           push   dph
    1320    1084   00570 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1321    1085   00571 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1322    1086   00572 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1323    1087   00574 120525                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1324    1088   00577 120586                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1325    1089   0057A A3                             INC    DPTR          ;DPTR AANPASSEN
    1326    1090   0057B 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1327    1091   0057D D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1328    1092   0057F D082                           pop    dpl
    1329    1093   00581 D0D0                           pop    psw
    1330    1094   00583 D0E0                           pop    acc
    1331    1095   00585 22                             RET                  ;EINDE ROUTINE
    1332    1096   00586                  
    1333    1097   00586                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1334    1098   00586                  ;
    1335    1099   00586                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1336    1100   00586                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1337    1101   00586                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1338    1102   00586                  ; VERDER DOORGEGEVEN.
    1339    1103   00586                  ;
    1340    1104   00586                  ; de routine gebruikt geen registers.
    1341    1105   00586                  ;
    1342    1106   00586                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1343    1107   00586                  
    1344    1108   00586 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1345    1109   00588 C0D0                           push   psw
    1346    1110   0058A 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1347    1111   0058D D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1348    1112   0058F D0E0                           pop    acc
    1349    1113   00591 22                             RET                  ;ANDERS EINDE
    1350    1114   00592 E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1351    1115   00594 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1352    1116   00597 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1353    1117   0059A 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1354    1118   0059C                  
    1355    1119   0059C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1356    1120   0059C                  ;
    1357    1121   0059C                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1358    1122   0059C                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1359    1123   0059C                  ;
    1360    1124   0059C                  ; de routine gebruikt de accu.
    1361    1125   0059C                  ;
    1362    1126   0059C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1363    1127   0059C                  
    1364    1128   0059C                  sioinchar:
    1365    1129   0059C 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1366    1130   0059F C298                           CLR    RI                   ;BIT LAAG MAKEN
    1367    1131   005A1 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1368    1132   005A3 22                             RET
    1369    1133   005A4                  
    1370    1134   005A4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1371    1135   005A4                  ;
    1372    1136   005A4                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1373    1137   005A4                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1374    1138   005A4                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1375    1139   005A4                  ; DE CARRY OP 1 GEZET WORDEN.
    1376    1140   005A4                  ;
    1377    1141   005A4                  ; De routine gebruikt de accu, r0 en de psw.
    1378    1142   005A4                  ;
    1379    1143   005A4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1380    1144   005A4                  
    1381    1145   005A4                  sioinbyte:
    1382    1146   005A4 12059C           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1383    1147   005A7 120610                         LCALL  LOWUPTR
    1384    1148   005AA 120627                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1385    1149   005AD 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1386    1150   005AF C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1387    1151   005B0 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1388    1152   005B1 12059C                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1389    1153   005B4 120610                         LCALL  LOWUPTR
    1390    1154   005B7 120627                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1391    1155   005BA 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1392    1156   005BC 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1393    1157   005BD 22               INBYTE1:      RET
    1394    1158   005BE                  
    1395    1159   005BE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1396    1160   005BE                  ;
    1397    1161   005BE                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1398    1162   005BE                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1399    1163   005BE                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1400    1164   005BE                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1401    1165   005BE                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1402    1166   005BE                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1403    1167   005BE                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1404    1168   005BE                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1405    1169   005BE                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1406    1170   005BE                  ; bepalen.
    1407    1171   005BE                  ;
    1408    1172   005BE                  ; De routine gebruikt de accu, r0 en de psw.
    1409    1173   005BE                  ;
    1410    1174   005BE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1411    1175   005BE                  
    1412    1176   005BE                  sioinbufa:
    1413    1177   005BE 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1414    1178   005C0 12059C           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1415    1179   005C3 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1416    1180   005C5                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1417    1181   005C5                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1418    1182   005C5                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1419    1183   005C5                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1420    1184   005C5                  ; GEVOERD.
    1421    1185   005C5 120610                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1422    1186   005C8 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1423    1187   005CB F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1424    1188   005CC 22                             RET                         ;EINDE VAN DE ROUTINE
    1425    1189   005CD B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1426    1190   005D0 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1427    1191   005D3 7407             INBUFA4:      MOV    A,#BEEP
    1428    1192   005D5 120525           INBUFA7:      LCALL  OUTCHAR
    1429    1193   005D8 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1430    1194   005DA 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1431    1195   005DB 9004E9                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1432    1196   005DE 120568                         LCALL  OUTMSGA
    1433    1197   005E1 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1434    1198   005E3 120602           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1435    1199   005E6 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1436    1200   005E8 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1437    1201   005EB 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1438    1202   005ED F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1439    1203   005EE 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1440    1204   005EF 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1441    1205   005F1                  
    1442    1206   005F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1443    1207   005F1                  ;
    1444    1208   005F1                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1445    1209   005F1                  ;
    1446    1210   005F1                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1447    1211   005F1                  ;
    1448    1212   005F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1449    1213   005F1                  
    1450    1214   005F1 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1451    1215   005F3 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1452    1216   005F5 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1453    1217   005F6 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1454    1218   005F9 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1455    1219   005FA B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1456    1220   005FD 22                             RET                         ;EINDE VAN DE ROUTINE
    1457    1221   005FE F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1458    1222   005FF 09                             INC    R1
    1459    1223   00600 80F7                           SJMP   BDELETE3
    1460    1224   00602                  
    1461    1225   00602                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1462    1226   00602                  ;
    1463    1227   00602                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1464    1228   00602                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1465    1229   00602                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1466    1230   00602                  ; AANZIEN.
    1467    1231   00602                  ;
    1468    1232   00602                  ; De routine gebruikt de accu en de psw.
    1469    1233   00602                  ;
    1470    1234   00602                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1471    1235   00602                  
    1472    1236   00602 B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1473    1237   00605 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1474    1238   00607 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1475    1239   0060A 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1476    1240   0060C C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1477    1241   0060D 22                             RET
    1478    1242   0060E D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1479    1243   0060F 22                             RET
    1480    1244   00610                  
    1481    1245   00610                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1482    1246   00610                  ;
    1483    1247   00610                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1484    1248   00610                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1485    1249   00610                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1486    1250   00610                  ; AANGEPAST WORDEN.
    1487    1251   00610                  ;
    1488    1252   00610                  ; De routine gebruikt de accu en de psw.
    1489    1253   00610                  ;
    1490    1254   00610                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1491    1255   00610                  
    1492    1256   00610 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1493    1257   00613 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1494    1258   00615 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1495    1259   00618 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1496    1260   0061A 9420                           SUBB   A,#020H              ;OMZETTING
    1497    1261   0061C 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1498    1262   0061D                  
    1499    1263   0061D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1500    1264   0061D                  ;
    1501    1265   0061D                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1502    1266   0061D                  ; ASCII CODE.
    1503    1267   0061D                  ;
    1504    1268   0061D                  ; De routine gebruikt de accu en de psw.
    1505    1269   0061D                  ;
    1506    1270   0061D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1507    1271   0061D                  
    1508    1272   0061D B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1509    1273   00620 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1510    1274   00622 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1511    1275   00624 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1512    1276   00626 22                             RET
    1513    1277   00627                  
    1514    1278   00627                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1515    1279   00627                  ;
    1516    1280   00627                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1517    1281   00627                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1518    1282   00627                  ; GEVAL WORDT DE CARRY GEZET.
    1519    1283   00627                  ;
    1520    1284   00627                  ; De routine gebruikt de accu en de psw.
    1521    1285   00627                  ;
    1522    1286   00627                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1523    1287   00627                  
    1524    1288   00627 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1525    1289   00628 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1526    1290   0062A 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1527    1291   0062C B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1528    1292   0062F 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1529    1293   00631 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1530    1294   00633 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1531    1295   00635 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1532    1296   00638 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1533    1297   00639 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1534    1298   0063B C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1535    1299   0063C 22               ASCBINTRANS1: RET
    1536    1300   0063D                  
    1537    1301   0063D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1538    1302   0063D                  ;
    1539    1303   0063D                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1540    1304   0063D                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1541    1305   0063D                  ;
    1542    1306   0063D                  ; De routine gebruikt de accu en de psw.
    1543    1307   0063D                  ;
    1544    1308   0063D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1545    1309   0063D                  
    1546    1310   0063D E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1547    1311   0063E 120627                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1548    1312   00641 22                             RET                         ;EINDE OMZETTING
    1549    1313   00642                  
    1550    1314   00642                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1551    1315   00642                  ;
    1552    1316   00642                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1553    1317   00642                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1554    1318   00642                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1555    1319   00642                  ;
    1556    1320   00642                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1557    1321   00642                  ;
    1558    1322   00642                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1559    1323   00642                  
    1560    1324   00642 12063D           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1561    1325   00645 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1562    1326   00647 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1563    1327   00648 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1564    1328   00649 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1565    1329   0064A 12063D                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1566    1330   0064D 4001                           JC     ASCII21               ;WEG ALS C=1
    1567    1331   0064F 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1568    1332   00650 22               ASCII21:      RET
    1569    1333   00651                  
    1570    1334   00651                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1571    1335   00651                  ;
    1572    1336   00651                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1573    1337   00651                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1574    1338   00651                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1575    1339   00651                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1576    1340   00651                  ;
    1577    1341   00651                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1578    1342   00651                  ;
    1579    1343   00651                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1580    1344   00651                  
    1581    1345   00651 120642           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1582    1346   00654 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1583    1347   00656 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1584    1348   00658 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1585    1349   00659 120642                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1586    1350   0065C 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1587    1351   0065E F582                           MOV    DPL,A                ;IN DPTR LADEN
    1588    1352   00660 22               ASCII41:      RET
    1589    1353   00661                  
    1590    1354   00661                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1591    1355   00661                  ;
    1592    1356   00661                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1593    1357   00661                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1594    1358   00661                  ; geschakeld worden.
    1595    1359   00661                  ;
    1596    1360   00661                  ; Gebruikt geen registers
    1597    1361   00661                  ;
    1598    1362   00661                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1599    1363   00661                  
    1600    1364   00661 C08F             initadc:      push   syscon0                     ;map saven
    1601    1365   00663 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1602    1366   00666 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1603    1367   00669 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1604    1368   0066C                                                                   ;klok delen door 32 (750kHz)
    1605    1369   0066C                                                                   ;10 bit uitkomst
    1606    1370   0066C 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1607    1371   0066F                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1608    1372   0066F 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1609    1373   00672 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1610    1374   00675 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1611    1375   00678 D08F                           pop    syscon0                     ;herstellen syscon
    1612    1376   0067A 22                             ret
    1613    1377   0067B                  
    1614    1378   0067B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1615    1379   0067B                  ;
    1616    1380   0067B                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1617    1381   0067B                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1618    1382   0067B                  ;
    1619    1383   0067B                  ; Gebruikt:
    1620    1384   0067B                  ;      -accu als 8 msb meting
    1621    1385   0067B                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1622    1386   0067B                  ;
    1623    1387   0067B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1624    1388   0067B                  
    1625    1389   0067B C08F             adclm335:     push   syscon0
    1626    1390   0067D 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1627    1391   00680 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1628    1392   00683 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1629    1393   00686 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1630    1394   00689 00               		nop
    1631    1395   0068A 00               		nop					;anders loopt het mis met het testen van de ready bit
    1632    1396   0068B E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1633    1397   0068D 20E0FB                         jb     acc.0,adclm3351
    1634    1398   00690 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1635    1399   00693 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1636    1400   00695 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1637    1401   00698 D08F                           pop    syscon0
    1638    1402   0069A 22                             ret
    1639    1403   0069B                  
    1640    1404   0069B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1641    1405   0069B                  ;
    1642    1406   0069B                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1643    1407   0069B                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1644    1408   0069B                  ;
    1645    1409   0069B                  ; Gebruikt:
    1646    1410   0069B                  ;      -accu als 8 msb meting
    1647    1411   0069B                  ;      -b als 2 lsb meting (links afgelijnd)
    1648    1412   0069B                  ;
    1649    1413   0069B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1650    1414   0069B                  
    1651    1415   0069B C08F             adcpotmeter:  push   syscon0
    1652    1416   0069D 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1653    1417   006A0 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1654    1418   006A3 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1655    1419   006A6 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1656    1420   006A9 00               		nop
    1657    1421   006AA 00               		nop					;anders loopt het mis met het testen van de ready bit
    1658    1422   006AB E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1659    1423   006AD 20E0FB                         jb     acc.0,adcpotmeter1
    1660    1424   006B0 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1661    1425   006B3 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1662    1426   006B5 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1663    1427   006B8 D08F                           pop    syscon0
    1664    1428   006BA                  
    1665    1429   006BA                  
    1666    1430   006BA 22                             ret
    1667    1431   006BB                  
    1668    1432   006BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1669    1433   006BB                  ;
    1670    1434   006BB                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1671    1435   006BB                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1672    1436   006BB                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1673    1437   006BB                  ; doelstellingen in het achterhoofd.
    1674    1438   006BB                  ;
    1675    1439   006BB                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1676    1440   006BB                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1677    1441   006BB                  ; bcd)
    1678    1442   006BB                  ;      8bit hex naar bcd
    1679    1443   006BB                  ;      8bit bcd naar hex
    1680    1444   006BB                  ;
    1681    1445   006BB                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1682    1446   006BB                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1683    1447   006BB                  ;      16*16 bit met 32 bit uitkomst
    1684    1448   006BB                  ;      16+16 bit met 24 bit uitkomst
    1685    1449   006BB                  ;      16-16 bit met 24 bit uitkomst
    1686    1450   006BB                  ;      16bit hex naar bcd
    1687    1451   006BB                  ;      16bit bcd naar hex
    1688    1452   006BB                  ;
    1689    1453   006BB                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1690    1454   006BB                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1691    1455   006BB                  ;      32*32 bit met 64 bit uitkomst
    1692    1456   006BB                  ;      32+32 bit met 40 bit uitkomst
    1693    1457   006BB                  ;      32-32 bit met 40 bit uitkomst
    1694    1458   006BB                  ;
    1695    1459   006BB                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1696    1460   006BB                  ;
    1697    1461   006BB                  ; De routines gebruiken als input en output de huidige registerbank.
    1698    1462   006BB                  ;
    1699    1463   006BB                  ;
    1700    1464   006BB                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1701    1465   006BB                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1702    1466   006BB                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1703    1467   006BB                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1704    1468   006BB                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1705    1469   006BB                  ;
    1706    1470   006BB                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1707    1471   006BB                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1708    1472   006BB                  ;      -routines gebruiken geen MDU!
    1709    1473   006BB                  ;
    1710    1474   006BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1711    1475   006BB                  
    1712    1476   006BB                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1713    1477   006BB                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1714    1478   006BB                  
    1715    1479   006BB                  h0            equ    070h
    1716    1480   006BB                  h1            equ    071h
    1717    1481   006BB                  h2            equ    072h
    1718    1482   006BB                  h3            equ    073h
    1719    1483   006BB                  h4            equ    074h
    1720    1484   006BB                  h5            equ    075h
    1721    1485   006BB                  h6            equ    076h
    1722    1486   006BB                  h7            equ    077h
    1723    1487   006BB                  h8            equ    078h
    1724    1488   006BB                  h9            equ    079h
    1725    1489   006BB                  h10           equ    07ah
    1726    1490   006BB                  h11           equ    07bh
    1727    1491   006BB                  h12           equ    07ch
    1728    1492   006BB                  
    1729    1493   006BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1730    1494   006BB                  ;
    1731    1495   006BB                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1732    1496   006BB                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1733    1497   006BB                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1734    1498   006BB                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1735    1499   006BB                  ;
    1736    1500   006BB                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1737    1501   006BB                  ;
    1738    1502   006BB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1739    1503   006BB                  
    1740    1504   006BB C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1741    1505   006BD C0D0                           push   psw
    1742    1506   006BF C070                           push   h0
    1743    1507   006C1 C071                           push   h1
    1744    1508   006C3 C072                           push   h2
    1745    1509   006C5 C073                           push   h3
    1746    1510   006C7 C074                           push   h4
    1747    1511   006C9 C075                           push   h5
    1748    1512   006CB C076                           push   h6
    1749    1513   006CD C077                           push   h7
    1750    1514   006CF C078                           push   h8
    1751    1515   006D1 C079                           push   h9
    1752    1516   006D3 C07A                           push   h10
    1753    1517   006D5 C07B                           push   h11
    1754    1518   006D7 C07C                           push   h12
    1755    1519   006D9                  
    1756    1520   006D9                  ; eerst moeten de hulpregisters klaar gezet worden
    1757    1521   006D9                  
    1758    1522   006D9 757000                         mov    h0,#000h
    1759    1523   006DC 757100                         mov    h1,#000h
    1760    1524   006DF 757200                         mov    h2,#000h
    1761    1525   006E2 757300                         mov    h3,#000h
    1762    1526   006E5 757400                         mov    h4,#000h
    1763    1527   006E8 757500                         mov    h5,#000h
    1764    1528   006EB 757600                         mov    h6,#000h
    1765    1529   006EE 757700                         mov    h7,#000h
    1766    1530   006F1 757800                         mov    h8,#000h
    1767    1531   006F4 757900                         mov    h9,#000h
    1768    1532   006F7 757A00                         mov    h10,#000h
    1769    1533   006FA 757B00                         mov    h11,#000h
    1770    1534   006FD 757C20                         mov    h12,#32              ;loopcounter
    1771    1535   00700                  
    1772    1536   00700                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1773    1537   00700                  
    1774    1538   00700                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1775    1539   00700                  
    1776    1540   00700 EB               mul321:       mov    a,r3
    1777    1541   00701 13                             rrc    a
    1778    1542   00702 FB                             mov    r3,a
    1779    1543   00703 EA                             mov    a,r2
    1780    1544   00704 13                             rrc    a
    1781    1545   00705 FA                             mov    r2,a
    1782    1546   00706 E9                             mov    a,r1
    1783    1547   00707 13                             rrc    a
    1784    1548   00708 F9                             mov    r1,a
    1785    1549   00709 E8                             mov    a,r0
    1786    1550   0070A 13                             rrc    a
    1787    1551   0070B F8                             mov    r0,a                 ;32 bit shift klaar
    1788    1552   0070C                  
    1789    1553   0070C                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1790    1554   0070C                  
    1791    1555   0070C 502C                           jnc    mul322               ;optelling niet nodig
    1792    1556   0070E                  
    1793    1557   0070E                  ; hier staat en 64 bit optelling
    1794    1558   0070E                  
    1795    1559   0070E EC                             mov    a,r4
    1796    1560   0070F 2574                           add    a,h4
    1797    1561   00711 F574                           mov    h4,a
    1798    1562   00713 ED                             mov    a,r5
    1799    1563   00714 3575                           addc   a,h5
    1800    1564   00716 F575                           mov    h5,a
    1801    1565   00718 EE                             mov    a,r6
    1802    1566   00719 3576                           addc   a,h6
    1803    1567   0071B F576                           mov    h6,a
    1804    1568   0071D EF                             mov    a,r7
    1805    1569   0071E 3577                           addc   a,h7
    1806    1570   00720 F577                           mov    h7,a
    1807    1571   00722 E570                           mov    a,h0
    1808    1572   00724 3578                           addc   a,h8
    1809    1573   00726 F578                           mov    h8,a
    1810    1574   00728 E571                           mov    a,h1
    1811    1575   0072A 3579                           addc   a,h9
    1812    1576   0072C F579                           mov    h9,a
    1813    1577   0072E E572                           mov    a,h2
    1814    1578   00730 357A                           addc   a,h10
    1815    1579   00732 F57A                           mov    h10,a
    1816    1580   00734 E573                           mov    a,h3
    1817    1581   00736 357B                           addc   a,h11
    1818    1582   00738 F57B                           mov    h11,a                ;optelling klaar
    1819    1583   0073A                  
    1820    1584   0073A                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1821    1585   0073A                  
    1822    1586   0073A C3               mul322:       clr    c                    ;moet op 0 staan
    1823    1587   0073B EC                             mov    a,r4
    1824    1588   0073C 33                             rlc    a
    1825    1589   0073D FC                             mov    r4,a
    1826    1590   0073E ED                             mov    a,r5
    1827    1591   0073F 33                             rlc    a
    1828    1592   00740 FD                             mov    r5,a
    1829    1593   00741 EE                             mov    a,r6
    1830    1594   00742 33                             rlc    a
    1831    1595   00743 FE                             mov    r6,a
    1832    1596   00744 EF                             mov    a,r7
    1833    1597   00745 33                             rlc    a
    1834    1598   00746 FF                             mov    r7,a
    1835    1599   00747 E570                           mov    a,h0
    1836    1600   00749 33                             rlc    a
    1837    1601   0074A F570                           mov    h0,a
    1838    1602   0074C E571                           mov    a,h1
    1839    1603   0074E 33                             rlc    a
    1840    1604   0074F F571                           mov    h1,a
    1841    1605   00751 E572                           mov    a,h2
    1842    1606   00753 33                             rlc    a
    1843    1607   00754 F572                           mov    h2,a
    1844    1608   00756 E573                           mov    a,h3
    1845    1609   00758 33                             rlc    a
    1846    1610   00759 F573                           mov    h3,a
    1847    1611   0075B                  
    1848    1612   0075B D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1849    1613   0075E                  
    1850    1614   0075E                  ; de uitkomst moet in de juiste registers komen
    1851    1615   0075E                  
    1852    1616   0075E A874                           mov    r0,h4
    1853    1617   00760 A975                           mov    r1,h5
    1854    1618   00762 AA76                           mov    r2,h6
    1855    1619   00764 AB77                           mov    r3,h7
    1856    1620   00766 AC78                           mov    r4,h8
    1857    1621   00768 AD79                           mov    r5,h9
    1858    1622   0076A AE7A                           mov    r6,h10
    1859    1623   0076C AF7B                           mov    r7,h11               ;klaar
    1860    1624   0076E                  
    1861    1625   0076E D07C                           pop    h12                  ;registers herstellen
    1862    1626   00770 D07B                           pop    h11
    1863    1627   00772 D07A                           pop    h10
    1864    1628   00774 D079                           pop    h9
    1865    1629   00776 D078                           pop    h8
    1866    1630   00778 D077                           pop    h7
    1867    1631   0077A D076                           pop    h6
    1868    1632   0077C D075                           pop    h5
    1869    1633   0077E D074                           pop    h4
    1870    1634   00780 D073                           pop    h3
    1871    1635   00782 D072                           pop    h2
    1872    1636   00784 D071                           pop    h1
    1873    1637   00786 D070                           pop    h0
    1874    1638   00788 D0D0                           pop    psw
    1875    1639   0078A D0E0                           pop    acc
    1876    1640   0078C 22                             ret
    1877    1641   0078D                  
    1878    1642   0078D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1879    1643   0078D                  ;
    1880    1644   0078D                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1881    1645   0078D                  ; input:      r1,r0 = eerste getal (r1=msb)
    1882    1646   0078D                  ;             r3,r2 = tweede getal (r3=msb)
    1883    1647   0078D                  ; output:     r3,r2,r1,r0 met r3=msb
    1884    1648   0078D                  ;
    1885    1649   0078D                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1886    1650   0078D                  ;
    1887    1651   0078D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1888    1652   0078D                  
    1889    1653   0078D C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1890    1654   0078F C0D0                           push   psw
    1891    1655   00791 C070                           push   h0
    1892    1656   00793 C071                           push   h1
    1893    1657   00795 C072                           push   h2
    1894    1658   00797 C073                           push   h3
    1895    1659   00799 C074                           push   h4
    1896    1660   0079B C075                           push   h5
    1897    1661   0079D C076                           push   h6
    1898    1662   0079F                  
    1899    1663   0079F                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1900    1664   0079F                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1901    1665   0079F                  ; h6 is de loopcounter.
    1902    1666   0079F                  
    1903    1667   0079F 757000                         mov    h0,#000h
    1904    1668   007A2 757100                         mov    h1,#000h
    1905    1669   007A5 757200                         mov    h2,#000h
    1906    1670   007A8 757300                         mov    h3,#000h
    1907    1671   007AB 757400                         mov    h4,#000h
    1908    1672   007AE 757500                         mov    h5,#000h
    1909    1673   007B1 757610                         mov    h6,#16               ;loopcounter
    1910    1674   007B4                  
    1911    1675   007B4                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1912    1676   007B4                  ; berekening
    1913    1677   007B4                  
    1914    1678   007B4 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1915    1679   007B5 13                             rrc    a
    1916    1680   007B6 F9                             mov    r1,a
    1917    1681   007B7 E8                             mov    a,r0
    1918    1682   007B8 13                             rrc    a
    1919    1683   007B9 F8                             mov    r0,a                 ;ok
    1920    1684   007BA                  
    1921    1685   007BA                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1922    1686   007BA                  
    1923    1687   007BA 5016                           jnc    mul162
    1924    1688   007BC                  
    1925    1689   007BC EA                             mov    a,r2
    1926    1690   007BD 2572                           add    a,h2
    1927    1691   007BF F572                           mov    h2,a                 ;32 bit som uitvoeren
    1928    1692   007C1 EB                             mov    a,r3
    1929    1693   007C2 3573                           addc   a,h3
    1930    1694   007C4 F573                           mov    h3,a
    1931    1695   007C6 E570                           mov    a,h0
    1932    1696   007C8 3574                           addc   a,h4
    1933    1697   007CA F574                           mov    h4,a
    1934    1698   007CC E571                           mov    a,h1
    1935    1699   007CE 3575                           addc   a,h5
    1936    1700   007D0 F575                           mov    h5,a                 ;klaar
    1937    1701   007D2                  
    1938    1702   007D2                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    1939    1703   007D2                  
    1940    1704   007D2 C3               mul162:       clr    c
    1941    1705   007D3 EA                             mov    a,r2
    1942    1706   007D4 33                             rlc    a
    1943    1707   007D5 FA                             mov    r2,a                 ;ook 32 bit getal
    1944    1708   007D6 EB                             mov    a,r3
    1945    1709   007D7 33                             rlc    a
    1946    1710   007D8 FB                             mov    r3,a
    1947    1711   007D9 E570                           mov    a,h0
    1948    1712   007DB 33                             rlc    a
    1949    1713   007DC F570                           mov    h0,a
    1950    1714   007DE E571                           mov    a,h1
    1951    1715   007E0 33                             rlc    a
    1952    1716   007E1 F571                           mov    h1,a                 ;klaar
    1953    1717   007E3                  
    1954    1718   007E3 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    1955    1719   007E6                  
    1956    1720   007E6                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    1957    1721   007E6                  
    1958    1722   007E6 A872                           mov    r0,h2
    1959    1723   007E8 A973                           mov    r1,h3
    1960    1724   007EA AA74                           mov    r2,h4
    1961    1725   007EC AB75                           mov    r3,h5                ;klaar
    1962    1726   007EE                  
    1963    1727   007EE                  
    1964    1728   007EE D076                           pop    h6                   ;registers herstellen
    1965    1729   007F0 D075                           pop    h5
    1966    1730   007F2 D074                           pop    h4
    1967    1731   007F4 D073                           pop    h3
    1968    1732   007F6 D072                           pop    h2
    1969    1733   007F8 D071                           pop    h1
    1970    1734   007FA D070                           pop    h0
    1971    1735   007FC D0D0                           pop    psw
    1972    1736   007FE D0E0                           pop    acc
    1973    1737   00800 22                             ret
    1974    1738   00801                  
    1975    1739   00801                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1976    1740   00801                  ;
    1977    1741   00801                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    1978    1742   00801                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1979    1743   00801                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1980    1744   00801                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    1981    1745   00801                  ;             r3,r2,r1,r0 = rest (r3=msb)
    1982    1746   00801                  ;             carry=1 bij delen door 0
    1983    1747   00801                  ;
    1984    1748   00801                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1985    1749   00801                  ;
    1986    1750   00801                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1987    1751   00801                  
    1988    1752   00801 C0E0             div32:        push   acc                  ;registers op de stack zetten
    1989    1753   00803 C0D0                           push   psw
    1990    1754   00805 C070                           push   h0
    1991    1755   00807 C071                           push   h1
    1992    1756   00809 C072                           push   h2
    1993    1757   0080B C073                           push   h3
    1994    1758   0080D C074                           push   h4
    1995    1759   0080F C075                           push   h5
    1996    1760   00811 C076                           push   h6
    1997    1761   00813 C077                           push   h7
    1998    1762   00815 C078                           push   h8
    1999    1763   00817 C079                           push   h9
    2000    1764   00819 C07A                           push   h10
    2001    1765   0081B C07B                           push   h11
    2002    1766   0081D C07C                           push   h12
    2003    1767   0081F                  
    2004    1768   0081F                  ; eerst alles voorladen
    2005    1769   0081F                  
    2006    1770   0081F 757000                         mov    h0,#000h
    2007    1771   00822 757100                         mov    h1,#000h
    2008    1772   00825 757200                         mov    h2,#000h
    2009    1773   00828 757300                         mov    h3,#000h
    2010    1774   0082B 757400                         mov    h4,#000h
    2011    1775   0082E 757500                         mov    h5,#000h
    2012    1776   00831 757600                         mov    h6,#000h
    2013    1777   00834 757700                         mov    h7,#000h
    2014    1778   00837 757800                         mov    h8,#000h
    2015    1779   0083A 757900                         mov    h9,#000h
    2016    1780   0083D 757A00                         mov    h10,#000h
    2017    1781   00840 757B00                         mov    h11,#000h
    2018    1782   00843 757C20                         mov    h12,#32              ;loopcounter
    2019    1783   00846                  
    2020    1784   00846                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2021    1785   00846                  
    2022    1786   00846                  ; deze lus moet 32 keer heraald worden
    2023    1787   00846                  
    2024    1788   00846 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2025    1789   00847 33                             rlc    a
    2026    1790   00848 F8                             mov    r0,a
    2027    1791   00849 E9                             mov    a,r1
    2028    1792   0084A 33                             rlc    a
    2029    1793   0084B F9                             mov    r1,a
    2030    1794   0084C EA                             mov    a,r2
    2031    1795   0084D 33                             rlc    a
    2032    1796   0084E FA                             mov    r2,a
    2033    1797   0084F EB                             mov    a,r3
    2034    1798   00850 33                             rlc    a
    2035    1799   00851 FB                             mov    r3,a
    2036    1800   00852 E570                           mov    a,h0
    2037    1801   00854 33                             rlc    a
    2038    1802   00855 F570                           mov    h0,a
    2039    1803   00857 E571                           mov    a,h1
    2040    1804   00859 33                             rlc    a
    2041    1805   0085A F571                           mov    h1,a
    2042    1806   0085C E572                           mov    a,h2
    2043    1807   0085E 33                             rlc    a
    2044    1808   0085F F572                           mov    h2,a
    2045    1809   00861 E573                           mov    a,h3
    2046    1810   00863 33                             rlc    a
    2047    1811   00864 F573                           mov    h3,a
    2048    1812   00866                  
    2049    1813   00866                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2050    1814   00866                  
    2051    1815   00866 C3                             clr    c                    ;zit in de weg
    2052    1816   00867 E570                           mov    a,h0
    2053    1817   00869 9C                             subb   a,r4
    2054    1818   0086A F574                           mov    h4,a
    2055    1819   0086C E571                           mov    a,h1
    2056    1820   0086E 9D                             subb   a,r5
    2057    1821   0086F F575                           mov    h5,a
    2058    1822   00871 E572                           mov    a,h2
    2059    1823   00873 9E                             subb   a,r6
    2060    1824   00874 F576                           mov    h6,a
    2061    1825   00876 E573                           mov    a,h3
    2062    1826   00878 9F                             subb   a,r7
    2063    1827   00879 F577                           mov    h7,a
    2064    1828   0087B                  
    2065    1829   0087B                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2066    1830   0087B                  ; vervangen worden door h7-h4
    2067    1831   0087B                  
    2068    1832   0087B 400C                           jc     div322               ;niet vervangen
    2069    1833   0087D                  
    2070    1834   0087D 857470                         mov    h0,h4
    2071    1835   00880 857571                         mov    h1,h5
    2072    1836   00883 857672                         mov    h2,h6
    2073    1837   00886 857773                         mov    h3,h7                ;vervanging klaar
    2074    1838   00889                  
    2075    1839   00889 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2076    1840   0088A E578                           mov    a,h8
    2077    1841   0088C 33                             rlc    a
    2078    1842   0088D F578                           mov    h8,a
    2079    1843   0088F E579                           mov    a,h9
    2080    1844   00891 33                             rlc    a
    2081    1845   00892 F579                           mov    h9,a
    2082    1846   00894 E57A                           mov    a,h10
    2083    1847   00896 33                             rlc    a
    2084    1848   00897 F57A                           mov    h10,a
    2085    1849   00899 E57B                           mov    a,h11
    2086    1850   0089B 33                             rlc    a
    2087    1851   0089C F57B                           mov    h11,a                ;qoutient aangepast
    2088    1852   0089E                  
    2089    1853   0089E D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2090    1854   008A1                  
    2091    1855   008A1                  ; de berekening is klaar. uitkomstregisters nog laden
    2092    1856   008A1                  
    2093    1857   008A1 AC78                           mov    r4,h8
    2094    1858   008A3 AD79                           mov    r5,h9
    2095    1859   008A5 AE7A                           mov    r6,h10
    2096    1860   008A7 AF7B                           mov    r7,h11               ;uitkomst geladen
    2097    1861   008A9                  
    2098    1862   008A9 A870                           mov    r0,h0                ;rest laden
    2099    1863   008AB A971                           mov    r1,h1
    2100    1864   008AD AA72                           mov    r2,h2
    2101    1865   008AF AB73                           mov    r3,h3
    2102    1866   008B1                  
    2103    1867   008B1 D07C                           pop    h12                  ;registers herstellen
    2104    1868   008B3 D07B                           pop    h11
    2105    1869   008B5 D07A                           pop    h10
    2106    1870   008B7 D079                           pop    h9
    2107    1871   008B9 D078                           pop    h8
    2108    1872   008BB D077                           pop    h7
    2109    1873   008BD D076                           pop    h6
    2110    1874   008BF D075                           pop    h5
    2111    1875   008C1 D074                           pop    h4
    2112    1876   008C3 D073                           pop    h3
    2113    1877   008C5 D072                           pop    h2
    2114    1878   008C7 D071                           pop    h1
    2115    1879   008C9 D070                           pop    h0
    2116    1880   008CB D0D0                           pop    psw
    2117    1881   008CD D0E0                           pop    acc
    2118    1882   008CF 22                             ret
    2119    1883   008D0                  
    2120    1884   008D0                  
    2121    1885   008D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2122    1886   008D0                  ;
    2123    1887   008D0                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2124    1888   008D0                  ; input:      r1,r0 = eerste getal (r1=msb)
    2125    1889   008D0                  ;             r3,r2 = tweede getal (r3=msb)
    2126    1890   008D0                  ; output:     r3,r2 = quotient (r3=msb)
    2127    1891   008D0                  ;             r1,r0 = rest (r1=msb)
    2128    1892   008D0                  ;             carry=1 bij deling door 0
    2129    1893   008D0                  ;
    2130    1894   008D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2131    1895   008D0                  
    2132    1896   008D0 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2133    1897   008D2 C0D0                           push   psw
    2134    1898   008D4 C070                           push   h0
    2135    1899   008D6 C071                           push   h1
    2136    1900   008D8 C072                           push   h2
    2137    1901   008DA C073                           push   h3
    2138    1902   008DC C074                           push   h4
    2139    1903   008DE C075                           push   h5
    2140    1904   008E0 C076                           push   h6
    2141    1905   008E2                  
    2142    1906   008E2                  ; registers voorladen
    2143    1907   008E2                  
    2144    1908   008E2 757000                         mov    h0,#000h
    2145    1909   008E5 757100                         mov    h1,#000h
    2146    1910   008E8 757200                         mov    h2,#000h
    2147    1911   008EB 757300                         mov    h3,#000h
    2148    1912   008EE 757400                         mov    h4,#000h
    2149    1913   008F1 757500                         mov    h5,#000h
    2150    1914   008F4 757610                         mov    h6,#16               ;loopcounter
    2151    1915   008F7                  
    2152    1916   008F7                  ; eerst te delen getal 1*links shiften in hulpregisters
    2153    1917   008F7                  
    2154    1918   008F7                  ; deze lus moet 16 keer herhaald worden
    2155    1919   008F7                  
    2156    1920   008F7 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2157    1921   008F8 33                             rlc    a
    2158    1922   008F9 F8                             mov    r0,a
    2159    1923   008FA E9                             mov    a,r1
    2160    1924   008FB 33                             rlc    a
    2161    1925   008FC F9                             mov    r1,a
    2162    1926   008FD E570                           mov    a,h0
    2163    1927   008FF 33                             rlc    a
    2164    1928   00900 F570                           mov    h0,a
    2165    1929   00902 E571                           mov    a,h1
    2166    1930   00904 33                             rlc    a
    2167    1931   00905 F571                           mov    h1,a
    2168    1932   00907                  
    2169    1933   00907                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2170    1934   00907                  ; het tussenresultaat.
    2171    1935   00907                  
    2172    1936   00907 C3                             clr    c
    2173    1937   00908 E570                           mov    a,h0
    2174    1938   0090A 9A                             subb   a,r2
    2175    1939   0090B F572                           mov    h2,a
    2176    1940   0090D E571                           mov    a,h1
    2177    1941   0090F 9B                             subb   a,r3
    2178    1942   00910 F573                           mov    h3,a
    2179    1943   00912                  
    2180    1944   00912 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2181    1945   00914                                                            ;door h3,h2
    2182    1946   00914 857270                         mov    h0,h2
    2183    1947   00917 857371                         mov    h1,h3                ;vervanging klaar
    2184    1948   0091A                  
    2185    1949   0091A                  ; uitkomst moet aangepast worden
    2186    1950   0091A                  
    2187    1951   0091A B3               div162:       cpl    c                    ;truuk
    2188    1952   0091B E574                           mov    a,h4
    2189    1953   0091D 33                             rlc    a
    2190    1954   0091E F574                           mov    h4,a
    2191    1955   00920 E575                           mov    a,h5
    2192    1956   00922 33                             rlc    a
    2193    1957   00923 F575                           mov    h5,a
    2194    1958   00925 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2195    1959   00928                  
    2196    1960   00928                  ; de berekening is klaar. uitkomsten in passende registers
    2197    1961   00928                  
    2198    1962   00928 AA74                           mov    r2,h4                ;quotient
    2199    1963   0092A AB75                           mov    r3,h5
    2200    1964   0092C                  
    2201    1965   0092C A870                           mov    r0,h0                ;rest
    2202    1966   0092E A971                           mov    r1,h1
    2203    1967   00930                  
    2204    1968   00930 D076                           pop    h6                   ;registers herstellen
    2205    1969   00932 D075                           pop    h5
    2206    1970   00934 D074                           pop    h4
    2207    1971   00936 D073                           pop    h3
    2208    1972   00938 D072                           pop    h2
    2209    1973   0093A D071                           pop    h1
    2210    1974   0093C D070                           pop    h0
    2211    1975   0093E D0D0                           pop    psw
    2212    1976   00940 D0E0                           pop    acc
    2213    1977   00942 22                             ret
    2214    1978   00943                  
    2215    1979   00943                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2216    1980   00943                  ;
    2217    1981   00943                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2218    1982   00943                  ;
    2219    1983   00943                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2220    1984   00943                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2221    1985   00943                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2222    1986   00943                  ;
    2223    1987   00943                  ; r4,r3,r2,r1,r0 worden aangepast
    2224    1988   00943                  ;
    2225    1989   00943                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2226    1990   00943                  
    2227    1991   00943 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2228    1992   00945 C0D0                           push   psw
    2229    1993   00947 E8                             mov    a,r0                 ;eerste 8 bit
    2230    1994   00948 2C                             add    a,r4
    2231    1995   00949 F8                             mov    r0,a                 ;klaar
    2232    1996   0094A E9                             mov    a,r1                 ;volgende 8 bit
    2233    1997   0094B 3D                             addc   a,r5
    2234    1998   0094C F9                             mov    r1,a                 ;klaar
    2235    1999   0094D EA                             mov    a,r2                 ;volgende 8 bit
    2236    2000   0094E 3E                             addc   a,r6
    2237    2001   0094F FA                             mov    r2,a                 ;klaar
    2238    2002   00950 EB                             mov    a,r3                 ;laatste 8 bit
    2239    2003   00951 3F                             addc   a,r7
    2240    2004   00952 FB                             mov    r3,a                 ;32 bit klaar
    2241    2005   00953 7400                           mov    a,#000h
    2242    2006   00955 3400                           addc   a,#000h              ;carry verrekenen
    2243    2007   00957 FC                             mov    r4,a
    2244    2008   00958 D0D0                           pop    psw                  ;registers herstellen
    2245    2009   0095A D0E0                           pop    acc
    2246    2010   0095C 22                             ret
    2247    2011   0095D                  
    2248    2012   0095D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2249    2013   0095D                  ;
    2250    2014   0095D                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2251    2015   0095D                  ;
    2252    2016   0095D                  ; input:      r1,r0 = eerste getal (r1=msb)
    2253    2017   0095D                  ;             r3,r2 = tweede getal (r3=msb)
    2254    2018   0095D                  ; output:     r2,r1,r0 (r2=msb)
    2255    2019   0095D                  ;
    2256    2020   0095D                  ; r3,r2,r1,r0 worden aangepast
    2257    2021   0095D                  ;
    2258    2022   0095D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2259    2023   0095D                  
    2260    2024   0095D C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2261    2025   0095F C0D0                           push   psw
    2262    2026   00961 E8                             mov    a,r0                 ;starten met de optelling
    2263    2027   00962 2A                             add    a,r2                 ;8 bit klaar
    2264    2028   00963 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2265    2029   00964 E9                             mov    a,r1                 ;volgende 8 bit
    2266    2030   00965 3B                             addc   a,r3                 ;16 bit klaar
    2267    2031   00966 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2268    2032   00967 7400                           mov    a,#000h              ;carry verrekenen
    2269    2033   00969 3400                           addc   a,#000h
    2270    2034   0096B FA                             mov    r2,a                 ;24 bit klaar
    2271    2035   0096C D0D0                           pop    psw                  ;registers herstellen
    2272    2036   0096E D0E0                           pop    acc
    2273    2037   00970 22                             ret
    2274    2038   00971                  
    2275    2039   00971                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2276    2040   00971                  ;
    2277    2041   00971                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2278    2042   00971                  ;             40 bit groot. (eerste -tweede)
    2279    2043   00971                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2280    2044   00971                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2281    2045   00971                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2282    2046   00971                  ;
    2283    2047   00971                  ; r4,r3,r2,r1,r0 worden aangepast
    2284    2048   00971                  ;
    2285    2049   00971                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2286    2050   00971                  
    2287    2051   00971 C0E0             sub32:        push   acc                  ;registers bewaren
    2288    2052   00973 C0D0                           push   psw                  ;ook de vlaggen
    2289    2053   00975 C3                             clr    c                    ;zit nog effe in de weg
    2290    2054   00976 E8                             mov    a,r0                 ;eerste 8 bit
    2291    2055   00977 9C                             subb   a,r4
    2292    2056   00978 F8                             mov    r0,a
    2293    2057   00979 E9                             mov    a,r1                 ;tweede 8 bit
    2294    2058   0097A 9D                             subb   a,r5
    2295    2059   0097B F9                             mov    r1,a
    2296    2060   0097C EA                             mov    a,r2                 ;volgende 8 bit
    2297    2061   0097D 9E                             subb   a,r6
    2298    2062   0097E FA                             mov    r2,a
    2299    2063   0097F EB                             mov    a,r3                 ;laatste 8 bit
    2300    2064   00980 9F                             subb   a,r7
    2301    2065   00981 FB                             mov    r3,a
    2302    2066   00982 7400                           mov    a,#000h              ;nu nog de carry
    2303    2067   00984 9400                           subb   a,#000h
    2304    2068   00986 FC                             mov    r4,a                 ;40 bit klaar
    2305    2069   00987 D0D0                           pop    psw                  ;registers herstellen
    2306    2070   00989 D0E0                           pop    acc
    2307    2071   0098B 22                             ret
    2308    2072   0098C                  
    2309    2073   0098C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2310    2074   0098C                  ;
    2311    2075   0098C                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2312    2076   0098C                  ;             24 bit groot. (eerste - tweede)
    2313    2077   0098C                  ; input:      r1,r0 = eerste getal (r1=msb)
    2314    2078   0098C                  ;             r3,r2 = tweede getal (r3=msb)
    2315    2079   0098C                  ; output:     r2,r1,r0 (r2=msb)
    2316    2080   0098C                  ;
    2317    2081   0098C                  ; r3,r2,r1,r0 worden aangepast
    2318    2082   0098C                  ;
    2319    2083   0098C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2320    2084   0098C                  
    2321    2085   0098C C0E0             sub16:        push   acc                  ;registers bewaren
    2322    2086   0098E C0D0                           push   psw
    2323    2087   00990 C3                             clr    c                    ;mag nog niet meespelen
    2324    2088   00991 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2325    2089   00992 9A                             subb   a,r2
    2326    2090   00993 F8                             mov    r0,a                 ;klaar
    2327    2091   00994 E9                             mov    a,r1
    2328    2092   00995 9B                             subb   a,r3                 ;16 bit klaar
    2329    2093   00996 F9                             mov    r1,a
    2330    2094   00997 7400                           mov    a,#000h
    2331    2095   00999 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2332    2096   0099B FA                             mov    r2,a                 ;24 bit klaar
    2333    2097   0099C D0D0                           pop    psw                  ;registers herstellen
    2334    2098   0099E D0E0                           pop    acc
    2335    2099   009A0 22                             ret
    2336    2100   009A1                  
    2337    2101   009A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2338    2102   009A1                  ;
    2339    2103   009A1                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2340    2104   009A1                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2341    2105   009A1                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2342    2106   009A1                  ;
    2343    2107   009A1                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2344    2108   009A1                  ;
    2345    2109   009A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2346    2110   009A1                  
    2347    2111   009A1 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2348    2112   009A3 C0D0                           push   psw
    2349    2113   009A5                  
    2350    2114   009A5 C077                           push   h7                   ;nodig
    2351    2115   009A7 C078                           push   h8
    2352    2116   009A9                  
    2353    2117   009A9 C079                           push   h9                   ;ook
    2354    2118   009AB                  
    2355    2119   009AB 757905                         mov    h9,#005h             ;loopcounter
    2356    2120   009AE                  
    2357    2121   009AE 7B00             hexbcd161:    mov    r3,#000h
    2358    2122   009B0 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2359    2123   009B2 1208D0                         lcall  div16                ;deling uitvoeren
    2360    2124   009B5 E8                             mov    a,r0                 ;rest
    2361    2125   009B6 C0E0                           push   acc                  ;op stack zetten
    2362    2126   009B8 EA                             mov    a,r2
    2363    2127   009B9 F8                             mov    r0,a
    2364    2128   009BA EB                             mov    a,r3
    2365    2129   009BB F9                             mov    r1,a                 ;uitkomst terug delen
    2366    2130   009BC D579EF                         djnz   h9,hexbcd161
    2367    2131   009BF                  
    2368    2132   009BF D0E0                           pop    acc                  ;hoogste bits van de stack
    2369    2133   009C1 FA                             mov    r2,a                 ;klaar
    2370    2134   009C2 D0E0                           pop    acc
    2371    2135   009C4 C4                             swap   a
    2372    2136   009C5 F579                           mov    h9,a
    2373    2137   009C7 D0E0                           pop    acc
    2374    2138   009C9 2579                           add    a,h9
    2375    2139   009CB F9                             mov    r1,a                 ;volgende 8 klaar
    2376    2140   009CC D0E0                           pop    acc
    2377    2141   009CE C4                             swap   a
    2378    2142   009CF F579                           mov    h9,a
    2379    2143   009D1 D0E0                           pop    acc
    2380    2144   009D3 2579                           add    a,h9
    2381    2145   009D5 F8                             mov    r0,a                 ;klaar
    2382    2146   009D6                  
    2383    2147   009D6 D079                           pop    h9                   ;was naar de knoppen
    2384    2148   009D8                  
    2385    2149   009D8 D078                           pop    h8                   ;gebruikt
    2386    2150   009DA D077                           pop    h7
    2387    2151   009DC                  
    2388    2152   009DC D0D0                           pop    psw                  ;registers herstellen
    2389    2153   009DE D0E0                           pop    acc
    2390    2154   009E0 22                             ret
    2391    2155   009E1                  
    2392    2156   009E1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2393    2157   009E1                  ;
    2394    2158   009E1                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2395    2159   009E1                  ; input       a (maximale waarde = 63h)
    2396    2160   009E1                  ; output      a
    2397    2161   009E1                  ;
    2398    2162   009E1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2399    2163   009E1                  
    2400    2164   009E1 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2401    2165   009E3 C0F0                           push   b
    2402    2166   009E5 75F00A                         mov    b,#00ah              ;hierdoor delen
    2403    2167   009E8 84                             div    ab                   ;in accu qoutient in b rest
    2404    2168   009E9 C4                             swap   a
    2405    2169   009EA 25F0                           add    a,b                  ;bcd getal klaar
    2406    2170   009EC D0F0                           pop    b
    2407    2171   009EE D0D0                           pop    psw
    2408    2172   009F0 22                             ret
    2409    2173   009F1                  
    2410    2174   009F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2411    2175   009F1                  ;
    2412    2176   009F1                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2413    2177   009F1                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2414    2178   009F1                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2415    2179   009F1                  ;
    2416    2180   009F1                  ; de routine gebruikt r1,r0 van de huidige bank
    2417    2181   009F1                  ;
    2418    2182   009F1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2419    2183   009F1                  
    2420    2184   009F1 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2421    2185   009F3 C0E0                           push   acc
    2422    2186   009F5 C0D0                           push   psw
    2423    2187   009F7                  
    2424    2188   009F7 E8                             mov    a,r0
    2425    2189   009F8 540F                           anl    a,#00fh              ;eenheden
    2426    2190   009FA C0E0                           push   acc                  ;effe bewaren
    2427    2191   009FC                  
    2428    2192   009FC E8                             mov    a,r0
    2429    2193   009FD C4                             swap   a
    2430    2194   009FE 540F                           anl    a,#00fh              ;tientallen
    2431    2195   00A00 75F00A                         mov    b,#00ah              ;waarde berekenen
    2432    2196   00A03 A4                             mul    ab                   ;klaar
    2433    2197   00A04 D0F0                           pop    b                    ;truukje
    2434    2198   00A06 25F0                           add    a,b                  ;a is lage deel hex getal
    2435    2199   00A08 C0E0                           push   acc                  ;straks nodig
    2436    2200   00A0A                  
    2437    2201   00A0A E9                             mov    a,r1                 ;hoge deel
    2438    2202   00A0B 54F0                           anl    a,#0f0h
    2439    2203   00A0D C4                             swap   a
    2440    2204   00A0E C0E0                           push   acc                  ;straks nodig
    2441    2205   00A10                  
    2442    2206   00A10 E9                             mov    a,r1
    2443    2207   00A11 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2444    2208   00A13 75F064                         mov    b,#100               ;waarde uitrekenen
    2445    2209   00A16 A4                             mul    ab
    2446    2210   00A17 A9F0                           mov    r1,b
    2447    2211   00A19 F8                             mov    r0,a
    2448    2212   00A1A                  
    2449    2213   00A1A D0E0                           pop    acc
    2450    2214   00A1C 75F00A                         mov    b,#10
    2451    2215   00A1F A4                             mul    ab                   ;kan nog in a
    2452    2216   00A20 75F064                         mov    b,#100               ;*10*100=*1000
    2453    2217   00A23 A4                             mul    ab
    2454    2218   00A24 28                             add    a,r0
    2455    2219   00A25 F8                             mov    r0,a
    2456    2220   00A26 E9                             mov    a,r1
    2457    2221   00A27 35F0                           addc   a,b
    2458    2222   00A29 F9                             mov    r1,a
    2459    2223   00A2A                  
    2460    2224   00A2A D0E0                           pop    acc
    2461    2225   00A2C 28                             add    a,r0
    2462    2226   00A2D F8                             mov    r0,a
    2463    2227   00A2E 7400                           mov    a,#000h
    2464    2228   00A30 39                             addc   a,r1
    2465    2229   00A31 F9                             mov    r1,a                 ;klaar
    2466    2230   00A32                  
    2467    2231   00A32 D0D0                           pop    psw
    2468    2232   00A34 D0E0                           pop    acc
    2469    2233   00A36 D0F0                           pop    b
    2470    2234   00A38 22                             ret
    2471    2235   00A39                  
    2472    2236   00A39                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2473    2237   00A39                  ;
    2474    2238   00A39                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2475    2239   00A39                  ; input:      a (maximale waarde 99h)
    2476    2240   00A39                  ; output:     a
    2477    2241   00A39                  ;
    2478    2242   00A39                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2479    2243   00A39                  
    2480    2244   00A39 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2481    2245   00A3B C0F0                           push   b
    2482    2246   00A3D C070                           push   h0
    2483    2247   00A3F F570                           mov    h0,a                 ;effe bewaren
    2484    2248   00A41 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2485    2249   00A44 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2486    2250   00A46 C4                             swap   a
    2487    2251   00A47 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2488    2252   00A4A A4                             mul    ab
    2489    2253   00A4B 2570                           add    a,h0                 ;eenheden bijtellen
    2490    2254   00A4D D070                           pop    h0
    2491    2255   00A4F D0F0                           pop    b
    2492    2256   00A51 D0D0                           pop    psw
    2493    2257   00A53 22                             ret
    2494    2258   00A54                  
    2495    2259   00A54                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2496    2260   00A54                  ;
    2497    2261   00A54                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2498    2262   00A54                  ;
    2499    2263   00A54                  ; Gebruikt geen registers
    2500    2264   00A54                  ;
    2501    2265   00A54                  ; Originele auteur: Danny Pawels (dp)
    2502    2266   00A54                  ;
    2503    2267   00A54                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2504    2268   00A54                  
    2505    2269   00A54                  
    2506    2270   00A54 C083             XCsw2xtal:  push  dph
    2507    2271   00A56 C082                         push  dpl
    2508    2272   00A58 C0D0                         push  psw
    2509    2273   00A5A C08F                         push  syscon0
    2510    2274   00A5C C0B2                         push  port_page
    2511    2275   00A5E C0BF                         push  scu_page
    2512    2276   00A60                  
    2513    2277   00A60 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2514    2278   00A63 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2515    2279   00A66                  
    2516    2280   00A66 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2517    2281   00A69                                                            ;freq= VCO-free running =5MHz...20MHz?
    2518    2282   00A69 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2519    2283   00A6C 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2520    2284   00A6F 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2521    2285   00A72                  
    2522    2286   00A72 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2523    2287   00A75 A3               XCsw2xtal0: inc   dptr
    2524    2288   00A76 E582                         mov   a,dpl
    2525    2289   00A78 4583                         orl   a,dph
    2526    2290   00A7A 70F9                         jnz   XCsw2xtal0
    2527    2291   00A7C                  
    2528    2292   00A7C 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2529    2293   00A7F                  
    2530    2294   00A7F                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2531    2295   00A7F E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2532    2296   00A81 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2533    2297   00A84                  ;Oscillator run detectie is klaar...
    2534    2298   00A84 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2535    2299   00A87                  
    2536    2300   00A87                  
    2537    2301   00A87 E5B7                         mov   a,pll_con               ;lees pll_con
    2538    2302   00A89 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2539    2303   00A8B 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2540    2304   00A8D                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2541    2305   00A8D                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2542    2306   00A8D                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2543    2307   00A8D 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2544    2308   00A90                                                            ;bij aanpassing van de NDIV van de PLL
    2545    2309   00A90 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2546    2310   00A92 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2547    2311   00A95 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2548    2312   00A98                  
    2549    2313   00A98 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2550    2314   00A9A 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2551    2315   00A9D                  
    2552    2316   00A9D 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2553    2317   00AA0 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2554    2318   00AA3                  
    2555    2319   00AA3 D0BF                         pop   scu_page                ;herstel controller status
    2556    2320   00AA5 D0B2                         pop   port_page
    2557    2321   00AA7 D08F                         pop   syscon0
    2558    2322   00AA9 D0D0                         pop   psw
    2559    2323   00AAB D082                         pop   dpl
    2560    2324   00AAD D083                         pop   dph
    2561    2325   00AAF 22                           ret
    2562    2326   00AB0                  
    2563    2327   00AB0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2564    2328   00AB0                  ;
    2565    2329   00AB0                  ; mapregs	selecteer de SFR's in de mapped area
    2566    2330   00AB0                  ;
    2567    2331   00AB0                  ;
    2568    2332   00AB0                  ; Past syscon SFR aan
    2569    2333   00AB0                  ;
    2570    2334   00AB0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2571    2335   00AB0                  
    2572    2336   00AB0 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2573    2337   00AB3 22               		ret
    2574    2338   00AB4                  
    2575    2339   00AB4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2576    2340   00AB4                  ;
    2577    2341   00AB4                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2578    2342   00AB4                  ;
    2579    2343   00AB4                  ; Past syscon SFR aan
    2580    2344   00AB4                  ;
    2581    2345   00AB4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2582    2346   00AB4                  
    2583    2347   00AB4 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2584    2348   00AB7 22               		ret
    2585    2349   00AB8                  
    2586    2350   00AB8                  ;*******************************************************************************
    2587    2351   00AB8                  ;
    2588    2352   00AB8                  ; These are the register declarations for the XC888 microcontroller from
    2589    2353   00AB8                  ; Infineon.
    2590    2354   00AB8                  ;
    2591    2355   00AB8                  ;*******************************************************************************
    2592    2356   00AB8                  
    2593    2357   00AB8                  ;*******************************************************************************
    2594    2358   00AB8                  ;
    2595    2359   00AB8                  ; CPU registers are accessible independend of paging and mapping
    2596    2360   00AB8                  ; (always accessible)
    2597    2361   00AB8                  ;
    2598    2362   00AB8                  ;*******************************************************************************
    2599    2363   00AB8                  
    2600    2364   00AB8                  sp            data   081h          ;stack pointer                     reset=007h
    2601    2365   00AB8                  dpl           data   082h          ;datapointer low register          reset=000h
    2602    2366   00AB8                  dph           data   083h          ;datapointer high register         reset=000h
    2603    2367   00AB8                  pcon          data   087h          ;power control                     reset=000h
    2604    2368   00AB8                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2605    2369   00AB8                  ;tcon is bit addressable
    2606    2370   00AB8                         tf1    bit    08fh
    2607    2371   00AB8                         tr1    bit    08eh
    2608    2372   00AB8                         tf0    bit    08dh
    2609    2373   00AB8                         tr0    bit    08ch
    2610    2374   00AB8                         ie1    bit    08bh
    2611    2375   00AB8                         it1    bit    08ah
    2612    2376   00AB8                         ie0    bit    089h
    2613    2377   00AB8                         it0    bit    088h
    2614    2378   00AB8                  
    2615    2379   00AB8                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2616    2380   00AB8                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2617    2381   00AB8                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2618    2382   00AB8                  th0           data   08ch          ;timer 0 high                      reset=000h
    2619    2383   00AB8                  th1           data   08dh          ;timer 1 high                      reset=000h
    2620    2384   00AB8                  
    2621    2385   00AB8                  syscon0       data   08fh          ;system control register 0         reset=004h
    2622    2386   00AB8                  scon          data   098h          ;serial channel 0 control          reset=000h
    2623    2387   00AB8                  ;scon is bit addressable
    2624    2388   00AB8                         sm0    bit    09fh
    2625    2389   00AB8                         sm1    bit    09eh
    2626    2390   00AB8                         sm2    bit    09dh
    2627    2391   00AB8                         ren    bit    09ch
    2628    2392   00AB8                         tb8    bit    09bh
    2629    2393   00AB8                         rb8    bit    09ah
    2630    2394   00AB8                         ti     bit    099h
    2631    2395   00AB8                         ri     bit    098h
    2632    2396   00AB8                  
    2633    2397   00AB8                  sbuf          data   099h          ;serial data buffer channel 0
    2634    2398   00AB8                  eo            data   0a2h          ;extended operation                reset=000h
    2635    2399   00AB8                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2636    2400   00AB8                  ;ien0 is bit addressable
    2637    2401   00AB8                         ea     bit    0afh
    2638    2402   00AB8                                                     ;bit not implemented
    2639    2403   00AB8                         et2    bit    0adh
    2640    2404   00AB8                         es     bit    0ach
    2641    2405   00AB8                         et1    bit    0abh
    2642    2406   00AB8                         ex1    bit    0aah
    2643    2407   00AB8                         et0    bit    0a9h
    2644    2408   00AB8                         ex0    bit    0a8h
    2645    2409   00AB8                  
    2646    2410   00AB8                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2647    2411   00AB8                  ;ip is bit addressable
    2648    2412   00AB8                                                     ;bit not implemented
    2649    2413   00AB8                                                     ;bit not implemented
    2650    2414   00AB8                         pt2    bit    0bdh
    2651    2415   00AB8                         ps     bit    0bch
    2652    2416   00AB8                         pt1    bit    0bbh
    2653    2417   00AB8                         px1    bit    0bah
    2654    2418   00AB8                         pt0    bit    0b9h
    2655    2419   00AB8                         px0    bit    0b8h
    2656    2420   00AB8                  
    2657    2421   00AB8                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2658    2422   00AB8                  psw           data   0d0h          ;program status word               reset=000h
    2659    2423   00AB8                  ;psw is bit addressable
    2660    2424   00AB8                         cy     bit    0d7h
    2661    2425   00AB8                         ac     bit    0d6h
    2662    2426   00AB8                         f0     bit    0d5h
    2663    2427   00AB8                         rs1    bit    0d4h
    2664    2428   00AB8                         rs0    bit    0d3h
    2665    2429   00AB8                         ov     bit    0d2h
    2666    2430   00AB8                         f1     bit    0d1h
    2667    2431   00AB8                         p      bit    0d0h
    2668    2432   00AB8                  
    2669    2433   00AB8                  acc           data   0e0h          ;accumulator                       reset=000h
    2670    2434   00AB8                  ;acc is bit addressable
    2671    2435   00AB8                  
    2672    2436   00AB8                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2673    2437   00AB8                  ;ien1 is bit addressable
    2674    2438   00AB8                         eccip3 bit    0efh
    2675    2439   00AB8                         eccip2 bit    0eeh
    2676    2440   00AB8                         eccip1 bit    0edh
    2677    2441   00AB8                         eccip0 bit    0ech
    2678    2442   00AB8                         exm    bit    0ebh
    2679    2443   00AB8                         ex2    bit    0eah
    2680    2444   00AB8                         essc   bit    0e9h
    2681    2445   00AB8                         eadc   bit    0e8h
    2682    2446   00AB8                  
    2683    2447   00AB8                  b             data   0f0h          ;b register                        reset=000h
    2684    2448   00AB8                  ;b is bit addressable
    2685    2449   00AB8                  
    2686    2450   00AB8                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2687    2451   00AB8                  ;ip1 is bit addressable
    2688    2452   00AB8                         pccip3 bit    0ffh
    2689    2453   00AB8                         pccip2 bit    0feh
    2690    2454   00AB8                         pccip1 bit    0fdh
    2691    2455   00AB8                         pccip0 bit    0fch
    2692    2456   00AB8                         pxm    bit    0fbh
    2693    2457   00AB8                         px2    bit    0fah
    2694    2458   00AB8                         pssc   bit    0f9h
    2695    2459   00AB8                         padc   bit    0f8h
    2696    2460   00AB8                  
    2697    2461   00AB8                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2698    2462   00AB8                  
    2699    2463   00AB8                  
    2700    2464   00AB8                  ;*******************************************************************************
    2701    2465   00AB8                  ;
    2702    2466   00AB8                  ; system control registers registers that can only be accessed in the non
    2703    2467   00AB8                  ; mapped memory area (rmap=0) page independent
    2704    2468   00AB8                  ;
    2705    2469   00AB8                  ;*******************************************************************************
    2706    2470   00AB8                  
    2707    2471   00AB8                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2708    2472   00AB8                  
    2709    2473   00AB8                  ;*******************************************************************************
    2710    2474   00AB8                  ;
    2711    2475   00AB8                  ; system control registers registers that can only be accessed in the non
    2712    2476   00AB8                  ; mapped memory area (rmap=0) and page 0
    2713    2477   00AB8                  ;
    2714    2478   00AB8                  ;*******************************************************************************
    2715    2479   00AB8                  
    2716    2480   00AB8                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2717    2481   00AB8                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2718    2482   00AB8                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2719    2483   00AB8                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2720    2484   00AB8                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2721    2485   00AB8                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2722    2486   00AB8                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2723    2487   00AB8                  nmisr         data   0bch          ;nmi status                        reset=000h
    2724    2488   00AB8                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2725    2489   00AB8                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2726    2490   00AB8                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2727    2491   00AB8                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2728    2492   00AB8                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2729    2493   00AB8                  
    2730    2494   00AB8                  ;*******************************************************************************
    2731    2495   00AB8                  ;
    2732    2496   00AB8                  ; system control registers registers that can only be accessed in the non
    2733    2497   00AB8                  ; mapped memory area (rmap=0) and page 1
    2734    2498   00AB8                  ;
    2735    2499   00AB8                  ;*******************************************************************************
    2736    2500   00AB8                  
    2737    2501   00AB8                  id            data   0b3h          ;identity register     reset=device dependent
    2738    2502   00AB8                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2739    2503   00AB8                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2740    2504   00AB8                  osc_con       data   0b6h          ;osc control                       reset=008h
    2741    2505   00AB8                  pll_con       data   0b7h          ;pll control                       reset=090h
    2742    2506   00AB8                  cmcon         data   0bah          ;clock control                     reset=010h
    2743    2507   00AB8                  passwd        data   0bbh          ;password register                 reset=007h
    2744    2508   00AB8                  feal          data   0bch          ;flash error register              reset=000h
    2745    2509   00AB8                  feah          data   0bdh          ;flash error address high          reset=000h
    2746    2510   00AB8                  cocon         data   0beh          ;clock output control              reset=000h
    2747    2511   00AB8                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2748    2512   00AB8                  
    2749    2513   00AB8                  ;*******************************************************************************
    2750    2514   00AB8                  ;
    2751    2515   00AB8                  ; system control registers registers that can only be accessed in the non
    2752    2516   00AB8                  ; mapped memory area (rmap=0) and page 3
    2753    2517   00AB8                  ;
    2754    2518   00AB8                  ;*******************************************************************************
    2755    2519   00AB8                  
    2756    2520   00AB8                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2757    2521   00AB8                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2758    2522   00AB8                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2759    2523   00AB8                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2760    2524   00AB8                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2761    2525   00AB8                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2762    2526   00AB8                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2763    2527   00AB8                  
    2764    2528   00AB8                  ;*******************************************************************************
    2765    2529   00AB8                  ;
    2766    2530   00AB8                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2767    2531   00AB8                  ;
    2768    2532   00AB8                  ;*******************************************************************************
    2769    2533   00AB8                  
    2770    2534   00AB8                  port_page     data   0b2h          ;port page register                reset=000h
    2771    2535   00AB8                  
    2772    2536   00AB8                  ;*******************************************************************************
    2773    2537   00AB8                  ;
    2774    2538   00AB8                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2775    2539   00AB8                  ;
    2776    2540   00AB8                  ;*******************************************************************************
    2777    2541   00AB8                  
    2778    2542   00AB8                  p0_data       data   080h          ;port 0 data register              reset=000h
    2779    2543   00AB8                  ;p0_data is bit addressable
    2780    2544   00AB8                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2781    2545   00AB8                  p1_data       data   090h          ;port 1 data register              reset=000h
    2782    2546   00AB8                  ;p1_data is bit addressable
    2783    2547   00AB8                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2784    2548   00AB8                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2785    2549   00AB8                  ;p2_data is bit addressable
    2786    2550   00AB8                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2787    2551   00AB8                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2788    2552   00AB8                  ;p3_data is bit addressable
    2789    2553   00AB8                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2790    2554   00AB8                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2791    2555   00AB8                  ;p4_data is bit addressable
    2792    2556   00AB8                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2793    2557   00AB8                  p5_data       data   092h          ;port 5 data register              reset=000h
    2794    2558   00AB8                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2795    2559   00AB8                  
    2796    2560   00AB8                  ;*******************************************************************************
    2797    2561   00AB8                  ;
    2798    2562   00AB8                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2799    2563   00AB8                  ;
    2800    2564   00AB8                  ;*******************************************************************************
    2801    2565   00AB8                  
    2802    2566   00AB8                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2803    2567   00AB8                  ;p0_data is bit addressable
    2804    2568   00AB8                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2805    2569   00AB8                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2806    2570   00AB8                  ;p1_data is bit addressable
    2807    2571   00AB8                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2808    2572   00AB8                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2809    2573   00AB8                  ;p2_data is bit addressable
    2810    2574   00AB8                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2811    2575   00AB8                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2812    2576   00AB8                  ;p3_data is bit addressable
    2813    2577   00AB8                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2814    2578   00AB8                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2815    2579   00AB8                  ;p4_data is bit addressable
    2816    2580   00AB8                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2817    2581   00AB8                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2818    2582   00AB8                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2819    2583   00AB8                  
    2820    2584   00AB8                  ;*******************************************************************************
    2821    2585   00AB8                  ;
    2822    2586   00AB8                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2823    2587   00AB8                  ;
    2824    2588   00AB8                  ;*******************************************************************************
    2825    2589   00AB8                  
    2826    2590   00AB8                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2827    2591   00AB8                  ;p0_data is bit addressable
    2828    2592   00AB8                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2829    2593   00AB8                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2830    2594   00AB8                  ;p1_data is bit addressable
    2831    2595   00AB8                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2832    2596   00AB8                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2833    2597   00AB8                  ;p3_data is bit addressable
    2834    2598   00AB8                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2835    2599   00AB8                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2836    2600   00AB8                  ;p4_data is bit addressable
    2837    2601   00AB8                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2838    2602   00AB8                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2839    2603   00AB8                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2840    2604   00AB8                  
    2841    2605   00AB8                  ;*******************************************************************************
    2842    2606   00AB8                  ;
    2843    2607   00AB8                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2844    2608   00AB8                  ;
    2845    2609   00AB8                  ;*******************************************************************************
    2846    2610   00AB8                  
    2847    2611   00AB8                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2848    2612   00AB8                  ;p0_data is bit addressable
    2849    2613   00AB8                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2850    2614   00AB8                  ;p1_data is bit addressable
    2851    2615   00AB8                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2852    2616   00AB8                  ;p3_data is bit addressable
    2853    2617   00AB8                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2854    2618   00AB8                  ;p4_data is bit addressable
    2855    2619   00AB8                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2856    2620   00AB8                  
    2857    2621   00AB8                  ;*******************************************************************************
    2858    2622   00AB8                  ;
    2859    2623   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2860    2624   00AB8                  ;
    2861    2625   00AB8                  ;*******************************************************************************
    2862    2626   00AB8                  
    2863    2627   00AB8                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2864    2628   00AB8                  
    2865    2629   00AB8                  ;*******************************************************************************
    2866    2630   00AB8                  ;
    2867    2631   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2868    2632   00AB8                  ;
    2869    2633   00AB8                  ;*******************************************************************************
    2870    2634   00AB8                  
    2871    2635   00AB8                  adc_globctr   data   0cah          ;global control register           reset=030h
    2872    2636   00AB8                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2873    2637   00AB8                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2874    2638   00AB8                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2875    2639   00AB8                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2876    2640   00AB8                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2877    2641   00AB8                  
    2878    2642   00AB8                  ;*******************************************************************************
    2879    2643   00AB8                  ;
    2880    2644   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2881    2645   00AB8                  ;
    2882    2646   00AB8                  ;*******************************************************************************
    2883    2647   00AB8                  
    2884    2648   00AB8                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2885    2649   00AB8                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2886    2650   00AB8                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2887    2651   00AB8                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2888    2652   00AB8                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2889    2653   00AB8                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2890    2654   00AB8                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2891    2655   00AB8                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2892    2656   00AB8                  
    2893    2657   00AB8                  ;*******************************************************************************
    2894    2658   00AB8                  ;
    2895    2659   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2896    2660   00AB8                  ;
    2897    2661   00AB8                  ;*******************************************************************************
    2898    2662   00AB8                  
    2899    2663   00AB8                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2900    2664   00AB8                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2901    2665   00AB8                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2902    2666   00AB8                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2903    2667   00AB8                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2904    2668   00AB8                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2905    2669   00AB8                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2906    2670   00AB8                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2907    2671   00AB8                  
    2908    2672   00AB8                  ;*******************************************************************************
    2909    2673   00AB8                  ;
    2910    2674   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2911    2675   00AB8                  ;
    2912    2676   00AB8                  ;*******************************************************************************
    2913    2677   00AB8                  
    2914    2678   00AB8                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2915    2679   00AB8                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2916    2680   00AB8                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2917    2681   00AB8                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2918    2682   00AB8                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2919    2683   00AB8                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2920    2684   00AB8                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2921    2685   00AB8                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2922    2686   00AB8                  
    2923    2687   00AB8                  ;*******************************************************************************
    2924    2688   00AB8                  ;
    2925    2689   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2926    2690   00AB8                  ;
    2927    2691   00AB8                  ;*******************************************************************************
    2928    2692   00AB8                  
    2929    2693   00AB8                  adc_rcr0      data   0cah          ;result control register           reset=000h
    2930    2694   00AB8                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    2931    2695   00AB8                  adc_rcr2      data   0cch          ;result control register           reset=000h
    2932    2696   00AB8                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    2933    2697   00AB8                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    2934    2698   00AB8                  
    2935    2699   00AB8                  ;*******************************************************************************
    2936    2700   00AB8                  ;
    2937    2701   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    2938    2702   00AB8                  ;
    2939    2703   00AB8                  ;*******************************************************************************
    2940    2704   00AB8                  
    2941    2705   00AB8                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    2942    2706   00AB8                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    2943    2707   00AB8                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    2944    2708   00AB8                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    2945    2709   00AB8                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    2946    2710   00AB8                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    2947    2711   00AB8                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    2948    2712   00AB8                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    2949    2713   00AB8                  
    2950    2714   00AB8                  ;*******************************************************************************
    2951    2715   00AB8                  ;
    2952    2716   00AB8                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    2953    2717   00AB8                  ;
    2954    2718   00AB8                  ;*******************************************************************************
    2955    2719   00AB8                  
    2956    2720   00AB8                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    2957    2721   00AB8                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    2958    2722   00AB8                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    2959    2723   00AB8                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    2960    2724   00AB8                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    2961    2725   00AB8                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    2962    2726   00AB8                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    2963    2727   00AB8                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    2964    2728   00AB8                  
    2965    2729   00AB8                  ;*******************************************************************************
    2966    2730   00AB8                  
    2967    2731   00AB8                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    2968    2732   00AB8                  ;
    2969    2733   00AB8                  ;*******************************************************************************
    2970    2734   00AB8                  
    2971    2735   00AB8                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    2972    2736   00AB8                  ;t2_t2con is bit addressable
    2973    2737   00AB8                         tf2    bit    0c7h
    2974    2738   00AB8                         exf2   bit    0c6h
    2975    2739   00AB8                                                     ;2 bits are not implemented
    2976    2740   00AB8                         exen2  bit    0c3h
    2977    2741   00AB8                         tr2    bit    0c2h
    2978    2742   00AB8                         ct2    bit    0c1h
    2979    2743   00AB8                         cprl2  bit    0c0h
    2980    2744   00AB8                  
    2981    2745   00AB8                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    2982    2746   00AB8                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    2983    2747   00AB8                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    2984    2748   00AB8                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    2985    2749   00AB8                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    2986    2750   00AB8                  
    2987    2751   00AB8                  ;*******************************************************************************
    2988    2752   00AB8                  ;
    2989    2753   00AB8                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    2990    2754   00AB8                  ;
    2991    2755   00AB8                  ;*******************************************************************************
    2992    2756   00AB8                  
    2993    2757   00AB8                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    2994    2758   00AB8                  
    2995    2759   00AB8                  ;*******************************************************************************
    2996    2760   00AB8                  ;
    2997    2761   00AB8                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    2998    2762   00AB8                  ;
    2999    2763   00AB8                  ;*******************************************************************************
    3000    2764   00AB8                  
    3001    2765   00AB8                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3002    2766   00AB8                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3003    2767   00AB8                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3004    2768   00AB8                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3005    2769   00AB8                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3006    2770   00AB8                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3007    2771   00AB8                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3008    2772   00AB8                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3009    2773   00AB8                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3010    2774   00AB8                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3011    2775   00AB8                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3012    2776   00AB8                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3013    2777   00AB8                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3014    2778   00AB8                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3015    2779   00AB8                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3016    2780   00AB8                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3017    2781   00AB8                  
    3018    2782   00AB8                  ;*******************************************************************************
    3019    2783   00AB8                  ;
    3020    2784   00AB8                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3021    2785   00AB8                  ;
    3022    2786   00AB8                  ;*******************************************************************************
    3023    2787   00AB8                  
    3024    2788   00AB8                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3025    2789   00AB8                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3026    2790   00AB8                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3027    2791   00AB8                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3028    2792   00AB8                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3029    2793   00AB8                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3030    2794   00AB8                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3031    2795   00AB8                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3032    2796   00AB8                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3033    2797   00AB8                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3034    2798   00AB8                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3035    2799   00AB8                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3036    2800   00AB8                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3037    2801   00AB8                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3038    2802   00AB8                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3039    2803   00AB8                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3040    2804   00AB8                  
    3041    2805   00AB8                  ;*******************************************************************************
    3042    2806   00AB8                  ;
    3043    2807   00AB8                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3044    2808   00AB8                  ;
    3045    2809   00AB8                  ;*******************************************************************************
    3046    2810   00AB8                  
    3047    2811   00AB8                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3048    2812   00AB8                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3049    2813   00AB8                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3050    2814   00AB8                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3051    2815   00AB8                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3052    2816   00AB8                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3053    2817   00AB8                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3054    2818   00AB8                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3055    2819   00AB8                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3056    2820   00AB8                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3057    2821   00AB8                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3058    2822   00AB8                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3059    2823   00AB8                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3060    2824   00AB8                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3061    2825   00AB8                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3062    2826   00AB8                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3063    2827   00AB8                  
    3064    2828   00AB8                  ;*******************************************************************************
    3065    2829   00AB8                  ;
    3066    2830   00AB8                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3067    2831   00AB8                  ;
    3068    2832   00AB8                  ;*******************************************************************************
    3069    2833   00AB8                  
    3070    2834   00AB8                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3071    2835   00AB8                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3072    2836   00AB8                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3073    2837   00AB8                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3074    2838   00AB8                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3075    2839   00AB8                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3076    2840   00AB8                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3077    2841   00AB8                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3078    2842   00AB8                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3079    2843   00AB8                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3080    2844   00AB8                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3081    2845   00AB8                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3082    2846   00AB8                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3083    2847   00AB8                  
    3084    2848   00AB8                  ;*******************************************************************************
    3085    2849   00AB8                  ;
    3086    2850   00AB8                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3087    2851   00AB8                  ;
    3088    2852   00AB8                  ;*******************************************************************************
    3089    2853   00AB8                  
    3090    2854   00AB8                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3091    2855   00AB8                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3092    2856   00AB8                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3093    2857   00AB8                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3094    2858   00AB8                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3095    2859   00AB8                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3096    2860   00AB8                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3097    2861   00AB8                  
    3098    2862   00AB8                  ;*******************************************************************************
    3099    2863   00AB8                  ;
    3100    2864   00AB8                  ; can registers can be accessed in the standard memory map (rmap=0)
    3101    2865   00AB8                  ;
    3102    2866   00AB8                  ;*******************************************************************************
    3103    2867   00AB8                  
    3104    2868   00AB8                  adcon         data   0d8h          ;adres/data control                reset=000h
    3105    2869   00AB8                  ; adcon is bit addressable
    3106    2870   00AB8                         v3     bit    0dfh
    3107    2871   00AB8                         v2     bit    0deh
    3108    2872   00AB8                         v1     bit    0ddh
    3109    2873   00AB8                         v0     bit    0dch
    3110    2874   00AB8                         auad1  bit    0dbh
    3111    2875   00AB8                         auad0  bit    0dah
    3112    2876   00AB8                         can_bsy bit   0d9h
    3113    2877   00AB8                         rwen   bit    0d8h
    3114    2878   00AB8                  
    3115    2879   00AB8                  adl           data   0d9h          ;adres register low                reset=000h
    3116    2880   00AB8                  adh           data   0dah          ;adres register low                reset=000h
    3117    2881   00AB8                  data0         data   0dbh          ;can data                          reset=000h
    3118    2882   00AB8                  data1         data   0dch          ;can data                          reset=000h
    3119    2883   00AB8                  data2         data   0ddh          ;can data                          reset=000h
    3120    2884   00AB8                  data3         data   0deh          ;can data                          reset=000h
    3121    2885   00AB8                  
    3122    2886   00AB8                  ;*******************************************************************************
    3123    2887   00AB8                  ;
    3124    2888   00AB8                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3125    2889   00AB8                  ;
    3126    2890   00AB8                  ;*******************************************************************************
    3127    2891   00AB8                  
    3128    2892   00AB8                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3129    2893   00AB8                  ;mdustat is bit addressable
    3130    2894   00AB8                                                     ;5 bits are not implemented
    3131    2895   00AB8                         bsy    bit    0b2h
    3132    2896   00AB8                         ierr   bit    0b1h
    3133    2897   00AB8                         irdy   bit    0b0h
    3134    2898   00AB8                  
    3135    2899   00AB8                  mducon        data   0b1h          ;mdu control                       reset=000h
    3136    2900   00AB8                  md0           data   0b2h          ;mdu operand register              reset=000h
    3137    2901   00AB8                  mr0           data   0b2h          ;mdu result register               reset=000h
    3138    2902   00AB8                  md1           data   0b3h          ;mdu operand register              reset=000h
    3139    2903   00AB8                  mr1           data   0b3h          ;mdu result register               reset=000h
    3140    2904   00AB8                  md2           data   0b4h          ;mdu operand register              reset=000h
    3141    2905   00AB8                  mr2           data   0b4h          ;mdu result register               reset=000h
    3142    2906   00AB8                  md3           data   0b5h          ;mdu operand register              reset=000h
    3143    2907   00AB8                  mr3           data   0b5h          ;mdu result register               reset=000h
    3144    2908   00AB8                  md4           data   0b6h          ;mdu operand register              reset=000h
    3145    2909   00AB8                  mr4           data   0b6h          ;mdu result register               reset=000h
    3146    2910   00AB8                  md5           data   0b7h          ;mdu operand register              reset=000h
    3147    2911   00AB8                  mr5           data   0b7h          ;mdu result register               reset=000h
    3148    2912   00AB8                  
    3149    2913   00AB8                  ;*******************************************************************************
    3150    2914   00AB8                  ;
    3151    2915   00AB8                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3152    2916   00AB8                  ;
    3153    2917   00AB8                  ;*******************************************************************************
    3154    2918   00AB8                  
    3155    2919   00AB8                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3156    2920   00AB8                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3157    2921   00AB8                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3158    2922   00AB8                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3159    2923   00AB8                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3160    2924   00AB8                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3161    2925   00AB8                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3162    2926   00AB8                  ;cd_statc is bit addressable
    3163    2927   00AB8                         keepz  bit    0a7h
    3164    2928   00AB8                         keepy  bit    0a6h
    3165    2929   00AB8                         keepx  bit    0a5h
    3166    2930   00AB8                         dmap   bit    0a4h
    3167    2931   00AB8                         int_en bit    0a3h
    3168    2932   00AB8                         eoc    bit    0a2h
    3169    2933   00AB8                         error  bit    0a1h
    3170    2934   00AB8                         cd_bsy bit    0a0h
    3171    2935   00AB8                  
    3172    2936   00AB8                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3173    2937   00AB8                  
    3174    2938   00AB8                  ;*******************************************************************************
    3175    2939   00AB8                  ;
    3176    2940   00AB8                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3177    2941   00AB8                  ;
    3178    2942   00AB8                  ;*******************************************************************************
    3179    2943   00AB8                  
    3180    2944   00AB8                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3181    2945   00AB8                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3182    2946   00AB8                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3183    2947   00AB8                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3184    2948   00AB8                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3185    2949   00AB8                  
    3186    2950   00AB8                  ;*******************************************************************************
    3187    2951   00AB8                  ;
    3188    2952   00AB8                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3189    2953   00AB8                  ;
    3190    2954   00AB8                  ;*******************************************************************************
    3191    2955   00AB8                  
    3192    2956   00AB8                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3193    2957   00AB8                  ;t2_t2con is bit addressable bits are aalready defined
    3194    2958   00AB8                         ;tf2    bit    0c7h
    3195    2959   00AB8                         ;exf2   bit    0c6h
    3196    2960   00AB8                                                     ;2 bits are not implemented
    3197    2961   00AB8                         ;exen2  bit    0c3h
    3198    2962   00AB8                         ;tr2    bit    0c2h
    3199    2963   00AB8                         ;ct2    bit    0c1h
    3200    2964   00AB8                         ;cprl2  bit    0c0h
    3201    2965   00AB8                  
    3202    2966   00AB8                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3203    2967   00AB8                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3204    2968   00AB8                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3205    2969   00AB8                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3206    2970   00AB8                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3207    2971   00AB8                  
    3208    2972   00AB8                  ;*******************************************************************************
    3209    2973   00AB8                  ;
    3210    2974   00AB8                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3211    2975   00AB8                  ;
    3212    2976   00AB8                  ;*******************************************************************************
    3213    2977   00AB8                  
    3214    2978   00AB8                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3215    2979   00AB8                  ;s1con is bit addressable
    3216    2980   00AB8                         sm01   bit    0cfh
    3217    2981   00AB8                         sm11   bit    0ceh
    3218    2982   00AB8                         sm21   bit    0cdh
    3219    2983   00AB8                         ren1   bit    0cch
    3220    2984   00AB8                         tb81   bit    0cbh
    3221    2985   00AB8                         rb81   bit    0cah
    3222    2986   00AB8                         ti1    bit    0c9h
    3223    2987   00AB8                         ri1    bit    0c8h
    3224    2988   00AB8                  
    3225    2989   00AB8                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3226    2990   00AB8                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3227    2991   00AB8                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3228    2992   00AB8                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3229    2993   00AB8                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3230    2994   00AB8                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3231    2995   00AB8                  
    3232    2996   00AB8                  ;*******************************************************************************
    3233    2997   00AB8                  ;
    3234    2998   00AB8                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3235    2999   00AB8                  ;
    3236    3000   00AB8                  ;*******************************************************************************
    3237    3001   00AB8                  
    3238    3002   00AB8                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3239    3003   00AB8                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3240    3004   00AB8                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3241    3005   00AB8                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3242    3006   00AB8                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3243    3007   00AB8                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3244    3008   00AB8                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3245    3009   00AB8                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3246    3010   00AB8                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3247    3011   00AB8                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3248    3012   00AB8                  
    3249    3013   00AB8                  ;end directive must be used, but has no signification
    3250    3014   00AB8                  
    3251    3015   00AB8                  end
    3252    3016   00AB8                  
    3253    3017   00AB8                  
    3254    3018   00AB8                  
    3255    3019   00AB8                  
    3256    3020   00AB8                  
    3257    3021   00AB8                  
    3258    3022   00AB8                  
    3259    3023   00AB8                  
    3260    3024   00AB8                  
    3261    3025   00AB8                  
    3262    3026   00AB8                  
    3263    3027   00AB8                  
    3264    3028   00AB8                  
    3265    3029   00AB8                  
    3266    3030   00AB8                  
    3267    3031   00AB8                  
