C:\Users\Nico\Desktop\Project\Digi-Sketch\programma\DigiSketch.xsf 
       1       1   00000                  org 0000h
       2       2   00000                  
       3       3   00000                  
       4       4   00000                  
       5       5   00000                  ;------------------------------------------------------------------
       6       6   00000                  ;Hoofd programma
       7       7   00000                  ;------------------------------------------------------------------
       8       8   00000                  main:
       9       9   00000 75817F               mov     sp,#7fh                 ;stackpointer instellen
      10      10   00003 1201B4               lcall   initftoetsen
      11      11   00006 120066               lcall   inits
      12      12   00009                  
      13      13   00009 751100               mov     DATAREG,#00h            ;adres pointer voor tekst instellen
      14      14   0000C 120141               lcall   zendData
      15      15   0000F 751100               mov     DATAREG,#00h
      16      16   00012 120141               lcall   zendData
      17      17   00015 751224               mov     COMANDREG,#24h
      18      18   00018 120161               lcall   zendComando
      19      19   0001B                  
      20      20   0001B 751124               mov     DATAREG,#24h
      21      21   0001E 120141               lcall   zendData
      22      22   00021 7512C0               mov     COMANDREG,#c0h
      23      23   00024 120161               lcall   zendComando
      24      24   00027                  
      25      25   00027 75129C               mov     COMANDREG,#9ch
      26      26   0002A 120161               lcall   zendComando
      27      27   0002D                  lus2:
      28      28   0002D 751124               mov     DATAREG,#24h
      29      29   00030 120141               lcall   zendData
      30      30   00033 7512C0               mov     COMANDREG,#c0h
      31      31   00036 120161               lcall   zendComando
      32      32   00039                  
      33      33   00039                  
      34      34   00039 751124               mov     DATAREG,#24h
      35      35   0003C 120141               lcall   zendData
      36      36   0003F 7512C0               mov     COMANDREG,#c0h
      37      37   00042 120161               lcall   zendComando
      38      38   00045                  
      39      39   00045                  
      40      40   00045 751124               mov     DATAREG,#24h
      41      41   00048 120141               lcall   zendData
      42      42   0004B 7512C0               mov     COMANDREG,#c0h
      43      43   0004E 120161               lcall   zendComando
      44      44   00051                  
      45      45   00051                  
      46      46   00051 751124               mov     DATAREG,#24h
      47      47   00054 120141               lcall   zendData
      48      48   00057 7512C0               mov     COMANDREG,#c0h
      49      49   0005A 120161               lcall   zendComando
      50      50   0005D                  
      51      51   0005D 75129C               mov     COMANDREG,#9ch
      52      52   00060 120161               lcall   zendComando
      53      53   00063 02002D               ljmp    lus2
      54      54   00066                  
      55      55   00066                  
      56      56   00066                  
      57      57   00066                  ;------------------------------------------------------------------
      58      58   00066                  ;Initializatie van alle componenten nodig in het hoofd programma
      59      59   00066                  ;------------------------------------------------------------------
      60      60   00066                  inits:
      61      61   00066 120097               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      62      62   00069 22               ret
      63      63   0006A                  
      64      64   0006A                  
      65      65   0006A                  
      66      66   0006A                  
      67      67   0006A                  
project.inc 
      69       1   0006A                  ;------------------------------------------------------------------
      70       2   0006A                  ;Lijst van functies:
      71       3   0006A                  ;   -statusCheck            Status check van scherm opslaan in STA register
      72       4   0006A                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      73       5   0006A                  ;   -P1out                  Initializatie poort 1 als output
      74       6   0006A                  ;   -P3in                   Initializatie poort 3 als output
      75       7   0006A                  ;   -P3out                  Initializatie poort 3 als input
      76       8   0006A                  ;   -zendData               Data verzeden naar scherm
      77       9   0006A                  ;   -zenComando             Comando verzeden naar scherm
      78      10   0006A                  ;   -debug                  debug info op seriele poot zetten
      79      11   0006A                  ;------------------------------------------------------------------
      80      12   0006A                  ;------------------------------------------------------------------
      81      13   0006A                  ;declaratie van pinnen
      82      14   0006A                  ;------------------------------------------------------------------
      83      15   0006A                      WR          bit     p1_data.5   ;write line van scherm actief laag
      84      16   0006A                      RD          bit     p1_data.4   ;read line van scherrm actief laag
      85      17   0006A                      CE          bit     p1_data.3   ;chip enble van scherm actief laag
      86      18   0006A                      CD          bit     p1_data.2   ;Command write
      87      19   0006A                      RESET       bit     p1_data.0   ;reset van scherm actief laag
      88      20   0006A                      FS          bit     p1_data.6   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      89      21   0006A                  
      90      22   0006A                  
      91      23   0006A                  
      92      24   0006A                  ;------------------------------------------------------------------
      93      25   0006A                  ;declaratie van registers
      94      26   0006A                  ;------------------------------------------------------------------
      95      27   0006A                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
      96      28   0006A                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
      97      29   0006A                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
      98      30   0006A                  
      99      31   0006A                  
     100      32   0006A                  ;------------------------------------------------------------------
     101      33   0006A                  ;Status check van scherm opslaan in STA register
     102      34   0006A                  ;-STA
     103      35   0006A                  ;------------------------------------------------------------------
     104      36   0006A                  statusCheck:
     105      37   0006A C0E0                 push    acc
     106      38   0006C C0D0                 push    psw
     107      39   0006E 12012F               lcall   P3in                        ;poort 3 als input schakelen
     108      40   00071                  STAOPNIEUW:
     109      41   00071 751000               mov     STA,#00h                    ;STA register leeg maken
     110      42   00074 D292                 setb    CD                          ;C/D hoog maken
     111      43   00076 120305               lcall   delay10us
     112      44   00079 75905D               mov     p1_data,#01011101b
     113      45   0007C D294                 setb    RD                          ;RD' laag maken
     114      46   0007E C295                 clr     WR                          ;WR' hoog maken
     115      47   00080 D293                 setb    CE                          ;CE' laag maken
     116      48   00082 E5B0                 mov     a,p3_data                   ;status word inlezen
     117      49   00084 5403                 anl     a,#03h                      ;masker voor STA0 en STA1
     118      50   00086 B403E8               cjne    a,#03h,STAOPNIEUW           ;vergelijken
     119      51   00089 F510                 mov     STA,a                       ;data opslaan in STA voor eventuel gebruik later
     120      52   0008B A810                 mov     r0,STA                      ;debug status op aurt zetten
     121      53   0008D 120182               lcall   debug
     122      54   00090 C293                 clr     CE                          ;CE' terug hoog maken
     123      55   00092 D0D0                 pop     psw
     124      56   00094 D0E0                 pop     acc
     125      57   00096 22               ret
     126      58   00097                  
     127      59   00097                  ;------------------------------------------------------------------
     128      60   00097                  ;Initializatie van grafisch LCD scherm
     129      61   00097                  ;-Poort 1
     130      62   00097                  ;------------------------------------------------------------------
     131      63   00097                  initGLCD:
     132      64   00097 12010B               lcall   P1out                   ;poort 1 initializeren
     133      65   0009A C290                 clr     RESET                   ;reseten van scherm
     134      66   0009C D296                 setb    FS                      ;font op 6*8 zetten
     135      67   0009E C293                 clr     CE                      ;chip enable hoog zetten
     136      68   000A0 7414                 mov     a,#20                   ;reset lang genenoeg laten duren
     137      69   000A2 120314               lcall   delaya0k05s
     138      70   000A5 D290                 setb    RESET                   ;reset terug af zetten
     139      71   000A7                  
     140      72   000A7 12054D               lcall   initsio                 ;voor debug
     141      73   000AA                  
     142      74   000AA                  w1:
     143      75   000AA 30A0FD               jnb     p2_data.0,w1
     144      76   000AD                  
     145      77   000AD 12006A               lcall   statusCheck             ;initiele status check uitvoeren
     146      78   000B0                  
     147      79   000B0 751280               mov     COMANDREG,#80h          ;mode instellen
     148      80   000B3 120161               lcall   zendComando             ;mode instellen
     149      81   000B6                  wacht2:
     150      82   000B6 30A0FD               jnb     p2_data.0,wacht2
     151      83   000B9                  
     152      84   000B9 751100               mov     DATAREG,#00h            ;grafisch home adres
     153      85   000BC 120141               lcall   zendData
     154      86   000BF 751100               mov     DATAREG,#00h
     155      87   000C2 120141               lcall   zendData
     156      88   000C5 751242               mov     COMANDREG,#42h
     157      89   000C8 120161               lcall   zendComando
     158      90   000CB                  wacht3:
     159      91   000CB 30A0FD               jnb     p2_data.0,wacht3
     160      92   000CE 751128               mov     DATAREG,#28h            ;Grafic aeria set
     161      93   000D1 120141               lcall   zendData
     162      94   000D4 751100               mov     DATAREG,#00h
     163      95   000D7 120141               lcall   zendData
     164      96   000DA 751243               mov     COMANDREG,#43h
     165      97   000DD 120161               lcall   zendComando
     166      98   000E0                  
     167      99   000E0                  wacht4:
     168     100   000E0 30A0FD               jnb     p2_data.0,wacht4
     169     101   000E3 751100               mov     DATAREG,#00h            ;text home aderes
     170     102   000E6 120141               lcall   zendData
     171     103   000E9 751100               mov     DATAREG,#00h
     172     104   000EC 120141               lcall   zendData
     173     105   000EF 751240               mov     COMANDREG,#40h
     174     106   000F2 120161               lcall   zendComando
     175     107   000F5                  wacht5:
     176     108   000F5 30A0FD               jnb     p2_data.0,wacht5
     177     109   000F8 751128               mov     DATAREG,#28h            ;aantal colommen text
     178     110   000FB 120141               lcall   zendData
     179     111   000FE 751100               mov     DATAREG,#00h
     180     112   00101 120141               lcall   zendData
     181     113   00104 751241               mov     COMANDREG,#41h
     182     114   00107 120161               lcall   zendComando
     183     115   0010A 22               ret
     184     116   0010B                  
     185     117   0010B                  
     186     118   0010B                  ;------------------------------------------------------------------
     187     119   0010B                  ;Initializatie poort 1 als output
     188     120   0010B                  ;-poort 1
     189     121   0010B                  ;------------------------------------------------------------------
     190     122   0010B                  P1out:
     191     123   0010B C08F                 push    syscon0                 ;juiste map selecteren
     192     124   0010D 758F04               mov     syscon0,#004h
     193     125   00110 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     194     126   00112 75B200               mov     port_page,#000h         ;selecteer poort page 0
     195     127   00115 7591FF               mov     p1_dir,#0ffh            ;poort 3 als output schakelen
     196     128   00118 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     197     129   0011A D08F                 pop     syscon0                 ;pagina terug herstellen
     198     130   0011C 22               ret
     199     131   0011D                  
     200     132   0011D                  ;------------------------------------------------------------------
     201     133   0011D                  ;Initializatie poort 3 als output
     202     134   0011D                  ;-poort 3
     203     135   0011D                  ;------------------------------------------------------------------
     204     136   0011D                  P3out:
     205     137   0011D C08F                 push    syscon0                 ;juiste map selecteren
     206     138   0011F 758F04               mov     syscon0,#004h
     207     139   00122 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     208     140   00124 75B200               mov     port_page,#000h         ;selecteer poort page 0
     209     141   00127 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output schakelen
     210     142   0012A D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     211     143   0012C D08F                 pop     syscon0                 ;pagina terug herstellen
     212     144   0012E 22               ret
     213     145   0012F                  
     214     146   0012F                  ;------------------------------------------------------------------
     215     147   0012F                  ;Initializatie poort 3 als input
     216     148   0012F                  ;-poort 3
     217     149   0012F                  ;------------------------------------------------------------------
     218     150   0012F                  P3in:
     219     151   0012F C08F                 push    syscon0                 ;juiste map selecteren
     220     152   00131 758F04               mov     syscon0,#004h
     221     153   00134 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     222     154   00136 75B200               mov     port_page,#000h         ;selecteer poort page 0
     223     155   00139 75B100               mov     p3_dir,#000h            ;poort 3 als input schakelen
     224     156   0013C D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     225     157   0013E D08F                 pop     syscon0                 ;pagina terug herstellen
     226     158   00140 22               ret
     227     159   00141                  
     228     160   00141                  ;------------------------------------------------------------------
     229     161   00141                  ;Data verzeden naar scherm
     230     162   00141                  ;-DATAREG
     231     163   00141                  ;------------------------------------------------------------------
     232     164   00141                  zendData:
     233     165   00141 C0E0                 push    acc
     234     166   00143 C0D0                 push    psw
     235     167   00145 12011D               lcall   P3out                   ;poort 3 als output schakelen
     236     168   00148 C292                 clr     CD                      ;C/D laag maken
     237     169   0014A 120305               lcall   delay10us
     238     170   0014D 759069               mov     p1_data,#01101001b
     239     171   00150 F5B0                 mov     p3_data,a               ;data op de poort zetten
     240     172   00152 C293                 clr     CE                      ;CE' hoog maken
     241     173   00154 A811                 mov     r0,DATAREG
     242     174   00156 120182               lcall   debug
     243     175   00159 12006A               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     244     176   0015C D0D0                 pop     psw
     245     177   0015E D0E0                 pop     acc
     246     178   00160 22               ret
     247     179   00161                  
     248     180   00161                  ;------------------------------------------------------------------
     249     181   00161                  ;Comando verzeden naar scherm
     250     182   00161                  ;-COMANDREG
     251     183   00161                  ;------------------------------------------------------------------
     252     184   00161                  zendComando:
     253     185   00161 C0E0                 push    acc
     254     186   00163 C0D0                 push    psw
     255     187   00165 12011D               lcall   P3out                   ;poort 3 als output schakelen
     256     188   00168 D292                 setb    CD                      ;C/D hoog maken
     257     189   0016A 120305               lcall   delay10us
     258     190   0016D 43906D               orl     p1_data,#01101101b
     259     191   00170 8512B0               mov     p3_data,COMANDREG       ;data op de poort zetten
     260     192   00173 C293                 clr     CE                      ;CE' hoog maken
     261     193   00175 A812                 mov     r0,COMANDREG
     262     194   00177 120182               lcall   debug
     263     195   0017A 12006A               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     264     196   0017D D0D0                 pop     psw
     265     197   0017F D0E0                 pop     acc
     266     198   00181 22               ret
     267     199   00182                  
     268     200   00182                  ;------------------------------------------------------------------
     269     201   00182                  ;debug info op seriele poort zetten
     270     202   00182                  ;-r0
     271     203   00182                  ;------------------------------------------------------------------
     272     204   00182                  debug:
     273     205   00182 C0E0                 push    acc
     274     206   00184 C0D0                 push    psw
     275     207   00186 740D                 mov     a,#0dh
     276     208   00188 120585               lcall   siooutchar
     277     209   0018B E8                   mov     a,r0
     278     210   0018C 1205A1               lcall   siooutbyte
     279     211   0018F 740A                 mov     a,#0ah
     280     212   00191 120585               lcall   siooutchar
     281     213   00194 D0D0                 pop     psw
     282     214   00196 D0E0                 pop     acc
     283     215   00198 22               ret
     284     216   00199                  
     285     217   00199                  
     286     218   00199                  
     287     219   00199                  
     288     220   00199                  
     289     221   00199                  
     290     222   00199                  
     291     223   00199                  
     292     224   00199                  
     293     225   00199                  
     294     226   00199                  
     295     227   00199                  
     296     228   00199                  
     297     229   00199                  
     298     230   00199                  
     299     231   00199                  
     300     232   00199                  
     301     233   00199                  
     302     234   00199                  
     303     235   00199                  
xcez1.inc 
     305       1   00199                  ;*******************************************************************************
     306       2   00199                  ;
     307       3   00199                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     308       4   00199                  ;
     309       5   00199                  ; The file contains drivers for various hardware and math applications.
     310       6   00199                  ; In addition all register declarations are added.
     311       7   00199                  ;
     312       8   00199                  ; WARNING:!!!!!!!
     313       9   00199                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     314      10   00199                  ;
     315      11   00199                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     316      12   00199                  ;
     317      13   00199                  ;*******************************************************************************
     318      14   00199                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     319      15   00199                  ;
     320      16   00199                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     321      17   00199                  ;
     322      18   00199                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     323      19   00199                  ; eenvoudige manier te gebruiken:
     324      20   00199                  ;
     325      21   00199                  ; standaard I/O:
     326      22   00199                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     327      23   00199                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     328      24   00199                  ;      initleds             klaar zetten LED's als outputs
     329      25   00199                  ;
     330      26   00199                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     331      27   00199                  ;      initiic              klaar zetten iic interface
     332      28   00199                  ;      iicstart             genereren van een startconditie op iic poort
     333      29   00199                  ;      iicstop              genereren stop conditie op iic poort
     334      30   00199                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     335      31   00199                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     336      32   00199                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     337      33   00199                  ;
     338      34   00199                  ; LCD interace
     339      35   00199                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     340      36   00199                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     341      37   00199                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     342      38   00199                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     343      39   00199                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     344      40   00199                  ;      lcdlighton           backlight aan
     345      41   00199                  ;      lcdlightoff          backlight uit
     346      42   00199                  ;      lcdbuzon             buzzer aan
     347      43   00199                  ;      lcdbuzof             buzzer uit
     348      44   00199                  ;
     349      45   00199                  ; Seriële interface (via USB stekker!!)
     350      46   00199                  ;      initsio              klaar zetten seriële poort 9600 baud
     351      47   00199                  ;      siooutchar           afdrukken ascii code (accu=input)
     352      48   00199                  ;      siooutbyte           afdrkken getal in accu
     353      49   00199                  ;      siooutnib            afdrukken 4 laagste bits accu
     354      50   00199                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     355      51   00199                  ;      sioinchar            inlezen van 1 ascii code in de accu
     356      52   00199                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     357      53   00199                  ;
     358      54   00199                  ; ADC
     359      55   00199                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     360      56   00199                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     361      57   00199                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     362      58   00199                  ;
     363      59   00199                  ; Arithmetic:
     364      60   00199                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     365      61   00199                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     366      62   00199                  ;      div16                delen 2 16 bit getallen
     367      63   00199                  ;      div32                delen 2 32 bit getallen
     368      64   00199                  ;      add16                optellen 2 16 bit getallen
     369      65   00199                  ;      add32                optellen 2 32 bit getallen
     370      66   00199                  ;      sub16                verschil 2 16 bit getallen
     371      67   00199                  ;      sub32                verschil 2 32 bit getallen
     372      68   00199                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     373      69   00199                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     374      70   00199                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     375      71   00199                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     376      72   00199                  ;
     377      73   00199                  ; Diverse
     378      74   00199                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     379      75   00199                  ;      delay1ms             tijdsverraging 1 milliseconde
     380      76   00199                  ;      delay10us            tijdsvertraging 10 microseconde
     381      77   00199                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     382      78   00199                  ;	mapregs 		selecteer de SFR's in de mapped area
     383      79   00199                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     384      80   00199                  ;
     385      81   00199                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     386      82   00199                  ; LET OP!!!!
     387      83   00199                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     388      84   00199                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     389      85   00199                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     390      86   00199                  ;
     391      87   00199                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     392      88   00199                  ;
     393      89   00199                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     394      90   00199                  
     395      91   00199                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     396      92   00199                  ;
     397      93   00199                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     398      94   00199                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     399      95   00199                  ; massa zonder extra weerstanden.
     400      96   00199                  ;
     401      97   00199                  ; Gebruikt geen registers
     402      98   00199                  ;
     403      99   00199                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     404     100   00199                  
     405     101   00199 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     406     102   0019B 758F04                         mov    syscon0,#004h
     407     103   0019E C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     408     104   001A0 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     409     105   001A3 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     410     106   001A6 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     411     107   001A9 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     412     108   001AC 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     413     109   001AF D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     414     110   001B1 D08F                           pop    syscon0              ;pagina terug herstellen
     415     111   001B3 22                             ret
     416     112   001B4                  
     417     113   001B4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     418     114   001B4                  ;
     419     115   001B4                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     420     116   001B4                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     421     117   001B4                  ; 2 behouden hun originele instelling.
     422     118   001B4                  ;
     423     119   001B4                  ; Gebruikt geen registers
     424     120   001B4                  ;
     425     121   001B4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     426     122   001B4                  
     427     123   001B4 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     428     124   001B6 758F04                         mov    syscon0,#004h
     429     125   001B9 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     430     126   001BB 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     431     127   001BE 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     432     128   001C1 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     433     129   001C4 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     434     130   001C7 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     435     131   001CA D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     436     132   001CC D08F                           pop    syscon0              ;pagina terug herstellen
     437     133   001CE 22                             ret
     438     134   001CF                  
     439     135   001CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     440     136   001CF                  ;
     441     137   001CF                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     442     138   001CF                  ; worden gedoofd (actief laag om ze te laden branden).
     443     139   001CF                  ;
     444     140   001CF                  ; Gebruikt geen registers
     445     141   001CF                  ;
     446     142   001CF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     447     143   001CF                  
     448     144   001CF                  
     449     145   001CF C08F             initleds:     push   syscon0              ;juiste map selecteren
     450     146   001D1 758F04                         mov    syscon0,#004h
     451     147   001D4 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     452     148   001D6 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     453     149   001D9 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     454     150   001DC D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     455     151   001DE D08F                           pop    syscon0              ;pagina terug herstellen
     456     152   001E0 22                             ret
     457     153   001E1                  
     458     154   001E1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     459     155   001E1                  ;
     460     156   001E1                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     461     157   001E1                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     462     158   001E1                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     463     159   001E1                  ; sda wordt als input geschakeld
     464     160   001E1                  ;
     465     161   001E1                  ; LET OP!!
     466     162   001E1                  ; Dit is een IIC bus met beperkte mogelijkheden:
     467     163   001E1                  ; -vaste communicatiesnleheid van 100kbit/s
     468     164   001E1                  ; -enkel master mode
     469     165   001E1                  ; -enkel 7 bit adressering
     470     166   001E1                  ; -geen klok stretching
     471     167   001E1                  ;
     472     168   001E1                  ; Gebruikt geen registers
     473     169   001E1                  ;
     474     170   001E1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     475     171   001E1                  
     476     172   001E1                  sda           bit    p0_data.7            ;pin gebruikt als sda
     477     173   001E1                  scl           bit    p0_data.3            ;pin gebruikt als scl
     478     174   001E1                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     479     175   001E1                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     480     176   001E1                  
     481     177   001E1 C08F             initiic:      push   syscon0              ;juiste map selecteren
     482     178   001E3 758F04                         mov    syscon0,#004h
     483     179   001E6 C0B2                           push   port_page
     484     180   001E8 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     485     181   001EB D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     486     182   001ED D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     487     183   001EF 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     488     184   001F2 D283                           setb   scl                  ;klok werkt als od
     489     185   001F4 D287                           setb   sda                  ;sda werkt als od
     490     186   001F6 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     491     187   001F9 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     492     188   001FC 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     493     189   001FF D0B2                           pop    port_page            ;pagina herstellen
     494     190   00201 D08F                           pop    syscon0              ;map herstellen
     495     191   00203 22                             ret
     496     192   00204                  
     497     193   00204                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     498     194   00204                  ;
     499     195   00204                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     500     196   00204                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     501     197   00204                  ; te garanderen volgt er een delay van 10us
     502     198   00204                  ;
     503     199   00204                  ; Gebruikt geen registers
     504     200   00204                  ;
     505     201   00204                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     506     202   00204                  
     507     203   00204 C08F             iicstart:     push   syscon0              ;map bewaren
     508     204   00206 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     509     205   00209 C0B2                           push   port_page            ;pagina bewaren
     510     206   0020B 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     511     207   0020E D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     512     208   00210 D287                           setb   sda                  ;idem
     513     209   00212 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     514     210   00215 120305                         lcall  delay10us            ;
     515     211   00218 C287                           clr    sda                  ;data laag
     516     212   0021A 120305                         lcall  delay10us
     517     213   0021D C283                           clr    scl                  ;dan klok laag
     518     214   0021F 120305                         lcall  delay10us            ;bit lang genoeg maken
     519     215   00222 D0B2                           pop    port_page            ;registers herstellen
     520     216   00224 D08F                           pop    syscon0
     521     217   00226 22                             ret
     522     218   00227                  
     523     219   00227                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     524     220   00227                  ;
     525     221   00227                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     526     222   00227                  ;
     527     223   00227                  ; Gebruikt geen registers
     528     224   00227                  ;
     529     225   00227                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     530     226   00227                  
     531     227   00227 C08F             iicstop:      push   syscon0              ;map bewaren
     532     228   00229 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     533     229   0022C C0B2                           push   port_page            ;pagina bewaren
     534     230   0022E 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     535     231   00231 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     536     232   00234 C287                           clr    sda                  ;data naar omlaag
     537     233   00236 120305                         lcall  delay10us
     538     234   00239 D283                           setb   scl                  ;klok naar 1
     539     235   0023B 120305                         lcall  delay10us            ;wachten
     540     236   0023E D287                           setb   sda                  ;idem data
     541     237   00240 120305                         lcall  delay10us            ;
     542     238   00243 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     543     239   00246 D0B2                           pop    port_page            ;registers herstellen
     544     240   00248 D08F                           pop    syscon0
     545     241   0024A 22                             ret
     546     242   0024B                  
     547     243   0024B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     548     244   0024B                  ;
     549     245   0024B                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     550     246   0024B                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     551     247   0024B                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     552     248   0024B                  ;
     553     249   0024B                  ; Gebruikt:
     554     250   0024B                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     555     251   0024B                  ;      cy=ack bit vanuit de slave
     556     252   0024B                  ;
     557     253   0024B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     558     254   0024B                  
     559     255   0024B C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     560     256   0024D C0F0                           push   b                    ;gebruikt als loopcounter
     561     257   0024F C08F                           push   syscon0              ;map juist zetten
     562     258   00251 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     563     259   00254 C0B2                           push   port_page            ;poort pagina bewaren
     564     260   00256 75B200                         mov    port_page,#000h      ;basispagina selecteren
     565     261   00259 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     566     262   0025C 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     567     263   0025F 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     568     264   00260 9287                           mov    sda,c                ;op pin
     569     265   00262 120305                         lcall  delay10us            ;wachten
     570     266   00265 D283                           setb   scl                  ;puls genereren
     571     267   00267 120305                         lcall  delay10us            ;ook hier wat tijd laten
     572     268   0026A C283                           clr    scl                  ;klok terug laag maken
     573     269   0026C D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     574     270   0026F                  
     575     271   0026F                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     576     272   0026F                  
     577     273   0026F 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     578     274   00272 120305                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     579     275   00275 D283                           setb   scl                  ;puls terug hoog
     580     276   00277 A287                           mov    c,sda                ;inlezen en naar carry
     581     277   00279 120305                         lcall  delay10us
     582     278   0027C C283                           clr    scl                  ;klok blijft laag achter
     583     279   0027E D0B2                           pop    port_page
     584     280   00280 D08F                           pop    syscon0
     585     281   00282 D0F0                           pop    b
     586     282   00284 D0E0                           pop    acc
     587     283   00286 22                             ret
     588     284   00287                  
     589     285   00287                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     590     286   00287                  ;
     591     287   00287                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     592     288   00287                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     593     289   00287                  ;
     594     290   00287                  ; Gebruikt:
     595     291   00287                  ;      -de accu als output
     596     292   00287                  ;
     597     293   00287                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     598     294   00287                  
     599     295   00287 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     600     296   00289 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     601     297   0028C C0B2                           push   port_page            ;pagina bewaren
     602     298   0028E 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     603     299   00291 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     604     300   00293 C0D0                           push   psw                  ;vlaggen bewaren
     605     301   00295 75F008                         mov    b,#008h              ;loopcounter laden
     606     302   00298 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     607     303   0029B 120305           iicinbyteack1:lcall  delay10us
     608     304   0029E D283                           setb   scl                  ;klok hoog
     609     305   002A0 A287                           mov    c,sda                ;pin inlezen
     610     306   002A2 33                             rlc    a                    ;in accu shiften
     611     307   002A3 120305                         lcall  delay10us
     612     308   002A6 C283                           clr    scl                  ;klok terug laag
     613     309   002A8 D5F0F0                         djnz   b,iicinbyteack1
     614     310   002AB 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     615     311   002AE C287                           clr    sda                  ;ack genereren
     616     312   002B0 120305                         lcall  delay10us
     617     313   002B3 D283                           setb   scl
     618     314   002B5 120305                         lcall  delay10us
     619     315   002B8 C283                           clr    scl
     620     316   002BA 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     621     317   002BD D0D0                           pop    psw                  ;registers herstellen
     622     318   002BF D0F0                           pop    b
     623     319   002C1 D0B2                           pop    port_page
     624     320   002C3 D08F                           pop    syscon0
     625     321   002C5 22                             ret
     626     322   002C6                  
     627     323   002C6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     628     324   002C6                  ;
     629     325   002C6                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     630     326   002C6                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     631     327   002C6                  ;
     632     328   002C6                  ; Gebruikt:
     633     329   002C6                  ;      -de accu als output
     634     330   002C6                  ;
     635     331   002C6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     636     332   002C6                  
     637     333   002C6 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     638     334   002C8 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     639     335   002CB C0B2                           push   port_page            ;pagina bewaren
     640     336   002CD 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     641     337   002D0 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     642     338   002D2 C0D0                           push   psw                  ;vlaggen bewaren
     643     339   002D4 75F008                         mov    b,#008h              ;loopcounter laden
     644     340   002D7 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     645     341   002DA 120305           iicinbytenack1:lcall  delay10us
     646     342   002DD D283                           setb   scl                  ;klok hoog
     647     343   002DF A287                           mov    c,sda                ;pin inlezen
     648     344   002E1 33                             rlc    a                    ;in accu shiften
     649     345   002E2 120305                         lcall  delay10us
     650     346   002E5 C283                           clr    scl                  ;klok terug laag
     651     347   002E7 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     652     348   002EA 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     653     349   002ED D287                           setb   sda                  ;nack genereren
     654     350   002EF 120305                         lcall  delay10us
     655     351   002F2 D283                           setb   scl
     656     352   002F4 120305                         lcall  delay10us
     657     353   002F7 C283                           clr    scl
     658     354   002F9 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     659     355   002FC D0D0                           pop    psw                  ;registers herstellen
     660     356   002FE D0F0                           pop    b
     661     357   00300 D0B2                           pop    port_page
     662     358   00302 D08F                           pop    syscon0
     663     359   00304 22                             ret
     664     360   00305                  
     665     361   00305                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     666     362   00305                  ;
     667     363   00305                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     668     364   00305                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     669     365   00305                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     670     366   00305                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     671     367   00305                  ;
     672     368   00305                  ; Gebruikt geen registers
     673     369   00305                  ;
     674     370   00305                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     675     371   00305                  
     676     372   00305 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     677     373   00307 C0D0                           push   psw                  ;8*42ns=330ns
     678     374   00309 75E01A                         mov    acc,#01ah            ;420ns
     679     375   0030C D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     680     376   0030F D0D0                           pop    psw                  ;8*42ns=330ns
     681     377   00311 D0E0                           pop    acc                  ;8*42ns=330ns
     682     378   00313 22                             ret                         ;165ns
     683     379   00314                  
     684     380   00314                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     685     381   00314                  ;
     686     382   00314                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     687     383   00314                  ;
     688     384   00314                  ; Gebruikt geen registers
     689     385   00314                  ;
     690     386   00314                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     691     387   00314                  
     692     388   00314 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     693     389   00316 C0D0                           push   psw
     694     390   00318 C0F0                           push   b
     695     391   0031A 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     696     392   0031D 12032D           delaya0k05s1: lcall  delay1ms
     697     393   00320 D5F0FA                         djnz   b,delaya0k05s1
     698     394   00323 D5E0F4                         djnz   acc,delaya0k05s2
     699     395   00326 D0F0                           pop    b                    ;registers herstellen
     700     396   00328 D0D0                           pop    psw
     701     397   0032A D0E0                           pop    acc
     702     398   0032C 22                             ret
     703     399   0032D                  
     704     400   0032D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     705     401   0032D                  ;
     706     402   0032D                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     707     403   0032D                  ;
     708     404   0032D                  ; Gebruikt geen registers
     709     405   0032D                  ;
     710     406   0032D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     711     407   0032D                  
     712     408   0032D C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     713     409   0032F C0D0                           push   psw                  ;8*42ns=330ns
     714     410   00331 75E064                         mov    acc,#100             ;420ns
     715     411   00334 120305           delay1ms1:    lcall  delay10us            ;10us
     716     412   00337 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     717     413   0033A D0D0                           pop    psw                  ;8*42ns=330ns
     718     414   0033C D0E0                           pop    acc                  ;8*42ns=330ns
     719     415   0033E 22                             ret                         ;165ns
     720     416   0033F                  
     721     417   0033F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     722     418   0033F                  ;
     723     419   0033F                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     724     420   0033F                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     725     421   0033F                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     726     422   0033F                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     727     423   0033F                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     728     424   0033F                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     729     425   0033F                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     730     426   0033F                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     731     427   0033F                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     732     428   0033F                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     733     429   0033F                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     734     430   0033F                  ; systemen!!!!
     735     431   0033F                  ;
     736     432   0033F                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     737     433   0033F                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     738     434   0033F                  ;       aduclcd0.inc
     739     435   0033F                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     740     436   0033F                  ;       aduclcd1.inc
     741     437   0033F                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     742     438   0033F                  ;
     743     439   0033F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     744     440   0033F                  
     745     441   0033F                  e             bit    b.1                  ;enable
     746     442   0033F                  rs            bit    b.0                  ;register select
     747     443   0033F                  backlight     bit    b.6                  ;bit waar backlight op zit
     748     444   0033F                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     749     445   0033F                  
     750     446   0033F                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     751     447   0033F                  
     752     448   0033F                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     753     449   0033F                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     754     450   0033F                  
     755     451   0033F                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     756     452   0033F                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     757     453   0033F                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     758     454   0033F                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     759     455   0033F                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     760     456   0033F                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     761     457   0033F                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     762     458   0033F                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     763     459   0033F                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     764     460   0033F                  
     765     461   0033F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     766     462   0033F                  ;
     767     463   0033F                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     768     464   0033F                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     769     465   0033F                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     770     466   0033F                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     771     467   0033F                  ;
     772     468   0033F                  ; registergebruik: geen
     773     469   0033F                  ;
     774     470   0033F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     775     471   0033F                  
     776     472   0033F C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     777     473   00341 C0D0                           push   psw
     778     474   00343 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     779     475   00345 1201E1                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     780     476   00348 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     781     477   0034B                                                            ;buzzer en baklight worden nu op 1 gezet
     782     478   0034B 1204E3                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     783     479   0034E 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     784     480   00350 1204DC           initlcd1:     lcall  delay2ms
     785     481   00353 D5E0FA                         djnz   acc,initlcd1
     786     482   00356 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     787     483   00358 12049B                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     788     484   0035B 1204DC                         lcall  delay2ms      ;te krijgen.
     789     485   0035E 7430                           mov    a,#00110000b
     790     486   00360 12049B                         lcall  outhnibc
     791     487   00363 1204DC                         lcall  delay2ms
     792     488   00366 7430                           mov    a,#00110000b
     793     489   00368 12049B                         lcall  outhnibc
     794     490   0036B 1204DC                         lcall  delay2ms
     795     491   0036E 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     796     492   00370 12049B                         lcall  outhnibc      ;hoge nibble naar het controleregister
     797     493   00373 1204DC                         lcall  delay2ms      ;niet nodig volgens datasheet
     798     494   00376 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     799     495   00378 120485                         lcall  outc          ;naar display
     800     496   0037B 1204DC                         lcall  delay2ms      ;is iets te lang volgens datasheet
     801     497   0037E 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     802     498   00380 120485                         lcall  outc
     803     499   00383 1204DC                         lcall  delay2ms      ;ook deze delay is iets te lang
     804     500   00386 7401                           mov    a,#displayon  ;clear display and home cursor
     805     501   00388 120485                         lcall  outc
     806     502   0038B 1204DC                         lcall  delay2ms      ;deze wachttijd is bijna juist
     807     503   0038E 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     808     504   00390 120485                         lcall  outc
     809     505   00393 1204DC                         lcall  delay2ms      ;wachten weer veel te lang
     810     506   00396 D0F0                           pop    b             ;registers terug in orde zetten
     811     507   00398 D0D0                           pop    psw
     812     508   0039A D0E0                           pop    acc
     813     509   0039C 22                             ret                  ;einde van de initialisatie
     814     510   0039D                  
     815     511   0039D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     816     512   0039D                  ;
     817     513   0039D                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     818     514   0039D                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     819     515   0039D                  ;      00dh   =cursor in de home positie
     820     516   0039D                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     821     517   0039D                  ;      00ah   =cursor op tweede lijn plaatsen
     822     518   0039D                  ;      001h   =cursor on blink
     823     519   0039D                  ;      002h   =cursor on, no blink
     824     520   0039D                  ;      003h   =cursor off
     825     521   0039D                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     826     522   0039D                  ;
     827     523   0039D                  ; de routine gebruikt geen registers
     828     524   0039D                  ;
     829     525   0039D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     830     526   0039D                  
     831     527   0039D                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     832     528   0039D                  ; dan mag de data direct naar het dataregister van het scherm.
     833     529   0039D                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     834     530   0039D                  
     835     531   0039D                  lcdoutchar:
     836     532   0039D C0E0             outcharlcd:   push   acc           ;registers op stack
     837     533   0039F C0D0                           push   psw
     838     534   003A1 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     839     535   003A4 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     840     536   003A6 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     841     537   003A9 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     842     538   003AB                  
     843     539   003AB                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     844     540   003AB                  ; Het is dus een opdracht die we moeten uitvoeren.
     845     541   003AB                  
     846     542   003AB B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     847     543   003AE 7401                           mov    a,#cleardisp         ;scherm leegmaken
     848     544   003B0 120485                         lcall  outc                 ;naar controleregister
     849     545   003B3 803A                           sjmp   outcharlcde          ;afsluiten
     850     546   003B5                  
     851     547   003B5 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     852     548   003B8 740F                           mov    a,#cursoronb         ;cursoron met blink
     853     549   003BA 120485                         lcall  outc
     854     550   003BD 8030                           sjmp   outcharlcde
     855     551   003BF                  
     856     552   003BF B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     857     553   003C2 740E                           mov    a,#cursoronn         ;cursoron no blink
     858     554   003C4 120485                         lcall  outc
     859     555   003C7 8026                           sjmp   outcharlcde
     860     556   003C9                  
     861     557   003C9 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     862     558   003CC 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     863     559   003CE 120485                         lcall  outc
     864     560   003D1 801C                           sjmp   outcharlcde
     865     561   003D3                  
     866     562   003D3 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     867     563   003D6 7402                           mov    a,#cursathom         ;cursor in home positie
     868     564   003D8 120485                         lcall  outc
     869     565   003DB 8012                           sjmp   outcharlcde
     870     566   003DD                  
     871     567   003DD B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     872     568   003E0                                                            ;tweede lijn
     873     569   003E0 74C0                           mov    a,#0c0h
     874     570   003E2 120485                         lcall  outc
     875     571   003E5 8008                           sjmp   outcharlcde
     876     572   003E7                  
     877     573   003E7                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     878     574   003E7                  ; is. dit mag naar het data register.
     879     575   003E7                  
     880     576   003E7 12044B           outcharlcd8:  lcall  outd          ;klaar
     881     577   003EA 8003                           sjmp   outcharlcde   ;einde routine
     882     578   003EC                  
     883     579   003EC                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     884     580   003EC                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     885     581   003EC                  ; te schrijven.
     886     582   003EC                  
     887     583   003EC 120485           outcharlcd9:  lcall  outc          ;klaar
     888     584   003EF D0D0             outcharlcde:  pop    psw           ;registers herstellen
     889     585   003F1 D0E0                           pop    acc
     890     586   003F3 22                             ret
     891     587   003F4                  
     892     588   003F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     893     589   003F4                  ;
     894     590   003F4                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     895     591   003F4                  ; op het lcd scherm.
     896     592   003F4                  ;
     897     593   003F4                  ; de routine gebruikt geen registers
     898     594   003F4                  ;
     899     595   003F4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     900     596   003F4                  
     901     597   003F4                  lcdoutnib:
     902     598   003F4 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     903     599   003F6 C0D0                           push   psw
     904     600   003F8 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     905     601   003FA 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     906     602   003FC B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     907     603   003FF 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     908     604   00401 2407                           add    a,#007h       ;omvormen naar hoofdletter
     909     605   00403 12044B           outniblcde:   lcall  outd          ;naar het scherm
     910     606   00406 D0D0                           pop    psw
     911     607   00408 D0E0                           pop    acc
     912     608   0040A 22                             ret
     913     609   0040B                  
     914     610   0040B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     915     611   0040B                  ;
     916     612   0040B                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     917     613   0040B                  ;
     918     614   0040B                  ; de routine gebruikt geen registers
     919     615   0040B                  ;
     920     616   0040B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     921     617   0040B                  
     922     618   0040B                  lcdoutbyte:
     923     619   0040B C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     924     620   0040D C0D0                           push   psw
     925     621   0040F C4                             swap   a             ;bitjes omruilen
     926     622   00410 1203F4                         lcall  outniblcd
     927     623   00413 C4                             swap   a             ;nog eens
     928     624   00414 1203F4                         lcall  outniblcd
     929     625   00417 D0D0                           pop    psw
     930     626   00419 D0E0                           pop    acc
     931     627   0041B 22                             ret
     932     628   0041C                  
     933     629   0041C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     934     630   0041C                  ;
     935     631   0041C                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     936     632   0041C                  ;
     937     633   0041C                  ; de routine gebruikt geen registers
     938     634   0041C                  ;
     939     635   0041C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     940     636   0041C                  
     941     637   0041C                  lcddispdptr:
     942     638   0041C C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     943     639   0041E C0D0                           push   psw
     944     640   00420 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     945     641   00422 12040B                         lcall  outbytelcd
     946     642   00425 E582                           mov    a,dpl         ;dan het lage deel
     947     643   00427 12040B                         lcall  outbytelcd
     948     644   0042A D0D0                           pop    psw
     949     645   0042C D0E0                           pop    acc
     950     646   0042E 22                             ret
     951     647   0042F                  
     952     648   0042F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     953     649   0042F                  ;
     954     650   0042F                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     955     651   0042F                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     956     652   0042F                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     957     653   0042F                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     958     654   0042F                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     959     655   0042F                  ;
     960     656   0042F                  ; de routine gebruikt geen registers
     961     657   0042F                  ;
     962     658   0042F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     963     659   0042F                  
     964     660   0042F                  lcdoutmsga:
     965     661   0042F C0E0             outmsgalcd:   push   acc           ;registers op de stack
     966     662   00431 C0D0                           push   psw
     967     663   00433 C083                           push   dph           ;ook de data pointer
     968     664   00435 C082                           push   dpl
     969     665   00437                  
     970     666   00437                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     971     667   00437                  
     972     668   00437 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
     973     669   00438 93                             movc   a,@a+dptr     ;waarde lezen
     974     670   00439 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
     975     671   0043B                  
     976     672   0043B                  ; de code is niet 0 dus versturen met outchar
     977     673   0043B                  
     978     674   0043B 12039D                         lcall  outcharlcd    ;weg er mee
     979     675   0043E A3                             inc    dptr          ;naar volgende ascii code wijzen
     980     676   0043F 020437                         ljmp   outmsgalcd1   ;lus sluiten
     981     677   00442                  
     982     678   00442 D082             outmsgalcde:  pop    dpl           ;registers herstellen
     983     679   00444 D083                           pop    dph
     984     680   00446 D0D0                           pop    psw
     985     681   00448 D0E0                           pop    acc
     986     682   0044A 22                             ret
     987     683   0044B                  
     988     684   0044B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     989     685   0044B                  ;
     990     686   0044B                  ; outd is een routine die naar het data register van het display een
     991     687   0044B                  ; volledige byte stuurt.
     992     688   0044B                  ;
     993     689   0044B                  ; De routine gebruikt geen registers.
     994     690   0044B                  ;
     995     691   0044B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     996     692   0044B                  
     997     693   0044B C0E0             outd:         push   acc           ;registers op stack zetten
     998     694   0044D C0D0                           push   psw
     999     695   0044F 12045B                         lcall  outhnibd      ;hoogste vier bits verzenden
    1000     696   00452 C4                             swap   a             ;bitjes omruilen
    1001     697   00453 12045B                         lcall  outhnibd      ;naar het scherm sturen
    1002     698   00456 D0D0                           pop    psw           ;registers terug herstellen
    1003     699   00458 D0E0                           pop    acc
    1004     700   0045A 22                             ret
    1005     701   0045B                  
    1006     702   0045B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1007     703   0045B                  ;
    1008     704   0045B                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
    1009     705   0045B                  ; lcd scherm.
    1010     706   0045B                  ;
    1011     707   0045B                  ; de routine gebruikt geen registers.
    1012     708   0045B                  ;
    1013     709   0045B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1014     710   0045B                  
    1015     711   0045B C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
    1016     712   0045D C0D0                           push   psw
    1017     713   0045F C0F0                           push   b             ;werkregister
    1018     714   00461 1204FC                         lcall  lcdtoport     ;lees de expander naar b register
    1019     715   00464 D2F0                           setb   rs            ;controle lijn in orde
    1020     716   00466 C2F1                           clr    e             ;deselectie display
    1021     717   00468 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1022     718   0046A 03                             rr     a             ;bits op juiste plaats zetten
    1023     719   0046B 03                             rr     a             ;voor b reg
    1024     720   0046C 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1025     721   0046F 42F0                           orl    b,a           ;bij elkaar voegen
    1026     722   00471 1204E3                         lcall  porttolcd     ;naar expnder
    1027     723   00474 D2F1                           setb   e             ;display enabelen
    1028     724   00476 1204E3                         lcall  porttolcd
    1029     725   00479 C2F1                           clr    e             ;display deselecteren
    1030     726   0047B 1204E3                         lcall  porttolcd
    1031     727   0047E D0F0                           pop    b
    1032     728   00480 D0D0                           pop    psw           ;registers herstellen
    1033     729   00482 D0E0                           pop    acc
    1034     730   00484 22                             ret
    1035     731   00485                  
    1036     732   00485                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1037     733   00485                  ;
    1038     734   00485                  ; outc is een routine die naar het controleregister van het display een
    1039     735   00485                  ; volledige byte stuurt.
    1040     736   00485                  ;
    1041     737   00485                  ; De routine gebruikt geen registers.
    1042     738   00485                  ;
    1043     739   00485                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1044     740   00485                  
    1045     741   00485 C0E0             outc:         push   acc           ;registers op stack zetten
    1046     742   00487 C0D0                           push   psw
    1047     743   00489 12049B                         lcall  outhnibc      ;hoogste vier bits verzenden
    1048     744   0048C 1204DC                         lcall  delay2ms      ;niet echt nodig
    1049     745   0048F C4                             swap   a             ;bitjes omruilen
    1050     746   00490 12049B                         lcall  outhnibc      ;naar het scherm sturen
    1051     747   00493 1204DC                         lcall  delay2ms      ;altijd goed voor traagste commando
    1052     748   00496 D0D0                           pop    psw           ;registers terug herstellen
    1053     749   00498 D0E0                           pop    acc
    1054     750   0049A 22                             ret
    1055     751   0049B                  
    1056     752   0049B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1057     753   0049B                  ;
    1058     754   0049B                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1059     755   0049B                  ; lcd scherm.
    1060     756   0049B                  ;
    1061     757   0049B                  ; de routine gebruikt geen registers.
    1062     758   0049B                  ;
    1063     759   0049B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1064     760   0049B                  
    1065     761   0049B C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1066     762   0049D C0D0                           push   psw
    1067     763   0049F C0F0                           push   b             ;werkregister
    1068     764   004A1 1204FC                         lcall  lcdtoport     ;lees de expander naar b register
    1069     765   004A4 C2F0                           clr    rs            ;controle lijn in orde
    1070     766   004A6 C2F1                           clr    e             ;deselectie display
    1071     767   004A8 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1072     768   004AA 03                             rr     a             ;bits op juiste plaats zetten
    1073     769   004AB 03                             rr     a             ;voor b reg
    1074     770   004AC 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1075     771   004AF 42F0                           orl    b,a           ;bij elkaar voegen
    1076     772   004B1 1204E3                         lcall  porttolcd     ;naar expnder
    1077     773   004B4 D2F1                           setb   e             ;display enabelen
    1078     774   004B6 1204E3                         lcall  porttolcd
    1079     775   004B9 C2F1                           clr    e             ;display deselecteren
    1080     776   004BB 1204E3                         lcall  porttolcd
    1081     777   004BE D0F0                           pop    b
    1082     778   004C0 D0D0                           pop    psw           ;registers herstellen
    1083     779   004C2 D0E0                           pop    acc
    1084     780   004C4 22                             ret
    1085     781   004C5                  
    1086     782   004C5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1087     783   004C5                  ;
    1088     784   004C5                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1089     785   004C5                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1090     786   004C5                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1091     787   004C5                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1092     788   004C5                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1093     789   004C5                  ; DATA GESCHREVEN.
    1094     790   004C5                  ;
    1095     791   004C5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1096     792   004C5                  
    1097     793   004C5 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1098     794   004C7 120485           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1099     795   004CA 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1100     796   004CC 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1101     797   004CD 12044B                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1102     798   004D0 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1103     799   004D3 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1104     800   004D4 80F4                           SJMP   BUILD3
    1105     801   004D6 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1106     802   004D8 120485                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1107     803   004DB 22                             RET                  ;EINDE VAN DE ROUTINE
    1108     804   004DC                  
    1109     805   004DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1110     806   004DC                  ;
    1111     807   004DC                  ; Delay2ms is een vertragingsroutine van 2ms.
    1112     808   004DC                  ;
    1113     809   004DC                  ; De routine gebruikt geen registers.
    1114     810   004DC                  ;
    1115     811   004DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1116     812   004DC                  
    1117     813   004DC 12032D           delay2ms:     lcall  delay1ms
    1118     814   004DF 12032D                         lcall  delay1ms
    1119     815   004E2 22                             ret
    1120     816   004E3                  
    1121     817   004E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1122     818   004E3                  ;
    1123     819   004E3                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1124     820   004E3                  ; scherm stuurt via de port expander.
    1125     821   004E3                  ;
    1126     822   004E3                  ; Gebruikt geen registers
    1127     823   004E3                  ;
    1128     824   004E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1129     825   004E3                  
    1130     826   004E3 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1131     827   004E5 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1132     828   004E7 120204                         lcall  iicstart      ;vertrokken
    1133     829   004EA 7440                           mov    a,#01000000b  ;schrijven naar expander
    1134     830   004EC 12024B                         lcall  iicoutbyte    ;weg er mee
    1135     831   004EF E5F0                           mov    a,b           ;data verzenden
    1136     832   004F1 12024B                         lcall  iicoutbyte
    1137     833   004F4 120227                         lcall  iicstop       ;transactie sluiten
    1138     834   004F7 D0D0                           pop    psw
    1139     835   004F9 D0E0                           pop    acc
    1140     836   004FB 22                             ret
    1141     837   004FC                  
    1142     838   004FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1143     839   004FC                  ;
    1144     840   004FC                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1145     841   004FC                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1146     842   004FC                  ; van buzzet en backlight is.
    1147     843   004FC                  ;
    1148     844   004FC                  ; Gebruikt b register
    1149     845   004FC                  ;
    1150     846   004FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1151     847   004FC                  
    1152     848   004FC C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1153     849   004FE C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1154     850   00500 120204                         lcall  iicstart      ;vertrokken
    1155     851   00503 7441                           mov    a,#01000001b  ;lezen van expander
    1156     852   00505 12024B                         lcall  iicoutbyte    ;weg er mee
    1157     853   00508 1202C6                         lcall  iicinbytenack ;data inlezen
    1158     854   0050B 120227                         lcall  iicstop
    1159     855   0050E F5F0                           mov    b,a
    1160     856   00510 D0D0                           pop    psw
    1161     857   00512 D0E0                           pop    acc
    1162     858   00514 22                             ret
    1163     859   00515                  
    1164     860   00515                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1165     861   00515                  ;
    1166     862   00515                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1167     863   00515                  ;
    1168     864   00515                  ; Gebruikt geen registers
    1169     865   00515                  ;
    1170     866   00515                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1171     867   00515                  
    1172     868   00515 C0F0             lcdlighton:   push   b
    1173     869   00517 1204FC                         lcall  lcdtoport     ;expander lezen
    1174     870   0051A C2F6                           clr    b.6           ;licht aan doen
    1175     871   0051C 1204E3                         lcall  porttolcd     ;expander scrijven
    1176     872   0051F D0F0                           pop    b
    1177     873   00521 22                             ret
    1178     874   00522                  
    1179     875   00522                  
    1180     876   00522                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1181     877   00522                  ;
    1182     878   00522                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1183     879   00522                  ;
    1184     880   00522                  ; Gebruikt geen registers
    1185     881   00522                  ;
    1186     882   00522                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1187     883   00522                  
    1188     884   00522 C0F0             lcdlightoff:  push   b
    1189     885   00524 1204FC                         lcall  lcdtoport     ;expander lezen
    1190     886   00527 D2F6                           setb   b.6           ;licht uit doen
    1191     887   00529 1204E3                         lcall  porttolcd     ;expander scrijven
    1192     888   0052C D0F0                           pop    b
    1193     889   0052E 22                             ret
    1194     890   0052F                  
    1195     891   0052F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1196     892   0052F                  ;
    1197     893   0052F                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1198     894   0052F                  ;
    1199     895   0052F                  ; Gebruikt geen registers
    1200     896   0052F                  ;
    1201     897   0052F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1202     898   0052F                  
    1203     899   0052F C0F0             lcdbuzon:     push   b
    1204     900   00531 1204FC                         lcall  lcdtoport     ;expander lezen
    1205     901   00534 C2F7                           clr    b.7           ;buzzer aan doen
    1206     902   00536 1204E3                         lcall  porttolcd     ;expander scrijven
    1207     903   00539 D0F0                           pop    b
    1208     904   0053B 22                             ret
    1209     905   0053C                  
    1210     906   0053C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1211     907   0053C                  ;
    1212     908   0053C                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1213     909   0053C                  ;
    1214     910   0053C                  ; Gebruikt geen registers
    1215     911   0053C                  ;
    1216     912   0053C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1217     913   0053C                  
    1218     914   0053C C0F0             lcdbuzoff:    push   b
    1219     915   0053E 1204FC                         lcall  lcdtoport     ;expander lezen
    1220     916   00541 D2F7                           setb   b.7           ;buzzer aan doen
    1221     917   00543 1204E3                         lcall  porttolcd     ;expander scrijven
    1222     918   00546 D0F0                           pop    b
    1223     919   00548 22                             ret
    1224     920   00549                  
    1225     921   00549                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1226     922   00549                  ;
    1227     923   00549                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1228     924   00549                  ; een standaard com poort op 9600 baud.
    1229     925   00549                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1230     926   00549                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1231     927   00549                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1232     928   00549                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1233     929   00549                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1234     930   00549                  ; NIET door deze routine.
    1235     931   00549                  ;
    1236     932   00549                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1237     933   00549                  ;
    1238     934   00549                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1239     935   00549                  
    1240     936   00549                  blank         equ    020h          ;ascii code voor een blank
    1241     937   00549                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1242     938   00549                  ff            equ    00ch          ;ascii code voor nieuw blad
    1243     939   00549                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1244     940   00549                  lf            equ    00ah          ;ascii code voor volgende lijn
    1245     941   00549                  backsp        equ    008h          ;ascii code voor het bs karakter
    1246     942   00549                  beep          equ    007h          ;ascii code voor een beep
    1247     943   00549                  
    1248     944   00549 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1249     945   0054D                                                                          ;van het scherm
    1250     946   0054D                  
    1251     947   0054D                  strtbuf       equ     054h         ;start adres van de buffer
    1252     948   0054D                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1253     949   0054D                  
    1254     950   0054D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1255     951   0054D                  ;
    1256     952   0054D                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1257     953   0054D                  ;
    1258     954   0054D                  ; Gebruikt geen registers
    1259     955   0054D                  ;
    1260     956   0054D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1261     957   0054D                  
    1262     958   0054D C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1263     959   0054F C08F                           push   syscon0              ;map bewaren
    1264     960   00551 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1265     961   00554 C0B2                           push   port_page            ;pagina op stack zetten
    1266     962   00556 C0BF                           push   scu_page
    1267     963   00558 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1268     964   0055B                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1269     965   0055B                  ;      -p1.0 als input en alt1 selectie
    1270     966   0055B                  ;      -p1.1 als output en alt2 selectie
    1271     967   0055B                  
    1272     968   0055B 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1273     969   0055E 5390FD                         anl    p1_altsel0,#11111101b
    1274     970   00561 439001                         orl    p1_altsel0,#00000001b
    1275     971   00564 5391FE                         anl    p1_altsel1,#11111110b
    1276     972   00567 439102                         orl    p1_altsel1,#00000010b
    1277     973   0056A 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1278     974   0056D 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1279     975   00570 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1280     976   00573                  
    1281     977   00573                  ; Nu moet de baud rate generator ingesteld worden
    1282     978   00573                  ; We gaan er van uit dat de systeemklok 24MHz is
    1283     979   00573                  
    1284     980   00573 759850                         mov    scon,#01010000b      ;UART initialiseren
    1285     981   00576                  
    1286     982   00576                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1287     983   00576                  ; gebruikt!!
    1288     984   00576                  
    1289     985   00576 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1290     986   00579 75BD11                         mov    bcon,#00010001b
    1291     987   0057C D0BF                           pop    scu_page
    1292     988   0057E D0B2                           pop    port_page            ;alles terug herstellen
    1293     989   00580 D08F                           pop    syscon0
    1294     990   00582 D0E0                           pop    acc
    1295     991   00584 22                             ret
    1296     992   00585                  
    1297     993   00585                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1298     994   00585                  ;
    1299     995   00585                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1300     996   00585                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1301     997   00585                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1302     998   00585                  ;
    1303     999   00585                  ; de routine gebruikt geen registers.
    1304    1000   00585                  ;
    1305    1001   00585                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1306    1002   00585                  
    1307    1003   00585                  siooutchar:
    1308    1004   00585 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1309    1005   00587 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1310    1006   0058A C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1311    1007   0058C 22                             RET
    1312    1008   0058D                  
    1313    1009   0058D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1314    1010   0058D                  ;
    1315    1011   0058D                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1316    1012   0058D                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1317    1013   0058D                  ;
    1318    1014   0058D                  ; de routine gebruikt geen registers.
    1319    1015   0058D                  ;
    1320    1016   0058D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1321    1017   0058D                  
    1322    1018   0058D                  siooutnib:
    1323    1019   0058D C0E0             OUTNIB:       push   acc           ;registers op de stack
    1324    1020   0058F C0D0                           push   psw
    1325    1021   00591 540F                           ANL    A,#00FH       ;AFZONDEREN
    1326    1022   00593 12067D                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1327    1023   00596 120585                         LCALL  OUTCHAR       ;VERSTUREN
    1328    1024   00599 1205E6                         LCALL  XONXOFF       ;FLOW CONTROL
    1329    1025   0059C D0D0                           pop    psw           ;registers herstellen
    1330    1026   0059E D0E0                           pop    acc
    1331    1027   005A0 22                             RET
    1332    1028   005A1                  
    1333    1029   005A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1334    1030   005A1                  ;
    1335    1031   005A1                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1336    1032   005A1                  ; WORDT XONXOFF GEBRUIKT.
    1337    1033   005A1                  ;
    1338    1034   005A1                  ; de routine gebruikt geen registers.
    1339    1035   005A1                  ;
    1340    1036   005A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1341    1037   005A1                  
    1342    1038   005A1                  siooutbyte:
    1343    1039   005A1 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1344    1040   005A3 C0D0                           push   psw
    1345    1041   005A5 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1346    1042   005A7 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1347    1043   005A8 12058D                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1348    1044   005AB D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1349    1045   005AD 12058D                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1350    1046   005B0 D0D0                           pop    psw           ;registers herstellen
    1351    1047   005B2 D0E0                           pop    acc
    1352    1048   005B4 22                             RET
    1353    1049   005B5                  
    1354    1050   005B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1355    1051   005B5                  ;
    1356    1052   005B5                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1357    1053   005B5                  ; VAN DE CURSOR.
    1358    1054   005B5                  ;
    1359    1055   005B5                  ; de routine gebruikt geen registers.
    1360    1056   005B5                  ;
    1361    1057   005B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1362    1058   005B5                  
    1363    1059   005B5                  siodispdptr:
    1364    1060   005B5 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1365    1061   005B7 C0D0                           push   psw
    1366    1062   005B9 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1367    1063   005BB 1205A1                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1368    1064   005BE E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1369    1065   005C0 1205A1                         LCALL  OUTBYTE       ;WEG ER MEE
    1370    1066   005C3 D0D0                           pop    psw           ;registers herstellen
    1371    1067   005C5 D0E0                           pop    acc
    1372    1068   005C7 22                             RET                  ;EINDE
    1373    1069   005C8                  
    1374    1070   005C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1375    1071   005C8                  ;
    1376    1072   005C8                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1377    1073   005C8                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1378    1074   005C8                  ;
    1379    1075   005C8                  ; de routine gebruikt geen registers.
    1380    1076   005C8                  ;
    1381    1077   005C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1382    1078   005C8                  
    1383    1079   005C8                  siooutmsga:
    1384    1080   005C8 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1385    1081   005CA C0D0                           push   psw
    1386    1082   005CC C082                           push   dpl
    1387    1083   005CE C083                           push   dph
    1388    1084   005D0 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1389    1085   005D1 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1390    1086   005D2 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1391    1087   005D4 120585                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1392    1088   005D7 1205E6                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1393    1089   005DA A3                             INC    DPTR          ;DPTR AANPASSEN
    1394    1090   005DB 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1395    1091   005DD D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1396    1092   005DF D082                           pop    dpl
    1397    1093   005E1 D0D0                           pop    psw
    1398    1094   005E3 D0E0                           pop    acc
    1399    1095   005E5 22                             RET                  ;EINDE ROUTINE
    1400    1096   005E6                  
    1401    1097   005E6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1402    1098   005E6                  ;
    1403    1099   005E6                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1404    1100   005E6                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1405    1101   005E6                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1406    1102   005E6                  ; VERDER DOORGEGEVEN.
    1407    1103   005E6                  ;
    1408    1104   005E6                  ; de routine gebruikt geen registers.
    1409    1105   005E6                  ;
    1410    1106   005E6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1411    1107   005E6                  
    1412    1108   005E6 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1413    1109   005E8 C0D0                           push   psw
    1414    1110   005EA 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1415    1111   005ED D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1416    1112   005EF D0E0                           pop    acc
    1417    1113   005F1 22                             RET                  ;ANDERS EINDE
    1418    1114   005F2 E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1419    1115   005F4 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1420    1116   005F7 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1421    1117   005FA 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1422    1118   005FC                  
    1423    1119   005FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1424    1120   005FC                  ;
    1425    1121   005FC                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1426    1122   005FC                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1427    1123   005FC                  ;
    1428    1124   005FC                  ; de routine gebruikt de accu.
    1429    1125   005FC                  ;
    1430    1126   005FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1431    1127   005FC                  
    1432    1128   005FC                  sioinchar:
    1433    1129   005FC 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1434    1130   005FF C298                           CLR    RI                   ;BIT LAAG MAKEN
    1435    1131   00601 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1436    1132   00603 22                             RET
    1437    1133   00604                  
    1438    1134   00604                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1439    1135   00604                  ;
    1440    1136   00604                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1441    1137   00604                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1442    1138   00604                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1443    1139   00604                  ; DE CARRY OP 1 GEZET WORDEN.
    1444    1140   00604                  ;
    1445    1141   00604                  ; De routine gebruikt de accu, r0 en de psw.
    1446    1142   00604                  ;
    1447    1143   00604                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1448    1144   00604                  
    1449    1145   00604                  sioinbyte:
    1450    1146   00604 1205FC           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1451    1147   00607 120670                         LCALL  LOWUPTR
    1452    1148   0060A 120687                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1453    1149   0060D 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1454    1150   0060F C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1455    1151   00610 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1456    1152   00611 1205FC                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1457    1153   00614 120670                         LCALL  LOWUPTR
    1458    1154   00617 120687                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1459    1155   0061A 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1460    1156   0061C 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1461    1157   0061D 22               INBYTE1:      RET
    1462    1158   0061E                  
    1463    1159   0061E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1464    1160   0061E                  ;
    1465    1161   0061E                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1466    1162   0061E                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1467    1163   0061E                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1468    1164   0061E                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1469    1165   0061E                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1470    1166   0061E                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1471    1167   0061E                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1472    1168   0061E                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1473    1169   0061E                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1474    1170   0061E                  ; bepalen.
    1475    1171   0061E                  ;
    1476    1172   0061E                  ; De routine gebruikt de accu, r0 en de psw.
    1477    1173   0061E                  ;
    1478    1174   0061E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1479    1175   0061E                  
    1480    1176   0061E                  sioinbufa:
    1481    1177   0061E 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1482    1178   00620 1205FC           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1483    1179   00623 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1484    1180   00625                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1485    1181   00625                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1486    1182   00625                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1487    1183   00625                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1488    1184   00625                  ; GEVOERD.
    1489    1185   00625 120670                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1490    1186   00628 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1491    1187   0062B F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1492    1188   0062C 22                             RET                         ;EINDE VAN DE ROUTINE
    1493    1189   0062D B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1494    1190   00630 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1495    1191   00633 7407             INBUFA4:      MOV    A,#BEEP
    1496    1192   00635 120585           INBUFA7:      LCALL  OUTCHAR
    1497    1193   00638 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1498    1194   0063A 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1499    1195   0063B 900549                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1500    1196   0063E 1205C8                         LCALL  OUTMSGA
    1501    1197   00641 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1502    1198   00643 120662           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1503    1199   00646 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1504    1200   00648 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1505    1201   0064B 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1506    1202   0064D F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1507    1203   0064E 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1508    1204   0064F 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1509    1205   00651                  
    1510    1206   00651                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1511    1207   00651                  ;
    1512    1208   00651                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1513    1209   00651                  ;
    1514    1210   00651                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1515    1211   00651                  ;
    1516    1212   00651                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1517    1213   00651                  
    1518    1214   00651 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1519    1215   00653 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1520    1216   00655 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1521    1217   00656 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1522    1218   00659 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1523    1219   0065A B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1524    1220   0065D 22                             RET                         ;EINDE VAN DE ROUTINE
    1525    1221   0065E F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1526    1222   0065F 09                             INC    R1
    1527    1223   00660 80F7                           SJMP   BDELETE3
    1528    1224   00662                  
    1529    1225   00662                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1530    1226   00662                  ;
    1531    1227   00662                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1532    1228   00662                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1533    1229   00662                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1534    1230   00662                  ; AANZIEN.
    1535    1231   00662                  ;
    1536    1232   00662                  ; De routine gebruikt de accu en de psw.
    1537    1233   00662                  ;
    1538    1234   00662                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1539    1235   00662                  
    1540    1236   00662 B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1541    1237   00665 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1542    1238   00667 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1543    1239   0066A 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1544    1240   0066C C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1545    1241   0066D 22                             RET
    1546    1242   0066E D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1547    1243   0066F 22                             RET
    1548    1244   00670                  
    1549    1245   00670                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1550    1246   00670                  ;
    1551    1247   00670                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1552    1248   00670                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1553    1249   00670                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1554    1250   00670                  ; AANGEPAST WORDEN.
    1555    1251   00670                  ;
    1556    1252   00670                  ; De routine gebruikt de accu en de psw.
    1557    1253   00670                  ;
    1558    1254   00670                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1559    1255   00670                  
    1560    1256   00670 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1561    1257   00673 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1562    1258   00675 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1563    1259   00678 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1564    1260   0067A 9420                           SUBB   A,#020H              ;OMZETTING
    1565    1261   0067C 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1566    1262   0067D                  
    1567    1263   0067D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1568    1264   0067D                  ;
    1569    1265   0067D                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1570    1266   0067D                  ; ASCII CODE.
    1571    1267   0067D                  ;
    1572    1268   0067D                  ; De routine gebruikt de accu en de psw.
    1573    1269   0067D                  ;
    1574    1270   0067D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1575    1271   0067D                  
    1576    1272   0067D B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1577    1273   00680 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1578    1274   00682 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1579    1275   00684 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1580    1276   00686 22                             RET
    1581    1277   00687                  
    1582    1278   00687                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1583    1279   00687                  ;
    1584    1280   00687                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1585    1281   00687                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1586    1282   00687                  ; GEVAL WORDT DE CARRY GEZET.
    1587    1283   00687                  ;
    1588    1284   00687                  ; De routine gebruikt de accu en de psw.
    1589    1285   00687                  ;
    1590    1286   00687                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1591    1287   00687                  
    1592    1288   00687 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1593    1289   00688 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1594    1290   0068A 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1595    1291   0068C B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1596    1292   0068F 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1597    1293   00691 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1598    1294   00693 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1599    1295   00695 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1600    1296   00698 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1601    1297   00699 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1602    1298   0069B C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1603    1299   0069C 22               ASCBINTRANS1: RET
    1604    1300   0069D                  
    1605    1301   0069D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1606    1302   0069D                  ;
    1607    1303   0069D                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1608    1304   0069D                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1609    1305   0069D                  ;
    1610    1306   0069D                  ; De routine gebruikt de accu en de psw.
    1611    1307   0069D                  ;
    1612    1308   0069D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1613    1309   0069D                  
    1614    1310   0069D E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1615    1311   0069E 120687                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1616    1312   006A1 22                             RET                         ;EINDE OMZETTING
    1617    1313   006A2                  
    1618    1314   006A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1619    1315   006A2                  ;
    1620    1316   006A2                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1621    1317   006A2                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1622    1318   006A2                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1623    1319   006A2                  ;
    1624    1320   006A2                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1625    1321   006A2                  ;
    1626    1322   006A2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1627    1323   006A2                  
    1628    1324   006A2 12069D           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1629    1325   006A5 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1630    1326   006A7 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1631    1327   006A8 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1632    1328   006A9 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1633    1329   006AA 12069D                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1634    1330   006AD 4001                           JC     ASCII21               ;WEG ALS C=1
    1635    1331   006AF 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1636    1332   006B0 22               ASCII21:      RET
    1637    1333   006B1                  
    1638    1334   006B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1639    1335   006B1                  ;
    1640    1336   006B1                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1641    1337   006B1                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1642    1338   006B1                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1643    1339   006B1                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1644    1340   006B1                  ;
    1645    1341   006B1                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1646    1342   006B1                  ;
    1647    1343   006B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1648    1344   006B1                  
    1649    1345   006B1 1206A2           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1650    1346   006B4 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1651    1347   006B6 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1652    1348   006B8 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1653    1349   006B9 1206A2                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1654    1350   006BC 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1655    1351   006BE F582                           MOV    DPL,A                ;IN DPTR LADEN
    1656    1352   006C0 22               ASCII41:      RET
    1657    1353   006C1                  
    1658    1354   006C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1659    1355   006C1                  ;
    1660    1356   006C1                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1661    1357   006C1                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1662    1358   006C1                  ; geschakeld worden.
    1663    1359   006C1                  ;
    1664    1360   006C1                  ; Gebruikt geen registers
    1665    1361   006C1                  ;
    1666    1362   006C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1667    1363   006C1                  
    1668    1364   006C1 C08F             initadc:      push   syscon0                     ;map saven
    1669    1365   006C3 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1670    1366   006C6 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1671    1367   006C9 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1672    1368   006CC                                                                   ;klok delen door 32 (750kHz)
    1673    1369   006CC                                                                   ;10 bit uitkomst
    1674    1370   006CC 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1675    1371   006CF                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1676    1372   006CF 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1677    1373   006D2 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1678    1374   006D5 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1679    1375   006D8 D08F                           pop    syscon0                     ;herstellen syscon
    1680    1376   006DA 22                             ret
    1681    1377   006DB                  
    1682    1378   006DB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1683    1379   006DB                  ;
    1684    1380   006DB                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1685    1381   006DB                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1686    1382   006DB                  ;
    1687    1383   006DB                  ; Gebruikt:
    1688    1384   006DB                  ;      -accu als 8 msb meting
    1689    1385   006DB                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1690    1386   006DB                  ;
    1691    1387   006DB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1692    1388   006DB                  
    1693    1389   006DB C08F             adclm335:     push   syscon0
    1694    1390   006DD 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1695    1391   006E0 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1696    1392   006E3 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1697    1393   006E6 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1698    1394   006E9 00               		nop
    1699    1395   006EA 00               		nop					;anders loopt het mis met het testen van de ready bit
    1700    1396   006EB E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1701    1397   006ED 20E0FB                         jb     acc.0,adclm3351
    1702    1398   006F0 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1703    1399   006F3 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1704    1400   006F5 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1705    1401   006F8 D08F                           pop    syscon0
    1706    1402   006FA 22                             ret
    1707    1403   006FB                  
    1708    1404   006FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1709    1405   006FB                  ;
    1710    1406   006FB                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1711    1407   006FB                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1712    1408   006FB                  ;
    1713    1409   006FB                  ; Gebruikt:
    1714    1410   006FB                  ;      -accu als 8 msb meting
    1715    1411   006FB                  ;      -b als 2 lsb meting (links afgelijnd)
    1716    1412   006FB                  ;
    1717    1413   006FB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1718    1414   006FB                  
    1719    1415   006FB C08F             adcpotmeter:  push   syscon0
    1720    1416   006FD 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1721    1417   00700 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1722    1418   00703 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1723    1419   00706 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1724    1420   00709 00               		nop
    1725    1421   0070A 00               		nop					;anders loopt het mis met het testen van de ready bit
    1726    1422   0070B E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1727    1423   0070D 20E0FB                         jb     acc.0,adcpotmeter1
    1728    1424   00710 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1729    1425   00713 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1730    1426   00715 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1731    1427   00718 D08F                           pop    syscon0
    1732    1428   0071A                  
    1733    1429   0071A                  
    1734    1430   0071A 22                             ret
    1735    1431   0071B                  
    1736    1432   0071B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1737    1433   0071B                  ;
    1738    1434   0071B                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1739    1435   0071B                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1740    1436   0071B                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1741    1437   0071B                  ; doelstellingen in het achterhoofd.
    1742    1438   0071B                  ;
    1743    1439   0071B                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1744    1440   0071B                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1745    1441   0071B                  ; bcd)
    1746    1442   0071B                  ;      8bit hex naar bcd
    1747    1443   0071B                  ;      8bit bcd naar hex
    1748    1444   0071B                  ;
    1749    1445   0071B                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1750    1446   0071B                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1751    1447   0071B                  ;      16*16 bit met 32 bit uitkomst
    1752    1448   0071B                  ;      16+16 bit met 24 bit uitkomst
    1753    1449   0071B                  ;      16-16 bit met 24 bit uitkomst
    1754    1450   0071B                  ;      16bit hex naar bcd
    1755    1451   0071B                  ;      16bit bcd naar hex
    1756    1452   0071B                  ;
    1757    1453   0071B                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1758    1454   0071B                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1759    1455   0071B                  ;      32*32 bit met 64 bit uitkomst
    1760    1456   0071B                  ;      32+32 bit met 40 bit uitkomst
    1761    1457   0071B                  ;      32-32 bit met 40 bit uitkomst
    1762    1458   0071B                  ;
    1763    1459   0071B                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1764    1460   0071B                  ;
    1765    1461   0071B                  ; De routines gebruiken als input en output de huidige registerbank.
    1766    1462   0071B                  ;
    1767    1463   0071B                  ;
    1768    1464   0071B                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1769    1465   0071B                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1770    1466   0071B                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1771    1467   0071B                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1772    1468   0071B                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1773    1469   0071B                  ;
    1774    1470   0071B                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1775    1471   0071B                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1776    1472   0071B                  ;      -routines gebruiken geen MDU!
    1777    1473   0071B                  ;
    1778    1474   0071B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1779    1475   0071B                  
    1780    1476   0071B                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1781    1477   0071B                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1782    1478   0071B                  
    1783    1479   0071B                  h0            equ    070h
    1784    1480   0071B                  h1            equ    071h
    1785    1481   0071B                  h2            equ    072h
    1786    1482   0071B                  h3            equ    073h
    1787    1483   0071B                  h4            equ    074h
    1788    1484   0071B                  h5            equ    075h
    1789    1485   0071B                  h6            equ    076h
    1790    1486   0071B                  h7            equ    077h
    1791    1487   0071B                  h8            equ    078h
    1792    1488   0071B                  h9            equ    079h
    1793    1489   0071B                  h10           equ    07ah
    1794    1490   0071B                  h11           equ    07bh
    1795    1491   0071B                  h12           equ    07ch
    1796    1492   0071B                  
    1797    1493   0071B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1798    1494   0071B                  ;
    1799    1495   0071B                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1800    1496   0071B                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1801    1497   0071B                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1802    1498   0071B                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1803    1499   0071B                  ;
    1804    1500   0071B                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1805    1501   0071B                  ;
    1806    1502   0071B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1807    1503   0071B                  
    1808    1504   0071B C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1809    1505   0071D C0D0                           push   psw
    1810    1506   0071F C070                           push   h0
    1811    1507   00721 C071                           push   h1
    1812    1508   00723 C072                           push   h2
    1813    1509   00725 C073                           push   h3
    1814    1510   00727 C074                           push   h4
    1815    1511   00729 C075                           push   h5
    1816    1512   0072B C076                           push   h6
    1817    1513   0072D C077                           push   h7
    1818    1514   0072F C078                           push   h8
    1819    1515   00731 C079                           push   h9
    1820    1516   00733 C07A                           push   h10
    1821    1517   00735 C07B                           push   h11
    1822    1518   00737 C07C                           push   h12
    1823    1519   00739                  
    1824    1520   00739                  ; eerst moeten de hulpregisters klaar gezet worden
    1825    1521   00739                  
    1826    1522   00739 757000                         mov    h0,#000h
    1827    1523   0073C 757100                         mov    h1,#000h
    1828    1524   0073F 757200                         mov    h2,#000h
    1829    1525   00742 757300                         mov    h3,#000h
    1830    1526   00745 757400                         mov    h4,#000h
    1831    1527   00748 757500                         mov    h5,#000h
    1832    1528   0074B 757600                         mov    h6,#000h
    1833    1529   0074E 757700                         mov    h7,#000h
    1834    1530   00751 757800                         mov    h8,#000h
    1835    1531   00754 757900                         mov    h9,#000h
    1836    1532   00757 757A00                         mov    h10,#000h
    1837    1533   0075A 757B00                         mov    h11,#000h
    1838    1534   0075D 757C20                         mov    h12,#32              ;loopcounter
    1839    1535   00760                  
    1840    1536   00760                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1841    1537   00760                  
    1842    1538   00760                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1843    1539   00760                  
    1844    1540   00760 EB               mul321:       mov    a,r3
    1845    1541   00761 13                             rrc    a
    1846    1542   00762 FB                             mov    r3,a
    1847    1543   00763 EA                             mov    a,r2
    1848    1544   00764 13                             rrc    a
    1849    1545   00765 FA                             mov    r2,a
    1850    1546   00766 E9                             mov    a,r1
    1851    1547   00767 13                             rrc    a
    1852    1548   00768 F9                             mov    r1,a
    1853    1549   00769 E8                             mov    a,r0
    1854    1550   0076A 13                             rrc    a
    1855    1551   0076B F8                             mov    r0,a                 ;32 bit shift klaar
    1856    1552   0076C                  
    1857    1553   0076C                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1858    1554   0076C                  
    1859    1555   0076C 502C                           jnc    mul322               ;optelling niet nodig
    1860    1556   0076E                  
    1861    1557   0076E                  ; hier staat en 64 bit optelling
    1862    1558   0076E                  
    1863    1559   0076E EC                             mov    a,r4
    1864    1560   0076F 2574                           add    a,h4
    1865    1561   00771 F574                           mov    h4,a
    1866    1562   00773 ED                             mov    a,r5
    1867    1563   00774 3575                           addc   a,h5
    1868    1564   00776 F575                           mov    h5,a
    1869    1565   00778 EE                             mov    a,r6
    1870    1566   00779 3576                           addc   a,h6
    1871    1567   0077B F576                           mov    h6,a
    1872    1568   0077D EF                             mov    a,r7
    1873    1569   0077E 3577                           addc   a,h7
    1874    1570   00780 F577                           mov    h7,a
    1875    1571   00782 E570                           mov    a,h0
    1876    1572   00784 3578                           addc   a,h8
    1877    1573   00786 F578                           mov    h8,a
    1878    1574   00788 E571                           mov    a,h1
    1879    1575   0078A 3579                           addc   a,h9
    1880    1576   0078C F579                           mov    h9,a
    1881    1577   0078E E572                           mov    a,h2
    1882    1578   00790 357A                           addc   a,h10
    1883    1579   00792 F57A                           mov    h10,a
    1884    1580   00794 E573                           mov    a,h3
    1885    1581   00796 357B                           addc   a,h11
    1886    1582   00798 F57B                           mov    h11,a                ;optelling klaar
    1887    1583   0079A                  
    1888    1584   0079A                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1889    1585   0079A                  
    1890    1586   0079A C3               mul322:       clr    c                    ;moet op 0 staan
    1891    1587   0079B EC                             mov    a,r4
    1892    1588   0079C 33                             rlc    a
    1893    1589   0079D FC                             mov    r4,a
    1894    1590   0079E ED                             mov    a,r5
    1895    1591   0079F 33                             rlc    a
    1896    1592   007A0 FD                             mov    r5,a
    1897    1593   007A1 EE                             mov    a,r6
    1898    1594   007A2 33                             rlc    a
    1899    1595   007A3 FE                             mov    r6,a
    1900    1596   007A4 EF                             mov    a,r7
    1901    1597   007A5 33                             rlc    a
    1902    1598   007A6 FF                             mov    r7,a
    1903    1599   007A7 E570                           mov    a,h0
    1904    1600   007A9 33                             rlc    a
    1905    1601   007AA F570                           mov    h0,a
    1906    1602   007AC E571                           mov    a,h1
    1907    1603   007AE 33                             rlc    a
    1908    1604   007AF F571                           mov    h1,a
    1909    1605   007B1 E572                           mov    a,h2
    1910    1606   007B3 33                             rlc    a
    1911    1607   007B4 F572                           mov    h2,a
    1912    1608   007B6 E573                           mov    a,h3
    1913    1609   007B8 33                             rlc    a
    1914    1610   007B9 F573                           mov    h3,a
    1915    1611   007BB                  
    1916    1612   007BB D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1917    1613   007BE                  
    1918    1614   007BE                  ; de uitkomst moet in de juiste registers komen
    1919    1615   007BE                  
    1920    1616   007BE A874                           mov    r0,h4
    1921    1617   007C0 A975                           mov    r1,h5
    1922    1618   007C2 AA76                           mov    r2,h6
    1923    1619   007C4 AB77                           mov    r3,h7
    1924    1620   007C6 AC78                           mov    r4,h8
    1925    1621   007C8 AD79                           mov    r5,h9
    1926    1622   007CA AE7A                           mov    r6,h10
    1927    1623   007CC AF7B                           mov    r7,h11               ;klaar
    1928    1624   007CE                  
    1929    1625   007CE D07C                           pop    h12                  ;registers herstellen
    1930    1626   007D0 D07B                           pop    h11
    1931    1627   007D2 D07A                           pop    h10
    1932    1628   007D4 D079                           pop    h9
    1933    1629   007D6 D078                           pop    h8
    1934    1630   007D8 D077                           pop    h7
    1935    1631   007DA D076                           pop    h6
    1936    1632   007DC D075                           pop    h5
    1937    1633   007DE D074                           pop    h4
    1938    1634   007E0 D073                           pop    h3
    1939    1635   007E2 D072                           pop    h2
    1940    1636   007E4 D071                           pop    h1
    1941    1637   007E6 D070                           pop    h0
    1942    1638   007E8 D0D0                           pop    psw
    1943    1639   007EA D0E0                           pop    acc
    1944    1640   007EC 22                             ret
    1945    1641   007ED                  
    1946    1642   007ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1947    1643   007ED                  ;
    1948    1644   007ED                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1949    1645   007ED                  ; input:      r1,r0 = eerste getal (r1=msb)
    1950    1646   007ED                  ;             r3,r2 = tweede getal (r3=msb)
    1951    1647   007ED                  ; output:     r3,r2,r1,r0 met r3=msb
    1952    1648   007ED                  ;
    1953    1649   007ED                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1954    1650   007ED                  ;
    1955    1651   007ED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1956    1652   007ED                  
    1957    1653   007ED C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1958    1654   007EF C0D0                           push   psw
    1959    1655   007F1 C070                           push   h0
    1960    1656   007F3 C071                           push   h1
    1961    1657   007F5 C072                           push   h2
    1962    1658   007F7 C073                           push   h3
    1963    1659   007F9 C074                           push   h4
    1964    1660   007FB C075                           push   h5
    1965    1661   007FD C076                           push   h6
    1966    1662   007FF                  
    1967    1663   007FF                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1968    1664   007FF                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1969    1665   007FF                  ; h6 is de loopcounter.
    1970    1666   007FF                  
    1971    1667   007FF 757000                         mov    h0,#000h
    1972    1668   00802 757100                         mov    h1,#000h
    1973    1669   00805 757200                         mov    h2,#000h
    1974    1670   00808 757300                         mov    h3,#000h
    1975    1671   0080B 757400                         mov    h4,#000h
    1976    1672   0080E 757500                         mov    h5,#000h
    1977    1673   00811 757610                         mov    h6,#16               ;loopcounter
    1978    1674   00814                  
    1979    1675   00814                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    1980    1676   00814                  ; berekening
    1981    1677   00814                  
    1982    1678   00814 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    1983    1679   00815 13                             rrc    a
    1984    1680   00816 F9                             mov    r1,a
    1985    1681   00817 E8                             mov    a,r0
    1986    1682   00818 13                             rrc    a
    1987    1683   00819 F8                             mov    r0,a                 ;ok
    1988    1684   0081A                  
    1989    1685   0081A                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    1990    1686   0081A                  
    1991    1687   0081A 5016                           jnc    mul162
    1992    1688   0081C                  
    1993    1689   0081C EA                             mov    a,r2
    1994    1690   0081D 2572                           add    a,h2
    1995    1691   0081F F572                           mov    h2,a                 ;32 bit som uitvoeren
    1996    1692   00821 EB                             mov    a,r3
    1997    1693   00822 3573                           addc   a,h3
    1998    1694   00824 F573                           mov    h3,a
    1999    1695   00826 E570                           mov    a,h0
    2000    1696   00828 3574                           addc   a,h4
    2001    1697   0082A F574                           mov    h4,a
    2002    1698   0082C E571                           mov    a,h1
    2003    1699   0082E 3575                           addc   a,h5
    2004    1700   00830 F575                           mov    h5,a                 ;klaar
    2005    1701   00832                  
    2006    1702   00832                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    2007    1703   00832                  
    2008    1704   00832 C3               mul162:       clr    c
    2009    1705   00833 EA                             mov    a,r2
    2010    1706   00834 33                             rlc    a
    2011    1707   00835 FA                             mov    r2,a                 ;ook 32 bit getal
    2012    1708   00836 EB                             mov    a,r3
    2013    1709   00837 33                             rlc    a
    2014    1710   00838 FB                             mov    r3,a
    2015    1711   00839 E570                           mov    a,h0
    2016    1712   0083B 33                             rlc    a
    2017    1713   0083C F570                           mov    h0,a
    2018    1714   0083E E571                           mov    a,h1
    2019    1715   00840 33                             rlc    a
    2020    1716   00841 F571                           mov    h1,a                 ;klaar
    2021    1717   00843                  
    2022    1718   00843 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    2023    1719   00846                  
    2024    1720   00846                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    2025    1721   00846                  
    2026    1722   00846 A872                           mov    r0,h2
    2027    1723   00848 A973                           mov    r1,h3
    2028    1724   0084A AA74                           mov    r2,h4
    2029    1725   0084C AB75                           mov    r3,h5                ;klaar
    2030    1726   0084E                  
    2031    1727   0084E                  
    2032    1728   0084E D076                           pop    h6                   ;registers herstellen
    2033    1729   00850 D075                           pop    h5
    2034    1730   00852 D074                           pop    h4
    2035    1731   00854 D073                           pop    h3
    2036    1732   00856 D072                           pop    h2
    2037    1733   00858 D071                           pop    h1
    2038    1734   0085A D070                           pop    h0
    2039    1735   0085C D0D0                           pop    psw
    2040    1736   0085E D0E0                           pop    acc
    2041    1737   00860 22                             ret
    2042    1738   00861                  
    2043    1739   00861                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2044    1740   00861                  ;
    2045    1741   00861                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2046    1742   00861                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2047    1743   00861                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2048    1744   00861                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2049    1745   00861                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2050    1746   00861                  ;             carry=1 bij delen door 0
    2051    1747   00861                  ;
    2052    1748   00861                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2053    1749   00861                  ;
    2054    1750   00861                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2055    1751   00861                  
    2056    1752   00861 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2057    1753   00863 C0D0                           push   psw
    2058    1754   00865 C070                           push   h0
    2059    1755   00867 C071                           push   h1
    2060    1756   00869 C072                           push   h2
    2061    1757   0086B C073                           push   h3
    2062    1758   0086D C074                           push   h4
    2063    1759   0086F C075                           push   h5
    2064    1760   00871 C076                           push   h6
    2065    1761   00873 C077                           push   h7
    2066    1762   00875 C078                           push   h8
    2067    1763   00877 C079                           push   h9
    2068    1764   00879 C07A                           push   h10
    2069    1765   0087B C07B                           push   h11
    2070    1766   0087D C07C                           push   h12
    2071    1767   0087F                  
    2072    1768   0087F                  ; eerst alles voorladen
    2073    1769   0087F                  
    2074    1770   0087F 757000                         mov    h0,#000h
    2075    1771   00882 757100                         mov    h1,#000h
    2076    1772   00885 757200                         mov    h2,#000h
    2077    1773   00888 757300                         mov    h3,#000h
    2078    1774   0088B 757400                         mov    h4,#000h
    2079    1775   0088E 757500                         mov    h5,#000h
    2080    1776   00891 757600                         mov    h6,#000h
    2081    1777   00894 757700                         mov    h7,#000h
    2082    1778   00897 757800                         mov    h8,#000h
    2083    1779   0089A 757900                         mov    h9,#000h
    2084    1780   0089D 757A00                         mov    h10,#000h
    2085    1781   008A0 757B00                         mov    h11,#000h
    2086    1782   008A3 757C20                         mov    h12,#32              ;loopcounter
    2087    1783   008A6                  
    2088    1784   008A6                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2089    1785   008A6                  
    2090    1786   008A6                  ; deze lus moet 32 keer heraald worden
    2091    1787   008A6                  
    2092    1788   008A6 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2093    1789   008A7 33                             rlc    a
    2094    1790   008A8 F8                             mov    r0,a
    2095    1791   008A9 E9                             mov    a,r1
    2096    1792   008AA 33                             rlc    a
    2097    1793   008AB F9                             mov    r1,a
    2098    1794   008AC EA                             mov    a,r2
    2099    1795   008AD 33                             rlc    a
    2100    1796   008AE FA                             mov    r2,a
    2101    1797   008AF EB                             mov    a,r3
    2102    1798   008B0 33                             rlc    a
    2103    1799   008B1 FB                             mov    r3,a
    2104    1800   008B2 E570                           mov    a,h0
    2105    1801   008B4 33                             rlc    a
    2106    1802   008B5 F570                           mov    h0,a
    2107    1803   008B7 E571                           mov    a,h1
    2108    1804   008B9 33                             rlc    a
    2109    1805   008BA F571                           mov    h1,a
    2110    1806   008BC E572                           mov    a,h2
    2111    1807   008BE 33                             rlc    a
    2112    1808   008BF F572                           mov    h2,a
    2113    1809   008C1 E573                           mov    a,h3
    2114    1810   008C3 33                             rlc    a
    2115    1811   008C4 F573                           mov    h3,a
    2116    1812   008C6                  
    2117    1813   008C6                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2118    1814   008C6                  
    2119    1815   008C6 C3                             clr    c                    ;zit in de weg
    2120    1816   008C7 E570                           mov    a,h0
    2121    1817   008C9 9C                             subb   a,r4
    2122    1818   008CA F574                           mov    h4,a
    2123    1819   008CC E571                           mov    a,h1
    2124    1820   008CE 9D                             subb   a,r5
    2125    1821   008CF F575                           mov    h5,a
    2126    1822   008D1 E572                           mov    a,h2
    2127    1823   008D3 9E                             subb   a,r6
    2128    1824   008D4 F576                           mov    h6,a
    2129    1825   008D6 E573                           mov    a,h3
    2130    1826   008D8 9F                             subb   a,r7
    2131    1827   008D9 F577                           mov    h7,a
    2132    1828   008DB                  
    2133    1829   008DB                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2134    1830   008DB                  ; vervangen worden door h7-h4
    2135    1831   008DB                  
    2136    1832   008DB 400C                           jc     div322               ;niet vervangen
    2137    1833   008DD                  
    2138    1834   008DD 857470                         mov    h0,h4
    2139    1835   008E0 857571                         mov    h1,h5
    2140    1836   008E3 857672                         mov    h2,h6
    2141    1837   008E6 857773                         mov    h3,h7                ;vervanging klaar
    2142    1838   008E9                  
    2143    1839   008E9 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2144    1840   008EA E578                           mov    a,h8
    2145    1841   008EC 33                             rlc    a
    2146    1842   008ED F578                           mov    h8,a
    2147    1843   008EF E579                           mov    a,h9
    2148    1844   008F1 33                             rlc    a
    2149    1845   008F2 F579                           mov    h9,a
    2150    1846   008F4 E57A                           mov    a,h10
    2151    1847   008F6 33                             rlc    a
    2152    1848   008F7 F57A                           mov    h10,a
    2153    1849   008F9 E57B                           mov    a,h11
    2154    1850   008FB 33                             rlc    a
    2155    1851   008FC F57B                           mov    h11,a                ;qoutient aangepast
    2156    1852   008FE                  
    2157    1853   008FE D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2158    1854   00901                  
    2159    1855   00901                  ; de berekening is klaar. uitkomstregisters nog laden
    2160    1856   00901                  
    2161    1857   00901 AC78                           mov    r4,h8
    2162    1858   00903 AD79                           mov    r5,h9
    2163    1859   00905 AE7A                           mov    r6,h10
    2164    1860   00907 AF7B                           mov    r7,h11               ;uitkomst geladen
    2165    1861   00909                  
    2166    1862   00909 A870                           mov    r0,h0                ;rest laden
    2167    1863   0090B A971                           mov    r1,h1
    2168    1864   0090D AA72                           mov    r2,h2
    2169    1865   0090F AB73                           mov    r3,h3
    2170    1866   00911                  
    2171    1867   00911 D07C                           pop    h12                  ;registers herstellen
    2172    1868   00913 D07B                           pop    h11
    2173    1869   00915 D07A                           pop    h10
    2174    1870   00917 D079                           pop    h9
    2175    1871   00919 D078                           pop    h8
    2176    1872   0091B D077                           pop    h7
    2177    1873   0091D D076                           pop    h6
    2178    1874   0091F D075                           pop    h5
    2179    1875   00921 D074                           pop    h4
    2180    1876   00923 D073                           pop    h3
    2181    1877   00925 D072                           pop    h2
    2182    1878   00927 D071                           pop    h1
    2183    1879   00929 D070                           pop    h0
    2184    1880   0092B D0D0                           pop    psw
    2185    1881   0092D D0E0                           pop    acc
    2186    1882   0092F 22                             ret
    2187    1883   00930                  
    2188    1884   00930                  
    2189    1885   00930                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2190    1886   00930                  ;
    2191    1887   00930                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2192    1888   00930                  ; input:      r1,r0 = eerste getal (r1=msb)
    2193    1889   00930                  ;             r3,r2 = tweede getal (r3=msb)
    2194    1890   00930                  ; output:     r3,r2 = quotient (r3=msb)
    2195    1891   00930                  ;             r1,r0 = rest (r1=msb)
    2196    1892   00930                  ;             carry=1 bij deling door 0
    2197    1893   00930                  ;
    2198    1894   00930                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2199    1895   00930                  
    2200    1896   00930 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2201    1897   00932 C0D0                           push   psw
    2202    1898   00934 C070                           push   h0
    2203    1899   00936 C071                           push   h1
    2204    1900   00938 C072                           push   h2
    2205    1901   0093A C073                           push   h3
    2206    1902   0093C C074                           push   h4
    2207    1903   0093E C075                           push   h5
    2208    1904   00940 C076                           push   h6
    2209    1905   00942                  
    2210    1906   00942                  ; registers voorladen
    2211    1907   00942                  
    2212    1908   00942 757000                         mov    h0,#000h
    2213    1909   00945 757100                         mov    h1,#000h
    2214    1910   00948 757200                         mov    h2,#000h
    2215    1911   0094B 757300                         mov    h3,#000h
    2216    1912   0094E 757400                         mov    h4,#000h
    2217    1913   00951 757500                         mov    h5,#000h
    2218    1914   00954 757610                         mov    h6,#16               ;loopcounter
    2219    1915   00957                  
    2220    1916   00957                  ; eerst te delen getal 1*links shiften in hulpregisters
    2221    1917   00957                  
    2222    1918   00957                  ; deze lus moet 16 keer herhaald worden
    2223    1919   00957                  
    2224    1920   00957 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2225    1921   00958 33                             rlc    a
    2226    1922   00959 F8                             mov    r0,a
    2227    1923   0095A E9                             mov    a,r1
    2228    1924   0095B 33                             rlc    a
    2229    1925   0095C F9                             mov    r1,a
    2230    1926   0095D E570                           mov    a,h0
    2231    1927   0095F 33                             rlc    a
    2232    1928   00960 F570                           mov    h0,a
    2233    1929   00962 E571                           mov    a,h1
    2234    1930   00964 33                             rlc    a
    2235    1931   00965 F571                           mov    h1,a
    2236    1932   00967                  
    2237    1933   00967                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2238    1934   00967                  ; het tussenresultaat.
    2239    1935   00967                  
    2240    1936   00967 C3                             clr    c
    2241    1937   00968 E570                           mov    a,h0
    2242    1938   0096A 9A                             subb   a,r2
    2243    1939   0096B F572                           mov    h2,a
    2244    1940   0096D E571                           mov    a,h1
    2245    1941   0096F 9B                             subb   a,r3
    2246    1942   00970 F573                           mov    h3,a
    2247    1943   00972                  
    2248    1944   00972 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2249    1945   00974                                                            ;door h3,h2
    2250    1946   00974 857270                         mov    h0,h2
    2251    1947   00977 857371                         mov    h1,h3                ;vervanging klaar
    2252    1948   0097A                  
    2253    1949   0097A                  ; uitkomst moet aangepast worden
    2254    1950   0097A                  
    2255    1951   0097A B3               div162:       cpl    c                    ;truuk
    2256    1952   0097B E574                           mov    a,h4
    2257    1953   0097D 33                             rlc    a
    2258    1954   0097E F574                           mov    h4,a
    2259    1955   00980 E575                           mov    a,h5
    2260    1956   00982 33                             rlc    a
    2261    1957   00983 F575                           mov    h5,a
    2262    1958   00985 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2263    1959   00988                  
    2264    1960   00988                  ; de berekening is klaar. uitkomsten in passende registers
    2265    1961   00988                  
    2266    1962   00988 AA74                           mov    r2,h4                ;quotient
    2267    1963   0098A AB75                           mov    r3,h5
    2268    1964   0098C                  
    2269    1965   0098C A870                           mov    r0,h0                ;rest
    2270    1966   0098E A971                           mov    r1,h1
    2271    1967   00990                  
    2272    1968   00990 D076                           pop    h6                   ;registers herstellen
    2273    1969   00992 D075                           pop    h5
    2274    1970   00994 D074                           pop    h4
    2275    1971   00996 D073                           pop    h3
    2276    1972   00998 D072                           pop    h2
    2277    1973   0099A D071                           pop    h1
    2278    1974   0099C D070                           pop    h0
    2279    1975   0099E D0D0                           pop    psw
    2280    1976   009A0 D0E0                           pop    acc
    2281    1977   009A2 22                             ret
    2282    1978   009A3                  
    2283    1979   009A3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2284    1980   009A3                  ;
    2285    1981   009A3                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2286    1982   009A3                  ;
    2287    1983   009A3                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2288    1984   009A3                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2289    1985   009A3                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2290    1986   009A3                  ;
    2291    1987   009A3                  ; r4,r3,r2,r1,r0 worden aangepast
    2292    1988   009A3                  ;
    2293    1989   009A3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2294    1990   009A3                  
    2295    1991   009A3 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2296    1992   009A5 C0D0                           push   psw
    2297    1993   009A7 E8                             mov    a,r0                 ;eerste 8 bit
    2298    1994   009A8 2C                             add    a,r4
    2299    1995   009A9 F8                             mov    r0,a                 ;klaar
    2300    1996   009AA E9                             mov    a,r1                 ;volgende 8 bit
    2301    1997   009AB 3D                             addc   a,r5
    2302    1998   009AC F9                             mov    r1,a                 ;klaar
    2303    1999   009AD EA                             mov    a,r2                 ;volgende 8 bit
    2304    2000   009AE 3E                             addc   a,r6
    2305    2001   009AF FA                             mov    r2,a                 ;klaar
    2306    2002   009B0 EB                             mov    a,r3                 ;laatste 8 bit
    2307    2003   009B1 3F                             addc   a,r7
    2308    2004   009B2 FB                             mov    r3,a                 ;32 bit klaar
    2309    2005   009B3 7400                           mov    a,#000h
    2310    2006   009B5 3400                           addc   a,#000h              ;carry verrekenen
    2311    2007   009B7 FC                             mov    r4,a
    2312    2008   009B8 D0D0                           pop    psw                  ;registers herstellen
    2313    2009   009BA D0E0                           pop    acc
    2314    2010   009BC 22                             ret
    2315    2011   009BD                  
    2316    2012   009BD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2317    2013   009BD                  ;
    2318    2014   009BD                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2319    2015   009BD                  ;
    2320    2016   009BD                  ; input:      r1,r0 = eerste getal (r1=msb)
    2321    2017   009BD                  ;             r3,r2 = tweede getal (r3=msb)
    2322    2018   009BD                  ; output:     r2,r1,r0 (r2=msb)
    2323    2019   009BD                  ;
    2324    2020   009BD                  ; r3,r2,r1,r0 worden aangepast
    2325    2021   009BD                  ;
    2326    2022   009BD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2327    2023   009BD                  
    2328    2024   009BD C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2329    2025   009BF C0D0                           push   psw
    2330    2026   009C1 E8                             mov    a,r0                 ;starten met de optelling
    2331    2027   009C2 2A                             add    a,r2                 ;8 bit klaar
    2332    2028   009C3 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2333    2029   009C4 E9                             mov    a,r1                 ;volgende 8 bit
    2334    2030   009C5 3B                             addc   a,r3                 ;16 bit klaar
    2335    2031   009C6 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2336    2032   009C7 7400                           mov    a,#000h              ;carry verrekenen
    2337    2033   009C9 3400                           addc   a,#000h
    2338    2034   009CB FA                             mov    r2,a                 ;24 bit klaar
    2339    2035   009CC D0D0                           pop    psw                  ;registers herstellen
    2340    2036   009CE D0E0                           pop    acc
    2341    2037   009D0 22                             ret
    2342    2038   009D1                  
    2343    2039   009D1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2344    2040   009D1                  ;
    2345    2041   009D1                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2346    2042   009D1                  ;             40 bit groot. (eerste -tweede)
    2347    2043   009D1                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2348    2044   009D1                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2349    2045   009D1                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2350    2046   009D1                  ;
    2351    2047   009D1                  ; r4,r3,r2,r1,r0 worden aangepast
    2352    2048   009D1                  ;
    2353    2049   009D1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2354    2050   009D1                  
    2355    2051   009D1 C0E0             sub32:        push   acc                  ;registers bewaren
    2356    2052   009D3 C0D0                           push   psw                  ;ook de vlaggen
    2357    2053   009D5 C3                             clr    c                    ;zit nog effe in de weg
    2358    2054   009D6 E8                             mov    a,r0                 ;eerste 8 bit
    2359    2055   009D7 9C                             subb   a,r4
    2360    2056   009D8 F8                             mov    r0,a
    2361    2057   009D9 E9                             mov    a,r1                 ;tweede 8 bit
    2362    2058   009DA 9D                             subb   a,r5
    2363    2059   009DB F9                             mov    r1,a
    2364    2060   009DC EA                             mov    a,r2                 ;volgende 8 bit
    2365    2061   009DD 9E                             subb   a,r6
    2366    2062   009DE FA                             mov    r2,a
    2367    2063   009DF EB                             mov    a,r3                 ;laatste 8 bit
    2368    2064   009E0 9F                             subb   a,r7
    2369    2065   009E1 FB                             mov    r3,a
    2370    2066   009E2 7400                           mov    a,#000h              ;nu nog de carry
    2371    2067   009E4 9400                           subb   a,#000h
    2372    2068   009E6 FC                             mov    r4,a                 ;40 bit klaar
    2373    2069   009E7 D0D0                           pop    psw                  ;registers herstellen
    2374    2070   009E9 D0E0                           pop    acc
    2375    2071   009EB 22                             ret
    2376    2072   009EC                  
    2377    2073   009EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2378    2074   009EC                  ;
    2379    2075   009EC                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2380    2076   009EC                  ;             24 bit groot. (eerste - tweede)
    2381    2077   009EC                  ; input:      r1,r0 = eerste getal (r1=msb)
    2382    2078   009EC                  ;             r3,r2 = tweede getal (r3=msb)
    2383    2079   009EC                  ; output:     r2,r1,r0 (r2=msb)
    2384    2080   009EC                  ;
    2385    2081   009EC                  ; r3,r2,r1,r0 worden aangepast
    2386    2082   009EC                  ;
    2387    2083   009EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2388    2084   009EC                  
    2389    2085   009EC C0E0             sub16:        push   acc                  ;registers bewaren
    2390    2086   009EE C0D0                           push   psw
    2391    2087   009F0 C3                             clr    c                    ;mag nog niet meespelen
    2392    2088   009F1 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2393    2089   009F2 9A                             subb   a,r2
    2394    2090   009F3 F8                             mov    r0,a                 ;klaar
    2395    2091   009F4 E9                             mov    a,r1
    2396    2092   009F5 9B                             subb   a,r3                 ;16 bit klaar
    2397    2093   009F6 F9                             mov    r1,a
    2398    2094   009F7 7400                           mov    a,#000h
    2399    2095   009F9 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2400    2096   009FB FA                             mov    r2,a                 ;24 bit klaar
    2401    2097   009FC D0D0                           pop    psw                  ;registers herstellen
    2402    2098   009FE D0E0                           pop    acc
    2403    2099   00A00 22                             ret
    2404    2100   00A01                  
    2405    2101   00A01                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2406    2102   00A01                  ;
    2407    2103   00A01                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2408    2104   00A01                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2409    2105   00A01                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2410    2106   00A01                  ;
    2411    2107   00A01                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2412    2108   00A01                  ;
    2413    2109   00A01                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2414    2110   00A01                  
    2415    2111   00A01 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2416    2112   00A03 C0D0                           push   psw
    2417    2113   00A05                  
    2418    2114   00A05 C077                           push   h7                   ;nodig
    2419    2115   00A07 C078                           push   h8
    2420    2116   00A09                  
    2421    2117   00A09 C079                           push   h9                   ;ook
    2422    2118   00A0B                  
    2423    2119   00A0B 757905                         mov    h9,#005h             ;loopcounter
    2424    2120   00A0E                  
    2425    2121   00A0E 7B00             hexbcd161:    mov    r3,#000h
    2426    2122   00A10 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2427    2123   00A12 120930                         lcall  div16                ;deling uitvoeren
    2428    2124   00A15 E8                             mov    a,r0                 ;rest
    2429    2125   00A16 C0E0                           push   acc                  ;op stack zetten
    2430    2126   00A18 EA                             mov    a,r2
    2431    2127   00A19 F8                             mov    r0,a
    2432    2128   00A1A EB                             mov    a,r3
    2433    2129   00A1B F9                             mov    r1,a                 ;uitkomst terug delen
    2434    2130   00A1C D579EF                         djnz   h9,hexbcd161
    2435    2131   00A1F                  
    2436    2132   00A1F D0E0                           pop    acc                  ;hoogste bits van de stack
    2437    2133   00A21 FA                             mov    r2,a                 ;klaar
    2438    2134   00A22 D0E0                           pop    acc
    2439    2135   00A24 C4                             swap   a
    2440    2136   00A25 F579                           mov    h9,a
    2441    2137   00A27 D0E0                           pop    acc
    2442    2138   00A29 2579                           add    a,h9
    2443    2139   00A2B F9                             mov    r1,a                 ;volgende 8 klaar
    2444    2140   00A2C D0E0                           pop    acc
    2445    2141   00A2E C4                             swap   a
    2446    2142   00A2F F579                           mov    h9,a
    2447    2143   00A31 D0E0                           pop    acc
    2448    2144   00A33 2579                           add    a,h9
    2449    2145   00A35 F8                             mov    r0,a                 ;klaar
    2450    2146   00A36                  
    2451    2147   00A36 D079                           pop    h9                   ;was naar de knoppen
    2452    2148   00A38                  
    2453    2149   00A38 D078                           pop    h8                   ;gebruikt
    2454    2150   00A3A D077                           pop    h7
    2455    2151   00A3C                  
    2456    2152   00A3C D0D0                           pop    psw                  ;registers herstellen
    2457    2153   00A3E D0E0                           pop    acc
    2458    2154   00A40 22                             ret
    2459    2155   00A41                  
    2460    2156   00A41                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2461    2157   00A41                  ;
    2462    2158   00A41                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2463    2159   00A41                  ; input       a (maximale waarde = 63h)
    2464    2160   00A41                  ; output      a
    2465    2161   00A41                  ;
    2466    2162   00A41                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2467    2163   00A41                  
    2468    2164   00A41 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2469    2165   00A43 C0F0                           push   b
    2470    2166   00A45 75F00A                         mov    b,#00ah              ;hierdoor delen
    2471    2167   00A48 84                             div    ab                   ;in accu qoutient in b rest
    2472    2168   00A49 C4                             swap   a
    2473    2169   00A4A 25F0                           add    a,b                  ;bcd getal klaar
    2474    2170   00A4C D0F0                           pop    b
    2475    2171   00A4E D0D0                           pop    psw
    2476    2172   00A50 22                             ret
    2477    2173   00A51                  
    2478    2174   00A51                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2479    2175   00A51                  ;
    2480    2176   00A51                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2481    2177   00A51                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2482    2178   00A51                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2483    2179   00A51                  ;
    2484    2180   00A51                  ; de routine gebruikt r1,r0 van de huidige bank
    2485    2181   00A51                  ;
    2486    2182   00A51                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2487    2183   00A51                  
    2488    2184   00A51 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2489    2185   00A53 C0E0                           push   acc
    2490    2186   00A55 C0D0                           push   psw
    2491    2187   00A57                  
    2492    2188   00A57 E8                             mov    a,r0
    2493    2189   00A58 540F                           anl    a,#00fh              ;eenheden
    2494    2190   00A5A C0E0                           push   acc                  ;effe bewaren
    2495    2191   00A5C                  
    2496    2192   00A5C E8                             mov    a,r0
    2497    2193   00A5D C4                             swap   a
    2498    2194   00A5E 540F                           anl    a,#00fh              ;tientallen
    2499    2195   00A60 75F00A                         mov    b,#00ah              ;waarde berekenen
    2500    2196   00A63 A4                             mul    ab                   ;klaar
    2501    2197   00A64 D0F0                           pop    b                    ;truukje
    2502    2198   00A66 25F0                           add    a,b                  ;a is lage deel hex getal
    2503    2199   00A68 C0E0                           push   acc                  ;straks nodig
    2504    2200   00A6A                  
    2505    2201   00A6A E9                             mov    a,r1                 ;hoge deel
    2506    2202   00A6B 54F0                           anl    a,#0f0h
    2507    2203   00A6D C4                             swap   a
    2508    2204   00A6E C0E0                           push   acc                  ;straks nodig
    2509    2205   00A70                  
    2510    2206   00A70 E9                             mov    a,r1
    2511    2207   00A71 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2512    2208   00A73 75F064                         mov    b,#100               ;waarde uitrekenen
    2513    2209   00A76 A4                             mul    ab
    2514    2210   00A77 A9F0                           mov    r1,b
    2515    2211   00A79 F8                             mov    r0,a
    2516    2212   00A7A                  
    2517    2213   00A7A D0E0                           pop    acc
    2518    2214   00A7C 75F00A                         mov    b,#10
    2519    2215   00A7F A4                             mul    ab                   ;kan nog in a
    2520    2216   00A80 75F064                         mov    b,#100               ;*10*100=*1000
    2521    2217   00A83 A4                             mul    ab
    2522    2218   00A84 28                             add    a,r0
    2523    2219   00A85 F8                             mov    r0,a
    2524    2220   00A86 E9                             mov    a,r1
    2525    2221   00A87 35F0                           addc   a,b
    2526    2222   00A89 F9                             mov    r1,a
    2527    2223   00A8A                  
    2528    2224   00A8A D0E0                           pop    acc
    2529    2225   00A8C 28                             add    a,r0
    2530    2226   00A8D F8                             mov    r0,a
    2531    2227   00A8E 7400                           mov    a,#000h
    2532    2228   00A90 39                             addc   a,r1
    2533    2229   00A91 F9                             mov    r1,a                 ;klaar
    2534    2230   00A92                  
    2535    2231   00A92 D0D0                           pop    psw
    2536    2232   00A94 D0E0                           pop    acc
    2537    2233   00A96 D0F0                           pop    b
    2538    2234   00A98 22                             ret
    2539    2235   00A99                  
    2540    2236   00A99                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2541    2237   00A99                  ;
    2542    2238   00A99                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2543    2239   00A99                  ; input:      a (maximale waarde 99h)
    2544    2240   00A99                  ; output:     a
    2545    2241   00A99                  ;
    2546    2242   00A99                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2547    2243   00A99                  
    2548    2244   00A99 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2549    2245   00A9B C0F0                           push   b
    2550    2246   00A9D C070                           push   h0
    2551    2247   00A9F F570                           mov    h0,a                 ;effe bewaren
    2552    2248   00AA1 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2553    2249   00AA4 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2554    2250   00AA6 C4                             swap   a
    2555    2251   00AA7 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2556    2252   00AAA A4                             mul    ab
    2557    2253   00AAB 2570                           add    a,h0                 ;eenheden bijtellen
    2558    2254   00AAD D070                           pop    h0
    2559    2255   00AAF D0F0                           pop    b
    2560    2256   00AB1 D0D0                           pop    psw
    2561    2257   00AB3 22                             ret
    2562    2258   00AB4                  
    2563    2259   00AB4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2564    2260   00AB4                  ;
    2565    2261   00AB4                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2566    2262   00AB4                  ;
    2567    2263   00AB4                  ; Gebruikt geen registers
    2568    2264   00AB4                  ;
    2569    2265   00AB4                  ; Originele auteur: Danny Pawels (dp)
    2570    2266   00AB4                  ;
    2571    2267   00AB4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2572    2268   00AB4                  
    2573    2269   00AB4                  
    2574    2270   00AB4 C083             XCsw2xtal:  push  dph
    2575    2271   00AB6 C082                         push  dpl
    2576    2272   00AB8 C0D0                         push  psw
    2577    2273   00ABA C08F                         push  syscon0
    2578    2274   00ABC C0B2                         push  port_page
    2579    2275   00ABE C0BF                         push  scu_page
    2580    2276   00AC0                  
    2581    2277   00AC0 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2582    2278   00AC3 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2583    2279   00AC6                  
    2584    2280   00AC6 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2585    2281   00AC9                                                            ;freq= VCO-free running =5MHz...20MHz?
    2586    2282   00AC9 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2587    2283   00ACC 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2588    2284   00ACF 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2589    2285   00AD2                  
    2590    2286   00AD2 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2591    2287   00AD5 A3               XCsw2xtal0: inc   dptr
    2592    2288   00AD6 E582                         mov   a,dpl
    2593    2289   00AD8 4583                         orl   a,dph
    2594    2290   00ADA 70F9                         jnz   XCsw2xtal0
    2595    2291   00ADC                  
    2596    2292   00ADC 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2597    2293   00ADF                  
    2598    2294   00ADF                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2599    2295   00ADF E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2600    2296   00AE1 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2601    2297   00AE4                  ;Oscillator run detectie is klaar...
    2602    2298   00AE4 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2603    2299   00AE7                  
    2604    2300   00AE7                  
    2605    2301   00AE7 E5B7                         mov   a,pll_con               ;lees pll_con
    2606    2302   00AE9 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2607    2303   00AEB 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2608    2304   00AED                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2609    2305   00AED                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2610    2306   00AED                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2611    2307   00AED 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2612    2308   00AF0                                                            ;bij aanpassing van de NDIV van de PLL
    2613    2309   00AF0 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2614    2310   00AF2 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2615    2311   00AF5 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2616    2312   00AF8                  
    2617    2313   00AF8 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2618    2314   00AFA 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2619    2315   00AFD                  
    2620    2316   00AFD 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2621    2317   00B00 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2622    2318   00B03                  
    2623    2319   00B03 D0BF                         pop   scu_page                ;herstel controller status
    2624    2320   00B05 D0B2                         pop   port_page
    2625    2321   00B07 D08F                         pop   syscon0
    2626    2322   00B09 D0D0                         pop   psw
    2627    2323   00B0B D082                         pop   dpl
    2628    2324   00B0D D083                         pop   dph
    2629    2325   00B0F 22                           ret
    2630    2326   00B10                  
    2631    2327   00B10                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2632    2328   00B10                  ;
    2633    2329   00B10                  ; mapregs	selecteer de SFR's in de mapped area
    2634    2330   00B10                  ;
    2635    2331   00B10                  ;
    2636    2332   00B10                  ; Past syscon SFR aan
    2637    2333   00B10                  ;
    2638    2334   00B10                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2639    2335   00B10                  
    2640    2336   00B10 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2641    2337   00B13 22               		ret
    2642    2338   00B14                  
    2643    2339   00B14                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2644    2340   00B14                  ;
    2645    2341   00B14                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2646    2342   00B14                  ;
    2647    2343   00B14                  ; Past syscon SFR aan
    2648    2344   00B14                  ;
    2649    2345   00B14                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2650    2346   00B14                  
    2651    2347   00B14 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2652    2348   00B17 22               		ret
    2653    2349   00B18                  
    2654    2350   00B18                  ;*******************************************************************************
    2655    2351   00B18                  ;
    2656    2352   00B18                  ; These are the register declarations for the XC888 microcontroller from
    2657    2353   00B18                  ; Infineon.
    2658    2354   00B18                  ;
    2659    2355   00B18                  ;*******************************************************************************
    2660    2356   00B18                  
    2661    2357   00B18                  ;*******************************************************************************
    2662    2358   00B18                  ;
    2663    2359   00B18                  ; CPU registers are accessible independend of paging and mapping
    2664    2360   00B18                  ; (always accessible)
    2665    2361   00B18                  ;
    2666    2362   00B18                  ;*******************************************************************************
    2667    2363   00B18                  
    2668    2364   00B18                  sp            data   081h          ;stack pointer                     reset=007h
    2669    2365   00B18                  dpl           data   082h          ;datapointer low register          reset=000h
    2670    2366   00B18                  dph           data   083h          ;datapointer high register         reset=000h
    2671    2367   00B18                  pcon          data   087h          ;power control                     reset=000h
    2672    2368   00B18                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2673    2369   00B18                  ;tcon is bit addressable
    2674    2370   00B18                         tf1    bit    08fh
    2675    2371   00B18                         tr1    bit    08eh
    2676    2372   00B18                         tf0    bit    08dh
    2677    2373   00B18                         tr0    bit    08ch
    2678    2374   00B18                         ie1    bit    08bh
    2679    2375   00B18                         it1    bit    08ah
    2680    2376   00B18                         ie0    bit    089h
    2681    2377   00B18                         it0    bit    088h
    2682    2378   00B18                  
    2683    2379   00B18                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2684    2380   00B18                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2685    2381   00B18                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2686    2382   00B18                  th0           data   08ch          ;timer 0 high                      reset=000h
    2687    2383   00B18                  th1           data   08dh          ;timer 1 high                      reset=000h
    2688    2384   00B18                  
    2689    2385   00B18                  syscon0       data   08fh          ;system control register 0         reset=004h
    2690    2386   00B18                  scon          data   098h          ;serial channel 0 control          reset=000h
    2691    2387   00B18                  ;scon is bit addressable
    2692    2388   00B18                         sm0    bit    09fh
    2693    2389   00B18                         sm1    bit    09eh
    2694    2390   00B18                         sm2    bit    09dh
    2695    2391   00B18                         ren    bit    09ch
    2696    2392   00B18                         tb8    bit    09bh
    2697    2393   00B18                         rb8    bit    09ah
    2698    2394   00B18                         ti     bit    099h
    2699    2395   00B18                         ri     bit    098h
    2700    2396   00B18                  
    2701    2397   00B18                  sbuf          data   099h          ;serial data buffer channel 0
    2702    2398   00B18                  eo            data   0a2h          ;extended operation                reset=000h
    2703    2399   00B18                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2704    2400   00B18                  ;ien0 is bit addressable
    2705    2401   00B18                         ea     bit    0afh
    2706    2402   00B18                                                     ;bit not implemented
    2707    2403   00B18                         et2    bit    0adh
    2708    2404   00B18                         es     bit    0ach
    2709    2405   00B18                         et1    bit    0abh
    2710    2406   00B18                         ex1    bit    0aah
    2711    2407   00B18                         et0    bit    0a9h
    2712    2408   00B18                         ex0    bit    0a8h
    2713    2409   00B18                  
    2714    2410   00B18                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2715    2411   00B18                  ;ip is bit addressable
    2716    2412   00B18                                                     ;bit not implemented
    2717    2413   00B18                                                     ;bit not implemented
    2718    2414   00B18                         pt2    bit    0bdh
    2719    2415   00B18                         ps     bit    0bch
    2720    2416   00B18                         pt1    bit    0bbh
    2721    2417   00B18                         px1    bit    0bah
    2722    2418   00B18                         pt0    bit    0b9h
    2723    2419   00B18                         px0    bit    0b8h
    2724    2420   00B18                  
    2725    2421   00B18                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2726    2422   00B18                  psw           data   0d0h          ;program status word               reset=000h
    2727    2423   00B18                  ;psw is bit addressable
    2728    2424   00B18                         cy     bit    0d7h
    2729    2425   00B18                         ac     bit    0d6h
    2730    2426   00B18                         f0     bit    0d5h
    2731    2427   00B18                         rs1    bit    0d4h
    2732    2428   00B18                         rs0    bit    0d3h
    2733    2429   00B18                         ov     bit    0d2h
    2734    2430   00B18                         f1     bit    0d1h
    2735    2431   00B18                         p      bit    0d0h
    2736    2432   00B18                  
    2737    2433   00B18                  acc           data   0e0h          ;accumulator                       reset=000h
    2738    2434   00B18                  ;acc is bit addressable
    2739    2435   00B18                  
    2740    2436   00B18                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2741    2437   00B18                  ;ien1 is bit addressable
    2742    2438   00B18                         eccip3 bit    0efh
    2743    2439   00B18                         eccip2 bit    0eeh
    2744    2440   00B18                         eccip1 bit    0edh
    2745    2441   00B18                         eccip0 bit    0ech
    2746    2442   00B18                         exm    bit    0ebh
    2747    2443   00B18                         ex2    bit    0eah
    2748    2444   00B18                         essc   bit    0e9h
    2749    2445   00B18                         eadc   bit    0e8h
    2750    2446   00B18                  
    2751    2447   00B18                  b             data   0f0h          ;b register                        reset=000h
    2752    2448   00B18                  ;b is bit addressable
    2753    2449   00B18                  
    2754    2450   00B18                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2755    2451   00B18                  ;ip1 is bit addressable
    2756    2452   00B18                         pccip3 bit    0ffh
    2757    2453   00B18                         pccip2 bit    0feh
    2758    2454   00B18                         pccip1 bit    0fdh
    2759    2455   00B18                         pccip0 bit    0fch
    2760    2456   00B18                         pxm    bit    0fbh
    2761    2457   00B18                         px2    bit    0fah
    2762    2458   00B18                         pssc   bit    0f9h
    2763    2459   00B18                         padc   bit    0f8h
    2764    2460   00B18                  
    2765    2461   00B18                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2766    2462   00B18                  
    2767    2463   00B18                  
    2768    2464   00B18                  ;*******************************************************************************
    2769    2465   00B18                  ;
    2770    2466   00B18                  ; system control registers registers that can only be accessed in the non
    2771    2467   00B18                  ; mapped memory area (rmap=0) page independent
    2772    2468   00B18                  ;
    2773    2469   00B18                  ;*******************************************************************************
    2774    2470   00B18                  
    2775    2471   00B18                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2776    2472   00B18                  
    2777    2473   00B18                  ;*******************************************************************************
    2778    2474   00B18                  ;
    2779    2475   00B18                  ; system control registers registers that can only be accessed in the non
    2780    2476   00B18                  ; mapped memory area (rmap=0) and page 0
    2781    2477   00B18                  ;
    2782    2478   00B18                  ;*******************************************************************************
    2783    2479   00B18                  
    2784    2480   00B18                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2785    2481   00B18                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2786    2482   00B18                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2787    2483   00B18                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2788    2484   00B18                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2789    2485   00B18                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2790    2486   00B18                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2791    2487   00B18                  nmisr         data   0bch          ;nmi status                        reset=000h
    2792    2488   00B18                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2793    2489   00B18                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2794    2490   00B18                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2795    2491   00B18                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2796    2492   00B18                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2797    2493   00B18                  
    2798    2494   00B18                  ;*******************************************************************************
    2799    2495   00B18                  ;
    2800    2496   00B18                  ; system control registers registers that can only be accessed in the non
    2801    2497   00B18                  ; mapped memory area (rmap=0) and page 1
    2802    2498   00B18                  ;
    2803    2499   00B18                  ;*******************************************************************************
    2804    2500   00B18                  
    2805    2501   00B18                  id            data   0b3h          ;identity register     reset=device dependent
    2806    2502   00B18                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2807    2503   00B18                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2808    2504   00B18                  osc_con       data   0b6h          ;osc control                       reset=008h
    2809    2505   00B18                  pll_con       data   0b7h          ;pll control                       reset=090h
    2810    2506   00B18                  cmcon         data   0bah          ;clock control                     reset=010h
    2811    2507   00B18                  passwd        data   0bbh          ;password register                 reset=007h
    2812    2508   00B18                  feal          data   0bch          ;flash error register              reset=000h
    2813    2509   00B18                  feah          data   0bdh          ;flash error address high          reset=000h
    2814    2510   00B18                  cocon         data   0beh          ;clock output control              reset=000h
    2815    2511   00B18                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2816    2512   00B18                  
    2817    2513   00B18                  ;*******************************************************************************
    2818    2514   00B18                  ;
    2819    2515   00B18                  ; system control registers registers that can only be accessed in the non
    2820    2516   00B18                  ; mapped memory area (rmap=0) and page 3
    2821    2517   00B18                  ;
    2822    2518   00B18                  ;*******************************************************************************
    2823    2519   00B18                  
    2824    2520   00B18                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2825    2521   00B18                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2826    2522   00B18                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2827    2523   00B18                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2828    2524   00B18                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2829    2525   00B18                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2830    2526   00B18                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2831    2527   00B18                  
    2832    2528   00B18                  ;*******************************************************************************
    2833    2529   00B18                  ;
    2834    2530   00B18                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2835    2531   00B18                  ;
    2836    2532   00B18                  ;*******************************************************************************
    2837    2533   00B18                  
    2838    2534   00B18                  port_page     data   0b2h          ;port page register                reset=000h
    2839    2535   00B18                  
    2840    2536   00B18                  ;*******************************************************************************
    2841    2537   00B18                  ;
    2842    2538   00B18                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2843    2539   00B18                  ;
    2844    2540   00B18                  ;*******************************************************************************
    2845    2541   00B18                  
    2846    2542   00B18                  p0_data       data   080h          ;port 0 data register              reset=000h
    2847    2543   00B18                  ;p0_data is bit addressable
    2848    2544   00B18                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2849    2545   00B18                  p1_data       data   090h          ;port 1 data register              reset=000h
    2850    2546   00B18                  ;p1_data is bit addressable
    2851    2547   00B18                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2852    2548   00B18                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2853    2549   00B18                  ;p2_data is bit addressable
    2854    2550   00B18                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2855    2551   00B18                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2856    2552   00B18                  ;p3_data is bit addressable
    2857    2553   00B18                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2858    2554   00B18                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2859    2555   00B18                  ;p4_data is bit addressable
    2860    2556   00B18                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2861    2557   00B18                  p5_data       data   092h          ;port 5 data register              reset=000h
    2862    2558   00B18                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2863    2559   00B18                  
    2864    2560   00B18                  ;*******************************************************************************
    2865    2561   00B18                  ;
    2866    2562   00B18                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2867    2563   00B18                  ;
    2868    2564   00B18                  ;*******************************************************************************
    2869    2565   00B18                  
    2870    2566   00B18                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2871    2567   00B18                  ;p0_data is bit addressable
    2872    2568   00B18                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2873    2569   00B18                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2874    2570   00B18                  ;p1_data is bit addressable
    2875    2571   00B18                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2876    2572   00B18                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2877    2573   00B18                  ;p2_data is bit addressable
    2878    2574   00B18                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2879    2575   00B18                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2880    2576   00B18                  ;p3_data is bit addressable
    2881    2577   00B18                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2882    2578   00B18                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2883    2579   00B18                  ;p4_data is bit addressable
    2884    2580   00B18                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2885    2581   00B18                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2886    2582   00B18                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2887    2583   00B18                  
    2888    2584   00B18                  ;*******************************************************************************
    2889    2585   00B18                  ;
    2890    2586   00B18                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2891    2587   00B18                  ;
    2892    2588   00B18                  ;*******************************************************************************
    2893    2589   00B18                  
    2894    2590   00B18                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2895    2591   00B18                  ;p0_data is bit addressable
    2896    2592   00B18                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2897    2593   00B18                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2898    2594   00B18                  ;p1_data is bit addressable
    2899    2595   00B18                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2900    2596   00B18                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2901    2597   00B18                  ;p3_data is bit addressable
    2902    2598   00B18                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2903    2599   00B18                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2904    2600   00B18                  ;p4_data is bit addressable
    2905    2601   00B18                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2906    2602   00B18                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2907    2603   00B18                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2908    2604   00B18                  
    2909    2605   00B18                  ;*******************************************************************************
    2910    2606   00B18                  ;
    2911    2607   00B18                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2912    2608   00B18                  ;
    2913    2609   00B18                  ;*******************************************************************************
    2914    2610   00B18                  
    2915    2611   00B18                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2916    2612   00B18                  ;p0_data is bit addressable
    2917    2613   00B18                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2918    2614   00B18                  ;p1_data is bit addressable
    2919    2615   00B18                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2920    2616   00B18                  ;p3_data is bit addressable
    2921    2617   00B18                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2922    2618   00B18                  ;p4_data is bit addressable
    2923    2619   00B18                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2924    2620   00B18                  
    2925    2621   00B18                  ;*******************************************************************************
    2926    2622   00B18                  ;
    2927    2623   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2928    2624   00B18                  ;
    2929    2625   00B18                  ;*******************************************************************************
    2930    2626   00B18                  
    2931    2627   00B18                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2932    2628   00B18                  
    2933    2629   00B18                  ;*******************************************************************************
    2934    2630   00B18                  ;
    2935    2631   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2936    2632   00B18                  ;
    2937    2633   00B18                  ;*******************************************************************************
    2938    2634   00B18                  
    2939    2635   00B18                  adc_globctr   data   0cah          ;global control register           reset=030h
    2940    2636   00B18                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2941    2637   00B18                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2942    2638   00B18                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2943    2639   00B18                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2944    2640   00B18                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2945    2641   00B18                  
    2946    2642   00B18                  ;*******************************************************************************
    2947    2643   00B18                  ;
    2948    2644   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2949    2645   00B18                  ;
    2950    2646   00B18                  ;*******************************************************************************
    2951    2647   00B18                  
    2952    2648   00B18                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2953    2649   00B18                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2954    2650   00B18                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2955    2651   00B18                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2956    2652   00B18                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2957    2653   00B18                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2958    2654   00B18                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2959    2655   00B18                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2960    2656   00B18                  
    2961    2657   00B18                  ;*******************************************************************************
    2962    2658   00B18                  ;
    2963    2659   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2964    2660   00B18                  ;
    2965    2661   00B18                  ;*******************************************************************************
    2966    2662   00B18                  
    2967    2663   00B18                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2968    2664   00B18                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2969    2665   00B18                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2970    2666   00B18                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2971    2667   00B18                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    2972    2668   00B18                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    2973    2669   00B18                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    2974    2670   00B18                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    2975    2671   00B18                  
    2976    2672   00B18                  ;*******************************************************************************
    2977    2673   00B18                  ;
    2978    2674   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    2979    2675   00B18                  ;
    2980    2676   00B18                  ;*******************************************************************************
    2981    2677   00B18                  
    2982    2678   00B18                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    2983    2679   00B18                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    2984    2680   00B18                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    2985    2681   00B18                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    2986    2682   00B18                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    2987    2683   00B18                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    2988    2684   00B18                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    2989    2685   00B18                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    2990    2686   00B18                  
    2991    2687   00B18                  ;*******************************************************************************
    2992    2688   00B18                  ;
    2993    2689   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    2994    2690   00B18                  ;
    2995    2691   00B18                  ;*******************************************************************************
    2996    2692   00B18                  
    2997    2693   00B18                  adc_rcr0      data   0cah          ;result control register           reset=000h
    2998    2694   00B18                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    2999    2695   00B18                  adc_rcr2      data   0cch          ;result control register           reset=000h
    3000    2696   00B18                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    3001    2697   00B18                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    3002    2698   00B18                  
    3003    2699   00B18                  ;*******************************************************************************
    3004    2700   00B18                  ;
    3005    2701   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    3006    2702   00B18                  ;
    3007    2703   00B18                  ;*******************************************************************************
    3008    2704   00B18                  
    3009    2705   00B18                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    3010    2706   00B18                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    3011    2707   00B18                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    3012    2708   00B18                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    3013    2709   00B18                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    3014    2710   00B18                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    3015    2711   00B18                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    3016    2712   00B18                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    3017    2713   00B18                  
    3018    2714   00B18                  ;*******************************************************************************
    3019    2715   00B18                  ;
    3020    2716   00B18                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    3021    2717   00B18                  ;
    3022    2718   00B18                  ;*******************************************************************************
    3023    2719   00B18                  
    3024    2720   00B18                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    3025    2721   00B18                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    3026    2722   00B18                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3027    2723   00B18                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3028    2724   00B18                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3029    2725   00B18                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3030    2726   00B18                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3031    2727   00B18                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3032    2728   00B18                  
    3033    2729   00B18                  ;*******************************************************************************
    3034    2730   00B18                  
    3035    2731   00B18                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3036    2732   00B18                  ;
    3037    2733   00B18                  ;*******************************************************************************
    3038    2734   00B18                  
    3039    2735   00B18                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3040    2736   00B18                  ;t2_t2con is bit addressable
    3041    2737   00B18                         tf2    bit    0c7h
    3042    2738   00B18                         exf2   bit    0c6h
    3043    2739   00B18                                                     ;2 bits are not implemented
    3044    2740   00B18                         exen2  bit    0c3h
    3045    2741   00B18                         tr2    bit    0c2h
    3046    2742   00B18                         ct2    bit    0c1h
    3047    2743   00B18                         cprl2  bit    0c0h
    3048    2744   00B18                  
    3049    2745   00B18                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3050    2746   00B18                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3051    2747   00B18                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3052    2748   00B18                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3053    2749   00B18                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3054    2750   00B18                  
    3055    2751   00B18                  ;*******************************************************************************
    3056    2752   00B18                  ;
    3057    2753   00B18                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3058    2754   00B18                  ;
    3059    2755   00B18                  ;*******************************************************************************
    3060    2756   00B18                  
    3061    2757   00B18                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3062    2758   00B18                  
    3063    2759   00B18                  ;*******************************************************************************
    3064    2760   00B18                  ;
    3065    2761   00B18                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3066    2762   00B18                  ;
    3067    2763   00B18                  ;*******************************************************************************
    3068    2764   00B18                  
    3069    2765   00B18                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3070    2766   00B18                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3071    2767   00B18                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3072    2768   00B18                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3073    2769   00B18                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3074    2770   00B18                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3075    2771   00B18                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3076    2772   00B18                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3077    2773   00B18                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3078    2774   00B18                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3079    2775   00B18                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3080    2776   00B18                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3081    2777   00B18                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3082    2778   00B18                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3083    2779   00B18                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3084    2780   00B18                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3085    2781   00B18                  
    3086    2782   00B18                  ;*******************************************************************************
    3087    2783   00B18                  ;
    3088    2784   00B18                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3089    2785   00B18                  ;
    3090    2786   00B18                  ;*******************************************************************************
    3091    2787   00B18                  
    3092    2788   00B18                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3093    2789   00B18                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3094    2790   00B18                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3095    2791   00B18                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3096    2792   00B18                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3097    2793   00B18                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3098    2794   00B18                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3099    2795   00B18                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3100    2796   00B18                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3101    2797   00B18                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3102    2798   00B18                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3103    2799   00B18                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3104    2800   00B18                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3105    2801   00B18                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3106    2802   00B18                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3107    2803   00B18                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3108    2804   00B18                  
    3109    2805   00B18                  ;*******************************************************************************
    3110    2806   00B18                  ;
    3111    2807   00B18                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3112    2808   00B18                  ;
    3113    2809   00B18                  ;*******************************************************************************
    3114    2810   00B18                  
    3115    2811   00B18                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3116    2812   00B18                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3117    2813   00B18                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3118    2814   00B18                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3119    2815   00B18                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3120    2816   00B18                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3121    2817   00B18                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3122    2818   00B18                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3123    2819   00B18                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3124    2820   00B18                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3125    2821   00B18                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3126    2822   00B18                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3127    2823   00B18                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3128    2824   00B18                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3129    2825   00B18                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3130    2826   00B18                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3131    2827   00B18                  
    3132    2828   00B18                  ;*******************************************************************************
    3133    2829   00B18                  ;
    3134    2830   00B18                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3135    2831   00B18                  ;
    3136    2832   00B18                  ;*******************************************************************************
    3137    2833   00B18                  
    3138    2834   00B18                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3139    2835   00B18                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3140    2836   00B18                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3141    2837   00B18                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3142    2838   00B18                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3143    2839   00B18                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3144    2840   00B18                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3145    2841   00B18                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3146    2842   00B18                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3147    2843   00B18                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3148    2844   00B18                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3149    2845   00B18                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3150    2846   00B18                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3151    2847   00B18                  
    3152    2848   00B18                  ;*******************************************************************************
    3153    2849   00B18                  ;
    3154    2850   00B18                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3155    2851   00B18                  ;
    3156    2852   00B18                  ;*******************************************************************************
    3157    2853   00B18                  
    3158    2854   00B18                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3159    2855   00B18                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3160    2856   00B18                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3161    2857   00B18                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3162    2858   00B18                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3163    2859   00B18                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3164    2860   00B18                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3165    2861   00B18                  
    3166    2862   00B18                  ;*******************************************************************************
    3167    2863   00B18                  ;
    3168    2864   00B18                  ; can registers can be accessed in the standard memory map (rmap=0)
    3169    2865   00B18                  ;
    3170    2866   00B18                  ;*******************************************************************************
    3171    2867   00B18                  
    3172    2868   00B18                  adcon         data   0d8h          ;adres/data control                reset=000h
    3173    2869   00B18                  ; adcon is bit addressable
    3174    2870   00B18                         v3     bit    0dfh
    3175    2871   00B18                         v2     bit    0deh
    3176    2872   00B18                         v1     bit    0ddh
    3177    2873   00B18                         v0     bit    0dch
    3178    2874   00B18                         auad1  bit    0dbh
    3179    2875   00B18                         auad0  bit    0dah
    3180    2876   00B18                         can_bsy bit   0d9h
    3181    2877   00B18                         rwen   bit    0d8h
    3182    2878   00B18                  
    3183    2879   00B18                  adl           data   0d9h          ;adres register low                reset=000h
    3184    2880   00B18                  adh           data   0dah          ;adres register low                reset=000h
    3185    2881   00B18                  data0         data   0dbh          ;can data                          reset=000h
    3186    2882   00B18                  data1         data   0dch          ;can data                          reset=000h
    3187    2883   00B18                  data2         data   0ddh          ;can data                          reset=000h
    3188    2884   00B18                  data3         data   0deh          ;can data                          reset=000h
    3189    2885   00B18                  
    3190    2886   00B18                  ;*******************************************************************************
    3191    2887   00B18                  ;
    3192    2888   00B18                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3193    2889   00B18                  ;
    3194    2890   00B18                  ;*******************************************************************************
    3195    2891   00B18                  
    3196    2892   00B18                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3197    2893   00B18                  ;mdustat is bit addressable
    3198    2894   00B18                                                     ;5 bits are not implemented
    3199    2895   00B18                         bsy    bit    0b2h
    3200    2896   00B18                         ierr   bit    0b1h
    3201    2897   00B18                         irdy   bit    0b0h
    3202    2898   00B18                  
    3203    2899   00B18                  mducon        data   0b1h          ;mdu control                       reset=000h
    3204    2900   00B18                  md0           data   0b2h          ;mdu operand register              reset=000h
    3205    2901   00B18                  mr0           data   0b2h          ;mdu result register               reset=000h
    3206    2902   00B18                  md1           data   0b3h          ;mdu operand register              reset=000h
    3207    2903   00B18                  mr1           data   0b3h          ;mdu result register               reset=000h
    3208    2904   00B18                  md2           data   0b4h          ;mdu operand register              reset=000h
    3209    2905   00B18                  mr2           data   0b4h          ;mdu result register               reset=000h
    3210    2906   00B18                  md3           data   0b5h          ;mdu operand register              reset=000h
    3211    2907   00B18                  mr3           data   0b5h          ;mdu result register               reset=000h
    3212    2908   00B18                  md4           data   0b6h          ;mdu operand register              reset=000h
    3213    2909   00B18                  mr4           data   0b6h          ;mdu result register               reset=000h
    3214    2910   00B18                  md5           data   0b7h          ;mdu operand register              reset=000h
    3215    2911   00B18                  mr5           data   0b7h          ;mdu result register               reset=000h
    3216    2912   00B18                  
    3217    2913   00B18                  ;*******************************************************************************
    3218    2914   00B18                  ;
    3219    2915   00B18                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3220    2916   00B18                  ;
    3221    2917   00B18                  ;*******************************************************************************
    3222    2918   00B18                  
    3223    2919   00B18                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3224    2920   00B18                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3225    2921   00B18                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3226    2922   00B18                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3227    2923   00B18                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3228    2924   00B18                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3229    2925   00B18                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3230    2926   00B18                  ;cd_statc is bit addressable
    3231    2927   00B18                         keepz  bit    0a7h
    3232    2928   00B18                         keepy  bit    0a6h
    3233    2929   00B18                         keepx  bit    0a5h
    3234    2930   00B18                         dmap   bit    0a4h
    3235    2931   00B18                         int_en bit    0a3h
    3236    2932   00B18                         eoc    bit    0a2h
    3237    2933   00B18                         error  bit    0a1h
    3238    2934   00B18                         cd_bsy bit    0a0h
    3239    2935   00B18                  
    3240    2936   00B18                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3241    2937   00B18                  
    3242    2938   00B18                  ;*******************************************************************************
    3243    2939   00B18                  ;
    3244    2940   00B18                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3245    2941   00B18                  ;
    3246    2942   00B18                  ;*******************************************************************************
    3247    2943   00B18                  
    3248    2944   00B18                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3249    2945   00B18                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3250    2946   00B18                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3251    2947   00B18                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3252    2948   00B18                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3253    2949   00B18                  
    3254    2950   00B18                  ;*******************************************************************************
    3255    2951   00B18                  ;
    3256    2952   00B18                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3257    2953   00B18                  ;
    3258    2954   00B18                  ;*******************************************************************************
    3259    2955   00B18                  
    3260    2956   00B18                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3261    2957   00B18                  ;t2_t2con is bit addressable bits are aalready defined
    3262    2958   00B18                         ;tf2    bit    0c7h
    3263    2959   00B18                         ;exf2   bit    0c6h
    3264    2960   00B18                                                     ;2 bits are not implemented
    3265    2961   00B18                         ;exen2  bit    0c3h
    3266    2962   00B18                         ;tr2    bit    0c2h
    3267    2963   00B18                         ;ct2    bit    0c1h
    3268    2964   00B18                         ;cprl2  bit    0c0h
    3269    2965   00B18                  
    3270    2966   00B18                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3271    2967   00B18                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3272    2968   00B18                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3273    2969   00B18                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3274    2970   00B18                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3275    2971   00B18                  
    3276    2972   00B18                  ;*******************************************************************************
    3277    2973   00B18                  ;
    3278    2974   00B18                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3279    2975   00B18                  ;
    3280    2976   00B18                  ;*******************************************************************************
    3281    2977   00B18                  
    3282    2978   00B18                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3283    2979   00B18                  ;s1con is bit addressable
    3284    2980   00B18                         sm01   bit    0cfh
    3285    2981   00B18                         sm11   bit    0ceh
    3286    2982   00B18                         sm21   bit    0cdh
    3287    2983   00B18                         ren1   bit    0cch
    3288    2984   00B18                         tb81   bit    0cbh
    3289    2985   00B18                         rb81   bit    0cah
    3290    2986   00B18                         ti1    bit    0c9h
    3291    2987   00B18                         ri1    bit    0c8h
    3292    2988   00B18                  
    3293    2989   00B18                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3294    2990   00B18                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3295    2991   00B18                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3296    2992   00B18                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3297    2993   00B18                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3298    2994   00B18                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3299    2995   00B18                  
    3300    2996   00B18                  ;*******************************************************************************
    3301    2997   00B18                  ;
    3302    2998   00B18                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3303    2999   00B18                  ;
    3304    3000   00B18                  ;*******************************************************************************
    3305    3001   00B18                  
    3306    3002   00B18                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3307    3003   00B18                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3308    3004   00B18                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3309    3005   00B18                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3310    3006   00B18                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3311    3007   00B18                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3312    3008   00B18                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3313    3009   00B18                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3314    3010   00B18                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3315    3011   00B18                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3316    3012   00B18                  
    3317    3013   00B18                  ;end directive must be used, but has no signification
    3318    3014   00B18                  
    3319    3015   00B18                  end
    3320    3016   00B18                  
    3321    3017   00B18                  
    3322    3018   00B18                  
    3323    3019   00B18                  
    3324    3020   00B18                  
    3325    3021   00B18                  
    3326    3022   00B18                  
    3327    3023   00B18                  
    3328    3024   00B18                  
    3329    3025   00B18                  
    3330    3026   00B18                  
    3331    3027   00B18                  
    3332    3028   00B18                  
    3333    3029   00B18                  
    3334    3030   00B18                  
    3335    3031   00B18                  
