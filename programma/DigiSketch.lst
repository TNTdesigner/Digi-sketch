C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  clrL    equ     15h                 ;register voor het legen van het het scherm
       2       2   00000                  clrH    equ     16h                 ;register voor het legen van het het scherm
       3       3   00000                  
       4       4   00000                  org 0000h
       5       5   00000 020003           ljmp   main
       6       6   00003                  
       7       7   00003                  ;------------------------------------------------------------------
       8       8   00003                  ;Hoofd programma
       9       9   00003                  ;------------------------------------------------------------------
      10      10   00003                  main:
      11      11   00003 75817F               mov     sp,#7fh                 ;stackpointer instellen
      12      12   00006 12004D               lcall   inits
      13      13   00009                  
      14      14   00009                      ;Mode set
      15      15   00009 751280               mov     COMANDREG,#10000000b
      16      16   0000C 120B9B               lcall   comandWrite
      17      17   0000F                      ;Display mode
      18      18   0000F 75129C               mov     COMANDREG,#10011100b
      19      19   00012 120B9B               lcall   comandWrite
      20      20   00015                  
      21      21   00015                      ;adres data pointer
      22      22   00015 751100               mov     DATAREG,#00h            ;lower address
      23      23   00018 120B4E               lcall   dataWrite
      24      24   0001B 751100               mov     DATAREG,#00h
      25      25   0001E 120B4E               lcall   dataWrite
      26      26   00021 751224               mov     COMANDREG,#24h
      27      27   00024 120B9B               lcall   comandWrite
      28      28   00027                      ;auto write mode
      29      29   00027 7512B0               mov     COMANDREG,#b0h
      30      30   0002A 120B9B               lcall   comandWrite
      31      31   0002D                  
      32      32   0002D                  lus0:
      33      33   0002D 90009F               mov     dptr,#startscherm       ;begin afbeelding in pointer steken
      34      34   00030                  lus:
      35      35   00030 E4                   clr     a
      36      36   00031 93                   movc    a,@a+dptr               ;get byte
      37      37   00032 B4AA03               cjne    a,#10101010b,next
      38      38   00035 020047               ljmp    stop
      39      39   00038                  next:
      40      40   00038 F511                 mov     DATAREG,a
      41      41   0003A 120B65               lcall   dataAutoWrite
      42      42   0003D A3                   inc     dptr
      43      43   0003E 020030               ljmp    lus
      44      44   00041                      ;data auto read af zetten
      45      45   00041 7512B2               mov     COMANDREG,#b2h
      46      46   00044 120B9B               lcall   comandWrite
      47      47   00047                  stop:
      48      48   00047 120BD7               lcall   readRotary
      49      49   0004A 020047               ljmp    stop
      50      50   0004D                  
      51      51   0004D                  
      52      52   0004D                  ;------------------------------------------------------------------
      53      53   0004D                  ;Initializatie van alle componenten nodig in het hoofd programma
      54      54   0004D                  ;------------------------------------------------------------------
      55      55   0004D                  inits:
      56      56   0004D 75B200               mov     port_page,#000h         ;selecteer poort page 0
      57      57   00050 120ACC               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      58      58   00053 120057               lcall   clearScreen
      59      59   00056 22               ret
      60      60   00057                  
      61      61   00057                  ;------------------------------------------------------------------
      62      62   00057                  ;Het scherm leeg maken
      63      63   00057                  ;------------------------------------------------------------------
      64      64   00057                  clearScreen:
      65      65   00057 C0E0                 push    acc
      66      66   00059 C0D0                 push    psw
      67      67   0005B 7515FF               mov     clrL,#ffh               ;255 keer doolopen
      68      68   0005E 75160F               mov     clrH,#0fh               ;16 keer doorlopen
      69      69   00061                      ;Mode set
      70      70   00061 751280               mov     COMANDREG,#10000000b    ;OR mode
      71      71   00064 120B9B               lcall   comandWrite
      72      72   00067                      ;Display mode
      73      73   00067 75129C               mov     COMANDREG,#10011100b    ;gafisch en tekst aan zetten
      74      74   0006A 120B9B               lcall   comandWrite
      75      75   0006D                      ;auto write mode
      76      76   0006D 7512B0               mov     COMANDREG,#b0h
      77      77   00070 120B9B               lcall   comandWrite
      78      78   00073                  lus2400:
      79      79   00073 751100               mov     DATAREG,#000h
      80      80   00076 120B65               lcall   dataAutoWrite
      81      81   00079 D515F7               djnz    clrL,lus2400
      82      82   0007C 7515FF               mov     clrL,#ffh
      83      83   0007F D516F1               djnz    clrH,lus2400
      84      84   00082                      ;data auto read af zetten
      85      85   00082 7512B2               mov     COMANDREG,#b2h
      86      86   00085 120B9B               lcall   comandWrite
      87      87   00088                  
      88      88   00088                      ;adres data pointer resetten
      89      89   00088 751100               mov     DATAREG,#00h            ;lower address
      90      90   0008B 120B4E               lcall   dataWrite
      91      91   0008E 751100               mov     DATAREG,#00h
      92      92   00091 120B4E               lcall   dataWrite
      93      93   00094 751224               mov     COMANDREG,#24h
      94      94   00097 120B9B               lcall   comandWrite
      95      95   0009A D0E0                 pop     acc
      96      96   0009C D0D0                 pop     psw
      97      97   0009E 22               ret
      98      98   0009F                  
      99      99   0009F                  
     100     100   0009F                  
     101     101   0009F                  
     102     102   0009F                  ;include filles
     104       1   0009F                  startscherm:
     105       2   0009F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     106       3   000C7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     107       4   000EF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     108       5   00117 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     109       6   0013F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     110       7   00167 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     111       8   0018F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     112       9   001B7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     113      10   001DF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     114      11   00207 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     115      12   0022F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     116      13   00257 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     117      14   0027F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     118      15   002A7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     119      16   002CF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     120      17   002F7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     121      18   0031F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     122      19   00347 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     123      20   0036F 0000000000000F3C db 000000b,000000b,000000b,000000b,000000b,000000b,001111b,111100b,000000b,000000b,000000b,000000b,011111b,110000b,000000b,000000b,000000b,000001b,110000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000001b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         000000001F300000
                         0001300000000000
                         0000000000010000
                         0000000000000000
     124      21   00397 00073F3F00001F3C db 000000b,000111b,111111b,111111b,000000b,000000b,011111b,111100b,000000b,000000b,000000b,000000b,111111b,111000b,000000b,000000b,000000b,011111b,111110b,000000b,011111b,111100b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000111b,000000b,000000b,000000b,000000b,000111b,111111b,100000b,000000b,000000b,000000b
                         000000003F380000
                         001F3E001F3C0000
                         0000000000070000
                         0000073F20000000
     125      22   003BF 00073F3938001F3E db 000000b,000111b,111111b,111001b,111000b,000000b,011111b,111110b,000000b,000000b,000000b,000000b,111111b,111000b,000000b,000000b,000001b,111110b,000011b,100000b,011111b,111100b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,011111b,000000b,000000b,000000b,000000b,000011b,111111b,100000b,000000b,000000b,000000b
                         000000003F380000
                         013E03201F3C0000
                         00000000001F0000
                         0000033F20000000
     126      23   003E7 00073F3006000F3C db 000000b,000111b,111111b,110000b,000110b,000000b,001111b,111100b,000000b,000000b,000000b,000000b,111111b,111000b,000000b,000000b,000011b,111110b,000000b,110000b,011111b,111100b,000000b,000000b,000000b,000000b,000000b,000000b,000011b,111111b,000000b,000000b,000000b,000000b,000011b,111111b,100000b,000000b,000000b,000000b
                         000000003F380000
                         033E00301F3C0000
                         00000000033F0000
                         0000033F20000000
     127      24   0040F 00073F3003000730 db 000000b,000111b,111111b,110000b,000011b,000000b,000111b,110000b,000000b,000000b,000000b,110000b,001111b,100000b,000000b,000000b,000111b,111110b,000000b,000000b,011111b,111100b,000000b,000000b,000000b,000000b,000000b,000000b,000111b,111111b,000000b,000000b,000000b,000000b,000011b,111111b,100000b,000000b,000000b,000000b
                         000000300F200000
                         073E00001F3C0000
                         00000000073F0000
                         0000033F20000000
     128      25   00437 00073F3001200000 db 000000b,000111b,111111b,110000b,000001b,100000b,000000b,000000b,000000b,000000b,000001b,100000b,000000b,000000b,000000b,000000b,001111b,111111b,000000b,000000b,011111b,111100b,000000b,000000b,000000b,000000b,000000b,000000b,000111b,111111b,000000b,000000b,000000b,000000b,000011b,111111b,100000b,000000b,000000b,000000b
                         0000012000000000
                         0F3F00001F3C0000
                         00000000073F0000
                         0000033F20000000
     129      26   0045F 00073F3000301F3C db 000000b,000111b,111111b,110000b,000000b,110000b,011111b,111100b,000000b,011111b,111111b,000000b,111111b,111000b,000000b,000000b,001111b,111111b,100000b,000000b,011111b,111100b,000000b,001110b,000000b,000111b,111110b,000000b,111111b,111111b,111100b,000001b,111111b,110000b,000011b,111111b,100001b,111111b,100000b,000000b
                         001F3F003F380000
                         0F3F20001F3C000E
                         00073E003F3F3C01
                         3F30033F213F2000
     130      27   00487 00073F3000101F3C db 000000b,000111b,111111b,110000b,000000b,010000b,011111b,111100b,000001b,111100b,011111b,000000b,111111b,111000b,000000b,000000b,001111b,111111b,110000b,000000b,011111b,111100b,000000b,111110b,000000b,001111b,000111b,100000b,000111b,111111b,000000b,000011b,111100b,001100b,000011b,111111b,100111b,111111b,110000b,000000b
                         013C1F003F380000
                         0F3F30001F3C003E
                         000F0720073F0003
                         3C0C033F273F3000
     131      28   004AF 00073F3000081F3C db 000000b,000111b,111111b,110000b,000000b,001000b,011111b,111100b,000011b,111100b,011111b,100000b,111111b,111000b,000000b,000000b,001111b,111111b,111000b,000000b,011111b,111100b,000001b,100000b,000000b,111110b,000011b,110000b,000111b,111111b,000000b,001111b,111000b,000111b,000011b,111111b,111100b,111111b,111000b,000000b
                         033C1F203F380000
                         0F3F38001F3C0120
                         003E0330073F000F
                         3807033F3C3F3800
     132      29   004D7 00073F3000081F3C db 000000b,000111b,111111b,110000b,000000b,001000b,011111b,111100b,000111b,111100b,011111b,110000b,111111b,111000b,000000b,000000b,001111b,111111b,111100b,000000b,011111b,111100b,000110b,000000b,000001b,111110b,000011b,111000b,000111b,111111b,000000b,001111b,111000b,000011b,000011b,111111b,110000b,111111b,111000b,000000b
                         073C1F303F380000
                         0F3F3C001F3C0600
                         013E0338073F000F
                         3803033F303F3800
     133      30   004FF 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,001111b,111100b,011111b,111000b,111111b,111000b,000000b,000000b,001111b,111111b,111100b,000000b,011111b,111100b,001110b,000000b,000001b,111110b,000011b,111100b,000111b,111111b,000000b,011111b,111000b,000001b,000011b,111111b,100000b,111111b,111100b,000000b
                         0F3C1F383F380000
                         0F3F3C001F3C0E00
                         013E033C073F001F
                         3801033F203F3C00
     134      31   00527 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,001111b,111100b,011111b,111000b,111111b,111000b,000000b,000000b,000111b,111111b,111110b,000000b,011111b,111100b,011111b,000000b,000011b,111110b,000011b,111100b,000111b,111111b,000000b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         0F3C1F383F380000
                         073F3E001F3C1F00
                         033E033C073F003F
                         3800033F201F3C00
     135      32   0054F 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,001111b,111100b,011111b,111000b,111111b,111000b,000000b,000000b,000111b,111111b,111111b,000000b,011111b,111100b,111111b,000000b,000111b,111110b,000011b,111110b,000111b,111111b,000000b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         0F3C1F383F380000
                         073F3F001F3C3F00
                         073E033E073F003F
                         3800033F201F3C00
     136      33   00577 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,001111b,111100b,011111b,111000b,111111b,111000b,000000b,000000b,000011b,111111b,111111b,100000b,011111b,111111b,111111b,100000b,000111b,111110b,000011b,111110b,000111b,111111b,000000b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         0F3C1F383F380000
                         033F3F201F3F3F20
                         073E033E073F003F
                         3800033F201F3C00
     137      34   0059F 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,001111b,111100b,011111b,111000b,111111b,111000b,000000b,000000b,000001b,111111b,111111b,110000b,011111b,111111b,111111b,100000b,000111b,111110b,000011b,111110b,000111b,111111b,000001b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         0F3C1F383F380000
                         013F3F301F3F3F20
                         073E033E073F013F
                         3800033F201F3C00
     138      35   005C7 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,001111b,111100b,011111b,110000b,111111b,111001b,111111b,111111b,000000b,111111b,111111b,110000b,011111b,111111b,111111b,110000b,000111b,111111b,001111b,111111b,000111b,111111b,000001b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         0F3C1F303F393F3F
                         003F3F301F3F3F30
                         073F0F3F073F013F
                         3800033F201F3C00
     139      36   005EF 00073F3000041F3C db 000000b,000111b,111111b,110000b,000000b,000100b,011111b,111100b,000111b,111100b,011111b,110000b,111111b,111000b,000000b,000000b,000000b,011111b,111111b,111000b,011111b,111101b,111111b,111000b,000111b,111111b,111111b,111110b,000111b,111111b,000001b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         073C1F303F380000
                         001F3F381F3D3F38
                         073F3F3E073F013F
                         3800033F201F3C00
     140      37   00617 00073F30000C1F3C db 000000b,000111b,111111b,110000b,000000b,001100b,011111b,111100b,000011b,111100b,011111b,100000b,111111b,111000b,000000b,000000b,000000b,011111b,111111b,111000b,011111b,111101b,111111b,111000b,000111b,111110b,000000b,000000b,000111b,111111b,000001b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         033C1F203F380000
                         001F3F381F3D3F38
                         073E0000073F013F
                         3800033F201F3C00
     141      38   0063F 00073F3000081F3C db 000000b,000111b,111111b,110000b,000000b,001000b,011111b,111100b,000011b,111100b,111110b,000000b,111111b,111000b,000000b,000000b,000000b,001111b,111111b,111000b,011111b,111100b,111111b,111100b,000111b,111110b,000000b,000000b,000111b,111111b,000000b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         033C3E003F380000
                         000F3F381F3C3F3C
                         073E0000073F003F
                         3800033F201F3C00
     142      39   00667 00073F3000181F3C db 000000b,000111b,111111b,110000b,000000b,011000b,011111b,111100b,000110b,001111b,111000b,000000b,111111b,111000b,000000b,000000b,000000b,000111b,111111b,111100b,011111b,111100b,011111b,111100b,000111b,111110b,000000b,000000b,000111b,111111b,000000b,111111b,111000b,000000b,000011b,111111b,100000b,011111b,111100b,000000b
                         060F38003F380000
                         00073F3C1F3C1F3C
                         073E0000073F003F
                         3800033F201F3C00
     143      40   0068F 00073F3000301F3C db 000000b,000111b,111111b,110000b,000000b,110000b,011111b,111100b,001110b,000000b,000000b,000000b,111111b,111000b,000000b,000000b,000000b,000011b,111111b,111000b,011111b,111100b,011111b,111110b,000011b,111110b,000000b,000110b,000111b,111111b,000010b,111111b,111000b,000000b,110011b,111111b,100000b,011111b,111100b,000000b
                         0E0000003F380000
                         00033F381F3C1F3E
                         033E0006073F023F
                         3800333F201F3C00
     144      41   006B7 00073F3000201F3C db 000000b,000111b,111111b,110000b,000000b,100000b,011111b,111100b,001111b,111111b,111111b,000000b,111111b,111000b,000000b,000000b,000000b,000001b,111111b,111000b,011111b,111100b,001111b,111111b,000011b,111110b,000000b,001110b,000111b,111111b,000010b,011111b,111000b,000001b,100011b,111111b,100000b,111111b,111100b,000000b
                         0F3F3F003F380000
                         00013F381F3C0F3F
                         033E000E073F021F
                         3801233F203F3C00
     145      42   006DF 00073F3003001F3C db 000000b,000111b,111111b,110000b,000011b,000000b,011111b,111100b,001111b,111111b,111111b,100000b,111111b,111000b,000000b,000000b,001000b,000000b,111111b,111000b,011111b,111100b,001111b,111111b,000001b,111110b,000000b,001100b,000111b,111111b,000110b,001111b,111000b,000011b,000011b,111111b,100000b,111111b,111100b,000000b
                         0F3F3F203F380000
                         08003F381F3C0F3F
                         013E000C073F060F
                         3803033F203F3C00
     146      43   00707 00073F3006001F3C db 000000b,000111b,111111b,110000b,000110b,000000b,011111b,111100b,001111b,111111b,111111b,100000b,111111b,111000b,000000b,000000b,001110b,000000b,111111b,110000b,011111b,111100b,000111b,111111b,100000b,111110b,000000b,111000b,000011b,111111b,101100b,001111b,111000b,000110b,000111b,111111b,100000b,111111b,111100b,000000b
                         0F3F3F203F380000
                         0E003F301F3C073F
                         203E0038033F2C0F
                         3806073F203F3C00
     147      44   0072F 00073F3038001F3E db 000000b,000111b,111111b,110000b,111000b,000000b,011111b,111110b,000111b,111111b,111111b,100000b,111111b,111000b,000000b,000000b,000011b,100000b,111111b,100000b,011111b,111100b,000111b,111111b,110000b,011111b,000011b,100000b,000001b,111111b,111000b,000011b,111000b,011100b,000111b,111111b,100000b,111111b,111100b,000000b
                         073F3F203F380000
                         03203F201F3C073F
                         301F0320013F3803
                         381C073F203F3C00
     148      45   00757 00073F3F20001F3E db 000000b,000111b,111111b,111111b,100000b,000000b,011111b,111110b,000011b,111111b,111111b,100000b,111111b,111000b,000000b,000000b,000000b,111111b,111110b,000000b,011111b,111100b,000011b,111111b,111000b,000111b,111110b,000000b,000000b,111111b,100000b,000001b,111111b,110000b,000111b,111111b,100000b,111111b,111100b,000000b
                         033F3F203F380000
                         003F3E001F3C033F
                         38073E00003F2001
                         3F30073F203F3C00
     149      46   0077F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000111b,000000b,000000b,000000b,000000b,000000b,000000b,000111b,100000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000070000000000
                         0007200000000000
                         0000000000000000
                         0000000000000000
     150      47   007A7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     151      48   007CF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     152      49   007F7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     153      50   0081F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     154      51   00847 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     155      52   0086F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     156      53   00897 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     157      54   008BF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     158      55   008E7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     159      56   0090F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     160      57   00937 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     161      58   0095F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     162      59   00987 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     163      60   009AF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     164      61   009D7 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     165      62   009FF 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     166      63   00A27 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     167      64   00A4F 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
     168      65   00A77 0000000000000000 db 000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,000000b,10101010b
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         0000000000000000
                         AA
project.inc 
     170       1   00AA0                  ;------------------------------------------------------------------
     171       2   00AA0                  ;Lijst van functies:
     172       3   00AA0                  ;   -statusCheck            Status check van scherm opslaan in STA register
     173       4   00AA0                  ;   -initGLCD               Initializatie van grafisch LCD scherm
     174       5   00AA0                  ;   -debug                  debug info op seriele poot zetten
     175       6   00AA0                  ;   -dataWrite              data naar het scherm sturen
     176       7   00AA0                  ;   -dataRead               data van het scherm lezen
     177       8   00AA0                  ;   -comandWrite            comanndo naar scherm sturen
     178       9   00AA0                  ;------------------------------------------------------------------
     179      10   00AA0                  ;------------------------------------------------------------------
     180      11   00AA0                  ;declaratie van pinnen
     181      12   00AA0                  ;------------------------------------------------------------------
     182      13   00AA0                      WR          bit     p3_data.0   ;write line van scherm actief laag
     183      14   00AA0                      RD          bit     p3_data.1   ;read line van scherrm actief laag
     184      15   00AA0                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
     185      16   00AA0                      CD          bit     p3_data.3   ;Command write
     186      17   00AA0                      RESET       bit     p0_data.1   ;reset van scherm actief laag
     187      18   00AA0                      FS          bit     p0_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
     188      19   00AA0                  
     189      20   00AA0                  ;------------------------------------------------------------------
     190      21   00AA0                  ;declaratie van registers
     191      22   00AA0                  ;------------------------------------------------------------------
     192      23   00AA0                      STA         equ     10h         ;geheugenplaats voor de status check
     193      24   00AA0                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
     194      25   00AA0                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
     195      26   00AA0                      ROTARY      equ     13h         ;geheugenplaats voor de momentele waarde van de encoders
     196      27   00AA0                  
     197      28   00AA0                  ;------------------------------------------------------------------
     198      29   00AA0                  ;Status check van scherm opslaan in STA register
     199      30   00AA0                  ;-STA
     200      31   00AA0                  ;------------------------------------------------------------------
     201      32   00AA0                  statusCheck:
     202      33   00AA0 C0E0                 push    acc
     203      34   00AA2 C0D0                 push    psw
     204      35   00AA4 C210                 clr     STA                     ;STA register leeg maken
     205      36   00AA6 75C900               mov     p4_dir,#000h            ;p4 als input zetten
     206      37   00AA9 D2B3                 setb    CD
     207      38   00AAB D2B0                 setb    WR
     208      39   00AAD                  stan:
     209      40   00AAD C2B1                 clr     RD
     210      41   00AAF E5C8                 mov     a,p4_data
     211      42   00AB1 D2B1                 setb    RD
     212      43   00AB3 D2B3                 setb    CD
     213      44   00AB5 F8                   mov     r0,a
     214      45   00AB6 120BB1               lcall   debug
     215      46   00AB9 F510                 mov     STA,a                   ;bijhouden voor eventueel gebruik
     216      47   00ABB 5403                 anl     a,#03h                  ;masker voor STA0 en STA1
     217      48   00ABD B403ED               cjne    a,#03h,stan
     218      49   00AC0 F8                   mov     r0,a
     219      50   00AC1 120BB1               lcall   debug
     220      51   00AC4 75C9FF               mov     p4_dir,#0ffh
     221      52   00AC7 D0D0                 pop     psw
     222      53   00AC9 D0E0                 pop     acc
     223      54   00ACB 22               ret
     224      55   00ACC                  
     225      56   00ACC                  ;------------------------------------------------------------------
     226      57   00ACC                  ;Initializatie van grafisch LCD scherm
     227      58   00ACC                  ;------------------------------------------------------------------
     228      59   00ACC                  initGLCD:
     229      60   00ACC 120FAD               lcall   initsio                 ;voor debug
     230      61   00ACF 7586FF               mov     p0_dir,#0ffh            ;poort 1 als output
     231      62   00AD2 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output
     232      63   00AD5 C2B2                 clr     CE                      ;standaart laag houden
     233      64   00AD7 D2B0                 setb    WR                      ;standaart hoog maken
     234      65   00AD9 D2B1                 setb    RD                      ;standaart hoog maken
     235      66   00ADB D280                 setb    FS                      ;font op 6*8 zetten
     236      67   00ADD C281                 clr     RESET                   ;reseten van scherm
     237      68   00ADF 120D8D               lcall   delay1ms
     238      69   00AE2 D281                 setb    RESET                   ;reset terug af zetten
     239      70   00AE4 120AA0               lcall   statusCheck             ;initiele status check uitvoeren
     240      71   00AE7                  
     241      72   00AE7                      ;Mode set
     242      73   00AE7 751280               mov     COMANDREG,#10000000b
     243      74   00AEA 120B9B               lcall   comandWrite
     244      75   00AED                  
     245      76   00AED                      ;Graphics home address
     246      77   00AED 751100               mov     DATAREG,#00h
     247      78   00AF0 120B4E               lcall   dataWrite
     248      79   00AF3 751100               mov     DATAREG,#00h
     249      80   00AF6 120B4E               lcall   dataWrite
     250      81   00AF9 751242               mov     COMANDREG,#42h
     251      82   00AFC 120B9B               lcall   comandWrite
     252      83   00AFF                  
     253      84   00AFF                      ;Graphics area set
     254      85   00AFF 751128               mov     DATAREG,#28h
     255      86   00B02 120B4E               lcall   dataWrite
     256      87   00B05 751100               mov     DATAREG,#00h
     257      88   00B08 120B4E               lcall   dataWrite
     258      89   00B0B 751243               mov     COMANDREG,#43h
     259      90   00B0E 120B9B               lcall   comandWrite
     260      91   00B11                  
     261      92   00B11                      ;text home address
     262      93   00B11 751100               mov     DATAREG,#00h
     263      94   00B14 120B4E               lcall   dataWrite
     264      95   00B17 75110A               mov     DATAREG,#0ah
     265      96   00B1A 120B4E               lcall   dataWrite
     266      97   00B1D 751240               mov     COMANDREG,#40h
     267      98   00B20 120B9B               lcall   comandWrite
     268      99   00B23                  
     269     100   00B23                      ;text area set
     270     101   00B23 751128               mov     DATAREG,#28h
     271     102   00B26 120B4E               lcall   dataWrite
     272     103   00B29 751100               mov     DATAREG,#00h
     273     104   00B2C 120B4E               lcall   dataWrite
     274     105   00B2F 751241               mov     COMANDREG,#41h
     275     106   00B32 120B9B               lcall   comandWrite
     276     107   00B35                  
     277     108   00B35                      ;adres data pointer
     278     109   00B35 751100               mov     DATAREG,#00h            ;lower address
     279     110   00B38 120B4E               lcall   dataWrite
     280     111   00B3B 751100               mov     DATAREG,#00h
     281     112   00B3E 120B4E               lcall   dataWrite
     282     113   00B41 751224               mov     COMANDREG,#24h
     283     114   00B44 120B9B               lcall   comandWrite
     284     115   00B47                  
     285     116   00B47                      ;Display mode
     286     117   00B47 751290               mov     COMANDREG,#10010000b
     287     118   00B4A 120B9B               lcall   comandWrite
     288     119   00B4D                  
     289     120   00B4D 22               ret
     290     121   00B4E                  
     291     122   00B4E                  ;------------------------------------------------------------------
     292     123   00B4E                  ;Data naar het schem sturen
     293     124   00B4E                  ;-DATAREG
     294     125   00B4E                  ;------------------------------------------------------------------
     295     126   00B4E                  DataWrite:
     296     127   00B4E C0E0                 push    acc
     297     128   00B50 C0D0                 push    psw
     298     129   00B52 120AA0               lcall   statusCheck             ;status checken
     299     130   00B55 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     300     131   00B58 C2B3                 clr     CD
     301     132   00B5A 00                   nop
     302     133   00B5B C2B0                 clr     WR
     303     134   00B5D 00                   nop
     304     135   00B5E D2B0                 setb    WR
     305     136   00B60 D0D0                 pop     psw
     306     137   00B62 D0E0                 pop     acc
     307     138   00B64 22               ret
     308     139   00B65                  
     309     140   00B65                  dataAutoWrite:
     310     141   00B65 C0E0                 push    acc
     311     142   00B67 C0D0                 push    psw
     312     143   00B69                  dataAutoWriteStatus:
     313     144   00B69 120AA0               lcall   statusCheck             ;status checken
     314     145   00B6C E510                 mov     a,STA
     315     146   00B6E 5404                 anl     a,#04h                ;sta 2 nakijken
     316     147   00B70 B404F6               cjne    a,#04h,dataAutoWriteStatus
     317     148   00B73 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     318     149   00B76 C2B3                 clr     CD
     319     150   00B78 00                   nop
     320     151   00B79 C2B0                 clr     WR
     321     152   00B7B 00                   nop
     322     153   00B7C D2B0                 setb    WR
     323     154   00B7E D0D0                 pop     psw
     324     155   00B80 D0E0                 pop     acc
     325     156   00B82 22               ret
     326     157   00B83                  
     327     158   00B83                  ;------------------------------------------------------------------
     328     159   00B83                  ;data van het scherm inlezen
     329     160   00B83                  ;-DATAREG
     330     161   00B83                  ;------------------------------------------------------------------
     331     162   00B83                  DataRead:
     332     163   00B83 C0E0                 push    acc
     333     164   00B85 C0D0                 push    psw
     334     165   00B87 120AA0               lcall   statusCheck             ;status checken
     335     166   00B8A 75C900               mov     p4_dir,#000h            ;p4 als ingang
     336     167   00B8D C2B3                 clr     CD
     337     168   00B8F C2B1                 clr     RD
     338     169   00B91 00                   nop                             ;wachten
     339     170   00B92 00                   nop
     340     171   00B93 85C811               mov     DATAREG,p4_data         ;data inlezeen van scherm
     341     172   00B96 D0D0                 pop     psw
     342     173   00B98 D0E0                 pop     acc
     343     174   00B9A 22               ret
     344     175   00B9B                  
     345     176   00B9B                  ;------------------------------------------------------------------
     346     177   00B9B                  ;comando naar het scherrm sturen
     347     178   00B9B                  ;-COMANDREG
     348     179   00B9B                  ;------------------------------------------------------------------
     349     180   00B9B                  ComandWrite:
     350     181   00B9B C0E0                 push    acc
     351     182   00B9D C0D0                 push    psw
     352     183   00B9F 120AA0               lcall   statusCheck             ;status checken
     353     184   00BA2 8512C8               mov     p4_data,COMANDREG       ;comando op de bus zetten
     354     185   00BA5 D2B3                 setb    CD
     355     186   00BA7 C2B0                 clr     WR
     356     187   00BA9 00                   nop
     357     188   00BAA D2B0                 setb    WR
     358     189   00BAC D0D0                 pop     psw
     359     190   00BAE D0E0                 pop     acc
     360     191   00BB0 22               ret
     361     192   00BB1                  
     362     193   00BB1                  ;------------------------------------------------------------------
     363     194   00BB1                  ;debug info op seriele poort zetten
     364     195   00BB1                  ;-r0
     365     196   00BB1                  ;------------------------------------------------------------------
     366     197   00BB1                  debug:
     367     198   00BB1 C0E0                 push    acc
     368     199   00BB3 C0D0                 push    psw
     369     200   00BB5 740D                 mov     a,#0dh
     370     201   00BB7 120FE5               lcall   siooutchar
     371     202   00BBA E8                   mov     a,r0
     372     203   00BBB 121001               lcall   siooutbyte
     373     204   00BBE 740A                 mov     a,#0ah
     374     205   00BC0 120FE5               lcall   siooutchar
     375     206   00BC3 D0D0                 pop     psw
     376     207   00BC5 D0E0                 pop     acc
     377     208   00BC7 22               ret
     378     209   00BC8                  
     379     210   00BC8                  initRotary:
     380     211   00BC8 C0E0                 push    acc
     381     212   00BCA C0D0                 push    psw
     382     213   00BCC 75A100               mov     p2_dir,#000h            ;poort 2 als input zetten
     383     214   00BCF 85A013               mov     ROTARY,p2_data          ;de waarde van de encoders bewaren
     384     215   00BD2 D0D0                 pop     psw
     385     216   00BD4 D0D0                 pop     psw
     386     217   00BD6 22               ret
     387     218   00BD7                  
     388     219   00BD7                  ;------------------------------------------------------------------
     389     220   00BD7                  ;lees de encoders in
     390     221   00BD7                  ;------------------------------------------------------------------
     391     222   00BD7                  readRotary:
     392     223   00BD7 C0E0                 push    acc
     393     224   00BD9 C0D0                 push    psw
     394     225   00BDB E513                 mov     a,ROTARY
     395     226   00BDD B5A003               cjne    a,p2_data,nietGelijk
     396     227   00BE0 020BEB               ljmp    gelijk
     397     228   00BE3                  nietGelijk:
     398     229   00BE3 85A013               mov     ROTARY,p2_data
     399     230   00BE6 A813                 mov     r0,ROTARY
     400     231   00BE8 120BB1               lcall   debug
     401     232   00BEB                  gelijk:
     402     233   00BEB D0D0                 pop     psw
     403     234   00BED D0E0                 pop     acc
     404     235   00BEF 22               ret
     405     236   00BF0                  
     406     237   00BF0                  ;------------------------------------------------------------------
     407     238   00BF0                  ;laat start menu zien
     408     239   00BF0                  ;------------------------------------------------------------------
     409     240   00BF0                  StartMenu:
     410     241   00BF0 C0E0                 push    acc
     411     242   00BF2 C0D0                 push    psw
     412     243   00BF4                  
     413     244   00BF4 D0D0                 pop     psw
     414     245   00BF6 D0E0                 pop     acc
     415     246   00BF8 22               ret
     416     247   00BF9                  
     417     248   00BF9                  
     418     249   00BF9                  
     419     250   00BF9                  
     420     251   00BF9                  
     421     252   00BF9                  
xcez1.inc 
     423       1   00BF9                  ;*******************************************************************************
     424       2   00BF9                  ;
     425       3   00BF9                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     426       4   00BF9                  ;
     427       5   00BF9                  ; The file contains drivers for various hardware and math applications.
     428       6   00BF9                  ; In addition all register declarations are added.
     429       7   00BF9                  ;
     430       8   00BF9                  ; WARNING:!!!!!!!
     431       9   00BF9                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     432      10   00BF9                  ;
     433      11   00BF9                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     434      12   00BF9                  ;
     435      13   00BF9                  ;*******************************************************************************
     436      14   00BF9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     437      15   00BF9                  ;
     438      16   00BF9                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     439      17   00BF9                  ;
     440      18   00BF9                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     441      19   00BF9                  ; eenvoudige manier te gebruiken:
     442      20   00BF9                  ;
     443      21   00BF9                  ; standaard I/O:
     444      22   00BF9                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     445      23   00BF9                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     446      24   00BF9                  ;      initleds             klaar zetten LED's als outputs
     447      25   00BF9                  ;
     448      26   00BF9                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     449      27   00BF9                  ;      initiic              klaar zetten iic interface
     450      28   00BF9                  ;      iicstart             genereren van een startconditie op iic poort
     451      29   00BF9                  ;      iicstop              genereren stop conditie op iic poort
     452      30   00BF9                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     453      31   00BF9                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     454      32   00BF9                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     455      33   00BF9                  ;
     456      34   00BF9                  ; LCD interace
     457      35   00BF9                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     458      36   00BF9                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     459      37   00BF9                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     460      38   00BF9                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     461      39   00BF9                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     462      40   00BF9                  ;      lcdlighton           backlight aan
     463      41   00BF9                  ;      lcdlightoff          backlight uit
     464      42   00BF9                  ;      lcdbuzon             buzzer aan
     465      43   00BF9                  ;      lcdbuzof             buzzer uit
     466      44   00BF9                  ;
     467      45   00BF9                  ; Serile interface (via USB stekker!!)
     468      46   00BF9                  ;      initsio              klaar zetten serile poort 9600 baud
     469      47   00BF9                  ;      siooutchar           afdrukken ascii code (accu=input)
     470      48   00BF9                  ;      siooutbyte           afdrkken getal in accu
     471      49   00BF9                  ;      siooutnib            afdrukken 4 laagste bits accu
     472      50   00BF9                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     473      51   00BF9                  ;      sioinchar            inlezen van 1 ascii code in de accu
     474      52   00BF9                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     475      53   00BF9                  ;
     476      54   00BF9                  ; ADC
     477      55   00BF9                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     478      56   00BF9                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     479      57   00BF9                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     480      58   00BF9                  ;
     481      59   00BF9                  ; Arithmetic:
     482      60   00BF9                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     483      61   00BF9                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     484      62   00BF9                  ;      div16                delen 2 16 bit getallen
     485      63   00BF9                  ;      div32                delen 2 32 bit getallen
     486      64   00BF9                  ;      add16                optellen 2 16 bit getallen
     487      65   00BF9                  ;      add32                optellen 2 32 bit getallen
     488      66   00BF9                  ;      sub16                verschil 2 16 bit getallen
     489      67   00BF9                  ;      sub32                verschil 2 32 bit getallen
     490      68   00BF9                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     491      69   00BF9                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     492      70   00BF9                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     493      71   00BF9                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     494      72   00BF9                  ;
     495      73   00BF9                  ; Diverse
     496      74   00BF9                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     497      75   00BF9                  ;      delay1ms             tijdsverraging 1 milliseconde
     498      76   00BF9                  ;      delay10us            tijdsvertraging 10 microseconde
     499      77   00BF9                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     500      78   00BF9                  ;	mapregs 		selecteer de SFR's in de mapped area
     501      79   00BF9                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     502      80   00BF9                  ;
     503      81   00BF9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     504      82   00BF9                  ; LET OP!!!!
     505      83   00BF9                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     506      84   00BF9                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     507      85   00BF9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     508      86   00BF9                  ;
     509      87   00BF9                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     510      88   00BF9                  ;
     511      89   00BF9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     512      90   00BF9                  
     513      91   00BF9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     514      92   00BF9                  ;
     515      93   00BF9                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     516      94   00BF9                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     517      95   00BF9                  ; massa zonder extra weerstanden.
     518      96   00BF9                  ;
     519      97   00BF9                  ; Gebruikt geen registers
     520      98   00BF9                  ;
     521      99   00BF9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     522     100   00BF9                  
     523     101   00BF9 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     524     102   00BFB 758F04                         mov    syscon0,#004h
     525     103   00BFE C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     526     104   00C00 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     527     105   00C03 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     528     106   00C06 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     529     107   00C09 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     530     108   00C0C 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     531     109   00C0F D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     532     110   00C11 D08F                           pop    syscon0              ;pagina terug herstellen
     533     111   00C13 22                             ret
     534     112   00C14                  
     535     113   00C14                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     536     114   00C14                  ;
     537     115   00C14                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     538     116   00C14                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     539     117   00C14                  ; 2 behouden hun originele instelling.
     540     118   00C14                  ;
     541     119   00C14                  ; Gebruikt geen registers
     542     120   00C14                  ;
     543     121   00C14                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     544     122   00C14                  
     545     123   00C14 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     546     124   00C16 758F04                         mov    syscon0,#004h
     547     125   00C19 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     548     126   00C1B 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     549     127   00C1E 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     550     128   00C21 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     551     129   00C24 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     552     130   00C27 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     553     131   00C2A D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     554     132   00C2C D08F                           pop    syscon0              ;pagina terug herstellen
     555     133   00C2E 22                             ret
     556     134   00C2F                  
     557     135   00C2F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     558     136   00C2F                  ;
     559     137   00C2F                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     560     138   00C2F                  ; worden gedoofd (actief laag om ze te laden branden).
     561     139   00C2F                  ;
     562     140   00C2F                  ; Gebruikt geen registers
     563     141   00C2F                  ;
     564     142   00C2F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     565     143   00C2F                  
     566     144   00C2F                  
     567     145   00C2F C08F             initleds:     push   syscon0              ;juiste map selecteren
     568     146   00C31 758F04                         mov    syscon0,#004h
     569     147   00C34 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     570     148   00C36 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     571     149   00C39 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     572     150   00C3C D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     573     151   00C3E D08F                           pop    syscon0              ;pagina terug herstellen
     574     152   00C40 22                             ret
     575     153   00C41                  
     576     154   00C41                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     577     155   00C41                  ;
     578     156   00C41                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     579     157   00C41                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     580     158   00C41                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     581     159   00C41                  ; sda wordt als input geschakeld
     582     160   00C41                  ;
     583     161   00C41                  ; LET OP!!
     584     162   00C41                  ; Dit is een IIC bus met beperkte mogelijkheden:
     585     163   00C41                  ; -vaste communicatiesnleheid van 100kbit/s
     586     164   00C41                  ; -enkel master mode
     587     165   00C41                  ; -enkel 7 bit adressering
     588     166   00C41                  ; -geen klok stretching
     589     167   00C41                  ;
     590     168   00C41                  ; Gebruikt geen registers
     591     169   00C41                  ;
     592     170   00C41                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     593     171   00C41                  
     594     172   00C41                  sda           bit    p0_data.7            ;pin gebruikt als sda
     595     173   00C41                  scl           bit    p0_data.3            ;pin gebruikt als scl
     596     174   00C41                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     597     175   00C41                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     598     176   00C41                  
     599     177   00C41 C08F             initiic:      push   syscon0              ;juiste map selecteren
     600     178   00C43 758F04                         mov    syscon0,#004h
     601     179   00C46 C0B2                           push   port_page
     602     180   00C48 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     603     181   00C4B D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     604     182   00C4D D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     605     183   00C4F 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     606     184   00C52 D283                           setb   scl                  ;klok werkt als od
     607     185   00C54 D287                           setb   sda                  ;sda werkt als od
     608     186   00C56 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     609     187   00C59 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     610     188   00C5C 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     611     189   00C5F D0B2                           pop    port_page            ;pagina herstellen
     612     190   00C61 D08F                           pop    syscon0              ;map herstellen
     613     191   00C63 22                             ret
     614     192   00C64                  
     615     193   00C64                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     616     194   00C64                  ;
     617     195   00C64                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     618     196   00C64                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     619     197   00C64                  ; te garanderen volgt er een delay van 10us
     620     198   00C64                  ;
     621     199   00C64                  ; Gebruikt geen registers
     622     200   00C64                  ;
     623     201   00C64                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     624     202   00C64                  
     625     203   00C64 C08F             iicstart:     push   syscon0              ;map bewaren
     626     204   00C66 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     627     205   00C69 C0B2                           push   port_page            ;pagina bewaren
     628     206   00C6B 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     629     207   00C6E D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     630     208   00C70 D287                           setb   sda                  ;idem
     631     209   00C72 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     632     210   00C75 120D65                         lcall  delay10us            ;
     633     211   00C78 C287                           clr    sda                  ;data laag
     634     212   00C7A 120D65                         lcall  delay10us
     635     213   00C7D C283                           clr    scl                  ;dan klok laag
     636     214   00C7F 120D65                         lcall  delay10us            ;bit lang genoeg maken
     637     215   00C82 D0B2                           pop    port_page            ;registers herstellen
     638     216   00C84 D08F                           pop    syscon0
     639     217   00C86 22                             ret
     640     218   00C87                  
     641     219   00C87                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     642     220   00C87                  ;
     643     221   00C87                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     644     222   00C87                  ;
     645     223   00C87                  ; Gebruikt geen registers
     646     224   00C87                  ;
     647     225   00C87                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     648     226   00C87                  
     649     227   00C87 C08F             iicstop:      push   syscon0              ;map bewaren
     650     228   00C89 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     651     229   00C8C C0B2                           push   port_page            ;pagina bewaren
     652     230   00C8E 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     653     231   00C91 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     654     232   00C94 C287                           clr    sda                  ;data naar omlaag
     655     233   00C96 120D65                         lcall  delay10us
     656     234   00C99 D283                           setb   scl                  ;klok naar 1
     657     235   00C9B 120D65                         lcall  delay10us            ;wachten
     658     236   00C9E D287                           setb   sda                  ;idem data
     659     237   00CA0 120D65                         lcall  delay10us            ;
     660     238   00CA3 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     661     239   00CA6 D0B2                           pop    port_page            ;registers herstellen
     662     240   00CA8 D08F                           pop    syscon0
     663     241   00CAA 22                             ret
     664     242   00CAB                  
     665     243   00CAB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     666     244   00CAB                  ;
     667     245   00CAB                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     668     246   00CAB                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     669     247   00CAB                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     670     248   00CAB                  ;
     671     249   00CAB                  ; Gebruikt:
     672     250   00CAB                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     673     251   00CAB                  ;      cy=ack bit vanuit de slave
     674     252   00CAB                  ;
     675     253   00CAB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     676     254   00CAB                  
     677     255   00CAB C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     678     256   00CAD C0F0                           push   b                    ;gebruikt als loopcounter
     679     257   00CAF C08F                           push   syscon0              ;map juist zetten
     680     258   00CB1 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     681     259   00CB4 C0B2                           push   port_page            ;poort pagina bewaren
     682     260   00CB6 75B200                         mov    port_page,#000h      ;basispagina selecteren
     683     261   00CB9 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     684     262   00CBC 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     685     263   00CBF 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     686     264   00CC0 9287                           mov    sda,c                ;op pin
     687     265   00CC2 120D65                         lcall  delay10us            ;wachten
     688     266   00CC5 D283                           setb   scl                  ;puls genereren
     689     267   00CC7 120D65                         lcall  delay10us            ;ook hier wat tijd laten
     690     268   00CCA C283                           clr    scl                  ;klok terug laag maken
     691     269   00CCC D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     692     270   00CCF                  
     693     271   00CCF                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     694     272   00CCF                  
     695     273   00CCF 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     696     274   00CD2 120D65                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     697     275   00CD5 D283                           setb   scl                  ;puls terug hoog
     698     276   00CD7 A287                           mov    c,sda                ;inlezen en naar carry
     699     277   00CD9 120D65                         lcall  delay10us
     700     278   00CDC C283                           clr    scl                  ;klok blijft laag achter
     701     279   00CDE D0B2                           pop    port_page
     702     280   00CE0 D08F                           pop    syscon0
     703     281   00CE2 D0F0                           pop    b
     704     282   00CE4 D0E0                           pop    acc
     705     283   00CE6 22                             ret
     706     284   00CE7                  
     707     285   00CE7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     708     286   00CE7                  ;
     709     287   00CE7                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     710     288   00CE7                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     711     289   00CE7                  ;
     712     290   00CE7                  ; Gebruikt:
     713     291   00CE7                  ;      -de accu als output
     714     292   00CE7                  ;
     715     293   00CE7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     716     294   00CE7                  
     717     295   00CE7 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     718     296   00CE9 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     719     297   00CEC C0B2                           push   port_page            ;pagina bewaren
     720     298   00CEE 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     721     299   00CF1 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     722     300   00CF3 C0D0                           push   psw                  ;vlaggen bewaren
     723     301   00CF5 75F008                         mov    b,#008h              ;loopcounter laden
     724     302   00CF8 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     725     303   00CFB 120D65           iicinbyteack1:lcall  delay10us
     726     304   00CFE D283                           setb   scl                  ;klok hoog
     727     305   00D00 A287                           mov    c,sda                ;pin inlezen
     728     306   00D02 33                             rlc    a                    ;in accu shiften
     729     307   00D03 120D65                         lcall  delay10us
     730     308   00D06 C283                           clr    scl                  ;klok terug laag
     731     309   00D08 D5F0F0                         djnz   b,iicinbyteack1
     732     310   00D0B 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     733     311   00D0E C287                           clr    sda                  ;ack genereren
     734     312   00D10 120D65                         lcall  delay10us
     735     313   00D13 D283                           setb   scl
     736     314   00D15 120D65                         lcall  delay10us
     737     315   00D18 C283                           clr    scl
     738     316   00D1A 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     739     317   00D1D D0D0                           pop    psw                  ;registers herstellen
     740     318   00D1F D0F0                           pop    b
     741     319   00D21 D0B2                           pop    port_page
     742     320   00D23 D08F                           pop    syscon0
     743     321   00D25 22                             ret
     744     322   00D26                  
     745     323   00D26                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     746     324   00D26                  ;
     747     325   00D26                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     748     326   00D26                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     749     327   00D26                  ;
     750     328   00D26                  ; Gebruikt:
     751     329   00D26                  ;      -de accu als output
     752     330   00D26                  ;
     753     331   00D26                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     754     332   00D26                  
     755     333   00D26 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     756     334   00D28 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     757     335   00D2B C0B2                           push   port_page            ;pagina bewaren
     758     336   00D2D 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     759     337   00D30 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     760     338   00D32 C0D0                           push   psw                  ;vlaggen bewaren
     761     339   00D34 75F008                         mov    b,#008h              ;loopcounter laden
     762     340   00D37 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     763     341   00D3A 120D65           iicinbytenack1:lcall  delay10us
     764     342   00D3D D283                           setb   scl                  ;klok hoog
     765     343   00D3F A287                           mov    c,sda                ;pin inlezen
     766     344   00D41 33                             rlc    a                    ;in accu shiften
     767     345   00D42 120D65                         lcall  delay10us
     768     346   00D45 C283                           clr    scl                  ;klok terug laag
     769     347   00D47 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     770     348   00D4A 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     771     349   00D4D D287                           setb   sda                  ;nack genereren
     772     350   00D4F 120D65                         lcall  delay10us
     773     351   00D52 D283                           setb   scl
     774     352   00D54 120D65                         lcall  delay10us
     775     353   00D57 C283                           clr    scl
     776     354   00D59 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     777     355   00D5C D0D0                           pop    psw                  ;registers herstellen
     778     356   00D5E D0F0                           pop    b
     779     357   00D60 D0B2                           pop    port_page
     780     358   00D62 D08F                           pop    syscon0
     781     359   00D64 22                             ret
     782     360   00D65                  
     783     361   00D65                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     784     362   00D65                  ;
     785     363   00D65                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     786     364   00D65                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     787     365   00D65                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     788     366   00D65                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     789     367   00D65                  ;
     790     368   00D65                  ; Gebruikt geen registers
     791     369   00D65                  ;
     792     370   00D65                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     793     371   00D65                  
     794     372   00D65 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     795     373   00D67 C0D0                           push   psw                  ;8*42ns=330ns
     796     374   00D69 75E01A                         mov    acc,#01ah            ;420ns
     797     375   00D6C D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     798     376   00D6F D0D0                           pop    psw                  ;8*42ns=330ns
     799     377   00D71 D0E0                           pop    acc                  ;8*42ns=330ns
     800     378   00D73 22                             ret                         ;165ns
     801     379   00D74                  
     802     380   00D74                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     803     381   00D74                  ;
     804     382   00D74                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     805     383   00D74                  ;
     806     384   00D74                  ; Gebruikt geen registers
     807     385   00D74                  ;
     808     386   00D74                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     809     387   00D74                  
     810     388   00D74 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     811     389   00D76 C0D0                           push   psw
     812     390   00D78 C0F0                           push   b
     813     391   00D7A 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     814     392   00D7D 120D8D           delaya0k05s1: lcall  delay1ms
     815     393   00D80 D5F0FA                         djnz   b,delaya0k05s1
     816     394   00D83 D5E0F4                         djnz   acc,delaya0k05s2
     817     395   00D86 D0F0                           pop    b                    ;registers herstellen
     818     396   00D88 D0D0                           pop    psw
     819     397   00D8A D0E0                           pop    acc
     820     398   00D8C 22                             ret
     821     399   00D8D                  
     822     400   00D8D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     823     401   00D8D                  ;
     824     402   00D8D                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     825     403   00D8D                  ;
     826     404   00D8D                  ; Gebruikt geen registers
     827     405   00D8D                  ;
     828     406   00D8D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     829     407   00D8D                  
     830     408   00D8D C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     831     409   00D8F C0D0                           push   psw                  ;8*42ns=330ns
     832     410   00D91 75E064                         mov    acc,#100             ;420ns
     833     411   00D94 120D65           delay1ms1:    lcall  delay10us            ;10us
     834     412   00D97 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     835     413   00D9A D0D0                           pop    psw                  ;8*42ns=330ns
     836     414   00D9C D0E0                           pop    acc                  ;8*42ns=330ns
     837     415   00D9E 22                             ret                         ;165ns
     838     416   00D9F                  
     839     417   00D9F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     840     418   00D9F                  ;
     841     419   00D9F                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     842     420   00D9F                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     843     421   00D9F                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     844     422   00D9F                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     845     423   00D9F                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     846     424   00D9F                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     847     425   00D9F                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     848     426   00D9F                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     849     427   00D9F                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     850     428   00D9F                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     851     429   00D9F                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     852     430   00D9F                  ; systemen!!!!
     853     431   00D9F                  ;
     854     432   00D9F                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     855     433   00D9F                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     856     434   00D9F                  ;       aduclcd0.inc
     857     435   00D9F                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     858     436   00D9F                  ;       aduclcd1.inc
     859     437   00D9F                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     860     438   00D9F                  ;
     861     439   00D9F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     862     440   00D9F                  
     863     441   00D9F                  e             bit    b.1                  ;enable
     864     442   00D9F                  rs            bit    b.0                  ;register select
     865     443   00D9F                  backlight     bit    b.6                  ;bit waar backlight op zit
     866     444   00D9F                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     867     445   00D9F                  
     868     446   00D9F                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     869     447   00D9F                  
     870     448   00D9F                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     871     449   00D9F                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     872     450   00D9F                  
     873     451   00D9F                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     874     452   00D9F                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     875     453   00D9F                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     876     454   00D9F                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     877     455   00D9F                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     878     456   00D9F                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     879     457   00D9F                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     880     458   00D9F                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     881     459   00D9F                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     882     460   00D9F                  
     883     461   00D9F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     884     462   00D9F                  ;
     885     463   00D9F                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     886     464   00D9F                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     887     465   00D9F                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     888     466   00D9F                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     889     467   00D9F                  ;
     890     468   00D9F                  ; registergebruik: geen
     891     469   00D9F                  ;
     892     470   00D9F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     893     471   00D9F                  
     894     472   00D9F C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     895     473   00DA1 C0D0                           push   psw
     896     474   00DA3 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     897     475   00DA5 120C41                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     898     476   00DA8 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     899     477   00DAB                                                            ;buzzer en baklight worden nu op 1 gezet
     900     478   00DAB 120F43                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     901     479   00DAE 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     902     480   00DB0 120F3C           initlcd1:     lcall  delay2ms
     903     481   00DB3 D5E0FA                         djnz   acc,initlcd1
     904     482   00DB6 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     905     483   00DB8 120EFB                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     906     484   00DBB 120F3C                         lcall  delay2ms      ;te krijgen.
     907     485   00DBE 7430                           mov    a,#00110000b
     908     486   00DC0 120EFB                         lcall  outhnibc
     909     487   00DC3 120F3C                         lcall  delay2ms
     910     488   00DC6 7430                           mov    a,#00110000b
     911     489   00DC8 120EFB                         lcall  outhnibc
     912     490   00DCB 120F3C                         lcall  delay2ms
     913     491   00DCE 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     914     492   00DD0 120EFB                         lcall  outhnibc      ;hoge nibble naar het controleregister
     915     493   00DD3 120F3C                         lcall  delay2ms      ;niet nodig volgens datasheet
     916     494   00DD6 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     917     495   00DD8 120EE5                         lcall  outc          ;naar display
     918     496   00DDB 120F3C                         lcall  delay2ms      ;is iets te lang volgens datasheet
     919     497   00DDE 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     920     498   00DE0 120EE5                         lcall  outc
     921     499   00DE3 120F3C                         lcall  delay2ms      ;ook deze delay is iets te lang
     922     500   00DE6 7401                           mov    a,#displayon  ;clear display and home cursor
     923     501   00DE8 120EE5                         lcall  outc
     924     502   00DEB 120F3C                         lcall  delay2ms      ;deze wachttijd is bijna juist
     925     503   00DEE 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     926     504   00DF0 120EE5                         lcall  outc
     927     505   00DF3 120F3C                         lcall  delay2ms      ;wachten weer veel te lang
     928     506   00DF6 D0F0                           pop    b             ;registers terug in orde zetten
     929     507   00DF8 D0D0                           pop    psw
     930     508   00DFA D0E0                           pop    acc
     931     509   00DFC 22                             ret                  ;einde van de initialisatie
     932     510   00DFD                  
     933     511   00DFD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     934     512   00DFD                  ;
     935     513   00DFD                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     936     514   00DFD                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     937     515   00DFD                  ;      00dh   =cursor in de home positie
     938     516   00DFD                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     939     517   00DFD                  ;      00ah   =cursor op tweede lijn plaatsen
     940     518   00DFD                  ;      001h   =cursor on blink
     941     519   00DFD                  ;      002h   =cursor on, no blink
     942     520   00DFD                  ;      003h   =cursor off
     943     521   00DFD                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     944     522   00DFD                  ;
     945     523   00DFD                  ; de routine gebruikt geen registers
     946     524   00DFD                  ;
     947     525   00DFD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     948     526   00DFD                  
     949     527   00DFD                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     950     528   00DFD                  ; dan mag de data direct naar het dataregister van het scherm.
     951     529   00DFD                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     952     530   00DFD                  
     953     531   00DFD                  lcdoutchar:
     954     532   00DFD C0E0             outcharlcd:   push   acc           ;registers op stack
     955     533   00DFF C0D0                           push   psw
     956     534   00E01 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     957     535   00E04 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     958     536   00E06 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     959     537   00E09 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     960     538   00E0B                  
     961     539   00E0B                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     962     540   00E0B                  ; Het is dus een opdracht die we moeten uitvoeren.
     963     541   00E0B                  
     964     542   00E0B B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     965     543   00E0E 7401                           mov    a,#cleardisp         ;scherm leegmaken
     966     544   00E10 120EE5                         lcall  outc                 ;naar controleregister
     967     545   00E13 803A                           sjmp   outcharlcde          ;afsluiten
     968     546   00E15                  
     969     547   00E15 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     970     548   00E18 740F                           mov    a,#cursoronb         ;cursoron met blink
     971     549   00E1A 120EE5                         lcall  outc
     972     550   00E1D 8030                           sjmp   outcharlcde
     973     551   00E1F                  
     974     552   00E1F B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     975     553   00E22 740E                           mov    a,#cursoronn         ;cursoron no blink
     976     554   00E24 120EE5                         lcall  outc
     977     555   00E27 8026                           sjmp   outcharlcde
     978     556   00E29                  
     979     557   00E29 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     980     558   00E2C 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     981     559   00E2E 120EE5                         lcall  outc
     982     560   00E31 801C                           sjmp   outcharlcde
     983     561   00E33                  
     984     562   00E33 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     985     563   00E36 7402                           mov    a,#cursathom         ;cursor in home positie
     986     564   00E38 120EE5                         lcall  outc
     987     565   00E3B 8012                           sjmp   outcharlcde
     988     566   00E3D                  
     989     567   00E3D B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     990     568   00E40                                                            ;tweede lijn
     991     569   00E40 74C0                           mov    a,#0c0h
     992     570   00E42 120EE5                         lcall  outc
     993     571   00E45 8008                           sjmp   outcharlcde
     994     572   00E47                  
     995     573   00E47                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     996     574   00E47                  ; is. dit mag naar het data register.
     997     575   00E47                  
     998     576   00E47 120EAB           outcharlcd8:  lcall  outd          ;klaar
     999     577   00E4A 8003                           sjmp   outcharlcde   ;einde routine
    1000     578   00E4C                  
    1001     579   00E4C                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
    1002     580   00E4C                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
    1003     581   00E4C                  ; te schrijven.
    1004     582   00E4C                  
    1005     583   00E4C 120EE5           outcharlcd9:  lcall  outc          ;klaar
    1006     584   00E4F D0D0             outcharlcde:  pop    psw           ;registers herstellen
    1007     585   00E51 D0E0                           pop    acc
    1008     586   00E53 22                             ret
    1009     587   00E54                  
    1010     588   00E54                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1011     589   00E54                  ;
    1012     590   00E54                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
    1013     591   00E54                  ; op het lcd scherm.
    1014     592   00E54                  ;
    1015     593   00E54                  ; de routine gebruikt geen registers
    1016     594   00E54                  ;
    1017     595   00E54                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1018     596   00E54                  
    1019     597   00E54                  lcdoutnib:
    1020     598   00E54 C0E0             outniblcd:    push   acc           ;registers op stack zetten
    1021     599   00E56 C0D0                           push   psw
    1022     600   00E58 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
    1023     601   00E5A 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
    1024     602   00E5C B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
    1025     603   00E5F 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
    1026     604   00E61 2407                           add    a,#007h       ;omvormen naar hoofdletter
    1027     605   00E63 120EAB           outniblcde:   lcall  outd          ;naar het scherm
    1028     606   00E66 D0D0                           pop    psw
    1029     607   00E68 D0E0                           pop    acc
    1030     608   00E6A 22                             ret
    1031     609   00E6B                  
    1032     610   00E6B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1033     611   00E6B                  ;
    1034     612   00E6B                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
    1035     613   00E6B                  ;
    1036     614   00E6B                  ; de routine gebruikt geen registers
    1037     615   00E6B                  ;
    1038     616   00E6B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1039     617   00E6B                  
    1040     618   00E6B                  lcdoutbyte:
    1041     619   00E6B C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
    1042     620   00E6D C0D0                           push   psw
    1043     621   00E6F C4                             swap   a             ;bitjes omruilen
    1044     622   00E70 120E54                         lcall  outniblcd
    1045     623   00E73 C4                             swap   a             ;nog eens
    1046     624   00E74 120E54                         lcall  outniblcd
    1047     625   00E77 D0D0                           pop    psw
    1048     626   00E79 D0E0                           pop    acc
    1049     627   00E7B 22                             ret
    1050     628   00E7C                  
    1051     629   00E7C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1052     630   00E7C                  ;
    1053     631   00E7C                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
    1054     632   00E7C                  ;
    1055     633   00E7C                  ; de routine gebruikt geen registers
    1056     634   00E7C                  ;
    1057     635   00E7C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1058     636   00E7C                  
    1059     637   00E7C                  lcddispdptr:
    1060     638   00E7C C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
    1061     639   00E7E C0D0                           push   psw
    1062     640   00E80 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
    1063     641   00E82 120E6B                         lcall  outbytelcd
    1064     642   00E85 E582                           mov    a,dpl         ;dan het lage deel
    1065     643   00E87 120E6B                         lcall  outbytelcd
    1066     644   00E8A D0D0                           pop    psw
    1067     645   00E8C D0E0                           pop    acc
    1068     646   00E8E 22                             ret
    1069     647   00E8F                  
    1070     648   00E8F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1071     649   00E8F                  ;
    1072     650   00E8F                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
    1073     651   00E8F                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
    1074     652   00E8F                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
    1075     653   00E8F                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
    1076     654   00E8F                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
    1077     655   00E8F                  ;
    1078     656   00E8F                  ; de routine gebruikt geen registers
    1079     657   00E8F                  ;
    1080     658   00E8F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1081     659   00E8F                  
    1082     660   00E8F                  lcdoutmsga:
    1083     661   00E8F C0E0             outmsgalcd:   push   acc           ;registers op de stack
    1084     662   00E91 C0D0                           push   psw
    1085     663   00E93 C083                           push   dph           ;ook de data pointer
    1086     664   00E95 C082                           push   dpl
    1087     665   00E97                  
    1088     666   00E97                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
    1089     667   00E97                  
    1090     668   00E97 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
    1091     669   00E98 93                             movc   a,@a+dptr     ;waarde lezen
    1092     670   00E99 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
    1093     671   00E9B                  
    1094     672   00E9B                  ; de code is niet 0 dus versturen met outchar
    1095     673   00E9B                  
    1096     674   00E9B 120DFD                         lcall  outcharlcd    ;weg er mee
    1097     675   00E9E A3                             inc    dptr          ;naar volgende ascii code wijzen
    1098     676   00E9F 020E97                         ljmp   outmsgalcd1   ;lus sluiten
    1099     677   00EA2                  
    1100     678   00EA2 D082             outmsgalcde:  pop    dpl           ;registers herstellen
    1101     679   00EA4 D083                           pop    dph
    1102     680   00EA6 D0D0                           pop    psw
    1103     681   00EA8 D0E0                           pop    acc
    1104     682   00EAA 22                             ret
    1105     683   00EAB                  
    1106     684   00EAB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1107     685   00EAB                  ;
    1108     686   00EAB                  ; outd is een routine die naar het data register van het display een
    1109     687   00EAB                  ; volledige byte stuurt.
    1110     688   00EAB                  ;
    1111     689   00EAB                  ; De routine gebruikt geen registers.
    1112     690   00EAB                  ;
    1113     691   00EAB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1114     692   00EAB                  
    1115     693   00EAB C0E0             outd:         push   acc           ;registers op stack zetten
    1116     694   00EAD C0D0                           push   psw
    1117     695   00EAF 120EBB                         lcall  outhnibd      ;hoogste vier bits verzenden
    1118     696   00EB2 C4                             swap   a             ;bitjes omruilen
    1119     697   00EB3 120EBB                         lcall  outhnibd      ;naar het scherm sturen
    1120     698   00EB6 D0D0                           pop    psw           ;registers terug herstellen
    1121     699   00EB8 D0E0                           pop    acc
    1122     700   00EBA 22                             ret
    1123     701   00EBB                  
    1124     702   00EBB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1125     703   00EBB                  ;
    1126     704   00EBB                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
    1127     705   00EBB                  ; lcd scherm.
    1128     706   00EBB                  ;
    1129     707   00EBB                  ; de routine gebruikt geen registers.
    1130     708   00EBB                  ;
    1131     709   00EBB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1132     710   00EBB                  
    1133     711   00EBB C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
    1134     712   00EBD C0D0                           push   psw
    1135     713   00EBF C0F0                           push   b             ;werkregister
    1136     714   00EC1 120F5C                         lcall  lcdtoport     ;lees de expander naar b register
    1137     715   00EC4 D2F0                           setb   rs            ;controle lijn in orde
    1138     716   00EC6 C2F1                           clr    e             ;deselectie display
    1139     717   00EC8 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1140     718   00ECA 03                             rr     a             ;bits op juiste plaats zetten
    1141     719   00ECB 03                             rr     a             ;voor b reg
    1142     720   00ECC 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1143     721   00ECF 42F0                           orl    b,a           ;bij elkaar voegen
    1144     722   00ED1 120F43                         lcall  porttolcd     ;naar expnder
    1145     723   00ED4 D2F1                           setb   e             ;display enabelen
    1146     724   00ED6 120F43                         lcall  porttolcd
    1147     725   00ED9 C2F1                           clr    e             ;display deselecteren
    1148     726   00EDB 120F43                         lcall  porttolcd
    1149     727   00EDE D0F0                           pop    b
    1150     728   00EE0 D0D0                           pop    psw           ;registers herstellen
    1151     729   00EE2 D0E0                           pop    acc
    1152     730   00EE4 22                             ret
    1153     731   00EE5                  
    1154     732   00EE5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1155     733   00EE5                  ;
    1156     734   00EE5                  ; outc is een routine die naar het controleregister van het display een
    1157     735   00EE5                  ; volledige byte stuurt.
    1158     736   00EE5                  ;
    1159     737   00EE5                  ; De routine gebruikt geen registers.
    1160     738   00EE5                  ;
    1161     739   00EE5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1162     740   00EE5                  
    1163     741   00EE5 C0E0             outc:         push   acc           ;registers op stack zetten
    1164     742   00EE7 C0D0                           push   psw
    1165     743   00EE9 120EFB                         lcall  outhnibc      ;hoogste vier bits verzenden
    1166     744   00EEC 120F3C                         lcall  delay2ms      ;niet echt nodig
    1167     745   00EEF C4                             swap   a             ;bitjes omruilen
    1168     746   00EF0 120EFB                         lcall  outhnibc      ;naar het scherm sturen
    1169     747   00EF3 120F3C                         lcall  delay2ms      ;altijd goed voor traagste commando
    1170     748   00EF6 D0D0                           pop    psw           ;registers terug herstellen
    1171     749   00EF8 D0E0                           pop    acc
    1172     750   00EFA 22                             ret
    1173     751   00EFB                  
    1174     752   00EFB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1175     753   00EFB                  ;
    1176     754   00EFB                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1177     755   00EFB                  ; lcd scherm.
    1178     756   00EFB                  ;
    1179     757   00EFB                  ; de routine gebruikt geen registers.
    1180     758   00EFB                  ;
    1181     759   00EFB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1182     760   00EFB                  
    1183     761   00EFB C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1184     762   00EFD C0D0                           push   psw
    1185     763   00EFF C0F0                           push   b             ;werkregister
    1186     764   00F01 120F5C                         lcall  lcdtoport     ;lees de expander naar b register
    1187     765   00F04 C2F0                           clr    rs            ;controle lijn in orde
    1188     766   00F06 C2F1                           clr    e             ;deselectie display
    1189     767   00F08 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1190     768   00F0A 03                             rr     a             ;bits op juiste plaats zetten
    1191     769   00F0B 03                             rr     a             ;voor b reg
    1192     770   00F0C 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1193     771   00F0F 42F0                           orl    b,a           ;bij elkaar voegen
    1194     772   00F11 120F43                         lcall  porttolcd     ;naar expnder
    1195     773   00F14 D2F1                           setb   e             ;display enabelen
    1196     774   00F16 120F43                         lcall  porttolcd
    1197     775   00F19 C2F1                           clr    e             ;display deselecteren
    1198     776   00F1B 120F43                         lcall  porttolcd
    1199     777   00F1E D0F0                           pop    b
    1200     778   00F20 D0D0                           pop    psw           ;registers herstellen
    1201     779   00F22 D0E0                           pop    acc
    1202     780   00F24 22                             ret
    1203     781   00F25                  
    1204     782   00F25                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1205     783   00F25                  ;
    1206     784   00F25                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1207     785   00F25                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1208     786   00F25                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1209     787   00F25                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1210     788   00F25                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1211     789   00F25                  ; DATA GESCHREVEN.
    1212     790   00F25                  ;
    1213     791   00F25                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1214     792   00F25                  
    1215     793   00F25 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1216     794   00F27 120EE5           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1217     795   00F2A 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1218     796   00F2C 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1219     797   00F2D 120EAB                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1220     798   00F30 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1221     799   00F33 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1222     800   00F34 80F4                           SJMP   BUILD3
    1223     801   00F36 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1224     802   00F38 120EE5                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1225     803   00F3B 22                             RET                  ;EINDE VAN DE ROUTINE
    1226     804   00F3C                  
    1227     805   00F3C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1228     806   00F3C                  ;
    1229     807   00F3C                  ; Delay2ms is een vertragingsroutine van 2ms.
    1230     808   00F3C                  ;
    1231     809   00F3C                  ; De routine gebruikt geen registers.
    1232     810   00F3C                  ;
    1233     811   00F3C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1234     812   00F3C                  
    1235     813   00F3C 120D8D           delay2ms:     lcall  delay1ms
    1236     814   00F3F 120D8D                         lcall  delay1ms
    1237     815   00F42 22                             ret
    1238     816   00F43                  
    1239     817   00F43                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1240     818   00F43                  ;
    1241     819   00F43                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1242     820   00F43                  ; scherm stuurt via de port expander.
    1243     821   00F43                  ;
    1244     822   00F43                  ; Gebruikt geen registers
    1245     823   00F43                  ;
    1246     824   00F43                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1247     825   00F43                  
    1248     826   00F43 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1249     827   00F45 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1250     828   00F47 120C64                         lcall  iicstart      ;vertrokken
    1251     829   00F4A 7440                           mov    a,#01000000b  ;schrijven naar expander
    1252     830   00F4C 120CAB                         lcall  iicoutbyte    ;weg er mee
    1253     831   00F4F E5F0                           mov    a,b           ;data verzenden
    1254     832   00F51 120CAB                         lcall  iicoutbyte
    1255     833   00F54 120C87                         lcall  iicstop       ;transactie sluiten
    1256     834   00F57 D0D0                           pop    psw
    1257     835   00F59 D0E0                           pop    acc
    1258     836   00F5B 22                             ret
    1259     837   00F5C                  
    1260     838   00F5C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1261     839   00F5C                  ;
    1262     840   00F5C                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1263     841   00F5C                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1264     842   00F5C                  ; van buzzet en backlight is.
    1265     843   00F5C                  ;
    1266     844   00F5C                  ; Gebruikt b register
    1267     845   00F5C                  ;
    1268     846   00F5C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1269     847   00F5C                  
    1270     848   00F5C C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1271     849   00F5E C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1272     850   00F60 120C64                         lcall  iicstart      ;vertrokken
    1273     851   00F63 7441                           mov    a,#01000001b  ;lezen van expander
    1274     852   00F65 120CAB                         lcall  iicoutbyte    ;weg er mee
    1275     853   00F68 120D26                         lcall  iicinbytenack ;data inlezen
    1276     854   00F6B 120C87                         lcall  iicstop
    1277     855   00F6E F5F0                           mov    b,a
    1278     856   00F70 D0D0                           pop    psw
    1279     857   00F72 D0E0                           pop    acc
    1280     858   00F74 22                             ret
    1281     859   00F75                  
    1282     860   00F75                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1283     861   00F75                  ;
    1284     862   00F75                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1285     863   00F75                  ;
    1286     864   00F75                  ; Gebruikt geen registers
    1287     865   00F75                  ;
    1288     866   00F75                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1289     867   00F75                  
    1290     868   00F75 C0F0             lcdlighton:   push   b
    1291     869   00F77 120F5C                         lcall  lcdtoport     ;expander lezen
    1292     870   00F7A C2F6                           clr    b.6           ;licht aan doen
    1293     871   00F7C 120F43                         lcall  porttolcd     ;expander scrijven
    1294     872   00F7F D0F0                           pop    b
    1295     873   00F81 22                             ret
    1296     874   00F82                  
    1297     875   00F82                  
    1298     876   00F82                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1299     877   00F82                  ;
    1300     878   00F82                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1301     879   00F82                  ;
    1302     880   00F82                  ; Gebruikt geen registers
    1303     881   00F82                  ;
    1304     882   00F82                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1305     883   00F82                  
    1306     884   00F82 C0F0             lcdlightoff:  push   b
    1307     885   00F84 120F5C                         lcall  lcdtoport     ;expander lezen
    1308     886   00F87 D2F6                           setb   b.6           ;licht uit doen
    1309     887   00F89 120F43                         lcall  porttolcd     ;expander scrijven
    1310     888   00F8C D0F0                           pop    b
    1311     889   00F8E 22                             ret
    1312     890   00F8F                  
    1313     891   00F8F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1314     892   00F8F                  ;
    1315     893   00F8F                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1316     894   00F8F                  ;
    1317     895   00F8F                  ; Gebruikt geen registers
    1318     896   00F8F                  ;
    1319     897   00F8F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1320     898   00F8F                  
    1321     899   00F8F C0F0             lcdbuzon:     push   b
    1322     900   00F91 120F5C                         lcall  lcdtoport     ;expander lezen
    1323     901   00F94 C2F7                           clr    b.7           ;buzzer aan doen
    1324     902   00F96 120F43                         lcall  porttolcd     ;expander scrijven
    1325     903   00F99 D0F0                           pop    b
    1326     904   00F9B 22                             ret
    1327     905   00F9C                  
    1328     906   00F9C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1329     907   00F9C                  ;
    1330     908   00F9C                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1331     909   00F9C                  ;
    1332     910   00F9C                  ; Gebruikt geen registers
    1333     911   00F9C                  ;
    1334     912   00F9C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1335     913   00F9C                  
    1336     914   00F9C C0F0             lcdbuzoff:    push   b
    1337     915   00F9E 120F5C                         lcall  lcdtoport     ;expander lezen
    1338     916   00FA1 D2F7                           setb   b.7           ;buzzer aan doen
    1339     917   00FA3 120F43                         lcall  porttolcd     ;expander scrijven
    1340     918   00FA6 D0F0                           pop    b
    1341     919   00FA8 22                             ret
    1342     920   00FA9                  
    1343     921   00FA9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1344     922   00FA9                  ;
    1345     923   00FA9                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1346     924   00FA9                  ; een standaard com poort op 9600 baud.
    1347     925   00FA9                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1348     926   00FA9                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1349     927   00FA9                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1350     928   00FA9                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1351     929   00FA9                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1352     930   00FA9                  ; NIET door deze routine.
    1353     931   00FA9                  ;
    1354     932   00FA9                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1355     933   00FA9                  ;
    1356     934   00FA9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1357     935   00FA9                  
    1358     936   00FA9                  blank         equ    020h          ;ascii code voor een blank
    1359     937   00FA9                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1360     938   00FA9                  ff            equ    00ch          ;ascii code voor nieuw blad
    1361     939   00FA9                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1362     940   00FA9                  lf            equ    00ah          ;ascii code voor volgende lijn
    1363     941   00FA9                  backsp        equ    008h          ;ascii code voor het bs karakter
    1364     942   00FA9                  beep          equ    007h          ;ascii code voor een beep
    1365     943   00FA9                  
    1366     944   00FA9 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1367     945   00FAD                                                                          ;van het scherm
    1368     946   00FAD                  
    1369     947   00FAD                  strtbuf       equ     054h         ;start adres van de buffer
    1370     948   00FAD                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1371     949   00FAD                  
    1372     950   00FAD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1373     951   00FAD                  ;
    1374     952   00FAD                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1375     953   00FAD                  ;
    1376     954   00FAD                  ; Gebruikt geen registers
    1377     955   00FAD                  ;
    1378     956   00FAD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1379     957   00FAD                  
    1380     958   00FAD C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1381     959   00FAF C08F                           push   syscon0              ;map bewaren
    1382     960   00FB1 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1383     961   00FB4 C0B2                           push   port_page            ;pagina op stack zetten
    1384     962   00FB6 C0BF                           push   scu_page
    1385     963   00FB8 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1386     964   00FBB                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1387     965   00FBB                  ;      -p1.0 als input en alt1 selectie
    1388     966   00FBB                  ;      -p1.1 als output en alt2 selectie
    1389     967   00FBB                  
    1390     968   00FBB 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1391     969   00FBE 5390FD                         anl    p1_altsel0,#11111101b
    1392     970   00FC1 439001                         orl    p1_altsel0,#00000001b
    1393     971   00FC4 5391FE                         anl    p1_altsel1,#11111110b
    1394     972   00FC7 439102                         orl    p1_altsel1,#00000010b
    1395     973   00FCA 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1396     974   00FCD 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1397     975   00FD0 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1398     976   00FD3                  
    1399     977   00FD3                  ; Nu moet de baud rate generator ingesteld worden
    1400     978   00FD3                  ; We gaan er van uit dat de systeemklok 24MHz is
    1401     979   00FD3                  
    1402     980   00FD3 759850                         mov    scon,#01010000b      ;UART initialiseren
    1403     981   00FD6                  
    1404     982   00FD6                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1405     983   00FD6                  ; gebruikt!!
    1406     984   00FD6                  
    1407     985   00FD6 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1408     986   00FD9 75BD11                         mov    bcon,#00010001b
    1409     987   00FDC D0BF                           pop    scu_page
    1410     988   00FDE D0B2                           pop    port_page            ;alles terug herstellen
    1411     989   00FE0 D08F                           pop    syscon0
    1412     990   00FE2 D0E0                           pop    acc
    1413     991   00FE4 22                             ret
    1414     992   00FE5                  
    1415     993   00FE5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1416     994   00FE5                  ;
    1417     995   00FE5                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1418     996   00FE5                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1419     997   00FE5                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1420     998   00FE5                  ;
    1421     999   00FE5                  ; de routine gebruikt geen registers.
    1422    1000   00FE5                  ;
    1423    1001   00FE5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1424    1002   00FE5                  
    1425    1003   00FE5                  siooutchar:
    1426    1004   00FE5 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1427    1005   00FE7 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1428    1006   00FEA C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1429    1007   00FEC 22                             RET
    1430    1008   00FED                  
    1431    1009   00FED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1432    1010   00FED                  ;
    1433    1011   00FED                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1434    1012   00FED                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1435    1013   00FED                  ;
    1436    1014   00FED                  ; de routine gebruikt geen registers.
    1437    1015   00FED                  ;
    1438    1016   00FED                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1439    1017   00FED                  
    1440    1018   00FED                  siooutnib:
    1441    1019   00FED C0E0             OUTNIB:       push   acc           ;registers op de stack
    1442    1020   00FEF C0D0                           push   psw
    1443    1021   00FF1 540F                           ANL    A,#00FH       ;AFZONDEREN
    1444    1022   00FF3 1210DD                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1445    1023   00FF6 120FE5                         LCALL  OUTCHAR       ;VERSTUREN
    1446    1024   00FF9 121046                         LCALL  XONXOFF       ;FLOW CONTROL
    1447    1025   00FFC D0D0                           pop    psw           ;registers herstellen
    1448    1026   00FFE D0E0                           pop    acc
    1449    1027   01000 22                             RET
    1450    1028   01001                  
    1451    1029   01001                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1452    1030   01001                  ;
    1453    1031   01001                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1454    1032   01001                  ; WORDT XONXOFF GEBRUIKT.
    1455    1033   01001                  ;
    1456    1034   01001                  ; de routine gebruikt geen registers.
    1457    1035   01001                  ;
    1458    1036   01001                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1459    1037   01001                  
    1460    1038   01001                  siooutbyte:
    1461    1039   01001 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1462    1040   01003 C0D0                           push   psw
    1463    1041   01005 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1464    1042   01007 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1465    1043   01008 120FED                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1466    1044   0100B D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1467    1045   0100D 120FED                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1468    1046   01010 D0D0                           pop    psw           ;registers herstellen
    1469    1047   01012 D0E0                           pop    acc
    1470    1048   01014 22                             RET
    1471    1049   01015                  
    1472    1050   01015                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1473    1051   01015                  ;
    1474    1052   01015                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1475    1053   01015                  ; VAN DE CURSOR.
    1476    1054   01015                  ;
    1477    1055   01015                  ; de routine gebruikt geen registers.
    1478    1056   01015                  ;
    1479    1057   01015                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1480    1058   01015                  
    1481    1059   01015                  siodispdptr:
    1482    1060   01015 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1483    1061   01017 C0D0                           push   psw
    1484    1062   01019 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1485    1063   0101B 121001                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1486    1064   0101E E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1487    1065   01020 121001                         LCALL  OUTBYTE       ;WEG ER MEE
    1488    1066   01023 D0D0                           pop    psw           ;registers herstellen
    1489    1067   01025 D0E0                           pop    acc
    1490    1068   01027 22                             RET                  ;EINDE
    1491    1069   01028                  
    1492    1070   01028                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1493    1071   01028                  ;
    1494    1072   01028                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1495    1073   01028                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1496    1074   01028                  ;
    1497    1075   01028                  ; de routine gebruikt geen registers.
    1498    1076   01028                  ;
    1499    1077   01028                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1500    1078   01028                  
    1501    1079   01028                  siooutmsga:
    1502    1080   01028 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1503    1081   0102A C0D0                           push   psw
    1504    1082   0102C C082                           push   dpl
    1505    1083   0102E C083                           push   dph
    1506    1084   01030 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1507    1085   01031 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1508    1086   01032 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1509    1087   01034 120FE5                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1510    1088   01037 121046                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1511    1089   0103A A3                             INC    DPTR          ;DPTR AANPASSEN
    1512    1090   0103B 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1513    1091   0103D D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1514    1092   0103F D082                           pop    dpl
    1515    1093   01041 D0D0                           pop    psw
    1516    1094   01043 D0E0                           pop    acc
    1517    1095   01045 22                             RET                  ;EINDE ROUTINE
    1518    1096   01046                  
    1519    1097   01046                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1520    1098   01046                  ;
    1521    1099   01046                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1522    1100   01046                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1523    1101   01046                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1524    1102   01046                  ; VERDER DOORGEGEVEN.
    1525    1103   01046                  ;
    1526    1104   01046                  ; de routine gebruikt geen registers.
    1527    1105   01046                  ;
    1528    1106   01046                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1529    1107   01046                  
    1530    1108   01046 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1531    1109   01048 C0D0                           push   psw
    1532    1110   0104A 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1533    1111   0104D D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1534    1112   0104F D0E0                           pop    acc
    1535    1113   01051 22                             RET                  ;ANDERS EINDE
    1536    1114   01052 E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1537    1115   01054 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1538    1116   01057 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1539    1117   0105A 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1540    1118   0105C                  
    1541    1119   0105C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1542    1120   0105C                  ;
    1543    1121   0105C                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1544    1122   0105C                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1545    1123   0105C                  ;
    1546    1124   0105C                  ; de routine gebruikt de accu.
    1547    1125   0105C                  ;
    1548    1126   0105C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1549    1127   0105C                  
    1550    1128   0105C                  sioinchar:
    1551    1129   0105C 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1552    1130   0105F C298                           CLR    RI                   ;BIT LAAG MAKEN
    1553    1131   01061 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1554    1132   01063 22                             RET
    1555    1133   01064                  
    1556    1134   01064                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1557    1135   01064                  ;
    1558    1136   01064                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1559    1137   01064                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1560    1138   01064                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1561    1139   01064                  ; DE CARRY OP 1 GEZET WORDEN.
    1562    1140   01064                  ;
    1563    1141   01064                  ; De routine gebruikt de accu, r0 en de psw.
    1564    1142   01064                  ;
    1565    1143   01064                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1566    1144   01064                  
    1567    1145   01064                  sioinbyte:
    1568    1146   01064 12105C           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1569    1147   01067 1210D0                         LCALL  LOWUPTR
    1570    1148   0106A 1210E7                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1571    1149   0106D 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1572    1150   0106F C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1573    1151   01070 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1574    1152   01071 12105C                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1575    1153   01074 1210D0                         LCALL  LOWUPTR
    1576    1154   01077 1210E7                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1577    1155   0107A 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1578    1156   0107C 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1579    1157   0107D 22               INBYTE1:      RET
    1580    1158   0107E                  
    1581    1159   0107E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1582    1160   0107E                  ;
    1583    1161   0107E                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1584    1162   0107E                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1585    1163   0107E                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1586    1164   0107E                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1587    1165   0107E                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1588    1166   0107E                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1589    1167   0107E                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1590    1168   0107E                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1591    1169   0107E                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1592    1170   0107E                  ; bepalen.
    1593    1171   0107E                  ;
    1594    1172   0107E                  ; De routine gebruikt de accu, r0 en de psw.
    1595    1173   0107E                  ;
    1596    1174   0107E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1597    1175   0107E                  
    1598    1176   0107E                  sioinbufa:
    1599    1177   0107E 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1600    1178   01080 12105C           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1601    1179   01083 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1602    1180   01085                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1603    1181   01085                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1604    1182   01085                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1605    1183   01085                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1606    1184   01085                  ; GEVOERD.
    1607    1185   01085 1210D0                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1608    1186   01088 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1609    1187   0108B F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1610    1188   0108C 22                             RET                         ;EINDE VAN DE ROUTINE
    1611    1189   0108D B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1612    1190   01090 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1613    1191   01093 7407             INBUFA4:      MOV    A,#BEEP
    1614    1192   01095 120FE5           INBUFA7:      LCALL  OUTCHAR
    1615    1193   01098 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1616    1194   0109A 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1617    1195   0109B 900FA9                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1618    1196   0109E 121028                         LCALL  OUTMSGA
    1619    1197   010A1 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1620    1198   010A3 1210C2           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1621    1199   010A6 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1622    1200   010A8 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1623    1201   010AB 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1624    1202   010AD F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1625    1203   010AE 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1626    1204   010AF 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1627    1205   010B1                  
    1628    1206   010B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1629    1207   010B1                  ;
    1630    1208   010B1                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1631    1209   010B1                  ;
    1632    1210   010B1                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1633    1211   010B1                  ;
    1634    1212   010B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1635    1213   010B1                  
    1636    1214   010B1 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1637    1215   010B3 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1638    1216   010B5 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1639    1217   010B6 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1640    1218   010B9 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1641    1219   010BA B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1642    1220   010BD 22                             RET                         ;EINDE VAN DE ROUTINE
    1643    1221   010BE F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1644    1222   010BF 09                             INC    R1
    1645    1223   010C0 80F7                           SJMP   BDELETE3
    1646    1224   010C2                  
    1647    1225   010C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1648    1226   010C2                  ;
    1649    1227   010C2                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1650    1228   010C2                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1651    1229   010C2                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1652    1230   010C2                  ; AANZIEN.
    1653    1231   010C2                  ;
    1654    1232   010C2                  ; De routine gebruikt de accu en de psw.
    1655    1233   010C2                  ;
    1656    1234   010C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1657    1235   010C2                  
    1658    1236   010C2 B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1659    1237   010C5 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1660    1238   010C7 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1661    1239   010CA 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1662    1240   010CC C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1663    1241   010CD 22                             RET
    1664    1242   010CE D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1665    1243   010CF 22                             RET
    1666    1244   010D0                  
    1667    1245   010D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1668    1246   010D0                  ;
    1669    1247   010D0                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1670    1248   010D0                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1671    1249   010D0                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1672    1250   010D0                  ; AANGEPAST WORDEN.
    1673    1251   010D0                  ;
    1674    1252   010D0                  ; De routine gebruikt de accu en de psw.
    1675    1253   010D0                  ;
    1676    1254   010D0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1677    1255   010D0                  
    1678    1256   010D0 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1679    1257   010D3 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1680    1258   010D5 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1681    1259   010D8 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1682    1260   010DA 9420                           SUBB   A,#020H              ;OMZETTING
    1683    1261   010DC 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1684    1262   010DD                  
    1685    1263   010DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1686    1264   010DD                  ;
    1687    1265   010DD                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1688    1266   010DD                  ; ASCII CODE.
    1689    1267   010DD                  ;
    1690    1268   010DD                  ; De routine gebruikt de accu en de psw.
    1691    1269   010DD                  ;
    1692    1270   010DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1693    1271   010DD                  
    1694    1272   010DD B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1695    1273   010E0 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1696    1274   010E2 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1697    1275   010E4 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1698    1276   010E6 22                             RET
    1699    1277   010E7                  
    1700    1278   010E7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1701    1279   010E7                  ;
    1702    1280   010E7                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1703    1281   010E7                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1704    1282   010E7                  ; GEVAL WORDT DE CARRY GEZET.
    1705    1283   010E7                  ;
    1706    1284   010E7                  ; De routine gebruikt de accu en de psw.
    1707    1285   010E7                  ;
    1708    1286   010E7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1709    1287   010E7                  
    1710    1288   010E7 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1711    1289   010E8 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1712    1290   010EA 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1713    1291   010EC B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1714    1292   010EF 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1715    1293   010F1 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1716    1294   010F3 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1717    1295   010F5 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1718    1296   010F8 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1719    1297   010F9 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1720    1298   010FB C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1721    1299   010FC 22               ASCBINTRANS1: RET
    1722    1300   010FD                  
    1723    1301   010FD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1724    1302   010FD                  ;
    1725    1303   010FD                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1726    1304   010FD                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1727    1305   010FD                  ;
    1728    1306   010FD                  ; De routine gebruikt de accu en de psw.
    1729    1307   010FD                  ;
    1730    1308   010FD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1731    1309   010FD                  
    1732    1310   010FD E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1733    1311   010FE 1210E7                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1734    1312   01101 22                             RET                         ;EINDE OMZETTING
    1735    1313   01102                  
    1736    1314   01102                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1737    1315   01102                  ;
    1738    1316   01102                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1739    1317   01102                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1740    1318   01102                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1741    1319   01102                  ;
    1742    1320   01102                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1743    1321   01102                  ;
    1744    1322   01102                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1745    1323   01102                  
    1746    1324   01102 1210FD           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1747    1325   01105 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1748    1326   01107 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1749    1327   01108 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1750    1328   01109 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1751    1329   0110A 1210FD                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1752    1330   0110D 4001                           JC     ASCII21               ;WEG ALS C=1
    1753    1331   0110F 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1754    1332   01110 22               ASCII21:      RET
    1755    1333   01111                  
    1756    1334   01111                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1757    1335   01111                  ;
    1758    1336   01111                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1759    1337   01111                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1760    1338   01111                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1761    1339   01111                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1762    1340   01111                  ;
    1763    1341   01111                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1764    1342   01111                  ;
    1765    1343   01111                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1766    1344   01111                  
    1767    1345   01111 121102           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1768    1346   01114 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1769    1347   01116 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1770    1348   01118 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1771    1349   01119 121102                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1772    1350   0111C 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1773    1351   0111E F582                           MOV    DPL,A                ;IN DPTR LADEN
    1774    1352   01120 22               ASCII41:      RET
    1775    1353   01121                  
    1776    1354   01121                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1777    1355   01121                  ;
    1778    1356   01121                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1779    1357   01121                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1780    1358   01121                  ; geschakeld worden.
    1781    1359   01121                  ;
    1782    1360   01121                  ; Gebruikt geen registers
    1783    1361   01121                  ;
    1784    1362   01121                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1785    1363   01121                  
    1786    1364   01121 C08F             initadc:      push   syscon0                     ;map saven
    1787    1365   01123 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1788    1366   01126 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1789    1367   01129 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1790    1368   0112C                                                                   ;klok delen door 32 (750kHz)
    1791    1369   0112C                                                                   ;10 bit uitkomst
    1792    1370   0112C 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1793    1371   0112F                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1794    1372   0112F 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1795    1373   01132 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1796    1374   01135 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1797    1375   01138 D08F                           pop    syscon0                     ;herstellen syscon
    1798    1376   0113A 22                             ret
    1799    1377   0113B                  
    1800    1378   0113B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1801    1379   0113B                  ;
    1802    1380   0113B                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1803    1381   0113B                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1804    1382   0113B                  ;
    1805    1383   0113B                  ; Gebruikt:
    1806    1384   0113B                  ;      -accu als 8 msb meting
    1807    1385   0113B                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1808    1386   0113B                  ;
    1809    1387   0113B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1810    1388   0113B                  
    1811    1389   0113B C08F             adclm335:     push   syscon0
    1812    1390   0113D 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1813    1391   01140 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1814    1392   01143 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1815    1393   01146 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1816    1394   01149 00               		nop
    1817    1395   0114A 00               		nop					;anders loopt het mis met het testen van de ready bit
    1818    1396   0114B E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1819    1397   0114D 20E0FB                         jb     acc.0,adclm3351
    1820    1398   01150 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1821    1399   01153 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1822    1400   01155 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1823    1401   01158 D08F                           pop    syscon0
    1824    1402   0115A 22                             ret
    1825    1403   0115B                  
    1826    1404   0115B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1827    1405   0115B                  ;
    1828    1406   0115B                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1829    1407   0115B                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1830    1408   0115B                  ;
    1831    1409   0115B                  ; Gebruikt:
    1832    1410   0115B                  ;      -accu als 8 msb meting
    1833    1411   0115B                  ;      -b als 2 lsb meting (links afgelijnd)
    1834    1412   0115B                  ;
    1835    1413   0115B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1836    1414   0115B                  
    1837    1415   0115B C08F             adcpotmeter:  push   syscon0
    1838    1416   0115D 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1839    1417   01160 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1840    1418   01163 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1841    1419   01166 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1842    1420   01169 00               		nop
    1843    1421   0116A 00               		nop					;anders loopt het mis met het testen van de ready bit
    1844    1422   0116B E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1845    1423   0116D 20E0FB                         jb     acc.0,adcpotmeter1
    1846    1424   01170 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1847    1425   01173 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1848    1426   01175 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1849    1427   01178 D08F                           pop    syscon0
    1850    1428   0117A                  
    1851    1429   0117A                  
    1852    1430   0117A 22                             ret
    1853    1431   0117B                  
    1854    1432   0117B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1855    1433   0117B                  ;
    1856    1434   0117B                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1857    1435   0117B                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1858    1436   0117B                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1859    1437   0117B                  ; doelstellingen in het achterhoofd.
    1860    1438   0117B                  ;
    1861    1439   0117B                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1862    1440   0117B                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1863    1441   0117B                  ; bcd)
    1864    1442   0117B                  ;      8bit hex naar bcd
    1865    1443   0117B                  ;      8bit bcd naar hex
    1866    1444   0117B                  ;
    1867    1445   0117B                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1868    1446   0117B                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1869    1447   0117B                  ;      16*16 bit met 32 bit uitkomst
    1870    1448   0117B                  ;      16+16 bit met 24 bit uitkomst
    1871    1449   0117B                  ;      16-16 bit met 24 bit uitkomst
    1872    1450   0117B                  ;      16bit hex naar bcd
    1873    1451   0117B                  ;      16bit bcd naar hex
    1874    1452   0117B                  ;
    1875    1453   0117B                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1876    1454   0117B                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1877    1455   0117B                  ;      32*32 bit met 64 bit uitkomst
    1878    1456   0117B                  ;      32+32 bit met 40 bit uitkomst
    1879    1457   0117B                  ;      32-32 bit met 40 bit uitkomst
    1880    1458   0117B                  ;
    1881    1459   0117B                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1882    1460   0117B                  ;
    1883    1461   0117B                  ; De routines gebruiken als input en output de huidige registerbank.
    1884    1462   0117B                  ;
    1885    1463   0117B                  ;
    1886    1464   0117B                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1887    1465   0117B                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1888    1466   0117B                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1889    1467   0117B                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1890    1468   0117B                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1891    1469   0117B                  ;
    1892    1470   0117B                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1893    1471   0117B                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1894    1472   0117B                  ;      -routines gebruiken geen MDU!
    1895    1473   0117B                  ;
    1896    1474   0117B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1897    1475   0117B                  
    1898    1476   0117B                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1899    1477   0117B                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1900    1478   0117B                  
    1901    1479   0117B                  h0            equ    070h
    1902    1480   0117B                  h1            equ    071h
    1903    1481   0117B                  h2            equ    072h
    1904    1482   0117B                  h3            equ    073h
    1905    1483   0117B                  h4            equ    074h
    1906    1484   0117B                  h5            equ    075h
    1907    1485   0117B                  h6            equ    076h
    1908    1486   0117B                  h7            equ    077h
    1909    1487   0117B                  h8            equ    078h
    1910    1488   0117B                  h9            equ    079h
    1911    1489   0117B                  h10           equ    07ah
    1912    1490   0117B                  h11           equ    07bh
    1913    1491   0117B                  h12           equ    07ch
    1914    1492   0117B                  
    1915    1493   0117B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1916    1494   0117B                  ;
    1917    1495   0117B                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1918    1496   0117B                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1919    1497   0117B                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1920    1498   0117B                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1921    1499   0117B                  ;
    1922    1500   0117B                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1923    1501   0117B                  ;
    1924    1502   0117B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1925    1503   0117B                  
    1926    1504   0117B C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1927    1505   0117D C0D0                           push   psw
    1928    1506   0117F C070                           push   h0
    1929    1507   01181 C071                           push   h1
    1930    1508   01183 C072                           push   h2
    1931    1509   01185 C073                           push   h3
    1932    1510   01187 C074                           push   h4
    1933    1511   01189 C075                           push   h5
    1934    1512   0118B C076                           push   h6
    1935    1513   0118D C077                           push   h7
    1936    1514   0118F C078                           push   h8
    1937    1515   01191 C079                           push   h9
    1938    1516   01193 C07A                           push   h10
    1939    1517   01195 C07B                           push   h11
    1940    1518   01197 C07C                           push   h12
    1941    1519   01199                  
    1942    1520   01199                  ; eerst moeten de hulpregisters klaar gezet worden
    1943    1521   01199                  
    1944    1522   01199 757000                         mov    h0,#000h
    1945    1523   0119C 757100                         mov    h1,#000h
    1946    1524   0119F 757200                         mov    h2,#000h
    1947    1525   011A2 757300                         mov    h3,#000h
    1948    1526   011A5 757400                         mov    h4,#000h
    1949    1527   011A8 757500                         mov    h5,#000h
    1950    1528   011AB 757600                         mov    h6,#000h
    1951    1529   011AE 757700                         mov    h7,#000h
    1952    1530   011B1 757800                         mov    h8,#000h
    1953    1531   011B4 757900                         mov    h9,#000h
    1954    1532   011B7 757A00                         mov    h10,#000h
    1955    1533   011BA 757B00                         mov    h11,#000h
    1956    1534   011BD 757C20                         mov    h12,#32              ;loopcounter
    1957    1535   011C0                  
    1958    1536   011C0                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1959    1537   011C0                  
    1960    1538   011C0                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1961    1539   011C0                  
    1962    1540   011C0 EB               mul321:       mov    a,r3
    1963    1541   011C1 13                             rrc    a
    1964    1542   011C2 FB                             mov    r3,a
    1965    1543   011C3 EA                             mov    a,r2
    1966    1544   011C4 13                             rrc    a
    1967    1545   011C5 FA                             mov    r2,a
    1968    1546   011C6 E9                             mov    a,r1
    1969    1547   011C7 13                             rrc    a
    1970    1548   011C8 F9                             mov    r1,a
    1971    1549   011C9 E8                             mov    a,r0
    1972    1550   011CA 13                             rrc    a
    1973    1551   011CB F8                             mov    r0,a                 ;32 bit shift klaar
    1974    1552   011CC                  
    1975    1553   011CC                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1976    1554   011CC                  
    1977    1555   011CC 502C                           jnc    mul322               ;optelling niet nodig
    1978    1556   011CE                  
    1979    1557   011CE                  ; hier staat en 64 bit optelling
    1980    1558   011CE                  
    1981    1559   011CE EC                             mov    a,r4
    1982    1560   011CF 2574                           add    a,h4
    1983    1561   011D1 F574                           mov    h4,a
    1984    1562   011D3 ED                             mov    a,r5
    1985    1563   011D4 3575                           addc   a,h5
    1986    1564   011D6 F575                           mov    h5,a
    1987    1565   011D8 EE                             mov    a,r6
    1988    1566   011D9 3576                           addc   a,h6
    1989    1567   011DB F576                           mov    h6,a
    1990    1568   011DD EF                             mov    a,r7
    1991    1569   011DE 3577                           addc   a,h7
    1992    1570   011E0 F577                           mov    h7,a
    1993    1571   011E2 E570                           mov    a,h0
    1994    1572   011E4 3578                           addc   a,h8
    1995    1573   011E6 F578                           mov    h8,a
    1996    1574   011E8 E571                           mov    a,h1
    1997    1575   011EA 3579                           addc   a,h9
    1998    1576   011EC F579                           mov    h9,a
    1999    1577   011EE E572                           mov    a,h2
    2000    1578   011F0 357A                           addc   a,h10
    2001    1579   011F2 F57A                           mov    h10,a
    2002    1580   011F4 E573                           mov    a,h3
    2003    1581   011F6 357B                           addc   a,h11
    2004    1582   011F8 F57B                           mov    h11,a                ;optelling klaar
    2005    1583   011FA                  
    2006    1584   011FA                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    2007    1585   011FA                  
    2008    1586   011FA C3               mul322:       clr    c                    ;moet op 0 staan
    2009    1587   011FB EC                             mov    a,r4
    2010    1588   011FC 33                             rlc    a
    2011    1589   011FD FC                             mov    r4,a
    2012    1590   011FE ED                             mov    a,r5
    2013    1591   011FF 33                             rlc    a
    2014    1592   01200 FD                             mov    r5,a
    2015    1593   01201 EE                             mov    a,r6
    2016    1594   01202 33                             rlc    a
    2017    1595   01203 FE                             mov    r6,a
    2018    1596   01204 EF                             mov    a,r7
    2019    1597   01205 33                             rlc    a
    2020    1598   01206 FF                             mov    r7,a
    2021    1599   01207 E570                           mov    a,h0
    2022    1600   01209 33                             rlc    a
    2023    1601   0120A F570                           mov    h0,a
    2024    1602   0120C E571                           mov    a,h1
    2025    1603   0120E 33                             rlc    a
    2026    1604   0120F F571                           mov    h1,a
    2027    1605   01211 E572                           mov    a,h2
    2028    1606   01213 33                             rlc    a
    2029    1607   01214 F572                           mov    h2,a
    2030    1608   01216 E573                           mov    a,h3
    2031    1609   01218 33                             rlc    a
    2032    1610   01219 F573                           mov    h3,a
    2033    1611   0121B                  
    2034    1612   0121B D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    2035    1613   0121E                  
    2036    1614   0121E                  ; de uitkomst moet in de juiste registers komen
    2037    1615   0121E                  
    2038    1616   0121E A874                           mov    r0,h4
    2039    1617   01220 A975                           mov    r1,h5
    2040    1618   01222 AA76                           mov    r2,h6
    2041    1619   01224 AB77                           mov    r3,h7
    2042    1620   01226 AC78                           mov    r4,h8
    2043    1621   01228 AD79                           mov    r5,h9
    2044    1622   0122A AE7A                           mov    r6,h10
    2045    1623   0122C AF7B                           mov    r7,h11               ;klaar
    2046    1624   0122E                  
    2047    1625   0122E D07C                           pop    h12                  ;registers herstellen
    2048    1626   01230 D07B                           pop    h11
    2049    1627   01232 D07A                           pop    h10
    2050    1628   01234 D079                           pop    h9
    2051    1629   01236 D078                           pop    h8
    2052    1630   01238 D077                           pop    h7
    2053    1631   0123A D076                           pop    h6
    2054    1632   0123C D075                           pop    h5
    2055    1633   0123E D074                           pop    h4
    2056    1634   01240 D073                           pop    h3
    2057    1635   01242 D072                           pop    h2
    2058    1636   01244 D071                           pop    h1
    2059    1637   01246 D070                           pop    h0
    2060    1638   01248 D0D0                           pop    psw
    2061    1639   0124A D0E0                           pop    acc
    2062    1640   0124C 22                             ret
    2063    1641   0124D                  
    2064    1642   0124D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2065    1643   0124D                  ;
    2066    1644   0124D                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    2067    1645   0124D                  ; input:      r1,r0 = eerste getal (r1=msb)
    2068    1646   0124D                  ;             r3,r2 = tweede getal (r3=msb)
    2069    1647   0124D                  ; output:     r3,r2,r1,r0 met r3=msb
    2070    1648   0124D                  ;
    2071    1649   0124D                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    2072    1650   0124D                  ;
    2073    1651   0124D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2074    1652   0124D                  
    2075    1653   0124D C0E0             mul16:        push   acc                  ;registers op de stack zetten
    2076    1654   0124F C0D0                           push   psw
    2077    1655   01251 C070                           push   h0
    2078    1656   01253 C071                           push   h1
    2079    1657   01255 C072                           push   h2
    2080    1658   01257 C073                           push   h3
    2081    1659   01259 C074                           push   h4
    2082    1660   0125B C075                           push   h5
    2083    1661   0125D C076                           push   h6
    2084    1662   0125F                  
    2085    1663   0125F                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    2086    1664   0125F                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    2087    1665   0125F                  ; h6 is de loopcounter.
    2088    1666   0125F                  
    2089    1667   0125F 757000                         mov    h0,#000h
    2090    1668   01262 757100                         mov    h1,#000h
    2091    1669   01265 757200                         mov    h2,#000h
    2092    1670   01268 757300                         mov    h3,#000h
    2093    1671   0126B 757400                         mov    h4,#000h
    2094    1672   0126E 757500                         mov    h5,#000h
    2095    1673   01271 757610                         mov    h6,#16               ;loopcounter
    2096    1674   01274                  
    2097    1675   01274                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    2098    1676   01274                  ; berekening
    2099    1677   01274                  
    2100    1678   01274 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    2101    1679   01275 13                             rrc    a
    2102    1680   01276 F9                             mov    r1,a
    2103    1681   01277 E8                             mov    a,r0
    2104    1682   01278 13                             rrc    a
    2105    1683   01279 F8                             mov    r0,a                 ;ok
    2106    1684   0127A                  
    2107    1685   0127A                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    2108    1686   0127A                  
    2109    1687   0127A 5016                           jnc    mul162
    2110    1688   0127C                  
    2111    1689   0127C EA                             mov    a,r2
    2112    1690   0127D 2572                           add    a,h2
    2113    1691   0127F F572                           mov    h2,a                 ;32 bit som uitvoeren
    2114    1692   01281 EB                             mov    a,r3
    2115    1693   01282 3573                           addc   a,h3
    2116    1694   01284 F573                           mov    h3,a
    2117    1695   01286 E570                           mov    a,h0
    2118    1696   01288 3574                           addc   a,h4
    2119    1697   0128A F574                           mov    h4,a
    2120    1698   0128C E571                           mov    a,h1
    2121    1699   0128E 3575                           addc   a,h5
    2122    1700   01290 F575                           mov    h5,a                 ;klaar
    2123    1701   01292                  
    2124    1702   01292                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    2125    1703   01292                  
    2126    1704   01292 C3               mul162:       clr    c
    2127    1705   01293 EA                             mov    a,r2
    2128    1706   01294 33                             rlc    a
    2129    1707   01295 FA                             mov    r2,a                 ;ook 32 bit getal
    2130    1708   01296 EB                             mov    a,r3
    2131    1709   01297 33                             rlc    a
    2132    1710   01298 FB                             mov    r3,a
    2133    1711   01299 E570                           mov    a,h0
    2134    1712   0129B 33                             rlc    a
    2135    1713   0129C F570                           mov    h0,a
    2136    1714   0129E E571                           mov    a,h1
    2137    1715   012A0 33                             rlc    a
    2138    1716   012A1 F571                           mov    h1,a                 ;klaar
    2139    1717   012A3                  
    2140    1718   012A3 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    2141    1719   012A6                  
    2142    1720   012A6                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    2143    1721   012A6                  
    2144    1722   012A6 A872                           mov    r0,h2
    2145    1723   012A8 A973                           mov    r1,h3
    2146    1724   012AA AA74                           mov    r2,h4
    2147    1725   012AC AB75                           mov    r3,h5                ;klaar
    2148    1726   012AE                  
    2149    1727   012AE                  
    2150    1728   012AE D076                           pop    h6                   ;registers herstellen
    2151    1729   012B0 D075                           pop    h5
    2152    1730   012B2 D074                           pop    h4
    2153    1731   012B4 D073                           pop    h3
    2154    1732   012B6 D072                           pop    h2
    2155    1733   012B8 D071                           pop    h1
    2156    1734   012BA D070                           pop    h0
    2157    1735   012BC D0D0                           pop    psw
    2158    1736   012BE D0E0                           pop    acc
    2159    1737   012C0 22                             ret
    2160    1738   012C1                  
    2161    1739   012C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2162    1740   012C1                  ;
    2163    1741   012C1                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2164    1742   012C1                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2165    1743   012C1                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2166    1744   012C1                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2167    1745   012C1                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2168    1746   012C1                  ;             carry=1 bij delen door 0
    2169    1747   012C1                  ;
    2170    1748   012C1                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2171    1749   012C1                  ;
    2172    1750   012C1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2173    1751   012C1                  
    2174    1752   012C1 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2175    1753   012C3 C0D0                           push   psw
    2176    1754   012C5 C070                           push   h0
    2177    1755   012C7 C071                           push   h1
    2178    1756   012C9 C072                           push   h2
    2179    1757   012CB C073                           push   h3
    2180    1758   012CD C074                           push   h4
    2181    1759   012CF C075                           push   h5
    2182    1760   012D1 C076                           push   h6
    2183    1761   012D3 C077                           push   h7
    2184    1762   012D5 C078                           push   h8
    2185    1763   012D7 C079                           push   h9
    2186    1764   012D9 C07A                           push   h10
    2187    1765   012DB C07B                           push   h11
    2188    1766   012DD C07C                           push   h12
    2189    1767   012DF                  
    2190    1768   012DF                  ; eerst alles voorladen
    2191    1769   012DF                  
    2192    1770   012DF 757000                         mov    h0,#000h
    2193    1771   012E2 757100                         mov    h1,#000h
    2194    1772   012E5 757200                         mov    h2,#000h
    2195    1773   012E8 757300                         mov    h3,#000h
    2196    1774   012EB 757400                         mov    h4,#000h
    2197    1775   012EE 757500                         mov    h5,#000h
    2198    1776   012F1 757600                         mov    h6,#000h
    2199    1777   012F4 757700                         mov    h7,#000h
    2200    1778   012F7 757800                         mov    h8,#000h
    2201    1779   012FA 757900                         mov    h9,#000h
    2202    1780   012FD 757A00                         mov    h10,#000h
    2203    1781   01300 757B00                         mov    h11,#000h
    2204    1782   01303 757C20                         mov    h12,#32              ;loopcounter
    2205    1783   01306                  
    2206    1784   01306                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2207    1785   01306                  
    2208    1786   01306                  ; deze lus moet 32 keer heraald worden
    2209    1787   01306                  
    2210    1788   01306 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2211    1789   01307 33                             rlc    a
    2212    1790   01308 F8                             mov    r0,a
    2213    1791   01309 E9                             mov    a,r1
    2214    1792   0130A 33                             rlc    a
    2215    1793   0130B F9                             mov    r1,a
    2216    1794   0130C EA                             mov    a,r2
    2217    1795   0130D 33                             rlc    a
    2218    1796   0130E FA                             mov    r2,a
    2219    1797   0130F EB                             mov    a,r3
    2220    1798   01310 33                             rlc    a
    2221    1799   01311 FB                             mov    r3,a
    2222    1800   01312 E570                           mov    a,h0
    2223    1801   01314 33                             rlc    a
    2224    1802   01315 F570                           mov    h0,a
    2225    1803   01317 E571                           mov    a,h1
    2226    1804   01319 33                             rlc    a
    2227    1805   0131A F571                           mov    h1,a
    2228    1806   0131C E572                           mov    a,h2
    2229    1807   0131E 33                             rlc    a
    2230    1808   0131F F572                           mov    h2,a
    2231    1809   01321 E573                           mov    a,h3
    2232    1810   01323 33                             rlc    a
    2233    1811   01324 F573                           mov    h3,a
    2234    1812   01326                  
    2235    1813   01326                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2236    1814   01326                  
    2237    1815   01326 C3                             clr    c                    ;zit in de weg
    2238    1816   01327 E570                           mov    a,h0
    2239    1817   01329 9C                             subb   a,r4
    2240    1818   0132A F574                           mov    h4,a
    2241    1819   0132C E571                           mov    a,h1
    2242    1820   0132E 9D                             subb   a,r5
    2243    1821   0132F F575                           mov    h5,a
    2244    1822   01331 E572                           mov    a,h2
    2245    1823   01333 9E                             subb   a,r6
    2246    1824   01334 F576                           mov    h6,a
    2247    1825   01336 E573                           mov    a,h3
    2248    1826   01338 9F                             subb   a,r7
    2249    1827   01339 F577                           mov    h7,a
    2250    1828   0133B                  
    2251    1829   0133B                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2252    1830   0133B                  ; vervangen worden door h7-h4
    2253    1831   0133B                  
    2254    1832   0133B 400C                           jc     div322               ;niet vervangen
    2255    1833   0133D                  
    2256    1834   0133D 857470                         mov    h0,h4
    2257    1835   01340 857571                         mov    h1,h5
    2258    1836   01343 857672                         mov    h2,h6
    2259    1837   01346 857773                         mov    h3,h7                ;vervanging klaar
    2260    1838   01349                  
    2261    1839   01349 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2262    1840   0134A E578                           mov    a,h8
    2263    1841   0134C 33                             rlc    a
    2264    1842   0134D F578                           mov    h8,a
    2265    1843   0134F E579                           mov    a,h9
    2266    1844   01351 33                             rlc    a
    2267    1845   01352 F579                           mov    h9,a
    2268    1846   01354 E57A                           mov    a,h10
    2269    1847   01356 33                             rlc    a
    2270    1848   01357 F57A                           mov    h10,a
    2271    1849   01359 E57B                           mov    a,h11
    2272    1850   0135B 33                             rlc    a
    2273    1851   0135C F57B                           mov    h11,a                ;qoutient aangepast
    2274    1852   0135E                  
    2275    1853   0135E D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2276    1854   01361                  
    2277    1855   01361                  ; de berekening is klaar. uitkomstregisters nog laden
    2278    1856   01361                  
    2279    1857   01361 AC78                           mov    r4,h8
    2280    1858   01363 AD79                           mov    r5,h9
    2281    1859   01365 AE7A                           mov    r6,h10
    2282    1860   01367 AF7B                           mov    r7,h11               ;uitkomst geladen
    2283    1861   01369                  
    2284    1862   01369 A870                           mov    r0,h0                ;rest laden
    2285    1863   0136B A971                           mov    r1,h1
    2286    1864   0136D AA72                           mov    r2,h2
    2287    1865   0136F AB73                           mov    r3,h3
    2288    1866   01371                  
    2289    1867   01371 D07C                           pop    h12                  ;registers herstellen
    2290    1868   01373 D07B                           pop    h11
    2291    1869   01375 D07A                           pop    h10
    2292    1870   01377 D079                           pop    h9
    2293    1871   01379 D078                           pop    h8
    2294    1872   0137B D077                           pop    h7
    2295    1873   0137D D076                           pop    h6
    2296    1874   0137F D075                           pop    h5
    2297    1875   01381 D074                           pop    h4
    2298    1876   01383 D073                           pop    h3
    2299    1877   01385 D072                           pop    h2
    2300    1878   01387 D071                           pop    h1
    2301    1879   01389 D070                           pop    h0
    2302    1880   0138B D0D0                           pop    psw
    2303    1881   0138D D0E0                           pop    acc
    2304    1882   0138F 22                             ret
    2305    1883   01390                  
    2306    1884   01390                  
    2307    1885   01390                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2308    1886   01390                  ;
    2309    1887   01390                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2310    1888   01390                  ; input:      r1,r0 = eerste getal (r1=msb)
    2311    1889   01390                  ;             r3,r2 = tweede getal (r3=msb)
    2312    1890   01390                  ; output:     r3,r2 = quotient (r3=msb)
    2313    1891   01390                  ;             r1,r0 = rest (r1=msb)
    2314    1892   01390                  ;             carry=1 bij deling door 0
    2315    1893   01390                  ;
    2316    1894   01390                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2317    1895   01390                  
    2318    1896   01390 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2319    1897   01392 C0D0                           push   psw
    2320    1898   01394 C070                           push   h0
    2321    1899   01396 C071                           push   h1
    2322    1900   01398 C072                           push   h2
    2323    1901   0139A C073                           push   h3
    2324    1902   0139C C074                           push   h4
    2325    1903   0139E C075                           push   h5
    2326    1904   013A0 C076                           push   h6
    2327    1905   013A2                  
    2328    1906   013A2                  ; registers voorladen
    2329    1907   013A2                  
    2330    1908   013A2 757000                         mov    h0,#000h
    2331    1909   013A5 757100                         mov    h1,#000h
    2332    1910   013A8 757200                         mov    h2,#000h
    2333    1911   013AB 757300                         mov    h3,#000h
    2334    1912   013AE 757400                         mov    h4,#000h
    2335    1913   013B1 757500                         mov    h5,#000h
    2336    1914   013B4 757610                         mov    h6,#16               ;loopcounter
    2337    1915   013B7                  
    2338    1916   013B7                  ; eerst te delen getal 1*links shiften in hulpregisters
    2339    1917   013B7                  
    2340    1918   013B7                  ; deze lus moet 16 keer herhaald worden
    2341    1919   013B7                  
    2342    1920   013B7 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2343    1921   013B8 33                             rlc    a
    2344    1922   013B9 F8                             mov    r0,a
    2345    1923   013BA E9                             mov    a,r1
    2346    1924   013BB 33                             rlc    a
    2347    1925   013BC F9                             mov    r1,a
    2348    1926   013BD E570                           mov    a,h0
    2349    1927   013BF 33                             rlc    a
    2350    1928   013C0 F570                           mov    h0,a
    2351    1929   013C2 E571                           mov    a,h1
    2352    1930   013C4 33                             rlc    a
    2353    1931   013C5 F571                           mov    h1,a
    2354    1932   013C7                  
    2355    1933   013C7                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2356    1934   013C7                  ; het tussenresultaat.
    2357    1935   013C7                  
    2358    1936   013C7 C3                             clr    c
    2359    1937   013C8 E570                           mov    a,h0
    2360    1938   013CA 9A                             subb   a,r2
    2361    1939   013CB F572                           mov    h2,a
    2362    1940   013CD E571                           mov    a,h1
    2363    1941   013CF 9B                             subb   a,r3
    2364    1942   013D0 F573                           mov    h3,a
    2365    1943   013D2                  
    2366    1944   013D2 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2367    1945   013D4                                                            ;door h3,h2
    2368    1946   013D4 857270                         mov    h0,h2
    2369    1947   013D7 857371                         mov    h1,h3                ;vervanging klaar
    2370    1948   013DA                  
    2371    1949   013DA                  ; uitkomst moet aangepast worden
    2372    1950   013DA                  
    2373    1951   013DA B3               div162:       cpl    c                    ;truuk
    2374    1952   013DB E574                           mov    a,h4
    2375    1953   013DD 33                             rlc    a
    2376    1954   013DE F574                           mov    h4,a
    2377    1955   013E0 E575                           mov    a,h5
    2378    1956   013E2 33                             rlc    a
    2379    1957   013E3 F575                           mov    h5,a
    2380    1958   013E5 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2381    1959   013E8                  
    2382    1960   013E8                  ; de berekening is klaar. uitkomsten in passende registers
    2383    1961   013E8                  
    2384    1962   013E8 AA74                           mov    r2,h4                ;quotient
    2385    1963   013EA AB75                           mov    r3,h5
    2386    1964   013EC                  
    2387    1965   013EC A870                           mov    r0,h0                ;rest
    2388    1966   013EE A971                           mov    r1,h1
    2389    1967   013F0                  
    2390    1968   013F0 D076                           pop    h6                   ;registers herstellen
    2391    1969   013F2 D075                           pop    h5
    2392    1970   013F4 D074                           pop    h4
    2393    1971   013F6 D073                           pop    h3
    2394    1972   013F8 D072                           pop    h2
    2395    1973   013FA D071                           pop    h1
    2396    1974   013FC D070                           pop    h0
    2397    1975   013FE D0D0                           pop    psw
    2398    1976   01400 D0E0                           pop    acc
    2399    1977   01402 22                             ret
    2400    1978   01403                  
    2401    1979   01403                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2402    1980   01403                  ;
    2403    1981   01403                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2404    1982   01403                  ;
    2405    1983   01403                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2406    1984   01403                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2407    1985   01403                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2408    1986   01403                  ;
    2409    1987   01403                  ; r4,r3,r2,r1,r0 worden aangepast
    2410    1988   01403                  ;
    2411    1989   01403                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2412    1990   01403                  
    2413    1991   01403 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2414    1992   01405 C0D0                           push   psw
    2415    1993   01407 E8                             mov    a,r0                 ;eerste 8 bit
    2416    1994   01408 2C                             add    a,r4
    2417    1995   01409 F8                             mov    r0,a                 ;klaar
    2418    1996   0140A E9                             mov    a,r1                 ;volgende 8 bit
    2419    1997   0140B 3D                             addc   a,r5
    2420    1998   0140C F9                             mov    r1,a                 ;klaar
    2421    1999   0140D EA                             mov    a,r2                 ;volgende 8 bit
    2422    2000   0140E 3E                             addc   a,r6
    2423    2001   0140F FA                             mov    r2,a                 ;klaar
    2424    2002   01410 EB                             mov    a,r3                 ;laatste 8 bit
    2425    2003   01411 3F                             addc   a,r7
    2426    2004   01412 FB                             mov    r3,a                 ;32 bit klaar
    2427    2005   01413 7400                           mov    a,#000h
    2428    2006   01415 3400                           addc   a,#000h              ;carry verrekenen
    2429    2007   01417 FC                             mov    r4,a
    2430    2008   01418 D0D0                           pop    psw                  ;registers herstellen
    2431    2009   0141A D0E0                           pop    acc
    2432    2010   0141C 22                             ret
    2433    2011   0141D                  
    2434    2012   0141D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2435    2013   0141D                  ;
    2436    2014   0141D                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2437    2015   0141D                  ;
    2438    2016   0141D                  ; input:      r1,r0 = eerste getal (r1=msb)
    2439    2017   0141D                  ;             r3,r2 = tweede getal (r3=msb)
    2440    2018   0141D                  ; output:     r2,r1,r0 (r2=msb)
    2441    2019   0141D                  ;
    2442    2020   0141D                  ; r3,r2,r1,r0 worden aangepast
    2443    2021   0141D                  ;
    2444    2022   0141D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2445    2023   0141D                  
    2446    2024   0141D C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2447    2025   0141F C0D0                           push   psw
    2448    2026   01421 E8                             mov    a,r0                 ;starten met de optelling
    2449    2027   01422 2A                             add    a,r2                 ;8 bit klaar
    2450    2028   01423 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2451    2029   01424 E9                             mov    a,r1                 ;volgende 8 bit
    2452    2030   01425 3B                             addc   a,r3                 ;16 bit klaar
    2453    2031   01426 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2454    2032   01427 7400                           mov    a,#000h              ;carry verrekenen
    2455    2033   01429 3400                           addc   a,#000h
    2456    2034   0142B FA                             mov    r2,a                 ;24 bit klaar
    2457    2035   0142C D0D0                           pop    psw                  ;registers herstellen
    2458    2036   0142E D0E0                           pop    acc
    2459    2037   01430 22                             ret
    2460    2038   01431                  
    2461    2039   01431                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2462    2040   01431                  ;
    2463    2041   01431                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2464    2042   01431                  ;             40 bit groot. (eerste -tweede)
    2465    2043   01431                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2466    2044   01431                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2467    2045   01431                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2468    2046   01431                  ;
    2469    2047   01431                  ; r4,r3,r2,r1,r0 worden aangepast
    2470    2048   01431                  ;
    2471    2049   01431                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2472    2050   01431                  
    2473    2051   01431 C0E0             sub32:        push   acc                  ;registers bewaren
    2474    2052   01433 C0D0                           push   psw                  ;ook de vlaggen
    2475    2053   01435 C3                             clr    c                    ;zit nog effe in de weg
    2476    2054   01436 E8                             mov    a,r0                 ;eerste 8 bit
    2477    2055   01437 9C                             subb   a,r4
    2478    2056   01438 F8                             mov    r0,a
    2479    2057   01439 E9                             mov    a,r1                 ;tweede 8 bit
    2480    2058   0143A 9D                             subb   a,r5
    2481    2059   0143B F9                             mov    r1,a
    2482    2060   0143C EA                             mov    a,r2                 ;volgende 8 bit
    2483    2061   0143D 9E                             subb   a,r6
    2484    2062   0143E FA                             mov    r2,a
    2485    2063   0143F EB                             mov    a,r3                 ;laatste 8 bit
    2486    2064   01440 9F                             subb   a,r7
    2487    2065   01441 FB                             mov    r3,a
    2488    2066   01442 7400                           mov    a,#000h              ;nu nog de carry
    2489    2067   01444 9400                           subb   a,#000h
    2490    2068   01446 FC                             mov    r4,a                 ;40 bit klaar
    2491    2069   01447 D0D0                           pop    psw                  ;registers herstellen
    2492    2070   01449 D0E0                           pop    acc
    2493    2071   0144B 22                             ret
    2494    2072   0144C                  
    2495    2073   0144C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2496    2074   0144C                  ;
    2497    2075   0144C                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2498    2076   0144C                  ;             24 bit groot. (eerste - tweede)
    2499    2077   0144C                  ; input:      r1,r0 = eerste getal (r1=msb)
    2500    2078   0144C                  ;             r3,r2 = tweede getal (r3=msb)
    2501    2079   0144C                  ; output:     r2,r1,r0 (r2=msb)
    2502    2080   0144C                  ;
    2503    2081   0144C                  ; r3,r2,r1,r0 worden aangepast
    2504    2082   0144C                  ;
    2505    2083   0144C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2506    2084   0144C                  
    2507    2085   0144C C0E0             sub16:        push   acc                  ;registers bewaren
    2508    2086   0144E C0D0                           push   psw
    2509    2087   01450 C3                             clr    c                    ;mag nog niet meespelen
    2510    2088   01451 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2511    2089   01452 9A                             subb   a,r2
    2512    2090   01453 F8                             mov    r0,a                 ;klaar
    2513    2091   01454 E9                             mov    a,r1
    2514    2092   01455 9B                             subb   a,r3                 ;16 bit klaar
    2515    2093   01456 F9                             mov    r1,a
    2516    2094   01457 7400                           mov    a,#000h
    2517    2095   01459 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2518    2096   0145B FA                             mov    r2,a                 ;24 bit klaar
    2519    2097   0145C D0D0                           pop    psw                  ;registers herstellen
    2520    2098   0145E D0E0                           pop    acc
    2521    2099   01460 22                             ret
    2522    2100   01461                  
    2523    2101   01461                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2524    2102   01461                  ;
    2525    2103   01461                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2526    2104   01461                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2527    2105   01461                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2528    2106   01461                  ;
    2529    2107   01461                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2530    2108   01461                  ;
    2531    2109   01461                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2532    2110   01461                  
    2533    2111   01461 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2534    2112   01463 C0D0                           push   psw
    2535    2113   01465                  
    2536    2114   01465 C077                           push   h7                   ;nodig
    2537    2115   01467 C078                           push   h8
    2538    2116   01469                  
    2539    2117   01469 C079                           push   h9                   ;ook
    2540    2118   0146B                  
    2541    2119   0146B 757905                         mov    h9,#005h             ;loopcounter
    2542    2120   0146E                  
    2543    2121   0146E 7B00             hexbcd161:    mov    r3,#000h
    2544    2122   01470 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2545    2123   01472 121390                         lcall  div16                ;deling uitvoeren
    2546    2124   01475 E8                             mov    a,r0                 ;rest
    2547    2125   01476 C0E0                           push   acc                  ;op stack zetten
    2548    2126   01478 EA                             mov    a,r2
    2549    2127   01479 F8                             mov    r0,a
    2550    2128   0147A EB                             mov    a,r3
    2551    2129   0147B F9                             mov    r1,a                 ;uitkomst terug delen
    2552    2130   0147C D579EF                         djnz   h9,hexbcd161
    2553    2131   0147F                  
    2554    2132   0147F D0E0                           pop    acc                  ;hoogste bits van de stack
    2555    2133   01481 FA                             mov    r2,a                 ;klaar
    2556    2134   01482 D0E0                           pop    acc
    2557    2135   01484 C4                             swap   a
    2558    2136   01485 F579                           mov    h9,a
    2559    2137   01487 D0E0                           pop    acc
    2560    2138   01489 2579                           add    a,h9
    2561    2139   0148B F9                             mov    r1,a                 ;volgende 8 klaar
    2562    2140   0148C D0E0                           pop    acc
    2563    2141   0148E C4                             swap   a
    2564    2142   0148F F579                           mov    h9,a
    2565    2143   01491 D0E0                           pop    acc
    2566    2144   01493 2579                           add    a,h9
    2567    2145   01495 F8                             mov    r0,a                 ;klaar
    2568    2146   01496                  
    2569    2147   01496 D079                           pop    h9                   ;was naar de knoppen
    2570    2148   01498                  
    2571    2149   01498 D078                           pop    h8                   ;gebruikt
    2572    2150   0149A D077                           pop    h7
    2573    2151   0149C                  
    2574    2152   0149C D0D0                           pop    psw                  ;registers herstellen
    2575    2153   0149E D0E0                           pop    acc
    2576    2154   014A0 22                             ret
    2577    2155   014A1                  
    2578    2156   014A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2579    2157   014A1                  ;
    2580    2158   014A1                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2581    2159   014A1                  ; input       a (maximale waarde = 63h)
    2582    2160   014A1                  ; output      a
    2583    2161   014A1                  ;
    2584    2162   014A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2585    2163   014A1                  
    2586    2164   014A1 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2587    2165   014A3 C0F0                           push   b
    2588    2166   014A5 75F00A                         mov    b,#00ah              ;hierdoor delen
    2589    2167   014A8 84                             div    ab                   ;in accu qoutient in b rest
    2590    2168   014A9 C4                             swap   a
    2591    2169   014AA 25F0                           add    a,b                  ;bcd getal klaar
    2592    2170   014AC D0F0                           pop    b
    2593    2171   014AE D0D0                           pop    psw
    2594    2172   014B0 22                             ret
    2595    2173   014B1                  
    2596    2174   014B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2597    2175   014B1                  ;
    2598    2176   014B1                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2599    2177   014B1                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2600    2178   014B1                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2601    2179   014B1                  ;
    2602    2180   014B1                  ; de routine gebruikt r1,r0 van de huidige bank
    2603    2181   014B1                  ;
    2604    2182   014B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2605    2183   014B1                  
    2606    2184   014B1 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2607    2185   014B3 C0E0                           push   acc
    2608    2186   014B5 C0D0                           push   psw
    2609    2187   014B7                  
    2610    2188   014B7 E8                             mov    a,r0
    2611    2189   014B8 540F                           anl    a,#00fh              ;eenheden
    2612    2190   014BA C0E0                           push   acc                  ;effe bewaren
    2613    2191   014BC                  
    2614    2192   014BC E8                             mov    a,r0
    2615    2193   014BD C4                             swap   a
    2616    2194   014BE 540F                           anl    a,#00fh              ;tientallen
    2617    2195   014C0 75F00A                         mov    b,#00ah              ;waarde berekenen
    2618    2196   014C3 A4                             mul    ab                   ;klaar
    2619    2197   014C4 D0F0                           pop    b                    ;truukje
    2620    2198   014C6 25F0                           add    a,b                  ;a is lage deel hex getal
    2621    2199   014C8 C0E0                           push   acc                  ;straks nodig
    2622    2200   014CA                  
    2623    2201   014CA E9                             mov    a,r1                 ;hoge deel
    2624    2202   014CB 54F0                           anl    a,#0f0h
    2625    2203   014CD C4                             swap   a
    2626    2204   014CE C0E0                           push   acc                  ;straks nodig
    2627    2205   014D0                  
    2628    2206   014D0 E9                             mov    a,r1
    2629    2207   014D1 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2630    2208   014D3 75F064                         mov    b,#100               ;waarde uitrekenen
    2631    2209   014D6 A4                             mul    ab
    2632    2210   014D7 A9F0                           mov    r1,b
    2633    2211   014D9 F8                             mov    r0,a
    2634    2212   014DA                  
    2635    2213   014DA D0E0                           pop    acc
    2636    2214   014DC 75F00A                         mov    b,#10
    2637    2215   014DF A4                             mul    ab                   ;kan nog in a
    2638    2216   014E0 75F064                         mov    b,#100               ;*10*100=*1000
    2639    2217   014E3 A4                             mul    ab
    2640    2218   014E4 28                             add    a,r0
    2641    2219   014E5 F8                             mov    r0,a
    2642    2220   014E6 E9                             mov    a,r1
    2643    2221   014E7 35F0                           addc   a,b
    2644    2222   014E9 F9                             mov    r1,a
    2645    2223   014EA                  
    2646    2224   014EA D0E0                           pop    acc
    2647    2225   014EC 28                             add    a,r0
    2648    2226   014ED F8                             mov    r0,a
    2649    2227   014EE 7400                           mov    a,#000h
    2650    2228   014F0 39                             addc   a,r1
    2651    2229   014F1 F9                             mov    r1,a                 ;klaar
    2652    2230   014F2                  
    2653    2231   014F2 D0D0                           pop    psw
    2654    2232   014F4 D0E0                           pop    acc
    2655    2233   014F6 D0F0                           pop    b
    2656    2234   014F8 22                             ret
    2657    2235   014F9                  
    2658    2236   014F9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2659    2237   014F9                  ;
    2660    2238   014F9                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2661    2239   014F9                  ; input:      a (maximale waarde 99h)
    2662    2240   014F9                  ; output:     a
    2663    2241   014F9                  ;
    2664    2242   014F9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2665    2243   014F9                  
    2666    2244   014F9 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2667    2245   014FB C0F0                           push   b
    2668    2246   014FD C070                           push   h0
    2669    2247   014FF F570                           mov    h0,a                 ;effe bewaren
    2670    2248   01501 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2671    2249   01504 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2672    2250   01506 C4                             swap   a
    2673    2251   01507 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2674    2252   0150A A4                             mul    ab
    2675    2253   0150B 2570                           add    a,h0                 ;eenheden bijtellen
    2676    2254   0150D D070                           pop    h0
    2677    2255   0150F D0F0                           pop    b
    2678    2256   01511 D0D0                           pop    psw
    2679    2257   01513 22                             ret
    2680    2258   01514                  
    2681    2259   01514                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2682    2260   01514                  ;
    2683    2261   01514                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2684    2262   01514                  ;
    2685    2263   01514                  ; Gebruikt geen registers
    2686    2264   01514                  ;
    2687    2265   01514                  ; Originele auteur: Danny Pawels (dp)
    2688    2266   01514                  ;
    2689    2267   01514                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2690    2268   01514                  
    2691    2269   01514                  
    2692    2270   01514 C083             XCsw2xtal:  push  dph
    2693    2271   01516 C082                         push  dpl
    2694    2272   01518 C0D0                         push  psw
    2695    2273   0151A C08F                         push  syscon0
    2696    2274   0151C C0B2                         push  port_page
    2697    2275   0151E C0BF                         push  scu_page
    2698    2276   01520                  
    2699    2277   01520 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2700    2278   01523 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2701    2279   01526                  
    2702    2280   01526 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2703    2281   01529                                                            ;freq= VCO-free running =5MHz...20MHz?
    2704    2282   01529 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2705    2283   0152C 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2706    2284   0152F 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2707    2285   01532                  
    2708    2286   01532 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2709    2287   01535 A3               XCsw2xtal0: inc   dptr
    2710    2288   01536 E582                         mov   a,dpl
    2711    2289   01538 4583                         orl   a,dph
    2712    2290   0153A 70F9                         jnz   XCsw2xtal0
    2713    2291   0153C                  
    2714    2292   0153C 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2715    2293   0153F                  
    2716    2294   0153F                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2717    2295   0153F E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2718    2296   01541 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2719    2297   01544                  ;Oscillator run detectie is klaar...
    2720    2298   01544 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2721    2299   01547                  
    2722    2300   01547                  
    2723    2301   01547 E5B7                         mov   a,pll_con               ;lees pll_con
    2724    2302   01549 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2725    2303   0154B 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2726    2304   0154D                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2727    2305   0154D                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2728    2306   0154D                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2729    2307   0154D 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2730    2308   01550                                                            ;bij aanpassing van de NDIV van de PLL
    2731    2309   01550 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2732    2310   01552 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2733    2311   01555 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2734    2312   01558                  
    2735    2313   01558 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2736    2314   0155A 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2737    2315   0155D                  
    2738    2316   0155D 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2739    2317   01560 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2740    2318   01563                  
    2741    2319   01563 D0BF                         pop   scu_page                ;herstel controller status
    2742    2320   01565 D0B2                         pop   port_page
    2743    2321   01567 D08F                         pop   syscon0
    2744    2322   01569 D0D0                         pop   psw
    2745    2323   0156B D082                         pop   dpl
    2746    2324   0156D D083                         pop   dph
    2747    2325   0156F 22                           ret
    2748    2326   01570                  
    2749    2327   01570                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2750    2328   01570                  ;
    2751    2329   01570                  ; mapregs	selecteer de SFR's in de mapped area
    2752    2330   01570                  ;
    2753    2331   01570                  ;
    2754    2332   01570                  ; Past syscon SFR aan
    2755    2333   01570                  ;
    2756    2334   01570                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2757    2335   01570                  
    2758    2336   01570 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2759    2337   01573 22               		ret
    2760    2338   01574                  
    2761    2339   01574                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2762    2340   01574                  ;
    2763    2341   01574                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2764    2342   01574                  ;
    2765    2343   01574                  ; Past syscon SFR aan
    2766    2344   01574                  ;
    2767    2345   01574                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2768    2346   01574                  
    2769    2347   01574 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2770    2348   01577 22               		ret
    2771    2349   01578                  
    2772    2350   01578                  ;*******************************************************************************
    2773    2351   01578                  ;
    2774    2352   01578                  ; These are the register declarations for the XC888 microcontroller from
    2775    2353   01578                  ; Infineon.
    2776    2354   01578                  ;
    2777    2355   01578                  ;*******************************************************************************
    2778    2356   01578                  
    2779    2357   01578                  ;*******************************************************************************
    2780    2358   01578                  ;
    2781    2359   01578                  ; CPU registers are accessible independend of paging and mapping
    2782    2360   01578                  ; (always accessible)
    2783    2361   01578                  ;
    2784    2362   01578                  ;*******************************************************************************
    2785    2363   01578                  
    2786    2364   01578                  sp            data   081h          ;stack pointer                     reset=007h
    2787    2365   01578                  dpl           data   082h          ;datapointer low register          reset=000h
    2788    2366   01578                  dph           data   083h          ;datapointer high register         reset=000h
    2789    2367   01578                  pcon          data   087h          ;power control                     reset=000h
    2790    2368   01578                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2791    2369   01578                  ;tcon is bit addressable
    2792    2370   01578                         tf1    bit    08fh
    2793    2371   01578                         tr1    bit    08eh
    2794    2372   01578                         tf0    bit    08dh
    2795    2373   01578                         tr0    bit    08ch
    2796    2374   01578                         ie1    bit    08bh
    2797    2375   01578                         it1    bit    08ah
    2798    2376   01578                         ie0    bit    089h
    2799    2377   01578                         it0    bit    088h
    2800    2378   01578                  
    2801    2379   01578                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2802    2380   01578                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2803    2381   01578                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2804    2382   01578                  th0           data   08ch          ;timer 0 high                      reset=000h
    2805    2383   01578                  th1           data   08dh          ;timer 1 high                      reset=000h
    2806    2384   01578                  
    2807    2385   01578                  syscon0       data   08fh          ;system control register 0         reset=004h
    2808    2386   01578                  scon          data   098h          ;serial channel 0 control          reset=000h
    2809    2387   01578                  ;scon is bit addressable
    2810    2388   01578                         sm0    bit    09fh
    2811    2389   01578                         sm1    bit    09eh
    2812    2390   01578                         sm2    bit    09dh
    2813    2391   01578                         ren    bit    09ch
    2814    2392   01578                         tb8    bit    09bh
    2815    2393   01578                         rb8    bit    09ah
    2816    2394   01578                         ti     bit    099h
    2817    2395   01578                         ri     bit    098h
    2818    2396   01578                  
    2819    2397   01578                  sbuf          data   099h          ;serial data buffer channel 0
    2820    2398   01578                  eo            data   0a2h          ;extended operation                reset=000h
    2821    2399   01578                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2822    2400   01578                  ;ien0 is bit addressable
    2823    2401   01578                         ea     bit    0afh
    2824    2402   01578                                                     ;bit not implemented
    2825    2403   01578                         et2    bit    0adh
    2826    2404   01578                         es     bit    0ach
    2827    2405   01578                         et1    bit    0abh
    2828    2406   01578                         ex1    bit    0aah
    2829    2407   01578                         et0    bit    0a9h
    2830    2408   01578                         ex0    bit    0a8h
    2831    2409   01578                  
    2832    2410   01578                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2833    2411   01578                  ;ip is bit addressable
    2834    2412   01578                                                     ;bit not implemented
    2835    2413   01578                                                     ;bit not implemented
    2836    2414   01578                         pt2    bit    0bdh
    2837    2415   01578                         ps     bit    0bch
    2838    2416   01578                         pt1    bit    0bbh
    2839    2417   01578                         px1    bit    0bah
    2840    2418   01578                         pt0    bit    0b9h
    2841    2419   01578                         px0    bit    0b8h
    2842    2420   01578                  
    2843    2421   01578                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2844    2422   01578                  psw           data   0d0h          ;program status word               reset=000h
    2845    2423   01578                  ;psw is bit addressable
    2846    2424   01578                         cy     bit    0d7h
    2847    2425   01578                         ac     bit    0d6h
    2848    2426   01578                         f0     bit    0d5h
    2849    2427   01578                         rs1    bit    0d4h
    2850    2428   01578                         rs0    bit    0d3h
    2851    2429   01578                         ov     bit    0d2h
    2852    2430   01578                         f1     bit    0d1h
    2853    2431   01578                         p      bit    0d0h
    2854    2432   01578                  
    2855    2433   01578                  acc           data   0e0h          ;accumulator                       reset=000h
    2856    2434   01578                  ;acc is bit addressable
    2857    2435   01578                  
    2858    2436   01578                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2859    2437   01578                  ;ien1 is bit addressable
    2860    2438   01578                         eccip3 bit    0efh
    2861    2439   01578                         eccip2 bit    0eeh
    2862    2440   01578                         eccip1 bit    0edh
    2863    2441   01578                         eccip0 bit    0ech
    2864    2442   01578                         exm    bit    0ebh
    2865    2443   01578                         ex2    bit    0eah
    2866    2444   01578                         essc   bit    0e9h
    2867    2445   01578                         eadc   bit    0e8h
    2868    2446   01578                  
    2869    2447   01578                  b             data   0f0h          ;b register                        reset=000h
    2870    2448   01578                  ;b is bit addressable
    2871    2449   01578                  
    2872    2450   01578                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2873    2451   01578                  ;ip1 is bit addressable
    2874    2452   01578                         pccip3 bit    0ffh
    2875    2453   01578                         pccip2 bit    0feh
    2876    2454   01578                         pccip1 bit    0fdh
    2877    2455   01578                         pccip0 bit    0fch
    2878    2456   01578                         pxm    bit    0fbh
    2879    2457   01578                         px2    bit    0fah
    2880    2458   01578                         pssc   bit    0f9h
    2881    2459   01578                         padc   bit    0f8h
    2882    2460   01578                  
    2883    2461   01578                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2884    2462   01578                  
    2885    2463   01578                  
    2886    2464   01578                  ;*******************************************************************************
    2887    2465   01578                  ;
    2888    2466   01578                  ; system control registers registers that can only be accessed in the non
    2889    2467   01578                  ; mapped memory area (rmap=0) page independent
    2890    2468   01578                  ;
    2891    2469   01578                  ;*******************************************************************************
    2892    2470   01578                  
    2893    2471   01578                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2894    2472   01578                  
    2895    2473   01578                  ;*******************************************************************************
    2896    2474   01578                  ;
    2897    2475   01578                  ; system control registers registers that can only be accessed in the non
    2898    2476   01578                  ; mapped memory area (rmap=0) and page 0
    2899    2477   01578                  ;
    2900    2478   01578                  ;*******************************************************************************
    2901    2479   01578                  
    2902    2480   01578                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2903    2481   01578                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2904    2482   01578                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2905    2483   01578                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2906    2484   01578                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2907    2485   01578                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2908    2486   01578                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2909    2487   01578                  nmisr         data   0bch          ;nmi status                        reset=000h
    2910    2488   01578                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2911    2489   01578                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2912    2490   01578                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2913    2491   01578                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2914    2492   01578                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2915    2493   01578                  
    2916    2494   01578                  ;*******************************************************************************
    2917    2495   01578                  ;
    2918    2496   01578                  ; system control registers registers that can only be accessed in the non
    2919    2497   01578                  ; mapped memory area (rmap=0) and page 1
    2920    2498   01578                  ;
    2921    2499   01578                  ;*******************************************************************************
    2922    2500   01578                  
    2923    2501   01578                  id            data   0b3h          ;identity register     reset=device dependent
    2924    2502   01578                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2925    2503   01578                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2926    2504   01578                  osc_con       data   0b6h          ;osc control                       reset=008h
    2927    2505   01578                  pll_con       data   0b7h          ;pll control                       reset=090h
    2928    2506   01578                  cmcon         data   0bah          ;clock control                     reset=010h
    2929    2507   01578                  passwd        data   0bbh          ;password register                 reset=007h
    2930    2508   01578                  feal          data   0bch          ;flash error register              reset=000h
    2931    2509   01578                  feah          data   0bdh          ;flash error address high          reset=000h
    2932    2510   01578                  cocon         data   0beh          ;clock output control              reset=000h
    2933    2511   01578                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2934    2512   01578                  
    2935    2513   01578                  ;*******************************************************************************
    2936    2514   01578                  ;
    2937    2515   01578                  ; system control registers registers that can only be accessed in the non
    2938    2516   01578                  ; mapped memory area (rmap=0) and page 3
    2939    2517   01578                  ;
    2940    2518   01578                  ;*******************************************************************************
    2941    2519   01578                  
    2942    2520   01578                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2943    2521   01578                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2944    2522   01578                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2945    2523   01578                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2946    2524   01578                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2947    2525   01578                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2948    2526   01578                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2949    2527   01578                  
    2950    2528   01578                  ;*******************************************************************************
    2951    2529   01578                  ;
    2952    2530   01578                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2953    2531   01578                  ;
    2954    2532   01578                  ;*******************************************************************************
    2955    2533   01578                  
    2956    2534   01578                  port_page     data   0b2h          ;port page register                reset=000h
    2957    2535   01578                  
    2958    2536   01578                  ;*******************************************************************************
    2959    2537   01578                  ;
    2960    2538   01578                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2961    2539   01578                  ;
    2962    2540   01578                  ;*******************************************************************************
    2963    2541   01578                  
    2964    2542   01578                  p0_data       data   080h          ;port 0 data register              reset=000h
    2965    2543   01578                  ;p0_data is bit addressable
    2966    2544   01578                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2967    2545   01578                  p1_data       data   090h          ;port 1 data register              reset=000h
    2968    2546   01578                  ;p1_data is bit addressable
    2969    2547   01578                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2970    2548   01578                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2971    2549   01578                  ;p2_data is bit addressable
    2972    2550   01578                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2973    2551   01578                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2974    2552   01578                  ;p3_data is bit addressable
    2975    2553   01578                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2976    2554   01578                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2977    2555   01578                  ;p4_data is bit addressable
    2978    2556   01578                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2979    2557   01578                  p5_data       data   092h          ;port 5 data register              reset=000h
    2980    2558   01578                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2981    2559   01578                  
    2982    2560   01578                  ;*******************************************************************************
    2983    2561   01578                  ;
    2984    2562   01578                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2985    2563   01578                  ;
    2986    2564   01578                  ;*******************************************************************************
    2987    2565   01578                  
    2988    2566   01578                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2989    2567   01578                  ;p0_data is bit addressable
    2990    2568   01578                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2991    2569   01578                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2992    2570   01578                  ;p1_data is bit addressable
    2993    2571   01578                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2994    2572   01578                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2995    2573   01578                  ;p2_data is bit addressable
    2996    2574   01578                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2997    2575   01578                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2998    2576   01578                  ;p3_data is bit addressable
    2999    2577   01578                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    3000    2578   01578                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    3001    2579   01578                  ;p4_data is bit addressable
    3002    2580   01578                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    3003    2581   01578                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    3004    2582   01578                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    3005    2583   01578                  
    3006    2584   01578                  ;*******************************************************************************
    3007    2585   01578                  ;
    3008    2586   01578                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    3009    2587   01578                  ;
    3010    2588   01578                  ;*******************************************************************************
    3011    2589   01578                  
    3012    2590   01578                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    3013    2591   01578                  ;p0_data is bit addressable
    3014    2592   01578                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    3015    2593   01578                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    3016    2594   01578                  ;p1_data is bit addressable
    3017    2595   01578                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    3018    2596   01578                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    3019    2597   01578                  ;p3_data is bit addressable
    3020    2598   01578                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    3021    2599   01578                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    3022    2600   01578                  ;p4_data is bit addressable
    3023    2601   01578                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    3024    2602   01578                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    3025    2603   01578                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    3026    2604   01578                  
    3027    2605   01578                  ;*******************************************************************************
    3028    2606   01578                  ;
    3029    2607   01578                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    3030    2608   01578                  ;
    3031    2609   01578                  ;*******************************************************************************
    3032    2610   01578                  
    3033    2611   01578                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    3034    2612   01578                  ;p0_data is bit addressable
    3035    2613   01578                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    3036    2614   01578                  ;p1_data is bit addressable
    3037    2615   01578                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    3038    2616   01578                  ;p3_data is bit addressable
    3039    2617   01578                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    3040    2618   01578                  ;p4_data is bit addressable
    3041    2619   01578                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    3042    2620   01578                  
    3043    2621   01578                  ;*******************************************************************************
    3044    2622   01578                  ;
    3045    2623   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    3046    2624   01578                  ;
    3047    2625   01578                  ;*******************************************************************************
    3048    2626   01578                  
    3049    2627   01578                  adc_page      data   0d1h          ;adc page register                 reset=000h
    3050    2628   01578                  
    3051    2629   01578                  ;*******************************************************************************
    3052    2630   01578                  ;
    3053    2631   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    3054    2632   01578                  ;
    3055    2633   01578                  ;*******************************************************************************
    3056    2634   01578                  
    3057    2635   01578                  adc_globctr   data   0cah          ;global control register           reset=030h
    3058    2636   01578                  adc_globstr   data   0cbh          ;global status register            reset=000h
    3059    2637   01578                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    3060    2638   01578                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    3061    2639   01578                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    3062    2640   01578                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    3063    2641   01578                  
    3064    2642   01578                  ;*******************************************************************************
    3065    2643   01578                  ;
    3066    2644   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    3067    2645   01578                  ;
    3068    2646   01578                  ;*******************************************************************************
    3069    2647   01578                  
    3070    2648   01578                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    3071    2649   01578                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    3072    2650   01578                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    3073    2651   01578                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    3074    2652   01578                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    3075    2653   01578                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    3076    2654   01578                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    3077    2655   01578                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    3078    2656   01578                  
    3079    2657   01578                  ;*******************************************************************************
    3080    2658   01578                  ;
    3081    2659   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    3082    2660   01578                  ;
    3083    2661   01578                  ;*******************************************************************************
    3084    2662   01578                  
    3085    2663   01578                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    3086    2664   01578                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    3087    2665   01578                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    3088    2666   01578                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    3089    2667   01578                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    3090    2668   01578                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    3091    2669   01578                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    3092    2670   01578                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    3093    2671   01578                  
    3094    2672   01578                  ;*******************************************************************************
    3095    2673   01578                  ;
    3096    2674   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    3097    2675   01578                  ;
    3098    2676   01578                  ;*******************************************************************************
    3099    2677   01578                  
    3100    2678   01578                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    3101    2679   01578                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    3102    2680   01578                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    3103    2681   01578                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    3104    2682   01578                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    3105    2683   01578                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    3106    2684   01578                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    3107    2685   01578                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    3108    2686   01578                  
    3109    2687   01578                  ;*******************************************************************************
    3110    2688   01578                  ;
    3111    2689   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    3112    2690   01578                  ;
    3113    2691   01578                  ;*******************************************************************************
    3114    2692   01578                  
    3115    2693   01578                  adc_rcr0      data   0cah          ;result control register           reset=000h
    3116    2694   01578                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    3117    2695   01578                  adc_rcr2      data   0cch          ;result control register           reset=000h
    3118    2696   01578                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    3119    2697   01578                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    3120    2698   01578                  
    3121    2699   01578                  ;*******************************************************************************
    3122    2700   01578                  ;
    3123    2701   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    3124    2702   01578                  ;
    3125    2703   01578                  ;*******************************************************************************
    3126    2704   01578                  
    3127    2705   01578                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    3128    2706   01578                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    3129    2707   01578                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    3130    2708   01578                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    3131    2709   01578                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    3132    2710   01578                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    3133    2711   01578                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    3134    2712   01578                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    3135    2713   01578                  
    3136    2714   01578                  ;*******************************************************************************
    3137    2715   01578                  ;
    3138    2716   01578                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    3139    2717   01578                  ;
    3140    2718   01578                  ;*******************************************************************************
    3141    2719   01578                  
    3142    2720   01578                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    3143    2721   01578                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    3144    2722   01578                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3145    2723   01578                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3146    2724   01578                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3147    2725   01578                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3148    2726   01578                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3149    2727   01578                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3150    2728   01578                  
    3151    2729   01578                  ;*******************************************************************************
    3152    2730   01578                  
    3153    2731   01578                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3154    2732   01578                  ;
    3155    2733   01578                  ;*******************************************************************************
    3156    2734   01578                  
    3157    2735   01578                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3158    2736   01578                  ;t2_t2con is bit addressable
    3159    2737   01578                         tf2    bit    0c7h
    3160    2738   01578                         exf2   bit    0c6h
    3161    2739   01578                                                     ;2 bits are not implemented
    3162    2740   01578                         exen2  bit    0c3h
    3163    2741   01578                         tr2    bit    0c2h
    3164    2742   01578                         ct2    bit    0c1h
    3165    2743   01578                         cprl2  bit    0c0h
    3166    2744   01578                  
    3167    2745   01578                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3168    2746   01578                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3169    2747   01578                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3170    2748   01578                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3171    2749   01578                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3172    2750   01578                  
    3173    2751   01578                  ;*******************************************************************************
    3174    2752   01578                  ;
    3175    2753   01578                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3176    2754   01578                  ;
    3177    2755   01578                  ;*******************************************************************************
    3178    2756   01578                  
    3179    2757   01578                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3180    2758   01578                  
    3181    2759   01578                  ;*******************************************************************************
    3182    2760   01578                  ;
    3183    2761   01578                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3184    2762   01578                  ;
    3185    2763   01578                  ;*******************************************************************************
    3186    2764   01578                  
    3187    2765   01578                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3188    2766   01578                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3189    2767   01578                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3190    2768   01578                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3191    2769   01578                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3192    2770   01578                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3193    2771   01578                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3194    2772   01578                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3195    2773   01578                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3196    2774   01578                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3197    2775   01578                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3198    2776   01578                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3199    2777   01578                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3200    2778   01578                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3201    2779   01578                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3202    2780   01578                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3203    2781   01578                  
    3204    2782   01578                  ;*******************************************************************************
    3205    2783   01578                  ;
    3206    2784   01578                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3207    2785   01578                  ;
    3208    2786   01578                  ;*******************************************************************************
    3209    2787   01578                  
    3210    2788   01578                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3211    2789   01578                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3212    2790   01578                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3213    2791   01578                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3214    2792   01578                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3215    2793   01578                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3216    2794   01578                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3217    2795   01578                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3218    2796   01578                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3219    2797   01578                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3220    2798   01578                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3221    2799   01578                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3222    2800   01578                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3223    2801   01578                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3224    2802   01578                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3225    2803   01578                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3226    2804   01578                  
    3227    2805   01578                  ;*******************************************************************************
    3228    2806   01578                  ;
    3229    2807   01578                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3230    2808   01578                  ;
    3231    2809   01578                  ;*******************************************************************************
    3232    2810   01578                  
    3233    2811   01578                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3234    2812   01578                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3235    2813   01578                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3236    2814   01578                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3237    2815   01578                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3238    2816   01578                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3239    2817   01578                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3240    2818   01578                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3241    2819   01578                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3242    2820   01578                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3243    2821   01578                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3244    2822   01578                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3245    2823   01578                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3246    2824   01578                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3247    2825   01578                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3248    2826   01578                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3249    2827   01578                  
    3250    2828   01578                  ;*******************************************************************************
    3251    2829   01578                  ;
    3252    2830   01578                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3253    2831   01578                  ;
    3254    2832   01578                  ;*******************************************************************************
    3255    2833   01578                  
    3256    2834   01578                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3257    2835   01578                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3258    2836   01578                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3259    2837   01578                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3260    2838   01578                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3261    2839   01578                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3262    2840   01578                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3263    2841   01578                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3264    2842   01578                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3265    2843   01578                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3266    2844   01578                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3267    2845   01578                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3268    2846   01578                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3269    2847   01578                  
    3270    2848   01578                  ;*******************************************************************************
    3271    2849   01578                  ;
    3272    2850   01578                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3273    2851   01578                  ;
    3274    2852   01578                  ;*******************************************************************************
    3275    2853   01578                  
    3276    2854   01578                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3277    2855   01578                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3278    2856   01578                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3279    2857   01578                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3280    2858   01578                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3281    2859   01578                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3282    2860   01578                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3283    2861   01578                  
    3284    2862   01578                  ;*******************************************************************************
    3285    2863   01578                  ;
    3286    2864   01578                  ; can registers can be accessed in the standard memory map (rmap=0)
    3287    2865   01578                  ;
    3288    2866   01578                  ;*******************************************************************************
    3289    2867   01578                  
    3290    2868   01578                  adcon         data   0d8h          ;adres/data control                reset=000h
    3291    2869   01578                  ; adcon is bit addressable
    3292    2870   01578                         v3     bit    0dfh
    3293    2871   01578                         v2     bit    0deh
    3294    2872   01578                         v1     bit    0ddh
    3295    2873   01578                         v0     bit    0dch
    3296    2874   01578                         auad1  bit    0dbh
    3297    2875   01578                         auad0  bit    0dah
    3298    2876   01578                         can_bsy bit   0d9h
    3299    2877   01578                         rwen   bit    0d8h
    3300    2878   01578                  
    3301    2879   01578                  adl           data   0d9h          ;adres register low                reset=000h
    3302    2880   01578                  adh           data   0dah          ;adres register low                reset=000h
    3303    2881   01578                  data0         data   0dbh          ;can data                          reset=000h
    3304    2882   01578                  data1         data   0dch          ;can data                          reset=000h
    3305    2883   01578                  data2         data   0ddh          ;can data                          reset=000h
    3306    2884   01578                  data3         data   0deh          ;can data                          reset=000h
    3307    2885   01578                  
    3308    2886   01578                  ;*******************************************************************************
    3309    2887   01578                  ;
    3310    2888   01578                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3311    2889   01578                  ;
    3312    2890   01578                  ;*******************************************************************************
    3313    2891   01578                  
    3314    2892   01578                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3315    2893   01578                  ;mdustat is bit addressable
    3316    2894   01578                                                     ;5 bits are not implemented
    3317    2895   01578                         bsy    bit    0b2h
    3318    2896   01578                         ierr   bit    0b1h
    3319    2897   01578                         irdy   bit    0b0h
    3320    2898   01578                  
    3321    2899   01578                  mducon        data   0b1h          ;mdu control                       reset=000h
    3322    2900   01578                  md0           data   0b2h          ;mdu operand register              reset=000h
    3323    2901   01578                  mr0           data   0b2h          ;mdu result register               reset=000h
    3324    2902   01578                  md1           data   0b3h          ;mdu operand register              reset=000h
    3325    2903   01578                  mr1           data   0b3h          ;mdu result register               reset=000h
    3326    2904   01578                  md2           data   0b4h          ;mdu operand register              reset=000h
    3327    2905   01578                  mr2           data   0b4h          ;mdu result register               reset=000h
    3328    2906   01578                  md3           data   0b5h          ;mdu operand register              reset=000h
    3329    2907   01578                  mr3           data   0b5h          ;mdu result register               reset=000h
    3330    2908   01578                  md4           data   0b6h          ;mdu operand register              reset=000h
    3331    2909   01578                  mr4           data   0b6h          ;mdu result register               reset=000h
    3332    2910   01578                  md5           data   0b7h          ;mdu operand register              reset=000h
    3333    2911   01578                  mr5           data   0b7h          ;mdu result register               reset=000h
    3334    2912   01578                  
    3335    2913   01578                  ;*******************************************************************************
    3336    2914   01578                  ;
    3337    2915   01578                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3338    2916   01578                  ;
    3339    2917   01578                  ;*******************************************************************************
    3340    2918   01578                  
    3341    2919   01578                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3342    2920   01578                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3343    2921   01578                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3344    2922   01578                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3345    2923   01578                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3346    2924   01578                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3347    2925   01578                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3348    2926   01578                  ;cd_statc is bit addressable
    3349    2927   01578                         keepz  bit    0a7h
    3350    2928   01578                         keepy  bit    0a6h
    3351    2929   01578                         keepx  bit    0a5h
    3352    2930   01578                         dmap   bit    0a4h
    3353    2931   01578                         int_en bit    0a3h
    3354    2932   01578                         eoc    bit    0a2h
    3355    2933   01578                         error  bit    0a1h
    3356    2934   01578                         cd_bsy bit    0a0h
    3357    2935   01578                  
    3358    2936   01578                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3359    2937   01578                  
    3360    2938   01578                  ;*******************************************************************************
    3361    2939   01578                  ;
    3362    2940   01578                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3363    2941   01578                  ;
    3364    2942   01578                  ;*******************************************************************************
    3365    2943   01578                  
    3366    2944   01578                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3367    2945   01578                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3368    2946   01578                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3369    2947   01578                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3370    2948   01578                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3371    2949   01578                  
    3372    2950   01578                  ;*******************************************************************************
    3373    2951   01578                  ;
    3374    2952   01578                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3375    2953   01578                  ;
    3376    2954   01578                  ;*******************************************************************************
    3377    2955   01578                  
    3378    2956   01578                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3379    2957   01578                  ;t2_t2con is bit addressable bits are aalready defined
    3380    2958   01578                         ;tf2    bit    0c7h
    3381    2959   01578                         ;exf2   bit    0c6h
    3382    2960   01578                                                     ;2 bits are not implemented
    3383    2961   01578                         ;exen2  bit    0c3h
    3384    2962   01578                         ;tr2    bit    0c2h
    3385    2963   01578                         ;ct2    bit    0c1h
    3386    2964   01578                         ;cprl2  bit    0c0h
    3387    2965   01578                  
    3388    2966   01578                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3389    2967   01578                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3390    2968   01578                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3391    2969   01578                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3392    2970   01578                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3393    2971   01578                  
    3394    2972   01578                  ;*******************************************************************************
    3395    2973   01578                  ;
    3396    2974   01578                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3397    2975   01578                  ;
    3398    2976   01578                  ;*******************************************************************************
    3399    2977   01578                  
    3400    2978   01578                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3401    2979   01578                  ;s1con is bit addressable
    3402    2980   01578                         sm01   bit    0cfh
    3403    2981   01578                         sm11   bit    0ceh
    3404    2982   01578                         sm21   bit    0cdh
    3405    2983   01578                         ren1   bit    0cch
    3406    2984   01578                         tb81   bit    0cbh
    3407    2985   01578                         rb81   bit    0cah
    3408    2986   01578                         ti1    bit    0c9h
    3409    2987   01578                         ri1    bit    0c8h
    3410    2988   01578                  
    3411    2989   01578                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3412    2990   01578                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3413    2991   01578                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3414    2992   01578                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3415    2993   01578                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3416    2994   01578                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3417    2995   01578                  
    3418    2996   01578                  ;*******************************************************************************
    3419    2997   01578                  ;
    3420    2998   01578                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3421    2999   01578                  ;
    3422    3000   01578                  ;*******************************************************************************
    3423    3001   01578                  
    3424    3002   01578                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3425    3003   01578                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3426    3004   01578                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3427    3005   01578                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3428    3006   01578                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3429    3007   01578                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3430    3008   01578                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3431    3009   01578                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3432    3010   01578                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3433    3011   01578                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3434    3012   01578                  
    3435    3013   01578                  ;end directive must be used, but has no signification
    3436    3014   01578                  
    3437    3015   01578                  end
    3438    3016   01578                  
    3439    3017   01578                  
    3440    3018   01578                  
    3441    3019   01578                  
    3442    3020   01578                  
    3443    3021   01578                  
    3444    3022   01578                  
    3445    3023   01578                  
    3446    3024   01578                  
    3447    3025   01578                  
    3448    3026   01578                  
    3449    3027   01578                  
    3450    3028   01578                  
    3451    3029   01578                  
    3452    3030   01578                  
    3453    3031   01578                  
