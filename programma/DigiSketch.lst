C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  clrL    equ     15h                 ;register voor het legen van het het scherm
       2       2   00000                  clrH    equ     16h                 ;register voor het legen van het het scherm
       3       3   00000                  
       4       4   00000                  org 0000h
       5       5   00000 020003           ljmp   main
       6       6   00003                  
       7       7   00003                  ;------------------------------------------------------------------
       8       8   00003                  ;Hoofd programma
       9       9   00003                  ;------------------------------------------------------------------
      10      10   00003                  main:
      11      11   00003 75817F               mov     sp,#7fh                 ;stackpointer instellen
      12      12   00006 120049               lcall   inits
      13      13   00009                  
      14      14   00009                      ;Mode set
      15      15   00009 751280               mov     COMANDREG,#10000000b
      16      16   0000C 12019D               lcall   comandWrite
      17      17   0000F                      ;Display mode
      18      18   0000F 75129C               mov     COMANDREG,#10011100b
      19      19   00012 12019D               lcall   comandWrite
      20      20   00015                  
      21      21   00015                      ;adres data pointer
      22      22   00015 751160               mov     DATAREG,#60h            ;lower address
      23      23   00018 120150               lcall   dataWrite
      24      24   0001B 751109               mov     DATAREG,#09h
      25      25   0001E 120150               lcall   dataWrite
      26      26   00021 751224               mov     COMANDREG,#24h
      27      27   00024 12019D               lcall   comandWrite
      28      28   00027 D0E0                 pop     acc
      29      29   00029 D0D0                 pop     psw
      30      30   0002B                  lus0:
      31      31   0002B 90009B               mov     dptr,#test               ;begin afbeelding in pointer steken
      32      32   0002E                  lus:
      33      33   0002E E4                   clr     a
      34      34   0002F 93                   movc    a,@a+dptr                  ;get byte
      35      35   00030 B4AA03               cjne    a,#10101010b,next
      36      36   00033 020045               ljmp    stop
      37      37   00036                  next:
      38      38   00036 F511                 mov     DATAREG,a
      39      39   00038 120150               lcall   dataWrite
      40      40   0003B 7512C0               mov     COMANDREG,#c0h
      41      41   0003E 12019D               lcall   comandWrite
      42      42   00041 A3                   inc     dptr
      43      43   00042 02002E               ljmp    lus
      44      44   00045                  stop:
      45      45   00045 00                   nop
      46      46   00046 020045               ljmp    stop
      47      47   00049                  
      48      48   00049                  
      49      49   00049                  ;------------------------------------------------------------------
      50      50   00049                  ;Initializatie van alle componenten nodig in het hoofd programma
      51      51   00049                  ;------------------------------------------------------------------
      52      52   00049                  inits:
      53      53   00049 75B200               mov     port_page,#000h         ;selecteer poort page 0
      54      54   0004C 1200CE               lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      55      55   0004F 120053               lcall   clearScreen
      56      56   00052 22               ret
      57      57   00053                  
      58      58   00053                  ;------------------------------------------------------------------
      59      59   00053                  ;Het scherm leeg maken
      60      60   00053                  ;------------------------------------------------------------------
      61      61   00053                  clearScreen:
      62      62   00053 C0E0                 push    acc
      63      63   00055 C0D0                 push    psw
      64      64   00057 7515FF               mov     clrL,#ffh               ;255 keer doolopen7
      65      65   0005A 75160F               mov     clrH,#0fh               ;16 keer doorlopen
      66      66   0005D                      ;Mode set
      67      67   0005D 751280               mov     COMANDREG,#10000000b    ;OR mode
      68      68   00060 12019D               lcall   comandWrite
      69      69   00063                      ;Display mode
      70      70   00063 75129C               mov     COMANDREG,#10011100b    ;gafisch en tekst aan zetten
      71      71   00066 12019D               lcall   comandWrite
      72      72   00069                      ;auto write mode
      73      73   00069 7512B0               mov     COMANDREG,#b0h
      74      74   0006C 12019D               lcall   comandWrite
      75      75   0006F                  lus2400:
      76      76   0006F 751100               mov     DATAREG,#000h
      77      77   00072 120167               lcall   dataAutoWrite
      78      78   00075 D515F7               djnz    clrL,lus2400
      79      79   00078 7515FF               mov     clrL,#ffh
      80      80   0007B D516F1               djnz    clrH,lus2400
      81      81   0007E                      ;data auto read af zetten
      82      82   0007E 7512B2               mov     COMANDREG,#b2h
      83      83   00081 12019D               lcall   comandWrite
      84      84   00084                  
      85      85   00084                      ;adres data pointer resetten
      86      86   00084 751100               mov     DATAREG,#00h            ;lower address
      87      87   00087 120150               lcall   dataWrite
      88      88   0008A 751100               mov     DATAREG,#00h
      89      89   0008D 120150               lcall   dataWrite
      90      90   00090 751224               mov     COMANDREG,#24h
      91      91   00093 12019D               lcall   comandWrite
      92      92   00096 D0E0                 pop     acc
      93      93   00098 D0D0                 pop     psw
      94      94   0009A 22               ret
      95      95   0009B                  
      96      96   0009B                  test:
      97      97   0009B 212121212121AA   db 21h,21h,21h,21h,21h,21h,10101010b
      98      98   000A2                  
      99      99   000A2                  
     100     100   000A2                  
     101     101   000A2                  
project.inc 
     103       1   000A2                  ;------------------------------------------------------------------
     104       2   000A2                  ;Lijst van functies:
     105       3   000A2                  ;   -statusCheck            Status check van scherm opslaan in STA register
     106       4   000A2                  ;   -initGLCD               Initializatie van grafisch LCD scherm
     107       5   000A2                  ;   -debug                  debug info op seriele poot zetten
     108       6   000A2                  ;   -dataWrite              data naar het scherm sturen
     109       7   000A2                  ;   -dataRead               data van het scherm lezen
     110       8   000A2                  ;   -comandWrite            comanndo naar scherm sturen
     111       9   000A2                  ;------------------------------------------------------------------
     112      10   000A2                  ;------------------------------------------------------------------
     113      11   000A2                  ;declaratie van pinnen
     114      12   000A2                  ;------------------------------------------------------------------
     115      13   000A2                      WR          bit     p3_data.0   ;write line van scherm actief laag
     116      14   000A2                      RD          bit     p3_data.1   ;read line van scherrm actief laag
     117      15   000A2                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
     118      16   000A2                      CD          bit     p3_data.3   ;Command write
     119      17   000A2                      RESET       bit     p0_data.1   ;reset van scherm actief laag
     120      18   000A2                      FS          bit     p0_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
     121      19   000A2                  
     122      20   000A2                  ;------------------------------------------------------------------
     123      21   000A2                  ;declaratie van registers
     124      22   000A2                  ;------------------------------------------------------------------
     125      23   000A2                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
     126      24   000A2                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
     127      25   000A2                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
     128      26   000A2                      ADDH        equ     13h         ;adres pointer voor scherm MSb
     129      27   000A2                      ADDL        equ     14h
     130      28   000A2                  
     131      29   000A2                  ;------------------------------------------------------------------
     132      30   000A2                  ;Status check van scherm opslaan in STA register
     133      31   000A2                  ;-STA
     134      32   000A2                  ;------------------------------------------------------------------
     135      33   000A2                  statusCheck:
     136      34   000A2 C0E0                 push    acc
     137      35   000A4 C0D0                 push    psw
     138      36   000A6 C210                 clr     STA                     ;STA register leeg maken
     139      37   000A8 75C900               mov     p4_dir,#000h            ;p4 als input zetten
     140      38   000AB D2B3                 setb    CD
     141      39   000AD D2B0                 setb    WR
     142      40   000AF                  stan:
     143      41   000AF C2B1                 clr     RD
     144      42   000B1 E5C8                 mov     a,p4_data
     145      43   000B3 D2B1                 setb    RD
     146      44   000B5 D2B3                 setb    CD
     147      45   000B7 F8                   mov     r0,a
     148      46   000B8 1201B3               lcall   debug
     149      47   000BB F510                 mov     STA,a                   ;bijhouden voor eventueel gebruik
     150      48   000BD 5403                 anl     a,#03h                  ;masker voor STA0 en STA1
     151      49   000BF B403ED               cjne    a,#03h,stan
     152      50   000C2 F8                   mov     r0,a
     153      51   000C3 1201B3               lcall   debug
     154      52   000C6 75C9FF               mov     p4_dir,#0ffh
     155      53   000C9 D0D0                 pop     psw
     156      54   000CB D0E0                 pop     acc
     157      55   000CD 22               ret
     158      56   000CE                  
     159      57   000CE                  ;------------------------------------------------------------------
     160      58   000CE                  ;Initializatie van grafisch LCD scherm
     161      59   000CE                  ;------------------------------------------------------------------
     162      60   000CE                  initGLCD:
     163      61   000CE 120588               lcall   initsio                 ;voor debug
     164      62   000D1 7586FF               mov     p0_dir,#0ffh            ;poort 1 als output
     165      63   000D4 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output
     166      64   000D7 C2B2                 clr     CE                      ;standaart laag houden
     167      65   000D9 D2B0                 setb    WR                      ;standaart hoog maken
     168      66   000DB D2B1                 setb    RD                      ;standaart hoog maken
     169      67   000DD D280                 setb    FS                      ;font op 6*8 zetten
     170      68   000DF C281                 clr     RESET                   ;reseten van scherm
     171      69   000E1 120368               lcall   delay1ms
     172      70   000E4 D281                 setb    RESET                   ;reset terug af zetten
     173      71   000E6 1200A2               lcall   statusCheck             ;initiele status check uitvoeren
     174      72   000E9                  
     175      73   000E9                      ;Mode set
     176      74   000E9 751280               mov     COMANDREG,#10000000b
     177      75   000EC 12019D               lcall   comandWrite
     178      76   000EF                  
     179      77   000EF                      ;Graphics home address
     180      78   000EF 751100               mov     DATAREG,#00h
     181      79   000F2 120150               lcall   dataWrite
     182      80   000F5 751100               mov     DATAREG,#00h
     183      81   000F8 120150               lcall   dataWrite
     184      82   000FB 751242               mov     COMANDREG,#42h
     185      83   000FE 12019D               lcall   comandWrite
     186      84   00101                  
     187      85   00101                      ;Graphics area set
     188      86   00101 751128               mov     DATAREG,#28h
     189      87   00104 120150               lcall   dataWrite
     190      88   00107 751100               mov     DATAREG,#00h
     191      89   0010A 120150               lcall   dataWrite
     192      90   0010D 751243               mov     COMANDREG,#43h
     193      91   00110 12019D               lcall   comandWrite
     194      92   00113                  
     195      93   00113                      ;text home address
     196      94   00113 751160               mov     DATAREG,#60h
     197      95   00116 120150               lcall   dataWrite
     198      96   00119 751109               mov     DATAREG,#09h
     199      97   0011C 120150               lcall   dataWrite
     200      98   0011F 751240               mov     COMANDREG,#40h
     201      99   00122 12019D               lcall   comandWrite
     202     100   00125                  
     203     101   00125                      ;text area set
     204     102   00125 751128               mov     DATAREG,#28h
     205     103   00128 120150               lcall   dataWrite
     206     104   0012B 751100               mov     DATAREG,#00h
     207     105   0012E 120150               lcall   dataWrite
     208     106   00131 751241               mov     COMANDREG,#41h
     209     107   00134 12019D               lcall   comandWrite
     210     108   00137                  
     211     109   00137                      ;adres data pointer
     212     110   00137 751100               mov     DATAREG,#00h            ;lower address
     213     111   0013A 120150               lcall   dataWrite
     214     112   0013D 751100               mov     DATAREG,#00h
     215     113   00140 120150               lcall   dataWrite
     216     114   00143 751224               mov     COMANDREG,#24h
     217     115   00146 12019D               lcall   comandWrite
     218     116   00149                  
     219     117   00149                      ;Display mode
     220     118   00149 751290               mov     COMANDREG,#10010000b
     221     119   0014C 12019D               lcall   comandWrite
     222     120   0014F                  
     223     121   0014F 22               ret
     224     122   00150                  
     225     123   00150                  ;------------------------------------------------------------------
     226     124   00150                  ;Data naar het schem sturen
     227     125   00150                  ;-DATAREG
     228     126   00150                  ;------------------------------------------------------------------
     229     127   00150                  DataWrite:
     230     128   00150 C0E0                 push    acc
     231     129   00152 C0D0                 push    psw
     232     130   00154 1200A2               lcall   statusCheck             ;status checken
     233     131   00157 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     234     132   0015A C2B3                 clr     CD
     235     133   0015C 00                   nop
     236     134   0015D C2B0                 clr     WR
     237     135   0015F 00                   nop
     238     136   00160 D2B0                 setb    WR
     239     137   00162 D0D0                 pop     psw
     240     138   00164 D0E0                 pop     acc
     241     139   00166 22               ret
     242     140   00167                  
     243     141   00167                  dataAutoWrite:
     244     142   00167 C0E0                 push    acc
     245     143   00169 C0D0                 push    psw
     246     144   0016B                  dataAutoWriteStatus:
     247     145   0016B 1200A2               lcall   statusCheck             ;status checken
     248     146   0016E E510                 mov     a,STA
     249     147   00170 5404                 anl     a,#04h                ;sta 2 nakijken
     250     148   00172 B404F6               cjne    a,#04h,dataAutoWriteStatus
     251     149   00175 8511C8               mov     p4_data,DATAREG         ;zet de data op de bus
     252     150   00178 C2B3                 clr     CD
     253     151   0017A 00                   nop
     254     152   0017B C2B0                 clr     WR
     255     153   0017D 00                   nop
     256     154   0017E D2B0                 setb    WR
     257     155   00180 D0D0                 pop     psw
     258     156   00182 D0E0                 pop     acc
     259     157   00184 22               ret
     260     158   00185                  
     261     159   00185                  ;------------------------------------------------------------------
     262     160   00185                  ;data van het scherm inlezen
     263     161   00185                  ;-DATAREG
     264     162   00185                  ;------------------------------------------------------------------
     265     163   00185                  DataRead:
     266     164   00185 C0E0                 push    acc
     267     165   00187 C0D0                 push    psw
     268     166   00189 1200A2               lcall   statusCheck             ;status checken
     269     167   0018C 75C900               mov     p4_dir,#000h            ;p4 als ingang
     270     168   0018F C2B3                 clr     CD
     271     169   00191 C2B1                 clr     RD
     272     170   00193 00                   nop                             ;wachten
     273     171   00194 00                   nop
     274     172   00195 85C811               mov     DATAREG,p4_data         ;data inlezeen van scherm
     275     173   00198 D0D0                 pop     psw
     276     174   0019A D0E0                 pop     acc
     277     175   0019C 22               ret
     278     176   0019D                  
     279     177   0019D                  ;------------------------------------------------------------------
     280     178   0019D                  ;comando naar het scherrm sturen
     281     179   0019D                  ;-COMANDREG
     282     180   0019D                  ;------------------------------------------------------------------
     283     181   0019D                  ComandWrite:
     284     182   0019D C0E0                 push    acc
     285     183   0019F C0D0                 push    psw
     286     184   001A1 1200A2               lcall   statusCheck             ;status checken
     287     185   001A4 8512C8               mov     p4_data,COMANDREG       ;comando op de bus zetten
     288     186   001A7 D2B3                 setb    CD
     289     187   001A9 C2B0                 clr     WR
     290     188   001AB 00                   nop
     291     189   001AC D2B0                 setb    WR
     292     190   001AE D0D0                 pop     psw
     293     191   001B0 D0E0                 pop     acc
     294     192   001B2 22               ret
     295     193   001B3                  
     296     194   001B3                  ;------------------------------------------------------------------
     297     195   001B3                  ;debug info op seriele poort zetten
     298     196   001B3                  ;-r0
     299     197   001B3                  ;------------------------------------------------------------------
     300     198   001B3                  debug:
     301     199   001B3 C0E0                 push    acc
     302     200   001B5 C0D0                 push    psw
     303     201   001B7 740D                 mov     a,#0dh
     304     202   001B9 1205C0               lcall   siooutchar
     305     203   001BC E8                   mov     a,r0
     306     204   001BD 1205DC               lcall   siooutbyte
     307     205   001C0 740A                 mov     a,#0ah
     308     206   001C2 1205C0               lcall   siooutchar
     309     207   001C5 D0D0                 pop     psw
     310     208   001C7 D0E0                 pop     acc
     311     209   001C9 22               ret
     312     210   001CA                  
     313     211   001CA                  ;------------------------------------------------------------------
     314     212   001CA                  ;lees de encoders in
     315     213   001CA                  ;------------------------------------------------------------------
     316     214   001CA                  readRotary:
     317     215   001CA                  
     318     216   001CA 22               ret
     319     217   001CB                  
     320     218   001CB                  ;------------------------------------------------------------------
     321     219   001CB                  ;laat start menu zien
     322     220   001CB                  ;------------------------------------------------------------------
     323     221   001CB                  StartMenu:
     324     222   001CB C0E0                 push    acc
     325     223   001CD C0D0                 push    psw
     326     224   001CF                  
     327     225   001CF D0D0                 pop     psw
     328     226   001D1 D0E0                 pop     acc
     329     227   001D3 22               ret
     330     228   001D4                  
     331     229   001D4                  
     332     230   001D4                  
     333     231   001D4                  
     334     232   001D4                  
     335     233   001D4                  
     336     234   001D4                  
xcez1.inc 
     338       1   001D4                  ;*******************************************************************************
     339       2   001D4                  ;
     340       3   001D4                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     341       4   001D4                  ;
     342       5   001D4                  ; The file contains drivers for various hardware and math applications.
     343       6   001D4                  ; In addition all register declarations are added.
     344       7   001D4                  ;
     345       8   001D4                  ; WARNING:!!!!!!!
     346       9   001D4                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     347      10   001D4                  ;
     348      11   001D4                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     349      12   001D4                  ;
     350      13   001D4                  ;*******************************************************************************
     351      14   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     352      15   001D4                  ;
     353      16   001D4                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     354      17   001D4                  ;
     355      18   001D4                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     356      19   001D4                  ; eenvoudige manier te gebruiken:
     357      20   001D4                  ;
     358      21   001D4                  ; standaard I/O:
     359      22   001D4                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     360      23   001D4                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     361      24   001D4                  ;      initleds             klaar zetten LED's als outputs
     362      25   001D4                  ;
     363      26   001D4                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     364      27   001D4                  ;      initiic              klaar zetten iic interface
     365      28   001D4                  ;      iicstart             genereren van een startconditie op iic poort
     366      29   001D4                  ;      iicstop              genereren stop conditie op iic poort
     367      30   001D4                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     368      31   001D4                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     369      32   001D4                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     370      33   001D4                  ;
     371      34   001D4                  ; LCD interace
     372      35   001D4                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     373      36   001D4                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     374      37   001D4                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     375      38   001D4                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     376      39   001D4                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     377      40   001D4                  ;      lcdlighton           backlight aan
     378      41   001D4                  ;      lcdlightoff          backlight uit
     379      42   001D4                  ;      lcdbuzon             buzzer aan
     380      43   001D4                  ;      lcdbuzof             buzzer uit
     381      44   001D4                  ;
     382      45   001D4                  ; Seriële interface (via USB stekker!!)
     383      46   001D4                  ;      initsio              klaar zetten seriële poort 9600 baud
     384      47   001D4                  ;      siooutchar           afdrukken ascii code (accu=input)
     385      48   001D4                  ;      siooutbyte           afdrkken getal in accu
     386      49   001D4                  ;      siooutnib            afdrukken 4 laagste bits accu
     387      50   001D4                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     388      51   001D4                  ;      sioinchar            inlezen van 1 ascii code in de accu
     389      52   001D4                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     390      53   001D4                  ;
     391      54   001D4                  ; ADC
     392      55   001D4                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     393      56   001D4                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     394      57   001D4                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     395      58   001D4                  ;
     396      59   001D4                  ; Arithmetic:
     397      60   001D4                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     398      61   001D4                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     399      62   001D4                  ;      div16                delen 2 16 bit getallen
     400      63   001D4                  ;      div32                delen 2 32 bit getallen
     401      64   001D4                  ;      add16                optellen 2 16 bit getallen
     402      65   001D4                  ;      add32                optellen 2 32 bit getallen
     403      66   001D4                  ;      sub16                verschil 2 16 bit getallen
     404      67   001D4                  ;      sub32                verschil 2 32 bit getallen
     405      68   001D4                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     406      69   001D4                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     407      70   001D4                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     408      71   001D4                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     409      72   001D4                  ;
     410      73   001D4                  ; Diverse
     411      74   001D4                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     412      75   001D4                  ;      delay1ms             tijdsverraging 1 milliseconde
     413      76   001D4                  ;      delay10us            tijdsvertraging 10 microseconde
     414      77   001D4                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     415      78   001D4                  ;	mapregs 		selecteer de SFR's in de mapped area
     416      79   001D4                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     417      80   001D4                  ;
     418      81   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     419      82   001D4                  ; LET OP!!!!
     420      83   001D4                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     421      84   001D4                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     422      85   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     423      86   001D4                  ;
     424      87   001D4                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     425      88   001D4                  ;
     426      89   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     427      90   001D4                  
     428      91   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     429      92   001D4                  ;
     430      93   001D4                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     431      94   001D4                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     432      95   001D4                  ; massa zonder extra weerstanden.
     433      96   001D4                  ;
     434      97   001D4                  ; Gebruikt geen registers
     435      98   001D4                  ;
     436      99   001D4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     437     100   001D4                  
     438     101   001D4 C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     439     102   001D6 758F04                         mov    syscon0,#004h
     440     103   001D9 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     441     104   001DB 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     442     105   001DE 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     443     106   001E1 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     444     107   001E4 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     445     108   001E7 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     446     109   001EA D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     447     110   001EC D08F                           pop    syscon0              ;pagina terug herstellen
     448     111   001EE 22                             ret
     449     112   001EF                  
     450     113   001EF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     451     114   001EF                  ;
     452     115   001EF                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     453     116   001EF                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     454     117   001EF                  ; 2 behouden hun originele instelling.
     455     118   001EF                  ;
     456     119   001EF                  ; Gebruikt geen registers
     457     120   001EF                  ;
     458     121   001EF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     459     122   001EF                  
     460     123   001EF C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     461     124   001F1 758F04                         mov    syscon0,#004h
     462     125   001F4 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     463     126   001F6 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     464     127   001F9 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     465     128   001FC 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     466     129   001FF 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     467     130   00202 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     468     131   00205 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     469     132   00207 D08F                           pop    syscon0              ;pagina terug herstellen
     470     133   00209 22                             ret
     471     134   0020A                  
     472     135   0020A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     473     136   0020A                  ;
     474     137   0020A                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     475     138   0020A                  ; worden gedoofd (actief laag om ze te laden branden).
     476     139   0020A                  ;
     477     140   0020A                  ; Gebruikt geen registers
     478     141   0020A                  ;
     479     142   0020A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     480     143   0020A                  
     481     144   0020A                  
     482     145   0020A C08F             initleds:     push   syscon0              ;juiste map selecteren
     483     146   0020C 758F04                         mov    syscon0,#004h
     484     147   0020F C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     485     148   00211 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     486     149   00214 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     487     150   00217 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     488     151   00219 D08F                           pop    syscon0              ;pagina terug herstellen
     489     152   0021B 22                             ret
     490     153   0021C                  
     491     154   0021C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     492     155   0021C                  ;
     493     156   0021C                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     494     157   0021C                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     495     158   0021C                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     496     159   0021C                  ; sda wordt als input geschakeld
     497     160   0021C                  ;
     498     161   0021C                  ; LET OP!!
     499     162   0021C                  ; Dit is een IIC bus met beperkte mogelijkheden:
     500     163   0021C                  ; -vaste communicatiesnleheid van 100kbit/s
     501     164   0021C                  ; -enkel master mode
     502     165   0021C                  ; -enkel 7 bit adressering
     503     166   0021C                  ; -geen klok stretching
     504     167   0021C                  ;
     505     168   0021C                  ; Gebruikt geen registers
     506     169   0021C                  ;
     507     170   0021C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     508     171   0021C                  
     509     172   0021C                  sda           bit    p0_data.7            ;pin gebruikt als sda
     510     173   0021C                  scl           bit    p0_data.3            ;pin gebruikt als scl
     511     174   0021C                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     512     175   0021C                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     513     176   0021C                  
     514     177   0021C C08F             initiic:      push   syscon0              ;juiste map selecteren
     515     178   0021E 758F04                         mov    syscon0,#004h
     516     179   00221 C0B2                           push   port_page
     517     180   00223 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     518     181   00226 D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     519     182   00228 D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     520     183   0022A 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     521     184   0022D D283                           setb   scl                  ;klok werkt als od
     522     185   0022F D287                           setb   sda                  ;sda werkt als od
     523     186   00231 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     524     187   00234 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     525     188   00237 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     526     189   0023A D0B2                           pop    port_page            ;pagina herstellen
     527     190   0023C D08F                           pop    syscon0              ;map herstellen
     528     191   0023E 22                             ret
     529     192   0023F                  
     530     193   0023F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     531     194   0023F                  ;
     532     195   0023F                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     533     196   0023F                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     534     197   0023F                  ; te garanderen volgt er een delay van 10us
     535     198   0023F                  ;
     536     199   0023F                  ; Gebruikt geen registers
     537     200   0023F                  ;
     538     201   0023F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     539     202   0023F                  
     540     203   0023F C08F             iicstart:     push   syscon0              ;map bewaren
     541     204   00241 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     542     205   00244 C0B2                           push   port_page            ;pagina bewaren
     543     206   00246 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     544     207   00249 D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     545     208   0024B D287                           setb   sda                  ;idem
     546     209   0024D 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     547     210   00250 120340                         lcall  delay10us            ;
     548     211   00253 C287                           clr    sda                  ;data laag
     549     212   00255 120340                         lcall  delay10us
     550     213   00258 C283                           clr    scl                  ;dan klok laag
     551     214   0025A 120340                         lcall  delay10us            ;bit lang genoeg maken
     552     215   0025D D0B2                           pop    port_page            ;registers herstellen
     553     216   0025F D08F                           pop    syscon0
     554     217   00261 22                             ret
     555     218   00262                  
     556     219   00262                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     557     220   00262                  ;
     558     221   00262                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     559     222   00262                  ;
     560     223   00262                  ; Gebruikt geen registers
     561     224   00262                  ;
     562     225   00262                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     563     226   00262                  
     564     227   00262 C08F             iicstop:      push   syscon0              ;map bewaren
     565     228   00264 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     566     229   00267 C0B2                           push   port_page            ;pagina bewaren
     567     230   00269 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     568     231   0026C 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     569     232   0026F C287                           clr    sda                  ;data naar omlaag
     570     233   00271 120340                         lcall  delay10us
     571     234   00274 D283                           setb   scl                  ;klok naar 1
     572     235   00276 120340                         lcall  delay10us            ;wachten
     573     236   00279 D287                           setb   sda                  ;idem data
     574     237   0027B 120340                         lcall  delay10us            ;
     575     238   0027E 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     576     239   00281 D0B2                           pop    port_page            ;registers herstellen
     577     240   00283 D08F                           pop    syscon0
     578     241   00285 22                             ret
     579     242   00286                  
     580     243   00286                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     581     244   00286                  ;
     582     245   00286                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     583     246   00286                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     584     247   00286                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     585     248   00286                  ;
     586     249   00286                  ; Gebruikt:
     587     250   00286                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     588     251   00286                  ;      cy=ack bit vanuit de slave
     589     252   00286                  ;
     590     253   00286                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     591     254   00286                  
     592     255   00286 C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     593     256   00288 C0F0                           push   b                    ;gebruikt als loopcounter
     594     257   0028A C08F                           push   syscon0              ;map juist zetten
     595     258   0028C 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     596     259   0028F C0B2                           push   port_page            ;poort pagina bewaren
     597     260   00291 75B200                         mov    port_page,#000h      ;basispagina selecteren
     598     261   00294 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     599     262   00297 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     600     263   0029A 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     601     264   0029B 9287                           mov    sda,c                ;op pin
     602     265   0029D 120340                         lcall  delay10us            ;wachten
     603     266   002A0 D283                           setb   scl                  ;puls genereren
     604     267   002A2 120340                         lcall  delay10us            ;ook hier wat tijd laten
     605     268   002A5 C283                           clr    scl                  ;klok terug laag maken
     606     269   002A7 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     607     270   002AA                  
     608     271   002AA                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     609     272   002AA                  
     610     273   002AA 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     611     274   002AD 120340                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     612     275   002B0 D283                           setb   scl                  ;puls terug hoog
     613     276   002B2 A287                           mov    c,sda                ;inlezen en naar carry
     614     277   002B4 120340                         lcall  delay10us
     615     278   002B7 C283                           clr    scl                  ;klok blijft laag achter
     616     279   002B9 D0B2                           pop    port_page
     617     280   002BB D08F                           pop    syscon0
     618     281   002BD D0F0                           pop    b
     619     282   002BF D0E0                           pop    acc
     620     283   002C1 22                             ret
     621     284   002C2                  
     622     285   002C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     623     286   002C2                  ;
     624     287   002C2                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     625     288   002C2                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     626     289   002C2                  ;
     627     290   002C2                  ; Gebruikt:
     628     291   002C2                  ;      -de accu als output
     629     292   002C2                  ;
     630     293   002C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     631     294   002C2                  
     632     295   002C2 C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     633     296   002C4 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     634     297   002C7 C0B2                           push   port_page            ;pagina bewaren
     635     298   002C9 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     636     299   002CC C0F0                           push   b                    ;wordt gebruikt als loopcounter
     637     300   002CE C0D0                           push   psw                  ;vlaggen bewaren
     638     301   002D0 75F008                         mov    b,#008h              ;loopcounter laden
     639     302   002D3 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     640     303   002D6 120340           iicinbyteack1:lcall  delay10us
     641     304   002D9 D283                           setb   scl                  ;klok hoog
     642     305   002DB A287                           mov    c,sda                ;pin inlezen
     643     306   002DD 33                             rlc    a                    ;in accu shiften
     644     307   002DE 120340                         lcall  delay10us
     645     308   002E1 C283                           clr    scl                  ;klok terug laag
     646     309   002E3 D5F0F0                         djnz   b,iicinbyteack1
     647     310   002E6 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     648     311   002E9 C287                           clr    sda                  ;ack genereren
     649     312   002EB 120340                         lcall  delay10us
     650     313   002EE D283                           setb   scl
     651     314   002F0 120340                         lcall  delay10us
     652     315   002F3 C283                           clr    scl
     653     316   002F5 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     654     317   002F8 D0D0                           pop    psw                  ;registers herstellen
     655     318   002FA D0F0                           pop    b
     656     319   002FC D0B2                           pop    port_page
     657     320   002FE D08F                           pop    syscon0
     658     321   00300 22                             ret
     659     322   00301                  
     660     323   00301                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     661     324   00301                  ;
     662     325   00301                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     663     326   00301                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     664     327   00301                  ;
     665     328   00301                  ; Gebruikt:
     666     329   00301                  ;      -de accu als output
     667     330   00301                  ;
     668     331   00301                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     669     332   00301                  
     670     333   00301 C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     671     334   00303 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     672     335   00306 C0B2                           push   port_page            ;pagina bewaren
     673     336   00308 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     674     337   0030B C0F0                           push   b                    ;wordt gebruikt als loopcounter
     675     338   0030D C0D0                           push   psw                  ;vlaggen bewaren
     676     339   0030F 75F008                         mov    b,#008h              ;loopcounter laden
     677     340   00312 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     678     341   00315 120340           iicinbytenack1:lcall  delay10us
     679     342   00318 D283                           setb   scl                  ;klok hoog
     680     343   0031A A287                           mov    c,sda                ;pin inlezen
     681     344   0031C 33                             rlc    a                    ;in accu shiften
     682     345   0031D 120340                         lcall  delay10us
     683     346   00320 C283                           clr    scl                  ;klok terug laag
     684     347   00322 D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     685     348   00325 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     686     349   00328 D287                           setb   sda                  ;nack genereren
     687     350   0032A 120340                         lcall  delay10us
     688     351   0032D D283                           setb   scl
     689     352   0032F 120340                         lcall  delay10us
     690     353   00332 C283                           clr    scl
     691     354   00334 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     692     355   00337 D0D0                           pop    psw                  ;registers herstellen
     693     356   00339 D0F0                           pop    b
     694     357   0033B D0B2                           pop    port_page
     695     358   0033D D08F                           pop    syscon0
     696     359   0033F 22                             ret
     697     360   00340                  
     698     361   00340                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     699     362   00340                  ;
     700     363   00340                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     701     364   00340                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     702     365   00340                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     703     366   00340                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     704     367   00340                  ;
     705     368   00340                  ; Gebruikt geen registers
     706     369   00340                  ;
     707     370   00340                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     708     371   00340                  
     709     372   00340 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     710     373   00342 C0D0                           push   psw                  ;8*42ns=330ns
     711     374   00344 75E01A                         mov    acc,#01ah            ;420ns
     712     375   00347 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     713     376   0034A D0D0                           pop    psw                  ;8*42ns=330ns
     714     377   0034C D0E0                           pop    acc                  ;8*42ns=330ns
     715     378   0034E 22                             ret                         ;165ns
     716     379   0034F                  
     717     380   0034F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     718     381   0034F                  ;
     719     382   0034F                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     720     383   0034F                  ;
     721     384   0034F                  ; Gebruikt geen registers
     722     385   0034F                  ;
     723     386   0034F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     724     387   0034F                  
     725     388   0034F C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     726     389   00351 C0D0                           push   psw
     727     390   00353 C0F0                           push   b
     728     391   00355 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     729     392   00358 120368           delaya0k05s1: lcall  delay1ms
     730     393   0035B D5F0FA                         djnz   b,delaya0k05s1
     731     394   0035E D5E0F4                         djnz   acc,delaya0k05s2
     732     395   00361 D0F0                           pop    b                    ;registers herstellen
     733     396   00363 D0D0                           pop    psw
     734     397   00365 D0E0                           pop    acc
     735     398   00367 22                             ret
     736     399   00368                  
     737     400   00368                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     738     401   00368                  ;
     739     402   00368                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     740     403   00368                  ;
     741     404   00368                  ; Gebruikt geen registers
     742     405   00368                  ;
     743     406   00368                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     744     407   00368                  
     745     408   00368 C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     746     409   0036A C0D0                           push   psw                  ;8*42ns=330ns
     747     410   0036C 75E064                         mov    acc,#100             ;420ns
     748     411   0036F 120340           delay1ms1:    lcall  delay10us            ;10us
     749     412   00372 D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     750     413   00375 D0D0                           pop    psw                  ;8*42ns=330ns
     751     414   00377 D0E0                           pop    acc                  ;8*42ns=330ns
     752     415   00379 22                             ret                         ;165ns
     753     416   0037A                  
     754     417   0037A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     755     418   0037A                  ;
     756     419   0037A                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     757     420   0037A                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     758     421   0037A                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     759     422   0037A                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     760     423   0037A                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     761     424   0037A                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     762     425   0037A                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     763     426   0037A                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     764     427   0037A                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     765     428   0037A                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     766     429   0037A                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     767     430   0037A                  ; systemen!!!!
     768     431   0037A                  ;
     769     432   0037A                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     770     433   0037A                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     771     434   0037A                  ;       aduclcd0.inc
     772     435   0037A                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     773     436   0037A                  ;       aduclcd1.inc
     774     437   0037A                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     775     438   0037A                  ;
     776     439   0037A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     777     440   0037A                  
     778     441   0037A                  e             bit    b.1                  ;enable
     779     442   0037A                  rs            bit    b.0                  ;register select
     780     443   0037A                  backlight     bit    b.6                  ;bit waar backlight op zit
     781     444   0037A                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     782     445   0037A                  
     783     446   0037A                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     784     447   0037A                  
     785     448   0037A                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     786     449   0037A                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     787     450   0037A                  
     788     451   0037A                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     789     452   0037A                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     790     453   0037A                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     791     454   0037A                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     792     455   0037A                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     793     456   0037A                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     794     457   0037A                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     795     458   0037A                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     796     459   0037A                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     797     460   0037A                  
     798     461   0037A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     799     462   0037A                  ;
     800     463   0037A                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     801     464   0037A                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     802     465   0037A                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     803     466   0037A                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     804     467   0037A                  ;
     805     468   0037A                  ; registergebruik: geen
     806     469   0037A                  ;
     807     470   0037A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     808     471   0037A                  
     809     472   0037A C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     810     473   0037C C0D0                           push   psw
     811     474   0037E C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     812     475   00380 12021C                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     813     476   00383 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     814     477   00386                                                            ;buzzer en baklight worden nu op 1 gezet
     815     478   00386 12051E                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     816     479   00389 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     817     480   0038B 120517           initlcd1:     lcall  delay2ms
     818     481   0038E D5E0FA                         djnz   acc,initlcd1
     819     482   00391 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     820     483   00393 1204D6                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     821     484   00396 120517                         lcall  delay2ms      ;te krijgen.
     822     485   00399 7430                           mov    a,#00110000b
     823     486   0039B 1204D6                         lcall  outhnibc
     824     487   0039E 120517                         lcall  delay2ms
     825     488   003A1 7430                           mov    a,#00110000b
     826     489   003A3 1204D6                         lcall  outhnibc
     827     490   003A6 120517                         lcall  delay2ms
     828     491   003A9 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     829     492   003AB 1204D6                         lcall  outhnibc      ;hoge nibble naar het controleregister
     830     493   003AE 120517                         lcall  delay2ms      ;niet nodig volgens datasheet
     831     494   003B1 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     832     495   003B3 1204C0                         lcall  outc          ;naar display
     833     496   003B6 120517                         lcall  delay2ms      ;is iets te lang volgens datasheet
     834     497   003B9 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     835     498   003BB 1204C0                         lcall  outc
     836     499   003BE 120517                         lcall  delay2ms      ;ook deze delay is iets te lang
     837     500   003C1 7401                           mov    a,#displayon  ;clear display and home cursor
     838     501   003C3 1204C0                         lcall  outc
     839     502   003C6 120517                         lcall  delay2ms      ;deze wachttijd is bijna juist
     840     503   003C9 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     841     504   003CB 1204C0                         lcall  outc
     842     505   003CE 120517                         lcall  delay2ms      ;wachten weer veel te lang
     843     506   003D1 D0F0                           pop    b             ;registers terug in orde zetten
     844     507   003D3 D0D0                           pop    psw
     845     508   003D5 D0E0                           pop    acc
     846     509   003D7 22                             ret                  ;einde van de initialisatie
     847     510   003D8                  
     848     511   003D8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     849     512   003D8                  ;
     850     513   003D8                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     851     514   003D8                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     852     515   003D8                  ;      00dh   =cursor in de home positie
     853     516   003D8                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     854     517   003D8                  ;      00ah   =cursor op tweede lijn plaatsen
     855     518   003D8                  ;      001h   =cursor on blink
     856     519   003D8                  ;      002h   =cursor on, no blink
     857     520   003D8                  ;      003h   =cursor off
     858     521   003D8                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     859     522   003D8                  ;
     860     523   003D8                  ; de routine gebruikt geen registers
     861     524   003D8                  ;
     862     525   003D8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     863     526   003D8                  
     864     527   003D8                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     865     528   003D8                  ; dan mag de data direct naar het dataregister van het scherm.
     866     529   003D8                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     867     530   003D8                  
     868     531   003D8                  lcdoutchar:
     869     532   003D8 C0E0             outcharlcd:   push   acc           ;registers op stack
     870     533   003DA C0D0                           push   psw
     871     534   003DC B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     872     535   003DF 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     873     536   003E1 B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     874     537   003E4 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     875     538   003E6                  
     876     539   003E6                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     877     540   003E6                  ; Het is dus een opdracht die we moeten uitvoeren.
     878     541   003E6                  
     879     542   003E6 B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     880     543   003E9 7401                           mov    a,#cleardisp         ;scherm leegmaken
     881     544   003EB 1204C0                         lcall  outc                 ;naar controleregister
     882     545   003EE 803A                           sjmp   outcharlcde          ;afsluiten
     883     546   003F0                  
     884     547   003F0 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     885     548   003F3 740F                           mov    a,#cursoronb         ;cursoron met blink
     886     549   003F5 1204C0                         lcall  outc
     887     550   003F8 8030                           sjmp   outcharlcde
     888     551   003FA                  
     889     552   003FA B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     890     553   003FD 740E                           mov    a,#cursoronn         ;cursoron no blink
     891     554   003FF 1204C0                         lcall  outc
     892     555   00402 8026                           sjmp   outcharlcde
     893     556   00404                  
     894     557   00404 B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     895     558   00407 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     896     559   00409 1204C0                         lcall  outc
     897     560   0040C 801C                           sjmp   outcharlcde
     898     561   0040E                  
     899     562   0040E B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     900     563   00411 7402                           mov    a,#cursathom         ;cursor in home positie
     901     564   00413 1204C0                         lcall  outc
     902     565   00416 8012                           sjmp   outcharlcde
     903     566   00418                  
     904     567   00418 B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     905     568   0041B                                                            ;tweede lijn
     906     569   0041B 74C0                           mov    a,#0c0h
     907     570   0041D 1204C0                         lcall  outc
     908     571   00420 8008                           sjmp   outcharlcde
     909     572   00422                  
     910     573   00422                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     911     574   00422                  ; is. dit mag naar het data register.
     912     575   00422                  
     913     576   00422 120486           outcharlcd8:  lcall  outd          ;klaar
     914     577   00425 8003                           sjmp   outcharlcde   ;einde routine
     915     578   00427                  
     916     579   00427                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     917     580   00427                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     918     581   00427                  ; te schrijven.
     919     582   00427                  
     920     583   00427 1204C0           outcharlcd9:  lcall  outc          ;klaar
     921     584   0042A D0D0             outcharlcde:  pop    psw           ;registers herstellen
     922     585   0042C D0E0                           pop    acc
     923     586   0042E 22                             ret
     924     587   0042F                  
     925     588   0042F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     926     589   0042F                  ;
     927     590   0042F                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     928     591   0042F                  ; op het lcd scherm.
     929     592   0042F                  ;
     930     593   0042F                  ; de routine gebruikt geen registers
     931     594   0042F                  ;
     932     595   0042F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     933     596   0042F                  
     934     597   0042F                  lcdoutnib:
     935     598   0042F C0E0             outniblcd:    push   acc           ;registers op stack zetten
     936     599   00431 C0D0                           push   psw
     937     600   00433 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     938     601   00435 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     939     602   00437 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     940     603   0043A 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     941     604   0043C 2407                           add    a,#007h       ;omvormen naar hoofdletter
     942     605   0043E 120486           outniblcde:   lcall  outd          ;naar het scherm
     943     606   00441 D0D0                           pop    psw
     944     607   00443 D0E0                           pop    acc
     945     608   00445 22                             ret
     946     609   00446                  
     947     610   00446                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     948     611   00446                  ;
     949     612   00446                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     950     613   00446                  ;
     951     614   00446                  ; de routine gebruikt geen registers
     952     615   00446                  ;
     953     616   00446                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     954     617   00446                  
     955     618   00446                  lcdoutbyte:
     956     619   00446 C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     957     620   00448 C0D0                           push   psw
     958     621   0044A C4                             swap   a             ;bitjes omruilen
     959     622   0044B 12042F                         lcall  outniblcd
     960     623   0044E C4                             swap   a             ;nog eens
     961     624   0044F 12042F                         lcall  outniblcd
     962     625   00452 D0D0                           pop    psw
     963     626   00454 D0E0                           pop    acc
     964     627   00456 22                             ret
     965     628   00457                  
     966     629   00457                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     967     630   00457                  ;
     968     631   00457                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     969     632   00457                  ;
     970     633   00457                  ; de routine gebruikt geen registers
     971     634   00457                  ;
     972     635   00457                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     973     636   00457                  
     974     637   00457                  lcddispdptr:
     975     638   00457 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     976     639   00459 C0D0                           push   psw
     977     640   0045B E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     978     641   0045D 120446                         lcall  outbytelcd
     979     642   00460 E582                           mov    a,dpl         ;dan het lage deel
     980     643   00462 120446                         lcall  outbytelcd
     981     644   00465 D0D0                           pop    psw
     982     645   00467 D0E0                           pop    acc
     983     646   00469 22                             ret
     984     647   0046A                  
     985     648   0046A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     986     649   0046A                  ;
     987     650   0046A                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     988     651   0046A                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     989     652   0046A                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     990     653   0046A                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     991     654   0046A                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     992     655   0046A                  ;
     993     656   0046A                  ; de routine gebruikt geen registers
     994     657   0046A                  ;
     995     658   0046A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     996     659   0046A                  
     997     660   0046A                  lcdoutmsga:
     998     661   0046A C0E0             outmsgalcd:   push   acc           ;registers op de stack
     999     662   0046C C0D0                           push   psw
    1000     663   0046E C083                           push   dph           ;ook de data pointer
    1001     664   00470 C082                           push   dpl
    1002     665   00472                  
    1003     666   00472                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
    1004     667   00472                  
    1005     668   00472 E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
    1006     669   00473 93                             movc   a,@a+dptr     ;waarde lezen
    1007     670   00474 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
    1008     671   00476                  
    1009     672   00476                  ; de code is niet 0 dus versturen met outchar
    1010     673   00476                  
    1011     674   00476 1203D8                         lcall  outcharlcd    ;weg er mee
    1012     675   00479 A3                             inc    dptr          ;naar volgende ascii code wijzen
    1013     676   0047A 020472                         ljmp   outmsgalcd1   ;lus sluiten
    1014     677   0047D                  
    1015     678   0047D D082             outmsgalcde:  pop    dpl           ;registers herstellen
    1016     679   0047F D083                           pop    dph
    1017     680   00481 D0D0                           pop    psw
    1018     681   00483 D0E0                           pop    acc
    1019     682   00485 22                             ret
    1020     683   00486                  
    1021     684   00486                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1022     685   00486                  ;
    1023     686   00486                  ; outd is een routine die naar het data register van het display een
    1024     687   00486                  ; volledige byte stuurt.
    1025     688   00486                  ;
    1026     689   00486                  ; De routine gebruikt geen registers.
    1027     690   00486                  ;
    1028     691   00486                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1029     692   00486                  
    1030     693   00486 C0E0             outd:         push   acc           ;registers op stack zetten
    1031     694   00488 C0D0                           push   psw
    1032     695   0048A 120496                         lcall  outhnibd      ;hoogste vier bits verzenden
    1033     696   0048D C4                             swap   a             ;bitjes omruilen
    1034     697   0048E 120496                         lcall  outhnibd      ;naar het scherm sturen
    1035     698   00491 D0D0                           pop    psw           ;registers terug herstellen
    1036     699   00493 D0E0                           pop    acc
    1037     700   00495 22                             ret
    1038     701   00496                  
    1039     702   00496                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1040     703   00496                  ;
    1041     704   00496                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
    1042     705   00496                  ; lcd scherm.
    1043     706   00496                  ;
    1044     707   00496                  ; de routine gebruikt geen registers.
    1045     708   00496                  ;
    1046     709   00496                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1047     710   00496                  
    1048     711   00496 C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
    1049     712   00498 C0D0                           push   psw
    1050     713   0049A C0F0                           push   b             ;werkregister
    1051     714   0049C 120537                         lcall  lcdtoport     ;lees de expander naar b register
    1052     715   0049F D2F0                           setb   rs            ;controle lijn in orde
    1053     716   004A1 C2F1                           clr    e             ;deselectie display
    1054     717   004A3 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1055     718   004A5 03                             rr     a             ;bits op juiste plaats zetten
    1056     719   004A6 03                             rr     a             ;voor b reg
    1057     720   004A7 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1058     721   004AA 42F0                           orl    b,a           ;bij elkaar voegen
    1059     722   004AC 12051E                         lcall  porttolcd     ;naar expnder
    1060     723   004AF D2F1                           setb   e             ;display enabelen
    1061     724   004B1 12051E                         lcall  porttolcd
    1062     725   004B4 C2F1                           clr    e             ;display deselecteren
    1063     726   004B6 12051E                         lcall  porttolcd
    1064     727   004B9 D0F0                           pop    b
    1065     728   004BB D0D0                           pop    psw           ;registers herstellen
    1066     729   004BD D0E0                           pop    acc
    1067     730   004BF 22                             ret
    1068     731   004C0                  
    1069     732   004C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1070     733   004C0                  ;
    1071     734   004C0                  ; outc is een routine die naar het controleregister van het display een
    1072     735   004C0                  ; volledige byte stuurt.
    1073     736   004C0                  ;
    1074     737   004C0                  ; De routine gebruikt geen registers.
    1075     738   004C0                  ;
    1076     739   004C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1077     740   004C0                  
    1078     741   004C0 C0E0             outc:         push   acc           ;registers op stack zetten
    1079     742   004C2 C0D0                           push   psw
    1080     743   004C4 1204D6                         lcall  outhnibc      ;hoogste vier bits verzenden
    1081     744   004C7 120517                         lcall  delay2ms      ;niet echt nodig
    1082     745   004CA C4                             swap   a             ;bitjes omruilen
    1083     746   004CB 1204D6                         lcall  outhnibc      ;naar het scherm sturen
    1084     747   004CE 120517                         lcall  delay2ms      ;altijd goed voor traagste commando
    1085     748   004D1 D0D0                           pop    psw           ;registers terug herstellen
    1086     749   004D3 D0E0                           pop    acc
    1087     750   004D5 22                             ret
    1088     751   004D6                  
    1089     752   004D6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1090     753   004D6                  ;
    1091     754   004D6                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1092     755   004D6                  ; lcd scherm.
    1093     756   004D6                  ;
    1094     757   004D6                  ; de routine gebruikt geen registers.
    1095     758   004D6                  ;
    1096     759   004D6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1097     760   004D6                  
    1098     761   004D6 C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1099     762   004D8 C0D0                           push   psw
    1100     763   004DA C0F0                           push   b             ;werkregister
    1101     764   004DC 120537                         lcall  lcdtoport     ;lees de expander naar b register
    1102     765   004DF C2F0                           clr    rs            ;controle lijn in orde
    1103     766   004E1 C2F1                           clr    e             ;deselectie display
    1104     767   004E3 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1105     768   004E5 03                             rr     a             ;bits op juiste plaats zetten
    1106     769   004E6 03                             rr     a             ;voor b reg
    1107     770   004E7 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1108     771   004EA 42F0                           orl    b,a           ;bij elkaar voegen
    1109     772   004EC 12051E                         lcall  porttolcd     ;naar expnder
    1110     773   004EF D2F1                           setb   e             ;display enabelen
    1111     774   004F1 12051E                         lcall  porttolcd
    1112     775   004F4 C2F1                           clr    e             ;display deselecteren
    1113     776   004F6 12051E                         lcall  porttolcd
    1114     777   004F9 D0F0                           pop    b
    1115     778   004FB D0D0                           pop    psw           ;registers herstellen
    1116     779   004FD D0E0                           pop    acc
    1117     780   004FF 22                             ret
    1118     781   00500                  
    1119     782   00500                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1120     783   00500                  ;
    1121     784   00500                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1122     785   00500                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1123     786   00500                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1124     787   00500                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1125     788   00500                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1126     789   00500                  ; DATA GESCHREVEN.
    1127     790   00500                  ;
    1128     791   00500                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1129     792   00500                  
    1130     793   00500 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1131     794   00502 1204C0           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1132     795   00505 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1133     796   00507 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1134     797   00508 120486                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1135     798   0050B 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1136     799   0050E A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1137     800   0050F 80F4                           SJMP   BUILD3
    1138     801   00511 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1139     802   00513 1204C0                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1140     803   00516 22                             RET                  ;EINDE VAN DE ROUTINE
    1141     804   00517                  
    1142     805   00517                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1143     806   00517                  ;
    1144     807   00517                  ; Delay2ms is een vertragingsroutine van 2ms.
    1145     808   00517                  ;
    1146     809   00517                  ; De routine gebruikt geen registers.
    1147     810   00517                  ;
    1148     811   00517                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1149     812   00517                  
    1150     813   00517 120368           delay2ms:     lcall  delay1ms
    1151     814   0051A 120368                         lcall  delay1ms
    1152     815   0051D 22                             ret
    1153     816   0051E                  
    1154     817   0051E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1155     818   0051E                  ;
    1156     819   0051E                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1157     820   0051E                  ; scherm stuurt via de port expander.
    1158     821   0051E                  ;
    1159     822   0051E                  ; Gebruikt geen registers
    1160     823   0051E                  ;
    1161     824   0051E                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1162     825   0051E                  
    1163     826   0051E C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1164     827   00520 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1165     828   00522 12023F                         lcall  iicstart      ;vertrokken
    1166     829   00525 7440                           mov    a,#01000000b  ;schrijven naar expander
    1167     830   00527 120286                         lcall  iicoutbyte    ;weg er mee
    1168     831   0052A E5F0                           mov    a,b           ;data verzenden
    1169     832   0052C 120286                         lcall  iicoutbyte
    1170     833   0052F 120262                         lcall  iicstop       ;transactie sluiten
    1171     834   00532 D0D0                           pop    psw
    1172     835   00534 D0E0                           pop    acc
    1173     836   00536 22                             ret
    1174     837   00537                  
    1175     838   00537                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1176     839   00537                  ;
    1177     840   00537                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1178     841   00537                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1179     842   00537                  ; van buzzet en backlight is.
    1180     843   00537                  ;
    1181     844   00537                  ; Gebruikt b register
    1182     845   00537                  ;
    1183     846   00537                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1184     847   00537                  
    1185     848   00537 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1186     849   00539 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1187     850   0053B 12023F                         lcall  iicstart      ;vertrokken
    1188     851   0053E 7441                           mov    a,#01000001b  ;lezen van expander
    1189     852   00540 120286                         lcall  iicoutbyte    ;weg er mee
    1190     853   00543 120301                         lcall  iicinbytenack ;data inlezen
    1191     854   00546 120262                         lcall  iicstop
    1192     855   00549 F5F0                           mov    b,a
    1193     856   0054B D0D0                           pop    psw
    1194     857   0054D D0E0                           pop    acc
    1195     858   0054F 22                             ret
    1196     859   00550                  
    1197     860   00550                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1198     861   00550                  ;
    1199     862   00550                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1200     863   00550                  ;
    1201     864   00550                  ; Gebruikt geen registers
    1202     865   00550                  ;
    1203     866   00550                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1204     867   00550                  
    1205     868   00550 C0F0             lcdlighton:   push   b
    1206     869   00552 120537                         lcall  lcdtoport     ;expander lezen
    1207     870   00555 C2F6                           clr    b.6           ;licht aan doen
    1208     871   00557 12051E                         lcall  porttolcd     ;expander scrijven
    1209     872   0055A D0F0                           pop    b
    1210     873   0055C 22                             ret
    1211     874   0055D                  
    1212     875   0055D                  
    1213     876   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1214     877   0055D                  ;
    1215     878   0055D                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1216     879   0055D                  ;
    1217     880   0055D                  ; Gebruikt geen registers
    1218     881   0055D                  ;
    1219     882   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1220     883   0055D                  
    1221     884   0055D C0F0             lcdlightoff:  push   b
    1222     885   0055F 120537                         lcall  lcdtoport     ;expander lezen
    1223     886   00562 D2F6                           setb   b.6           ;licht uit doen
    1224     887   00564 12051E                         lcall  porttolcd     ;expander scrijven
    1225     888   00567 D0F0                           pop    b
    1226     889   00569 22                             ret
    1227     890   0056A                  
    1228     891   0056A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1229     892   0056A                  ;
    1230     893   0056A                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1231     894   0056A                  ;
    1232     895   0056A                  ; Gebruikt geen registers
    1233     896   0056A                  ;
    1234     897   0056A                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1235     898   0056A                  
    1236     899   0056A C0F0             lcdbuzon:     push   b
    1237     900   0056C 120537                         lcall  lcdtoport     ;expander lezen
    1238     901   0056F C2F7                           clr    b.7           ;buzzer aan doen
    1239     902   00571 12051E                         lcall  porttolcd     ;expander scrijven
    1240     903   00574 D0F0                           pop    b
    1241     904   00576 22                             ret
    1242     905   00577                  
    1243     906   00577                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1244     907   00577                  ;
    1245     908   00577                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1246     909   00577                  ;
    1247     910   00577                  ; Gebruikt geen registers
    1248     911   00577                  ;
    1249     912   00577                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1250     913   00577                  
    1251     914   00577 C0F0             lcdbuzoff:    push   b
    1252     915   00579 120537                         lcall  lcdtoport     ;expander lezen
    1253     916   0057C D2F7                           setb   b.7           ;buzzer aan doen
    1254     917   0057E 12051E                         lcall  porttolcd     ;expander scrijven
    1255     918   00581 D0F0                           pop    b
    1256     919   00583 22                             ret
    1257     920   00584                  
    1258     921   00584                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1259     922   00584                  ;
    1260     923   00584                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1261     924   00584                  ; een standaard com poort op 9600 baud.
    1262     925   00584                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1263     926   00584                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1264     927   00584                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1265     928   00584                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1266     929   00584                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1267     930   00584                  ; NIET door deze routine.
    1268     931   00584                  ;
    1269     932   00584                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1270     933   00584                  ;
    1271     934   00584                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1272     935   00584                  
    1273     936   00584                  blank         equ    020h          ;ascii code voor een blank
    1274     937   00584                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1275     938   00584                  ff            equ    00ch          ;ascii code voor nieuw blad
    1276     939   00584                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1277     940   00584                  lf            equ    00ah          ;ascii code voor volgende lijn
    1278     941   00584                  backsp        equ    008h          ;ascii code voor het bs karakter
    1279     942   00584                  beep          equ    007h          ;ascii code voor een beep
    1280     943   00584                  
    1281     944   00584 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1282     945   00588                                                                          ;van het scherm
    1283     946   00588                  
    1284     947   00588                  strtbuf       equ     054h         ;start adres van de buffer
    1285     948   00588                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1286     949   00588                  
    1287     950   00588                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1288     951   00588                  ;
    1289     952   00588                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1290     953   00588                  ;
    1291     954   00588                  ; Gebruikt geen registers
    1292     955   00588                  ;
    1293     956   00588                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1294     957   00588                  
    1295     958   00588 C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1296     959   0058A C08F                           push   syscon0              ;map bewaren
    1297     960   0058C 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1298     961   0058F C0B2                           push   port_page            ;pagina op stack zetten
    1299     962   00591 C0BF                           push   scu_page
    1300     963   00593 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1301     964   00596                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1302     965   00596                  ;      -p1.0 als input en alt1 selectie
    1303     966   00596                  ;      -p1.1 als output en alt2 selectie
    1304     967   00596                  
    1305     968   00596 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1306     969   00599 5390FD                         anl    p1_altsel0,#11111101b
    1307     970   0059C 439001                         orl    p1_altsel0,#00000001b
    1308     971   0059F 5391FE                         anl    p1_altsel1,#11111110b
    1309     972   005A2 439102                         orl    p1_altsel1,#00000010b
    1310     973   005A5 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1311     974   005A8 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1312     975   005AB 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1313     976   005AE                  
    1314     977   005AE                  ; Nu moet de baud rate generator ingesteld worden
    1315     978   005AE                  ; We gaan er van uit dat de systeemklok 24MHz is
    1316     979   005AE                  
    1317     980   005AE 759850                         mov    scon,#01010000b      ;UART initialiseren
    1318     981   005B1                  
    1319     982   005B1                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1320     983   005B1                  ; gebruikt!!
    1321     984   005B1                  
    1322     985   005B1 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1323     986   005B4 75BD11                         mov    bcon,#00010001b
    1324     987   005B7 D0BF                           pop    scu_page
    1325     988   005B9 D0B2                           pop    port_page            ;alles terug herstellen
    1326     989   005BB D08F                           pop    syscon0
    1327     990   005BD D0E0                           pop    acc
    1328     991   005BF 22                             ret
    1329     992   005C0                  
    1330     993   005C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1331     994   005C0                  ;
    1332     995   005C0                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1333     996   005C0                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1334     997   005C0                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1335     998   005C0                  ;
    1336     999   005C0                  ; de routine gebruikt geen registers.
    1337    1000   005C0                  ;
    1338    1001   005C0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1339    1002   005C0                  
    1340    1003   005C0                  siooutchar:
    1341    1004   005C0 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1342    1005   005C2 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1343    1006   005C5 C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1344    1007   005C7 22                             RET
    1345    1008   005C8                  
    1346    1009   005C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1347    1010   005C8                  ;
    1348    1011   005C8                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1349    1012   005C8                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1350    1013   005C8                  ;
    1351    1014   005C8                  ; de routine gebruikt geen registers.
    1352    1015   005C8                  ;
    1353    1016   005C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1354    1017   005C8                  
    1355    1018   005C8                  siooutnib:
    1356    1019   005C8 C0E0             OUTNIB:       push   acc           ;registers op de stack
    1357    1020   005CA C0D0                           push   psw
    1358    1021   005CC 540F                           ANL    A,#00FH       ;AFZONDEREN
    1359    1022   005CE 1206B8                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1360    1023   005D1 1205C0                         LCALL  OUTCHAR       ;VERSTUREN
    1361    1024   005D4 120621                         LCALL  XONXOFF       ;FLOW CONTROL
    1362    1025   005D7 D0D0                           pop    psw           ;registers herstellen
    1363    1026   005D9 D0E0                           pop    acc
    1364    1027   005DB 22                             RET
    1365    1028   005DC                  
    1366    1029   005DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1367    1030   005DC                  ;
    1368    1031   005DC                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1369    1032   005DC                  ; WORDT XONXOFF GEBRUIKT.
    1370    1033   005DC                  ;
    1371    1034   005DC                  ; de routine gebruikt geen registers.
    1372    1035   005DC                  ;
    1373    1036   005DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1374    1037   005DC                  
    1375    1038   005DC                  siooutbyte:
    1376    1039   005DC C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1377    1040   005DE C0D0                           push   psw
    1378    1041   005E0 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1379    1042   005E2 C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1380    1043   005E3 1205C8                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1381    1044   005E6 D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1382    1045   005E8 1205C8                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1383    1046   005EB D0D0                           pop    psw           ;registers herstellen
    1384    1047   005ED D0E0                           pop    acc
    1385    1048   005EF 22                             RET
    1386    1049   005F0                  
    1387    1050   005F0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1388    1051   005F0                  ;
    1389    1052   005F0                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1390    1053   005F0                  ; VAN DE CURSOR.
    1391    1054   005F0                  ;
    1392    1055   005F0                  ; de routine gebruikt geen registers.
    1393    1056   005F0                  ;
    1394    1057   005F0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1395    1058   005F0                  
    1396    1059   005F0                  siodispdptr:
    1397    1060   005F0 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1398    1061   005F2 C0D0                           push   psw
    1399    1062   005F4 E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1400    1063   005F6 1205DC                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1401    1064   005F9 E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1402    1065   005FB 1205DC                         LCALL  OUTBYTE       ;WEG ER MEE
    1403    1066   005FE D0D0                           pop    psw           ;registers herstellen
    1404    1067   00600 D0E0                           pop    acc
    1405    1068   00602 22                             RET                  ;EINDE
    1406    1069   00603                  
    1407    1070   00603                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1408    1071   00603                  ;
    1409    1072   00603                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1410    1073   00603                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1411    1074   00603                  ;
    1412    1075   00603                  ; de routine gebruikt geen registers.
    1413    1076   00603                  ;
    1414    1077   00603                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1415    1078   00603                  
    1416    1079   00603                  siooutmsga:
    1417    1080   00603 C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1418    1081   00605 C0D0                           push   psw
    1419    1082   00607 C082                           push   dpl
    1420    1083   00609 C083                           push   dph
    1421    1084   0060B E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1422    1085   0060C 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1423    1086   0060D 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1424    1087   0060F 1205C0                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1425    1088   00612 120621                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1426    1089   00615 A3                             INC    DPTR          ;DPTR AANPASSEN
    1427    1090   00616 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1428    1091   00618 D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1429    1092   0061A D082                           pop    dpl
    1430    1093   0061C D0D0                           pop    psw
    1431    1094   0061E D0E0                           pop    acc
    1432    1095   00620 22                             RET                  ;EINDE ROUTINE
    1433    1096   00621                  
    1434    1097   00621                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1435    1098   00621                  ;
    1436    1099   00621                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1437    1100   00621                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1438    1101   00621                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1439    1102   00621                  ; VERDER DOORGEGEVEN.
    1440    1103   00621                  ;
    1441    1104   00621                  ; de routine gebruikt geen registers.
    1442    1105   00621                  ;
    1443    1106   00621                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1444    1107   00621                  
    1445    1108   00621 C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1446    1109   00623 C0D0                           push   psw
    1447    1110   00625 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1448    1111   00628 D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1449    1112   0062A D0E0                           pop    acc
    1450    1113   0062C 22                             RET                  ;ANDERS EINDE
    1451    1114   0062D E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1452    1115   0062F B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1453    1116   00632 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1454    1117   00635 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1455    1118   00637                  
    1456    1119   00637                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1457    1120   00637                  ;
    1458    1121   00637                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1459    1122   00637                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1460    1123   00637                  ;
    1461    1124   00637                  ; de routine gebruikt de accu.
    1462    1125   00637                  ;
    1463    1126   00637                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1464    1127   00637                  
    1465    1128   00637                  sioinchar:
    1466    1129   00637 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1467    1130   0063A C298                           CLR    RI                   ;BIT LAAG MAKEN
    1468    1131   0063C E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1469    1132   0063E 22                             RET
    1470    1133   0063F                  
    1471    1134   0063F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1472    1135   0063F                  ;
    1473    1136   0063F                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1474    1137   0063F                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1475    1138   0063F                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1476    1139   0063F                  ; DE CARRY OP 1 GEZET WORDEN.
    1477    1140   0063F                  ;
    1478    1141   0063F                  ; De routine gebruikt de accu, r0 en de psw.
    1479    1142   0063F                  ;
    1480    1143   0063F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1481    1144   0063F                  
    1482    1145   0063F                  sioinbyte:
    1483    1146   0063F 120637           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1484    1147   00642 1206AB                         LCALL  LOWUPTR
    1485    1148   00645 1206C2                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1486    1149   00648 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1487    1150   0064A C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1488    1151   0064B F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1489    1152   0064C 120637                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1490    1153   0064F 1206AB                         LCALL  LOWUPTR
    1491    1154   00652 1206C2                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1492    1155   00655 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1493    1156   00657 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1494    1157   00658 22               INBYTE1:      RET
    1495    1158   00659                  
    1496    1159   00659                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1497    1160   00659                  ;
    1498    1161   00659                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1499    1162   00659                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1500    1163   00659                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1501    1164   00659                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1502    1165   00659                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1503    1166   00659                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1504    1167   00659                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1505    1168   00659                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1506    1169   00659                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1507    1170   00659                  ; bepalen.
    1508    1171   00659                  ;
    1509    1172   00659                  ; De routine gebruikt de accu, r0 en de psw.
    1510    1173   00659                  ;
    1511    1174   00659                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1512    1175   00659                  
    1513    1176   00659                  sioinbufa:
    1514    1177   00659 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1515    1178   0065B 120637           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1516    1179   0065E 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1517    1180   00660                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1518    1181   00660                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1519    1182   00660                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1520    1183   00660                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1521    1184   00660                  ; GEVOERD.
    1522    1185   00660 1206AB                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1523    1186   00663 B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1524    1187   00666 F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1525    1188   00667 22                             RET                         ;EINDE VAN DE ROUTINE
    1526    1189   00668 B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1527    1190   0066B B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1528    1191   0066E 7407             INBUFA4:      MOV    A,#BEEP
    1529    1192   00670 1205C0           INBUFA7:      LCALL  OUTCHAR
    1530    1193   00673 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1531    1194   00675 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1532    1195   00676 900584                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1533    1196   00679 120603                         LCALL  OUTMSGA
    1534    1197   0067C 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1535    1198   0067E 12069D           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1536    1199   00681 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1537    1200   00683 B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1538    1201   00686 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1539    1202   00688 F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1540    1203   00689 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1541    1204   0068A 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1542    1205   0068C                  
    1543    1206   0068C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1544    1207   0068C                  ;
    1545    1208   0068C                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1546    1209   0068C                  ;
    1547    1210   0068C                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1548    1211   0068C                  ;
    1549    1212   0068C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1550    1213   0068C                  
    1551    1214   0068C 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1552    1215   0068E 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1553    1216   00690 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1554    1217   00691 B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1555    1218   00694 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1556    1219   00695 B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1557    1220   00698 22                             RET                         ;EINDE VAN DE ROUTINE
    1558    1221   00699 F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1559    1222   0069A 09                             INC    R1
    1560    1223   0069B 80F7                           SJMP   BDELETE3
    1561    1224   0069D                  
    1562    1225   0069D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1563    1226   0069D                  ;
    1564    1227   0069D                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1565    1228   0069D                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1566    1229   0069D                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1567    1230   0069D                  ; AANZIEN.
    1568    1231   0069D                  ;
    1569    1232   0069D                  ; De routine gebruikt de accu en de psw.
    1570    1233   0069D                  ;
    1571    1234   0069D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1572    1235   0069D                  
    1573    1236   0069D B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1574    1237   006A0 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1575    1238   006A2 B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1576    1239   006A5 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1577    1240   006A7 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1578    1241   006A8 22                             RET
    1579    1242   006A9 D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1580    1243   006AA 22                             RET
    1581    1244   006AB                  
    1582    1245   006AB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1583    1246   006AB                  ;
    1584    1247   006AB                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1585    1248   006AB                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1586    1249   006AB                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1587    1250   006AB                  ; AANGEPAST WORDEN.
    1588    1251   006AB                  ;
    1589    1252   006AB                  ; De routine gebruikt de accu en de psw.
    1590    1253   006AB                  ;
    1591    1254   006AB                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1592    1255   006AB                  
    1593    1256   006AB B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1594    1257   006AE 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1595    1258   006B0 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1596    1259   006B3 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1597    1260   006B5 9420                           SUBB   A,#020H              ;OMZETTING
    1598    1261   006B7 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1599    1262   006B8                  
    1600    1263   006B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1601    1264   006B8                  ;
    1602    1265   006B8                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1603    1266   006B8                  ; ASCII CODE.
    1604    1267   006B8                  ;
    1605    1268   006B8                  ; De routine gebruikt de accu en de psw.
    1606    1269   006B8                  ;
    1607    1270   006B8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1608    1271   006B8                  
    1609    1272   006B8 B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1610    1273   006BB 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1611    1274   006BD 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1612    1275   006BF 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1613    1276   006C1 22                             RET
    1614    1277   006C2                  
    1615    1278   006C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1616    1279   006C2                  ;
    1617    1280   006C2                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1618    1281   006C2                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1619    1282   006C2                  ; GEVAL WORDT DE CARRY GEZET.
    1620    1283   006C2                  ;
    1621    1284   006C2                  ; De routine gebruikt de accu en de psw.
    1622    1285   006C2                  ;
    1623    1286   006C2                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1624    1287   006C2                  
    1625    1288   006C2 C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1626    1289   006C3 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1627    1290   006C5 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1628    1291   006C7 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1629    1292   006CA 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1630    1293   006CC 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1631    1294   006CE 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1632    1295   006D0 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1633    1296   006D3 B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1634    1297   006D4 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1635    1298   006D6 C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1636    1299   006D7 22               ASCBINTRANS1: RET
    1637    1300   006D8                  
    1638    1301   006D8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1639    1302   006D8                  ;
    1640    1303   006D8                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1641    1304   006D8                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1642    1305   006D8                  ;
    1643    1306   006D8                  ; De routine gebruikt de accu en de psw.
    1644    1307   006D8                  ;
    1645    1308   006D8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1646    1309   006D8                  
    1647    1310   006D8 E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1648    1311   006D9 1206C2                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1649    1312   006DC 22                             RET                         ;EINDE OMZETTING
    1650    1313   006DD                  
    1651    1314   006DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1652    1315   006DD                  ;
    1653    1316   006DD                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1654    1317   006DD                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1655    1318   006DD                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1656    1319   006DD                  ;
    1657    1320   006DD                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1658    1321   006DD                  ;
    1659    1322   006DD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1660    1323   006DD                  
    1661    1324   006DD 1206D8           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1662    1325   006E0 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1663    1326   006E2 C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1664    1327   006E3 F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1665    1328   006E4 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1666    1329   006E5 1206D8                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1667    1330   006E8 4001                           JC     ASCII21               ;WEG ALS C=1
    1668    1331   006EA 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1669    1332   006EB 22               ASCII21:      RET
    1670    1333   006EC                  
    1671    1334   006EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1672    1335   006EC                  ;
    1673    1336   006EC                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1674    1337   006EC                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1675    1338   006EC                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1676    1339   006EC                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1677    1340   006EC                  ;
    1678    1341   006EC                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1679    1342   006EC                  ;
    1680    1343   006EC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1681    1344   006EC                  
    1682    1345   006EC 1206DD           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1683    1346   006EF 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1684    1347   006F1 F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1685    1348   006F3 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1686    1349   006F4 1206DD                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1687    1350   006F7 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1688    1351   006F9 F582                           MOV    DPL,A                ;IN DPTR LADEN
    1689    1352   006FB 22               ASCII41:      RET
    1690    1353   006FC                  
    1691    1354   006FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1692    1355   006FC                  ;
    1693    1356   006FC                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1694    1357   006FC                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1695    1358   006FC                  ; geschakeld worden.
    1696    1359   006FC                  ;
    1697    1360   006FC                  ; Gebruikt geen registers
    1698    1361   006FC                  ;
    1699    1362   006FC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1700    1363   006FC                  
    1701    1364   006FC C08F             initadc:      push   syscon0                     ;map saven
    1702    1365   006FE 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1703    1366   00701 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1704    1367   00704 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1705    1368   00707                                                                   ;klok delen door 32 (750kHz)
    1706    1369   00707                                                                   ;10 bit uitkomst
    1707    1370   00707 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1708    1371   0070A                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1709    1372   0070A 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1710    1373   0070D 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1711    1374   00710 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1712    1375   00713 D08F                           pop    syscon0                     ;herstellen syscon
    1713    1376   00715 22                             ret
    1714    1377   00716                  
    1715    1378   00716                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1716    1379   00716                  ;
    1717    1380   00716                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1718    1381   00716                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1719    1382   00716                  ;
    1720    1383   00716                  ; Gebruikt:
    1721    1384   00716                  ;      -accu als 8 msb meting
    1722    1385   00716                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1723    1386   00716                  ;
    1724    1387   00716                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1725    1388   00716                  
    1726    1389   00716 C08F             adclm335:     push   syscon0
    1727    1390   00718 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1728    1391   0071B 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1729    1392   0071E 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1730    1393   00721 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1731    1394   00724 00               		nop
    1732    1395   00725 00               		nop					;anders loopt het mis met het testen van de ready bit
    1733    1396   00726 E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1734    1397   00728 20E0FB                         jb     acc.0,adclm3351
    1735    1398   0072B 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1736    1399   0072E E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1737    1400   00730 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1738    1401   00733 D08F                           pop    syscon0
    1739    1402   00735 22                             ret
    1740    1403   00736                  
    1741    1404   00736                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1742    1405   00736                  ;
    1743    1406   00736                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1744    1407   00736                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1745    1408   00736                  ;
    1746    1409   00736                  ; Gebruikt:
    1747    1410   00736                  ;      -accu als 8 msb meting
    1748    1411   00736                  ;      -b als 2 lsb meting (links afgelijnd)
    1749    1412   00736                  ;
    1750    1413   00736                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1751    1414   00736                  
    1752    1415   00736 C08F             adcpotmeter:  push   syscon0
    1753    1416   00738 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1754    1417   0073B 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1755    1418   0073E 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1756    1419   00741 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1757    1420   00744 00               		nop
    1758    1421   00745 00               		nop					;anders loopt het mis met het testen van de ready bit
    1759    1422   00746 E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1760    1423   00748 20E0FB                         jb     acc.0,adcpotmeter1
    1761    1424   0074B 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1762    1425   0074E E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1763    1426   00750 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1764    1427   00753 D08F                           pop    syscon0
    1765    1428   00755                  
    1766    1429   00755                  
    1767    1430   00755 22                             ret
    1768    1431   00756                  
    1769    1432   00756                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1770    1433   00756                  ;
    1771    1434   00756                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1772    1435   00756                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1773    1436   00756                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1774    1437   00756                  ; doelstellingen in het achterhoofd.
    1775    1438   00756                  ;
    1776    1439   00756                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1777    1440   00756                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1778    1441   00756                  ; bcd)
    1779    1442   00756                  ;      8bit hex naar bcd
    1780    1443   00756                  ;      8bit bcd naar hex
    1781    1444   00756                  ;
    1782    1445   00756                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1783    1446   00756                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1784    1447   00756                  ;      16*16 bit met 32 bit uitkomst
    1785    1448   00756                  ;      16+16 bit met 24 bit uitkomst
    1786    1449   00756                  ;      16-16 bit met 24 bit uitkomst
    1787    1450   00756                  ;      16bit hex naar bcd
    1788    1451   00756                  ;      16bit bcd naar hex
    1789    1452   00756                  ;
    1790    1453   00756                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1791    1454   00756                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1792    1455   00756                  ;      32*32 bit met 64 bit uitkomst
    1793    1456   00756                  ;      32+32 bit met 40 bit uitkomst
    1794    1457   00756                  ;      32-32 bit met 40 bit uitkomst
    1795    1458   00756                  ;
    1796    1459   00756                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1797    1460   00756                  ;
    1798    1461   00756                  ; De routines gebruiken als input en output de huidige registerbank.
    1799    1462   00756                  ;
    1800    1463   00756                  ;
    1801    1464   00756                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1802    1465   00756                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1803    1466   00756                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1804    1467   00756                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1805    1468   00756                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1806    1469   00756                  ;
    1807    1470   00756                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1808    1471   00756                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1809    1472   00756                  ;      -routines gebruiken geen MDU!
    1810    1473   00756                  ;
    1811    1474   00756                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1812    1475   00756                  
    1813    1476   00756                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1814    1477   00756                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1815    1478   00756                  
    1816    1479   00756                  h0            equ    070h
    1817    1480   00756                  h1            equ    071h
    1818    1481   00756                  h2            equ    072h
    1819    1482   00756                  h3            equ    073h
    1820    1483   00756                  h4            equ    074h
    1821    1484   00756                  h5            equ    075h
    1822    1485   00756                  h6            equ    076h
    1823    1486   00756                  h7            equ    077h
    1824    1487   00756                  h8            equ    078h
    1825    1488   00756                  h9            equ    079h
    1826    1489   00756                  h10           equ    07ah
    1827    1490   00756                  h11           equ    07bh
    1828    1491   00756                  h12           equ    07ch
    1829    1492   00756                  
    1830    1493   00756                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1831    1494   00756                  ;
    1832    1495   00756                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1833    1496   00756                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1834    1497   00756                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1835    1498   00756                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1836    1499   00756                  ;
    1837    1500   00756                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1838    1501   00756                  ;
    1839    1502   00756                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1840    1503   00756                  
    1841    1504   00756 C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1842    1505   00758 C0D0                           push   psw
    1843    1506   0075A C070                           push   h0
    1844    1507   0075C C071                           push   h1
    1845    1508   0075E C072                           push   h2
    1846    1509   00760 C073                           push   h3
    1847    1510   00762 C074                           push   h4
    1848    1511   00764 C075                           push   h5
    1849    1512   00766 C076                           push   h6
    1850    1513   00768 C077                           push   h7
    1851    1514   0076A C078                           push   h8
    1852    1515   0076C C079                           push   h9
    1853    1516   0076E C07A                           push   h10
    1854    1517   00770 C07B                           push   h11
    1855    1518   00772 C07C                           push   h12
    1856    1519   00774                  
    1857    1520   00774                  ; eerst moeten de hulpregisters klaar gezet worden
    1858    1521   00774                  
    1859    1522   00774 757000                         mov    h0,#000h
    1860    1523   00777 757100                         mov    h1,#000h
    1861    1524   0077A 757200                         mov    h2,#000h
    1862    1525   0077D 757300                         mov    h3,#000h
    1863    1526   00780 757400                         mov    h4,#000h
    1864    1527   00783 757500                         mov    h5,#000h
    1865    1528   00786 757600                         mov    h6,#000h
    1866    1529   00789 757700                         mov    h7,#000h
    1867    1530   0078C 757800                         mov    h8,#000h
    1868    1531   0078F 757900                         mov    h9,#000h
    1869    1532   00792 757A00                         mov    h10,#000h
    1870    1533   00795 757B00                         mov    h11,#000h
    1871    1534   00798 757C20                         mov    h12,#32              ;loopcounter
    1872    1535   0079B                  
    1873    1536   0079B                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1874    1537   0079B                  
    1875    1538   0079B                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1876    1539   0079B                  
    1877    1540   0079B EB               mul321:       mov    a,r3
    1878    1541   0079C 13                             rrc    a
    1879    1542   0079D FB                             mov    r3,a
    1880    1543   0079E EA                             mov    a,r2
    1881    1544   0079F 13                             rrc    a
    1882    1545   007A0 FA                             mov    r2,a
    1883    1546   007A1 E9                             mov    a,r1
    1884    1547   007A2 13                             rrc    a
    1885    1548   007A3 F9                             mov    r1,a
    1886    1549   007A4 E8                             mov    a,r0
    1887    1550   007A5 13                             rrc    a
    1888    1551   007A6 F8                             mov    r0,a                 ;32 bit shift klaar
    1889    1552   007A7                  
    1890    1553   007A7                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1891    1554   007A7                  
    1892    1555   007A7 502C                           jnc    mul322               ;optelling niet nodig
    1893    1556   007A9                  
    1894    1557   007A9                  ; hier staat en 64 bit optelling
    1895    1558   007A9                  
    1896    1559   007A9 EC                             mov    a,r4
    1897    1560   007AA 2574                           add    a,h4
    1898    1561   007AC F574                           mov    h4,a
    1899    1562   007AE ED                             mov    a,r5
    1900    1563   007AF 3575                           addc   a,h5
    1901    1564   007B1 F575                           mov    h5,a
    1902    1565   007B3 EE                             mov    a,r6
    1903    1566   007B4 3576                           addc   a,h6
    1904    1567   007B6 F576                           mov    h6,a
    1905    1568   007B8 EF                             mov    a,r7
    1906    1569   007B9 3577                           addc   a,h7
    1907    1570   007BB F577                           mov    h7,a
    1908    1571   007BD E570                           mov    a,h0
    1909    1572   007BF 3578                           addc   a,h8
    1910    1573   007C1 F578                           mov    h8,a
    1911    1574   007C3 E571                           mov    a,h1
    1912    1575   007C5 3579                           addc   a,h9
    1913    1576   007C7 F579                           mov    h9,a
    1914    1577   007C9 E572                           mov    a,h2
    1915    1578   007CB 357A                           addc   a,h10
    1916    1579   007CD F57A                           mov    h10,a
    1917    1580   007CF E573                           mov    a,h3
    1918    1581   007D1 357B                           addc   a,h11
    1919    1582   007D3 F57B                           mov    h11,a                ;optelling klaar
    1920    1583   007D5                  
    1921    1584   007D5                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1922    1585   007D5                  
    1923    1586   007D5 C3               mul322:       clr    c                    ;moet op 0 staan
    1924    1587   007D6 EC                             mov    a,r4
    1925    1588   007D7 33                             rlc    a
    1926    1589   007D8 FC                             mov    r4,a
    1927    1590   007D9 ED                             mov    a,r5
    1928    1591   007DA 33                             rlc    a
    1929    1592   007DB FD                             mov    r5,a
    1930    1593   007DC EE                             mov    a,r6
    1931    1594   007DD 33                             rlc    a
    1932    1595   007DE FE                             mov    r6,a
    1933    1596   007DF EF                             mov    a,r7
    1934    1597   007E0 33                             rlc    a
    1935    1598   007E1 FF                             mov    r7,a
    1936    1599   007E2 E570                           mov    a,h0
    1937    1600   007E4 33                             rlc    a
    1938    1601   007E5 F570                           mov    h0,a
    1939    1602   007E7 E571                           mov    a,h1
    1940    1603   007E9 33                             rlc    a
    1941    1604   007EA F571                           mov    h1,a
    1942    1605   007EC E572                           mov    a,h2
    1943    1606   007EE 33                             rlc    a
    1944    1607   007EF F572                           mov    h2,a
    1945    1608   007F1 E573                           mov    a,h3
    1946    1609   007F3 33                             rlc    a
    1947    1610   007F4 F573                           mov    h3,a
    1948    1611   007F6                  
    1949    1612   007F6 D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1950    1613   007F9                  
    1951    1614   007F9                  ; de uitkomst moet in de juiste registers komen
    1952    1615   007F9                  
    1953    1616   007F9 A874                           mov    r0,h4
    1954    1617   007FB A975                           mov    r1,h5
    1955    1618   007FD AA76                           mov    r2,h6
    1956    1619   007FF AB77                           mov    r3,h7
    1957    1620   00801 AC78                           mov    r4,h8
    1958    1621   00803 AD79                           mov    r5,h9
    1959    1622   00805 AE7A                           mov    r6,h10
    1960    1623   00807 AF7B                           mov    r7,h11               ;klaar
    1961    1624   00809                  
    1962    1625   00809 D07C                           pop    h12                  ;registers herstellen
    1963    1626   0080B D07B                           pop    h11
    1964    1627   0080D D07A                           pop    h10
    1965    1628   0080F D079                           pop    h9
    1966    1629   00811 D078                           pop    h8
    1967    1630   00813 D077                           pop    h7
    1968    1631   00815 D076                           pop    h6
    1969    1632   00817 D075                           pop    h5
    1970    1633   00819 D074                           pop    h4
    1971    1634   0081B D073                           pop    h3
    1972    1635   0081D D072                           pop    h2
    1973    1636   0081F D071                           pop    h1
    1974    1637   00821 D070                           pop    h0
    1975    1638   00823 D0D0                           pop    psw
    1976    1639   00825 D0E0                           pop    acc
    1977    1640   00827 22                             ret
    1978    1641   00828                  
    1979    1642   00828                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1980    1643   00828                  ;
    1981    1644   00828                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1982    1645   00828                  ; input:      r1,r0 = eerste getal (r1=msb)
    1983    1646   00828                  ;             r3,r2 = tweede getal (r3=msb)
    1984    1647   00828                  ; output:     r3,r2,r1,r0 met r3=msb
    1985    1648   00828                  ;
    1986    1649   00828                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1987    1650   00828                  ;
    1988    1651   00828                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1989    1652   00828                  
    1990    1653   00828 C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1991    1654   0082A C0D0                           push   psw
    1992    1655   0082C C070                           push   h0
    1993    1656   0082E C071                           push   h1
    1994    1657   00830 C072                           push   h2
    1995    1658   00832 C073                           push   h3
    1996    1659   00834 C074                           push   h4
    1997    1660   00836 C075                           push   h5
    1998    1661   00838 C076                           push   h6
    1999    1662   0083A                  
    2000    1663   0083A                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    2001    1664   0083A                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    2002    1665   0083A                  ; h6 is de loopcounter.
    2003    1666   0083A                  
    2004    1667   0083A 757000                         mov    h0,#000h
    2005    1668   0083D 757100                         mov    h1,#000h
    2006    1669   00840 757200                         mov    h2,#000h
    2007    1670   00843 757300                         mov    h3,#000h
    2008    1671   00846 757400                         mov    h4,#000h
    2009    1672   00849 757500                         mov    h5,#000h
    2010    1673   0084C 757610                         mov    h6,#16               ;loopcounter
    2011    1674   0084F                  
    2012    1675   0084F                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    2013    1676   0084F                  ; berekening
    2014    1677   0084F                  
    2015    1678   0084F E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    2016    1679   00850 13                             rrc    a
    2017    1680   00851 F9                             mov    r1,a
    2018    1681   00852 E8                             mov    a,r0
    2019    1682   00853 13                             rrc    a
    2020    1683   00854 F8                             mov    r0,a                 ;ok
    2021    1684   00855                  
    2022    1685   00855                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    2023    1686   00855                  
    2024    1687   00855 5016                           jnc    mul162
    2025    1688   00857                  
    2026    1689   00857 EA                             mov    a,r2
    2027    1690   00858 2572                           add    a,h2
    2028    1691   0085A F572                           mov    h2,a                 ;32 bit som uitvoeren
    2029    1692   0085C EB                             mov    a,r3
    2030    1693   0085D 3573                           addc   a,h3
    2031    1694   0085F F573                           mov    h3,a
    2032    1695   00861 E570                           mov    a,h0
    2033    1696   00863 3574                           addc   a,h4
    2034    1697   00865 F574                           mov    h4,a
    2035    1698   00867 E571                           mov    a,h1
    2036    1699   00869 3575                           addc   a,h5
    2037    1700   0086B F575                           mov    h5,a                 ;klaar
    2038    1701   0086D                  
    2039    1702   0086D                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    2040    1703   0086D                  
    2041    1704   0086D C3               mul162:       clr    c
    2042    1705   0086E EA                             mov    a,r2
    2043    1706   0086F 33                             rlc    a
    2044    1707   00870 FA                             mov    r2,a                 ;ook 32 bit getal
    2045    1708   00871 EB                             mov    a,r3
    2046    1709   00872 33                             rlc    a
    2047    1710   00873 FB                             mov    r3,a
    2048    1711   00874 E570                           mov    a,h0
    2049    1712   00876 33                             rlc    a
    2050    1713   00877 F570                           mov    h0,a
    2051    1714   00879 E571                           mov    a,h1
    2052    1715   0087B 33                             rlc    a
    2053    1716   0087C F571                           mov    h1,a                 ;klaar
    2054    1717   0087E                  
    2055    1718   0087E D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    2056    1719   00881                  
    2057    1720   00881                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    2058    1721   00881                  
    2059    1722   00881 A872                           mov    r0,h2
    2060    1723   00883 A973                           mov    r1,h3
    2061    1724   00885 AA74                           mov    r2,h4
    2062    1725   00887 AB75                           mov    r3,h5                ;klaar
    2063    1726   00889                  
    2064    1727   00889                  
    2065    1728   00889 D076                           pop    h6                   ;registers herstellen
    2066    1729   0088B D075                           pop    h5
    2067    1730   0088D D074                           pop    h4
    2068    1731   0088F D073                           pop    h3
    2069    1732   00891 D072                           pop    h2
    2070    1733   00893 D071                           pop    h1
    2071    1734   00895 D070                           pop    h0
    2072    1735   00897 D0D0                           pop    psw
    2073    1736   00899 D0E0                           pop    acc
    2074    1737   0089B 22                             ret
    2075    1738   0089C                  
    2076    1739   0089C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2077    1740   0089C                  ;
    2078    1741   0089C                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2079    1742   0089C                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2080    1743   0089C                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2081    1744   0089C                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2082    1745   0089C                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2083    1746   0089C                  ;             carry=1 bij delen door 0
    2084    1747   0089C                  ;
    2085    1748   0089C                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2086    1749   0089C                  ;
    2087    1750   0089C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2088    1751   0089C                  
    2089    1752   0089C C0E0             div32:        push   acc                  ;registers op de stack zetten
    2090    1753   0089E C0D0                           push   psw
    2091    1754   008A0 C070                           push   h0
    2092    1755   008A2 C071                           push   h1
    2093    1756   008A4 C072                           push   h2
    2094    1757   008A6 C073                           push   h3
    2095    1758   008A8 C074                           push   h4
    2096    1759   008AA C075                           push   h5
    2097    1760   008AC C076                           push   h6
    2098    1761   008AE C077                           push   h7
    2099    1762   008B0 C078                           push   h8
    2100    1763   008B2 C079                           push   h9
    2101    1764   008B4 C07A                           push   h10
    2102    1765   008B6 C07B                           push   h11
    2103    1766   008B8 C07C                           push   h12
    2104    1767   008BA                  
    2105    1768   008BA                  ; eerst alles voorladen
    2106    1769   008BA                  
    2107    1770   008BA 757000                         mov    h0,#000h
    2108    1771   008BD 757100                         mov    h1,#000h
    2109    1772   008C0 757200                         mov    h2,#000h
    2110    1773   008C3 757300                         mov    h3,#000h
    2111    1774   008C6 757400                         mov    h4,#000h
    2112    1775   008C9 757500                         mov    h5,#000h
    2113    1776   008CC 757600                         mov    h6,#000h
    2114    1777   008CF 757700                         mov    h7,#000h
    2115    1778   008D2 757800                         mov    h8,#000h
    2116    1779   008D5 757900                         mov    h9,#000h
    2117    1780   008D8 757A00                         mov    h10,#000h
    2118    1781   008DB 757B00                         mov    h11,#000h
    2119    1782   008DE 757C20                         mov    h12,#32              ;loopcounter
    2120    1783   008E1                  
    2121    1784   008E1                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2122    1785   008E1                  
    2123    1786   008E1                  ; deze lus moet 32 keer heraald worden
    2124    1787   008E1                  
    2125    1788   008E1 E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2126    1789   008E2 33                             rlc    a
    2127    1790   008E3 F8                             mov    r0,a
    2128    1791   008E4 E9                             mov    a,r1
    2129    1792   008E5 33                             rlc    a
    2130    1793   008E6 F9                             mov    r1,a
    2131    1794   008E7 EA                             mov    a,r2
    2132    1795   008E8 33                             rlc    a
    2133    1796   008E9 FA                             mov    r2,a
    2134    1797   008EA EB                             mov    a,r3
    2135    1798   008EB 33                             rlc    a
    2136    1799   008EC FB                             mov    r3,a
    2137    1800   008ED E570                           mov    a,h0
    2138    1801   008EF 33                             rlc    a
    2139    1802   008F0 F570                           mov    h0,a
    2140    1803   008F2 E571                           mov    a,h1
    2141    1804   008F4 33                             rlc    a
    2142    1805   008F5 F571                           mov    h1,a
    2143    1806   008F7 E572                           mov    a,h2
    2144    1807   008F9 33                             rlc    a
    2145    1808   008FA F572                           mov    h2,a
    2146    1809   008FC E573                           mov    a,h3
    2147    1810   008FE 33                             rlc    a
    2148    1811   008FF F573                           mov    h3,a
    2149    1812   00901                  
    2150    1813   00901                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2151    1814   00901                  
    2152    1815   00901 C3                             clr    c                    ;zit in de weg
    2153    1816   00902 E570                           mov    a,h0
    2154    1817   00904 9C                             subb   a,r4
    2155    1818   00905 F574                           mov    h4,a
    2156    1819   00907 E571                           mov    a,h1
    2157    1820   00909 9D                             subb   a,r5
    2158    1821   0090A F575                           mov    h5,a
    2159    1822   0090C E572                           mov    a,h2
    2160    1823   0090E 9E                             subb   a,r6
    2161    1824   0090F F576                           mov    h6,a
    2162    1825   00911 E573                           mov    a,h3
    2163    1826   00913 9F                             subb   a,r7
    2164    1827   00914 F577                           mov    h7,a
    2165    1828   00916                  
    2166    1829   00916                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2167    1830   00916                  ; vervangen worden door h7-h4
    2168    1831   00916                  
    2169    1832   00916 400C                           jc     div322               ;niet vervangen
    2170    1833   00918                  
    2171    1834   00918 857470                         mov    h0,h4
    2172    1835   0091B 857571                         mov    h1,h5
    2173    1836   0091E 857672                         mov    h2,h6
    2174    1837   00921 857773                         mov    h3,h7                ;vervanging klaar
    2175    1838   00924                  
    2176    1839   00924 B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2177    1840   00925 E578                           mov    a,h8
    2178    1841   00927 33                             rlc    a
    2179    1842   00928 F578                           mov    h8,a
    2180    1843   0092A E579                           mov    a,h9
    2181    1844   0092C 33                             rlc    a
    2182    1845   0092D F579                           mov    h9,a
    2183    1846   0092F E57A                           mov    a,h10
    2184    1847   00931 33                             rlc    a
    2185    1848   00932 F57A                           mov    h10,a
    2186    1849   00934 E57B                           mov    a,h11
    2187    1850   00936 33                             rlc    a
    2188    1851   00937 F57B                           mov    h11,a                ;qoutient aangepast
    2189    1852   00939                  
    2190    1853   00939 D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2191    1854   0093C                  
    2192    1855   0093C                  ; de berekening is klaar. uitkomstregisters nog laden
    2193    1856   0093C                  
    2194    1857   0093C AC78                           mov    r4,h8
    2195    1858   0093E AD79                           mov    r5,h9
    2196    1859   00940 AE7A                           mov    r6,h10
    2197    1860   00942 AF7B                           mov    r7,h11               ;uitkomst geladen
    2198    1861   00944                  
    2199    1862   00944 A870                           mov    r0,h0                ;rest laden
    2200    1863   00946 A971                           mov    r1,h1
    2201    1864   00948 AA72                           mov    r2,h2
    2202    1865   0094A AB73                           mov    r3,h3
    2203    1866   0094C                  
    2204    1867   0094C D07C                           pop    h12                  ;registers herstellen
    2205    1868   0094E D07B                           pop    h11
    2206    1869   00950 D07A                           pop    h10
    2207    1870   00952 D079                           pop    h9
    2208    1871   00954 D078                           pop    h8
    2209    1872   00956 D077                           pop    h7
    2210    1873   00958 D076                           pop    h6
    2211    1874   0095A D075                           pop    h5
    2212    1875   0095C D074                           pop    h4
    2213    1876   0095E D073                           pop    h3
    2214    1877   00960 D072                           pop    h2
    2215    1878   00962 D071                           pop    h1
    2216    1879   00964 D070                           pop    h0
    2217    1880   00966 D0D0                           pop    psw
    2218    1881   00968 D0E0                           pop    acc
    2219    1882   0096A 22                             ret
    2220    1883   0096B                  
    2221    1884   0096B                  
    2222    1885   0096B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2223    1886   0096B                  ;
    2224    1887   0096B                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2225    1888   0096B                  ; input:      r1,r0 = eerste getal (r1=msb)
    2226    1889   0096B                  ;             r3,r2 = tweede getal (r3=msb)
    2227    1890   0096B                  ; output:     r3,r2 = quotient (r3=msb)
    2228    1891   0096B                  ;             r1,r0 = rest (r1=msb)
    2229    1892   0096B                  ;             carry=1 bij deling door 0
    2230    1893   0096B                  ;
    2231    1894   0096B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2232    1895   0096B                  
    2233    1896   0096B C0E0             div16:        push   acc                  ;registers op de stack zetten
    2234    1897   0096D C0D0                           push   psw
    2235    1898   0096F C070                           push   h0
    2236    1899   00971 C071                           push   h1
    2237    1900   00973 C072                           push   h2
    2238    1901   00975 C073                           push   h3
    2239    1902   00977 C074                           push   h4
    2240    1903   00979 C075                           push   h5
    2241    1904   0097B C076                           push   h6
    2242    1905   0097D                  
    2243    1906   0097D                  ; registers voorladen
    2244    1907   0097D                  
    2245    1908   0097D 757000                         mov    h0,#000h
    2246    1909   00980 757100                         mov    h1,#000h
    2247    1910   00983 757200                         mov    h2,#000h
    2248    1911   00986 757300                         mov    h3,#000h
    2249    1912   00989 757400                         mov    h4,#000h
    2250    1913   0098C 757500                         mov    h5,#000h
    2251    1914   0098F 757610                         mov    h6,#16               ;loopcounter
    2252    1915   00992                  
    2253    1916   00992                  ; eerst te delen getal 1*links shiften in hulpregisters
    2254    1917   00992                  
    2255    1918   00992                  ; deze lus moet 16 keer herhaald worden
    2256    1919   00992                  
    2257    1920   00992 E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2258    1921   00993 33                             rlc    a
    2259    1922   00994 F8                             mov    r0,a
    2260    1923   00995 E9                             mov    a,r1
    2261    1924   00996 33                             rlc    a
    2262    1925   00997 F9                             mov    r1,a
    2263    1926   00998 E570                           mov    a,h0
    2264    1927   0099A 33                             rlc    a
    2265    1928   0099B F570                           mov    h0,a
    2266    1929   0099D E571                           mov    a,h1
    2267    1930   0099F 33                             rlc    a
    2268    1931   009A0 F571                           mov    h1,a
    2269    1932   009A2                  
    2270    1933   009A2                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2271    1934   009A2                  ; het tussenresultaat.
    2272    1935   009A2                  
    2273    1936   009A2 C3                             clr    c
    2274    1937   009A3 E570                           mov    a,h0
    2275    1938   009A5 9A                             subb   a,r2
    2276    1939   009A6 F572                           mov    h2,a
    2277    1940   009A8 E571                           mov    a,h1
    2278    1941   009AA 9B                             subb   a,r3
    2279    1942   009AB F573                           mov    h3,a
    2280    1943   009AD                  
    2281    1944   009AD 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2282    1945   009AF                                                            ;door h3,h2
    2283    1946   009AF 857270                         mov    h0,h2
    2284    1947   009B2 857371                         mov    h1,h3                ;vervanging klaar
    2285    1948   009B5                  
    2286    1949   009B5                  ; uitkomst moet aangepast worden
    2287    1950   009B5                  
    2288    1951   009B5 B3               div162:       cpl    c                    ;truuk
    2289    1952   009B6 E574                           mov    a,h4
    2290    1953   009B8 33                             rlc    a
    2291    1954   009B9 F574                           mov    h4,a
    2292    1955   009BB E575                           mov    a,h5
    2293    1956   009BD 33                             rlc    a
    2294    1957   009BE F575                           mov    h5,a
    2295    1958   009C0 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2296    1959   009C3                  
    2297    1960   009C3                  ; de berekening is klaar. uitkomsten in passende registers
    2298    1961   009C3                  
    2299    1962   009C3 AA74                           mov    r2,h4                ;quotient
    2300    1963   009C5 AB75                           mov    r3,h5
    2301    1964   009C7                  
    2302    1965   009C7 A870                           mov    r0,h0                ;rest
    2303    1966   009C9 A971                           mov    r1,h1
    2304    1967   009CB                  
    2305    1968   009CB D076                           pop    h6                   ;registers herstellen
    2306    1969   009CD D075                           pop    h5
    2307    1970   009CF D074                           pop    h4
    2308    1971   009D1 D073                           pop    h3
    2309    1972   009D3 D072                           pop    h2
    2310    1973   009D5 D071                           pop    h1
    2311    1974   009D7 D070                           pop    h0
    2312    1975   009D9 D0D0                           pop    psw
    2313    1976   009DB D0E0                           pop    acc
    2314    1977   009DD 22                             ret
    2315    1978   009DE                  
    2316    1979   009DE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2317    1980   009DE                  ;
    2318    1981   009DE                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2319    1982   009DE                  ;
    2320    1983   009DE                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2321    1984   009DE                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2322    1985   009DE                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2323    1986   009DE                  ;
    2324    1987   009DE                  ; r4,r3,r2,r1,r0 worden aangepast
    2325    1988   009DE                  ;
    2326    1989   009DE                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2327    1990   009DE                  
    2328    1991   009DE C0E0             add32:        push   acc                  ;registers op de stack zetten
    2329    1992   009E0 C0D0                           push   psw
    2330    1993   009E2 E8                             mov    a,r0                 ;eerste 8 bit
    2331    1994   009E3 2C                             add    a,r4
    2332    1995   009E4 F8                             mov    r0,a                 ;klaar
    2333    1996   009E5 E9                             mov    a,r1                 ;volgende 8 bit
    2334    1997   009E6 3D                             addc   a,r5
    2335    1998   009E7 F9                             mov    r1,a                 ;klaar
    2336    1999   009E8 EA                             mov    a,r2                 ;volgende 8 bit
    2337    2000   009E9 3E                             addc   a,r6
    2338    2001   009EA FA                             mov    r2,a                 ;klaar
    2339    2002   009EB EB                             mov    a,r3                 ;laatste 8 bit
    2340    2003   009EC 3F                             addc   a,r7
    2341    2004   009ED FB                             mov    r3,a                 ;32 bit klaar
    2342    2005   009EE 7400                           mov    a,#000h
    2343    2006   009F0 3400                           addc   a,#000h              ;carry verrekenen
    2344    2007   009F2 FC                             mov    r4,a
    2345    2008   009F3 D0D0                           pop    psw                  ;registers herstellen
    2346    2009   009F5 D0E0                           pop    acc
    2347    2010   009F7 22                             ret
    2348    2011   009F8                  
    2349    2012   009F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2350    2013   009F8                  ;
    2351    2014   009F8                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2352    2015   009F8                  ;
    2353    2016   009F8                  ; input:      r1,r0 = eerste getal (r1=msb)
    2354    2017   009F8                  ;             r3,r2 = tweede getal (r3=msb)
    2355    2018   009F8                  ; output:     r2,r1,r0 (r2=msb)
    2356    2019   009F8                  ;
    2357    2020   009F8                  ; r3,r2,r1,r0 worden aangepast
    2358    2021   009F8                  ;
    2359    2022   009F8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2360    2023   009F8                  
    2361    2024   009F8 C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2362    2025   009FA C0D0                           push   psw
    2363    2026   009FC E8                             mov    a,r0                 ;starten met de optelling
    2364    2027   009FD 2A                             add    a,r2                 ;8 bit klaar
    2365    2028   009FE F8                             mov    r0,a                 ;uitkomst wegschrijven
    2366    2029   009FF E9                             mov    a,r1                 ;volgende 8 bit
    2367    2030   00A00 3B                             addc   a,r3                 ;16 bit klaar
    2368    2031   00A01 F9                             mov    r1,a                 ;uitkomst weggeschreven
    2369    2032   00A02 7400                           mov    a,#000h              ;carry verrekenen
    2370    2033   00A04 3400                           addc   a,#000h
    2371    2034   00A06 FA                             mov    r2,a                 ;24 bit klaar
    2372    2035   00A07 D0D0                           pop    psw                  ;registers herstellen
    2373    2036   00A09 D0E0                           pop    acc
    2374    2037   00A0B 22                             ret
    2375    2038   00A0C                  
    2376    2039   00A0C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2377    2040   00A0C                  ;
    2378    2041   00A0C                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2379    2042   00A0C                  ;             40 bit groot. (eerste -tweede)
    2380    2043   00A0C                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2381    2044   00A0C                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2382    2045   00A0C                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2383    2046   00A0C                  ;
    2384    2047   00A0C                  ; r4,r3,r2,r1,r0 worden aangepast
    2385    2048   00A0C                  ;
    2386    2049   00A0C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2387    2050   00A0C                  
    2388    2051   00A0C C0E0             sub32:        push   acc                  ;registers bewaren
    2389    2052   00A0E C0D0                           push   psw                  ;ook de vlaggen
    2390    2053   00A10 C3                             clr    c                    ;zit nog effe in de weg
    2391    2054   00A11 E8                             mov    a,r0                 ;eerste 8 bit
    2392    2055   00A12 9C                             subb   a,r4
    2393    2056   00A13 F8                             mov    r0,a
    2394    2057   00A14 E9                             mov    a,r1                 ;tweede 8 bit
    2395    2058   00A15 9D                             subb   a,r5
    2396    2059   00A16 F9                             mov    r1,a
    2397    2060   00A17 EA                             mov    a,r2                 ;volgende 8 bit
    2398    2061   00A18 9E                             subb   a,r6
    2399    2062   00A19 FA                             mov    r2,a
    2400    2063   00A1A EB                             mov    a,r3                 ;laatste 8 bit
    2401    2064   00A1B 9F                             subb   a,r7
    2402    2065   00A1C FB                             mov    r3,a
    2403    2066   00A1D 7400                           mov    a,#000h              ;nu nog de carry
    2404    2067   00A1F 9400                           subb   a,#000h
    2405    2068   00A21 FC                             mov    r4,a                 ;40 bit klaar
    2406    2069   00A22 D0D0                           pop    psw                  ;registers herstellen
    2407    2070   00A24 D0E0                           pop    acc
    2408    2071   00A26 22                             ret
    2409    2072   00A27                  
    2410    2073   00A27                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2411    2074   00A27                  ;
    2412    2075   00A27                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2413    2076   00A27                  ;             24 bit groot. (eerste - tweede)
    2414    2077   00A27                  ; input:      r1,r0 = eerste getal (r1=msb)
    2415    2078   00A27                  ;             r3,r2 = tweede getal (r3=msb)
    2416    2079   00A27                  ; output:     r2,r1,r0 (r2=msb)
    2417    2080   00A27                  ;
    2418    2081   00A27                  ; r3,r2,r1,r0 worden aangepast
    2419    2082   00A27                  ;
    2420    2083   00A27                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2421    2084   00A27                  
    2422    2085   00A27 C0E0             sub16:        push   acc                  ;registers bewaren
    2423    2086   00A29 C0D0                           push   psw
    2424    2087   00A2B C3                             clr    c                    ;mag nog niet meespelen
    2425    2088   00A2C E8                             mov    a,r0                 ;eerste 8 bit verschil
    2426    2089   00A2D 9A                             subb   a,r2
    2427    2090   00A2E F8                             mov    r0,a                 ;klaar
    2428    2091   00A2F E9                             mov    a,r1
    2429    2092   00A30 9B                             subb   a,r3                 ;16 bit klaar
    2430    2093   00A31 F9                             mov    r1,a
    2431    2094   00A32 7400                           mov    a,#000h
    2432    2095   00A34 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2433    2096   00A36 FA                             mov    r2,a                 ;24 bit klaar
    2434    2097   00A37 D0D0                           pop    psw                  ;registers herstellen
    2435    2098   00A39 D0E0                           pop    acc
    2436    2099   00A3B 22                             ret
    2437    2100   00A3C                  
    2438    2101   00A3C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2439    2102   00A3C                  ;
    2440    2103   00A3C                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2441    2104   00A3C                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2442    2105   00A3C                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2443    2106   00A3C                  ;
    2444    2107   00A3C                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2445    2108   00A3C                  ;
    2446    2109   00A3C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2447    2110   00A3C                  
    2448    2111   00A3C C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2449    2112   00A3E C0D0                           push   psw
    2450    2113   00A40                  
    2451    2114   00A40 C077                           push   h7                   ;nodig
    2452    2115   00A42 C078                           push   h8
    2453    2116   00A44                  
    2454    2117   00A44 C079                           push   h9                   ;ook
    2455    2118   00A46                  
    2456    2119   00A46 757905                         mov    h9,#005h             ;loopcounter
    2457    2120   00A49                  
    2458    2121   00A49 7B00             hexbcd161:    mov    r3,#000h
    2459    2122   00A4B 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2460    2123   00A4D 12096B                         lcall  div16                ;deling uitvoeren
    2461    2124   00A50 E8                             mov    a,r0                 ;rest
    2462    2125   00A51 C0E0                           push   acc                  ;op stack zetten
    2463    2126   00A53 EA                             mov    a,r2
    2464    2127   00A54 F8                             mov    r0,a
    2465    2128   00A55 EB                             mov    a,r3
    2466    2129   00A56 F9                             mov    r1,a                 ;uitkomst terug delen
    2467    2130   00A57 D579EF                         djnz   h9,hexbcd161
    2468    2131   00A5A                  
    2469    2132   00A5A D0E0                           pop    acc                  ;hoogste bits van de stack
    2470    2133   00A5C FA                             mov    r2,a                 ;klaar
    2471    2134   00A5D D0E0                           pop    acc
    2472    2135   00A5F C4                             swap   a
    2473    2136   00A60 F579                           mov    h9,a
    2474    2137   00A62 D0E0                           pop    acc
    2475    2138   00A64 2579                           add    a,h9
    2476    2139   00A66 F9                             mov    r1,a                 ;volgende 8 klaar
    2477    2140   00A67 D0E0                           pop    acc
    2478    2141   00A69 C4                             swap   a
    2479    2142   00A6A F579                           mov    h9,a
    2480    2143   00A6C D0E0                           pop    acc
    2481    2144   00A6E 2579                           add    a,h9
    2482    2145   00A70 F8                             mov    r0,a                 ;klaar
    2483    2146   00A71                  
    2484    2147   00A71 D079                           pop    h9                   ;was naar de knoppen
    2485    2148   00A73                  
    2486    2149   00A73 D078                           pop    h8                   ;gebruikt
    2487    2150   00A75 D077                           pop    h7
    2488    2151   00A77                  
    2489    2152   00A77 D0D0                           pop    psw                  ;registers herstellen
    2490    2153   00A79 D0E0                           pop    acc
    2491    2154   00A7B 22                             ret
    2492    2155   00A7C                  
    2493    2156   00A7C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2494    2157   00A7C                  ;
    2495    2158   00A7C                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2496    2159   00A7C                  ; input       a (maximale waarde = 63h)
    2497    2160   00A7C                  ; output      a
    2498    2161   00A7C                  ;
    2499    2162   00A7C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2500    2163   00A7C                  
    2501    2164   00A7C C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2502    2165   00A7E C0F0                           push   b
    2503    2166   00A80 75F00A                         mov    b,#00ah              ;hierdoor delen
    2504    2167   00A83 84                             div    ab                   ;in accu qoutient in b rest
    2505    2168   00A84 C4                             swap   a
    2506    2169   00A85 25F0                           add    a,b                  ;bcd getal klaar
    2507    2170   00A87 D0F0                           pop    b
    2508    2171   00A89 D0D0                           pop    psw
    2509    2172   00A8B 22                             ret
    2510    2173   00A8C                  
    2511    2174   00A8C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2512    2175   00A8C                  ;
    2513    2176   00A8C                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2514    2177   00A8C                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2515    2178   00A8C                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2516    2179   00A8C                  ;
    2517    2180   00A8C                  ; de routine gebruikt r1,r0 van de huidige bank
    2518    2181   00A8C                  ;
    2519    2182   00A8C                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2520    2183   00A8C                  
    2521    2184   00A8C C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2522    2185   00A8E C0E0                           push   acc
    2523    2186   00A90 C0D0                           push   psw
    2524    2187   00A92                  
    2525    2188   00A92 E8                             mov    a,r0
    2526    2189   00A93 540F                           anl    a,#00fh              ;eenheden
    2527    2190   00A95 C0E0                           push   acc                  ;effe bewaren
    2528    2191   00A97                  
    2529    2192   00A97 E8                             mov    a,r0
    2530    2193   00A98 C4                             swap   a
    2531    2194   00A99 540F                           anl    a,#00fh              ;tientallen
    2532    2195   00A9B 75F00A                         mov    b,#00ah              ;waarde berekenen
    2533    2196   00A9E A4                             mul    ab                   ;klaar
    2534    2197   00A9F D0F0                           pop    b                    ;truukje
    2535    2198   00AA1 25F0                           add    a,b                  ;a is lage deel hex getal
    2536    2199   00AA3 C0E0                           push   acc                  ;straks nodig
    2537    2200   00AA5                  
    2538    2201   00AA5 E9                             mov    a,r1                 ;hoge deel
    2539    2202   00AA6 54F0                           anl    a,#0f0h
    2540    2203   00AA8 C4                             swap   a
    2541    2204   00AA9 C0E0                           push   acc                  ;straks nodig
    2542    2205   00AAB                  
    2543    2206   00AAB E9                             mov    a,r1
    2544    2207   00AAC 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2545    2208   00AAE 75F064                         mov    b,#100               ;waarde uitrekenen
    2546    2209   00AB1 A4                             mul    ab
    2547    2210   00AB2 A9F0                           mov    r1,b
    2548    2211   00AB4 F8                             mov    r0,a
    2549    2212   00AB5                  
    2550    2213   00AB5 D0E0                           pop    acc
    2551    2214   00AB7 75F00A                         mov    b,#10
    2552    2215   00ABA A4                             mul    ab                   ;kan nog in a
    2553    2216   00ABB 75F064                         mov    b,#100               ;*10*100=*1000
    2554    2217   00ABE A4                             mul    ab
    2555    2218   00ABF 28                             add    a,r0
    2556    2219   00AC0 F8                             mov    r0,a
    2557    2220   00AC1 E9                             mov    a,r1
    2558    2221   00AC2 35F0                           addc   a,b
    2559    2222   00AC4 F9                             mov    r1,a
    2560    2223   00AC5                  
    2561    2224   00AC5 D0E0                           pop    acc
    2562    2225   00AC7 28                             add    a,r0
    2563    2226   00AC8 F8                             mov    r0,a
    2564    2227   00AC9 7400                           mov    a,#000h
    2565    2228   00ACB 39                             addc   a,r1
    2566    2229   00ACC F9                             mov    r1,a                 ;klaar
    2567    2230   00ACD                  
    2568    2231   00ACD D0D0                           pop    psw
    2569    2232   00ACF D0E0                           pop    acc
    2570    2233   00AD1 D0F0                           pop    b
    2571    2234   00AD3 22                             ret
    2572    2235   00AD4                  
    2573    2236   00AD4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2574    2237   00AD4                  ;
    2575    2238   00AD4                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2576    2239   00AD4                  ; input:      a (maximale waarde 99h)
    2577    2240   00AD4                  ; output:     a
    2578    2241   00AD4                  ;
    2579    2242   00AD4                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2580    2243   00AD4                  
    2581    2244   00AD4 C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2582    2245   00AD6 C0F0                           push   b
    2583    2246   00AD8 C070                           push   h0
    2584    2247   00ADA F570                           mov    h0,a                 ;effe bewaren
    2585    2248   00ADC 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2586    2249   00ADF 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2587    2250   00AE1 C4                             swap   a
    2588    2251   00AE2 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2589    2252   00AE5 A4                             mul    ab
    2590    2253   00AE6 2570                           add    a,h0                 ;eenheden bijtellen
    2591    2254   00AE8 D070                           pop    h0
    2592    2255   00AEA D0F0                           pop    b
    2593    2256   00AEC D0D0                           pop    psw
    2594    2257   00AEE 22                             ret
    2595    2258   00AEF                  
    2596    2259   00AEF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2597    2260   00AEF                  ;
    2598    2261   00AEF                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2599    2262   00AEF                  ;
    2600    2263   00AEF                  ; Gebruikt geen registers
    2601    2264   00AEF                  ;
    2602    2265   00AEF                  ; Originele auteur: Danny Pawels (dp)
    2603    2266   00AEF                  ;
    2604    2267   00AEF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2605    2268   00AEF                  
    2606    2269   00AEF                  
    2607    2270   00AEF C083             XCsw2xtal:  push  dph
    2608    2271   00AF1 C082                         push  dpl
    2609    2272   00AF3 C0D0                         push  psw
    2610    2273   00AF5 C08F                         push  syscon0
    2611    2274   00AF7 C0B2                         push  port_page
    2612    2275   00AF9 C0BF                         push  scu_page
    2613    2276   00AFB                  
    2614    2277   00AFB 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2615    2278   00AFE 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2616    2279   00B01                  
    2617    2280   00B01 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2618    2281   00B04                                                            ;freq= VCO-free running =5MHz...20MHz?
    2619    2282   00B04 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2620    2283   00B07 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2621    2284   00B0A 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2622    2285   00B0D                  
    2623    2286   00B0D 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2624    2287   00B10 A3               XCsw2xtal0: inc   dptr
    2625    2288   00B11 E582                         mov   a,dpl
    2626    2289   00B13 4583                         orl   a,dph
    2627    2290   00B15 70F9                         jnz   XCsw2xtal0
    2628    2291   00B17                  
    2629    2292   00B17 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2630    2293   00B1A                  
    2631    2294   00B1A                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2632    2295   00B1A E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2633    2296   00B1C 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2634    2297   00B1F                  ;Oscillator run detectie is klaar...
    2635    2298   00B1F 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2636    2299   00B22                  
    2637    2300   00B22                  
    2638    2301   00B22 E5B7                         mov   a,pll_con               ;lees pll_con
    2639    2302   00B24 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2640    2303   00B26 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2641    2304   00B28                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2642    2305   00B28                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2643    2306   00B28                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2644    2307   00B28 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2645    2308   00B2B                                                            ;bij aanpassing van de NDIV van de PLL
    2646    2309   00B2B F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2647    2310   00B2D 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2648    2311   00B30 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2649    2312   00B33                  
    2650    2313   00B33 E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2651    2314   00B35 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2652    2315   00B38                  
    2653    2316   00B38 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2654    2317   00B3B 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2655    2318   00B3E                  
    2656    2319   00B3E D0BF                         pop   scu_page                ;herstel controller status
    2657    2320   00B40 D0B2                         pop   port_page
    2658    2321   00B42 D08F                         pop   syscon0
    2659    2322   00B44 D0D0                         pop   psw
    2660    2323   00B46 D082                         pop   dpl
    2661    2324   00B48 D083                         pop   dph
    2662    2325   00B4A 22                           ret
    2663    2326   00B4B                  
    2664    2327   00B4B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2665    2328   00B4B                  ;
    2666    2329   00B4B                  ; mapregs	selecteer de SFR's in de mapped area
    2667    2330   00B4B                  ;
    2668    2331   00B4B                  ;
    2669    2332   00B4B                  ; Past syscon SFR aan
    2670    2333   00B4B                  ;
    2671    2334   00B4B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2672    2335   00B4B                  
    2673    2336   00B4B 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2674    2337   00B4E 22               		ret
    2675    2338   00B4F                  
    2676    2339   00B4F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2677    2340   00B4F                  ;
    2678    2341   00B4F                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2679    2342   00B4F                  ;
    2680    2343   00B4F                  ; Past syscon SFR aan
    2681    2344   00B4F                  ;
    2682    2345   00B4F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2683    2346   00B4F                  
    2684    2347   00B4F 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2685    2348   00B52 22               		ret
    2686    2349   00B53                  
    2687    2350   00B53                  ;*******************************************************************************
    2688    2351   00B53                  ;
    2689    2352   00B53                  ; These are the register declarations for the XC888 microcontroller from
    2690    2353   00B53                  ; Infineon.
    2691    2354   00B53                  ;
    2692    2355   00B53                  ;*******************************************************************************
    2693    2356   00B53                  
    2694    2357   00B53                  ;*******************************************************************************
    2695    2358   00B53                  ;
    2696    2359   00B53                  ; CPU registers are accessible independend of paging and mapping
    2697    2360   00B53                  ; (always accessible)
    2698    2361   00B53                  ;
    2699    2362   00B53                  ;*******************************************************************************
    2700    2363   00B53                  
    2701    2364   00B53                  sp            data   081h          ;stack pointer                     reset=007h
    2702    2365   00B53                  dpl           data   082h          ;datapointer low register          reset=000h
    2703    2366   00B53                  dph           data   083h          ;datapointer high register         reset=000h
    2704    2367   00B53                  pcon          data   087h          ;power control                     reset=000h
    2705    2368   00B53                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2706    2369   00B53                  ;tcon is bit addressable
    2707    2370   00B53                         tf1    bit    08fh
    2708    2371   00B53                         tr1    bit    08eh
    2709    2372   00B53                         tf0    bit    08dh
    2710    2373   00B53                         tr0    bit    08ch
    2711    2374   00B53                         ie1    bit    08bh
    2712    2375   00B53                         it1    bit    08ah
    2713    2376   00B53                         ie0    bit    089h
    2714    2377   00B53                         it0    bit    088h
    2715    2378   00B53                  
    2716    2379   00B53                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2717    2380   00B53                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2718    2381   00B53                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2719    2382   00B53                  th0           data   08ch          ;timer 0 high                      reset=000h
    2720    2383   00B53                  th1           data   08dh          ;timer 1 high                      reset=000h
    2721    2384   00B53                  
    2722    2385   00B53                  syscon0       data   08fh          ;system control register 0         reset=004h
    2723    2386   00B53                  scon          data   098h          ;serial channel 0 control          reset=000h
    2724    2387   00B53                  ;scon is bit addressable
    2725    2388   00B53                         sm0    bit    09fh
    2726    2389   00B53                         sm1    bit    09eh
    2727    2390   00B53                         sm2    bit    09dh
    2728    2391   00B53                         ren    bit    09ch
    2729    2392   00B53                         tb8    bit    09bh
    2730    2393   00B53                         rb8    bit    09ah
    2731    2394   00B53                         ti     bit    099h
    2732    2395   00B53                         ri     bit    098h
    2733    2396   00B53                  
    2734    2397   00B53                  sbuf          data   099h          ;serial data buffer channel 0
    2735    2398   00B53                  eo            data   0a2h          ;extended operation                reset=000h
    2736    2399   00B53                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2737    2400   00B53                  ;ien0 is bit addressable
    2738    2401   00B53                         ea     bit    0afh
    2739    2402   00B53                                                     ;bit not implemented
    2740    2403   00B53                         et2    bit    0adh
    2741    2404   00B53                         es     bit    0ach
    2742    2405   00B53                         et1    bit    0abh
    2743    2406   00B53                         ex1    bit    0aah
    2744    2407   00B53                         et0    bit    0a9h
    2745    2408   00B53                         ex0    bit    0a8h
    2746    2409   00B53                  
    2747    2410   00B53                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2748    2411   00B53                  ;ip is bit addressable
    2749    2412   00B53                                                     ;bit not implemented
    2750    2413   00B53                                                     ;bit not implemented
    2751    2414   00B53                         pt2    bit    0bdh
    2752    2415   00B53                         ps     bit    0bch
    2753    2416   00B53                         pt1    bit    0bbh
    2754    2417   00B53                         px1    bit    0bah
    2755    2418   00B53                         pt0    bit    0b9h
    2756    2419   00B53                         px0    bit    0b8h
    2757    2420   00B53                  
    2758    2421   00B53                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2759    2422   00B53                  psw           data   0d0h          ;program status word               reset=000h
    2760    2423   00B53                  ;psw is bit addressable
    2761    2424   00B53                         cy     bit    0d7h
    2762    2425   00B53                         ac     bit    0d6h
    2763    2426   00B53                         f0     bit    0d5h
    2764    2427   00B53                         rs1    bit    0d4h
    2765    2428   00B53                         rs0    bit    0d3h
    2766    2429   00B53                         ov     bit    0d2h
    2767    2430   00B53                         f1     bit    0d1h
    2768    2431   00B53                         p      bit    0d0h
    2769    2432   00B53                  
    2770    2433   00B53                  acc           data   0e0h          ;accumulator                       reset=000h
    2771    2434   00B53                  ;acc is bit addressable
    2772    2435   00B53                  
    2773    2436   00B53                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2774    2437   00B53                  ;ien1 is bit addressable
    2775    2438   00B53                         eccip3 bit    0efh
    2776    2439   00B53                         eccip2 bit    0eeh
    2777    2440   00B53                         eccip1 bit    0edh
    2778    2441   00B53                         eccip0 bit    0ech
    2779    2442   00B53                         exm    bit    0ebh
    2780    2443   00B53                         ex2    bit    0eah
    2781    2444   00B53                         essc   bit    0e9h
    2782    2445   00B53                         eadc   bit    0e8h
    2783    2446   00B53                  
    2784    2447   00B53                  b             data   0f0h          ;b register                        reset=000h
    2785    2448   00B53                  ;b is bit addressable
    2786    2449   00B53                  
    2787    2450   00B53                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2788    2451   00B53                  ;ip1 is bit addressable
    2789    2452   00B53                         pccip3 bit    0ffh
    2790    2453   00B53                         pccip2 bit    0feh
    2791    2454   00B53                         pccip1 bit    0fdh
    2792    2455   00B53                         pccip0 bit    0fch
    2793    2456   00B53                         pxm    bit    0fbh
    2794    2457   00B53                         px2    bit    0fah
    2795    2458   00B53                         pssc   bit    0f9h
    2796    2459   00B53                         padc   bit    0f8h
    2797    2460   00B53                  
    2798    2461   00B53                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2799    2462   00B53                  
    2800    2463   00B53                  
    2801    2464   00B53                  ;*******************************************************************************
    2802    2465   00B53                  ;
    2803    2466   00B53                  ; system control registers registers that can only be accessed in the non
    2804    2467   00B53                  ; mapped memory area (rmap=0) page independent
    2805    2468   00B53                  ;
    2806    2469   00B53                  ;*******************************************************************************
    2807    2470   00B53                  
    2808    2471   00B53                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2809    2472   00B53                  
    2810    2473   00B53                  ;*******************************************************************************
    2811    2474   00B53                  ;
    2812    2475   00B53                  ; system control registers registers that can only be accessed in the non
    2813    2476   00B53                  ; mapped memory area (rmap=0) and page 0
    2814    2477   00B53                  ;
    2815    2478   00B53                  ;*******************************************************************************
    2816    2479   00B53                  
    2817    2480   00B53                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2818    2481   00B53                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2819    2482   00B53                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2820    2483   00B53                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2821    2484   00B53                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2822    2485   00B53                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2823    2486   00B53                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2824    2487   00B53                  nmisr         data   0bch          ;nmi status                        reset=000h
    2825    2488   00B53                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2826    2489   00B53                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2827    2490   00B53                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2828    2491   00B53                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2829    2492   00B53                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2830    2493   00B53                  
    2831    2494   00B53                  ;*******************************************************************************
    2832    2495   00B53                  ;
    2833    2496   00B53                  ; system control registers registers that can only be accessed in the non
    2834    2497   00B53                  ; mapped memory area (rmap=0) and page 1
    2835    2498   00B53                  ;
    2836    2499   00B53                  ;*******************************************************************************
    2837    2500   00B53                  
    2838    2501   00B53                  id            data   0b3h          ;identity register     reset=device dependent
    2839    2502   00B53                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2840    2503   00B53                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2841    2504   00B53                  osc_con       data   0b6h          ;osc control                       reset=008h
    2842    2505   00B53                  pll_con       data   0b7h          ;pll control                       reset=090h
    2843    2506   00B53                  cmcon         data   0bah          ;clock control                     reset=010h
    2844    2507   00B53                  passwd        data   0bbh          ;password register                 reset=007h
    2845    2508   00B53                  feal          data   0bch          ;flash error register              reset=000h
    2846    2509   00B53                  feah          data   0bdh          ;flash error address high          reset=000h
    2847    2510   00B53                  cocon         data   0beh          ;clock output control              reset=000h
    2848    2511   00B53                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2849    2512   00B53                  
    2850    2513   00B53                  ;*******************************************************************************
    2851    2514   00B53                  ;
    2852    2515   00B53                  ; system control registers registers that can only be accessed in the non
    2853    2516   00B53                  ; mapped memory area (rmap=0) and page 3
    2854    2517   00B53                  ;
    2855    2518   00B53                  ;*******************************************************************************
    2856    2519   00B53                  
    2857    2520   00B53                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2858    2521   00B53                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2859    2522   00B53                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2860    2523   00B53                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2861    2524   00B53                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2862    2525   00B53                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2863    2526   00B53                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2864    2527   00B53                  
    2865    2528   00B53                  ;*******************************************************************************
    2866    2529   00B53                  ;
    2867    2530   00B53                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2868    2531   00B53                  ;
    2869    2532   00B53                  ;*******************************************************************************
    2870    2533   00B53                  
    2871    2534   00B53                  port_page     data   0b2h          ;port page register                reset=000h
    2872    2535   00B53                  
    2873    2536   00B53                  ;*******************************************************************************
    2874    2537   00B53                  ;
    2875    2538   00B53                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2876    2539   00B53                  ;
    2877    2540   00B53                  ;*******************************************************************************
    2878    2541   00B53                  
    2879    2542   00B53                  p0_data       data   080h          ;port 0 data register              reset=000h
    2880    2543   00B53                  ;p0_data is bit addressable
    2881    2544   00B53                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2882    2545   00B53                  p1_data       data   090h          ;port 1 data register              reset=000h
    2883    2546   00B53                  ;p1_data is bit addressable
    2884    2547   00B53                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2885    2548   00B53                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2886    2549   00B53                  ;p2_data is bit addressable
    2887    2550   00B53                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2888    2551   00B53                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2889    2552   00B53                  ;p3_data is bit addressable
    2890    2553   00B53                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2891    2554   00B53                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2892    2555   00B53                  ;p4_data is bit addressable
    2893    2556   00B53                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2894    2557   00B53                  p5_data       data   092h          ;port 5 data register              reset=000h
    2895    2558   00B53                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2896    2559   00B53                  
    2897    2560   00B53                  ;*******************************************************************************
    2898    2561   00B53                  ;
    2899    2562   00B53                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2900    2563   00B53                  ;
    2901    2564   00B53                  ;*******************************************************************************
    2902    2565   00B53                  
    2903    2566   00B53                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2904    2567   00B53                  ;p0_data is bit addressable
    2905    2568   00B53                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2906    2569   00B53                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2907    2570   00B53                  ;p1_data is bit addressable
    2908    2571   00B53                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2909    2572   00B53                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2910    2573   00B53                  ;p2_data is bit addressable
    2911    2574   00B53                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2912    2575   00B53                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2913    2576   00B53                  ;p3_data is bit addressable
    2914    2577   00B53                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2915    2578   00B53                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2916    2579   00B53                  ;p4_data is bit addressable
    2917    2580   00B53                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2918    2581   00B53                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2919    2582   00B53                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2920    2583   00B53                  
    2921    2584   00B53                  ;*******************************************************************************
    2922    2585   00B53                  ;
    2923    2586   00B53                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2924    2587   00B53                  ;
    2925    2588   00B53                  ;*******************************************************************************
    2926    2589   00B53                  
    2927    2590   00B53                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2928    2591   00B53                  ;p0_data is bit addressable
    2929    2592   00B53                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2930    2593   00B53                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2931    2594   00B53                  ;p1_data is bit addressable
    2932    2595   00B53                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2933    2596   00B53                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2934    2597   00B53                  ;p3_data is bit addressable
    2935    2598   00B53                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2936    2599   00B53                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2937    2600   00B53                  ;p4_data is bit addressable
    2938    2601   00B53                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2939    2602   00B53                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2940    2603   00B53                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2941    2604   00B53                  
    2942    2605   00B53                  ;*******************************************************************************
    2943    2606   00B53                  ;
    2944    2607   00B53                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2945    2608   00B53                  ;
    2946    2609   00B53                  ;*******************************************************************************
    2947    2610   00B53                  
    2948    2611   00B53                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2949    2612   00B53                  ;p0_data is bit addressable
    2950    2613   00B53                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2951    2614   00B53                  ;p1_data is bit addressable
    2952    2615   00B53                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2953    2616   00B53                  ;p3_data is bit addressable
    2954    2617   00B53                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2955    2618   00B53                  ;p4_data is bit addressable
    2956    2619   00B53                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2957    2620   00B53                  
    2958    2621   00B53                  ;*******************************************************************************
    2959    2622   00B53                  ;
    2960    2623   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2961    2624   00B53                  ;
    2962    2625   00B53                  ;*******************************************************************************
    2963    2626   00B53                  
    2964    2627   00B53                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2965    2628   00B53                  
    2966    2629   00B53                  ;*******************************************************************************
    2967    2630   00B53                  ;
    2968    2631   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2969    2632   00B53                  ;
    2970    2633   00B53                  ;*******************************************************************************
    2971    2634   00B53                  
    2972    2635   00B53                  adc_globctr   data   0cah          ;global control register           reset=030h
    2973    2636   00B53                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2974    2637   00B53                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2975    2638   00B53                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2976    2639   00B53                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2977    2640   00B53                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2978    2641   00B53                  
    2979    2642   00B53                  ;*******************************************************************************
    2980    2643   00B53                  ;
    2981    2644   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2982    2645   00B53                  ;
    2983    2646   00B53                  ;*******************************************************************************
    2984    2647   00B53                  
    2985    2648   00B53                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2986    2649   00B53                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2987    2650   00B53                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2988    2651   00B53                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2989    2652   00B53                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2990    2653   00B53                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2991    2654   00B53                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2992    2655   00B53                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2993    2656   00B53                  
    2994    2657   00B53                  ;*******************************************************************************
    2995    2658   00B53                  ;
    2996    2659   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2997    2660   00B53                  ;
    2998    2661   00B53                  ;*******************************************************************************
    2999    2662   00B53                  
    3000    2663   00B53                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    3001    2664   00B53                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    3002    2665   00B53                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    3003    2666   00B53                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    3004    2667   00B53                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    3005    2668   00B53                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    3006    2669   00B53                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    3007    2670   00B53                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    3008    2671   00B53                  
    3009    2672   00B53                  ;*******************************************************************************
    3010    2673   00B53                  ;
    3011    2674   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    3012    2675   00B53                  ;
    3013    2676   00B53                  ;*******************************************************************************
    3014    2677   00B53                  
    3015    2678   00B53                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    3016    2679   00B53                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    3017    2680   00B53                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    3018    2681   00B53                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    3019    2682   00B53                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    3020    2683   00B53                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    3021    2684   00B53                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    3022    2685   00B53                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    3023    2686   00B53                  
    3024    2687   00B53                  ;*******************************************************************************
    3025    2688   00B53                  ;
    3026    2689   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    3027    2690   00B53                  ;
    3028    2691   00B53                  ;*******************************************************************************
    3029    2692   00B53                  
    3030    2693   00B53                  adc_rcr0      data   0cah          ;result control register           reset=000h
    3031    2694   00B53                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    3032    2695   00B53                  adc_rcr2      data   0cch          ;result control register           reset=000h
    3033    2696   00B53                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    3034    2697   00B53                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    3035    2698   00B53                  
    3036    2699   00B53                  ;*******************************************************************************
    3037    2700   00B53                  ;
    3038    2701   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    3039    2702   00B53                  ;
    3040    2703   00B53                  ;*******************************************************************************
    3041    2704   00B53                  
    3042    2705   00B53                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    3043    2706   00B53                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    3044    2707   00B53                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    3045    2708   00B53                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    3046    2709   00B53                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    3047    2710   00B53                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    3048    2711   00B53                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    3049    2712   00B53                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    3050    2713   00B53                  
    3051    2714   00B53                  ;*******************************************************************************
    3052    2715   00B53                  ;
    3053    2716   00B53                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    3054    2717   00B53                  ;
    3055    2718   00B53                  ;*******************************************************************************
    3056    2719   00B53                  
    3057    2720   00B53                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    3058    2721   00B53                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    3059    2722   00B53                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3060    2723   00B53                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3061    2724   00B53                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3062    2725   00B53                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3063    2726   00B53                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3064    2727   00B53                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3065    2728   00B53                  
    3066    2729   00B53                  ;*******************************************************************************
    3067    2730   00B53                  
    3068    2731   00B53                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3069    2732   00B53                  ;
    3070    2733   00B53                  ;*******************************************************************************
    3071    2734   00B53                  
    3072    2735   00B53                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3073    2736   00B53                  ;t2_t2con is bit addressable
    3074    2737   00B53                         tf2    bit    0c7h
    3075    2738   00B53                         exf2   bit    0c6h
    3076    2739   00B53                                                     ;2 bits are not implemented
    3077    2740   00B53                         exen2  bit    0c3h
    3078    2741   00B53                         tr2    bit    0c2h
    3079    2742   00B53                         ct2    bit    0c1h
    3080    2743   00B53                         cprl2  bit    0c0h
    3081    2744   00B53                  
    3082    2745   00B53                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3083    2746   00B53                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3084    2747   00B53                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3085    2748   00B53                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3086    2749   00B53                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3087    2750   00B53                  
    3088    2751   00B53                  ;*******************************************************************************
    3089    2752   00B53                  ;
    3090    2753   00B53                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3091    2754   00B53                  ;
    3092    2755   00B53                  ;*******************************************************************************
    3093    2756   00B53                  
    3094    2757   00B53                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3095    2758   00B53                  
    3096    2759   00B53                  ;*******************************************************************************
    3097    2760   00B53                  ;
    3098    2761   00B53                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3099    2762   00B53                  ;
    3100    2763   00B53                  ;*******************************************************************************
    3101    2764   00B53                  
    3102    2765   00B53                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3103    2766   00B53                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3104    2767   00B53                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3105    2768   00B53                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3106    2769   00B53                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3107    2770   00B53                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3108    2771   00B53                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3109    2772   00B53                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3110    2773   00B53                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3111    2774   00B53                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3112    2775   00B53                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3113    2776   00B53                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3114    2777   00B53                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3115    2778   00B53                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3116    2779   00B53                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3117    2780   00B53                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3118    2781   00B53                  
    3119    2782   00B53                  ;*******************************************************************************
    3120    2783   00B53                  ;
    3121    2784   00B53                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3122    2785   00B53                  ;
    3123    2786   00B53                  ;*******************************************************************************
    3124    2787   00B53                  
    3125    2788   00B53                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3126    2789   00B53                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3127    2790   00B53                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3128    2791   00B53                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3129    2792   00B53                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3130    2793   00B53                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3131    2794   00B53                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3132    2795   00B53                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3133    2796   00B53                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3134    2797   00B53                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3135    2798   00B53                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3136    2799   00B53                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3137    2800   00B53                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3138    2801   00B53                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3139    2802   00B53                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3140    2803   00B53                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3141    2804   00B53                  
    3142    2805   00B53                  ;*******************************************************************************
    3143    2806   00B53                  ;
    3144    2807   00B53                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3145    2808   00B53                  ;
    3146    2809   00B53                  ;*******************************************************************************
    3147    2810   00B53                  
    3148    2811   00B53                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3149    2812   00B53                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3150    2813   00B53                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3151    2814   00B53                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3152    2815   00B53                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3153    2816   00B53                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3154    2817   00B53                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3155    2818   00B53                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3156    2819   00B53                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3157    2820   00B53                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3158    2821   00B53                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3159    2822   00B53                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3160    2823   00B53                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3161    2824   00B53                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3162    2825   00B53                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3163    2826   00B53                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3164    2827   00B53                  
    3165    2828   00B53                  ;*******************************************************************************
    3166    2829   00B53                  ;
    3167    2830   00B53                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3168    2831   00B53                  ;
    3169    2832   00B53                  ;*******************************************************************************
    3170    2833   00B53                  
    3171    2834   00B53                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3172    2835   00B53                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3173    2836   00B53                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3174    2837   00B53                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3175    2838   00B53                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3176    2839   00B53                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3177    2840   00B53                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3178    2841   00B53                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3179    2842   00B53                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3180    2843   00B53                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3181    2844   00B53                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3182    2845   00B53                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3183    2846   00B53                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3184    2847   00B53                  
    3185    2848   00B53                  ;*******************************************************************************
    3186    2849   00B53                  ;
    3187    2850   00B53                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3188    2851   00B53                  ;
    3189    2852   00B53                  ;*******************************************************************************
    3190    2853   00B53                  
    3191    2854   00B53                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3192    2855   00B53                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3193    2856   00B53                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3194    2857   00B53                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3195    2858   00B53                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3196    2859   00B53                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3197    2860   00B53                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3198    2861   00B53                  
    3199    2862   00B53                  ;*******************************************************************************
    3200    2863   00B53                  ;
    3201    2864   00B53                  ; can registers can be accessed in the standard memory map (rmap=0)
    3202    2865   00B53                  ;
    3203    2866   00B53                  ;*******************************************************************************
    3204    2867   00B53                  
    3205    2868   00B53                  adcon         data   0d8h          ;adres/data control                reset=000h
    3206    2869   00B53                  ; adcon is bit addressable
    3207    2870   00B53                         v3     bit    0dfh
    3208    2871   00B53                         v2     bit    0deh
    3209    2872   00B53                         v1     bit    0ddh
    3210    2873   00B53                         v0     bit    0dch
    3211    2874   00B53                         auad1  bit    0dbh
    3212    2875   00B53                         auad0  bit    0dah
    3213    2876   00B53                         can_bsy bit   0d9h
    3214    2877   00B53                         rwen   bit    0d8h
    3215    2878   00B53                  
    3216    2879   00B53                  adl           data   0d9h          ;adres register low                reset=000h
    3217    2880   00B53                  adh           data   0dah          ;adres register low                reset=000h
    3218    2881   00B53                  data0         data   0dbh          ;can data                          reset=000h
    3219    2882   00B53                  data1         data   0dch          ;can data                          reset=000h
    3220    2883   00B53                  data2         data   0ddh          ;can data                          reset=000h
    3221    2884   00B53                  data3         data   0deh          ;can data                          reset=000h
    3222    2885   00B53                  
    3223    2886   00B53                  ;*******************************************************************************
    3224    2887   00B53                  ;
    3225    2888   00B53                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3226    2889   00B53                  ;
    3227    2890   00B53                  ;*******************************************************************************
    3228    2891   00B53                  
    3229    2892   00B53                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3230    2893   00B53                  ;mdustat is bit addressable
    3231    2894   00B53                                                     ;5 bits are not implemented
    3232    2895   00B53                         bsy    bit    0b2h
    3233    2896   00B53                         ierr   bit    0b1h
    3234    2897   00B53                         irdy   bit    0b0h
    3235    2898   00B53                  
    3236    2899   00B53                  mducon        data   0b1h          ;mdu control                       reset=000h
    3237    2900   00B53                  md0           data   0b2h          ;mdu operand register              reset=000h
    3238    2901   00B53                  mr0           data   0b2h          ;mdu result register               reset=000h
    3239    2902   00B53                  md1           data   0b3h          ;mdu operand register              reset=000h
    3240    2903   00B53                  mr1           data   0b3h          ;mdu result register               reset=000h
    3241    2904   00B53                  md2           data   0b4h          ;mdu operand register              reset=000h
    3242    2905   00B53                  mr2           data   0b4h          ;mdu result register               reset=000h
    3243    2906   00B53                  md3           data   0b5h          ;mdu operand register              reset=000h
    3244    2907   00B53                  mr3           data   0b5h          ;mdu result register               reset=000h
    3245    2908   00B53                  md4           data   0b6h          ;mdu operand register              reset=000h
    3246    2909   00B53                  mr4           data   0b6h          ;mdu result register               reset=000h
    3247    2910   00B53                  md5           data   0b7h          ;mdu operand register              reset=000h
    3248    2911   00B53                  mr5           data   0b7h          ;mdu result register               reset=000h
    3249    2912   00B53                  
    3250    2913   00B53                  ;*******************************************************************************
    3251    2914   00B53                  ;
    3252    2915   00B53                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3253    2916   00B53                  ;
    3254    2917   00B53                  ;*******************************************************************************
    3255    2918   00B53                  
    3256    2919   00B53                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3257    2920   00B53                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3258    2921   00B53                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3259    2922   00B53                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3260    2923   00B53                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3261    2924   00B53                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3262    2925   00B53                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3263    2926   00B53                  ;cd_statc is bit addressable
    3264    2927   00B53                         keepz  bit    0a7h
    3265    2928   00B53                         keepy  bit    0a6h
    3266    2929   00B53                         keepx  bit    0a5h
    3267    2930   00B53                         dmap   bit    0a4h
    3268    2931   00B53                         int_en bit    0a3h
    3269    2932   00B53                         eoc    bit    0a2h
    3270    2933   00B53                         error  bit    0a1h
    3271    2934   00B53                         cd_bsy bit    0a0h
    3272    2935   00B53                  
    3273    2936   00B53                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3274    2937   00B53                  
    3275    2938   00B53                  ;*******************************************************************************
    3276    2939   00B53                  ;
    3277    2940   00B53                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3278    2941   00B53                  ;
    3279    2942   00B53                  ;*******************************************************************************
    3280    2943   00B53                  
    3281    2944   00B53                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3282    2945   00B53                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3283    2946   00B53                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3284    2947   00B53                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3285    2948   00B53                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3286    2949   00B53                  
    3287    2950   00B53                  ;*******************************************************************************
    3288    2951   00B53                  ;
    3289    2952   00B53                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3290    2953   00B53                  ;
    3291    2954   00B53                  ;*******************************************************************************
    3292    2955   00B53                  
    3293    2956   00B53                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3294    2957   00B53                  ;t2_t2con is bit addressable bits are aalready defined
    3295    2958   00B53                         ;tf2    bit    0c7h
    3296    2959   00B53                         ;exf2   bit    0c6h
    3297    2960   00B53                                                     ;2 bits are not implemented
    3298    2961   00B53                         ;exen2  bit    0c3h
    3299    2962   00B53                         ;tr2    bit    0c2h
    3300    2963   00B53                         ;ct2    bit    0c1h
    3301    2964   00B53                         ;cprl2  bit    0c0h
    3302    2965   00B53                  
    3303    2966   00B53                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3304    2967   00B53                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3305    2968   00B53                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3306    2969   00B53                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3307    2970   00B53                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3308    2971   00B53                  
    3309    2972   00B53                  ;*******************************************************************************
    3310    2973   00B53                  ;
    3311    2974   00B53                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3312    2975   00B53                  ;
    3313    2976   00B53                  ;*******************************************************************************
    3314    2977   00B53                  
    3315    2978   00B53                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3316    2979   00B53                  ;s1con is bit addressable
    3317    2980   00B53                         sm01   bit    0cfh
    3318    2981   00B53                         sm11   bit    0ceh
    3319    2982   00B53                         sm21   bit    0cdh
    3320    2983   00B53                         ren1   bit    0cch
    3321    2984   00B53                         tb81   bit    0cbh
    3322    2985   00B53                         rb81   bit    0cah
    3323    2986   00B53                         ti1    bit    0c9h
    3324    2987   00B53                         ri1    bit    0c8h
    3325    2988   00B53                  
    3326    2989   00B53                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3327    2990   00B53                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3328    2991   00B53                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3329    2992   00B53                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3330    2993   00B53                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3331    2994   00B53                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3332    2995   00B53                  
    3333    2996   00B53                  ;*******************************************************************************
    3334    2997   00B53                  ;
    3335    2998   00B53                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3336    2999   00B53                  ;
    3337    3000   00B53                  ;*******************************************************************************
    3338    3001   00B53                  
    3339    3002   00B53                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3340    3003   00B53                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3341    3004   00B53                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3342    3005   00B53                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3343    3006   00B53                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3344    3007   00B53                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3345    3008   00B53                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3346    3009   00B53                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3347    3010   00B53                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3348    3011   00B53                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3349    3012   00B53                  
    3350    3013   00B53                  ;end directive must be used, but has no signification
    3351    3014   00B53                  
    3352    3015   00B53                  end
    3353    3016   00B53                  
    3354    3017   00B53                  
    3355    3018   00B53                  
    3356    3019   00B53                  
    3357    3020   00B53                  
    3358    3021   00B53                  
    3359    3022   00B53                  
    3360    3023   00B53                  
    3361    3024   00B53                  
    3362    3025   00B53                  
    3363    3026   00B53                  
    3364    3027   00B53                  
    3365    3028   00B53                  
    3366    3029   00B53                  
    3367    3030   00B53                  
    3368    3031   00B53                  
