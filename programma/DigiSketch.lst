C:\Users\Nico\Documents\Thomas more\Digi-sketch\programma\DigiSketch.xsf 
       1       1   00000                  org 0000h
       2       2   00000 120035           lcall   main
       3       3   00003                  
       4       4   0000B                  org 000bh
       5       5   0000B 12000E           lcall   timer
       6       6   0000E                  
       7       7   0000E                  timer:
       8       8   0000E C0E0                 push    acc
       9       9   00010 C0D0                 push    psw
      10      10   00012 78FF                 mov     r0,#ffh
      11      11   00014 120196               lcall   debug
      12      12   00017 85C8F0               mov     b,p4_data
      13      13   0001A 20F203               jb      b.2,gedrukt1
      14      14   0001D 020025               ljmp    n1
      15      15   00020                  gedrukt1:
      16      16   00020 7801                 mov     r0,#01h                        ;debug status op aurt zetten
      17      17   00022 120196               lcall   debug
      18      18   00025                  n1:
      19      19   00025 20F703               jb      b.7,gedrukt2
      20      20   00028 020030               ljmp    n2
      21      21   0002B                  gedrukt2:
      22      22   0002B 7802                 mov     r0,#02h
      23      23   0002D 120196               lcall   debug
      24      24   00030                  n2:
      25      25   00030 D0D0                 pop     psw
      26      26   00032 D0E0                 pop     acc
      27      27   00034 32               reti
      28      28   00035                  
      29      29   00035                  ;------------------------------------------------------------------
      30      30   00035                  ;Hoofd programma
      31      31   00035                  ;------------------------------------------------------------------
      32      32   00035                  main:
      33      33   00035 75817F               mov     sp,#7fh                 ;stackpointer instellen
      34      34   00038 12003E               lcall   inits
      35      35   0003B                  
      36      36   0003B                  
      37      37   0003B                  lus2:
      38      38   0003B                  
      39      39   0003B 02003B               ljmp    lus2
      40      40   0003E                  
      41      41   0003E                  
      42      42   0003E                  
      43      43   0003E                  ;------------------------------------------------------------------
      44      44   0003E                  ;Initializatie van alle componenten nodig in het hoofd programma
      45      45   0003E                  ;------------------------------------------------------------------
      46      46   0003E                  inits:
      47      47   0003E                      ;lcall   initGLCD                ;initializatie grafisch LCD scherm, MOET EERST GEBEUREN
      48      48   0003E 120042               lcall   initRotary
      49      49   00041 22               ret
      50      50   00042                  
      51      51   00042                  ;------------------------------------------------------------------
      52      52   00042                  ;Initializatie van de rotary encoders
      53      53   00042                  ;------------------------------------------------------------------
      54      54   00042                  initRotary:
      55      55   00042 120058               lcall   P4in
      56      56   00045 120561               lcall   initsio
      57      57   00048 758902               mov     tmod,#00000010b ;timer in auto relaud mode zetten
      58      58   0004B 758A01               mov     tl0,#01h
      59      59   0004E 758C01               mov     th0,#01h
      60      60   00051 D28C                 setb    tr0
      61      61   00053 D2AF                 setb    ea
      62      62   00055 D2A9                 setb    et0
      63      63   00057 22               ret
      64      64   00058                  
      65      65   00058                  P4in:
      66      66   00058 C08F                 push    syscon0              ;juiste map selecteren
      67      67   0005A 758F04               mov     syscon0,#004h
      68      68   0005D C0B2                 push    port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
      69      69   0005F 75B200               mov     port_page,#000h      ;pagina 0 selecteren
      70      70   00062 75C900               mov     p4_dir,#000h         ;poort 4 als input schakelen
      71      71   00065 D0B2                 pop     port_page            ;herstellen in oorspronkelijke staat
      72      72   00067 D08F                 pop     syscon0              ;pagina terug herstellen
      73      73   00069 22               ret
      74      74   0006A                  
      75      75   0006A                  
      76      76   0006A                  
project.inc 
      78       1   0006A                  ;------------------------------------------------------------------
      79       2   0006A                  ;Lijst van functies:
      80       3   0006A                  ;   -statusCheck            Status check van scherm opslaan in STA register
      81       4   0006A                  ;   -initGLCD               Initializatie van grafisch LCD scherm
      82       5   0006A                  ;   -P1out                  Initializatie poort 1 als output
      83       6   0006A                  ;   -P3in                   Initializatie poort 3 als output
      84       7   0006A                  ;   -P3out                  Initializatie poort 3 als input
      85       8   0006A                  ;   -zendData               Data verzeden naar scherm
      86       9   0006A                  ;   -zenComando             Comando verzeden naar scherm
      87      10   0006A                  ;   -debug                  debug info op seriele poot zetten
      88      11   0006A                  ;------------------------------------------------------------------
      89      12   0006A                  ;------------------------------------------------------------------
      90      13   0006A                  ;declaratie van pinnen
      91      14   0006A                  ;------------------------------------------------------------------
      92      15   0006A                      WR          bit     p3_data.0   ;write line van scherm actief laag
      93      16   0006A                      RD          bit     p3_data.1   ;read line van scherrm actief laag
      94      17   0006A                      CE          bit     p3_data.2   ;chip enble van scherm actief laag
      95      18   0006A                      CD          bit     p3_data.3   ;Command write
      96      19   0006A                      RESET       bit     p1_data.1   ;reset van scherm actief laag
      97      20   0006A                      FS          bit     p1_data.0   ;font groote selecteren FS=1: 6*8, FS=0: 8*8
      98      21   0006A                  
      99      22   0006A                  
     100      23   0006A                  
     101      24   0006A                  ;------------------------------------------------------------------
     102      25   0006A                  ;declaratie van registers
     103      26   0006A                  ;------------------------------------------------------------------
     104      27   0006A                      STA         equ     10h         ;geheugenplaats 10h gelijk stellen aan STA
     105      28   0006A                      DATAREG     equ     11h         ;geheugenplaats voor het verzenden van data naar het scherm
     106      29   0006A                      COMANDREG   equ     12h         ;geheugenplaats voor het verzenden van comandos naar het scherm
     107      30   0006A                  
     108      31   0006A                  
     109      32   0006A                  ;------------------------------------------------------------------
     110      33   0006A                  ;Status check van scherm opslaan in STA register
     111      34   0006A                  ;-STA
     112      35   0006A                  ;------------------------------------------------------------------
     113      36   0006A                  statusCheck:
     114      37   0006A C0E0                 push    acc
     115      38   0006C C0D0                 push    psw
     116      39   0006E 120149               lcall   P5in                        ;poort 4 als input schakelen
     117      40   00071 7592FF               mov     p5_data,#ffh
     118      41   00074 12011C               lcall   P3out
     119      42   00077                  STAOPNIEUW:
     120      43   00077 751000               mov     STA,#00h                    ;STA register leeg maken
     121      44   0007A 75B00E               mov     p3_data,#00001110b
     122      45   0007D 120341               lcall   delay1ms
     123      46   00080 E592                 mov     a,p5_data                   ;status word inlezen
     124      47   00082 F8                       mov     r0,a                        ;debug status op aurt zetten
     125      48   00083 120196               lcall   debug
     126      49   00086 5403                 anl     a,#00000011b                ;masker voor STA0 en STA1
     127      50   00088                  
     128      51   00088 B403EC               cjne    a,#00000011b,STAOPNIEUW      ;vergelijken
     129      52   0008B F510                 mov     STA,a                       ;data opslaan in STA voor eventuel gebruik later
     130      53   0008D F8                   mov     r0,a                        ;debug status op aurt zetten
     131      54   0008E 120196               lcall   debug
     132      55   00091 C2B2                 clr     CE
     133      56   00093 D0D0                 pop     psw
     134      57   00095 D0E0                 pop     acc
     135      58   00097 22               ret
     136      59   00098                  
     137      60   00098                  ;------------------------------------------------------------------
     138      61   00098                  ;Initializatie van grafisch LCD scherm
     139      62   00098                  ;-Poort 1
     140      63   00098                  ;------------------------------------------------------------------
     141      64   00098                  initGLCD:
     142      65   00098 120101               lcall   P1out                   ;poort 1 initializeren
     143      66   0009B C291                 clr     RESET                   ;reseten van scherm
     144      67   0009D 7420                 mov     a,#20h                   ;reset lang genenoeg laten duren
     145      68   0009F 120328               lcall   delaya0k05s
     146      69   000A2 D290                 setb    FS                      ;font op 6*8 zetten
     147      70   000A4 D291                 setb    RESET                   ;reset terug af zetten
     148      71   000A6                  
     149      72   000A6                  
     150      73   000A6 120561               lcall   initsio                 ;voor debug
     151      74   000A9                  
     152      75   000A9 12006A               lcall   statusCheck             ;initiele status check uitvoeren
     153      76   000AC                  
     154      77   000AC 751100               mov     DATAREG,#00h            ;grafisch home adres
     155      78   000AF 120158               lcall   zendData
     156      79   000B2 751100               mov     DATAREG,#00h
     157      80   000B5 120158               lcall   zendData
     158      81   000B8 751242               mov     COMANDREG,#42h
     159      82   000BB 120177               lcall   zendComando
     160      83   000BE                  
     161      84   000BE 75111E               mov     DATAREG,#1eh            ;Grafic aeria set
     162      85   000C1 120158               lcall   zendData
     163      86   000C4 751100               mov     DATAREG,#00h
     164      87   000C7 120158               lcall   zendData
     165      88   000CA 751243               mov     COMANDREG,#43h
     166      89   000CD 120177               lcall   zendComando
     167      90   000D0                  
     168      91   000D0                  
     169      92   000D0 751100               mov     DATAREG,#00h            ;text home aderes
     170      93   000D3 120158               lcall   zendData
     171      94   000D6 751100               mov     DATAREG,#00h
     172      95   000D9 120158               lcall   zendData
     173      96   000DC 751240               mov     COMANDREG,#40h
     174      97   000DF 120177               lcall   zendComando
     175      98   000E2                  
     176      99   000E2 75111E               mov     DATAREG,#1eh            ;aantal colommen text
     177     100   000E5 120158               lcall   zendData
     178     101   000E8 751100               mov     DATAREG,#00h
     179     102   000EB 120158               lcall   zendData
     180     103   000EE 751241               mov     COMANDREG,#41h
     181     104   000F1 120177               lcall   zendComando
     182     105   000F4                  
     183     106   000F4 751280               mov     COMANDREG,#80h
     184     107   000F7 120177               lcall   zendComando
     185     108   000FA                  
     186     109   000FA 75129E               mov     COMANDREG,#9Eh
     187     110   000FD 120177               lcall   zendComando
     188     111   00100 22               ret
     189     112   00101                  
     190     113   00101                  
     191     114   00101                  ;------------------------------------------------------------------
     192     115   00101                  ;Initializatie poort 1 als output
     193     116   00101                  ;-poort 1
     194     117   00101                  ;------------------------------------------------------------------
     195     118   00101                  P1out:
     196     119   00101 C08F                 push    syscon0                 ;juiste map selecteren
     197     120   00103 758F04               mov     syscon0,#004h
     198     121   00106 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     199     122   00108 75B201               mov     port_page,#001h         ;selecteer poort page 0
     200     123   0010B 7590FF               mov     p1_pudsel,#0ffh         ;selecteer pull_up device
     201     124   0010E 7591FF               mov     p1_puden,#0ffh          ;selectie inschakelen
     202     125   00111 75B200               mov     port_page,#000h         ;selecteer poort page 0
     203     126   00114 7591FF               mov     p1_dir,#0ffh            ;poort 1 als output schakelen
     204     127   00117 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     205     128   00119 D08F                 pop     syscon0                 ;pagina terug herstellen
     206     129   0011B 22               ret
     207     130   0011C                  
     208     131   0011C                  ;------------------------------------------------------------------
     209     132   0011C                  ;Initializatie poort 3 als output
     210     133   0011C                  ;-poort 3
     211     134   0011C                  ;------------------------------------------------------------------
     212     135   0011C                  P3out:
     213     136   0011C C08F                 push    syscon0                 ;juiste map selecteren
     214     137   0011E 758F04               mov     syscon0,#004h
     215     138   00121 C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     216     139   00123 75B201               mov     port_page,#001h      ;selecteer poort page 1
     217     140   00126 75B0FF               mov     p3_pudsel,#0ffh      ;selecteer pull_up device
     218     141   00129 75B1FF               mov     p3_puden,#0ffh       ;selectie inschakelen
     219     142   0012C 75B200               mov     port_page,#000h         ;selecteer poort page 0
     220     143   0012F 75B1FF               mov     p3_dir,#0ffh            ;poort 3 als output schakelen
     221     144   00132 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     222     145   00134 D08F                 pop     syscon0                 ;pagina terug herstellen
     223     146   00136 22               ret
     224     147   00137                  
     225     148   00137                  ;------------------------------------------------------------------
     226     149   00137                  ;Initializatie poort 5 als output
     227     150   00137                  ;-poort 5
     228     151   00137                  ;------------------------------------------------------------------
     229     152   00137                  P5out:
     230     153   00137 C08F                 push    syscon0                 ;juiste map selecteren
     231     154   00139 758F04               mov     syscon0,#004h
     232     155   0013C C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     233     156   0013E                  ;    mov    port_page,#001h      ;selecteer poort page 1
     234     157   0013E                  ;    mov    p5_pudsel,#0ffh      ;selecteer pull_up device
     235     158   0013E                  ;    mov    p5_puden,#0ffh       ;selectie inschakelen
     236     159   0013E 75B200               mov     port_page,#000h         ;selecteer poort page 0
     237     160   00141 7593FF               mov     p5_dir,#0ffh            ;poort 5 als output schakelen
     238     161   00144 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     239     162   00146 D08F                 pop     syscon0                 ;pagina terug herstellen
     240     163   00148 22               ret
     241     164   00149                  
     242     165   00149                  ;------------------------------------------------------------------
     243     166   00149                  ;Initializatie poort 4 als input
     244     167   00149                  ;-poort 4
     245     168   00149                  ;------------------------------------------------------------------
     246     169   00149                  P5in:
     247     170   00149 C08F                 push    syscon0                 ;juiste map selecteren
     248     171   0014B 758F04               mov     syscon0,#004h
     249     172   0014E C0B2                 push    port_page               ;tijdelijk bewaren zodat we dat kunnen herstellen
     250     173   00150                  ;        mov    port_page,#001h      ;selecteer poort page 1
     251     174   00150                  ;    mov    p5_pudsel,#0ffh      ;selecteer pull_up device
     252     175   00150                  ;    mov    p5_puden,#0ffh       ;selectie inschakelen
     253     176   00150                  ;    mov     port_page,#000h         ;selecteer poort page 0
     254     177   00150 759300               mov     p5_dir,#000h            ;poort 5 als input schakelen
     255     178   00153 D0B2                 pop     port_page               ;herstellen in oorspronkelijke staat
     256     179   00155 D08F                 pop     syscon0                 ;pagina terug herstellen
     257     180   00157 22               ret
     258     181   00158                  ;------------------------------------------------------------------
     259     182   00158                  ;Data verzeden naar scherm
     260     183   00158                  ;-DATAREG
     261     184   00158                  ;------------------------------------------------------------------
     262     185   00158                  zendData:
     263     186   00158 C0E0                 push    acc
     264     187   0015A C0D0                 push    psw
     265     188   0015C 12006A               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     266     189   0015F 120137               lcall   P5out                   ;poort 5 als output schakelen
     267     190   00162 851192               mov     p5_data,DATAREG               ;data op de poort zetten
     268     191   00165 75B009               mov     p3_data,#00001001b
     269     192   00168 120341               lcall   delay1ms
     270     193   0016B C2B2                 clr     CE
     271     194   0016D A811                 mov     r0,DATAREG
     272     195   0016F 120196               lcall   debug
     273     196   00172 D0D0                 pop     psw
     274     197   00174 D0E0                 pop     acc
     275     198   00176 22               ret
     276     199   00177                  
     277     200   00177                  ;------------------------------------------------------------------
     278     201   00177                  ;Comando verzeden naar scherm
     279     202   00177                  ;-COMANDREG
     280     203   00177                  ;------------------------------------------------------------------
     281     204   00177                  zendComando:
     282     205   00177 C0E0                 push    acc
     283     206   00179 C0D0                 push    psw
     284     207   0017B 12006A               lcall   statusCheck             ;status van scherm checken voor het zenden van data
     285     208   0017E 120137               lcall   P5out                   ;poort 5 als output schakelen
     286     209   00181 851292               mov     p5_data,COMANDREG       ;data op de poort zetten
     287     210   00184 75B00E               mov     p3_data,#00001110b
     288     211   00187 120341               lcall   delay1ms
     289     212   0018A C2B2                 clr     CE
     290     213   0018C A812                 mov     r0,COMANDREG
     291     214   0018E 120196               lcall   debug
     292     215   00191 D0D0                 pop     psw
     293     216   00193 D0E0                 pop     acc
     294     217   00195 22               ret
     295     218   00196                  
     296     219   00196                  ;------------------------------------------------------------------
     297     220   00196                  ;debug info op seriele poort zetten
     298     221   00196                  ;-r0
     299     222   00196                  ;------------------------------------------------------------------
     300     223   00196                  debug:
     301     224   00196 C0E0                 push    acc
     302     225   00198 C0D0                 push    psw
     303     226   0019A 740D                 mov     a,#0dh
     304     227   0019C 120599               lcall   siooutchar
     305     228   0019F E8                   mov     a,r0
     306     229   001A0 1205B5               lcall   siooutbyte
     307     230   001A3 740A                 mov     a,#0ah
     308     231   001A5 120599               lcall   siooutchar
     309     232   001A8 D0D0                 pop     psw
     310     233   001AA D0E0                 pop     acc
     311     234   001AC 22               ret
     312     235   001AD                  
     313     236   001AD                  
     314     237   001AD                  
     315     238   001AD                  
     316     239   001AD                  
     317     240   001AD                  
     318     241   001AD                  
     319     242   001AD                  
     320     243   001AD                  
     321     244   001AD                  
     322     245   001AD                  
     323     246   001AD                  
     324     247   001AD                  
     325     248   001AD                  
     326     249   001AD                  
     327     250   001AD                  
     328     251   001AD                  
     329     252   001AD                  
     330     253   001AD                  
     331     254   001AD                  
xcez1.inc 
     333       1   001AD                  ;*******************************************************************************
     334       2   001AD                  ;
     335       3   001AD                  ; xcez1.inc is the registerfile/driver package for the XC888 micrcontroller from Infineon.
     336       4   001AD                  ;
     337       5   001AD                  ; The file contains drivers for various hardware and math applications.
     338       6   001AD                  ; In addition all register declarations are added.
     339       7   001AD                  ;
     340       8   001AD                  ; WARNING:!!!!!!!
     341       9   001AD                  ; INCLUDE THIS FILE AT THE END OF THE USER PROGRAM
     342      10   001AD                  ;
     343      11   001AD                  ; Written by Roggemans M. (MGM) 07/2011 v0.0
     344      12   001AD                  ;
     345      13   001AD                  ;*******************************************************************************
     346      14   001AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     347      15   001AD                  ;
     348      16   001AD                  ; xcez is een board package driver voor het XC888 SBC bord van MGM/dp.
     349      17   001AD                  ;
     350      18   001AD                  ; De driver bevat subroutines die toelaten de hardware van het SBC bord op een
     351      19   001AD                  ; eenvoudige manier te gebruiken:
     352      20   001AD                  ;
     353      21   001AD                  ; standaard I/O:
     354      22   001AD                  ;      initdipswitch        klaar zetten poort 4 voor gebruik met de dipswitch
     355      23   001AD                  ;      initftoetsen         klaar zetten 4 functieschakelaars onderaan scherm
     356      24   001AD                  ;      initleds             klaar zetten LED's als outputs
     357      25   001AD                  ;
     358      26   001AD                  ; I2C interface (minimale interface op 100kbit/s) enkel master mode!!
     359      27   001AD                  ;      initiic              klaar zetten iic interface
     360      28   001AD                  ;      iicstart             genereren van een startconditie op iic poort
     361      29   001AD                  ;      iicstop              genereren stop conditie op iic poort
     362      30   001AD                  ;      iicinbyteack         lezen van 1 byte met ack (accu=output)
     363      31   001AD                  ;      iicinbytenack        lezen van 1 byte met nack (accu=output)
     364      32   001AD                  ;      iicoutbyte           schrijven van 1 byte (accu=input, c=waarde ack bit slave)
     365      33   001AD                  ;
     366      34   001AD                  ; LCD interace
     367      35   001AD                  ;      initlcd              klaar zetten LCD voor gebruik (incl i2c init)
     368      36   001AD                  ;      lcdoutchar           schrijven van ascii code (accu=input)
     369      37   001AD                  ;      lcdoutbyte           schrijven hex waarde accu naar LCD
     370      38   001AD                  ;      lcdoutnib            afdrukken 4 laagste bits accu op LCD
     371      39   001AD                  ;      lcdoutmsga           afdrukken ascii string @dptr, tot 000h code
     372      40   001AD                  ;      lcdlighton           backlight aan
     373      41   001AD                  ;      lcdlightoff          backlight uit
     374      42   001AD                  ;      lcdbuzon             buzzer aan
     375      43   001AD                  ;      lcdbuzof             buzzer uit
     376      44   001AD                  ;
     377      45   001AD                  ; Seriële interface (via USB stekker!!)
     378      46   001AD                  ;      initsio              klaar zetten seriële poort 9600 baud
     379      47   001AD                  ;      siooutchar           afdrukken ascii code (accu=input)
     380      48   001AD                  ;      siooutbyte           afdrkken getal in accu
     381      49   001AD                  ;      siooutnib            afdrukken 4 laagste bits accu
     382      50   001AD                  ;      siooutmsga           afdrukken ascii string @dptr tot 000h code
     383      51   001AD                  ;      sioinchar            inlezen van 1 ascii code in de accu
     384      52   001AD                  ;      sioinbufa            inlezen van ascii buffer vanaf adres strtbuf, max 20h karakters!
     385      53   001AD                  ;
     386      54   001AD                  ; ADC
     387      55   001AD                  ;      initadc              klaar zetten ADC voor minimaal gebruik
     388      56   001AD                  ;      adclm335             uitlezen lm35 (a-b) bevat resultaat
     389      57   001AD                  ;      adcpotmeter          uitlezen van de potmeter (a-b) bevat resultaat
     390      58   001AD                  ;
     391      59   001AD                  ; Arithmetic:
     392      60   001AD                  ;      mul16                vermenigvuldigen 2 16 bit getallen
     393      61   001AD                  ;      mul32                vermenigvuldigen 2 32 bit getallen
     394      62   001AD                  ;      div16                delen 2 16 bit getallen
     395      63   001AD                  ;      div32                delen 2 32 bit getallen
     396      64   001AD                  ;      add16                optellen 2 16 bit getallen
     397      65   001AD                  ;      add32                optellen 2 32 bit getallen
     398      66   001AD                  ;      sub16                verschil 2 16 bit getallen
     399      67   001AD                  ;      sub32                verschil 2 32 bit getallen
     400      68   001AD                  ;      hexbcd8              omvormen 8 bit hex naar bcd
     401      69   001AD                  ;      hexbcd16             omvormen 16 bit hex naar bcd
     402      70   001AD                  ;      bcdhex8              omvormen 8 bit bcd naar hex
     403      71   001AD                  ;      bcdhex16             omvormen 16 bit bcd naar hex
     404      72   001AD                  ;
     405      73   001AD                  ; Diverse
     406      74   001AD                  ;      delaya0k05s          tijdsvertraging (waarde in accu)*0,05s
     407      75   001AD                  ;      delay1ms             tijdsverraging 1 milliseconde
     408      76   001AD                  ;      delay10us            tijdsvertraging 10 microseconde
     409      77   001AD                  ;      XCsw2xtal            overschakelen rc naar kristal (Pauwels Danny)
     410      78   001AD                  ;	mapregs 		selecteer de SFR's in de mapped area
     411      79   001AD                  ;	nomapregs            selecteer de SFR's in de non-mapped area
     412      80   001AD                  ;
     413      81   001AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     414      82   001AD                  ; LET OP!!!!
     415      83   001AD                  ; Voor je de routines gebruikt ga in de betreffende header na wat het registergebruik is,
     416      84   001AD                  ; hoe parameters doorgegeven worden, en wat de beperkingen zijn!!
     417      85   001AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     418      86   001AD                  ;
     419      87   001AD                  ; Geschreven door Roggemans M. (MGM) xcbpd0.inc   07/2010
     420      88   001AD                  ;
     421      89   001AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     422      90   001AD                  
     423      91   001AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     424      92   001AD                  ;
     425      93   001AD                  ; initdipswitch      is een subroutine die de pinnen van poort 4 insteld als input met
     426      94   001AD                  ; pull-up weerstanden ingeschakeld. Hierdoor kunnen schakelaars gebruikt worden naar
     427      95   001AD                  ; massa zonder extra weerstanden.
     428      96   001AD                  ;
     429      97   001AD                  ; Gebruikt geen registers
     430      98   001AD                  ;
     431      99   001AD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     432     100   001AD                  
     433     101   001AD C08F             initdipswitch:push   syscon0              ;juiste map selecteren
     434     102   001AF 758F04                         mov    syscon0,#004h
     435     103   001B2 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     436     104   001B4 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     437     105   001B7 75C8FF                         mov    p4_pudsel,#0ffh      ;selecteer pull_up device
     438     106   001BA 75C9FF                         mov    p4_puden,#0ffh       ;selectie inschakelen
     439     107   001BD 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     440     108   001C0 75C900                         mov    p4_dir,#000h         ;poort 4 als input schakelen
     441     109   001C3 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     442     110   001C5 D08F                           pop    syscon0              ;pagina terug herstellen
     443     111   001C7 22                             ret
     444     112   001C8                  
     445     113   001C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     446     114   001C8                  ;
     447     115   001C8                  ; initftoetsen       is een routine die de 4 functieschakelaars onder het LCD display
     448     116   001C8                  ; klaar zet voor gebruik met een schakelaar naar massa. De overige 4 pinnen van poort
     449     117   001C8                  ; 2 behouden hun originele instelling.
     450     118   001C8                  ;
     451     119   001C8                  ; Gebruikt geen registers
     452     120   001C8                  ;
     453     121   001C8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     454     122   001C8                  
     455     123   001C8 C08F             initftoetsen: push   syscon0              ;juiste map selecteren
     456     124   001CA 758F04                         mov    syscon0,#004h
     457     125   001CD C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     458     126   001CF 75B201                         mov    port_page,#001h      ;selecteer poort page 1
     459     127   001D2 43A00F                         orl    p2_pudsel,#00fh      ;selecteer pull_up device (onderste 4 pinnen)
     460     128   001D5 43A10F                         orl    p2_puden,#00fh       ;selectie inschakelen (onderste 4 pinnen)
     461     129   001D8 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     462     130   001DB 53A1F0                         anl    p2_dir,#0f0h         ;input drivers activeren (onderste 4 pinnen)
     463     131   001DE D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     464     132   001E0 D08F                           pop    syscon0              ;pagina terug herstellen
     465     133   001E2 22                             ret
     466     134   001E3                  
     467     135   001E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     468     136   001E3                  ;
     469     137   001E3                  ; initleds           is een routine die de poort 3 als output schakeld. De LED's
     470     138   001E3                  ; worden gedoofd (actief laag om ze te laden branden).
     471     139   001E3                  ;
     472     140   001E3                  ; Gebruikt geen registers
     473     141   001E3                  ;
     474     142   001E3                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     475     143   001E3                  
     476     144   001E3                  
     477     145   001E3 C08F             initleds:     push   syscon0              ;juiste map selecteren
     478     146   001E5 758F04                         mov    syscon0,#004h
     479     147   001E8 C0B2                           push   port_page            ;tijdelijk bewaren zodat we dat kunnen herstellen
     480     148   001EA 75B200                         mov    port_page,#000h      ;selecteer poort page 0
     481     149   001ED 75B1FF                         mov    p3_dir,#0ffh         ;poort 3 als output schakelen
     482     150   001F0 D0B2                           pop    port_page            ;herstellen in oorspronkelijke staat
     483     151   001F2 D08F                           pop    syscon0              ;pagina terug herstellen
     484     152   001F4 22                             ret
     485     153   001F5                  
     486     154   001F5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     487     155   001F5                  ;
     488     156   001F5                  ; initiic            is een subroutine die de pinnen p0.7 (sda) en p0.3 (scl) klaar zet
     489     157   001F5                  ; voor gebruik als IIC bus. De andere poortpinnen worden niet aangepast
     490     158   001F5                  ; scl wordt als oc output geschakeld met data waarde 1 (bus in rust)
     491     159   001F5                  ; sda wordt als input geschakeld
     492     160   001F5                  ;
     493     161   001F5                  ; LET OP!!
     494     162   001F5                  ; Dit is een IIC bus met beperkte mogelijkheden:
     495     163   001F5                  ; -vaste communicatiesnleheid van 100kbit/s
     496     164   001F5                  ; -enkel master mode
     497     165   001F5                  ; -enkel 7 bit adressering
     498     166   001F5                  ; -geen klok stretching
     499     167   001F5                  ;
     500     168   001F5                  ; Gebruikt geen registers
     501     169   001F5                  ;
     502     170   001F5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     503     171   001F5                  
     504     172   001F5                  sda           bit    p0_data.7            ;pin gebruikt als sda
     505     173   001F5                  scl           bit    p0_data.3            ;pin gebruikt als scl
     506     174   001F5                  sdaout        equ    10000000b            ;masker om sda als output te schakelen
     507     175   001F5                  sdain         equ    01111111b            ;masker om sda als input te schakelen
     508     176   001F5                  
     509     177   001F5 C08F             initiic:      push   syscon0              ;juiste map selecteren
     510     178   001F7 758F04                         mov    syscon0,#004h
     511     179   001FA C0B2                           push   port_page
     512     180   001FC 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
     513     181   001FF D287                           setb   sda                  ;data op 1 zetten (ruststand iic)
     514     182   00201 D283                           setb   scl                  ;klok op 1 zetten (ruststand iic)
     515     183   00203 75B203                         mov    port_page,#003h      ;p0_od toegankelijk maken
     516     184   00206 D283                           setb   scl                  ;klok werkt als od
     517     185   00208 D287                           setb   sda                  ;sda werkt als od
     518     186   0020A 75B200                         mov    port_page,#000h      ;terug pagina 0 selecteren
     519     187   0020D 438608                         orl    p0_dir,#00001000b    ;scl als output selecteren
     520     188   00210 53867F                         anl    p0_dir,#01111111b    ;sda als input selecteren
     521     189   00213 D0B2                           pop    port_page            ;pagina herstellen
     522     190   00215 D08F                           pop    syscon0              ;map herstellen
     523     191   00217 22                             ret
     524     192   00218                  
     525     193   00218                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     526     194   00218                  ;
     527     195   00218                  ; iicstart           is een subroutine die op de iic bus een start conditie opwekt.
     528     196   00218                  ; Bij de start conditie wordt eerst de scl laag gemaakt, dan de sda. Om de bittijd
     529     197   00218                  ; te garanderen volgt er een delay van 10us
     530     198   00218                  ;
     531     199   00218                  ; Gebruikt geen registers
     532     200   00218                  ;
     533     201   00218                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     534     202   00218                  
     535     203   00218 C08F             iicstart:     push   syscon0              ;map bewaren
     536     204   0021A 758F04                         mov    syscon0,#004h        ;hoofdmap selecteren
     537     205   0021D C0B2                           push   port_page            ;pagina bewaren
     538     206   0021F 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     539     207   00222 D283                           setb   scl                  ;zeker zijn dat we vanuit ruststand vertrekken
     540     208   00224 D287                           setb   sda                  ;idem
     541     209   00226 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     542     210   00229 120319                         lcall  delay10us            ;
     543     211   0022C C287                           clr    sda                  ;data laag
     544     212   0022E 120319                         lcall  delay10us
     545     213   00231 C283                           clr    scl                  ;dan klok laag
     546     214   00233 120319                         lcall  delay10us            ;bit lang genoeg maken
     547     215   00236 D0B2                           pop    port_page            ;registers herstellen
     548     216   00238 D08F                           pop    syscon0
     549     217   0023A 22                             ret
     550     218   0023B                  
     551     219   0023B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     552     220   0023B                  ;
     553     221   0023B                  ; iicstop            is een subroutine die een stop conditie op de IIC bus plaatst.
     554     222   0023B                  ;
     555     223   0023B                  ; Gebruikt geen registers
     556     224   0023B                  ;
     557     225   0023B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     558     226   0023B                  
     559     227   0023B C08F             iicstop:      push   syscon0              ;map bewaren
     560     228   0023D 758F04                         mov    syscon0,#004h        ;hoofd map selecteren
     561     229   00240 C0B2                           push   port_page            ;pagina bewaren
     562     230   00242 75B200                         mov    port_page,#000h      ;hier zit alles wat we nodig hebben
     563     231   00245 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     564     232   00248 C287                           clr    sda                  ;data naar omlaag
     565     233   0024A 120319                         lcall  delay10us
     566     234   0024D D283                           setb   scl                  ;klok naar 1
     567     235   0024F 120319                         lcall  delay10us            ;wachten
     568     236   00252 D287                           setb   sda                  ;idem data
     569     237   00254 120319                         lcall  delay10us            ;
     570     238   00257 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     571     239   0025A D0B2                           pop    port_page            ;registers herstellen
     572     240   0025C D08F                           pop    syscon0
     573     241   0025E 22                             ret
     574     242   0025F                  
     575     243   0025F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     576     244   0025F                  ;
     577     245   0025F                  ; iicoutbyte         is een subroutine die de data uit de accu naar buiten stuurt op
     578     246   0025F                  ; de iic bus. In totaal worden er 8 bits verzonden. Daarna wordt een negende klokpuls
     579     247   0025F                  ; gegenereerd om de ack bit in te lezen. Die wordt doorgegeven via de c vlag
     580     248   0025F                  ;
     581     249   0025F                  ; Gebruikt:
     582     250   0025F                  ;      a=inbut te verzenden byte (accu wordt niet vernietigd)
     583     251   0025F                  ;      cy=ack bit vanuit de slave
     584     252   0025F                  ;
     585     253   0025F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     586     254   0025F                  
     587     255   0025F C0E0             iicoutbyte:   push   acc                  ;straks alles herstellen
     588     256   00261 C0F0                           push   b                    ;gebruikt als loopcounter
     589     257   00263 C08F                           push   syscon0              ;map juist zetten
     590     258   00265 758F04                         mov    syscon0,#004h        ;hofdmap selecteren
     591     259   00268 C0B2                           push   port_page            ;poort pagina bewaren
     592     260   0026A 75B200                         mov    port_page,#000h      ;basispagina selecteren
     593     261   0026D 75F008                         mov    b,#008h              ;wordt gebruikt als loopcounter
     594     262   00270 438680                         orl    p0_dir,#sdaout       ;poortpin als output zetten
     595     263   00273 33               iicoutbyte1:  rlc    a                    ;hier gaan we dan (bit per bit naar buiten)
     596     264   00274 9287                           mov    sda,c                ;op pin
     597     265   00276 120319                         lcall  delay10us            ;wachten
     598     266   00279 D283                           setb   scl                  ;puls genereren
     599     267   0027B 120319                         lcall  delay10us            ;ook hier wat tijd laten
     600     268   0027E C283                           clr    scl                  ;klok terug laag maken
     601     269   00280 D5F0F0                         djnz   b,iicoutbyte1        ;herhaal 8 keer
     602     270   00283                  
     603     271   00283                  ; de 8 bits zijn weg, nu de ack binnen nemen.
     604     272   00283                  
     605     273   00283 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     606     274   00286 120319                         lcall  delay10us            ;wachten tot data zeker beschikbaar
     607     275   00289 D283                           setb   scl                  ;puls terug hoog
     608     276   0028B A287                           mov    c,sda                ;inlezen en naar carry
     609     277   0028D 120319                         lcall  delay10us
     610     278   00290 C283                           clr    scl                  ;klok blijft laag achter
     611     279   00292 D0B2                           pop    port_page
     612     280   00294 D08F                           pop    syscon0
     613     281   00296 D0F0                           pop    b
     614     282   00298 D0E0                           pop    acc
     615     283   0029A 22                             ret
     616     284   0029B                  
     617     285   0029B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     618     286   0029B                  ;
     619     287   0029B                  ; iicinbyteack       is een subroutine die 1 byte inleest en als negendebit een ack
     620     288   0029B                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     621     289   0029B                  ;
     622     290   0029B                  ; Gebruikt:
     623     291   0029B                  ;      -de accu als output
     624     292   0029B                  ;
     625     293   0029B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     626     294   0029B                  
     627     295   0029B C08F             iicinbyteack: push   syscon0              ;huidige map bewaren
     628     296   0029D 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     629     297   002A0 C0B2                           push   port_page            ;pagina bewaren
     630     298   002A2 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     631     299   002A5 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     632     300   002A7 C0D0                           push   psw                  ;vlaggen bewaren
     633     301   002A9 75F008                         mov    b,#008h              ;loopcounter laden
     634     302   002AC 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     635     303   002AF 120319           iicinbyteack1:lcall  delay10us
     636     304   002B2 D283                           setb   scl                  ;klok hoog
     637     305   002B4 A287                           mov    c,sda                ;pin inlezen
     638     306   002B6 33                             rlc    a                    ;in accu shiften
     639     307   002B7 120319                         lcall  delay10us
     640     308   002BA C283                           clr    scl                  ;klok terug laag
     641     309   002BC D5F0F0                         djnz   b,iicinbyteack1
     642     310   002BF 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     643     311   002C2 C287                           clr    sda                  ;ack genereren
     644     312   002C4 120319                         lcall  delay10us
     645     313   002C7 D283                           setb   scl
     646     314   002C9 120319                         lcall  delay10us
     647     315   002CC C283                           clr    scl
     648     316   002CE 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     649     317   002D1 D0D0                           pop    psw                  ;registers herstellen
     650     318   002D3 D0F0                           pop    b
     651     319   002D5 D0B2                           pop    port_page
     652     320   002D7 D08F                           pop    syscon0
     653     321   002D9 22                             ret
     654     322   002DA                  
     655     323   002DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     656     324   002DA                  ;
     657     325   002DA                  ; iicinbytenack      is een subroutine die 1 byte inleest en als negendebit een nack
     658     326   002DA                  ; naar de slave zal zenden. De accu wordt gebruikt om de ingelezen data door te geven.
     659     327   002DA                  ;
     660     328   002DA                  ; Gebruikt:
     661     329   002DA                  ;      -de accu als output
     662     330   002DA                  ;
     663     331   002DA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     664     332   002DA                  
     665     333   002DA C08F             iicinbytenack:push   syscon0              ;huidige map bewaren
     666     334   002DC 758F04                         mov    syscon0,#004h        ;basispagina kiezen
     667     335   002DF C0B2                           push   port_page            ;pagina bewaren
     668     336   002E1 75B200                         mov    port_page,#000h      ;deze hebben we nodig
     669     337   002E4 C0F0                           push   b                    ;wordt gebruikt als loopcounter
     670     338   002E6 C0D0                           push   psw                  ;vlaggen bewaren
     671     339   002E8 75F008                         mov    b,#008h              ;loopcounter laden
     672     340   002EB 53867F                         anl    p0_dir,#sdain        ;pin als input schakelen
     673     341   002EE 120319           iicinbytenack1:lcall  delay10us
     674     342   002F1 D283                           setb   scl                  ;klok hoog
     675     343   002F3 A287                           mov    c,sda                ;pin inlezen
     676     344   002F5 33                             rlc    a                    ;in accu shiften
     677     345   002F6 120319                         lcall  delay10us
     678     346   002F9 C283                           clr    scl                  ;klok terug laag
     679     347   002FB D5F0F0                         djnz   b,iicinbytenack1     ;8 keer herhalen
     680     348   002FE 438680                         orl    p0_dir,#sdaout       ;pin als output schakelen
     681     349   00301 D287                           setb   sda                  ;nack genereren
     682     350   00303 120319                         lcall  delay10us
     683     351   00306 D283                           setb   scl
     684     352   00308 120319                         lcall  delay10us
     685     353   0030B C283                           clr    scl
     686     354   0030D 53867F                         anl    p0_dir,#sdain        ;pin terug als input schakelen
     687     355   00310 D0D0                           pop    psw                  ;registers herstellen
     688     356   00312 D0F0                           pop    b
     689     357   00314 D0B2                           pop    port_page
     690     358   00316 D08F                           pop    syscon0
     691     359   00318 22                             ret
     692     360   00319                  
     693     361   00319                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     694     362   00319                  ;
     695     363   00319                  ; delay10us          is een tijdsvertraging van 10us. Wordt gebruikt om de IIC bus
     696     364   00319                  ; te vertragen tot een maximale snelheid van 100kbit/s In realiteit zal de bussnelheid
     697     365   00319                  ; lager liggen. We houden immers geen rekening met de uitvoeringstijd van de routines,
     698     366   00319                  ; en de gebruikte delay is dubbel zo lang als stikt nodig (5us volstaat).
     699     367   00319                  ;
     700     368   00319                  ; Gebruikt geen registers
     701     369   00319                  ;
     702     370   00319                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     703     371   00319                  
     704     372   00319 C0E0             delay10us:    push   acc                  ;8*42ns=330ns
     705     373   0031B C0D0                           push   psw                  ;8*42ns=330ns
     706     374   0031D 75E01A                         mov    acc,#01ah            ;420ns
     707     375   00320 D5E0FD                         djnz   acc,$                ;420ns*aantal keer doorlopen
     708     376   00323 D0D0                           pop    psw                  ;8*42ns=330ns
     709     377   00325 D0E0                           pop    acc                  ;8*42ns=330ns
     710     378   00327 22                             ret                         ;165ns
     711     379   00328                  
     712     380   00328                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     713     381   00328                  ;
     714     382   00328                  ; delaya0k05s        is een tijdsvertraging van 0,05s maal het getal in de accu
     715     383   00328                  ;
     716     384   00328                  ; Gebruikt geen registers
     717     385   00328                  ;
     718     386   00328                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     719     387   00328                  
     720     388   00328 C0E0             delaya0k05s:  push   acc                  ;registers bewaren
     721     389   0032A C0D0                           push   psw
     722     390   0032C C0F0                           push   b
     723     391   0032E 75F032           delaya0k05s2: mov    b,#050               ;loopcounter
     724     392   00331 120341           delaya0k05s1: lcall  delay1ms
     725     393   00334 D5F0FA                         djnz   b,delaya0k05s1
     726     394   00337 D5E0F4                         djnz   acc,delaya0k05s2
     727     395   0033A D0F0                           pop    b                    ;registers herstellen
     728     396   0033C D0D0                           pop    psw
     729     397   0033E D0E0                           pop    acc
     730     398   00340 22                             ret
     731     399   00341                  
     732     400   00341                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     733     401   00341                  ;
     734     402   00341                  ; Delay1ms           is een tijdsvertraging van 1 ms.
     735     403   00341                  ;
     736     404   00341                  ; Gebruikt geen registers
     737     405   00341                  ;
     738     406   00341                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     739     407   00341                  
     740     408   00341 C0E0             delay1ms:     push   acc                  ;8*42ns=330ns
     741     409   00343 C0D0                           push   psw                  ;8*42ns=330ns
     742     410   00345 75E064                         mov    acc,#100             ;420ns
     743     411   00348 120319           delay1ms1:    lcall  delay10us            ;10us
     744     412   0034B D5E0FA                         djnz   acc,delay1ms1        ;420ns*aantal keer doorlopen
     745     413   0034E D0D0                           pop    psw                  ;8*42ns=330ns
     746     414   00350 D0E0                           pop    acc                  ;8*42ns=330ns
     747     415   00352 22                             ret                         ;165ns
     748     416   00353                  
     749     417   00353                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     750     418   00353                  ;
     751     419   00353                  ; Dit is het LCD driver gedeelte. Het is gebaseerd op de LCD driver van MGM van 1994.
     752     420   00353                  ; De driver is aangepast voor het XC888 SBC en kan gebruikt worden met standaard
     753     421   00353                  ; alfanumerische display's. Het bord wordt gebruikt met een 2*20 of een 4*20 karakter
     754     422   00353                  ; display. De basisroutines zijn bruikbaar voor alle types schermen (de
     755     423   00353                  ; gebruiker moet dan wel zelf wakker liggen over cursorrouting).
     756     424   00353                  ; De hogere routines gaan er van uit dat we een 4*20 karakter display gebruiken.
     757     425   00353                  ; Parameters worden doorgegeven via de accu, b register, dptr of r0.
     758     426   00353                  ; De routines gebruiken geen registers. Alle timing is voorzien voor een XC888 op
     759     427   00353                  ; maximale snelheid. Loopt de controller trager, dan zullen de tijdsvertragingen te
     760     428   00353                  ; lang zijn. De driver zal automatisch de IIC interface initialiseren omdat die gebruikt
     761     429   00353                  ; wordt om de LCD te bereiken. Deze routines zijn NIET bruikbaar op andere hadware
     762     430   00353                  ; systemen!!!!
     763     431   00353                  ;
     764     432   00353                  ; GESCHREVEN OP 02/1994 DOOR MARC ROGGEMANS (MGM) als lcd.drv
     765     433   00353                  ;      -aangepast door Roggemans Marc (MGM) op 11/2004 voor ADuC800 kaart als
     766     434   00353                  ;       aduclcd0.inc
     767     435   00353                  ;      -aangepast door Roggemans Marc (MGM) op 11/11/2004
     768     436   00353                  ;       aduclcd1.inc
     769     437   00353                  ;      -aangepast door Roggemans Marc (MGM) op 07/2010 voor XC888 SBC met IIC bus
     770     438   00353                  ;
     771     439   00353                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     772     440   00353                  
     773     441   00353                  e             bit    b.1                  ;enable
     774     442   00353                  rs            bit    b.0                  ;register select
     775     443   00353                  backlight     bit    b.6                  ;bit waar backlight op zit
     776     444   00353                  buzzer        bit    b.7                  ;bit waar buzzer op zit
     777     445   00353                  
     778     446   00353                  lcdport       EQU    b                    ;b regsiter wordt gebruikt als dummy poort
     779     447   00353                  
     780     448   00353                  cleardisp     EQU    001H                 ;LEEG MAKEN VAN HET SCHERM
     781     449   00353                  cursathom     EQU    002H                 ;CURSOR OP DE EERSTE PLAATS ZETTEN
     782     450   00353                  
     783     451   00353                  entrymode     EQU    00000110B            ;CURSOR NAAR RECHTS, SCHERM VAST
     784     452   00353                  displayon     EQU    00000001B            ;HOMEN EN CLEAR CURSOR
     785     453   00353                  displayof     EQU    00001000B            ;DISPLAY OFF, CURSOR OFF
     786     454   00353                  cursoroff     EQU    00001100B            ;DISPLAY ON ZONDER CURSOR
     787     455   00353                  cursoronb     EQU    00001111B            ;CURSOR ON AND BLINK
     788     456   00353                  cursoronn     EQU    00001110B            ;CURSOR ON NO BLINK
     789     457   00353                  functions     EQU    00101000B            ;INTERFACE LENGTE EN KARAKTER FONT
     790     458   00353                  cgram         EQU    01000000B            ;SELECTIE KARAKTER GENERATOR RAM
     791     459   00353                  ddram         EQU    10000000B            ;SELECTIE DATA DISPLAY RAM
     792     460   00353                  
     793     461   00353                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     794     462   00353                  ;
     795     463   00353                  ; initlcd     zal het scherm resetten en initialiseren voor gebruik via een 4
     796     464   00353                  ; bit bus. De routine zet het scherm klaar voor normaal gebruik: ingave van
     797     465   00353                  ; links naar rechts zonder display shift, normale karakterfont. De kursor staat
     798     466   00353                  ; aan als een knipperend lijntje onderaan de regel. Het scherm is leeg.
     799     467   00353                  ;
     800     468   00353                  ; registergebruik: geen
     801     469   00353                  ;
     802     470   00353                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     803     471   00353                  
     804     472   00353 C0E0             initlcd:      push   acc                  ;registers op stack plaatsen
     805     473   00355 C0D0                           push   psw
     806     474   00357 C0F0                           push   b                    ;wordt gebruikt als dummy lcd poort
     807     475   00359 1201F5                         lcall  initiic              ;vermits de LCD gebruikt wordt via een IIC bus
     808     476   0035C 75F0FD                         mov    lcdport,#11111101b   ;poort in uitgangstoestand zetten
     809     477   0035F                                                            ;buzzer en baklight worden nu op 1 gezet
     810     478   0035F 1204F7                         lcall  porttolcd            ;routine die de data uit b naar het scherm stuurt
     811     479   00362 7410                           mov    a,#010h       ;bij opstarten meer dan 30ms wachten
     812     480   00364 1204F0           initlcd1:     lcall  delay2ms
     813     481   00367 D5E0FA                         djnz   acc,initlcd1
     814     482   0036A 7430                           mov    a,#00110000b  ;volgende drie schrijfbeurten zijn
     815     483   0036C 1204AF                         lcall  outhnibc      ;een truuk om het display altijd opgestart
     816     484   0036F 1204F0                         lcall  delay2ms      ;te krijgen.
     817     485   00372 7430                           mov    a,#00110000b
     818     486   00374 1204AF                         lcall  outhnibc
     819     487   00377 1204F0                         lcall  delay2ms
     820     488   0037A 7430                           mov    a,#00110000b
     821     489   0037C 1204AF                         lcall  outhnibc
     822     490   0037F 1204F0                         lcall  delay2ms
     823     491   00382 7420                           mov    a,#00100000b  ;instellen 4 bit interface gebruiken
     824     492   00384 1204AF                         lcall  outhnibc      ;hoge nibble naar het controleregister
     825     493   00387 1204F0                         lcall  delay2ms      ;niet nodig volgens datasheet
     826     494   0038A 7428                           mov    a,#functions  ;4 bit interface, twee lijnen 5*8 dots
     827     495   0038C 120499                         lcall  outc          ;naar display
     828     496   0038F 1204F0                         lcall  delay2ms      ;is iets te lang volgens datasheet
     829     497   00392 740F                           mov    a,#cursoronb  ;display on cursor on and blink
     830     498   00394 120499                         lcall  outc
     831     499   00397 1204F0                         lcall  delay2ms      ;ook deze delay is iets te lang
     832     500   0039A 7401                           mov    a,#displayon  ;clear display and home cursor
     833     501   0039C 120499                         lcall  outc
     834     502   0039F 1204F0                         lcall  delay2ms      ;deze wachttijd is bijna juist
     835     503   003A2 7406                           mov    a,#entrymode  ;display klaar zetten normaal gebruik
     836     504   003A4 120499                         lcall  outc
     837     505   003A7 1204F0                         lcall  delay2ms      ;wachten weer veel te lang
     838     506   003AA D0F0                           pop    b             ;registers terug in orde zetten
     839     507   003AC D0D0                           pop    psw
     840     508   003AE D0E0                           pop    acc
     841     509   003B0 22                             ret                  ;einde van de initialisatie
     842     510   003B1                  
     843     511   003B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     844     512   003B1                  ;
     845     513   003B1                  ; lcdoutchar  zal de ascii code in de accu naar het lcd scherm sturen. De codes
     846     514   003B1                  ; lager dan 020h worden als controlekarakters bekeken met volgende acties:
     847     515   003B1                  ;      00dh   =cursor in de home positie
     848     516   003B1                  ;      00ch   =form feed    =scherm leeg maken en cursor op lacatie 000h
     849     517   003B1                  ;      00ah   =cursor op tweede lijn plaatsen
     850     518   003B1                  ;      001h   =cursor on blink
     851     519   003B1                  ;      002h   =cursor on, no blink
     852     520   003B1                  ;      003h   =cursor off
     853     521   003B1                  ;      080h-0ffh     =cursor plaatsen op dit adres -80h
     854     522   003B1                  ;
     855     523   003B1                  ; de routine gebruikt geen registers
     856     524   003B1                  ;
     857     525   003B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     858     526   003B1                  
     859     527   003B1                  ; we gaan eerst na of het een ascii code betreft van een symbool. Als dat zo is,
     860     528   003B1                  ; dan mag de data direct naar het dataregister van het scherm.
     861     529   003B1                  ; Betreft een controle karakter, dan is een andere aanpak nodig (zie verder).
     862     530   003B1                  
     863     531   003B1                  lcdoutchar:
     864     532   003B1 C0E0             outcharlcd:   push   acc           ;registers op stack
     865     533   003B3 C0D0                           push   psw
     866     534   003B5 B48000                         cjne   a,#080h,outcharlcd1  ;hogere codes zijn adressen
     867     535   003B8 5046             outcharlcd1:  jnc    outcharlcd9   ;als geen carry dan is de code een address
     868     536   003BA B42000                         cjne   a,#020h,outcharlcd2  ;hogere codes zijn ascii van symbolen
     869     537   003BD 503C             outcharlcd2:  jnc    outcharlcd8   ;als geen carry dan ascii code naar display
     870     538   003BF                  
     871     539   003BF                  ; de code in de accu is geen adres of geen geldige ascii code van een symbool.
     872     540   003BF                  ; Het is dus een opdracht die we moeten uitvoeren.
     873     541   003BF                  
     874     542   003BF B40C07                         cjne   a,#00ch,outcharlcd3  ;geen form feed, dan jump
     875     543   003C2 7401                           mov    a,#cleardisp         ;scherm leegmaken
     876     544   003C4 120499                         lcall  outc                 ;naar controleregister
     877     545   003C7 803A                           sjmp   outcharlcde          ;afsluiten
     878     546   003C9                  
     879     547   003C9 B40107           outcharlcd3:  cjne   a,#001h,outcharlcd4  ;geen cursor on blink
     880     548   003CC 740F                           mov    a,#cursoronb         ;cursoron met blink
     881     549   003CE 120499                         lcall  outc
     882     550   003D1 8030                           sjmp   outcharlcde
     883     551   003D3                  
     884     552   003D3 B40207           outcharlcd4:  cjne   a,#002h,outcharlcd5  ;geen cursor on no blink
     885     553   003D6 740E                           mov    a,#cursoronn         ;cursoron no blink
     886     554   003D8 120499                         lcall  outc
     887     555   003DB 8026                           sjmp   outcharlcde
     888     556   003DD                  
     889     557   003DD B40307           outcharlcd5:  cjne   a,#003h,outcharlcd6  ;geen cursor off, dus afsluiten routine
     890     558   003E0 740C                           mov    a,#cursoroff         ;cursor uitschakelen
     891     559   003E2 120499                         lcall  outc
     892     560   003E5 801C                           sjmp   outcharlcde
     893     561   003E7                  
     894     562   003E7 B40D07           outcharlcd6:  cjne   a,#00dh,outcharlcd7  ;geen cursor home zonder clear scherm
     895     563   003EA 7402                           mov    a,#cursathom         ;cursor in home positie
     896     564   003EC 120499                         lcall  outc
     897     565   003EF 8012                           sjmp   outcharlcde
     898     566   003F1                  
     899     567   003F1 B40A0F           outcharlcd7:  cjne   a,#00ah,outcharlcde  ;line feed gevraagd (zet cursor op
     900     568   003F4                                                            ;tweede lijn
     901     569   003F4 74C0                           mov    a,#0c0h
     902     570   003F6 120499                         lcall  outc
     903     571   003F9 8008                           sjmp   outcharlcde
     904     572   003FB                  
     905     573   003FB                  ; dit label wordt uitgevoerd als de code in de accumulator een geldige ascii code
     906     574   003FB                  ; is. dit mag naar het data register.
     907     575   003FB                  
     908     576   003FB 12045F           outcharlcd8:  lcall  outd          ;klaar
     909     577   003FE 8003                           sjmp   outcharlcde   ;einde routine
     910     578   00400                  
     911     579   00400                  ; dit label wordt uitgevoerd als de code in de accu een adres is. Dit adres is
     912     580   00400                  ; eigenlijk 80 te groot. Dat komt echter goed uit als commando om een adrers te
     913     581   00400                  ; te schrijven.
     914     582   00400                  
     915     583   00400 120499           outcharlcd9:  lcall  outc          ;klaar
     916     584   00403 D0D0             outcharlcde:  pop    psw           ;registers herstellen
     917     585   00405 D0E0                           pop    acc
     918     586   00407 22                             ret
     919     587   00408                  
     920     588   00408                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     921     589   00408                  ;
     922     590   00408                  ; outniblcd     zal de lage nibble omzetten in een ascii code en die afdrukken
     923     591   00408                  ; op het lcd scherm.
     924     592   00408                  ;
     925     593   00408                  ; de routine gebruikt geen registers
     926     594   00408                  ;
     927     595   00408                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     928     596   00408                  
     929     597   00408                  lcdoutnib:
     930     598   00408 C0E0             outniblcd:    push   acc           ;registers op stack zetten
     931     599   0040A C0D0                           push   psw
     932     600   0040C 540F                           anl    a,#00fh       ;laagste 4 bits overhouden
     933     601   0040E 2430                           add    a,#030h       ;omvormen naar ascii codes 0-9
     934     602   00410 B43A00                         cjne   a,#03ah,outniblcd1   ;als groter dan dit nog 7 bijtellen
     935     603   00413 4002             outniblcd1:   jc     outniblcde    ;als carry dan omzetting klaar
     936     604   00415 2407                           add    a,#007h       ;omvormen naar hoofdletter
     937     605   00417 12045F           outniblcde:   lcall  outd          ;naar het scherm
     938     606   0041A D0D0                           pop    psw
     939     607   0041C D0E0                           pop    acc
     940     608   0041E 22                             ret
     941     609   0041F                  
     942     610   0041F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     943     611   0041F                  ;
     944     612   0041F                  ; lcdoutbyte    zal de inhoud van de accu afdrukken op het lcd scherm.
     945     613   0041F                  ;
     946     614   0041F                  ; de routine gebruikt geen registers
     947     615   0041F                  ;
     948     616   0041F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     949     617   0041F                  
     950     618   0041F                  lcdoutbyte:
     951     619   0041F C0E0             outbytelcd:   push   acc           ;registers op de stack zetten
     952     620   00421 C0D0                           push   psw
     953     621   00423 C4                             swap   a             ;bitjes omruilen
     954     622   00424 120408                         lcall  outniblcd
     955     623   00427 C4                             swap   a             ;nog eens
     956     624   00428 120408                         lcall  outniblcd
     957     625   0042B D0D0                           pop    psw
     958     626   0042D D0E0                           pop    acc
     959     627   0042F 22                             ret
     960     628   00430                  
     961     629   00430                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     962     630   00430                  ;
     963     631   00430                  ; lcddispdptr   zal de inhoud van de dptr afdrukken op het lcd scherm
     964     632   00430                  ;
     965     633   00430                  ; de routine gebruikt geen registers
     966     634   00430                  ;
     967     635   00430                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     968     636   00430                  
     969     637   00430                  lcddispdptr:
     970     638   00430 C0E0             dispdptrlcd:  push   acc           ;registers bewaren op stack
     971     639   00432 C0D0                           push   psw
     972     640   00434 E583                           mov    a,dph         ;hoge deel eerst naar het scherm
     973     641   00436 12041F                         lcall  outbytelcd
     974     642   00439 E582                           mov    a,dpl         ;dan het lage deel
     975     643   0043B 12041F                         lcall  outbytelcd
     976     644   0043E D0D0                           pop    psw
     977     645   00440 D0E0                           pop    acc
     978     646   00442 22                             ret
     979     647   00443                  
     980     648   00443                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     981     649   00443                  ;
     982     650   00443                  ; lcdoutmsga  zal een string ascii codes op het scherm plaatsen. Het startadres
     983     651   00443                  ; van de string staat in de dptr. De string wordt afgesloten met een 000h.
     984     652   00443                  ; De routine gebruikt outcharlcd voor het sturen van karakters naar het LCD
     985     653   00443                  ; scherm. Positionnering van de cursor en cursorcontrole kan in de ascii string
     986     654   00443                  ; opgenomen worden met de pseudo ascii codes (zie outcharlcd).
     987     655   00443                  ;
     988     656   00443                  ; de routine gebruikt geen registers
     989     657   00443                  ;
     990     658   00443                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     991     659   00443                  
     992     660   00443                  lcdoutmsga:
     993     661   00443 C0E0             outmsgalcd:   push   acc           ;registers op de stack
     994     662   00445 C0D0                           push   psw
     995     663   00447 C083                           push   dph           ;ook de data pointer
     996     664   00449 C082                           push   dpl
     997     665   0044B                  
     998     666   0044B                  ;We lezen karakters uit code memory tot de 000h code gevonden wordt.
     999     667   0044B                  
    1000     668   0044B E4               outmsgalcd1:  clr    a             ;waarde zit in onze weg
    1001     669   0044C 93                             movc   a,@a+dptr     ;waarde lezen
    1002     670   0044D 6007                           jz     outmsgalcde   ;als 0 dan naar einde springen
    1003     671   0044F                  
    1004     672   0044F                  ; de code is niet 0 dus versturen met outchar
    1005     673   0044F                  
    1006     674   0044F 1203B1                         lcall  outcharlcd    ;weg er mee
    1007     675   00452 A3                             inc    dptr          ;naar volgende ascii code wijzen
    1008     676   00453 02044B                         ljmp   outmsgalcd1   ;lus sluiten
    1009     677   00456                  
    1010     678   00456 D082             outmsgalcde:  pop    dpl           ;registers herstellen
    1011     679   00458 D083                           pop    dph
    1012     680   0045A D0D0                           pop    psw
    1013     681   0045C D0E0                           pop    acc
    1014     682   0045E 22                             ret
    1015     683   0045F                  
    1016     684   0045F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1017     685   0045F                  ;
    1018     686   0045F                  ; outd is een routine die naar het data register van het display een
    1019     687   0045F                  ; volledige byte stuurt.
    1020     688   0045F                  ;
    1021     689   0045F                  ; De routine gebruikt geen registers.
    1022     690   0045F                  ;
    1023     691   0045F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1024     692   0045F                  
    1025     693   0045F C0E0             outd:         push   acc           ;registers op stack zetten
    1026     694   00461 C0D0                           push   psw
    1027     695   00463 12046F                         lcall  outhnibd      ;hoogste vier bits verzenden
    1028     696   00466 C4                             swap   a             ;bitjes omruilen
    1029     697   00467 12046F                         lcall  outhnibd      ;naar het scherm sturen
    1030     698   0046A D0D0                           pop    psw           ;registers terug herstellen
    1031     699   0046C D0E0                           pop    acc
    1032     700   0046E 22                             ret
    1033     701   0046F                  
    1034     702   0046F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1035     703   0046F                  ;
    1036     704   0046F                  ; outhnibd stuurt de hoge 4 bits van de accu naar het data register van het
    1037     705   0046F                  ; lcd scherm.
    1038     706   0046F                  ;
    1039     707   0046F                  ; de routine gebruikt geen registers.
    1040     708   0046F                  ;
    1041     709   0046F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1042     710   0046F                  
    1043     711   0046F C0E0             outhnibd:     push   acc           ;registers op stack plaatsen
    1044     712   00471 C0D0                           push   psw
    1045     713   00473 C0F0                           push   b             ;werkregister
    1046     714   00475 120510                         lcall  lcdtoport     ;lees de expander naar b register
    1047     715   00478 D2F0                           setb   rs            ;controle lijn in orde
    1048     716   0047A C2F1                           clr    e             ;deselectie display
    1049     717   0047C 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1050     718   0047E 03                             rr     a             ;bits op juiste plaats zetten
    1051     719   0047F 03                             rr     a             ;voor b reg
    1052     720   00480 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1053     721   00483 42F0                           orl    b,a           ;bij elkaar voegen
    1054     722   00485 1204F7                         lcall  porttolcd     ;naar expnder
    1055     723   00488 D2F1                           setb   e             ;display enabelen
    1056     724   0048A 1204F7                         lcall  porttolcd
    1057     725   0048D C2F1                           clr    e             ;display deselecteren
    1058     726   0048F 1204F7                         lcall  porttolcd
    1059     727   00492 D0F0                           pop    b
    1060     728   00494 D0D0                           pop    psw           ;registers herstellen
    1061     729   00496 D0E0                           pop    acc
    1062     730   00498 22                             ret
    1063     731   00499                  
    1064     732   00499                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1065     733   00499                  ;
    1066     734   00499                  ; outc is een routine die naar het controleregister van het display een
    1067     735   00499                  ; volledige byte stuurt.
    1068     736   00499                  ;
    1069     737   00499                  ; De routine gebruikt geen registers.
    1070     738   00499                  ;
    1071     739   00499                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1072     740   00499                  
    1073     741   00499 C0E0             outc:         push   acc           ;registers op stack zetten
    1074     742   0049B C0D0                           push   psw
    1075     743   0049D 1204AF                         lcall  outhnibc      ;hoogste vier bits verzenden
    1076     744   004A0 1204F0                         lcall  delay2ms      ;niet echt nodig
    1077     745   004A3 C4                             swap   a             ;bitjes omruilen
    1078     746   004A4 1204AF                         lcall  outhnibc      ;naar het scherm sturen
    1079     747   004A7 1204F0                         lcall  delay2ms      ;altijd goed voor traagste commando
    1080     748   004AA D0D0                           pop    psw           ;registers terug herstellen
    1081     749   004AC D0E0                           pop    acc
    1082     750   004AE 22                             ret
    1083     751   004AF                  
    1084     752   004AF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1085     753   004AF                  ;
    1086     754   004AF                  ; outhnibc stuurt de hoge 4 bits van de accu naar het controle register van het
    1087     755   004AF                  ; lcd scherm.
    1088     756   004AF                  ;
    1089     757   004AF                  ; de routine gebruikt geen registers.
    1090     758   004AF                  ;
    1091     759   004AF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1092     760   004AF                  
    1093     761   004AF C0E0             outhnibc:     push   acc           ;registers op stack plaatsen
    1094     762   004B1 C0D0                           push   psw
    1095     763   004B3 C0F0                           push   b             ;werkregister
    1096     764   004B5 120510                         lcall  lcdtoport     ;lees de expander naar b register
    1097     765   004B8 C2F0                           clr    rs            ;controle lijn in orde
    1098     766   004BA C2F1                           clr    e             ;deselectie display
    1099     767   004BC 54F0                           anl    a,#0f0h       ;hoogste 4 bits afzonderen
    1100     768   004BE 03                             rr     a             ;bits op juiste plaats zetten
    1101     769   004BF 03                             rr     a             ;voor b reg
    1102     770   004C0 53F0C3                         anl    b,#11000011b  ;bits laag maken, worden vervangen door data in a
    1103     771   004C3 42F0                           orl    b,a           ;bij elkaar voegen
    1104     772   004C5 1204F7                         lcall  porttolcd     ;naar expnder
    1105     773   004C8 D2F1                           setb   e             ;display enabelen
    1106     774   004CA 1204F7                         lcall  porttolcd
    1107     775   004CD C2F1                           clr    e             ;display deselecteren
    1108     776   004CF 1204F7                         lcall  porttolcd
    1109     777   004D2 D0F0                           pop    b
    1110     778   004D4 D0D0                           pop    psw           ;registers herstellen
    1111     779   004D6 D0E0                           pop    acc
    1112     780   004D8 22                             ret
    1113     781   004D9                  
    1114     782   004D9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1115     783   004D9                  ;
    1116     784   004D9                  ; BUILD0 IS EEN ROUTINE DIE DE KARAKTERGENERATOR RAM ZAL LADEN MET HET
    1117     785   004D9                  ; BITPATROON VOOR 8 KARAKTERS. DE ROUTINE GEBRUIKT EEN BITMAP OP HET ADRES
    1118     786   004D9                  ; IN DPTR. DE TABEL WORDT AFGESLOTEN DOOR EEN BYTE MET BIT 7=1. DE ROUTINE
    1119     787   004D9                  ; GEBRUIKT DPTR, ACC, PSW EN ENKELE LCD.DRV ROUTINES. NA HET VULLEN VAN DE
    1120     788   004D9                  ; DATA RAM WORDT OPNIEUW ADRES 0 VAN DE DISPLAY RAM GESELECTEERD. ER WORDT GEEN
    1121     789   004D9                  ; DATA GESCHREVEN.
    1122     790   004D9                  ;
    1123     791   004D9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1124     792   004D9                  
    1125     793   004D9 7440             BUILD:        MOV    A,#CGRAM      ;TOEGANG TOT KARAKTER GENERATOR RAM
    1126     794   004DB 120499           BUILD1:       LCALL  OUTC          ;NAAR SCHERM VERSTUREN
    1127     795   004DE 7400             BUILD3:       MOV    A,#000H       ;ACCU OP NUL ZETTEN
    1128     796   004E0 93                             MOVC   A,@A+DPTR     ;EERSTE CODE UIT TABEL LEZEN
    1129     797   004E1 12045F                         LCALL  OUTD          ;NAAR KARAKTER GENERATOR RAM STUREN
    1130     798   004E4 20E703                         JB     ACC.7,BUILD2  ;ALS BIT 1 DAN EINDE
    1131     799   004E7 A3                             INC    DPTR          ;NAAR VOLGENDE LOKATIE WIJZEN
    1132     800   004E8 80F4                           SJMP   BUILD3
    1133     801   004EA 7480             BUILD2:       MOV    A,#DDRAM      ;DATA DISPLAY RAM SELECTEREN
    1134     802   004EC 120499                         LCALL  OUTC          ;NAAR KONTROLE REGISTER STUREN
    1135     803   004EF 22                             RET                  ;EINDE VAN DE ROUTINE
    1136     804   004F0                  
    1137     805   004F0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1138     806   004F0                  ;
    1139     807   004F0                  ; Delay2ms is een vertragingsroutine van 2ms.
    1140     808   004F0                  ;
    1141     809   004F0                  ; De routine gebruikt geen registers.
    1142     810   004F0                  ;
    1143     811   004F0                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1144     812   004F0                  
    1145     813   004F0 120341           delay2ms:     lcall  delay1ms
    1146     814   004F3 120341                         lcall  delay1ms
    1147     815   004F6 22                             ret
    1148     816   004F7                  
    1149     817   004F7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1150     818   004F7                  ;
    1151     819   004F7                  ; porttolcd          is een subroutine die de inhoud van het b register naar het lcd
    1152     820   004F7                  ; scherm stuurt via de port expander.
    1153     821   004F7                  ;
    1154     822   004F7                  ; Gebruikt geen registers
    1155     823   004F7                  ;
    1156     824   004F7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1157     825   004F7                  
    1158     826   004F7 C0E0             porttolcd:    push   acc           ;geen registers gebruiken
    1159     827   004F9 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1160     828   004FB 120218                         lcall  iicstart      ;vertrokken
    1161     829   004FE 7440                           mov    a,#01000000b  ;schrijven naar expander
    1162     830   00500 12025F                         lcall  iicoutbyte    ;weg er mee
    1163     831   00503 E5F0                           mov    a,b           ;data verzenden
    1164     832   00505 12025F                         lcall  iicoutbyte
    1165     833   00508 12023B                         lcall  iicstop       ;transactie sluiten
    1166     834   0050B D0D0                           pop    psw
    1167     835   0050D D0E0                           pop    acc
    1168     836   0050F 22                             ret
    1169     837   00510                  
    1170     838   00510                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1171     839   00510                  ;
    1172     840   00510                  ; lcdtoport          is een subroutine die de waarde van de expander uitleest naar
    1173     841   00510                  ; het b regiser. Op die manier kunnen we de expander laten onthouden wat de waarde
    1174     842   00510                  ; van buzzet en backlight is.
    1175     843   00510                  ;
    1176     844   00510                  ; Gebruikt b register
    1177     845   00510                  ;
    1178     846   00510                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1179     847   00510                  
    1180     848   00510 C0E0             lcdtoport:    push   acc           ;geen registers gebruiken
    1181     849   00512 C0D0                           push   psw           ;trekken ons niks aan van ack bit
    1182     850   00514 120218                         lcall  iicstart      ;vertrokken
    1183     851   00517 7441                           mov    a,#01000001b  ;lezen van expander
    1184     852   00519 12025F                         lcall  iicoutbyte    ;weg er mee
    1185     853   0051C 1202DA                         lcall  iicinbytenack ;data inlezen
    1186     854   0051F 12023B                         lcall  iicstop
    1187     855   00522 F5F0                           mov    b,a
    1188     856   00524 D0D0                           pop    psw
    1189     857   00526 D0E0                           pop    acc
    1190     858   00528 22                             ret
    1191     859   00529                  
    1192     860   00529                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1193     861   00529                  ;
    1194     862   00529                  ; lcdlighton         is een subroutine die de backlight inschakeld
    1195     863   00529                  ;
    1196     864   00529                  ; Gebruikt geen registers
    1197     865   00529                  ;
    1198     866   00529                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1199     867   00529                  
    1200     868   00529 C0F0             lcdlighton:   push   b
    1201     869   0052B 120510                         lcall  lcdtoport     ;expander lezen
    1202     870   0052E C2F6                           clr    b.6           ;licht aan doen
    1203     871   00530 1204F7                         lcall  porttolcd     ;expander scrijven
    1204     872   00533 D0F0                           pop    b
    1205     873   00535 22                             ret
    1206     874   00536                  
    1207     875   00536                  
    1208     876   00536                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1209     877   00536                  ;
    1210     878   00536                  ; lcdlightoff        is een subroutine die de backlight uitschakeld
    1211     879   00536                  ;
    1212     880   00536                  ; Gebruikt geen registers
    1213     881   00536                  ;
    1214     882   00536                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1215     883   00536                  
    1216     884   00536 C0F0             lcdlightoff:  push   b
    1217     885   00538 120510                         lcall  lcdtoport     ;expander lezen
    1218     886   0053B D2F6                           setb   b.6           ;licht uit doen
    1219     887   0053D 1204F7                         lcall  porttolcd     ;expander scrijven
    1220     888   00540 D0F0                           pop    b
    1221     889   00542 22                             ret
    1222     890   00543                  
    1223     891   00543                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1224     892   00543                  ;
    1225     893   00543                  ; lcdbuzon           is een subroutine die de buzzer inschakeld
    1226     894   00543                  ;
    1227     895   00543                  ; Gebruikt geen registers
    1228     896   00543                  ;
    1229     897   00543                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1230     898   00543                  
    1231     899   00543 C0F0             lcdbuzon:     push   b
    1232     900   00545 120510                         lcall  lcdtoport     ;expander lezen
    1233     901   00548 C2F7                           clr    b.7           ;buzzer aan doen
    1234     902   0054A 1204F7                         lcall  porttolcd     ;expander scrijven
    1235     903   0054D D0F0                           pop    b
    1236     904   0054F 22                             ret
    1237     905   00550                  
    1238     906   00550                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1239     907   00550                  ;
    1240     908   00550                  ; lcdbuzoff          is een subroutine die de buzzer uitschakeld
    1241     909   00550                  ;
    1242     910   00550                  ; Gebruikt geen registers
    1243     911   00550                  ;
    1244     912   00550                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1245     913   00550                  
    1246     914   00550 C0F0             lcdbuzoff:    push   b
    1247     915   00552 120510                         lcall  lcdtoport     ;expander lezen
    1248     916   00555 D2F7                           setb   b.7           ;buzzer aan doen
    1249     917   00557 1204F7                         lcall  porttolcd     ;expander scrijven
    1250     918   0055A D0F0                           pop    b
    1251     919   0055C 22                             ret
    1252     920   0055D                  
    1253     921   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1254     922   0055D                  ;
    1255     923   0055D                  ; Dit deel van de driver laat toe de USB verbinding met de PC te gebruiken als
    1256     924   0055D                  ; een standaard com poort op 9600 baud.
    1257     925   0055D                  ; De file laat toe om de seriele poort te gebruiken en biedt de standaard
    1258     926   0055D                  ; monitorroutines zoals die beschikbaar zijn in de MGM monitors voor 8051.
    1259     927   0055D                  ; De belangrijkste afwijking van de standaard routines is de initsio subroutine.
    1260     928   0055D                  ; Die laat toe om 9600 baud in te stellen. Dit zal enkel kunnen met het xtal
    1261     929   0055D                  ; ingeschakeld en met de CPU klok 24 Mhz. Het inschakelen van het XTAL gebeurt
    1262     930   0055D                  ; NIET door deze routine.
    1263     931   0055D                  ;
    1264     932   0055D                  ; Geschreven door Roggemans Marc (MGM) op 07/2010 v0
    1265     933   0055D                  ;
    1266     934   0055D                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1267     935   0055D                  
    1268     936   0055D                  blank         equ    020h          ;ascii code voor een blank
    1269     937   0055D                  xoff          equ    013h          ;ascii code xoff caracter (ctrl s)
    1270     938   0055D                  ff            equ    00ch          ;ascii code voor nieuw blad
    1271     939   0055D                  cr            equ    00dh          ;ascii code voor een wagenterugloop
    1272     940   0055D                  lf            equ    00ah          ;ascii code voor volgende lijn
    1273     941   0055D                  backsp        equ    008h          ;ascii code voor het bs karakter
    1274     942   0055D                  beep          equ    007h          ;ascii code voor een beep
    1275     943   0055D                  
    1276     944   0055D 08200800         wissen:       db     backsp,blank,backsp,000h    ;string wissen karakter
    1277     945   00561                                                                          ;van het scherm
    1278     946   00561                  
    1279     947   00561                  strtbuf       equ     054h         ;start adres van de buffer
    1280     948   00561                  endbuf        equ     07fh         ;laatst gebruikte locatie (kan cr bevatten)
    1281     949   00561                  
    1282     950   00561                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1283     951   00561                  ;
    1284     952   00561                  ; initsio zal de seriele poort klaar zetten voor gebruik. De baudrate is 9600.
    1285     953   00561                  ;
    1286     954   00561                  ; Gebruikt geen registers
    1287     955   00561                  ;
    1288     956   00561                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1289     957   00561                  
    1290     958   00561 C0E0             initsio:      push   acc                  ;registers op de stack zetten
    1291     959   00563 C08F                           push   syscon0              ;map bewaren
    1292     960   00565 758F04                         mov    syscon0,#004h        ;hier zit al wat we nodig hebben
    1293     961   00568 C0B2                           push   port_page            ;pagina op stack zetten
    1294     962   0056A C0BF                           push   scu_page
    1295     963   0056C 75BF00                         mov    scu_page,#000h       ;pagina 0 system control regs
    1296     964   0056F                  ; eerst gaan we de pinnen van poort 1 juist zetten:
    1297     965   0056F                  ;      -p1.0 als input en alt1 selectie
    1298     966   0056F                  ;      -p1.1 als output en alt2 selectie
    1299     967   0056F                  
    1300     968   0056F 75B202                         mov    port_page,#002h      ;pagina 2 selecteren
    1301     969   00572 5390FD                         anl    p1_altsel0,#11111101b
    1302     970   00575 439001                         orl    p1_altsel0,#00000001b
    1303     971   00578 5391FE                         anl    p1_altsel1,#11111110b
    1304     972   0057B 439102                         orl    p1_altsel1,#00000010b
    1305     973   0057E 75B200                         mov    port_page,#000h      ;pagina 0 selecteren
    1306     974   00581 5391FE                         anl    p1_dir,#11111110b    ;p1.0=input
    1307     975   00584 439102                         orl    p1_dir,#00000010b    ;p1.1=output
    1308     976   00587                  
    1309     977   00587                  ; Nu moet de baud rate generator ingesteld worden
    1310     978   00587                  ; We gaan er van uit dat de systeemklok 24MHz is
    1311     979   00587                  
    1312     980   00587 759850                         mov    scon,#01010000b      ;UART initialiseren
    1313     981   0058A                  
    1314     982   0058A                  ; LET OP!!!!!!!!!!!!!! eerst BG laden, dan bcon, anders wordt BG waarde niet
    1315     983   0058A                  ; gebruikt!!
    1316     984   0058A                  
    1317     985   0058A 75BE9B                         mov    bg,#155              ;zie 12-13 in XC888 UM
    1318     986   0058D 75BD11                         mov    bcon,#00010001b
    1319     987   00590 D0BF                           pop    scu_page
    1320     988   00592 D0B2                           pop    port_page            ;alles terug herstellen
    1321     989   00594 D08F                           pop    syscon0
    1322     990   00596 D0E0                           pop    acc
    1323     991   00598 22                             ret
    1324     992   00599                  
    1325     993   00599                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1326     994   00599                  ;
    1327     995   00599                  ; SIOOUTCHAR IS EEN SUBROUTINE DIE EEN KARAKTER VIA DE SERIELE INTERFACE NAAR
    1328     996   00599                  ; BUITEN STUURT. DE ROUTINE GEBRUIKT DE ACCU ALS INPUT. DE ROUTINE GAAT NA DAT
    1329     997   00599                  ; DE TRANSMITTER LEEG IS ALVORENS HET KARAKTER TE VERSTUREN.
    1330     998   00599                  ;
    1331     999   00599                  ; de routine gebruikt geen registers.
    1332    1000   00599                  ;
    1333    1001   00599                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1334    1002   00599                  
    1335    1003   00599                  siooutchar:
    1336    1004   00599 F599             OUTCHAR:      MOV    SBUF,A        ;KARAKTER VERZENDEN
    1337    1005   0059B 3099FD           OUTCHAR1:     JNB    TI,OUTCHAR1   ;WACHT TOT ZENDER BESCHIKBAAR
    1338    1006   0059E C299                           CLR    TI            ;LAAG MAKEN VAN DE BIT
    1339    1007   005A0 22                             RET
    1340    1008   005A1                  
    1341    1009   005A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1342    1010   005A1                  ;
    1343    1011   005A1                  ; SIOOUTNIB VERZEND DE LAAGSTE VIER BITS NAAR DE SERIELE POORT ONDER DE VORM VAN
    1344    1012   005A1                  ; EEN ASCII CODE. DE ACCU EN DE VLAGGEN WORDEN DOOR DE ROUTINE GEBRUIKT.
    1345    1013   005A1                  ;
    1346    1014   005A1                  ; de routine gebruikt geen registers.
    1347    1015   005A1                  ;
    1348    1016   005A1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1349    1017   005A1                  
    1350    1018   005A1                  siooutnib:
    1351    1019   005A1 C0E0             OUTNIB:       push   acc           ;registers op de stack
    1352    1020   005A3 C0D0                           push   psw
    1353    1021   005A5 540F                           ANL    A,#00FH       ;AFZONDEREN
    1354    1022   005A7 120691                         LCALL  BATRANS       ;OMZETTEN IN ASCII CODE
    1355    1023   005AA 120599                         LCALL  OUTCHAR       ;VERSTUREN
    1356    1024   005AD 1205FA                         LCALL  XONXOFF       ;FLOW CONTROL
    1357    1025   005B0 D0D0                           pop    psw           ;registers herstellen
    1358    1026   005B2 D0E0                           pop    acc
    1359    1027   005B4 22                             RET
    1360    1028   005B5                  
    1361    1029   005B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1362    1030   005B5                  ;
    1363    1031   005B5                  ; SIOOUTBYTE ZET DE HEX INHOUD VAN DE ACCU OP DE SERIELE POORT. ALS FLOW CONTROL
    1364    1032   005B5                  ; WORDT XONXOFF GEBRUIKT.
    1365    1033   005B5                  ;
    1366    1034   005B5                  ; de routine gebruikt geen registers.
    1367    1035   005B5                  ;
    1368    1036   005B5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1369    1037   005B5                  
    1370    1038   005B5                  siooutbyte:
    1371    1039   005B5 C0E0             OUTBYTE:      push   acc           ;registers op de stack zetten
    1372    1040   005B7 C0D0                           push   psw
    1373    1041   005B9 C0E0                           PUSH   ACC           ;BACK UP NEMEN VAN DE ACCU
    1374    1042   005BB C4                             SWAP   A             ;EERST HOOGSTE DEEL
    1375    1043   005BC 1205A1                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1376    1044   005BF D0E0                           POP    ACC           ;HERSTELLEN VAN DE ACCU
    1377    1045   005C1 1205A1                         LCALL  OUTNIB        ;NIBBLE NAAR HET SCHERM
    1378    1046   005C4 D0D0                           pop    psw           ;registers herstellen
    1379    1047   005C6 D0E0                           pop    acc
    1380    1048   005C8 22                             RET
    1381    1049   005C9                  
    1382    1050   005C9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1383    1051   005C9                  ;
    1384    1052   005C9                  ; SIODISPDPTR ZET DE HEX INHOUD VAN DE DPTR OP HET SCHERM OP DE HUIDIGE PLAATS
    1385    1053   005C9                  ; VAN DE CURSOR.
    1386    1054   005C9                  ;
    1387    1055   005C9                  ; de routine gebruikt geen registers.
    1388    1056   005C9                  ;
    1389    1057   005C9                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1390    1058   005C9                  
    1391    1059   005C9                  siodispdptr:
    1392    1060   005C9 C0E0             DISPDPTR:     push   acc           ;registers op de stack zetten
    1393    1061   005CB C0D0                           push   psw
    1394    1062   005CD E583                           MOV    A,DPH         ;EERST HOOGSTE DEEL OP SCHERM
    1395    1063   005CF 1205B5                         LCALL  OUTBYTE       ;BYTE IN ASCII NAAR HET SCHERM
    1396    1064   005D2 E582                           MOV    A,DPL         ;MINST BEDUIDENDE DEEL VERZENDEN
    1397    1065   005D4 1205B5                         LCALL  OUTBYTE       ;WEG ER MEE
    1398    1066   005D7 D0D0                           pop    psw           ;registers herstellen
    1399    1067   005D9 D0E0                           pop    acc
    1400    1068   005DB 22                             RET                  ;EINDE
    1401    1069   005DC                  
    1402    1070   005DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1403    1071   005DC                  ;
    1404    1072   005DC                  ; SIOOUTMSGA IS EEN SUBROUTINE, DIE DE ASCII CODES VANAF HET ADRES IN DE DPTR,
    1405    1073   005DC                  ; TOT AAN DE CODE 00H, OP HET SCHERM ZET. HET BERICHT STAAT IN CODE MEMORY.
    1406    1074   005DC                  ;
    1407    1075   005DC                  ; de routine gebruikt geen registers.
    1408    1076   005DC                  ;
    1409    1077   005DC                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1410    1078   005DC                  
    1411    1079   005DC                  siooutmsga:
    1412    1080   005DC C0E0             OUTMSGA:      push   acc           ;alles op de stack zetten
    1413    1081   005DE C0D0                           push   psw
    1414    1082   005E0 C082                           push   dpl
    1415    1083   005E2 C083                           push   dph
    1416    1084   005E4 E4               outmsga2:     CLR    A             ;ACCU LEEG MAKEN
    1417    1085   005E5 93                             MOVC   A,@A+DPTR     ;EERSTE CODE OPHALEN
    1418    1086   005E6 6009                           JZ     OUTMSGA1      ;ALS NUL DAN EINDE
    1419    1087   005E8 120599                         LCALL  OUTCHAR       ;KARAKTER NAAR HET SCHERM
    1420    1088   005EB 1205FA                         LCALL  XONXOFF       ;SOFTWARE HANDSHAKE
    1421    1089   005EE A3                             INC    DPTR          ;DPTR AANPASSEN
    1422    1090   005EF 80F3                           SJMP   OUTMSGA2      ;HERHAAL TOT EINDE
    1423    1091   005F1 D083             OUTMSGA1:     pop    dph           ;alles herstellen
    1424    1092   005F3 D082                           pop    dpl
    1425    1093   005F5 D0D0                           pop    psw
    1426    1094   005F7 D0E0                           pop    acc
    1427    1095   005F9 22                             RET                  ;EINDE ROUTINE
    1428    1096   005FA                  
    1429    1097   005FA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1430    1098   005FA                  ;
    1431    1099   005FA                  ; XONXOFF LAAT HET GEBRUIK VAN SOFTWARE HANDSHAKE TOE. DE ROUTINE GAAT NA DAT
    1432    1100   005FA                  ; ER EEN KARAKTER ONTVANGEN WERD. ALS DIT HET XOFF KARAKTER IS BLIJFT DE
    1433    1101   005FA                  ; ROUTINE WACHTEN OP EEN ANDER WILLEKEURIG KARAKTER. DIT LAATSTE WORDT NIET
    1434    1102   005FA                  ; VERDER DOORGEGEVEN.
    1435    1103   005FA                  ;
    1436    1104   005FA                  ; de routine gebruikt geen registers.
    1437    1105   005FA                  ;
    1438    1106   005FA                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1439    1107   005FA                  
    1440    1108   005FA C0E0             XONXOFF:      push   acc           ;registers op de stack zetten
    1441    1109   005FC C0D0                           push   psw
    1442    1110   005FE 109805                         JBC    RI,XONXOFF1   ;GA NA KARAKTER ONTVANGEN
    1443    1111   00601 D0D0             XONXOFF2:     pop    psw           ;registers herstellen
    1444    1112   00603 D0E0                           pop    acc
    1445    1113   00605 22                             RET                  ;ANDERS EINDE
    1446    1114   00606 E599             XONXOFF1:     MOV    A,SBUF        ;ZO JA, KARAKTER LADEN IN ACCU
    1447    1115   00608 B413F6                         CJNE   A,#XOFF,XONXOFF2     ;ALS NIET XOFF DAN VERDER
    1448    1116   0060B 1098F3           XONXOFF3:     JBC    RI,XONXOFF2   ;WACHTEN OP WILLEKEURIG KARAKTER
    1449    1117   0060E 80FB                           SJMP   XONXOFF3      ;EN DAN RIBBE EN DE BIE
    1450    1118   00610                  
    1451    1119   00610                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1452    1120   00610                  ;
    1453    1121   00610                  ; SIOINCHAR BLIJFT WACHTEN TOTDAT ER EEN KARAKTER ONTVANGEN WERD DOOR DE SERIELE
    1454    1122   00610                  ; INTERFACE. HET KARAKTER WORDT DOORGEGEVEN IN DE ACCUMULATOR.
    1455    1123   00610                  ;
    1456    1124   00610                  ; de routine gebruikt de accu.
    1457    1125   00610                  ;
    1458    1126   00610                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1459    1127   00610                  
    1460    1128   00610                  sioinchar:
    1461    1129   00610 3098FD           INCHAR:       JNB    RI,INCHAR            ;BLIJF WACHTEN OP HET KARAKTER
    1462    1130   00613 C298                           CLR    RI                   ;BIT LAAG MAKEN
    1463    1131   00615 E599                           MOV    A,SBUF               ;KARAKTER IN DE ACCU
    1464    1132   00617 22                             RET
    1465    1133   00618                  
    1466    1134   00618                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1467    1135   00618                  ;
    1468    1136   00618                  ; SIOINBYTE LEEST TWEE ASCII CODES BINNEN EN VORMT ZE OM TOT EEN HEX BYTE.
    1469    1137   00618                  ; ALS OUTPUT WORDT DE ACCU GEBRUIKT.
    1470    1138   00618                  ; ALS HET DE TWEE ASCII CODES NIET TOT EEN BYTE OMGEZET KUNNEN WORDEN, ZAL
    1471    1139   00618                  ; DE CARRY OP 1 GEZET WORDEN.
    1472    1140   00618                  ;
    1473    1141   00618                  ; De routine gebruikt de accu, r0 en de psw.
    1474    1142   00618                  ;
    1475    1143   00618                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1476    1144   00618                  
    1477    1145   00618                  sioinbyte:
    1478    1146   00618 120610           INBYTE:       LCALL  INCHAR               ;EERSTE KARAKTER INLEZEN
    1479    1147   0061B 120684                         LCALL  LOWUPTR
    1480    1148   0061E 12069B                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR HEX GETAL
    1481    1149   00621 400E                           JC     INBYTE1              ;BIJ ERROR AKTIE ONDERNEMEN
    1482    1150   00623 C4                             SWAP   A                    ;IS HOOGSTE NIBBLE
    1483    1151   00624 F8                             MOV    R0,A                 ;ACCU TIJDELIJK BEWAREN
    1484    1152   00625 120610                         LCALL  INCHAR               ;TWEEDE KARAKTER OPHALEN
    1485    1153   00628 120684                         LCALL  LOWUPTR
    1486    1154   0062B 12069B                         LCALL  ASCBINTRANS          ;OMZETTEN NAAR BIN GETAL
    1487    1155   0062E 4001                           JC     INBYTE1              ;BIJ ERROR ....
    1488    1156   00630 48                             ORL    A,R0                 ;BIJDE GETALLEN SAMEN VOEGEN
    1489    1157   00631 22               INBYTE1:      RET
    1490    1158   00632                  
    1491    1159   00632                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1492    1160   00632                  ;
    1493    1161   00632                  ; SIOINBUFA LEEST EEN ASCII BUFFER BINNEN VIA DE SERIELE POORT. DE ROUTINE LAAT
    1494    1162   00632                  ; TOE OM FOUTIEVE INGAVEN TE VERBETEREN. HIERVOOR KAN DE BACKSPACE TOETS
    1495    1163   00632                  ; GEBRUIKT WORDEN. HET STARTADRES VAN DE BUFFER IS STRTBUF. DE LAATSE BYTE
    1496    1164   00632                  ; HEEFT HET ADRES ENDBUF. ALS DE BUFFER TE VOL, OF TE LEEG, GEMAAKT WORDT,
    1497    1165   00632                  ; LAAT DE CPU EEN BEEP HOREN. DE ROUTINE GEBRUIKT DE ACCU EN R0. CONTROLE
    1498    1166   00632                  ; KARAKTERS WORDEN NIET VERWERKT. DE ROUTINE GEEFT OOK EEN ECHO NAAR HET
    1499    1167   00632                  ; SCHERM. ZE GEBRUIKT DE SUBROUTINES INCHAR, OUTCHAR EN ASCCTR. INBUFA DOET
    1500    1168   00632                  ; OOK DE OMVORMING NAAR ASCII 0 KARAKTERS. Door de waarden van strtbuf en endbuf
    1501    1169   00632                  ; aan te passen kan de gebruiker zelf de lengte en de plaats van de buffer
    1502    1170   00632                  ; bepalen.
    1503    1171   00632                  ;
    1504    1172   00632                  ; De routine gebruikt de accu, r0 en de psw.
    1505    1173   00632                  ;
    1506    1174   00632                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1507    1175   00632                  
    1508    1176   00632                  sioinbufa:
    1509    1177   00632 7854             INBUFA:       MOV    R0,#STRTBUF          ;START ADRES VAN DE BUFFER LADEN
    1510    1178   00634 120610           INBUFA2:      LCALL  INCHAR               ;KARAKTER LEZEN
    1511    1179   00637 547F                           ANL    A,#07FH              ;KARAKTERS OMVORMEN TOT ASCII 0
    1512    1180   00639                  ; ALVORENS EEN ECHO NAAR HET SCHERM TE VERSTUREN, MOET NAGEGAAN WORDEN DAT HET
    1513    1181   00639                  ; BEKOMEN KARAKTER AAN DE TE VERWACHTEN KARAKTERS VOLDOET. DE ENIGE TOEGELATEN
    1514    1182   00639                  ; CONTROLEKARAKTERS ZIJN 'CR' EN 'BACKSPACE'. VOOR AL DE ANDERE KARAKTERS
    1515    1183   00639                  ; WORDT EEN BEEP NAAR HET SCHERM GESTUURD. DE CONTROLE WORDT DOOR ASCCTR UIT-
    1516    1184   00639                  ; GEVOERD.
    1517    1185   00639 120684                         LCALL  LOWUPTR              ;WEL EFFE IN CAPS TE ZETTEN
    1518    1186   0063C B40D02                         CJNE   A,#CR,INBUFA1        ;CR INGEGEVEN?
    1519    1187   0063F F6                             MOV    @R0,A                ;IN GEHEUGEN ZETTEN
    1520    1188   00640 22                             RET                         ;EINDE VAN DE ROUTINE
    1521    1189   00641 B40813           INBUFA1:      CJNE   A,#BACKSP,INBUFA6    ;NAGAAN BACK SPACE INDRUKKEN
    1522    1190   00644 B85407                         CJNE   R0,#STRTBUF,INBUFA3  ;STAAT DE BUFFER ONDERAAN,DAN BEEP
    1523    1191   00647 7407             INBUFA4:      MOV    A,#BEEP
    1524    1192   00649 120599           INBUFA7:      LCALL  OUTCHAR
    1525    1193   0064C 80E6                           SJMP   INBUFA2              ;NIEUW KARAKTER OPHALEN
    1526    1194   0064E 18               INBUFA3:      DEC    R0                   ;ENTRY UIT BUFFER HALEN
    1527    1195   0064F 90055D                         MOV    DPTR,#wissen         ;WIS KARAKTER DATA NAAR SCHERM
    1528    1196   00652 1205DC                         LCALL  OUTMSGA
    1529    1197   00655 80DD                           SJMP   INBUFA2              ;WACHT OP VOLGENDE INGAVE
    1530    1198   00657 120676           INBUFA6:      LCALL  ASCCTR               ;ALS CARRY DAN NIET GELDIG
    1531    1199   0065A 40EB                           JC     INBUFA4              ;BEEP NAAR SCHERM
    1532    1200   0065C B87E02                         CJNE   R0,#ENDBUF-1,INBUFA5 ;BUFFER OP HET EINDE DAN ERROR
    1533    1201   0065F 80E6                           SJMP   INBUFA4              ;BEEP NAAR HET SCHERM
    1534    1202   00661 F6               INBUFA5:      MOV    @R0,A                ;KARAKTER IN DE BUFFER
    1535    1203   00662 08                             INC    R0                   ;BUFFER POINTER AANPASSEN
    1536    1204   00663 80E4                           SJMP   INBUFA7              ;KARAKTER IN BUFFER, VOLGENDE ?
    1537    1205   00665                  
    1538    1206   00665                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1539    1207   00665                  ;
    1540    1208   00665                  ; BDELETE HAALT ALLE blank KARAKTERS UIT de inputbuffer
    1541    1209   00665                  ;
    1542    1210   00665                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1543    1211   00665                  ;
    1544    1212   00665                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1545    1213   00665                  
    1546    1214   00665 7854             BDELETE:      MOV    R0,#STRTBUF          ;START ADRES IN R0
    1547    1215   00667 7954                           MOV    R1,#STRTBUF          ;START ADRES IN R1
    1548    1216   00669 E6               BDELETE1:     MOV    A,@R0                ;LEES KARAKTER
    1549    1217   0066A B42005                         CJNE   A,#BLANK,BDELETE2    ;KARAKTER GEEN BLANKO,DAN BDELETE2
    1550    1218   0066D 08               BDELETE3:     INC    R0                   ;VOLGENDE KARAKTER OPHALEN
    1551    1219   0066E B880F8                         CJNE   R0,#ENDBUF+1,BDELETE1 ;ALS NIET EINDE DAN VERDER
    1552    1220   00671 22                             RET                         ;EINDE VAN DE ROUTINE
    1553    1221   00672 F7               BDELETE2:     MOV    @R1,A                ;KARAKTER NAAR BUFFER STUREN
    1554    1222   00673 09                             INC    R1
    1555    1223   00674 80F7                           SJMP   BDELETE3
    1556    1224   00676                  
    1557    1225   00676                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1558    1226   00676                  ;
    1559    1227   00676                  ; ASCCTR MOET NAGAAN DAT HET KARAKTER IN DE ACCU BIJ DE STANDAARD KARAKTERS
    1560    1228   00676                  ; HOORT. ENKEL DE KONTROLEKARAKTERS CR EN BP ZIJN TOEGELATEN. DE ACCU EN DE
    1561    1229   00676                  ; VLAGGEN WORDEN GEBRUIKT. DE KARAKTERS < 020H EN > DAN 07EH WORDEN ALS FOUT
    1562    1230   00676                  ; AANZIEN.
    1563    1231   00676                  ;
    1564    1232   00676                  ; De routine gebruikt de accu en de psw.
    1565    1233   00676                  ;
    1566    1234   00676                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1567    1235   00676                  
    1568    1236   00676 B42000           ASCCTR:       CJNE   A,#020H,ASCCTR1      ;NAGAAN KARAKTER KLEINER DAN
    1569    1237   00679 4007             ASCCTR1:      JC     ASCCTR3              ;CARRY, DAN ERROR
    1570    1238   0067B B47F00                         CJNE   A,#07FH,ASCCTR2      ;GROTER DAN 7EH
    1571    1239   0067E 5002             ASCCTR2:      JNC    ASCCTR3              ;GEEN CARRY DAN ERROR
    1572    1240   00680 C3                             CLR    C                    ;AANGEVEN GEEN FOUT
    1573    1241   00681 22                             RET
    1574    1242   00682 D3               ASCCTR3:      SETB   C                    ;AANGEVEN FOUT TOESTAND
    1575    1243   00683 22                             RET
    1576    1244   00684                  
    1577    1245   00684                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1578    1246   00684                  ;
    1579    1247   00684                  ; LOWUPTR ZET HET KARAKTER IN DE ACCU OM VAN LOWER NAAR UPPER CASE. DE ROUTINE
    1580    1248   00684                  ; GEBRUIKT DE VLAGGEN EN DE ACCU. DE HEX WAARDEN 61H TOT EN MET 7AH MOETEN
    1581    1249   00684                  ; OMGEZET WORDEN NAAR 41H TOT EN MET 5AH. DE ANDERE GETALLEN MOGEN NIET
    1582    1250   00684                  ; AANGEPAST WORDEN.
    1583    1251   00684                  ;
    1584    1252   00684                  ; De routine gebruikt de accu en de psw.
    1585    1253   00684                  ;
    1586    1254   00684                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1587    1255   00684                  
    1588    1256   00684 B47B00           LOWUPTR:      CJNE   A,#07BH,LOWUPTR1     ;BOVENSTE GRENS
    1589    1257   00687 5007             LOWUPTR1:     JNC    LOWUPTR2             ;GEEN CARRY DAN GEEN OMZETTING
    1590    1258   00689 B46100                         CJNE   A,#061H,LOWUPTR3     ;ONDERSTE GRENS NAGAAN
    1591    1259   0068C 4002             LOWUPTR3:     JC     LOWUPTR2             ;CARRY DAN GEEN OMZETTING
    1592    1260   0068E 9420                           SUBB   A,#020H              ;OMZETTING
    1593    1261   00690 22               LOWUPTR2:     RET                         ;EINDE OMZETTING
    1594    1262   00691                  
    1595    1263   00691                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1596    1264   00691                  ;
    1597    1265   00691                  ; BATRANS DOET DE OMZETTING VAN EEN HEX NIBBLE IN DE ACCU NAAR DE PASSENDE
    1598    1266   00691                  ; ASCII CODE.
    1599    1267   00691                  ;
    1600    1268   00691                  ; De routine gebruikt de accu en de psw.
    1601    1269   00691                  ;
    1602    1270   00691                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1603    1271   00691                  
    1604    1272   00691 B40A00           BATRANS:      CJNE   A,#00AH,BATRANS1     ;NAGAAN 30 OF 37 MOETEN BIJ OPTELLEN
    1605    1273   00694 4002             BATRANS1:     JC     BATRANS2             ;CARRY=1 DAN SLECHTS 30
    1606    1274   00696 2407                           ADD    A,#007H              ;ANDERS 30+7=37
    1607    1275   00698 2430             BATRANS2:     ADD    A,#030H              ;30 BIJ OPTELLEN
    1608    1276   0069A 22                             RET
    1609    1277   0069B                  
    1610    1278   0069B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1611    1279   0069B                  ;
    1612    1280   0069B                  ; ASCBINTRANS ZET HET ASCII KARAKTER IN DE ACCU OM IN EEN BINAIR GETAL. DE
    1613    1281   0069B                  ; ROUTINE KAN ENKEL DE KARAKTERS TUSSEN 0-9 EN A-F VERWERKEN. IN HET ANDERE
    1614    1282   0069B                  ; GEVAL WORDT DE CARRY GEZET.
    1615    1283   0069B                  ;
    1616    1284   0069B                  ; De routine gebruikt de accu en de psw.
    1617    1285   0069B                  ;
    1618    1286   0069B                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1619    1287   0069B                  
    1620    1288   0069B C3               ASCBINTRANS:  CLR    C                    ;CARRY LAAG MAKEN VOOR BEREKENINGEN
    1621    1289   0069C 9430                           SUBB   A,#030H              ;NAGAAN GETAL BINNEN GRENZEN
    1622    1290   0069E 4010                           JC     ASCBINTRANS1         ;ALS C=1 DAN FOUT
    1623    1291   006A0 B40A00                         CJNE   A,#00AH,ASCBINTRANS3 ;GETAL TUSSEN 0 EN 9 ?
    1624    1292   006A3 400A             ASCBINTRANS3: JC     ASCBINTRANS2         ;ALS CARRY DAN ALLES OK
    1625    1293   006A5 9407                           SUBB   A,#007H              ;VERDER MET DE OMZETTING
    1626    1294   006A7 4007                           JC     ASCBINTRANS1         ;ALS CARRY DAN ERROR
    1627    1295   006A9 B41000                         CJNE   A,#010H,ASCBINTRANS4 ;CONTROLE OP TE GROTE GETALLEN
    1628    1296   006AC B3               ASCBINTRANS4: CPL    C                    ;CARRY COMPLEMENTEREN
    1629    1297   006AD 4001                           JC     ASCBINTRANS1         ;ALS CARRY DAN FOUT IN HET GETAL
    1630    1298   006AF C3               ASCBINTRANS2: CLR    C                    ;CARRY LAAG MAKEN
    1631    1299   006B0 22               ASCBINTRANS1: RET
    1632    1300   006B1                  
    1633    1301   006B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1634    1302   006B1                  ;
    1635    1303   006B1                  ; ASCII1 ZET HET ASCII KARAKTER @R0 OM IN EEN HEX GETAL IN DE ACCU.
    1636    1304   006B1                  ; DE ROUTINE VERANDERD OOK DE VLAGGEN.
    1637    1305   006B1                  ;
    1638    1306   006B1                  ; De routine gebruikt de accu en de psw.
    1639    1307   006B1                  ;
    1640    1308   006B1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1641    1309   006B1                  
    1642    1310   006B1 E6               ASCII1:       MOV    A,@R0                ;KARAKTER OPHALEN
    1643    1311   006B2 12069B                         LCALL  ASCBINTRANS          ;OMZETTING ASCII NAAR BINAIR
    1644    1312   006B5 22                             RET                         ;EINDE OMZETTING
    1645    1313   006B6                  
    1646    1314   006B6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1647    1315   006B6                  ;
    1648    1316   006B6                  ; ASCII2 ZET TWEE ASCII KARAKTERS @R0 EN @(R0+1) OM NAAR EEN HEX KARAKTER
    1649    1317   006B6                  ; IN DE ACCU. R0 WORDT MET EEN VERHOOGD. R1 WORDT AANGEPAST. ALS OP HET EINDE
    1650    1318   006B6                  ; VAN DE ROUTINE DE CARRY GESET IS, DAN IS DE OMZETTING NIET MOGELIJK.
    1651    1319   006B6                  ;
    1652    1320   006B6                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1653    1321   006B6                  ;
    1654    1322   006B6                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1655    1323   006B6                  
    1656    1324   006B6 1206B1           ASCII2:       LCALL  ASCII1               ;OMZETTEN
    1657    1325   006B9 4009                           JC     ASCII21              ;CARRY 1 DAN OMZETTING NIET MOGELIJK
    1658    1326   006BB C4                             SWAP   A                    ;NIBBLE VAN PLAATS VERANDEREN
    1659    1327   006BC F9                             MOV    R1,A                 ;TIJDELIJK WEG STOPPEN
    1660    1328   006BD 08                             INC    R0                   ;NAAR VOLGENDE KARAKTER WIJZEN
    1661    1329   006BE 1206B1                         LCALL  ASCII1               ;KARAKTER OMZETTEN
    1662    1330   006C1 4001                           JC     ASCII21               ;WEG ALS C=1
    1663    1331   006C3 49                             ORL    A,R1                 ;GETALLEN BIJ ELKAAR VOEGEN
    1664    1332   006C4 22               ASCII21:      RET
    1665    1333   006C5                  
    1666    1334   006C5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1667    1335   006C5                  ;
    1668    1336   006C5                  ; ASCII4 ZET DE 4 ASCII KARAKTERS @R0 TOT @[R0+3] OM IN EEN HEX GETAL IN DE
    1669    1337   006C5                  ; DATAPOINTER. ALS DE OMZETTING NIET MOGELIJK IS WORDT DE CARRY GEZET.
    1670    1338   006C5                  ; R0 WORDT MET DRIE VERHOOGD, EN DE ACCU WORDT AANGEPAST,ALSOOK R1. ALS OP HET
    1671    1339   006C5                  ; EINDE VAN DE ROUTINE DE CARRY GESET IS, DAN WAS EEN OMZETTING NIET MOGELIJK.
    1672    1340   006C5                  ;
    1673    1341   006C5                  ; De routine gebruikt de accu, r0, r1 en de psw.
    1674    1342   006C5                  ;
    1675    1343   006C5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1676    1344   006C5                  
    1677    1345   006C5 1206B6           ASCII4:       LCALL  ASCII2               ;OMZETTEN EERSTE TWEE ASCII BYTES
    1678    1346   006C8 400A                           JC     ASCII41              ;IN GEVAL VAN ERROR DAN WEG
    1679    1347   006CA F583                           MOV    DPH,A                ;HEX GETAL IN DE DPTRH
    1680    1348   006CC 08                             INC    R0                   ;WIIJST NU NAAR VOLGENDE GROEP VAN 2
    1681    1349   006CD 1206B6                         LCALL  ASCII2               ;OMZETTEN VOLGENDE TWEE BYTES
    1682    1350   006D0 4002                           JC     ASCII41              ;BIJ FOUT DAN WEG
    1683    1351   006D2 F582                           MOV    DPL,A                ;IN DPTR LADEN
    1684    1352   006D4 22               ASCII41:      RET
    1685    1353   006D5                  
    1686    1354   006D5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1687    1355   006D5                  ;
    1688    1356   006D5                  ; initadc            is een subroutine die de adc klaar zet voor minimalistisch
    1689    1357   006D5                  ; gebruik De routine zorgt er voor dat de potmeter en de lm335 als analoge inputs
    1690    1358   006D5                  ; geschakeld worden.
    1691    1359   006D5                  ;
    1692    1360   006D5                  ; Gebruikt geen registers
    1693    1361   006D5                  ;
    1694    1362   006D5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1695    1363   006D5                  
    1696    1364   006D5 C08F             initadc:      push   syscon0                     ;map saven
    1697    1365   006D7 758F04                         mov    syscon0,#004h               ;basis pagina selecteren
    1698    1366   006DA 75D100                         mov    adc_page,#000h              ;pagina 0 selecteren
    1699    1367   006DD 75CAB0                         mov    adc_globctr,#10110000b      ;adc inschakelen                   MUST!!
    1700    1368   006E0                                                                   ;klok delen door 32 (750kHz)
    1701    1369   006E0                                                                   ;10 bit uitkomst
    1702    1370   006E0 75CE0A                         mov    adc_inpcr0,#00ah            ;sample time verlengen met x klokpulsen
    1703    1371   006E3                  ; Dit is niet echt nodig, maar hiermee vangen we de hoge impedantie van de potmeter op
    1704    1372   006E3 75CC80                         mov    adc_prar,#080h              ;arbitration slot parallelle arbiratie activeren MUST!!
    1705    1373   006E6 75D106                         mov    adc_page,#006h              ;adc page 6 selecteren             MUST!!
    1706    1374   006E9 75CC01                         mov    adc_crmr1,#001h             ;willen onmiddellijke actie        MUST!!
    1707    1375   006EC D08F                           pop    syscon0                     ;herstellen syscon
    1708    1376   006EE 22                             ret
    1709    1377   006EF                  
    1710    1378   006EF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1711    1379   006EF                  ;
    1712    1380   006EF                  ; adclm335           is een subroutine die de spanning meet die van de lm335 sensor
    1713    1381   006EF                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 5).
    1714    1382   006EF                  ;
    1715    1383   006EF                  ; Gebruikt:
    1716    1384   006EF                  ;      -accu als 8 msb meting
    1717    1385   006EF                  ;      -b als 2 lsb meting (links afgelijnd) (b veat verder data van adc_resrxl)
    1718    1386   006EF                  ;
    1719    1387   006EF                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1720    1388   006EF                  
    1721    1389   006EF C08F             adclm335:     push   syscon0
    1722    1390   006F1 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1723    1391   006F4 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1724    1392   006F7 75CB20                         mov    adc_crpr1,#00100000b        ;kanaal 5 starten
    1725    1393   006FA 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1726    1394   006FD 00               		nop
    1727    1395   006FE 00               		nop					;anders loopt het mis met het testen van de ready bit
    1728    1396   006FF E5CB             adclm3351:    mov    a,adc_globstr               ;kijken omvorming klaar
    1729    1397   00701 20E0FB                         jb     acc.0,adclm3351
    1730    1398   00704 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1731    1399   00707 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1732    1400   00709 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1733    1401   0070C D08F                           pop    syscon0
    1734    1402   0070E 22                             ret
    1735    1403   0070F                  
    1736    1404   0070F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1737    1405   0070F                  ;
    1738    1406   0070F                  ; adcpotmeter        is een subroutine die de spanning meet die van de potmeter
    1739    1407   0070F                  ; komt. De waarde wordt doorgegeven in a en b registers (kanaal 4)
    1740    1408   0070F                  ;
    1741    1409   0070F                  ; Gebruikt:
    1742    1410   0070F                  ;      -accu als 8 msb meting
    1743    1411   0070F                  ;      -b als 2 lsb meting (links afgelijnd)
    1744    1412   0070F                  ;
    1745    1413   0070F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1746    1414   0070F                  
    1747    1415   0070F C08F             adcpotmeter:  push   syscon0
    1748    1416   00711 758F04                         mov    syscon0,#004h               ;map kiezen en vorige bewaren
    1749    1417   00714 75D106                         mov    adc_page,#006h              ;adc pagina 6 kiezen
    1750    1418   00717 75CB10                         mov    adc_crpr1,#00010000b        ;kanaal 4 starten
    1751    1419   0071A 75D100                         mov    adc_page,#000h              ;naar pagina 0 schakelen
    1752    1420   0071D 00               		nop
    1753    1421   0071E 00               		nop					;anders loopt het mis met het testen van de ready bit
    1754    1422   0071F E5CB             adcpotmeter1: mov    a,adc_globstr               ;kijken omvorming klaar
    1755    1423   00721 20E0FB                         jb     acc.0,adcpotmeter1
    1756    1424   00724 75D102                         mov    adc_page,#002h              ;pagina 2 selecteren
    1757    1425   00727 E5CB                           mov    a,adc_resr0h                ;uitkomst in accu
    1758    1426   00729 85CAF0                         mov    b,adc_resr0l                ;uitkomst in b
    1759    1427   0072C D08F                           pop    syscon0
    1760    1428   0072E                  
    1761    1429   0072E                  
    1762    1430   0072E 22                             ret
    1763    1431   0072F                  
    1764    1432   0072F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1765    1433   0072F                  ;
    1766    1434   0072F                  ; Dit is het driver gedeelte met de subroutines voor wiskundige berekeningen.
    1767    1435   0072F                  ; Het is niet de bedoeling om de meest compacte code te bekomen. De driver zal
    1768    1436   0072F                  ; ook niet alle gewenste routines bevatten. Hij is geschreven met pedagogische
    1769    1437   0072F                  ; doelstellingen in het achterhoofd.
    1770    1438   0072F                  ;
    1771    1439   0072F                  ; De driver bevat routines voor 8 bit bcd naar hex en hex naar bcd omvorming
    1772    1440   0072F                  ; LET OP!!!! de getallen moeten in waarde kleiner dan 100d zijn (zowel hex als
    1773    1441   0072F                  ; bcd)
    1774    1442   0072F                  ;      8bit hex naar bcd
    1775    1443   0072F                  ;      8bit bcd naar hex
    1776    1444   0072F                  ;
    1777    1445   0072F                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 16 bit getallen:
    1778    1446   0072F                  ;      16/16 bit met 16 bit uitkomst en 16 bit rest
    1779    1447   0072F                  ;      16*16 bit met 32 bit uitkomst
    1780    1448   0072F                  ;      16+16 bit met 24 bit uitkomst
    1781    1449   0072F                  ;      16-16 bit met 24 bit uitkomst
    1782    1450   0072F                  ;      16bit hex naar bcd
    1783    1451   0072F                  ;      16bit bcd naar hex
    1784    1452   0072F                  ;
    1785    1453   0072F                  ; De driver bevat routines voor de 4 hoofdbewerkingen op 32 bit getallen:
    1786    1454   0072F                  ;      32/32 bit met 32 bit uitkomst en 32 bit rest
    1787    1455   0072F                  ;      32*32 bit met 64 bit uitkomst
    1788    1456   0072F                  ;      32+32 bit met 40 bit uitkomst
    1789    1457   0072F                  ;      32-32 bit met 40 bit uitkomst
    1790    1458   0072F                  ;
    1791    1459   0072F                  ; de gebruiker moet zorgen dat de berekeningen mogelijk zijn!!!!!!!!!!!!!!!!!!
    1792    1460   0072F                  ;
    1793    1461   0072F                  ; De routines gebruiken als input en output de huidige registerbank.
    1794    1462   0072F                  ;
    1795    1463   0072F                  ;
    1796    1464   0072F                  ; WAARSCHUWING!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1797    1465   0072F                  ; DEZE ROUTINES GEBRUIKEN 15 BYTES STACK. ZE WERKEN ENKEL ALS DE STACK NIET DE
    1798    1466   0072F                  ; ADRESSEN 70-7c GEBRUIKT. ER WORDEN HIER IMMERS DIRECT ADRESSEERBARE REGISTERS
    1799    1467   0072F                  ; VRIJ GEMAAKT OM IN TE REKENEN.
    1800    1468   0072F                  ; !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    1801    1469   0072F                  ;
    1802    1470   0072F                  ; geschreven door Roggemans Marc (MGM) op 11/2004 uitvoering 51math0.inc
    1803    1471   0072F                  ; Aangepast door Roggmans Marc (MGM) op 07/2010 voor xcez
    1804    1472   0072F                  ;      -routines gebruiken geen MDU!
    1805    1473   0072F                  ;
    1806    1474   0072F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1807    1475   0072F                  
    1808    1476   0072F                  ; Hier worden gpr's verbonden met een naam. Ze worden gebruikt door sommige
    1809    1477   0072F                  ; routines. Omdat ze informatie kunnen bevatten worden ze op de stack gezet.
    1810    1478   0072F                  
    1811    1479   0072F                  h0            equ    070h
    1812    1480   0072F                  h1            equ    071h
    1813    1481   0072F                  h2            equ    072h
    1814    1482   0072F                  h3            equ    073h
    1815    1483   0072F                  h4            equ    074h
    1816    1484   0072F                  h5            equ    075h
    1817    1485   0072F                  h6            equ    076h
    1818    1486   0072F                  h7            equ    077h
    1819    1487   0072F                  h8            equ    078h
    1820    1488   0072F                  h9            equ    079h
    1821    1489   0072F                  h10           equ    07ah
    1822    1490   0072F                  h11           equ    07bh
    1823    1491   0072F                  h12           equ    07ch
    1824    1492   0072F                  
    1825    1493   0072F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1826    1494   0072F                  ;
    1827    1495   0072F                  ; mul32       is de routine die twee 32 bit getallen zal vermenigvuldigen.
    1828    1496   0072F                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    1829    1497   0072F                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    1830    1498   0072F                  ; output:     r7,r6,r5,r4,r3,r2,r1,r0 met r7=msb
    1831    1499   0072F                  ;
    1832    1500   0072F                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    1833    1501   0072F                  ;
    1834    1502   0072F                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1835    1503   0072F                  
    1836    1504   0072F C0E0             mul32:        push   acc                  ;registers op de stack zetten
    1837    1505   00731 C0D0                           push   psw
    1838    1506   00733 C070                           push   h0
    1839    1507   00735 C071                           push   h1
    1840    1508   00737 C072                           push   h2
    1841    1509   00739 C073                           push   h3
    1842    1510   0073B C074                           push   h4
    1843    1511   0073D C075                           push   h5
    1844    1512   0073F C076                           push   h6
    1845    1513   00741 C077                           push   h7
    1846    1514   00743 C078                           push   h8
    1847    1515   00745 C079                           push   h9
    1848    1516   00747 C07A                           push   h10
    1849    1517   00749 C07B                           push   h11
    1850    1518   0074B C07C                           push   h12
    1851    1519   0074D                  
    1852    1520   0074D                  ; eerst moeten de hulpregisters klaar gezet worden
    1853    1521   0074D                  
    1854    1522   0074D 757000                         mov    h0,#000h
    1855    1523   00750 757100                         mov    h1,#000h
    1856    1524   00753 757200                         mov    h2,#000h
    1857    1525   00756 757300                         mov    h3,#000h
    1858    1526   00759 757400                         mov    h4,#000h
    1859    1527   0075C 757500                         mov    h5,#000h
    1860    1528   0075F 757600                         mov    h6,#000h
    1861    1529   00762 757700                         mov    h7,#000h
    1862    1530   00765 757800                         mov    h8,#000h
    1863    1531   00768 757900                         mov    h9,#000h
    1864    1532   0076B 757A00                         mov    h10,#000h
    1865    1533   0076E 757B00                         mov    h11,#000h
    1866    1534   00771 757C20                         mov    h12,#32              ;loopcounter
    1867    1535   00774                  
    1868    1536   00774                  ; volgende lus moet 32 keer doorlopen worden om de berekening te maken
    1869    1537   00774                  
    1870    1538   00774                  ; nu wordt de vermenigvuldiger naar rechts in de carry geshift
    1871    1539   00774                  
    1872    1540   00774 EB               mul321:       mov    a,r3
    1873    1541   00775 13                             rrc    a
    1874    1542   00776 FB                             mov    r3,a
    1875    1543   00777 EA                             mov    a,r2
    1876    1544   00778 13                             rrc    a
    1877    1545   00779 FA                             mov    r2,a
    1878    1546   0077A E9                             mov    a,r1
    1879    1547   0077B 13                             rrc    a
    1880    1548   0077C F9                             mov    r1,a
    1881    1549   0077D E8                             mov    a,r0
    1882    1550   0077E 13                             rrc    a
    1883    1551   0077F F8                             mov    r0,a                 ;32 bit shift klaar
    1884    1552   00780                  
    1885    1553   00780                  ;als de carry 1 is moet het 64 bit getal h3-r4 opgeteld worden bij h11-h4
    1886    1554   00780                  
    1887    1555   00780 502C                           jnc    mul322               ;optelling niet nodig
    1888    1556   00782                  
    1889    1557   00782                  ; hier staat en 64 bit optelling
    1890    1558   00782                  
    1891    1559   00782 EC                             mov    a,r4
    1892    1560   00783 2574                           add    a,h4
    1893    1561   00785 F574                           mov    h4,a
    1894    1562   00787 ED                             mov    a,r5
    1895    1563   00788 3575                           addc   a,h5
    1896    1564   0078A F575                           mov    h5,a
    1897    1565   0078C EE                             mov    a,r6
    1898    1566   0078D 3576                           addc   a,h6
    1899    1567   0078F F576                           mov    h6,a
    1900    1568   00791 EF                             mov    a,r7
    1901    1569   00792 3577                           addc   a,h7
    1902    1570   00794 F577                           mov    h7,a
    1903    1571   00796 E570                           mov    a,h0
    1904    1572   00798 3578                           addc   a,h8
    1905    1573   0079A F578                           mov    h8,a
    1906    1574   0079C E571                           mov    a,h1
    1907    1575   0079E 3579                           addc   a,h9
    1908    1576   007A0 F579                           mov    h9,a
    1909    1577   007A2 E572                           mov    a,h2
    1910    1578   007A4 357A                           addc   a,h10
    1911    1579   007A6 F57A                           mov    h10,a
    1912    1580   007A8 E573                           mov    a,h3
    1913    1581   007AA 357B                           addc   a,h11
    1914    1582   007AC F57B                           mov    h11,a                ;optelling klaar
    1915    1583   007AE                  
    1916    1584   007AE                  ; het getal h3-r4 moet met twee vermenigvuldigd worden
    1917    1585   007AE                  
    1918    1586   007AE C3               mul322:       clr    c                    ;moet op 0 staan
    1919    1587   007AF EC                             mov    a,r4
    1920    1588   007B0 33                             rlc    a
    1921    1589   007B1 FC                             mov    r4,a
    1922    1590   007B2 ED                             mov    a,r5
    1923    1591   007B3 33                             rlc    a
    1924    1592   007B4 FD                             mov    r5,a
    1925    1593   007B5 EE                             mov    a,r6
    1926    1594   007B6 33                             rlc    a
    1927    1595   007B7 FE                             mov    r6,a
    1928    1596   007B8 EF                             mov    a,r7
    1929    1597   007B9 33                             rlc    a
    1930    1598   007BA FF                             mov    r7,a
    1931    1599   007BB E570                           mov    a,h0
    1932    1600   007BD 33                             rlc    a
    1933    1601   007BE F570                           mov    h0,a
    1934    1602   007C0 E571                           mov    a,h1
    1935    1603   007C2 33                             rlc    a
    1936    1604   007C3 F571                           mov    h1,a
    1937    1605   007C5 E572                           mov    a,h2
    1938    1606   007C7 33                             rlc    a
    1939    1607   007C8 F572                           mov    h2,a
    1940    1608   007CA E573                           mov    a,h3
    1941    1609   007CC 33                             rlc    a
    1942    1610   007CD F573                           mov    h3,a
    1943    1611   007CF                  
    1944    1612   007CF D57CA2                         djnz   h12,mul321           ;herhaal 32 keer
    1945    1613   007D2                  
    1946    1614   007D2                  ; de uitkomst moet in de juiste registers komen
    1947    1615   007D2                  
    1948    1616   007D2 A874                           mov    r0,h4
    1949    1617   007D4 A975                           mov    r1,h5
    1950    1618   007D6 AA76                           mov    r2,h6
    1951    1619   007D8 AB77                           mov    r3,h7
    1952    1620   007DA AC78                           mov    r4,h8
    1953    1621   007DC AD79                           mov    r5,h9
    1954    1622   007DE AE7A                           mov    r6,h10
    1955    1623   007E0 AF7B                           mov    r7,h11               ;klaar
    1956    1624   007E2                  
    1957    1625   007E2 D07C                           pop    h12                  ;registers herstellen
    1958    1626   007E4 D07B                           pop    h11
    1959    1627   007E6 D07A                           pop    h10
    1960    1628   007E8 D079                           pop    h9
    1961    1629   007EA D078                           pop    h8
    1962    1630   007EC D077                           pop    h7
    1963    1631   007EE D076                           pop    h6
    1964    1632   007F0 D075                           pop    h5
    1965    1633   007F2 D074                           pop    h4
    1966    1634   007F4 D073                           pop    h3
    1967    1635   007F6 D072                           pop    h2
    1968    1636   007F8 D071                           pop    h1
    1969    1637   007FA D070                           pop    h0
    1970    1638   007FC D0D0                           pop    psw
    1971    1639   007FE D0E0                           pop    acc
    1972    1640   00800 22                             ret
    1973    1641   00801                  
    1974    1642   00801                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1975    1643   00801                  ;
    1976    1644   00801                  ; mul16       is de routine die twee 16 bit getallen zal vermenigvuldigen.
    1977    1645   00801                  ; input:      r1,r0 = eerste getal (r1=msb)
    1978    1646   00801                  ;             r3,r2 = tweede getal (r3=msb)
    1979    1647   00801                  ; output:     r3,r2,r1,r0 met r3=msb
    1980    1648   00801                  ;
    1981    1649   00801                  ; De routine gebruikt alleen de registers r3, r2, r1, r0 van de huidige bank
    1982    1650   00801                  ;
    1983    1651   00801                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    1984    1652   00801                  
    1985    1653   00801 C0E0             mul16:        push   acc                  ;registers op de stack zetten
    1986    1654   00803 C0D0                           push   psw
    1987    1655   00805 C070                           push   h0
    1988    1656   00807 C071                           push   h1
    1989    1657   00809 C072                           push   h2
    1990    1658   0080B C073                           push   h3
    1991    1659   0080D C074                           push   h4
    1992    1660   0080F C075                           push   h5
    1993    1661   00811 C076                           push   h6
    1994    1662   00813                  
    1995    1663   00813                  ; eerst registers laden met startwaarden. h0 en h1 zijn het verlengstuk
    1996    1664   00813                  ; van r3 en r2. h2, h3, h4, h5 worden gebruikt voor sommatie.
    1997    1665   00813                  ; h6 is de loopcounter.
    1998    1666   00813                  
    1999    1667   00813 757000                         mov    h0,#000h
    2000    1668   00816 757100                         mov    h1,#000h
    2001    1669   00819 757200                         mov    h2,#000h
    2002    1670   0081C 757300                         mov    h3,#000h
    2003    1671   0081F 757400                         mov    h4,#000h
    2004    1672   00822 757500                         mov    h5,#000h
    2005    1673   00825 757610                         mov    h6,#16               ;loopcounter
    2006    1674   00828                  
    2007    1675   00828                  ; hier staat de lus die 16 keer doorlopen wordt voor het uitvoeren van de
    2008    1676   00828                  ; berekening
    2009    1677   00828                  
    2010    1678   00828 E9               mul161:       mov    a,r1                 ;getal 1 1*rechts in carry
    2011    1679   00829 13                             rrc    a
    2012    1680   0082A F9                             mov    r1,a
    2013    1681   0082B E8                             mov    a,r0
    2014    1682   0082C 13                             rrc    a
    2015    1683   0082D F8                             mov    r0,a                 ;ok
    2016    1684   0082E                  
    2017    1685   0082E                  ; als carry 1 dan h1, h0, r3, r2 optellen bij h5, h4, h3, h2
    2018    1686   0082E                  
    2019    1687   0082E 5016                           jnc    mul162
    2020    1688   00830                  
    2021    1689   00830 EA                             mov    a,r2
    2022    1690   00831 2572                           add    a,h2
    2023    1691   00833 F572                           mov    h2,a                 ;32 bit som uitvoeren
    2024    1692   00835 EB                             mov    a,r3
    2025    1693   00836 3573                           addc   a,h3
    2026    1694   00838 F573                           mov    h3,a
    2027    1695   0083A E570                           mov    a,h0
    2028    1696   0083C 3574                           addc   a,h4
    2029    1697   0083E F574                           mov    h4,a
    2030    1698   00840 E571                           mov    a,h1
    2031    1699   00842 3575                           addc   a,h5
    2032    1700   00844 F575                           mov    h5,a                 ;klaar
    2033    1701   00846                  
    2034    1702   00846                  ; het te vermenigvuldige getal maal 2 (1*links shiften)
    2035    1703   00846                  
    2036    1704   00846 C3               mul162:       clr    c
    2037    1705   00847 EA                             mov    a,r2
    2038    1706   00848 33                             rlc    a
    2039    1707   00849 FA                             mov    r2,a                 ;ook 32 bit getal
    2040    1708   0084A EB                             mov    a,r3
    2041    1709   0084B 33                             rlc    a
    2042    1710   0084C FB                             mov    r3,a
    2043    1711   0084D E570                           mov    a,h0
    2044    1712   0084F 33                             rlc    a
    2045    1713   00850 F570                           mov    h0,a
    2046    1714   00852 E571                           mov    a,h1
    2047    1715   00854 33                             rlc    a
    2048    1716   00855 F571                           mov    h1,a                 ;klaar
    2049    1717   00857                  
    2050    1718   00857 D576CE                         djnz   h6,mul161            ;herhaal 16 keer
    2051    1719   0085A                  
    2052    1720   0085A                  ; de vermenigvuldiging is klaar. Nu uitkomstregisters laden
    2053    1721   0085A                  
    2054    1722   0085A A872                           mov    r0,h2
    2055    1723   0085C A973                           mov    r1,h3
    2056    1724   0085E AA74                           mov    r2,h4
    2057    1725   00860 AB75                           mov    r3,h5                ;klaar
    2058    1726   00862                  
    2059    1727   00862                  
    2060    1728   00862 D076                           pop    h6                   ;registers herstellen
    2061    1729   00864 D075                           pop    h5
    2062    1730   00866 D074                           pop    h4
    2063    1731   00868 D073                           pop    h3
    2064    1732   0086A D072                           pop    h2
    2065    1733   0086C D071                           pop    h1
    2066    1734   0086E D070                           pop    h0
    2067    1735   00870 D0D0                           pop    psw
    2068    1736   00872 D0E0                           pop    acc
    2069    1737   00874 22                             ret
    2070    1738   00875                  
    2071    1739   00875                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2072    1740   00875                  ;
    2073    1741   00875                  ; div32       is de routine die twee 32 bit getallen zal delen (eerste/tweede).
    2074    1742   00875                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2075    1743   00875                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2076    1744   00875                  ; output:     r7,r6,r5,r4 = quotient (r7=msb)
    2077    1745   00875                  ;             r3,r2,r1,r0 = rest (r3=msb)
    2078    1746   00875                  ;             carry=1 bij delen door 0
    2079    1747   00875                  ;
    2080    1748   00875                  ; De routine gebruikt alleen de registers van de huidig geselecteerde bank
    2081    1749   00875                  ;
    2082    1750   00875                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2083    1751   00875                  
    2084    1752   00875 C0E0             div32:        push   acc                  ;registers op de stack zetten
    2085    1753   00877 C0D0                           push   psw
    2086    1754   00879 C070                           push   h0
    2087    1755   0087B C071                           push   h1
    2088    1756   0087D C072                           push   h2
    2089    1757   0087F C073                           push   h3
    2090    1758   00881 C074                           push   h4
    2091    1759   00883 C075                           push   h5
    2092    1760   00885 C076                           push   h6
    2093    1761   00887 C077                           push   h7
    2094    1762   00889 C078                           push   h8
    2095    1763   0088B C079                           push   h9
    2096    1764   0088D C07A                           push   h10
    2097    1765   0088F C07B                           push   h11
    2098    1766   00891 C07C                           push   h12
    2099    1767   00893                  
    2100    1768   00893                  ; eerst alles voorladen
    2101    1769   00893                  
    2102    1770   00893 757000                         mov    h0,#000h
    2103    1771   00896 757100                         mov    h1,#000h
    2104    1772   00899 757200                         mov    h2,#000h
    2105    1773   0089C 757300                         mov    h3,#000h
    2106    1774   0089F 757400                         mov    h4,#000h
    2107    1775   008A2 757500                         mov    h5,#000h
    2108    1776   008A5 757600                         mov    h6,#000h
    2109    1777   008A8 757700                         mov    h7,#000h
    2110    1778   008AB 757800                         mov    h8,#000h
    2111    1779   008AE 757900                         mov    h9,#000h
    2112    1780   008B1 757A00                         mov    h10,#000h
    2113    1781   008B4 757B00                         mov    h11,#000h
    2114    1782   008B7 757C20                         mov    h12,#32              ;loopcounter
    2115    1783   008BA                  
    2116    1784   008BA                  ; we gaan het te delen getal in de passende hulpregisters shiften
    2117    1785   008BA                  
    2118    1786   008BA                  ; deze lus moet 32 keer heraald worden
    2119    1787   008BA                  
    2120    1788   008BA E8               div321:       mov    a,r0                 ;h3-r0 is te delen getal
    2121    1789   008BB 33                             rlc    a
    2122    1790   008BC F8                             mov    r0,a
    2123    1791   008BD E9                             mov    a,r1
    2124    1792   008BE 33                             rlc    a
    2125    1793   008BF F9                             mov    r1,a
    2126    1794   008C0 EA                             mov    a,r2
    2127    1795   008C1 33                             rlc    a
    2128    1796   008C2 FA                             mov    r2,a
    2129    1797   008C3 EB                             mov    a,r3
    2130    1798   008C4 33                             rlc    a
    2131    1799   008C5 FB                             mov    r3,a
    2132    1800   008C6 E570                           mov    a,h0
    2133    1801   008C8 33                             rlc    a
    2134    1802   008C9 F570                           mov    h0,a
    2135    1803   008CB E571                           mov    a,h1
    2136    1804   008CD 33                             rlc    a
    2137    1805   008CE F571                           mov    h1,a
    2138    1806   008D0 E572                           mov    a,h2
    2139    1807   008D2 33                             rlc    a
    2140    1808   008D3 F572                           mov    h2,a
    2141    1809   008D5 E573                           mov    a,h3
    2142    1810   008D7 33                             rlc    a
    2143    1811   008D8 F573                           mov    h3,a
    2144    1812   008DA                  
    2145    1813   008DA                  ; nu testen of het deeltal in h3-h0 past, tussenuitkomst in h7-h4
    2146    1814   008DA                  
    2147    1815   008DA C3                             clr    c                    ;zit in de weg
    2148    1816   008DB E570                           mov    a,h0
    2149    1817   008DD 9C                             subb   a,r4
    2150    1818   008DE F574                           mov    h4,a
    2151    1819   008E0 E571                           mov    a,h1
    2152    1820   008E2 9D                             subb   a,r5
    2153    1821   008E3 F575                           mov    h5,a
    2154    1822   008E5 E572                           mov    a,h2
    2155    1823   008E7 9E                             subb   a,r6
    2156    1824   008E8 F576                           mov    h6,a
    2157    1825   008EA E573                           mov    a,h3
    2158    1826   008EC 9F                             subb   a,r7
    2159    1827   008ED F577                           mov    h7,a
    2160    1828   008EF                  
    2161    1829   008EF                  ; als er geen carry is, dan is het verschil succesvol, en moeten h3-h0
    2162    1830   008EF                  ; vervangen worden door h7-h4
    2163    1831   008EF                  
    2164    1832   008EF 400C                           jc     div322               ;niet vervangen
    2165    1833   008F1                  
    2166    1834   008F1 857470                         mov    h0,h4
    2167    1835   008F4 857571                         mov    h1,h5
    2168    1836   008F7 857672                         mov    h2,h6
    2169    1837   008FA 857773                         mov    h3,h7                ;vervanging klaar
    2170    1838   008FD                  
    2171    1839   008FD B3               div322:       cpl    c                    ;dit moet in h11-h8 (uitkomst)
    2172    1840   008FE E578                           mov    a,h8
    2173    1841   00900 33                             rlc    a
    2174    1842   00901 F578                           mov    h8,a
    2175    1843   00903 E579                           mov    a,h9
    2176    1844   00905 33                             rlc    a
    2177    1845   00906 F579                           mov    h9,a
    2178    1846   00908 E57A                           mov    a,h10
    2179    1847   0090A 33                             rlc    a
    2180    1848   0090B F57A                           mov    h10,a
    2181    1849   0090D E57B                           mov    a,h11
    2182    1850   0090F 33                             rlc    a
    2183    1851   00910 F57B                           mov    h11,a                ;qoutient aangepast
    2184    1852   00912                  
    2185    1853   00912 D57CA5                         djnz   h12,div321           ;32 keer herhalen
    2186    1854   00915                  
    2187    1855   00915                  ; de berekening is klaar. uitkomstregisters nog laden
    2188    1856   00915                  
    2189    1857   00915 AC78                           mov    r4,h8
    2190    1858   00917 AD79                           mov    r5,h9
    2191    1859   00919 AE7A                           mov    r6,h10
    2192    1860   0091B AF7B                           mov    r7,h11               ;uitkomst geladen
    2193    1861   0091D                  
    2194    1862   0091D A870                           mov    r0,h0                ;rest laden
    2195    1863   0091F A971                           mov    r1,h1
    2196    1864   00921 AA72                           mov    r2,h2
    2197    1865   00923 AB73                           mov    r3,h3
    2198    1866   00925                  
    2199    1867   00925 D07C                           pop    h12                  ;registers herstellen
    2200    1868   00927 D07B                           pop    h11
    2201    1869   00929 D07A                           pop    h10
    2202    1870   0092B D079                           pop    h9
    2203    1871   0092D D078                           pop    h8
    2204    1872   0092F D077                           pop    h7
    2205    1873   00931 D076                           pop    h6
    2206    1874   00933 D075                           pop    h5
    2207    1875   00935 D074                           pop    h4
    2208    1876   00937 D073                           pop    h3
    2209    1877   00939 D072                           pop    h2
    2210    1878   0093B D071                           pop    h1
    2211    1879   0093D D070                           pop    h0
    2212    1880   0093F D0D0                           pop    psw
    2213    1881   00941 D0E0                           pop    acc
    2214    1882   00943 22                             ret
    2215    1883   00944                  
    2216    1884   00944                  
    2217    1885   00944                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2218    1886   00944                  ;
    2219    1887   00944                  ; div16       is de routine die twee 16 bit getallen zal delen (eerste/tweede).
    2220    1888   00944                  ; input:      r1,r0 = eerste getal (r1=msb)
    2221    1889   00944                  ;             r3,r2 = tweede getal (r3=msb)
    2222    1890   00944                  ; output:     r3,r2 = quotient (r3=msb)
    2223    1891   00944                  ;             r1,r0 = rest (r1=msb)
    2224    1892   00944                  ;             carry=1 bij deling door 0
    2225    1893   00944                  ;
    2226    1894   00944                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2227    1895   00944                  
    2228    1896   00944 C0E0             div16:        push   acc                  ;registers op de stack zetten
    2229    1897   00946 C0D0                           push   psw
    2230    1898   00948 C070                           push   h0
    2231    1899   0094A C071                           push   h1
    2232    1900   0094C C072                           push   h2
    2233    1901   0094E C073                           push   h3
    2234    1902   00950 C074                           push   h4
    2235    1903   00952 C075                           push   h5
    2236    1904   00954 C076                           push   h6
    2237    1905   00956                  
    2238    1906   00956                  ; registers voorladen
    2239    1907   00956                  
    2240    1908   00956 757000                         mov    h0,#000h
    2241    1909   00959 757100                         mov    h1,#000h
    2242    1910   0095C 757200                         mov    h2,#000h
    2243    1911   0095F 757300                         mov    h3,#000h
    2244    1912   00962 757400                         mov    h4,#000h
    2245    1913   00965 757500                         mov    h5,#000h
    2246    1914   00968 757610                         mov    h6,#16               ;loopcounter
    2247    1915   0096B                  
    2248    1916   0096B                  ; eerst te delen getal 1*links shiften in hulpregisters
    2249    1917   0096B                  
    2250    1918   0096B                  ; deze lus moet 16 keer herhaald worden
    2251    1919   0096B                  
    2252    1920   0096B E8               div161:       mov    a,r0                 ;32 bit shift in h1-r0
    2253    1921   0096C 33                             rlc    a
    2254    1922   0096D F8                             mov    r0,a
    2255    1923   0096E E9                             mov    a,r1
    2256    1924   0096F 33                             rlc    a
    2257    1925   00970 F9                             mov    r1,a
    2258    1926   00971 E570                           mov    a,h0
    2259    1927   00973 33                             rlc    a
    2260    1928   00974 F570                           mov    h0,a
    2261    1929   00976 E571                           mov    a,h1
    2262    1930   00978 33                             rlc    a
    2263    1931   00979 F571                           mov    h1,a
    2264    1932   0097B                  
    2265    1933   0097B                  ; nagaan of in h1-h0 de deler past r3-r2. h3-h2 wordt gebruikt voor
    2266    1934   0097B                  ; het tussenresultaat.
    2267    1935   0097B                  
    2268    1936   0097B C3                             clr    c
    2269    1937   0097C E570                           mov    a,h0
    2270    1938   0097E 9A                             subb   a,r2
    2271    1939   0097F F572                           mov    h2,a
    2272    1940   00981 E571                           mov    a,h1
    2273    1941   00983 9B                             subb   a,r3
    2274    1942   00984 F573                           mov    h3,a
    2275    1943   00986                  
    2276    1944   00986 4006                           jc     div162               ;als carry dan h1-h0 niet vervangen
    2277    1945   00988                                                            ;door h3,h2
    2278    1946   00988 857270                         mov    h0,h2
    2279    1947   0098B 857371                         mov    h1,h3                ;vervanging klaar
    2280    1948   0098E                  
    2281    1949   0098E                  ; uitkomst moet aangepast worden
    2282    1950   0098E                  
    2283    1951   0098E B3               div162:       cpl    c                    ;truuk
    2284    1952   0098F E574                           mov    a,h4
    2285    1953   00991 33                             rlc    a
    2286    1954   00992 F574                           mov    h4,a
    2287    1955   00994 E575                           mov    a,h5
    2288    1956   00996 33                             rlc    a
    2289    1957   00997 F575                           mov    h5,a
    2290    1958   00999 D576CF                         djnz   h6,div161            ;16 keer herhalen
    2291    1959   0099C                  
    2292    1960   0099C                  ; de berekening is klaar. uitkomsten in passende registers
    2293    1961   0099C                  
    2294    1962   0099C AA74                           mov    r2,h4                ;quotient
    2295    1963   0099E AB75                           mov    r3,h5
    2296    1964   009A0                  
    2297    1965   009A0 A870                           mov    r0,h0                ;rest
    2298    1966   009A2 A971                           mov    r1,h1
    2299    1967   009A4                  
    2300    1968   009A4 D076                           pop    h6                   ;registers herstellen
    2301    1969   009A6 D075                           pop    h5
    2302    1970   009A8 D074                           pop    h4
    2303    1971   009AA D073                           pop    h3
    2304    1972   009AC D072                           pop    h2
    2305    1973   009AE D071                           pop    h1
    2306    1974   009B0 D070                           pop    h0
    2307    1975   009B2 D0D0                           pop    psw
    2308    1976   009B4 D0E0                           pop    acc
    2309    1977   009B6 22                             ret
    2310    1978   009B7                  
    2311    1979   009B7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2312    1980   009B7                  ;
    2313    1981   009B7                  ; add32       zal twee 32 bit getallen optellen en een 40 bit uitkomst.
    2314    1982   009B7                  ;
    2315    1983   009B7                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2316    1984   009B7                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2317    1985   009B7                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2318    1986   009B7                  ;
    2319    1987   009B7                  ; r4,r3,r2,r1,r0 worden aangepast
    2320    1988   009B7                  ;
    2321    1989   009B7                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2322    1990   009B7                  
    2323    1991   009B7 C0E0             add32:        push   acc                  ;registers op de stack zetten
    2324    1992   009B9 C0D0                           push   psw
    2325    1993   009BB E8                             mov    a,r0                 ;eerste 8 bit
    2326    1994   009BC 2C                             add    a,r4
    2327    1995   009BD F8                             mov    r0,a                 ;klaar
    2328    1996   009BE E9                             mov    a,r1                 ;volgende 8 bit
    2329    1997   009BF 3D                             addc   a,r5
    2330    1998   009C0 F9                             mov    r1,a                 ;klaar
    2331    1999   009C1 EA                             mov    a,r2                 ;volgende 8 bit
    2332    2000   009C2 3E                             addc   a,r6
    2333    2001   009C3 FA                             mov    r2,a                 ;klaar
    2334    2002   009C4 EB                             mov    a,r3                 ;laatste 8 bit
    2335    2003   009C5 3F                             addc   a,r7
    2336    2004   009C6 FB                             mov    r3,a                 ;32 bit klaar
    2337    2005   009C7 7400                           mov    a,#000h
    2338    2006   009C9 3400                           addc   a,#000h              ;carry verrekenen
    2339    2007   009CB FC                             mov    r4,a
    2340    2008   009CC D0D0                           pop    psw                  ;registers herstellen
    2341    2009   009CE D0E0                           pop    acc
    2342    2010   009D0 22                             ret
    2343    2011   009D1                  
    2344    2012   009D1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2345    2013   009D1                  ;
    2346    2014   009D1                  ; add16       zal twee 16 bit getallen optellen en een 24 bit uitkomst.
    2347    2015   009D1                  ;
    2348    2016   009D1                  ; input:      r1,r0 = eerste getal (r1=msb)
    2349    2017   009D1                  ;             r3,r2 = tweede getal (r3=msb)
    2350    2018   009D1                  ; output:     r2,r1,r0 (r2=msb)
    2351    2019   009D1                  ;
    2352    2020   009D1                  ; r3,r2,r1,r0 worden aangepast
    2353    2021   009D1                  ;
    2354    2022   009D1                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2355    2023   009D1                  
    2356    2024   009D1 C0E0             add16:        push   acc                  ;geen registers gebruiken behalve rx
    2357    2025   009D3 C0D0                           push   psw
    2358    2026   009D5 E8                             mov    a,r0                 ;starten met de optelling
    2359    2027   009D6 2A                             add    a,r2                 ;8 bit klaar
    2360    2028   009D7 F8                             mov    r0,a                 ;uitkomst wegschrijven
    2361    2029   009D8 E9                             mov    a,r1                 ;volgende 8 bit
    2362    2030   009D9 3B                             addc   a,r3                 ;16 bit klaar
    2363    2031   009DA F9                             mov    r1,a                 ;uitkomst weggeschreven
    2364    2032   009DB 7400                           mov    a,#000h              ;carry verrekenen
    2365    2033   009DD 3400                           addc   a,#000h
    2366    2034   009DF FA                             mov    r2,a                 ;24 bit klaar
    2367    2035   009E0 D0D0                           pop    psw                  ;registers herstellen
    2368    2036   009E2 D0E0                           pop    acc
    2369    2037   009E4 22                             ret
    2370    2038   009E5                  
    2371    2039   009E5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2372    2040   009E5                  ;
    2373    2041   009E5                  ; sub32       zal het verschil berekenen van 2 32 bit getallen. De uitkomst is
    2374    2042   009E5                  ;             40 bit groot. (eerste -tweede)
    2375    2043   009E5                  ; input:      r3,r2,r1,r0 = eerste getal (r3=msb)
    2376    2044   009E5                  ;             r7,r6,r5,r4 = tweede getal (r7=msb)
    2377    2045   009E5                  ; output:     r4,r3,r2,r1,r0 (r4=msb)
    2378    2046   009E5                  ;
    2379    2047   009E5                  ; r4,r3,r2,r1,r0 worden aangepast
    2380    2048   009E5                  ;
    2381    2049   009E5                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2382    2050   009E5                  
    2383    2051   009E5 C0E0             sub32:        push   acc                  ;registers bewaren
    2384    2052   009E7 C0D0                           push   psw                  ;ook de vlaggen
    2385    2053   009E9 C3                             clr    c                    ;zit nog effe in de weg
    2386    2054   009EA E8                             mov    a,r0                 ;eerste 8 bit
    2387    2055   009EB 9C                             subb   a,r4
    2388    2056   009EC F8                             mov    r0,a
    2389    2057   009ED E9                             mov    a,r1                 ;tweede 8 bit
    2390    2058   009EE 9D                             subb   a,r5
    2391    2059   009EF F9                             mov    r1,a
    2392    2060   009F0 EA                             mov    a,r2                 ;volgende 8 bit
    2393    2061   009F1 9E                             subb   a,r6
    2394    2062   009F2 FA                             mov    r2,a
    2395    2063   009F3 EB                             mov    a,r3                 ;laatste 8 bit
    2396    2064   009F4 9F                             subb   a,r7
    2397    2065   009F5 FB                             mov    r3,a
    2398    2066   009F6 7400                           mov    a,#000h              ;nu nog de carry
    2399    2067   009F8 9400                           subb   a,#000h
    2400    2068   009FA FC                             mov    r4,a                 ;40 bit klaar
    2401    2069   009FB D0D0                           pop    psw                  ;registers herstellen
    2402    2070   009FD D0E0                           pop    acc
    2403    2071   009FF 22                             ret
    2404    2072   00A00                  
    2405    2073   00A00                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2406    2074   00A00                  ;
    2407    2075   00A00                  ; sub16       zal het verschil berekenen van 2 16 bit getallen. De uitkomst is
    2408    2076   00A00                  ;             24 bit groot. (eerste - tweede)
    2409    2077   00A00                  ; input:      r1,r0 = eerste getal (r1=msb)
    2410    2078   00A00                  ;             r3,r2 = tweede getal (r3=msb)
    2411    2079   00A00                  ; output:     r2,r1,r0 (r2=msb)
    2412    2080   00A00                  ;
    2413    2081   00A00                  ; r3,r2,r1,r0 worden aangepast
    2414    2082   00A00                  ;
    2415    2083   00A00                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2416    2084   00A00                  
    2417    2085   00A00 C0E0             sub16:        push   acc                  ;registers bewaren
    2418    2086   00A02 C0D0                           push   psw
    2419    2087   00A04 C3                             clr    c                    ;mag nog niet meespelen
    2420    2088   00A05 E8                             mov    a,r0                 ;eerste 8 bit verschil
    2421    2089   00A06 9A                             subb   a,r2
    2422    2090   00A07 F8                             mov    r0,a                 ;klaar
    2423    2091   00A08 E9                             mov    a,r1
    2424    2092   00A09 9B                             subb   a,r3                 ;16 bit klaar
    2425    2093   00A0A F9                             mov    r1,a
    2426    2094   00A0B 7400                           mov    a,#000h
    2427    2095   00A0D 9400                           subb   a,#000h              ;eventuele carry verrekenen
    2428    2096   00A0F FA                             mov    r2,a                 ;24 bit klaar
    2429    2097   00A10 D0D0                           pop    psw                  ;registers herstellen
    2430    2098   00A12 D0E0                           pop    acc
    2431    2099   00A14 22                             ret
    2432    2100   00A15                  
    2433    2101   00A15                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2434    2102   00A15                  ;
    2435    2103   00A15                  ; hexbcd16    zet een 16 bit hex getal om in een 24 bit bcd getal
    2436    2104   00A15                  ; input       r1,r0 = 16 bit hex getal (r1=msb)
    2437    2105   00A15                  ; output      r2,r1,r0 =24 bit bcd getal (r2=msb)
    2438    2106   00A15                  ;
    2439    2107   00A15                  ; de routine gebruikt alleen de registers r3,r2,r1,r0 van de huidige bank
    2440    2108   00A15                  ;
    2441    2109   00A15                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2442    2110   00A15                  
    2443    2111   00A15 C0E0             hexbcd16:     push   acc                  ;registers effe bewaren op de stack
    2444    2112   00A17 C0D0                           push   psw
    2445    2113   00A19                  
    2446    2114   00A19 C077                           push   h7                   ;nodig
    2447    2115   00A1B C078                           push   h8
    2448    2116   00A1D                  
    2449    2117   00A1D C079                           push   h9                   ;ook
    2450    2118   00A1F                  
    2451    2119   00A1F 757905                         mov    h9,#005h             ;loopcounter
    2452    2120   00A22                  
    2453    2121   00A22 7B00             hexbcd161:    mov    r3,#000h
    2454    2122   00A24 7A0A                           mov    r2,#00ah             ;hierdoor delen we
    2455    2123   00A26 120944                         lcall  div16                ;deling uitvoeren
    2456    2124   00A29 E8                             mov    a,r0                 ;rest
    2457    2125   00A2A C0E0                           push   acc                  ;op stack zetten
    2458    2126   00A2C EA                             mov    a,r2
    2459    2127   00A2D F8                             mov    r0,a
    2460    2128   00A2E EB                             mov    a,r3
    2461    2129   00A2F F9                             mov    r1,a                 ;uitkomst terug delen
    2462    2130   00A30 D579EF                         djnz   h9,hexbcd161
    2463    2131   00A33                  
    2464    2132   00A33 D0E0                           pop    acc                  ;hoogste bits van de stack
    2465    2133   00A35 FA                             mov    r2,a                 ;klaar
    2466    2134   00A36 D0E0                           pop    acc
    2467    2135   00A38 C4                             swap   a
    2468    2136   00A39 F579                           mov    h9,a
    2469    2137   00A3B D0E0                           pop    acc
    2470    2138   00A3D 2579                           add    a,h9
    2471    2139   00A3F F9                             mov    r1,a                 ;volgende 8 klaar
    2472    2140   00A40 D0E0                           pop    acc
    2473    2141   00A42 C4                             swap   a
    2474    2142   00A43 F579                           mov    h9,a
    2475    2143   00A45 D0E0                           pop    acc
    2476    2144   00A47 2579                           add    a,h9
    2477    2145   00A49 F8                             mov    r0,a                 ;klaar
    2478    2146   00A4A                  
    2479    2147   00A4A D079                           pop    h9                   ;was naar de knoppen
    2480    2148   00A4C                  
    2481    2149   00A4C D078                           pop    h8                   ;gebruikt
    2482    2150   00A4E D077                           pop    h7
    2483    2151   00A50                  
    2484    2152   00A50 D0D0                           pop    psw                  ;registers herstellen
    2485    2153   00A52 D0E0                           pop    acc
    2486    2154   00A54 22                             ret
    2487    2155   00A55                  
    2488    2156   00A55                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2489    2157   00A55                  ;
    2490    2158   00A55                  ; hexbcd8     zet een 8 bit hex getal om in een 8 bit bcd getal
    2491    2159   00A55                  ; input       a (maximale waarde = 63h)
    2492    2160   00A55                  ; output      a
    2493    2161   00A55                  ;
    2494    2162   00A55                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2495    2163   00A55                  
    2496    2164   00A55 C0D0             hexbcd8:      push   psw                  ;registers op stack zetten
    2497    2165   00A57 C0F0                           push   b
    2498    2166   00A59 75F00A                         mov    b,#00ah              ;hierdoor delen
    2499    2167   00A5C 84                             div    ab                   ;in accu qoutient in b rest
    2500    2168   00A5D C4                             swap   a
    2501    2169   00A5E 25F0                           add    a,b                  ;bcd getal klaar
    2502    2170   00A60 D0F0                           pop    b
    2503    2171   00A62 D0D0                           pop    psw
    2504    2172   00A64 22                             ret
    2505    2173   00A65                  
    2506    2174   00A65                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2507    2175   00A65                  ;
    2508    2176   00A65                  ; bcdhex16    zal een 16 bit bcd getal omzetten naar een hex getal.
    2509    2177   00A65                  ; input:       r1,r0 = 16 bit bcd getal (r1=msb)
    2510    2178   00A65                  ; output:      r1,r0 = 16 bit hex getal (r1=msb)
    2511    2179   00A65                  ;
    2512    2180   00A65                  ; de routine gebruikt r1,r0 van de huidige bank
    2513    2181   00A65                  ;
    2514    2182   00A65                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2515    2183   00A65                  
    2516    2184   00A65 C0F0             bcdhex16:     push   b                    ;hebben we nodig
    2517    2185   00A67 C0E0                           push   acc
    2518    2186   00A69 C0D0                           push   psw
    2519    2187   00A6B                  
    2520    2188   00A6B E8                             mov    a,r0
    2521    2189   00A6C 540F                           anl    a,#00fh              ;eenheden
    2522    2190   00A6E C0E0                           push   acc                  ;effe bewaren
    2523    2191   00A70                  
    2524    2192   00A70 E8                             mov    a,r0
    2525    2193   00A71 C4                             swap   a
    2526    2194   00A72 540F                           anl    a,#00fh              ;tientallen
    2527    2195   00A74 75F00A                         mov    b,#00ah              ;waarde berekenen
    2528    2196   00A77 A4                             mul    ab                   ;klaar
    2529    2197   00A78 D0F0                           pop    b                    ;truukje
    2530    2198   00A7A 25F0                           add    a,b                  ;a is lage deel hex getal
    2531    2199   00A7C C0E0                           push   acc                  ;straks nodig
    2532    2200   00A7E                  
    2533    2201   00A7E E9                             mov    a,r1                 ;hoge deel
    2534    2202   00A7F 54F0                           anl    a,#0f0h
    2535    2203   00A81 C4                             swap   a
    2536    2204   00A82 C0E0                           push   acc                  ;straks nodig
    2537    2205   00A84                  
    2538    2206   00A84 E9                             mov    a,r1
    2539    2207   00A85 540F                           anl    a,#00fh              ;gaan we verder bewerken
    2540    2208   00A87 75F064                         mov    b,#100               ;waarde uitrekenen
    2541    2209   00A8A A4                             mul    ab
    2542    2210   00A8B A9F0                           mov    r1,b
    2543    2211   00A8D F8                             mov    r0,a
    2544    2212   00A8E                  
    2545    2213   00A8E D0E0                           pop    acc
    2546    2214   00A90 75F00A                         mov    b,#10
    2547    2215   00A93 A4                             mul    ab                   ;kan nog in a
    2548    2216   00A94 75F064                         mov    b,#100               ;*10*100=*1000
    2549    2217   00A97 A4                             mul    ab
    2550    2218   00A98 28                             add    a,r0
    2551    2219   00A99 F8                             mov    r0,a
    2552    2220   00A9A E9                             mov    a,r1
    2553    2221   00A9B 35F0                           addc   a,b
    2554    2222   00A9D F9                             mov    r1,a
    2555    2223   00A9E                  
    2556    2224   00A9E D0E0                           pop    acc
    2557    2225   00AA0 28                             add    a,r0
    2558    2226   00AA1 F8                             mov    r0,a
    2559    2227   00AA2 7400                           mov    a,#000h
    2560    2228   00AA4 39                             addc   a,r1
    2561    2229   00AA5 F9                             mov    r1,a                 ;klaar
    2562    2230   00AA6                  
    2563    2231   00AA6 D0D0                           pop    psw
    2564    2232   00AA8 D0E0                           pop    acc
    2565    2233   00AAA D0F0                           pop    b
    2566    2234   00AAC 22                             ret
    2567    2235   00AAD                  
    2568    2236   00AAD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2569    2237   00AAD                  ;
    2570    2238   00AAD                  ; bcdhex8     zal een 8 bit bcd getal omzetten naar een hex getal.
    2571    2239   00AAD                  ; input:      a (maximale waarde 99h)
    2572    2240   00AAD                  ; output:     a
    2573    2241   00AAD                  ;
    2574    2242   00AAD                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2575    2243   00AAD                  
    2576    2244   00AAD C0D0             bcdhex8:      push   psw                  ;registers op de stack zetten
    2577    2245   00AAF C0F0                           push   b
    2578    2246   00AB1 C070                           push   h0
    2579    2247   00AB3 F570                           mov    h0,a                 ;effe bewaren
    2580    2248   00AB5 53700F                         anl    h0,#00fh             ;alleen 4 laagste bits
    2581    2249   00AB8 54F0                           anl    a,#0f0h              ;hier alleen 4 hoogste bits
    2582    2250   00ABA C4                             swap   a
    2583    2251   00ABB 75F00A                         mov    b,#00ah              ;berekenen waarde 4 hoogste bits
    2584    2252   00ABE A4                             mul    ab
    2585    2253   00ABF 2570                           add    a,h0                 ;eenheden bijtellen
    2586    2254   00AC1 D070                           pop    h0
    2587    2255   00AC3 D0F0                           pop    b
    2588    2256   00AC5 D0D0                           pop    psw
    2589    2257   00AC7 22                             ret
    2590    2258   00AC8                  
    2591    2259   00AC8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2592    2260   00AC8                  ;
    2593    2261   00AC8                  ; xcsw2xtal          schakeld overvan de inwendige oscillator naar een extern kristal.
    2594    2262   00AC8                  ;
    2595    2263   00AC8                  ; Gebruikt geen registers
    2596    2264   00AC8                  ;
    2597    2265   00AC8                  ; Originele auteur: Danny Pawels (dp)
    2598    2266   00AC8                  ;
    2599    2267   00AC8                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2600    2268   00AC8                  
    2601    2269   00AC8                  
    2602    2270   00AC8 C083             XCsw2xtal:  push  dph
    2603    2271   00ACA C082                         push  dpl
    2604    2272   00ACC C0D0                         push  psw
    2605    2273   00ACE C08F                         push  syscon0
    2606    2274   00AD0 C0B2                         push  port_page
    2607    2275   00AD2 C0BF                         push  scu_page
    2608    2276   00AD4                  
    2609    2277   00AD4 758F04                       mov   syscon0,#04h            ;selecteer RMAP0
    2610    2278   00AD7 75BF01                       mov   scu_page,#1             ;page 1 van SCU selecteren
    2611    2279   00ADA                  
    2612    2280   00ADA 43B708                       orl   pll_con,#00001000b      ;VCOBYP=1  bypass de PLL
    2613    2281   00ADD                                                            ;freq= VCO-free running =5MHz...20MHz?
    2614    2282   00ADD 43B704                       orl   pll_con,#00000100b      ;OSCDISC=1 disconnect osc. en PLL
    2615    2283   00AE0 53B6F7                       anl   osc_con,#11110111b      ;XPD=0  externe osc. power-up
    2616    2284   00AE3 43B604                       orl   osc_con,#00000100b      ;OSCSS=1 externe oscillator selecteren
    2617    2285   00AE6                  
    2618    2286   00AE6 90F000                       mov   dptr,#0f000h            ;wacht tot externe osc stabiel is...
    2619    2287   00AE9 A3               XCsw2xtal0: inc   dptr
    2620    2288   00AEA E582                         mov   a,dpl
    2621    2289   00AEC 4583                         orl   a,dph
    2622    2290   00AEE 70F9                         jnz   XCsw2xtal0
    2623    2291   00AF0                  
    2624    2292   00AF0 43B602           XCsw2xtal1: orl   osc_con,#00000010b      ;ORDRES=1 osc run detectie starten
    2625    2293   00AF3                  
    2626    2294   00AF3                  ;wacht,...dit kan lang duren... tot >2048 VCO cycli...
    2627    2295   00AF3 E5B6             XCsw2xtal2: mov   a,osc_con               ;check OSCR en ORDRES bits (2 LSB's osc_con)
    2628    2296   00AF5 20E1FB                       jb    acc.1,XCsw2xtal2        ;Osc.RunDETect klaar? ='0'
    2629    2297   00AF8                  ;Oscillator run detectie is klaar...
    2630    2298   00AF8 30E0F5                       jnb    acc.0,XCsw2xtal1       ;OSCR=1? ja, dan oscillator running...
    2631    2299   00AFB                  
    2632    2300   00AFB                  
    2633    2301   00AFB E5B7                         mov   a,pll_con               ;lees pll_con
    2634    2302   00AFD 540F                         anl   a,#0fh                  ;maskeer onderste bits
    2635    2303   00AFF 44A0                         orl   a,#10100000b            ;stel NDIV in op 1010=waarde 24
    2636    2304   00B01                  ;OPGELET: het password moet worden gegeven, dan kan er gedurende 32cclk cycli naar
    2637    2305   00B01                  ;beveiligde locaties worden geschreven zoals NDIV en KDIV van de PLL, de watchdog
    2638    2306   00B01                  ;enable bit WDTEN en de power-down en slow down enable bits PD en SD !!!!
    2639    2307   00B01 75BB98                       mov   passwd,#98h             ;het is nodig het password in te stellen!!!
    2640    2308   00B04                                                            ;bij aanpassing van de NDIV van de PLL
    2641    2309   00B04 F5B7                         mov   pll_con,a               ;N=24 is nodig bij een 8MHz xtal
    2642    2310   00B06 53B7FB                       anl   pll_con,#11111011b      ;OSCDISC=0 connect osc en PLL
    2643    2311   00B09 43B702                       orl   pll_con,#00000010b      ;RESLD=1 restart PLL lock detection
    2644    2312   00B0C                  
    2645    2313   00B0C E5B7             XCsw2xtal3: mov   a,pll_con               ;check de LOCK bit (lsb van dit register)
    2646    2314   00B0E 20E0FB                       jb    acc.0,XCsw2xtal3        ;ga pas verder als PLL gelocked is op osc.
    2647    2315   00B11                  
    2648    2316   00B11 53B7F7                       anl   pll_con,#11110111b      ;VCOBYP=0 fsys is PLL gelockte frequentie.
    2649    2317   00B14 43B610                       orl   osc_con,#00010000b      ;OSCPD=1 interne osc. power-down
    2650    2318   00B17                  
    2651    2319   00B17 D0BF                         pop   scu_page                ;herstel controller status
    2652    2320   00B19 D0B2                         pop   port_page
    2653    2321   00B1B D08F                         pop   syscon0
    2654    2322   00B1D D0D0                         pop   psw
    2655    2323   00B1F D082                         pop   dpl
    2656    2324   00B21 D083                         pop   dph
    2657    2325   00B23 22                           ret
    2658    2326   00B24                  
    2659    2327   00B24                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2660    2328   00B24                  ;
    2661    2329   00B24                  ; mapregs	selecteer de SFR's in de mapped area
    2662    2330   00B24                  ;
    2663    2331   00B24                  ;
    2664    2332   00B24                  ; Past syscon SFR aan
    2665    2333   00B24                  ;
    2666    2334   00B24                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2667    2335   00B24                  
    2668    2336   00B24 438F01           mapregs:	orl   syscon0,#00000001b	;set bit rmap
    2669    2337   00B27 22               		ret
    2670    2338   00B28                  
    2671    2339   00B28                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2672    2340   00B28                  ;
    2673    2341   00B28                  ; nomapregs	selecteer de SFR's in de non-mapped area
    2674    2342   00B28                  ;
    2675    2343   00B28                  ; Past syscon SFR aan
    2676    2344   00B28                  ;
    2677    2345   00B28                  ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    2678    2346   00B28                  
    2679    2347   00B28 538FFE           nomapregs:  anl    syscon0,#11111110b	;clear bit rmap
    2680    2348   00B2B 22               		ret
    2681    2349   00B2C                  
    2682    2350   00B2C                  ;*******************************************************************************
    2683    2351   00B2C                  ;
    2684    2352   00B2C                  ; These are the register declarations for the XC888 microcontroller from
    2685    2353   00B2C                  ; Infineon.
    2686    2354   00B2C                  ;
    2687    2355   00B2C                  ;*******************************************************************************
    2688    2356   00B2C                  
    2689    2357   00B2C                  ;*******************************************************************************
    2690    2358   00B2C                  ;
    2691    2359   00B2C                  ; CPU registers are accessible independend of paging and mapping
    2692    2360   00B2C                  ; (always accessible)
    2693    2361   00B2C                  ;
    2694    2362   00B2C                  ;*******************************************************************************
    2695    2363   00B2C                  
    2696    2364   00B2C                  sp            data   081h          ;stack pointer                     reset=007h
    2697    2365   00B2C                  dpl           data   082h          ;datapointer low register          reset=000h
    2698    2366   00B2C                  dph           data   083h          ;datapointer high register         reset=000h
    2699    2367   00B2C                  pcon          data   087h          ;power control                     reset=000h
    2700    2368   00B2C                  tcon          data   088h          ;timer 0-1 control                 reset=000h
    2701    2369   00B2C                  ;tcon is bit addressable
    2702    2370   00B2C                         tf1    bit    08fh
    2703    2371   00B2C                         tr1    bit    08eh
    2704    2372   00B2C                         tf0    bit    08dh
    2705    2373   00B2C                         tr0    bit    08ch
    2706    2374   00B2C                         ie1    bit    08bh
    2707    2375   00B2C                         it1    bit    08ah
    2708    2376   00B2C                         ie0    bit    089h
    2709    2377   00B2C                         it0    bit    088h
    2710    2378   00B2C                  
    2711    2379   00B2C                  tmod          data   089h          ;timer 0-1 mode                    reset=000h
    2712    2380   00B2C                  tl0           data   08ah          ;timer 0 low                       reset=000h
    2713    2381   00B2C                  tl1           data   08bh          ;timer 1 low                       reset=000h
    2714    2382   00B2C                  th0           data   08ch          ;timer 0 high                      reset=000h
    2715    2383   00B2C                  th1           data   08dh          ;timer 1 high                      reset=000h
    2716    2384   00B2C                  
    2717    2385   00B2C                  syscon0       data   08fh          ;system control register 0         reset=004h
    2718    2386   00B2C                  scon          data   098h          ;serial channel 0 control          reset=000h
    2719    2387   00B2C                  ;scon is bit addressable
    2720    2388   00B2C                         sm0    bit    09fh
    2721    2389   00B2C                         sm1    bit    09eh
    2722    2390   00B2C                         sm2    bit    09dh
    2723    2391   00B2C                         ren    bit    09ch
    2724    2392   00B2C                         tb8    bit    09bh
    2725    2393   00B2C                         rb8    bit    09ah
    2726    2394   00B2C                         ti     bit    099h
    2727    2395   00B2C                         ri     bit    098h
    2728    2396   00B2C                  
    2729    2397   00B2C                  sbuf          data   099h          ;serial data buffer channel 0
    2730    2398   00B2C                  eo            data   0a2h          ;extended operation                reset=000h
    2731    2399   00B2C                  ien0          data   0a8h          ;interrupt enable 0                reset=000h
    2732    2400   00B2C                  ;ien0 is bit addressable
    2733    2401   00B2C                         ea     bit    0afh
    2734    2402   00B2C                                                     ;bit not implemented
    2735    2403   00B2C                         et2    bit    0adh
    2736    2404   00B2C                         es     bit    0ach
    2737    2405   00B2C                         et1    bit    0abh
    2738    2406   00B2C                         ex1    bit    0aah
    2739    2407   00B2C                         et0    bit    0a9h
    2740    2408   00B2C                         ex0    bit    0a8h
    2741    2409   00B2C                  
    2742    2410   00B2C                  ip            data   0b8h          ;interrupt priotity                reset=000h
    2743    2411   00B2C                  ;ip is bit addressable
    2744    2412   00B2C                                                     ;bit not implemented
    2745    2413   00B2C                                                     ;bit not implemented
    2746    2414   00B2C                         pt2    bit    0bdh
    2747    2415   00B2C                         ps     bit    0bch
    2748    2416   00B2C                         pt1    bit    0bbh
    2749    2417   00B2C                         px1    bit    0bah
    2750    2418   00B2C                         pt0    bit    0b9h
    2751    2419   00B2C                         px0    bit    0b8h
    2752    2420   00B2C                  
    2753    2421   00B2C                  iph           data   0b9h          ;interrupt priority high           reset=000h
    2754    2422   00B2C                  psw           data   0d0h          ;program status word               reset=000h
    2755    2423   00B2C                  ;psw is bit addressable
    2756    2424   00B2C                         cy     bit    0d7h
    2757    2425   00B2C                         ac     bit    0d6h
    2758    2426   00B2C                         f0     bit    0d5h
    2759    2427   00B2C                         rs1    bit    0d4h
    2760    2428   00B2C                         rs0    bit    0d3h
    2761    2429   00B2C                         ov     bit    0d2h
    2762    2430   00B2C                         f1     bit    0d1h
    2763    2431   00B2C                         p      bit    0d0h
    2764    2432   00B2C                  
    2765    2433   00B2C                  acc           data   0e0h          ;accumulator                       reset=000h
    2766    2434   00B2C                  ;acc is bit addressable
    2767    2435   00B2C                  
    2768    2436   00B2C                  ien1          data   0e8h          ;interrupt enable 1                reset=000h
    2769    2437   00B2C                  ;ien1 is bit addressable
    2770    2438   00B2C                         eccip3 bit    0efh
    2771    2439   00B2C                         eccip2 bit    0eeh
    2772    2440   00B2C                         eccip1 bit    0edh
    2773    2441   00B2C                         eccip0 bit    0ech
    2774    2442   00B2C                         exm    bit    0ebh
    2775    2443   00B2C                         ex2    bit    0eah
    2776    2444   00B2C                         essc   bit    0e9h
    2777    2445   00B2C                         eadc   bit    0e8h
    2778    2446   00B2C                  
    2779    2447   00B2C                  b             data   0f0h          ;b register                        reset=000h
    2780    2448   00B2C                  ;b is bit addressable
    2781    2449   00B2C                  
    2782    2450   00B2C                  ip1           data   0f8h          ;interrupt priority 1              reset=000h
    2783    2451   00B2C                  ;ip1 is bit addressable
    2784    2452   00B2C                         pccip3 bit    0ffh
    2785    2453   00B2C                         pccip2 bit    0feh
    2786    2454   00B2C                         pccip1 bit    0fdh
    2787    2455   00B2C                         pccip0 bit    0fch
    2788    2456   00B2C                         pxm    bit    0fbh
    2789    2457   00B2C                         px2    bit    0fah
    2790    2458   00B2C                         pssc   bit    0f9h
    2791    2459   00B2C                         padc   bit    0f8h
    2792    2460   00B2C                  
    2793    2461   00B2C                  iph1          data   0f9h          ;interrupt priority 1 high         reset=000h
    2794    2462   00B2C                  
    2795    2463   00B2C                  
    2796    2464   00B2C                  ;*******************************************************************************
    2797    2465   00B2C                  ;
    2798    2466   00B2C                  ; system control registers registers that can only be accessed in the non
    2799    2467   00B2C                  ; mapped memory area (rmap=0) page independent
    2800    2468   00B2C                  ;
    2801    2469   00B2C                  ;*******************************************************************************
    2802    2470   00B2C                  
    2803    2471   00B2C                  scu_page      data   0bfh          ;page register scu                 reset=000h
    2804    2472   00B2C                  
    2805    2473   00B2C                  ;*******************************************************************************
    2806    2474   00B2C                  ;
    2807    2475   00B2C                  ; system control registers registers that can only be accessed in the non
    2808    2476   00B2C                  ; mapped memory area (rmap=0) and page 0
    2809    2477   00B2C                  ;
    2810    2478   00B2C                  ;*******************************************************************************
    2811    2479   00B2C                  
    2812    2480   00B2C                  modpisel      data   0b3h          ;peripheral input select           reset=000h
    2813    2481   00B2C                  ircon0        data   0b4h          ;interrupt request register        reset=000h
    2814    2482   00B2C                  ircon1        data   0b5h          ;interrupt request register        reset=000h
    2815    2483   00B2C                  ircon2        data   0b6h          ;interrupt request register        reset=000h
    2816    2484   00B2C                  exicon0       data   0b7h          ;external interrupt control        reset=0f0h
    2817    2485   00B2C                  exicon1       data   0bah          ;external interrupt control        reset=03fh
    2818    2486   00B2C                  nmicon        data   0bbh          ;nimi control                      reset=000h
    2819    2487   00B2C                  nmisr         data   0bch          ;nmi status                        reset=000h
    2820    2488   00B2C                  bcon          data   0bdh          ;baud rate control                 reset=000h
    2821    2489   00B2C                  bg            data   0beh          ;baud rate timer reload            reset=000h
    2822    2490   00B2C                  fdcon         data   0e9h          ;fractional devider control        reset=000h
    2823    2491   00B2C                  fdstep        data   0eah          ;fractional devider reload         reset=000h
    2824    2492   00B2C                  fdres         data   0ebh          ;fractional divider result         reset=000h
    2825    2493   00B2C                  
    2826    2494   00B2C                  ;*******************************************************************************
    2827    2495   00B2C                  ;
    2828    2496   00B2C                  ; system control registers registers that can only be accessed in the non
    2829    2497   00B2C                  ; mapped memory area (rmap=0) and page 1
    2830    2498   00B2C                  ;
    2831    2499   00B2C                  ;*******************************************************************************
    2832    2500   00B2C                  
    2833    2501   00B2C                  id            data   0b3h          ;identity register     reset=device dependent
    2834    2502   00B2C                  pmcon0        data   0b4h          ;power mode control                reset=000h
    2835    2503   00B2C                  pmcon1        data   0b5h          ;power mode control                reset=000h
    2836    2504   00B2C                  osc_con       data   0b6h          ;osc control                       reset=008h
    2837    2505   00B2C                  pll_con       data   0b7h          ;pll control                       reset=090h
    2838    2506   00B2C                  cmcon         data   0bah          ;clock control                     reset=010h
    2839    2507   00B2C                  passwd        data   0bbh          ;password register                 reset=007h
    2840    2508   00B2C                  feal          data   0bch          ;flash error register              reset=000h
    2841    2509   00B2C                  feah          data   0bdh          ;flash error address high          reset=000h
    2842    2510   00B2C                  cocon         data   0beh          ;clock output control              reset=000h
    2843    2511   00B2C                  misc_con      data   0e9h          ;miscellaneous control             reset=000h
    2844    2512   00B2C                  
    2845    2513   00B2C                  ;*******************************************************************************
    2846    2514   00B2C                  ;
    2847    2515   00B2C                  ; system control registers registers that can only be accessed in the non
    2848    2516   00B2C                  ; mapped memory area (rmap=0) and page 3
    2849    2517   00B2C                  ;
    2850    2518   00B2C                  ;*******************************************************************************
    2851    2519   00B2C                  
    2852    2520   00B2C                  xaddrh        data   0b3h          ;on chip xram address high         reset=0f0h
    2853    2521   00B2C                  ircon3        data   0b4h          ;interrupt request register        reset=000h
    2854    2522   00B2C                  ircon4        data   0b5h          ;interrupt request register        reset=000h
    2855    2523   00B2C                  modpisel1     data   0b7h          ;peripheral input select 1         reset=000h
    2856    2524   00B2C                  modpisel2     data   0bah          ;peripheral input select 2         reset=000h
    2857    2525   00B2C                  pmcon2        data   0bbh          ;power mode control 2              reset=000h
    2858    2526   00B2C                  modsusp       data   0bdh          ;mudule suspend control            reset=001h
    2859    2527   00B2C                  
    2860    2528   00B2C                  ;*******************************************************************************
    2861    2529   00B2C                  ;
    2862    2530   00B2C                  ; port registers accessed in non mapped memory area (rmap=0) page independent
    2863    2531   00B2C                  ;
    2864    2532   00B2C                  ;*******************************************************************************
    2865    2533   00B2C                  
    2866    2534   00B2C                  port_page     data   0b2h          ;port page register                reset=000h
    2867    2535   00B2C                  
    2868    2536   00B2C                  ;*******************************************************************************
    2869    2537   00B2C                  ;
    2870    2538   00B2C                  ; port registers accessed in non mapped memory area (rmap=0) page 0
    2871    2539   00B2C                  ;
    2872    2540   00B2C                  ;*******************************************************************************
    2873    2541   00B2C                  
    2874    2542   00B2C                  p0_data       data   080h          ;port 0 data register              reset=000h
    2875    2543   00B2C                  ;p0_data is bit addressable
    2876    2544   00B2C                  p0_dir        data   086h          ;port 0 direction register         reset=000h
    2877    2545   00B2C                  p1_data       data   090h          ;port 1 data register              reset=000h
    2878    2546   00B2C                  ;p1_data is bit addressable
    2879    2547   00B2C                  p1_dir        data   091h          ;port 1 direction register         reset=000h
    2880    2548   00B2C                  p2_data       data   0a0h          ;port 2 data register              reset=000h
    2881    2549   00B2C                  ;p2_data is bit addressable
    2882    2550   00B2C                  p2_dir        data   0a1h          ;port 2 direction register         reset=000h
    2883    2551   00B2C                  p3_data       data   0b0h          ;port 3 data register              reset=000h
    2884    2552   00B2C                  ;p3_data is bit addressable
    2885    2553   00B2C                  p3_dir        data   0b1h          ;port 3 direction register         reset=000h
    2886    2554   00B2C                  p4_data       data   0c8h          ;port 4 data register              reset=000h
    2887    2555   00B2C                  ;p4_data is bit addressable
    2888    2556   00B2C                  p4_dir        data   0c9h          ;port 4 direction register         reset=000h
    2889    2557   00B2C                  p5_data       data   092h          ;port 5 data register              reset=000h
    2890    2558   00B2C                  p5_dir        data   093h          ;port 5 direction register         reset=000h
    2891    2559   00B2C                  
    2892    2560   00B2C                  ;*******************************************************************************
    2893    2561   00B2C                  ;
    2894    2562   00B2C                  ; port registers accessed in non mapped memory area (rmap=0) page 1
    2895    2563   00B2C                  ;
    2896    2564   00B2C                  ;*******************************************************************************
    2897    2565   00B2C                  
    2898    2566   00B2C                  p0_pudsel     data   080h          ;port 0 pull-up/down select        reset=0ffh
    2899    2567   00B2C                  ;p0_data is bit addressable
    2900    2568   00B2C                  p0_puden      data   086h          ;port 0 pull-up/down enable        reset=0c4h
    2901    2569   00B2C                  p1_pudsel     data   090h          ;port 1 pull-up/down select        reset=0ffh
    2902    2570   00B2C                  ;p1_data is bit addressable
    2903    2571   00B2C                  p1_puden      data   091h          ;port 1 pull-up/down enable        reset=0ffh
    2904    2572   00B2C                  p2_pudsel     data   0a0h          ;port 2 pull-up/down select        reset=0ffh
    2905    2573   00B2C                  ;p2_data is bit addressable
    2906    2574   00B2C                  p2_puden      data   0a1h          ;port 2 pull-up/down enable        reset=000h
    2907    2575   00B2C                  p3_pudsel     data   0b0h          ;port 3 pull-up/down select        reset=0bfh
    2908    2576   00B2C                  ;p3_data is bit addressable
    2909    2577   00B2C                  p3_puden      data   0b1h          ;port 3 pull-up/down enable        reset=040h
    2910    2578   00B2C                  p4_pudsel     data   0c8h          ;port 4 pull-up/down select        reset=0ffh
    2911    2579   00B2C                  ;p4_data is bit addressable
    2912    2580   00B2C                  p4_puden      data   0c9h          ;port 4 pull-up/down enable        reset=004h
    2913    2581   00B2C                  p5_pudsel     data   092h          ;port 5 pull-up/down select        reset=0ffh
    2914    2582   00B2C                  p5_puden      data   093h          ;port 5 pull-up/down enable        reset=0ffh
    2915    2583   00B2C                  
    2916    2584   00B2C                  ;*******************************************************************************
    2917    2585   00B2C                  ;
    2918    2586   00B2C                  ; port registers accessed in non mapped memory area (rmap=0) page 2
    2919    2587   00B2C                  ;
    2920    2588   00B2C                  ;*******************************************************************************
    2921    2589   00B2C                  
    2922    2590   00B2C                  p0_altsel0    data   080h          ;port 0 alternate select           reset=000h
    2923    2591   00B2C                  ;p0_data is bit addressable
    2924    2592   00B2C                  p0_altsel1    data   086h          ;port 0 alternate select           reset=000h
    2925    2593   00B2C                  p1_altsel0    data   090h          ;port 1 alternate select           reset=000h
    2926    2594   00B2C                  ;p1_data is bit addressable
    2927    2595   00B2C                  p1_altsel1    data   091h          ;port 1 alternate select           reset=000h
    2928    2596   00B2C                  p3_altsel0    data   0b0h          ;port 3 alternate select           reset=000h
    2929    2597   00B2C                  ;p3_data is bit addressable
    2930    2598   00B2C                  p3_altsel1    data   0b1h          ;port 3 alternate select           reset=000h
    2931    2599   00B2C                  p4_altsel0    data   0c8h          ;port 4 alternate select           reset=000h
    2932    2600   00B2C                  ;p4_data is bit addressable
    2933    2601   00B2C                  p4_altsel1    data   0c9h          ;port 4 alternate select           reset=000h
    2934    2602   00B2C                  p5_altsel0    data   092h          ;port 5 alternate select           reset=000h
    2935    2603   00B2C                  p5_altsel1    data   093h          ;port 5 alternate select           reset=000h
    2936    2604   00B2C                  
    2937    2605   00B2C                  ;*******************************************************************************
    2938    2606   00B2C                  ;
    2939    2607   00B2C                  ; port registers accessed in non mapped memory area (rmap=0) page 3
    2940    2608   00B2C                  ;
    2941    2609   00B2C                  ;*******************************************************************************
    2942    2610   00B2C                  
    2943    2611   00B2C                  p0_od         data   080h          ;port 0 open drain control         reset=000h
    2944    2612   00B2C                  ;p0_data is bit addressable
    2945    2613   00B2C                  p1_od         data   090h          ;port 0 open drain control         reset=000h
    2946    2614   00B2C                  ;p1_data is bit addressable
    2947    2615   00B2C                  p3_od         data   0b0h          ;port 0 open drain control         reset=000h
    2948    2616   00B2C                  ;p3_data is bit addressable
    2949    2617   00B2C                  p4_od         data   0c8h          ;port 0 open drain control         reset=000h
    2950    2618   00B2C                  ;p4_data is bit addressable
    2951    2619   00B2C                  p5_od         data   092h          ;port 0 open drain control         reset=000h
    2952    2620   00B2C                  
    2953    2621   00B2C                  ;*******************************************************************************
    2954    2622   00B2C                  ;
    2955    2623   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page independent
    2956    2624   00B2C                  ;
    2957    2625   00B2C                  ;*******************************************************************************
    2958    2626   00B2C                  
    2959    2627   00B2C                  adc_page      data   0d1h          ;adc page register                 reset=000h
    2960    2628   00B2C                  
    2961    2629   00B2C                  ;*******************************************************************************
    2962    2630   00B2C                  ;
    2963    2631   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 0
    2964    2632   00B2C                  ;
    2965    2633   00B2C                  ;*******************************************************************************
    2966    2634   00B2C                  
    2967    2635   00B2C                  adc_globctr   data   0cah          ;global control register           reset=030h
    2968    2636   00B2C                  adc_globstr   data   0cbh          ;global status register            reset=000h
    2969    2637   00B2C                  adc_prar      data   0cch          ;priority and arbitration          reset=000h
    2970    2638   00B2C                  adc_lcbr      data   0cdh          ;limit check boundary              reset=0b7h
    2971    2639   00B2C                  adc_inpcr0    data   0ceh          ;input class 0 register            reset=000h
    2972    2640   00B2C                  adc_etrcr     data   0cfh          ;external trigger control          reset=000h
    2973    2641   00B2C                  
    2974    2642   00B2C                  ;*******************************************************************************
    2975    2643   00B2C                  ;
    2976    2644   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 1
    2977    2645   00B2C                  ;
    2978    2646   00B2C                  ;*******************************************************************************
    2979    2647   00B2C                  
    2980    2648   00B2C                  adc_chctr0    data   0cah          ;channel control register          reset=000h
    2981    2649   00B2C                  adc_chctr1    data   0cbh          ;channel control register          reset=000h
    2982    2650   00B2C                  adc_chctr2    data   0cch          ;channel control register          reset=000h
    2983    2651   00B2C                  adc_chctr3    data   0cdh          ;channel control register          reset=000h
    2984    2652   00B2C                  adc_chctr4    data   0ceh          ;channel control register          reset=000h
    2985    2653   00B2C                  adc_chctr5    data   0cfh          ;channel control register          reset=000h
    2986    2654   00B2C                  adc_chctr6    data   0d2h          ;channel control register          reset=000h
    2987    2655   00B2C                  adc_chctr7    data   0d3h          ;channel control register          reset=000h
    2988    2656   00B2C                  
    2989    2657   00B2C                  ;*******************************************************************************
    2990    2658   00B2C                  ;
    2991    2659   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 2
    2992    2660   00B2C                  ;
    2993    2661   00B2C                  ;*******************************************************************************
    2994    2662   00B2C                  
    2995    2663   00B2C                  adc_resr0l    data   0cah          ;result register 0 low             reset=000h
    2996    2664   00B2C                  adc_resr0h    data   0cbh          ;result register 0 high            reset=000h
    2997    2665   00B2C                  adc_resr1l    data   0cch          ;result register 1 low             reset=000h
    2998    2666   00B2C                  adc_resr1h    data   0cdh          ;result register 1 high            reset=000h
    2999    2667   00B2C                  adc_resr2l    data   0ceh          ;result register 2 low             reset=000h
    3000    2668   00B2C                  adc_resr2h    data   0cfh          ;result register 2 high            reset=000h
    3001    2669   00B2C                  adc_resr3l    data   0d2h          ;result register 3 low             reset=000h
    3002    2670   00B2C                  adc_resr3h    data   0d3h          ;result register 3 high            reset=000h
    3003    2671   00B2C                  
    3004    2672   00B2C                  ;*******************************************************************************
    3005    2673   00B2C                  ;
    3006    2674   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 3
    3007    2675   00B2C                  ;
    3008    2676   00B2C                  ;*******************************************************************************
    3009    2677   00B2C                  
    3010    2678   00B2C                  adc_resra0l   data   0cah          ;result register 0 l view          reset=000h
    3011    2679   00B2C                  adc_resra0h   data   0cbh          ;result register 0 h view          reset=000h
    3012    2680   00B2C                  adc_resra1l   data   0cch          ;result register 1 l view          reset=000h
    3013    2681   00B2C                  adc_resra1h   data   0cdh          ;result register 1 h view          reset=000h
    3014    2682   00B2C                  adc_resra2l   data   0ceh          ;result register 2 l view          reset=000h
    3015    2683   00B2C                  adc_resra2h   data   0cfh          ;result register 2 h view          reset=000h
    3016    2684   00B2C                  adc_resra3l   data   0d2h          ;result register 3 l view          reset=000h
    3017    2685   00B2C                  adc_resra3h   data   0d3h          ;result register 3 h view          reset=000h
    3018    2686   00B2C                  
    3019    2687   00B2C                  ;*******************************************************************************
    3020    2688   00B2C                  ;
    3021    2689   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 4
    3022    2690   00B2C                  ;
    3023    2691   00B2C                  ;*******************************************************************************
    3024    2692   00B2C                  
    3025    2693   00B2C                  adc_rcr0      data   0cah          ;result control register           reset=000h
    3026    2694   00B2C                  adc_rcr1      data   0cbh          ;result control register           reset=000h
    3027    2695   00B2C                  adc_rcr2      data   0cch          ;result control register           reset=000h
    3028    2696   00B2C                  adc_rcr3      data   0cdh          ;result control register           reset=000h
    3029    2697   00B2C                  adc_vfcr      data   0ceh          ;valid flag clear register         reset=000h
    3030    2698   00B2C                  
    3031    2699   00B2C                  ;*******************************************************************************
    3032    2700   00B2C                  ;
    3033    2701   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 5
    3034    2702   00B2C                  ;
    3035    2703   00B2C                  ;*******************************************************************************
    3036    2704   00B2C                  
    3037    2705   00B2C                  adc_chinfr    data   0cah          ;channel interrupt flag register   reset=000h
    3038    2706   00B2C                  adc_chincr    data   0cbh          ;channel interrupt clear register  reset=000h
    3039    2707   00B2C                  adc_chinsr    data   0cch          ;channel interrupt set register    reset=000h
    3040    2708   00B2C                  adc_chinpr    data   0cdh          ;channel interrupt node pointrer   reset=000h
    3041    2709   00B2C                  adc_evinfr    data   0ceh          ;event interrupt flag register     reset=000h
    3042    2710   00B2C                  adc_evincr    data   0cfh          ;event interrupt clear flag reg.   reset=000h
    3043    2711   00B2C                  adc_evinsr    data   0d2h          ;event interrupt set flag register reset=000h
    3044    2712   00B2C                  adc_evinpr    data   0d3h          ;event interrupt node pointer reg. reset=000h
    3045    2713   00B2C                  
    3046    2714   00B2C                  ;*******************************************************************************
    3047    2715   00B2C                  ;
    3048    2716   00B2C                  ; adc registers accessed in non mapped memory area (rmap=0) page 6
    3049    2717   00B2C                  ;
    3050    2718   00B2C                  ;*******************************************************************************
    3051    2719   00B2C                  
    3052    2720   00B2C                  adc_crcr1     data   0cah          ;conversion request control        reset=000h
    3053    2721   00B2C                  adc_crpr1     data   0cbh          ;conversion request pending        reset=000h
    3054    2722   00B2C                  adc_crmr1     data   0cch          ;conversion request mode           reset=000h
    3055    2723   00B2C                  adc_qmr0      data   0cdh          ;queue mode                        reset=000h
    3056    2724   00B2C                  adc_qsr0      data   0ceh          ;queue status register             reset=020h
    3057    2725   00B2C                  adc_q0r0      data   0cfh          ;queue 0 register 0                reset=000h
    3058    2726   00B2C                  adc_qbur0     data   0d2h          ;queue backup register             reset=000h
    3059    2727   00B2C                  adc_qinr0     data   0d3h          ;queue input register              reset=000h
    3060    2728   00B2C                  
    3061    2729   00B2C                  ;*******************************************************************************
    3062    2730   00B2C                  
    3063    2731   00B2C                  ; timer 2 registers accessed in non mapped memory area (rmap=0)
    3064    2732   00B2C                  ;
    3065    2733   00B2C                  ;*******************************************************************************
    3066    2734   00B2C                  
    3067    2735   00B2C                  t2_t2con      data   0c0h          ;timer 2 control register          reset=000h
    3068    2736   00B2C                  ;t2_t2con is bit addressable
    3069    2737   00B2C                         tf2    bit    0c7h
    3070    2738   00B2C                         exf2   bit    0c6h
    3071    2739   00B2C                                                     ;2 bits are not implemented
    3072    2740   00B2C                         exen2  bit    0c3h
    3073    2741   00B2C                         tr2    bit    0c2h
    3074    2742   00B2C                         ct2    bit    0c1h
    3075    2743   00B2C                         cprl2  bit    0c0h
    3076    2744   00B2C                  
    3077    2745   00B2C                  t2_t2mod      data   0c1h          ;timer 2 mode register             reset=000h
    3078    2746   00B2C                  t2_rc2l       data   0c2h          ;timer 2 reload/capture low        reset=000h
    3079    2747   00B2C                  t2_rc2h       data   0c3h          ;timer 2 rel/cap high              reset=000h
    3080    2748   00B2C                  t2_t2l        data   0c4h          ;timer 2 register low              reset=000h
    3081    2749   00B2C                  t2_t2h        data   0c5h          ;timer 2 register high             reset=000h
    3082    2750   00B2C                  
    3083    2751   00B2C                  ;*******************************************************************************
    3084    2752   00B2C                  ;
    3085    2753   00B2C                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page independent
    3086    2754   00B2C                  ;
    3087    2755   00B2C                  ;*******************************************************************************
    3088    2756   00B2C                  
    3089    2757   00B2C                  ccu6_page     data   0a3h          ;ccu6 page register                reset=000h
    3090    2758   00B2C                  
    3091    2759   00B2C                  ;*******************************************************************************
    3092    2760   00B2C                  ;
    3093    2761   00B2C                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 0
    3094    2762   00B2C                  ;
    3095    2763   00B2C                  ;*******************************************************************************
    3096    2764   00B2C                  
    3097    2765   00B2C                  ccu6_cc63srl  data   09ah          ;cap/comp shadow channel 63        reset=000h
    3098    2766   00B2C                  ccu6_cc63srh  data   09bh          ;cap/comp shadow channel 63        reset=000h
    3099    2767   00B2C                  ccu6_tctr4l   data   09ch          ;timer control low                 reset=000h
    3100    2768   00B2C                  ccu6_tctr4h   data   09dh          ;timer control high                reset=000h
    3101    2769   00B2C                  ccu6_mcmoutsl data   09eh          ;multichannel mode output shadow   reset=000h
    3102    2770   00B2C                  ccu6_mcmoutsh data   09fh          ;multichannel mode output shadow   reset=000h
    3103    2771   00B2C                  ccu6_isrl     data   0a4h          ;cap/com interrupt status          reset=000h
    3104    2772   00B2C                  ccu6_isrh     data   0a5h          ;cap/com interrupt status          reset=000h
    3105    2773   00B2C                  ccu6_cmpmodifl       data   0a6h   ;compare state modification reg.   reset=000h
    3106    2774   00B2C                  ccu6_cmpmodifh       data   0a7h   ;compare state modification reg.   reset=000h
    3107    2775   00B2C                  ccu6_cc60srl  data   0fah          ;cap/comp shadow channel 60        reset=000h
    3108    2776   00B2C                  ccu6_cc60srh  data   0fbh          ;cap/comp shadow channel 60        reset=000h
    3109    2777   00B2C                  ccu6_cc61srl  data   0fch          ;cap/comp shadow channel 61        reset=000h
    3110    2778   00B2C                  ccu6_cc61srh  data   0fdh          ;cap/comp shadow channel 61        reset=000h
    3111    2779   00B2C                  ccu6_cc62srl  data   0feh          ;cap/comp shadow channel 62        reset=000h
    3112    2780   00B2C                  ccu6_cc62srh  data   0ffh          ;cap/comp shadow channel 62        reset=000h
    3113    2781   00B2C                  
    3114    2782   00B2C                  ;*******************************************************************************
    3115    2783   00B2C                  ;
    3116    2784   00B2C                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 1
    3117    2785   00B2C                  ;
    3118    2786   00B2C                  ;*******************************************************************************
    3119    2787   00B2C                  
    3120    2788   00B2C                  ccu6_cc63rl   data   09ah          ;cap/comp register channel 63      reset=000h
    3121    2789   00B2C                  ccu6_cc63rh   data   09bh          ;cap/comp register channel 63      reset=000h
    3122    2790   00B2C                  ccu6_t12prl   data   09ch          ;timer 12 period register          reset=000h
    3123    2791   00B2C                  ccu6_t12prh   data   09dh          ;timer 12 period register          reset=000h
    3124    2792   00B2C                  ccu6_t13prl   data   09eh          ;timer 13 period register          reset=000h
    3125    2793   00B2C                  ccu6_t13prh   data   09fh          ;timer 13 period register          reset=000h
    3126    2794   00B2C                  ccu6_t12dtcl  data   0a4h          ;timer 12 dead time control        reset=000h
    3127    2795   00B2C                  ccu6_t12dtch  data   0a5h          ;timer 12 dead time control        reset=000h
    3128    2796   00B2C                  ccu6_tctr0l   data   0a6h          ;timer control                     reset=000h
    3129    2797   00B2C                  ccu6_tctr0h   data   0a7h          ;timer control                     reset=000h
    3130    2798   00B2C                  ccu6_cc60rl   data   0fah          ;cap/comp register channel 60      reset=000h
    3131    2799   00B2C                  ccu6_cc60rh   data   0fbh          ;cap/comp register channel 60      reset=000h
    3132    2800   00B2C                  ccu6_cc61rl   data   0fch          ;cap/comp register channel 61      reset=000h
    3133    2801   00B2C                  ccu6_cc61rh   data   0fdh          ;cap/comp register channel 61      reset=000h
    3134    2802   00B2C                  ccu6_cc62rl   data   0feh          ;cap/comp register channel 62      reset=000h
    3135    2803   00B2C                  ccu6_cc62rh   data   0ffh          ;cap/comp register channel 62      reset=000h
    3136    2804   00B2C                  
    3137    2805   00B2C                  ;*******************************************************************************
    3138    2806   00B2C                  ;
    3139    2807   00B2C                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 2
    3140    2808   00B2C                  ;
    3141    2809   00B2C                  ;*******************************************************************************
    3142    2810   00B2C                  
    3143    2811   00B2C                  ccu6_t12msell data   09ah          ;t12 cap/comp mode select          reset=000h
    3144    2812   00B2C                  ccu6_t12mselh data   09bh          ;t12 cap/comp mode select          reset=000h
    3145    2813   00B2C                  ccu6_ienl     data   09ch          ;cap/comp interrupt enable         reset=000h
    3146    2814   00B2C                  ccu6_ienh     data   09dh          ;cap/comp interrupt enable         reset=000h
    3147    2815   00B2C                  ccu6_inpl     data   09eh          ;cap/comp interrupt node pointer   reset=040h
    3148    2816   00B2C                  ccu6_inph     data   09fh          ;cap/comp interrupt node pointer   reset=039h
    3149    2817   00B2C                  ccu6_issl     data   0a4h          ;cap/comp interruopt status        reset=000h
    3150    2818   00B2C                  ccu6_issh     data   0a5h          ;cap/comp interruopt status        reset=000h
    3151    2819   00B2C                  ccu6_pslr     data   0a6h          ;passive state level register      reset=000h
    3152    2820   00B2C                  ccu6_mcmctr   data   0a7h          ;multi channel mode control        reset=000h
    3153    2821   00B2C                  ccu6_tctr2l   data   0fah          ;timer control register            reset=000h
    3154    2822   00B2C                  ccu6_tctr2h   data   0fbh          ;timer control register            reset=000h
    3155    2823   00B2C                  ccu6_modctrl  data   0fch          ;modulation control                reset=000h
    3156    2824   00B2C                  ccu6_modctrh  data   0fdh          ;modulation control                reset=000h
    3157    2825   00B2C                  ccu6_trpctrl  data   0feh          ;trap control register             reset=000h
    3158    2826   00B2C                  ccu6_trpctrh  data   0ffh          ;trap control register             reset=000h
    3159    2827   00B2C                  
    3160    2828   00B2C                  ;*******************************************************************************
    3161    2829   00B2C                  ;
    3162    2830   00B2C                  ; ccu6 registers are accessed in non mapped memory (rmap=0) page 3
    3163    2831   00B2C                  ;
    3164    2832   00B2C                  ;*******************************************************************************
    3165    2833   00B2C                  
    3166    2834   00B2C                  ccu6_mcmoutl  data   09ah          ;multi channel mode output         reset=000h
    3167    2835   00B2C                  ccu6_mcmouth  data   09bh          ;multi channel mode output         reset=000h
    3168    2836   00B2C                  ccu6_isl      data   09ch          ;cap/comp interrupt status         reset=000h
    3169    2837   00B2C                  ccu6_ish      data   09dh          ;cap/comp interrupt status         reset=000h
    3170    2838   00B2C                  ccu6_pisel0l  data   09eh          ;port input selection register     reset=000h
    3171    2839   00B2C                  ccu6_pisel0h  data   09fh          ;port input selection register     reset=000h
    3172    2840   00B2C                  ccu6_pisel2   data   0a4h          ;port input selection register     reset=000h
    3173    2841   00B2C                  ccu6_t12l     data   0fah          ;timer 12 register                 reset=000h
    3174    2842   00B2C                  ccu6_t12h     data   0fbh          ;timer 12 register                 reset=000h
    3175    2843   00B2C                  ccu6_t13l     data   0fch          ;timer 13 register                 reset=000h
    3176    2844   00B2C                  ccu6_t13h     data   0fdh          ;timer 13 register                 reset=000h
    3177    2845   00B2C                  ccu6_cmpstatl data   0feh          ;compare state register            reset=000h
    3178    2846   00B2C                  ccu6_cmpstath data   0ffh          ;compare state register            reset=000h
    3179    2847   00B2C                  
    3180    2848   00B2C                  ;*******************************************************************************
    3181    2849   00B2C                  ;
    3182    2850   00B2C                  ; ssc registers can be accessed in the standard memory map (rmap=0)
    3183    2851   00B2C                  ;
    3184    2852   00B2C                  ;*******************************************************************************
    3185    2853   00B2C                  
    3186    2854   00B2C                  ssc_pisel     data   0a9h          ;port input select                 reset=000h
    3187    2855   00B2C                  ssc_conl      data   0aah          ;control register programming mode reset=000h
    3188    2856   00B2C                  ssc_conh      data   0abh          ;control register programming mode reset=000h
    3189    2857   00B2C                  ssc_tbl       data   0ach          ;transmitter buffer                reset=000h
    3190    2858   00B2C                  ssc_rbl       data   0adh          ;receiver buffer                   reset=000h
    3191    2859   00B2C                  ssc_brl       data   0aeh          ;baud rate timer                   reset=000h
    3192    2860   00B2C                  ssc_brh       data   0afh          ;baud rate timer                   reset=000h
    3193    2861   00B2C                  
    3194    2862   00B2C                  ;*******************************************************************************
    3195    2863   00B2C                  ;
    3196    2864   00B2C                  ; can registers can be accessed in the standard memory map (rmap=0)
    3197    2865   00B2C                  ;
    3198    2866   00B2C                  ;*******************************************************************************
    3199    2867   00B2C                  
    3200    2868   00B2C                  adcon         data   0d8h          ;adres/data control                reset=000h
    3201    2869   00B2C                  ; adcon is bit addressable
    3202    2870   00B2C                         v3     bit    0dfh
    3203    2871   00B2C                         v2     bit    0deh
    3204    2872   00B2C                         v1     bit    0ddh
    3205    2873   00B2C                         v0     bit    0dch
    3206    2874   00B2C                         auad1  bit    0dbh
    3207    2875   00B2C                         auad0  bit    0dah
    3208    2876   00B2C                         can_bsy bit   0d9h
    3209    2877   00B2C                         rwen   bit    0d8h
    3210    2878   00B2C                  
    3211    2879   00B2C                  adl           data   0d9h          ;adres register low                reset=000h
    3212    2880   00B2C                  adh           data   0dah          ;adres register low                reset=000h
    3213    2881   00B2C                  data0         data   0dbh          ;can data                          reset=000h
    3214    2882   00B2C                  data1         data   0dch          ;can data                          reset=000h
    3215    2883   00B2C                  data2         data   0ddh          ;can data                          reset=000h
    3216    2884   00B2C                  data3         data   0deh          ;can data                          reset=000h
    3217    2885   00B2C                  
    3218    2886   00B2C                  ;*******************************************************************************
    3219    2887   00B2C                  ;
    3220    2888   00B2C                  ; mdu registers can only be accessed in the mapped memory area (rmap=1)
    3221    2889   00B2C                  ;
    3222    2890   00B2C                  ;*******************************************************************************
    3223    2891   00B2C                  
    3224    2892   00B2C                  mdustat       data   0b0h          ;mdu status register               reset=000h
    3225    2893   00B2C                  ;mdustat is bit addressable
    3226    2894   00B2C                                                     ;5 bits are not implemented
    3227    2895   00B2C                         bsy    bit    0b2h
    3228    2896   00B2C                         ierr   bit    0b1h
    3229    2897   00B2C                         irdy   bit    0b0h
    3230    2898   00B2C                  
    3231    2899   00B2C                  mducon        data   0b1h          ;mdu control                       reset=000h
    3232    2900   00B2C                  md0           data   0b2h          ;mdu operand register              reset=000h
    3233    2901   00B2C                  mr0           data   0b2h          ;mdu result register               reset=000h
    3234    2902   00B2C                  md1           data   0b3h          ;mdu operand register              reset=000h
    3235    2903   00B2C                  mr1           data   0b3h          ;mdu result register               reset=000h
    3236    2904   00B2C                  md2           data   0b4h          ;mdu operand register              reset=000h
    3237    2905   00B2C                  mr2           data   0b4h          ;mdu result register               reset=000h
    3238    2906   00B2C                  md3           data   0b5h          ;mdu operand register              reset=000h
    3239    2907   00B2C                  mr3           data   0b5h          ;mdu result register               reset=000h
    3240    2908   00B2C                  md4           data   0b6h          ;mdu operand register              reset=000h
    3241    2909   00B2C                  mr4           data   0b6h          ;mdu result register               reset=000h
    3242    2910   00B2C                  md5           data   0b7h          ;mdu operand register              reset=000h
    3243    2911   00B2C                  mr5           data   0b7h          ;mdu result register               reset=000h
    3244    2912   00B2C                  
    3245    2913   00B2C                  ;*******************************************************************************
    3246    2914   00B2C                  ;
    3247    2915   00B2C                  ; cordic registers can only be accessed in the mapped memory area (rmap=1)
    3248    2916   00B2C                  ;
    3249    2917   00B2C                  ;*******************************************************************************
    3250    2918   00B2C                  
    3251    2919   00B2C                  cd_cordxl     data   09ah          ;cordic x data low                 reset=000h
    3252    2920   00B2C                  cd_cordxh     data   09bh          ;cordic x data high                reset=000h
    3253    2921   00B2C                  cd_cordyl     data   09ch          ;cordic y data low                 reset=000h
    3254    2922   00B2C                  cd_cordyh     data   09dh          ;cordic y data high                reset=000h
    3255    2923   00B2C                  cd_cordzl     data   09eh          ;cordic z data low                 reset=000h
    3256    2924   00B2C                  cd_cordzh     data   09fh          ;cordic z data high                reset=000h
    3257    2925   00B2C                  cd_statc      data   0a0h          ;cordic status and control         reset=000h
    3258    2926   00B2C                  ;cd_statc is bit addressable
    3259    2927   00B2C                         keepz  bit    0a7h
    3260    2928   00B2C                         keepy  bit    0a6h
    3261    2929   00B2C                         keepx  bit    0a5h
    3262    2930   00B2C                         dmap   bit    0a4h
    3263    2931   00B2C                         int_en bit    0a3h
    3264    2932   00B2C                         eoc    bit    0a2h
    3265    2933   00B2C                         error  bit    0a1h
    3266    2934   00B2C                         cd_bsy bit    0a0h
    3267    2935   00B2C                  
    3268    2936   00B2C                  cd_con        data   0a1h          ;cordic control register           reset=000h
    3269    2937   00B2C                  
    3270    2938   00B2C                  ;*******************************************************************************
    3271    2939   00B2C                  ;
    3272    2940   00B2C                  ; wdt registers can be accessed in the mapped memory area (rmap=1)
    3273    2941   00B2C                  ;
    3274    2942   00B2C                  ;*******************************************************************************
    3275    2943   00B2C                  
    3276    2944   00B2C                  wdtcon        data   0bbh          ;watchdog timer control            reset=000h
    3277    2945   00B2C                  wdtrel        data   0bch          ;watchdog timer reload             reset=000h
    3278    2946   00B2C                  wdtwinb       data   0bdh          ;wdt window boundry count          reset=000h
    3279    2947   00B2C                  wdtl          data   0beh          ;wdt register low                  reset=000h
    3280    2948   00B2C                  wdth          data   0bfh          ;wdt register high                 reset=000h
    3281    2949   00B2C                  
    3282    2950   00B2C                  ;*******************************************************************************
    3283    2951   00B2C                  ;
    3284    2952   00B2C                  ; t21 registers can be accessed in the mapped memory area (rmap=1)
    3285    2953   00B2C                  ;
    3286    2954   00B2C                  ;*******************************************************************************
    3287    2955   00B2C                  
    3288    2956   00B2C                  t21_t2con     data   0c0h          ;timer 21 control register         reset=000h
    3289    2957   00B2C                  ;t2_t2con is bit addressable bits are aalready defined
    3290    2958   00B2C                         ;tf2    bit    0c7h
    3291    2959   00B2C                         ;exf2   bit    0c6h
    3292    2960   00B2C                                                     ;2 bits are not implemented
    3293    2961   00B2C                         ;exen2  bit    0c3h
    3294    2962   00B2C                         ;tr2    bit    0c2h
    3295    2963   00B2C                         ;ct2    bit    0c1h
    3296    2964   00B2C                         ;cprl2  bit    0c0h
    3297    2965   00B2C                  
    3298    2966   00B2C                  t21_t2mod      data   0c1h          ;timer 21 mode register           reset=000h
    3299    2967   00B2C                  t21_rc2l       data   0c2h          ;timer 21 rel/cap low             reset=000h
    3300    2968   00B2C                  t21_rc2h       data   0c3h          ;timer 21 rel/cap high            reset=000h
    3301    2969   00B2C                  t21_t2l        data   0c4h          ;timer 21 register low            reset=000h
    3302    2970   00B2C                  t21_t2h        data   0c5h          ;timer 21 register high           reset=000h
    3303    2971   00B2C                  
    3304    2972   00B2C                  ;*******************************************************************************
    3305    2973   00B2C                  ;
    3306    2974   00B2C                  ; uart1 registers can be accessed in the mapped memory area (rmap=1)
    3307    2975   00B2C                  ;
    3308    2976   00B2C                  ;*******************************************************************************
    3309    2977   00B2C                  
    3310    2978   00B2C                  scon1         data   0c8h          ;sirial channel 1 control          reset=000h
    3311    2979   00B2C                  ;s1con is bit addressable
    3312    2980   00B2C                         sm01   bit    0cfh
    3313    2981   00B2C                         sm11   bit    0ceh
    3314    2982   00B2C                         sm21   bit    0cdh
    3315    2983   00B2C                         ren1   bit    0cch
    3316    2984   00B2C                         tb81   bit    0cbh
    3317    2985   00B2C                         rb81   bit    0cah
    3318    2986   00B2C                         ti1    bit    0c9h
    3319    2987   00B2C                         ri1    bit    0c8h
    3320    2988   00B2C                  
    3321    2989   00B2C                  sbuf1         data   0c9h          ;serial channel 1 data             reset=000h
    3322    2990   00B2C                  bcon1         data   0cah          ;baud rate control register        reset=000h
    3323    2991   00B2C                  bg1           data   0cbh          ;baud rate timer reload            reset=000h
    3324    2992   00B2C                  fdcon1        data   0cch          ;fractional devider control        reset=000h
    3325    2993   00B2C                  fdstep1       data   0cdh          ;fractional devider reload         reset=000h
    3326    2994   00B2C                  fdres1        data   0ceh          ;fractional devider result         reset=000h
    3327    2995   00B2C                  
    3328    2996   00B2C                  ;*******************************************************************************
    3329    2997   00B2C                  ;
    3330    2998   00B2C                  ; ocds registers can be accessed in mapped memory area (rmap=1)
    3331    2999   00B2C                  ;
    3332    3000   00B2C                  ;*******************************************************************************
    3333    3001   00B2C                  
    3334    3002   00B2C                  mmcr2         data   0e9h          ;monitor mode control              reset=01-h
    3335    3003   00B2C                  mmcr          data   0f1h          ;monitor control                   reset=000h
    3336    3004   00B2C                  mmsr          data   0f2h          ;monitor mode status               reset=000h
    3337    3005   00B2C                  mmbpcr        data   0f3h          ;breakpoints control register      reset=000h
    3338    3006   00B2C                  mmicr         data   0f4h          ;monitor mode interrupt control    reset=000h
    3339    3007   00B2C                  mmdr          data   0f5h          ;monitor mode data transfer        reset=000h
    3340    3008   00B2C                  hwbpsr        data   0f6h          ;hardware breakpoints select       reset=000h
    3341    3009   00B2C                  hwbpdr        data   0f7h          ;hardware breakpoints data         reset=000h
    3342    3010   00B2C                  mmwr1         data   0ebh          ;monitor work register 1           reset=000h
    3343    3011   00B2C                  mmwr2         data   0ech          ;monitor work register 2           reset=000h
    3344    3012   00B2C                  
    3345    3013   00B2C                  ;end directive must be used, but has no signification
    3346    3014   00B2C                  
    3347    3015   00B2C                  end
    3348    3016   00B2C                  
    3349    3017   00B2C                  
    3350    3018   00B2C                  
    3351    3019   00B2C                  
    3352    3020   00B2C                  
    3353    3021   00B2C                  
    3354    3022   00B2C                  
    3355    3023   00B2C                  
    3356    3024   00B2C                  
    3357    3025   00B2C                  
    3358    3026   00B2C                  
    3359    3027   00B2C                  
    3360    3028   00B2C                  
    3361    3029   00B2C                  
    3362    3030   00B2C                  
    3363    3031   00B2C                  
